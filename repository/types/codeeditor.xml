<?xml version="1.0" encoding="utf-8"?>
<Type>
  <Information>
    <Name>codeeditor</Name>
    <DisplayName>#Lang(001)</DisplayName>
    <Description>#Lang(002)</Description>
    <ClassName>VDOM_codeeditor</ClassName>
    <ID>9a8f8e07-cb43-ff0f-7179-4a437911af23</ID>
    <Icon>#Res(2a2d2448-2e13-b0bb-8a81-17014fba35bd)</Icon>
    <EditorIcon>#Res(c43c7089-459d-acc2-f636-fb4b23f22d5b)</EditorIcon>
    <StructureIcon>#Res(a7280e78-723d-4c0e-07b3-fb4b16697f8a)</StructureIcon>
    <Moveable>1</Moveable>
    <Resizable>3</Resizable>
    <Container>1</Container>
    <Category>Form</Category>
    <Dynamic>1</Dynamic>
    <Version>1.389.8401</Version>
    <InterfaceType>1</InterfaceType>
    <OptimizationPriority>1</OptimizationPriority>
    <Containers>htmlcontainer, dialog, container, tablecell, form, accordeon, tabview, dialog_2, vdomclass</Containers>
    <Languages>en_US ,fr_FR ,ru_RU</Languages>
    <Handlers/>
    <RemoteMethods/>
    <WCAG/>
    <XMLScriptName/>
  </Information>
  <Attributes>
    <Attribute>
      <Name>stateful</Name>
      <DisplayName>#Lang(101)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(201)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>DropDown((#Lang(401)|0)|(#Lang(402)|1))</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(301)</ErrorValidationMessage>
      <RegularExpressionValidation>^[01]$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>hierarchy</Name>
      <DisplayName>#Lang(102)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(202)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(2)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(302)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,2}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>visible</Name>
      <DisplayName>#Lang(103)</DisplayName>
      <DefaultValue>1</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(203)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>DropDown((#Lang(403)|0)|(#Lang(404)|1))</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(303)</ErrorValidationMessage>
      <RegularExpressionValidation>^[01]$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>zindex</Name>
      <DisplayName>#Lang(104)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(204)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(2)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(304)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,2}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>top</Name>
      <DisplayName>#Lang(105)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(205)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(305)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>left</Name>
      <DisplayName>#Lang(106)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(206)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(306)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>width</Name>
      <DisplayName>#Lang(107)</DisplayName>
      <DefaultValue>250</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(207)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(307)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>height</Name>
      <DisplayName>#Lang(108)</DisplayName>
      <DefaultValue>100</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(208)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(4)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(308)</ErrorValidationMessage>
      <RegularExpressionValidation>^\d{1,4}$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>value</Name>
      <DisplayName>#Lang(109)</DisplayName>
      <DefaultValue/>
      <Visible>1</Visible>
      <Help>#Lang(209)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>MultiLine(10000)</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(309)</ErrorValidationMessage>
      <RegularExpressionValidation>^.*$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>syntax</Name>
      <DisplayName>#Lang(111)</DisplayName>
      <DefaultValue>vscript</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(211)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>DropDown((#Lang(405)|vscript)|(#Lang(406)|xml)|(#Lang(407)|python)|(#Lang(408)|javascript)|(#Lang(409)|html)|(#Lang(411)|css))</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(311)</ErrorValidationMessage>
      <RegularExpressionValidation>^.*$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>is_readonly</Name>
      <DisplayName>#Lang(112)</DisplayName>
      <DefaultValue>0</DefaultValue>
      <Visible>1</Visible>
      <Help>#Lang(212)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>DropDown((#Lang(412)|1)|(#Lang(413)|0))</CodeInterface>
      <Colorgroup>2</Colorgroup>
      <ErrorValidationMessage>#Lang(312)</ErrorValidationMessage>
      <RegularExpressionValidation>^[01]$</RegularExpressionValidation>
    </Attribute>
    <Attribute>
      <Name>customname</Name>
      <DisplayName>#Lang(113)</DisplayName>
      <DefaultValue/>
      <Visible>1</Visible>
      <Help>#Lang(213)</Help>
      <InterfaceType>0</InterfaceType>
      <CodeInterface>TextField(100)</CodeInterface>
      <Colorgroup>1</Colorgroup>
      <ErrorValidationMessage>#Lang(313)</ErrorValidationMessage>
      <RegularExpressionValidation>^.*$</RegularExpressionValidation>
    </Attribute>
  </Attributes>
  <Languages>
    <Language Code="en_US">
      <Sentence ID="001">Code editor</Sentence>
      <Sentence ID="002">The Code editor type produces an object used to display the multiline text as a piece of code. It can automatically numerate the lines of code and highlight the code elements.</Sentence>
      <Sentence ID="003"></Sentence>
      <Sentence ID="101"></Sentence>
      <Sentence ID="102">Hierarchy</Sentence>
      <Sentence ID="103">Visibility</Sentence>
      <Sentence ID="104">Z-Index</Sentence>
      <Sentence ID="105">Top</Sentence>
      <Sentence ID="106">Left</Sentence>
      <Sentence ID="107">Width</Sentence>
      <Sentence ID="108">Height</Sentence>
      <Sentence ID="109">Value</Sentence>
      <Sentence ID="111">Syntax</Sentence>
      <Sentence ID="112">readonly</Sentence>
      <Sentence ID="113">Custom name</Sentence>
      <Sentence ID="201"></Sentence>
      <Sentence ID="202">Order of rendering the object on the page</Sentence>
      <Sentence ID="203">Visibility of the object</Sentence>
      <Sentence ID="204">Position in visual hierarchy of objects</Sentence>
      <Sentence ID="205">Spacing between the top edge of the container and the object in pixels</Sentence>
      <Sentence ID="206">Spacing between the left edge of the container and the object in pixels</Sentence>
      <Sentence ID="207">Width of the object in pixels</Sentence>
      <Sentence ID="208">Height of the object in pixels</Sentence>
      <Sentence ID="209">Text to display</Sentence>
      <Sentence ID="211">Syntax</Sentence>
      <Sentence ID="212">Toggle readonly mode</Sentence>
      <Sentence ID="213">custom name for input</Sentence>
      <Sentence ID="301"></Sentence>
      <Sentence ID="302">Incorrect value, must be even integer from 0 to 99</Sentence>
      <Sentence ID="303">Incorrect value, must be either 0 or 1</Sentence>
      <Sentence ID="304">Incorrect value, must be even integer from 0 to 99</Sentence>
      <Sentence ID="305">Incorrect value, must be even positive integer</Sentence>
      <Sentence ID="306">Incorrect value, must be even positive integer</Sentence>
      <Sentence ID="307">Incorrect value, must be even positive integer</Sentence>
      <Sentence ID="308">Incorrect value, must be even positive integer</Sentence>
      <Sentence ID="309">Incorrect value</Sentence>
      <Sentence ID="311">Incorrect value</Sentence>
      <Sentence ID="312">newAttribute11</Sentence>
      <Sentence ID="313">invalid custom name for input</Sentence>
      <Sentence ID="401"></Sentence>
      <Sentence ID="402"></Sentence>
      <Sentence ID="403">Invisible</Sentence>
      <Sentence ID="404">Visible</Sentence>
      <Sentence ID="405">VScript</Sentence>
      <Sentence ID="406">XML</Sentence>
      <Sentence ID="407">Python</Sentence>
      <Sentence ID="408">Javascript</Sentence>
      <Sentence ID="409">HTML</Sentence>
      <Sentence ID="411">CSS</Sentence>
      <Sentence ID="412">ReadOnly</Sentence>
      <Sentence ID="413">Editable</Sentence>
      <Sentence ID="501">Set new text value</Sentence>
      <Sentence ID="502">Hide the object</Sentence>
      <Sentence ID="503">Move the object to a new position</Sentence>
      <Sentence ID="504">Show the object</Sentence>
      <Sentence ID="505">Show the object</Sentence>
      <Sentence ID="506">Set cursor to line</Sentence>
      <Sentence ID="507">Set new text value</Sentence>
      <Sentence ID="508">Show the object</Sentence>
      <Sentence ID="509">Show the object</Sentence>
      <Sentence ID="511">Set new text value</Sentence>
      <Sentence ID="512">Show the object</Sentence>
      <Sentence ID="513"></Sentence>
      <Sentence ID="514"></Sentence>
      <Sentence ID="601">setValue</Sentence>
      <Sentence ID="602">Hide</Sentence>
      <Sentence ID="603">moveTo</Sentence>
      <Sentence ID="604">Show</Sentence>
      <Sentence ID="605">Show</Sentence>
      <Sentence ID="606">setCursor</Sentence>
      <Sentence ID="607">setValue</Sentence>
      <Sentence ID="608">Show</Sentence>
      <Sentence ID="609">Show</Sentence>
      <Sentence ID="611">setValue</Sentence>
      <Sentence ID="612">Show</Sentence>
      <Sentence ID="701">Fade</Sentence>
      <Sentence ID="702">newX</Sentence>
      <Sentence ID="703">newY</Sentence>
      <Sentence ID="704">Effect</Sentence>
      <Sentence ID="705">Fade</Sentence>
      <Sentence ID="706"></Sentence>
      <Sentence ID="707">line</Sentence>
      <Sentence ID="708">Fade</Sentence>
      <Sentence ID="709">Fade</Sentence>
      <Sentence ID="711">Value</Sentence>
      <Sentence ID="712">Fade</Sentence>
      <Sentence ID="801">Fade effect, time is indicated in milliseconds</Sentence>
      <Sentence ID="802">X-coordinate of the new position relative to the left upper corner of the container</Sentence>
      <Sentence ID="803">Y-coordinate of the new position relative to the left upper corner of the container</Sentence>
      <Sentence ID="804">Visual effect of moving, time is indicated in milliseconds</Sentence>
      <Sentence ID="805">Fade effect, time is indicated in milliseconds</Sentence>
      <Sentence ID="806"></Sentence>
      <Sentence ID="807">Line number</Sentence>
      <Sentence ID="808">Fade effect, time is indicated in milliseconds</Sentence>
      <Sentence ID="809">Fade effect, time is indicated in milliseconds</Sentence>
      <Sentence ID="811">New text value</Sentence>
      <Sentence ID="812">Fade effect, time is indicated in milliseconds</Sentence>
      <Sentence ID="901"></Sentence>
      <Sentence ID="902"></Sentence>
      <Sentence ID="903"></Sentence>
    </Language>
    <Language Code="fr_FR">
      <Sentence ID="001">Zone de Texte</Sentence>
      <Sentence ID="002">Zone de Texte</Sentence>
      <Sentence ID="003"></Sentence>
      <Sentence ID="101"></Sentence>
      <Sentence ID="102">Hiérarchie</Sentence>
      <Sentence ID="103">Visibilité</Sentence>
      <Sentence ID="104">Z-Index</Sentence>
      <Sentence ID="105">Haut</Sentence>
      <Sentence ID="106">Gauche</Sentence>
      <Sentence ID="107">Largeur</Sentence>
      <Sentence ID="108">Hauteur</Sentence>
      <Sentence ID="109">Valeur</Sentence>
      <Sentence ID="111"></Sentence>
      <Sentence ID="112"></Sentence>
      <Sentence ID="113"></Sentence>
      <Sentence ID="201"></Sentence>
      <Sentence ID="202">Hiérarchie de l'objet, ordre de chargement de l'objet par rapport aux autres</Sentence>
      <Sentence ID="203">Afficher ou cacher l'objet</Sentence>
      <Sentence ID="204">Niveau de superposition de l'objet par rapport aux autres</Sentence>
      <Sentence ID="205">Distance depuis le bord haut de l'objet parent en pixels</Sentence>
      <Sentence ID="206">Distance depuis le bord gauche de l'objet parent en pixels</Sentence>
      <Sentence ID="207">Largeur de l'objet en pixels</Sentence>
      <Sentence ID="208">Hauteur de l'objet en pixels</Sentence>
      <Sentence ID="209">Texte dans le champs</Sentence>
      <Sentence ID="211"></Sentence>
      <Sentence ID="212"></Sentence>
      <Sentence ID="213"></Sentence>
      <Sentence ID="301"></Sentence>
      <Sentence ID="302">Valeur Incorrecte, doit être positive</Sentence>
      <Sentence ID="303">Valeur Incorrecte, doit être 0 ou 1</Sentence>
      <Sentence ID="304">Valeur Incorrecte, doit être positive</Sentence>
      <Sentence ID="305">Valeur Incorrecte, doit être positive</Sentence>
      <Sentence ID="306">Valeur Incorrecte, doit être positive</Sentence>
      <Sentence ID="307">Valeur Incorrecte, doit être positive</Sentence>
      <Sentence ID="308">Valeur Incorrecte, doit être positive</Sentence>
      <Sentence ID="309">Valeur Incorrecte</Sentence>
      <Sentence ID="311"></Sentence>
      <Sentence ID="312"></Sentence>
      <Sentence ID="313"></Sentence>
      <Sentence ID="401"></Sentence>
      <Sentence ID="402"></Sentence>
      <Sentence ID="403">Invisible</Sentence>
      <Sentence ID="404">Visible</Sentence>
      <Sentence ID="405"></Sentence>
      <Sentence ID="406"></Sentence>
      <Sentence ID="407"></Sentence>
      <Sentence ID="408"></Sentence>
      <Sentence ID="409"></Sentence>
      <Sentence ID="411"></Sentence>
      <Sentence ID="412"></Sentence>
      <Sentence ID="413"></Sentence>
      <Sentence ID="501">Set new text</Sentence>
      <Sentence ID="502">Hide the object</Sentence>
      <Sentence ID="503">Move object to selected point</Sentence>
      <Sentence ID="504">Show the object</Sentence>
      <Sentence ID="505">Show the object</Sentence>
      <Sentence ID="506"></Sentence>
      <Sentence ID="507">Set new text</Sentence>
      <Sentence ID="508">Show the object</Sentence>
      <Sentence ID="509">Show the object</Sentence>
      <Sentence ID="511">Set new text</Sentence>
      <Sentence ID="512">Show the object</Sentence>
      <Sentence ID="513"></Sentence>
      <Sentence ID="514"></Sentence>
      <Sentence ID="601">setValue</Sentence>
      <Sentence ID="602">Hide</Sentence>
      <Sentence ID="603">moveTo</Sentence>
      <Sentence ID="604">Show</Sentence>
      <Sentence ID="605">Show</Sentence>
      <Sentence ID="606"></Sentence>
      <Sentence ID="607">setValue</Sentence>
      <Sentence ID="608">Show</Sentence>
      <Sentence ID="609">Show</Sentence>
      <Sentence ID="611">setValue</Sentence>
      <Sentence ID="612">Show</Sentence>
      <Sentence ID="701">Fade</Sentence>
      <Sentence ID="702">newX</Sentence>
      <Sentence ID="703">newY</Sentence>
      <Sentence ID="704">Effect</Sentence>
      <Sentence ID="705">Fade</Sentence>
      <Sentence ID="706"></Sentence>
      <Sentence ID="707"></Sentence>
      <Sentence ID="708">Fade</Sentence>
      <Sentence ID="709">Fade</Sentence>
      <Sentence ID="711">Value</Sentence>
      <Sentence ID="712">Fade</Sentence>
      <Sentence ID="801">Fade time</Sentence>
      <Sentence ID="802">X-coordinate of new point</Sentence>
      <Sentence ID="803">Y-coordinate of new point</Sentence>
      <Sentence ID="804">Visual effect by moving</Sentence>
      <Sentence ID="805">Time of appearance</Sentence>
      <Sentence ID="806"></Sentence>
      <Sentence ID="807"></Sentence>
      <Sentence ID="808">Time of appearance</Sentence>
      <Sentence ID="809">Time of appearance</Sentence>
      <Sentence ID="811">New text</Sentence>
      <Sentence ID="812">Time of appearance</Sentence>
      <Sentence ID="901"></Sentence>
      <Sentence ID="902"></Sentence>
      <Sentence ID="903"></Sentence>
    </Language>
    <Language Code="ru_RU">
      <Sentence ID="001">Поле текста</Sentence>
      <Sentence ID="002">Текстовое поле формы</Sentence>
      <Sentence ID="003"></Sentence>
      <Sentence ID="101"></Sentence>
      <Sentence ID="102">Иерархия</Sentence>
      <Sentence ID="103">Отображение</Sentence>
      <Sentence ID="104">Позиция</Sentence>
      <Sentence ID="105">Сверху</Sentence>
      <Sentence ID="106">Слева</Sentence>
      <Sentence ID="107">Ширина</Sentence>
      <Sentence ID="108">Высота</Sentence>
      <Sentence ID="109">Значение</Sentence>
      <Sentence ID="111"></Sentence>
      <Sentence ID="112"></Sentence>
      <Sentence ID="113"></Sentence>
      <Sentence ID="201"></Sentence>
      <Sentence ID="202">Порядок визуализации объекта в ходе загрузки страницы</Sentence>
      <Sentence ID="203">Режим отображения объекта</Sentence>
      <Sentence ID="204">Положение в визуальной иерархии объектов</Sentence>
      <Sentence ID="205">Расстояние от верхней границы родительского контейнера до объекта в пикселях</Sentence>
      <Sentence ID="206">Расстояние от левой границы родительского контейнера до объекта в пикселях</Sentence>
      <Sentence ID="207">Ширина объекта в пикселях</Sentence>
      <Sentence ID="208">Высота объекта в пикселях</Sentence>
      <Sentence ID="209">Отображаемый текст</Sentence>
      <Sentence ID="211"></Sentence>
      <Sentence ID="212"></Sentence>
      <Sentence ID="213"></Sentence>
      <Sentence ID="301"></Sentence>
      <Sentence ID="302">Неправильное значение, должно быть указано целое число от 0 до 99</Sentence>
      <Sentence ID="303">Неправильное значение, должен быть указан 0 или 1</Sentence>
      <Sentence ID="304">Неправильное значение, должно быть указано целое число от 0 до 99</Sentence>
      <Sentence ID="305">Неправильное значение, должно быть целое положительное число</Sentence>
      <Sentence ID="306">Неправильное значение, должно быть целое положительное число</Sentence>
      <Sentence ID="307">Неправильное значение, должно быть целое положительное число</Sentence>
      <Sentence ID="308">Неправильное значение, должно быть целое положительное число</Sentence>
      <Sentence ID="309">Неправильное значение</Sentence>
      <Sentence ID="311"></Sentence>
      <Sentence ID="312"></Sentence>
      <Sentence ID="313"></Sentence>
      <Sentence ID="401"></Sentence>
      <Sentence ID="402"></Sentence>
      <Sentence ID="403">Не отображать</Sentence>
      <Sentence ID="404">Отображать</Sentence>
      <Sentence ID="405"></Sentence>
      <Sentence ID="406"></Sentence>
      <Sentence ID="407"></Sentence>
      <Sentence ID="408"></Sentence>
      <Sentence ID="409"></Sentence>
      <Sentence ID="411"></Sentence>
      <Sentence ID="412"></Sentence>
      <Sentence ID="413"></Sentence>
      <Sentence ID="501">Установить новый текст</Sentence>
      <Sentence ID="502">Скрыть объект</Sentence>
      <Sentence ID="503">Сдвинуть объект в заданную точку</Sentence>
      <Sentence ID="504">Показать объект</Sentence>
      <Sentence ID="505">Показать объект</Sentence>
      <Sentence ID="506"></Sentence>
      <Sentence ID="507">Установить новый текст</Sentence>
      <Sentence ID="508">Показать объект</Sentence>
      <Sentence ID="509">Показать объект</Sentence>
      <Sentence ID="511">Установить новый текст</Sentence>
      <Sentence ID="512">Показать объект</Sentence>
      <Sentence ID="513"></Sentence>
      <Sentence ID="514"></Sentence>
      <Sentence ID="601">Установить текст</Sentence>
      <Sentence ID="602">Скрыть</Sentence>
      <Sentence ID="603">Сдвинуть</Sentence>
      <Sentence ID="604">Показать</Sentence>
      <Sentence ID="605">Показать</Sentence>
      <Sentence ID="606"></Sentence>
      <Sentence ID="607">Установить текст</Sentence>
      <Sentence ID="608">Показать</Sentence>
      <Sentence ID="609">Показать</Sentence>
      <Sentence ID="611">Установить текст</Sentence>
      <Sentence ID="612">Показать</Sentence>
      <Sentence ID="701">Исчезновение</Sentence>
      <Sentence ID="702">Координата по оси X</Sentence>
      <Sentence ID="703">Координата по оси X</Sentence>
      <Sentence ID="704">Эффект</Sentence>
      <Sentence ID="705">Появление</Sentence>
      <Sentence ID="706"></Sentence>
      <Sentence ID="707"></Sentence>
      <Sentence ID="708">Появление</Sentence>
      <Sentence ID="709">Появление</Sentence>
      <Sentence ID="711">Текст</Sentence>
      <Sentence ID="712">Появление</Sentence>
      <Sentence ID="801">Время исчезновения в миллисекундах</Sentence>
      <Sentence ID="802">Координата новой точки по оси X</Sentence>
      <Sentence ID="803">Координата новой точки по оси Y</Sentence>
      <Sentence ID="804">Визуальный эффект при перетаскивании</Sentence>
      <Sentence ID="805">Время появления в миллисекундах</Sentence>
      <Sentence ID="806"></Sentence>
      <Sentence ID="807"></Sentence>
      <Sentence ID="808">Время появления в миллисекундах</Sentence>
      <Sentence ID="809">Время появления в миллисекундах</Sentence>
      <Sentence ID="811">Новый текст</Sentence>
      <Sentence ID="812">Время появления в миллисекундах</Sentence>
      <Sentence ID="901"></Sentence>
      <Sentence ID="902"></Sentence>
      <Sentence ID="903"></Sentence>
    </Language>
  </Languages>
  <Resources>
    <Resource ID="064add91-8595-0f40-10ea-09d38022edee" Name="codemirror" Type="js"><![CDATA[Ly8gQ29kZU1pcnJvciwgY29weXJpZ2h0IChjKSBieSBNYXJpam4gSGF2ZXJiZWtlIGFuZCBvdGhlcnMNCi8vIERpc3RyaWJ1dGVkIHVuZGVyIGFuIE1JVCBsaWNlbnNlOiBodHRwczovL2NvZGVtaXJyb3IubmV0L0xJQ0VOU0UNCg0KLy8gVGhpcyBpcyBDb2RlTWlycm9yIChodHRwczovL2NvZGVtaXJyb3IubmV0KSwgYSBjb2RlIGVkaXRvcg0KLy8gaW1wbGVtZW50ZWQgaW4gSmF2YVNjcmlwdCBvbiB0b3Agb2YgdGhlIGJyb3dzZXIncyBET00uDQovLw0KLy8gWW91IGNhbiBmaW5kIHNvbWUgdGVjaG5pY2FsIGJhY2tncm91bmQgZm9yIHNvbWUgb2YgdGhlIGNvZGUgYmVsb3cNCi8vIGF0IGh0dHA6Ly9tYXJpam5oYXZlcmJla2UubmwvYmxvZy8jY20taW50ZXJuYWxzIC4NCg0KKGZ1bmN0aW9uIChnbG9iYWwsIGZhY3RvcnkpIHsNCiAgdHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnICYmIHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnID8gbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCkgOg0KICB0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQgPyBkZWZpbmUoZmFjdG9yeSkgOg0KICAoZ2xvYmFsLkNvZGVNaXJyb3IgPSBmYWN0b3J5KCkpOw0KfSh0aGlzLCAoZnVuY3Rpb24gKCkgeyAndXNlIHN0cmljdCc7DQoNCiAgLy8gS2x1ZGdlcyBmb3IgYnVncyBhbmQgYmVoYXZpb3IgZGlmZmVyZW5jZXMgdGhhdCBjYW4ndCBiZSBmZWF0dXJlDQogIC8vIGRldGVjdGVkIGFyZSBlbmFibGVkIGJhc2VkIG9uIHVzZXJBZ2VudCBldGMgc25pZmZpbmcuDQogIHZhciB1c2VyQWdlbnQgPSBuYXZpZ2F0b3IudXNlckFnZW50Ow0KICB2YXIgcGxhdGZvcm0gPSBuYXZpZ2F0b3IucGxhdGZvcm07DQoNCiAgdmFyIGdlY2tvID0gL2dlY2tvXC9cZC9pLnRlc3QodXNlckFnZW50KTsNCiAgdmFyIGllX3VwdG8xMCA9IC9NU0lFIFxkLy50ZXN0KHVzZXJBZ2VudCk7DQogIHZhciBpZV8xMXVwID0gL1RyaWRlbnRcLyg/Ols3LTldfFxkezIsfSlcLi4qcnY6KFxkKykvLmV4ZWModXNlckFnZW50KTsNCiAgdmFyIGVkZ2UgPSAvRWRnZVwvKFxkKykvLmV4ZWModXNlckFnZW50KTsNCiAgdmFyIGllID0gaWVfdXB0bzEwIHx8IGllXzExdXAgfHwgZWRnZTsNCiAgdmFyIGllX3ZlcnNpb24gPSBpZSAmJiAoaWVfdXB0bzEwID8gZG9jdW1lbnQuZG9jdW1lbnRNb2RlIHx8IDYgOiArKGVkZ2UgfHwgaWVfMTF1cClbMV0pOw0KICB2YXIgd2Via2l0ID0gIWVkZ2UgJiYgL1dlYktpdFwvLy50ZXN0KHVzZXJBZ2VudCk7DQogIHZhciBxdHdlYmtpdCA9IHdlYmtpdCAmJiAvUXRcL1xkK1wuXGQrLy50ZXN0KHVzZXJBZ2VudCk7DQogIHZhciBjaHJvbWUgPSAhZWRnZSAmJiAvQ2hyb21lXC8vLnRlc3QodXNlckFnZW50KTsNCiAgdmFyIHByZXN0byA9IC9PcGVyYVwvLy50ZXN0KHVzZXJBZ2VudCk7DQogIHZhciBzYWZhcmkgPSAvQXBwbGUgQ29tcHV0ZXIvLnRlc3QobmF2aWdhdG9yLnZlbmRvcik7DQogIHZhciBtYWNfZ2VNb3VudGFpbkxpb24gPSAvTWFjIE9TIFggMVxkXEQoWzgtOV18XGRcZClcRC8udGVzdCh1c2VyQWdlbnQpOw0KICB2YXIgcGhhbnRvbSA9IC9QaGFudG9tSlMvLnRlc3QodXNlckFnZW50KTsNCg0KICB2YXIgaW9zID0gIWVkZ2UgJiYgL0FwcGxlV2ViS2l0Ly50ZXN0KHVzZXJBZ2VudCkgJiYgL01vYmlsZVwvXHcrLy50ZXN0KHVzZXJBZ2VudCk7DQogIHZhciBhbmRyb2lkID0gL0FuZHJvaWQvLnRlc3QodXNlckFnZW50KTsNCiAgLy8gVGhpcyBpcyB3b2VmdWxseSBpbmNvbXBsZXRlLiBTdWdnZXN0aW9ucyBmb3IgYWx0ZXJuYXRpdmUgbWV0aG9kcyB3ZWxjb21lLg0KICB2YXIgbW9iaWxlID0gaW9zIHx8IGFuZHJvaWQgfHwgL3dlYk9TfEJsYWNrQmVycnl8T3BlcmEgTWluaXxPcGVyYSBNb2JpfElFTW9iaWxlL2kudGVzdCh1c2VyQWdlbnQpOw0KICB2YXIgbWFjID0gaW9zIHx8IC9NYWMvLnRlc3QocGxhdGZvcm0pOw0KICB2YXIgY2hyb21lT1MgPSAvXGJDck9TXGIvLnRlc3QodXNlckFnZW50KTsNCiAgdmFyIHdpbmRvd3MgPSAvd2luL2kudGVzdChwbGF0Zm9ybSk7DQoNCiAgdmFyIHByZXN0b192ZXJzaW9uID0gcHJlc3RvICYmIHVzZXJBZ2VudC5tYXRjaCgvVmVyc2lvblwvKFxkKlwuXGQqKS8pOw0KICBpZiAocHJlc3RvX3ZlcnNpb24pIHsgcHJlc3RvX3ZlcnNpb24gPSBOdW1iZXIocHJlc3RvX3ZlcnNpb25bMV0pOyB9DQogIGlmIChwcmVzdG9fdmVyc2lvbiAmJiBwcmVzdG9fdmVyc2lvbiA+PSAxNSkgeyBwcmVzdG8gPSBmYWxzZTsgd2Via2l0ID0gdHJ1ZTsgfQ0KICAvLyBTb21lIGJyb3dzZXJzIHVzZSB0aGUgd3JvbmcgZXZlbnQgcHJvcGVydGllcyB0byBzaWduYWwgY21kL2N0cmwgb24gT1MgWA0KICB2YXIgZmxpcEN0cmxDbWQgPSBtYWMgJiYgKHF0d2Via2l0IHx8IHByZXN0byAmJiAocHJlc3RvX3ZlcnNpb24gPT0gbnVsbCB8fCBwcmVzdG9fdmVyc2lvbiA8IDEyLjExKSk7DQogIHZhciBjYXB0dXJlUmlnaHRDbGljayA9IGdlY2tvIHx8IChpZSAmJiBpZV92ZXJzaW9uID49IDkpOw0KDQogIGZ1bmN0aW9uIGNsYXNzVGVzdChjbHMpIHsgcmV0dXJuIG5ldyBSZWdFeHAoIihefFxccykiICsgY2xzICsgIig/OiR8XFxzKVxccyoiKSB9DQoNCiAgdmFyIHJtQ2xhc3MgPSBmdW5jdGlvbihub2RlLCBjbHMpIHsNCiAgICB2YXIgY3VycmVudCA9IG5vZGUuY2xhc3NOYW1lOw0KICAgIHZhciBtYXRjaCA9IGNsYXNzVGVzdChjbHMpLmV4ZWMoY3VycmVudCk7DQogICAgaWYgKG1hdGNoKSB7DQogICAgICB2YXIgYWZ0ZXIgPSBjdXJyZW50LnNsaWNlKG1hdGNoLmluZGV4ICsgbWF0Y2hbMF0ubGVuZ3RoKTsNCiAgICAgIG5vZGUuY2xhc3NOYW1lID0gY3VycmVudC5zbGljZSgwLCBtYXRjaC5pbmRleCkgKyAoYWZ0ZXIgPyBtYXRjaFsxXSArIGFmdGVyIDogIiIpOw0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiByZW1vdmVDaGlsZHJlbihlKSB7DQogICAgZm9yICh2YXIgY291bnQgPSBlLmNoaWxkTm9kZXMubGVuZ3RoOyBjb3VudCA+IDA7IC0tY291bnQpDQogICAgICB7IGUucmVtb3ZlQ2hpbGQoZS5maXJzdENoaWxkKTsgfQ0KICAgIHJldHVybiBlDQogIH0NCg0KICBmdW5jdGlvbiByZW1vdmVDaGlsZHJlbkFuZEFkZChwYXJlbnQsIGUpIHsNCiAgICByZXR1cm4gcmVtb3ZlQ2hpbGRyZW4ocGFyZW50KS5hcHBlbmRDaGlsZChlKQ0KICB9DQoNCiAgZnVuY3Rpb24gZWx0KHRhZywgY29udGVudCwgY2xhc3NOYW1lLCBzdHlsZSkgew0KICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0YWcpOw0KICAgIGlmIChjbGFzc05hbWUpIHsgZS5jbGFzc05hbWUgPSBjbGFzc05hbWU7IH0NCiAgICBpZiAoc3R5bGUpIHsgZS5zdHlsZS5jc3NUZXh0ID0gc3R5bGU7IH0NCiAgICBpZiAodHlwZW9mIGNvbnRlbnQgPT0gInN0cmluZyIpIHsgZS5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShjb250ZW50KSk7IH0NCiAgICBlbHNlIGlmIChjb250ZW50KSB7IGZvciAodmFyIGkgPSAwOyBpIDwgY29udGVudC5sZW5ndGg7ICsraSkgeyBlLmFwcGVuZENoaWxkKGNvbnRlbnRbaV0pOyB9IH0NCiAgICByZXR1cm4gZQ0KICB9DQogIC8vIHdyYXBwZXIgZm9yIGVsdCwgd2hpY2ggcmVtb3ZlcyB0aGUgZWx0IGZyb20gdGhlIGFjY2Vzc2liaWxpdHkgdHJlZQ0KICBmdW5jdGlvbiBlbHRQKHRhZywgY29udGVudCwgY2xhc3NOYW1lLCBzdHlsZSkgew0KICAgIHZhciBlID0gZWx0KHRhZywgY29udGVudCwgY2xhc3NOYW1lLCBzdHlsZSk7DQogICAgZS5zZXRBdHRyaWJ1dGUoInJvbGUiLCAicHJlc2VudGF0aW9uIik7DQogICAgcmV0dXJuIGUNCiAgfQ0KDQogIHZhciByYW5nZTsNCiAgaWYgKGRvY3VtZW50LmNyZWF0ZVJhbmdlKSB7IHJhbmdlID0gZnVuY3Rpb24obm9kZSwgc3RhcnQsIGVuZCwgZW5kTm9kZSkgew0KICAgIHZhciByID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsNCiAgICByLnNldEVuZChlbmROb2RlIHx8IG5vZGUsIGVuZCk7DQogICAgci5zZXRTdGFydChub2RlLCBzdGFydCk7DQogICAgcmV0dXJuIHINCiAgfTsgfQ0KICBlbHNlIHsgcmFuZ2UgPSBmdW5jdGlvbihub2RlLCBzdGFydCwgZW5kKSB7DQogICAgdmFyIHIgPSBkb2N1bWVudC5ib2R5LmNyZWF0ZVRleHRSYW5nZSgpOw0KICAgIHRyeSB7IHIubW92ZVRvRWxlbWVudFRleHQobm9kZS5wYXJlbnROb2RlKTsgfQ0KICAgIGNhdGNoKGUpIHsgcmV0dXJuIHIgfQ0KICAgIHIuY29sbGFwc2UodHJ1ZSk7DQogICAgci5tb3ZlRW5kKCJjaGFyYWN0ZXIiLCBlbmQpOw0KICAgIHIubW92ZVN0YXJ0KCJjaGFyYWN0ZXIiLCBzdGFydCk7DQogICAgcmV0dXJuIHINCiAgfTsgfQ0KDQogIGZ1bmN0aW9uIGNvbnRhaW5zKHBhcmVudCwgY2hpbGQpIHsNCiAgICBpZiAoY2hpbGQubm9kZVR5cGUgPT0gMykgLy8gQW5kcm9pZCBicm93c2VyIGFsd2F5cyByZXR1cm5zIGZhbHNlIHdoZW4gY2hpbGQgaXMgYSB0ZXh0bm9kZQ0KICAgICAgeyBjaGlsZCA9IGNoaWxkLnBhcmVudE5vZGU7IH0NCiAgICBpZiAocGFyZW50LmNvbnRhaW5zKQ0KICAgICAgeyByZXR1cm4gcGFyZW50LmNvbnRhaW5zKGNoaWxkKSB9DQogICAgZG8gew0KICAgICAgaWYgKGNoaWxkLm5vZGVUeXBlID09IDExKSB7IGNoaWxkID0gY2hpbGQuaG9zdDsgfQ0KICAgICAgaWYgKGNoaWxkID09IHBhcmVudCkgeyByZXR1cm4gdHJ1ZSB9DQogICAgfSB3aGlsZSAoY2hpbGQgPSBjaGlsZC5wYXJlbnROb2RlKQ0KICB9DQoNCiAgZnVuY3Rpb24gYWN0aXZlRWx0KCkgew0KICAgIC8vIElFIGFuZCBFZGdlIG1heSB0aHJvdyBhbiAiVW5zcGVjaWZpZWQgRXJyb3IiIHdoZW4gYWNjZXNzaW5nIGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQuDQogICAgLy8gSUUgPCAxMCB3aWxsIHRocm93IHdoZW4gYWNjZXNzZWQgd2hpbGUgdGhlIHBhZ2UgaXMgbG9hZGluZyBvciBpbiBhbiBpZnJhbWUuDQogICAgLy8gSUUgPiA5IGFuZCBFZGdlIHdpbGwgdGhyb3cgd2hlbiBhY2Nlc3NlZCBpbiBhbiBpZnJhbWUgaWYgZG9jdW1lbnQuYm9keSBpcyB1bmF2YWlsYWJsZS4NCiAgICB2YXIgYWN0aXZlRWxlbWVudDsNCiAgICB0cnkgew0KICAgICAgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQ7DQogICAgfSBjYXRjaChlKSB7DQogICAgICBhY3RpdmVFbGVtZW50ID0gZG9jdW1lbnQuYm9keSB8fCBudWxsOw0KICAgIH0NCiAgICB3aGlsZSAoYWN0aXZlRWxlbWVudCAmJiBhY3RpdmVFbGVtZW50LnNoYWRvd1Jvb3QgJiYgYWN0aXZlRWxlbWVudC5zaGFkb3dSb290LmFjdGl2ZUVsZW1lbnQpDQogICAgICB7IGFjdGl2ZUVsZW1lbnQgPSBhY3RpdmVFbGVtZW50LnNoYWRvd1Jvb3QuYWN0aXZlRWxlbWVudDsgfQ0KICAgIHJldHVybiBhY3RpdmVFbGVtZW50DQogIH0NCg0KICBmdW5jdGlvbiBhZGRDbGFzcyhub2RlLCBjbHMpIHsNCiAgICB2YXIgY3VycmVudCA9IG5vZGUuY2xhc3NOYW1lOw0KICAgIGlmICghY2xhc3NUZXN0KGNscykudGVzdChjdXJyZW50KSkgeyBub2RlLmNsYXNzTmFtZSArPSAoY3VycmVudCA/ICIgIiA6ICIiKSArIGNsczsgfQ0KICB9DQogIGZ1bmN0aW9uIGpvaW5DbGFzc2VzKGEsIGIpIHsNCiAgICB2YXIgYXMgPSBhLnNwbGl0KCIgIik7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcy5sZW5ndGg7IGkrKykNCiAgICAgIHsgaWYgKGFzW2ldICYmICFjbGFzc1Rlc3QoYXNbaV0pLnRlc3QoYikpIHsgYiArPSAiICIgKyBhc1tpXTsgfSB9DQogICAgcmV0dXJuIGINCiAgfQ0KDQogIHZhciBzZWxlY3RJbnB1dCA9IGZ1bmN0aW9uKG5vZGUpIHsgbm9kZS5zZWxlY3QoKTsgfTsNCiAgaWYgKGlvcykgLy8gTW9iaWxlIFNhZmFyaSBhcHBhcmVudGx5IGhhcyBhIGJ1ZyB3aGVyZSBzZWxlY3QoKSBpcyBicm9rZW4uDQogICAgeyBzZWxlY3RJbnB1dCA9IGZ1bmN0aW9uKG5vZGUpIHsgbm9kZS5zZWxlY3Rpb25TdGFydCA9IDA7IG5vZGUuc2VsZWN0aW9uRW5kID0gbm9kZS52YWx1ZS5sZW5ndGg7IH07IH0NCiAgZWxzZSBpZiAoaWUpIC8vIFN1cHByZXNzIG15c3RlcmlvdXMgSUUxMCBlcnJvcnMNCiAgICB7IHNlbGVjdElucHV0ID0gZnVuY3Rpb24obm9kZSkgeyB0cnkgeyBub2RlLnNlbGVjdCgpOyB9IGNhdGNoKF9lKSB7fSB9OyB9DQoNCiAgZnVuY3Rpb24gYmluZChmKSB7DQogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpOw0KICAgIHJldHVybiBmdW5jdGlvbigpe3JldHVybiBmLmFwcGx5KG51bGwsIGFyZ3MpfQ0KICB9DQoNCiAgZnVuY3Rpb24gY29weU9iaihvYmosIHRhcmdldCwgb3ZlcndyaXRlKSB7DQogICAgaWYgKCF0YXJnZXQpIHsgdGFyZ2V0ID0ge307IH0NCiAgICBmb3IgKHZhciBwcm9wIGluIG9iaikNCiAgICAgIHsgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiAob3ZlcndyaXRlICE9PSBmYWxzZSB8fCAhdGFyZ2V0Lmhhc093blByb3BlcnR5KHByb3ApKSkNCiAgICAgICAgeyB0YXJnZXRbcHJvcF0gPSBvYmpbcHJvcF07IH0gfQ0KICAgIHJldHVybiB0YXJnZXQNCiAgfQ0KDQogIC8vIENvdW50cyB0aGUgY29sdW1uIG9mZnNldCBpbiBhIHN0cmluZywgdGFraW5nIHRhYnMgaW50byBhY2NvdW50Lg0KICAvLyBVc2VkIG1vc3RseSB0byBmaW5kIGluZGVudGF0aW9uLg0KICBmdW5jdGlvbiBjb3VudENvbHVtbihzdHJpbmcsIGVuZCwgdGFiU2l6ZSwgc3RhcnRJbmRleCwgc3RhcnRWYWx1ZSkgew0KICAgIGlmIChlbmQgPT0gbnVsbCkgew0KICAgICAgZW5kID0gc3RyaW5nLnNlYXJjaCgvW15cc1x1MDBhMF0vKTsNCiAgICAgIGlmIChlbmQgPT0gLTEpIHsgZW5kID0gc3RyaW5nLmxlbmd0aDsgfQ0KICAgIH0NCiAgICBmb3IgKHZhciBpID0gc3RhcnRJbmRleCB8fCAwLCBuID0gc3RhcnRWYWx1ZSB8fCAwOzspIHsNCiAgICAgIHZhciBuZXh0VGFiID0gc3RyaW5nLmluZGV4T2YoIlx0IiwgaSk7DQogICAgICBpZiAobmV4dFRhYiA8IDAgfHwgbmV4dFRhYiA+PSBlbmQpDQogICAgICAgIHsgcmV0dXJuIG4gKyAoZW5kIC0gaSkgfQ0KICAgICAgbiArPSBuZXh0VGFiIC0gaTsNCiAgICAgIG4gKz0gdGFiU2l6ZSAtIChuICUgdGFiU2l6ZSk7DQogICAgICBpID0gbmV4dFRhYiArIDE7DQogICAgfQ0KICB9DQoNCiAgdmFyIERlbGF5ZWQgPSBmdW5jdGlvbigpIHsNCiAgICB0aGlzLmlkID0gbnVsbDsNCiAgICB0aGlzLmYgPSBudWxsOw0KICAgIHRoaXMudGltZSA9IDA7DQogICAgdGhpcy5oYW5kbGVyID0gYmluZCh0aGlzLm9uVGltZW91dCwgdGhpcyk7DQogIH07DQogIERlbGF5ZWQucHJvdG90eXBlLm9uVGltZW91dCA9IGZ1bmN0aW9uIChzZWxmKSB7DQogICAgc2VsZi5pZCA9IDA7DQogICAgaWYgKHNlbGYudGltZSA8PSArbmV3IERhdGUpIHsNCiAgICAgIHNlbGYuZigpOw0KICAgIH0gZWxzZSB7DQogICAgICBzZXRUaW1lb3V0KHNlbGYuaGFuZGxlciwgc2VsZi50aW1lIC0gK25ldyBEYXRlKTsNCiAgICB9DQogIH07DQogIERlbGF5ZWQucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIChtcywgZikgew0KICAgIHRoaXMuZiA9IGY7DQogICAgdmFyIHRpbWUgPSArbmV3IERhdGUgKyBtczsNCiAgICBpZiAoIXRoaXMuaWQgfHwgdGltZSA8IHRoaXMudGltZSkgew0KICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuaWQpOw0KICAgICAgdGhpcy5pZCA9IHNldFRpbWVvdXQodGhpcy5oYW5kbGVyLCBtcyk7DQogICAgICB0aGlzLnRpbWUgPSB0aW1lOw0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBpbmRleE9mKGFycmF5LCBlbHQpIHsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKQ0KICAgICAgeyBpZiAoYXJyYXlbaV0gPT0gZWx0KSB7IHJldHVybiBpIH0gfQ0KICAgIHJldHVybiAtMQ0KICB9DQoNCiAgLy8gTnVtYmVyIG9mIHBpeGVscyBhZGRlZCB0byBzY3JvbGxlciBhbmQgc2l6ZXIgdG8gaGlkZSBzY3JvbGxiYXINCiAgdmFyIHNjcm9sbGVyR2FwID0gMzA7DQoNCiAgLy8gUmV0dXJuZWQgb3IgdGhyb3duIGJ5IHZhcmlvdXMgcHJvdG9jb2xzIHRvIHNpZ25hbCAnSSdtIG5vdA0KICAvLyBoYW5kbGluZyB0aGlzJy4NCiAgdmFyIFBhc3MgPSB7dG9TdHJpbmc6IGZ1bmN0aW9uKCl7cmV0dXJuICJDb2RlTWlycm9yLlBhc3MifX07DQoNCiAgLy8gUmV1c2VkIG9wdGlvbiBvYmplY3RzIGZvciBzZXRTZWxlY3Rpb24gJiBmcmllbmRzDQogIHZhciBzZWxfZG9udFNjcm9sbCA9IHtzY3JvbGw6IGZhbHNlfSwgc2VsX21vdXNlID0ge29yaWdpbjogIiptb3VzZSJ9LCBzZWxfbW92ZSA9IHtvcmlnaW46ICIrbW92ZSJ9Ow0KDQogIC8vIFRoZSBpbnZlcnNlIG9mIGNvdW50Q29sdW1uIC0tIGZpbmQgdGhlIG9mZnNldCB0aGF0IGNvcnJlc3BvbmRzIHRvDQogIC8vIGEgcGFydGljdWxhciBjb2x1bW4uDQogIGZ1bmN0aW9uIGZpbmRDb2x1bW4oc3RyaW5nLCBnb2FsLCB0YWJTaXplKSB7DQogICAgZm9yICh2YXIgcG9zID0gMCwgY29sID0gMDs7KSB7DQogICAgICB2YXIgbmV4dFRhYiA9IHN0cmluZy5pbmRleE9mKCJcdCIsIHBvcyk7DQogICAgICBpZiAobmV4dFRhYiA9PSAtMSkgeyBuZXh0VGFiID0gc3RyaW5nLmxlbmd0aDsgfQ0KICAgICAgdmFyIHNraXBwZWQgPSBuZXh0VGFiIC0gcG9zOw0KICAgICAgaWYgKG5leHRUYWIgPT0gc3RyaW5nLmxlbmd0aCB8fCBjb2wgKyBza2lwcGVkID49IGdvYWwpDQogICAgICAgIHsgcmV0dXJuIHBvcyArIE1hdGgubWluKHNraXBwZWQsIGdvYWwgLSBjb2wpIH0NCiAgICAgIGNvbCArPSBuZXh0VGFiIC0gcG9zOw0KICAgICAgY29sICs9IHRhYlNpemUgLSAoY29sICUgdGFiU2l6ZSk7DQogICAgICBwb3MgPSBuZXh0VGFiICsgMTsNCiAgICAgIGlmIChjb2wgPj0gZ29hbCkgeyByZXR1cm4gcG9zIH0NCiAgICB9DQogIH0NCg0KICB2YXIgc3BhY2VTdHJzID0gWyIiXTsNCiAgZnVuY3Rpb24gc3BhY2VTdHIobikgew0KICAgIHdoaWxlIChzcGFjZVN0cnMubGVuZ3RoIDw9IG4pDQogICAgICB7IHNwYWNlU3Rycy5wdXNoKGxzdChzcGFjZVN0cnMpICsgIiAiKTsgfQ0KICAgIHJldHVybiBzcGFjZVN0cnNbbl0NCiAgfQ0KDQogIGZ1bmN0aW9uIGxzdChhcnIpIHsgcmV0dXJuIGFyclthcnIubGVuZ3RoLTFdIH0NCg0KICBmdW5jdGlvbiBtYXAoYXJyYXksIGYpIHsNCiAgICB2YXIgb3V0ID0gW107DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheS5sZW5ndGg7IGkrKykgeyBvdXRbaV0gPSBmKGFycmF5W2ldLCBpKTsgfQ0KICAgIHJldHVybiBvdXQNCiAgfQ0KDQogIGZ1bmN0aW9uIGluc2VydFNvcnRlZChhcnJheSwgdmFsdWUsIHNjb3JlKSB7DQogICAgdmFyIHBvcyA9IDAsIHByaW9yaXR5ID0gc2NvcmUodmFsdWUpOw0KICAgIHdoaWxlIChwb3MgPCBhcnJheS5sZW5ndGggJiYgc2NvcmUoYXJyYXlbcG9zXSkgPD0gcHJpb3JpdHkpIHsgcG9zKys7IH0NCiAgICBhcnJheS5zcGxpY2UocG9zLCAwLCB2YWx1ZSk7DQogIH0NCg0KICBmdW5jdGlvbiBub3RoaW5nKCkge30NCg0KICBmdW5jdGlvbiBjcmVhdGVPYmooYmFzZSwgcHJvcHMpIHsNCiAgICB2YXIgaW5zdDsNCiAgICBpZiAoT2JqZWN0LmNyZWF0ZSkgew0KICAgICAgaW5zdCA9IE9iamVjdC5jcmVhdGUoYmFzZSk7DQogICAgfSBlbHNlIHsNCiAgICAgIG5vdGhpbmcucHJvdG90eXBlID0gYmFzZTsNCiAgICAgIGluc3QgPSBuZXcgbm90aGluZygpOw0KICAgIH0NCiAgICBpZiAocHJvcHMpIHsgY29weU9iaihwcm9wcywgaW5zdCk7IH0NCiAgICByZXR1cm4gaW5zdA0KICB9DQoNCiAgdmFyIG5vbkFTQ0lJU2luZ2xlQ2FzZVdvcmRDaGFyID0gL1tcdTAwZGZcdTA1ODdcdTA1OTAtXHUwNWY0XHUwNjAwLVx1MDZmZlx1MzA0MC1cdTMwOWZcdTMwYTAtXHUzMGZmXHUzNDAwLVx1NGRiNVx1NGUwMC1cdTlmY2NcdWFjMDAtXHVkN2FmXS87DQogIGZ1bmN0aW9uIGlzV29yZENoYXJCYXNpYyhjaCkgew0KICAgIHJldHVybiAvXHcvLnRlc3QoY2gpIHx8IGNoID4gIlx4ODAiICYmDQogICAgICAoY2gudG9VcHBlckNhc2UoKSAhPSBjaC50b0xvd2VyQ2FzZSgpIHx8IG5vbkFTQ0lJU2luZ2xlQ2FzZVdvcmRDaGFyLnRlc3QoY2gpKQ0KICB9DQogIGZ1bmN0aW9uIGlzV29yZENoYXIoY2gsIGhlbHBlcikgew0KICAgIGlmICghaGVscGVyKSB7IHJldHVybiBpc1dvcmRDaGFyQmFzaWMoY2gpIH0NCiAgICBpZiAoaGVscGVyLnNvdXJjZS5pbmRleE9mKCJcXHciKSA+IC0xICYmIGlzV29yZENoYXJCYXNpYyhjaCkpIHsgcmV0dXJuIHRydWUgfQ0KICAgIHJldHVybiBoZWxwZXIudGVzdChjaCkNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzRW1wdHkob2JqKSB7DQogICAgZm9yICh2YXIgbiBpbiBvYmopIHsgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShuKSAmJiBvYmpbbl0pIHsgcmV0dXJuIGZhbHNlIH0gfQ0KICAgIHJldHVybiB0cnVlDQogIH0NCg0KICAvLyBFeHRlbmRpbmcgdW5pY29kZSBjaGFyYWN0ZXJzLiBBIHNlcmllcyBvZiBhIG5vbi1leHRlbmRpbmcgY2hhciArDQogIC8vIGFueSBudW1iZXIgb2YgZXh0ZW5kaW5nIGNoYXJzIGlzIHRyZWF0ZWQgYXMgYSBzaW5nbGUgdW5pdCBhcyBmYXINCiAgLy8gYXMgZWRpdGluZyBhbmQgbWVhc3VyaW5nIGlzIGNvbmNlcm5lZC4gVGhpcyBpcyBub3QgZnVsbHkgY29ycmVjdCwNCiAgLy8gc2luY2Ugc29tZSBzY3JpcHRzL2ZvbnRzL2Jyb3dzZXJzIGFsc28gdHJlYXQgb3RoZXIgY29uZmlndXJhdGlvbnMNCiAgLy8gb2YgY29kZSBwb2ludHMgYXMgYSBncm91cC4NCiAgdmFyIGV4dGVuZGluZ0NoYXJzID0gL1tcdTAzMDAtXHUwMzZmXHUwNDgzLVx1MDQ4OVx1MDU5MS1cdTA1YmRcdTA1YmZcdTA1YzFcdTA1YzJcdTA1YzRcdTA1YzVcdTA1YzdcdTA2MTAtXHUwNjFhXHUwNjRiLVx1MDY1ZVx1MDY3MFx1MDZkNi1cdTA2ZGNcdTA2ZGUtXHUwNmU0XHUwNmU3XHUwNmU4XHUwNmVhLVx1MDZlZFx1MDcxMVx1MDczMC1cdTA3NGFcdTA3YTYtXHUwN2IwXHUwN2ViLVx1MDdmM1x1MDgxNi1cdTA4MTlcdTA4MWItXHUwODIzXHUwODI1LVx1MDgyN1x1MDgyOS1cdTA4MmRcdTA5MDAtXHUwOTAyXHUwOTNjXHUwOTQxLVx1MDk0OFx1MDk0ZFx1MDk1MS1cdTA5NTVcdTA5NjJcdTA5NjNcdTA5ODFcdTA5YmNcdTA5YmVcdTA5YzEtXHUwOWM0XHUwOWNkXHUwOWQ3XHUwOWUyXHUwOWUzXHUwYTAxXHUwYTAyXHUwYTNjXHUwYTQxXHUwYTQyXHUwYTQ3XHUwYTQ4XHUwYTRiLVx1MGE0ZFx1MGE1MVx1MGE3MFx1MGE3MVx1MGE3NVx1MGE4MVx1MGE4Mlx1MGFiY1x1MGFjMS1cdTBhYzVcdTBhYzdcdTBhYzhcdTBhY2RcdTBhZTJcdTBhZTNcdTBiMDFcdTBiM2NcdTBiM2VcdTBiM2ZcdTBiNDEtXHUwYjQ0XHUwYjRkXHUwYjU2XHUwYjU3XHUwYjYyXHUwYjYzXHUwYjgyXHUwYmJlXHUwYmMwXHUwYmNkXHUwYmQ3XHUwYzNlLVx1MGM0MFx1MGM0Ni1cdTBjNDhcdTBjNGEtXHUwYzRkXHUwYzU1XHUwYzU2XHUwYzYyXHUwYzYzXHUwY2JjXHUwY2JmXHUwY2MyXHUwY2M2XHUwY2NjXHUwY2NkXHUwY2Q1XHUwY2Q2XHUwY2UyXHUwY2UzXHUwZDNlXHUwZDQxLVx1MGQ0NFx1MGQ0ZFx1MGQ1N1x1MGQ2Mlx1MGQ2M1x1MGRjYVx1MGRjZlx1MGRkMi1cdTBkZDRcdTBkZDZcdTBkZGZcdTBlMzFcdTBlMzQtXHUwZTNhXHUwZTQ3LVx1MGU0ZVx1MGViMVx1MGViNC1cdTBlYjlcdTBlYmJcdTBlYmNcdTBlYzgtXHUwZWNkXHUwZjE4XHUwZjE5XHUwZjM1XHUwZjM3XHUwZjM5XHUwZjcxLVx1MGY3ZVx1MGY4MC1cdTBmODRcdTBmODZcdTBmODdcdTBmOTAtXHUwZjk3XHUwZjk5LVx1MGZiY1x1MGZjNlx1MTAyZC1cdTEwMzBcdTEwMzItXHUxMDM3XHUxMDM5XHUxMDNhXHUxMDNkXHUxMDNlXHUxMDU4XHUxMDU5XHUxMDVlLVx1MTA2MFx1MTA3MS1cdTEwNzRcdTEwODJcdTEwODVcdTEwODZcdTEwOGRcdTEwOWRcdTEzNWZcdTE3MTItXHUxNzE0XHUxNzMyLVx1MTczNFx1MTc1Mlx1MTc1M1x1MTc3Mlx1MTc3M1x1MTdiNy1cdTE3YmRcdTE3YzZcdTE3YzktXHUxN2QzXHUxN2RkXHUxODBiLVx1MTgwZFx1MThhOVx1MTkyMC1cdTE5MjJcdTE5MjdcdTE5MjhcdTE5MzJcdTE5MzktXHUxOTNiXHUxYTE3XHUxYTE4XHUxYTU2XHUxYTU4LVx1MWE1ZVx1MWE2MFx1MWE2Mlx1MWE2NS1cdTFhNmNcdTFhNzMtXHUxYTdjXHUxYTdmXHUxYjAwLVx1MWIwM1x1MWIzNFx1MWIzNi1cdTFiM2FcdTFiM2NcdTFiNDJcdTFiNmItXHUxYjczXHUxYjgwXHUxYjgxXHUxYmEyLVx1MWJhNVx1MWJhOFx1MWJhOVx1MWMyYy1cdTFjMzNcdTFjMzZcdTFjMzdcdTFjZDAtXHUxY2QyXHUxY2Q0LVx1MWNlMFx1MWNlMi1cdTFjZThcdTFjZWRcdTFkYzAtXHUxZGU2XHUxZGZkLVx1MWRmZlx1MjAwY1x1MjAwZFx1MjBkMC1cdTIwZjBcdTJjZWYtXHUyY2YxXHUyZGUwLVx1MmRmZlx1MzAyYS1cdTMwMmZcdTMwOTlcdTMwOWFcdWE2NmYtXHVhNjcyXHVhNjdjXHVhNjdkXHVhNmYwXHVhNmYxXHVhODAyXHVhODA2XHVhODBiXHVhODI1XHVhODI2XHVhOGM0XHVhOGUwLVx1YThmMVx1YTkyNi1cdWE5MmRcdWE5NDctXHVhOTUxXHVhOTgwLVx1YTk4Mlx1YTliM1x1YTliNi1cdWE5YjlcdWE5YmNcdWFhMjktXHVhYTJlXHVhYTMxXHVhYTMyXHVhYTM1XHVhYTM2XHVhYTQzXHVhYTRjXHVhYWIwXHVhYWIyLVx1YWFiNFx1YWFiN1x1YWFiOFx1YWFiZVx1YWFiZlx1YWFjMVx1YWJlNVx1YWJlOFx1YWJlZFx1ZGMwMC1cdWRmZmZcdWZiMWVcdWZlMDAtXHVmZTBmXHVmZTIwLVx1ZmUyNlx1ZmY5ZVx1ZmY5Zl0vOw0KICBmdW5jdGlvbiBpc0V4dGVuZGluZ0NoYXIoY2gpIHsgcmV0dXJuIGNoLmNoYXJDb2RlQXQoMCkgPj0gNzY4ICYmIGV4dGVuZGluZ0NoYXJzLnRlc3QoY2gpIH0NCg0KICAvLyBSZXR1cm5zIGEgbnVtYmVyIGZyb20gdGhlIHJhbmdlIFtgMGA7IGBzdHIubGVuZ3RoYF0gdW5sZXNzIGBwb3NgIGlzIG91dHNpZGUgdGhhdCByYW5nZS4NCiAgZnVuY3Rpb24gc2tpcEV4dGVuZGluZ0NoYXJzKHN0ciwgcG9zLCBkaXIpIHsNCiAgICB3aGlsZSAoKGRpciA8IDAgPyBwb3MgPiAwIDogcG9zIDwgc3RyLmxlbmd0aCkgJiYgaXNFeHRlbmRpbmdDaGFyKHN0ci5jaGFyQXQocG9zKSkpIHsgcG9zICs9IGRpcjsgfQ0KICAgIHJldHVybiBwb3MNCiAgfQ0KDQogIC8vIFJldHVybnMgdGhlIHZhbHVlIGZyb20gdGhlIHJhbmdlIFtgZnJvbWA7IGB0b2BdIHRoYXQgc2F0aXNmaWVzDQogIC8vIGBwcmVkYCBhbmQgaXMgY2xvc2VzdCB0byBgZnJvbWAuIEFzc3VtZXMgdGhhdCBhdCBsZWFzdCBgdG9gDQogIC8vIHNhdGlzZmllcyBgcHJlZGAuIFN1cHBvcnRzIGBmcm9tYCBiZWluZyBncmVhdGVyIHRoYW4gYHRvYC4NCiAgZnVuY3Rpb24gZmluZEZpcnN0KHByZWQsIGZyb20sIHRvKSB7DQogICAgLy8gQXQgYW55IHBvaW50IHdlIGFyZSBjZXJ0YWluIGB0b2Agc2F0aXNmaWVzIGBwcmVkYCwgZG9uJ3Qga25vdw0KICAgIC8vIHdoZXRoZXIgYGZyb21gIGRvZXMuDQogICAgdmFyIGRpciA9IGZyb20gPiB0byA/IC0xIDogMTsNCiAgICBmb3IgKDs7KSB7DQogICAgICBpZiAoZnJvbSA9PSB0bykgeyByZXR1cm4gZnJvbSB9DQogICAgICB2YXIgbWlkRiA9IChmcm9tICsgdG8pIC8gMiwgbWlkID0gZGlyIDwgMCA/IE1hdGguY2VpbChtaWRGKSA6IE1hdGguZmxvb3IobWlkRik7DQogICAgICBpZiAobWlkID09IGZyb20pIHsgcmV0dXJuIHByZWQobWlkKSA/IGZyb20gOiB0byB9DQogICAgICBpZiAocHJlZChtaWQpKSB7IHRvID0gbWlkOyB9DQogICAgICBlbHNlIHsgZnJvbSA9IG1pZCArIGRpcjsgfQ0KICAgIH0NCiAgfQ0KDQogIC8vIEJJREkgSEVMUEVSUw0KDQogIGZ1bmN0aW9uIGl0ZXJhdGVCaWRpU2VjdGlvbnMob3JkZXIsIGZyb20sIHRvLCBmKSB7DQogICAgaWYgKCFvcmRlcikgeyByZXR1cm4gZihmcm9tLCB0bywgImx0ciIsIDApIH0NCiAgICB2YXIgZm91bmQgPSBmYWxzZTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgcGFydCA9IG9yZGVyW2ldOw0KICAgICAgaWYgKHBhcnQuZnJvbSA8IHRvICYmIHBhcnQudG8gPiBmcm9tIHx8IGZyb20gPT0gdG8gJiYgcGFydC50byA9PSBmcm9tKSB7DQogICAgICAgIGYoTWF0aC5tYXgocGFydC5mcm9tLCBmcm9tKSwgTWF0aC5taW4ocGFydC50bywgdG8pLCBwYXJ0LmxldmVsID09IDEgPyAicnRsIiA6ICJsdHIiLCBpKTsNCiAgICAgICAgZm91bmQgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0NCiAgICBpZiAoIWZvdW5kKSB7IGYoZnJvbSwgdG8sICJsdHIiKTsgfQ0KICB9DQoNCiAgdmFyIGJpZGlPdGhlciA9IG51bGw7DQogIGZ1bmN0aW9uIGdldEJpZGlQYXJ0QXQob3JkZXIsIGNoLCBzdGlja3kpIHsNCiAgICB2YXIgZm91bmQ7DQogICAgYmlkaU90aGVyID0gbnVsbDsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgY3VyID0gb3JkZXJbaV07DQogICAgICBpZiAoY3VyLmZyb20gPCBjaCAmJiBjdXIudG8gPiBjaCkgeyByZXR1cm4gaSB9DQogICAgICBpZiAoY3VyLnRvID09IGNoKSB7DQogICAgICAgIGlmIChjdXIuZnJvbSAhPSBjdXIudG8gJiYgc3RpY2t5ID09ICJiZWZvcmUiKSB7IGZvdW5kID0gaTsgfQ0KICAgICAgICBlbHNlIHsgYmlkaU90aGVyID0gaTsgfQ0KICAgICAgfQ0KICAgICAgaWYgKGN1ci5mcm9tID09IGNoKSB7DQogICAgICAgIGlmIChjdXIuZnJvbSAhPSBjdXIudG8gJiYgc3RpY2t5ICE9ICJiZWZvcmUiKSB7IGZvdW5kID0gaTsgfQ0KICAgICAgICBlbHNlIHsgYmlkaU90aGVyID0gaTsgfQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gZm91bmQgIT0gbnVsbCA/IGZvdW5kIDogYmlkaU90aGVyDQogIH0NCg0KICAvLyBCaWRpcmVjdGlvbmFsIG9yZGVyaW5nIGFsZ29yaXRobQ0KICAvLyBTZWUgaHR0cDovL3VuaWNvZGUub3JnL3JlcG9ydHMvdHI5L3RyOS0xMy5odG1sIGZvciB0aGUgYWxnb3JpdGhtDQogIC8vIHRoYXQgdGhpcyAocGFydGlhbGx5KSBpbXBsZW1lbnRzLg0KDQogIC8vIE9uZS1jaGFyIGNvZGVzIHVzZWQgZm9yIGNoYXJhY3RlciB0eXBlczoNCiAgLy8gTCAoTCk6ICAgTGVmdC10by1SaWdodA0KICAvLyBSIChSKTogICBSaWdodC10by1MZWZ0DQogIC8vIHIgKEFMKTogIFJpZ2h0LXRvLUxlZnQgQXJhYmljDQogIC8vIDEgKEVOKTogIEV1cm9wZWFuIE51bWJlcg0KICAvLyArIChFUyk6ICBFdXJvcGVhbiBOdW1iZXIgU2VwYXJhdG9yDQogIC8vICUgKEVUKTogIEV1cm9wZWFuIE51bWJlciBUZXJtaW5hdG9yDQogIC8vIG4gKEFOKTogIEFyYWJpYyBOdW1iZXINCiAgLy8gLCAoQ1MpOiAgQ29tbW9uIE51bWJlciBTZXBhcmF0b3INCiAgLy8gbSAoTlNNKTogTm9uLVNwYWNpbmcgTWFyaw0KICAvLyBiIChCTik6ICBCb3VuZGFyeSBOZXV0cmFsDQogIC8vIHMgKEIpOiAgIFBhcmFncmFwaCBTZXBhcmF0b3INCiAgLy8gdCAoUyk6ICAgU2VnbWVudCBTZXBhcmF0b3INCiAgLy8gdyAoV1MpOiAgV2hpdGVzcGFjZQ0KICAvLyBOIChPTik6ICBPdGhlciBOZXV0cmFscw0KDQogIC8vIFJldHVybnMgbnVsbCBpZiBjaGFyYWN0ZXJzIGFyZSBvcmRlcmVkIGFzIHRoZXkgYXBwZWFyDQogIC8vIChsZWZ0LXRvLXJpZ2h0KSwgb3IgYW4gYXJyYXkgb2Ygc2VjdGlvbnMgKHtmcm9tLCB0bywgbGV2ZWx9DQogIC8vIG9iamVjdHMpIGluIHRoZSBvcmRlciBpbiB3aGljaCB0aGV5IG9jY3VyIHZpc3VhbGx5Lg0KICB2YXIgYmlkaU9yZGVyaW5nID0gKGZ1bmN0aW9uKCkgew0KICAgIC8vIENoYXJhY3RlciB0eXBlcyBmb3IgY29kZXBvaW50cyAwIHRvIDB4ZmYNCiAgICB2YXIgbG93VHlwZXMgPSAiYmJiYmJiYmJidHN0d3NiYmJiYmJiYmJiYmJiYnNzc3R3Tk4lJSVOTk5OTk4sTixOMTExMTExMTExMU5OTk5OTk5MTExMTExMTExMTExMTExMTExMTExMTExMTE5OTk5OTkxMTExMTExMTExMTExMTExMTExMTExMTExMTk5OTmJiYmJiYnNiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYixOJSUlJU5OTk5MTk5OTk4lJTExTkxOTk4xTE5OTk5OTExMTExMTExMTExMTExMTExMTExMTExOTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTE4iOw0KICAgIC8vIENoYXJhY3RlciB0eXBlcyBmb3IgY29kZXBvaW50cyAweDYwMCB0byAweDZmOQ0KICAgIHZhciBhcmFiaWNUeXBlcyA9ICJubm5ubm5OTnIlJXIsck5ObW1tbW1tbW1tbW1ycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJtbW1tbW1tbW1tbW1tbW1tbW1tbW1ubm5ubm5ubm5uJW5ucnJybXJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJybW1tbW1tbW5ObW1tbW1tcnJtbU5tbW1tcnIxMTExMTExMTExIjsNCiAgICBmdW5jdGlvbiBjaGFyVHlwZShjb2RlKSB7DQogICAgICBpZiAoY29kZSA8PSAweGY3KSB7IHJldHVybiBsb3dUeXBlcy5jaGFyQXQoY29kZSkgfQ0KICAgICAgZWxzZSBpZiAoMHg1OTAgPD0gY29kZSAmJiBjb2RlIDw9IDB4NWY0KSB7IHJldHVybiAiUiIgfQ0KICAgICAgZWxzZSBpZiAoMHg2MDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4NmY5KSB7IHJldHVybiBhcmFiaWNUeXBlcy5jaGFyQXQoY29kZSAtIDB4NjAwKSB9DQogICAgICBlbHNlIGlmICgweDZlZSA8PSBjb2RlICYmIGNvZGUgPD0gMHg4YWMpIHsgcmV0dXJuICJyIiB9DQogICAgICBlbHNlIGlmICgweDIwMDAgPD0gY29kZSAmJiBjb2RlIDw9IDB4MjAwYikgeyByZXR1cm4gInciIH0NCiAgICAgIGVsc2UgaWYgKGNvZGUgPT0gMHgyMDBjKSB7IHJldHVybiAiYiIgfQ0KICAgICAgZWxzZSB7IHJldHVybiAiTCIgfQ0KICAgIH0NCg0KICAgIHZhciBiaWRpUkUgPSAvW1x1MDU5MC1cdTA1ZjRcdTA2MDAtXHUwNmZmXHUwNzAwLVx1MDhhY10vOw0KICAgIHZhciBpc05ldXRyYWwgPSAvW3N0d05dLywgaXNTdHJvbmcgPSAvW0xScl0vLCBjb3VudHNBc0xlZnQgPSAvW0xiMW5dLywgY291bnRzQXNOdW0gPSAvWzFuXS87DQoNCiAgICBmdW5jdGlvbiBCaWRpU3BhbihsZXZlbCwgZnJvbSwgdG8pIHsNCiAgICAgIHRoaXMubGV2ZWwgPSBsZXZlbDsNCiAgICAgIHRoaXMuZnJvbSA9IGZyb207IHRoaXMudG8gPSB0bzsNCiAgICB9DQoNCiAgICByZXR1cm4gZnVuY3Rpb24oc3RyLCBkaXJlY3Rpb24pIHsNCiAgICAgIHZhciBvdXRlclR5cGUgPSBkaXJlY3Rpb24gPT0gImx0ciIgPyAiTCIgOiAiUiI7DQoNCiAgICAgIGlmIChzdHIubGVuZ3RoID09IDAgfHwgZGlyZWN0aW9uID09ICJsdHIiICYmICFiaWRpUkUudGVzdChzdHIpKSB7IHJldHVybiBmYWxzZSB9DQogICAgICB2YXIgbGVuID0gc3RyLmxlbmd0aCwgdHlwZXMgPSBbXTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuOyArK2kpDQogICAgICAgIHsgdHlwZXMucHVzaChjaGFyVHlwZShzdHIuY2hhckNvZGVBdChpKSkpOyB9DQoNCiAgICAgIC8vIFcxLiBFeGFtaW5lIGVhY2ggbm9uLXNwYWNpbmcgbWFyayAoTlNNKSBpbiB0aGUgbGV2ZWwgcnVuLCBhbmQNCiAgICAgIC8vIGNoYW5nZSB0aGUgdHlwZSBvZiB0aGUgTlNNIHRvIHRoZSB0eXBlIG9mIHRoZSBwcmV2aW91cw0KICAgICAgLy8gY2hhcmFjdGVyLiBJZiB0aGUgTlNNIGlzIGF0IHRoZSBzdGFydCBvZiB0aGUgbGV2ZWwgcnVuLCBpdCB3aWxsDQogICAgICAvLyBnZXQgdGhlIHR5cGUgb2Ygc29yLg0KICAgICAgZm9yICh2YXIgaSQxID0gMCwgcHJldiA9IG91dGVyVHlwZTsgaSQxIDwgbGVuOyArK2kkMSkgew0KICAgICAgICB2YXIgdHlwZSA9IHR5cGVzW2kkMV07DQogICAgICAgIGlmICh0eXBlID09ICJtIikgeyB0eXBlc1tpJDFdID0gcHJldjsgfQ0KICAgICAgICBlbHNlIHsgcHJldiA9IHR5cGU7IH0NCiAgICAgIH0NCg0KICAgICAgLy8gVzIuIFNlYXJjaCBiYWNrd2FyZHMgZnJvbSBlYWNoIGluc3RhbmNlIG9mIGEgRXVyb3BlYW4gbnVtYmVyDQogICAgICAvLyB1bnRpbCB0aGUgZmlyc3Qgc3Ryb25nIHR5cGUgKFIsIEwsIEFMLCBvciBzb3IpIGlzIGZvdW5kLiBJZiBhbg0KICAgICAgLy8gQUwgaXMgZm91bmQsIGNoYW5nZSB0aGUgdHlwZSBvZiB0aGUgRXVyb3BlYW4gbnVtYmVyIHRvIEFyYWJpYw0KICAgICAgLy8gbnVtYmVyLg0KICAgICAgLy8gVzMuIENoYW5nZSBhbGwgQUxzIHRvIFIuDQogICAgICBmb3IgKHZhciBpJDIgPSAwLCBjdXIgPSBvdXRlclR5cGU7IGkkMiA8IGxlbjsgKytpJDIpIHsNCiAgICAgICAgdmFyIHR5cGUkMSA9IHR5cGVzW2kkMl07DQogICAgICAgIGlmICh0eXBlJDEgPT0gIjEiICYmIGN1ciA9PSAiciIpIHsgdHlwZXNbaSQyXSA9ICJuIjsgfQ0KICAgICAgICBlbHNlIGlmIChpc1N0cm9uZy50ZXN0KHR5cGUkMSkpIHsgY3VyID0gdHlwZSQxOyBpZiAodHlwZSQxID09ICJyIikgeyB0eXBlc1tpJDJdID0gIlIiOyB9IH0NCiAgICAgIH0NCg0KICAgICAgLy8gVzQuIEEgc2luZ2xlIEV1cm9wZWFuIHNlcGFyYXRvciBiZXR3ZWVuIHR3byBFdXJvcGVhbiBudW1iZXJzDQogICAgICAvLyBjaGFuZ2VzIHRvIGEgRXVyb3BlYW4gbnVtYmVyLiBBIHNpbmdsZSBjb21tb24gc2VwYXJhdG9yIGJldHdlZW4NCiAgICAgIC8vIHR3byBudW1iZXJzIG9mIHRoZSBzYW1lIHR5cGUgY2hhbmdlcyB0byB0aGF0IHR5cGUuDQogICAgICBmb3IgKHZhciBpJDMgPSAxLCBwcmV2JDEgPSB0eXBlc1swXTsgaSQzIDwgbGVuIC0gMTsgKytpJDMpIHsNCiAgICAgICAgdmFyIHR5cGUkMiA9IHR5cGVzW2kkM107DQogICAgICAgIGlmICh0eXBlJDIgPT0gIisiICYmIHByZXYkMSA9PSAiMSIgJiYgdHlwZXNbaSQzKzFdID09ICIxIikgeyB0eXBlc1tpJDNdID0gIjEiOyB9DQogICAgICAgIGVsc2UgaWYgKHR5cGUkMiA9PSAiLCIgJiYgcHJldiQxID09IHR5cGVzW2kkMysxXSAmJg0KICAgICAgICAgICAgICAgICAocHJldiQxID09ICIxIiB8fCBwcmV2JDEgPT0gIm4iKSkgeyB0eXBlc1tpJDNdID0gcHJldiQxOyB9DQogICAgICAgIHByZXYkMSA9IHR5cGUkMjsNCiAgICAgIH0NCg0KICAgICAgLy8gVzUuIEEgc2VxdWVuY2Ugb2YgRXVyb3BlYW4gdGVybWluYXRvcnMgYWRqYWNlbnQgdG8gRXVyb3BlYW4NCiAgICAgIC8vIG51bWJlcnMgY2hhbmdlcyB0byBhbGwgRXVyb3BlYW4gbnVtYmVycy4NCiAgICAgIC8vIFc2LiBPdGhlcndpc2UsIHNlcGFyYXRvcnMgYW5kIHRlcm1pbmF0b3JzIGNoYW5nZSB0byBPdGhlcg0KICAgICAgLy8gTmV1dHJhbC4NCiAgICAgIGZvciAodmFyIGkkNCA9IDA7IGkkNCA8IGxlbjsgKytpJDQpIHsNCiAgICAgICAgdmFyIHR5cGUkMyA9IHR5cGVzW2kkNF07DQogICAgICAgIGlmICh0eXBlJDMgPT0gIiwiKSB7IHR5cGVzW2kkNF0gPSAiTiI7IH0NCiAgICAgICAgZWxzZSBpZiAodHlwZSQzID09ICIlIikgew0KICAgICAgICAgIHZhciBlbmQgPSAodm9pZCAwKTsNCiAgICAgICAgICBmb3IgKGVuZCA9IGkkNCArIDE7IGVuZCA8IGxlbiAmJiB0eXBlc1tlbmRdID09ICIlIjsgKytlbmQpIHt9DQogICAgICAgICAgdmFyIHJlcGxhY2UgPSAoaSQ0ICYmIHR5cGVzW2kkNC0xXSA9PSAiISIpIHx8IChlbmQgPCBsZW4gJiYgdHlwZXNbZW5kXSA9PSAiMSIpID8gIjEiIDogIk4iOw0KICAgICAgICAgIGZvciAodmFyIGogPSBpJDQ7IGogPCBlbmQ7ICsraikgeyB0eXBlc1tqXSA9IHJlcGxhY2U7IH0NCiAgICAgICAgICBpJDQgPSBlbmQgLSAxOw0KICAgICAgICB9DQogICAgICB9DQoNCiAgICAgIC8vIFc3LiBTZWFyY2ggYmFja3dhcmRzIGZyb20gZWFjaCBpbnN0YW5jZSBvZiBhIEV1cm9wZWFuIG51bWJlcg0KICAgICAgLy8gdW50aWwgdGhlIGZpcnN0IHN0cm9uZyB0eXBlIChSLCBMLCBvciBzb3IpIGlzIGZvdW5kLiBJZiBhbiBMIGlzDQogICAgICAvLyBmb3VuZCwgdGhlbiBjaGFuZ2UgdGhlIHR5cGUgb2YgdGhlIEV1cm9wZWFuIG51bWJlciB0byBMLg0KICAgICAgZm9yICh2YXIgaSQ1ID0gMCwgY3VyJDEgPSBvdXRlclR5cGU7IGkkNSA8IGxlbjsgKytpJDUpIHsNCiAgICAgICAgdmFyIHR5cGUkNCA9IHR5cGVzW2kkNV07DQogICAgICAgIGlmIChjdXIkMSA9PSAiTCIgJiYgdHlwZSQ0ID09ICIxIikgeyB0eXBlc1tpJDVdID0gIkwiOyB9DQogICAgICAgIGVsc2UgaWYgKGlzU3Ryb25nLnRlc3QodHlwZSQ0KSkgeyBjdXIkMSA9IHR5cGUkNDsgfQ0KICAgICAgfQ0KDQogICAgICAvLyBOMS4gQSBzZXF1ZW5jZSBvZiBuZXV0cmFscyB0YWtlcyB0aGUgZGlyZWN0aW9uIG9mIHRoZQ0KICAgICAgLy8gc3Vycm91bmRpbmcgc3Ryb25nIHRleHQgaWYgdGhlIHRleHQgb24gYm90aCBzaWRlcyBoYXMgdGhlIHNhbWUNCiAgICAgIC8vIGRpcmVjdGlvbi4gRXVyb3BlYW4gYW5kIEFyYWJpYyBudW1iZXJzIGFjdCBhcyBpZiB0aGV5IHdlcmUgUiBpbg0KICAgICAgLy8gdGVybXMgb2YgdGhlaXIgaW5mbHVlbmNlIG9uIG5ldXRyYWxzLiBTdGFydC1vZi1sZXZlbC1ydW4gKHNvcikNCiAgICAgIC8vIGFuZCBlbmQtb2YtbGV2ZWwtcnVuIChlb3IpIGFyZSB1c2VkIGF0IGxldmVsIHJ1biBib3VuZGFyaWVzLg0KICAgICAgLy8gTjIuIEFueSByZW1haW5pbmcgbmV1dHJhbHMgdGFrZSB0aGUgZW1iZWRkaW5nIGRpcmVjdGlvbi4NCiAgICAgIGZvciAodmFyIGkkNiA9IDA7IGkkNiA8IGxlbjsgKytpJDYpIHsNCiAgICAgICAgaWYgKGlzTmV1dHJhbC50ZXN0KHR5cGVzW2kkNl0pKSB7DQogICAgICAgICAgdmFyIGVuZCQxID0gKHZvaWQgMCk7DQogICAgICAgICAgZm9yIChlbmQkMSA9IGkkNiArIDE7IGVuZCQxIDwgbGVuICYmIGlzTmV1dHJhbC50ZXN0KHR5cGVzW2VuZCQxXSk7ICsrZW5kJDEpIHt9DQogICAgICAgICAgdmFyIGJlZm9yZSA9IChpJDYgPyB0eXBlc1tpJDYtMV0gOiBvdXRlclR5cGUpID09ICJMIjsNCiAgICAgICAgICB2YXIgYWZ0ZXIgPSAoZW5kJDEgPCBsZW4gPyB0eXBlc1tlbmQkMV0gOiBvdXRlclR5cGUpID09ICJMIjsNCiAgICAgICAgICB2YXIgcmVwbGFjZSQxID0gYmVmb3JlID09IGFmdGVyID8gKGJlZm9yZSA/ICJMIiA6ICJSIikgOiBvdXRlclR5cGU7DQogICAgICAgICAgZm9yICh2YXIgaiQxID0gaSQ2OyBqJDEgPCBlbmQkMTsgKytqJDEpIHsgdHlwZXNbaiQxXSA9IHJlcGxhY2UkMTsgfQ0KICAgICAgICAgIGkkNiA9IGVuZCQxIC0gMTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICAvLyBIZXJlIHdlIGRlcGFydCBmcm9tIHRoZSBkb2N1bWVudGVkIGFsZ29yaXRobSwgaW4gb3JkZXIgdG8gYXZvaWQNCiAgICAgIC8vIGJ1aWxkaW5nIHVwIGFuIGFjdHVhbCBsZXZlbHMgYXJyYXkuIFNpbmNlIHRoZXJlIGFyZSBvbmx5IHRocmVlDQogICAgICAvLyBsZXZlbHMgKDAsIDEsIDIpIGluIGFuIGltcGxlbWVudGF0aW9uIHRoYXQgZG9lc24ndCB0YWtlDQogICAgICAvLyBleHBsaWNpdCBlbWJlZGRpbmcgaW50byBhY2NvdW50LCB3ZSBjYW4gYnVpbGQgdXAgdGhlIG9yZGVyIG9uDQogICAgICAvLyB0aGUgZmx5LCB3aXRob3V0IGZvbGxvd2luZyB0aGUgbGV2ZWwtYmFzZWQgYWxnb3JpdGhtLg0KICAgICAgdmFyIG9yZGVyID0gW10sIG07DQogICAgICBmb3IgKHZhciBpJDcgPSAwOyBpJDcgPCBsZW47KSB7DQogICAgICAgIGlmIChjb3VudHNBc0xlZnQudGVzdCh0eXBlc1tpJDddKSkgew0KICAgICAgICAgIHZhciBzdGFydCA9IGkkNzsNCiAgICAgICAgICBmb3IgKCsraSQ3OyBpJDcgPCBsZW4gJiYgY291bnRzQXNMZWZ0LnRlc3QodHlwZXNbaSQ3XSk7ICsraSQ3KSB7fQ0KICAgICAgICAgIG9yZGVyLnB1c2gobmV3IEJpZGlTcGFuKDAsIHN0YXJ0LCBpJDcpKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICB2YXIgcG9zID0gaSQ3LCBhdCA9IG9yZGVyLmxlbmd0aCwgaXNSVEwgPSBkaXJlY3Rpb24gPT0gInJ0bCIgPyAxIDogMDsNCiAgICAgICAgICBmb3IgKCsraSQ3OyBpJDcgPCBsZW4gJiYgdHlwZXNbaSQ3XSAhPSAiTCI7ICsraSQ3KSB7fQ0KICAgICAgICAgIGZvciAodmFyIGokMiA9IHBvczsgaiQyIDwgaSQ3Oykgew0KICAgICAgICAgICAgaWYgKGNvdW50c0FzTnVtLnRlc3QodHlwZXNbaiQyXSkpIHsNCiAgICAgICAgICAgICAgaWYgKHBvcyA8IGokMikgeyBvcmRlci5zcGxpY2UoYXQsIDAsIG5ldyBCaWRpU3BhbigxLCBwb3MsIGokMikpOyBhdCArPSBpc1JUTDsgfQ0KICAgICAgICAgICAgICB2YXIgbnN0YXJ0ID0gaiQyOw0KICAgICAgICAgICAgICBmb3IgKCsraiQyOyBqJDIgPCBpJDcgJiYgY291bnRzQXNOdW0udGVzdCh0eXBlc1tqJDJdKTsgKytqJDIpIHt9DQogICAgICAgICAgICAgIG9yZGVyLnNwbGljZShhdCwgMCwgbmV3IEJpZGlTcGFuKDIsIG5zdGFydCwgaiQyKSk7DQogICAgICAgICAgICAgIGF0ICs9IGlzUlRMOw0KICAgICAgICAgICAgICBwb3MgPSBqJDI7DQogICAgICAgICAgICB9IGVsc2UgeyArK2okMjsgfQ0KICAgICAgICAgIH0NCiAgICAgICAgICBpZiAocG9zIDwgaSQ3KSB7IG9yZGVyLnNwbGljZShhdCwgMCwgbmV3IEJpZGlTcGFuKDEsIHBvcywgaSQ3KSk7IH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGRpcmVjdGlvbiA9PSAibHRyIikgew0KICAgICAgICBpZiAob3JkZXJbMF0ubGV2ZWwgPT0gMSAmJiAobSA9IHN0ci5tYXRjaCgvXlxzKy8pKSkgew0KICAgICAgICAgIG9yZGVyWzBdLmZyb20gPSBtWzBdLmxlbmd0aDsNCiAgICAgICAgICBvcmRlci51bnNoaWZ0KG5ldyBCaWRpU3BhbigwLCAwLCBtWzBdLmxlbmd0aCkpOw0KICAgICAgICB9DQogICAgICAgIGlmIChsc3Qob3JkZXIpLmxldmVsID09IDEgJiYgKG0gPSBzdHIubWF0Y2goL1xzKyQvKSkpIHsNCiAgICAgICAgICBsc3Qob3JkZXIpLnRvIC09IG1bMF0ubGVuZ3RoOw0KICAgICAgICAgIG9yZGVyLnB1c2gobmV3IEJpZGlTcGFuKDAsIGxlbiAtIG1bMF0ubGVuZ3RoLCBsZW4pKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KDQogICAgICByZXR1cm4gZGlyZWN0aW9uID09ICJydGwiID8gb3JkZXIucmV2ZXJzZSgpIDogb3JkZXINCiAgICB9DQogIH0pKCk7DQoNCiAgLy8gR2V0IHRoZSBiaWRpIG9yZGVyaW5nIGZvciB0aGUgZ2l2ZW4gbGluZSAoYW5kIGNhY2hlIGl0KS4gUmV0dXJucw0KICAvLyBmYWxzZSBmb3IgbGluZXMgdGhhdCBhcmUgZnVsbHkgbGVmdC10by1yaWdodCwgYW5kIGFuIGFycmF5IG9mDQogIC8vIEJpZGlTcGFuIG9iamVjdHMgb3RoZXJ3aXNlLg0KICBmdW5jdGlvbiBnZXRPcmRlcihsaW5lLCBkaXJlY3Rpb24pIHsNCiAgICB2YXIgb3JkZXIgPSBsaW5lLm9yZGVyOw0KICAgIGlmIChvcmRlciA9PSBudWxsKSB7IG9yZGVyID0gbGluZS5vcmRlciA9IGJpZGlPcmRlcmluZyhsaW5lLnRleHQsIGRpcmVjdGlvbik7IH0NCiAgICByZXR1cm4gb3JkZXINCiAgfQ0KDQogIC8vIEVWRU5UIEhBTkRMSU5HDQoNCiAgLy8gTGlnaHR3ZWlnaHQgZXZlbnQgZnJhbWV3b3JrLiBvbi9vZmYgYWxzbyB3b3JrIG9uIERPTSBub2RlcywNCiAgLy8gcmVnaXN0ZXJpbmcgbmF0aXZlIERPTSBoYW5kbGVycy4NCg0KICB2YXIgbm9IYW5kbGVycyA9IFtdOw0KDQogIHZhciBvbiA9IGZ1bmN0aW9uKGVtaXR0ZXIsIHR5cGUsIGYpIHsNCiAgICBpZiAoZW1pdHRlci5hZGRFdmVudExpc3RlbmVyKSB7DQogICAgICBlbWl0dGVyLmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgZiwgZmFsc2UpOw0KICAgIH0gZWxzZSBpZiAoZW1pdHRlci5hdHRhY2hFdmVudCkgew0KICAgICAgZW1pdHRlci5hdHRhY2hFdmVudCgib24iICsgdHlwZSwgZik7DQogICAgfSBlbHNlIHsNCiAgICAgIHZhciBtYXAkJDEgPSBlbWl0dGVyLl9oYW5kbGVycyB8fCAoZW1pdHRlci5faGFuZGxlcnMgPSB7fSk7DQogICAgICBtYXAkJDFbdHlwZV0gPSAobWFwJCQxW3R5cGVdIHx8IG5vSGFuZGxlcnMpLmNvbmNhdChmKTsNCiAgICB9DQogIH07DQoNCiAgZnVuY3Rpb24gZ2V0SGFuZGxlcnMoZW1pdHRlciwgdHlwZSkgew0KICAgIHJldHVybiBlbWl0dGVyLl9oYW5kbGVycyAmJiBlbWl0dGVyLl9oYW5kbGVyc1t0eXBlXSB8fCBub0hhbmRsZXJzDQogIH0NCg0KICBmdW5jdGlvbiBvZmYoZW1pdHRlciwgdHlwZSwgZikgew0KICAgIGlmIChlbWl0dGVyLnJlbW92ZUV2ZW50TGlzdGVuZXIpIHsNCiAgICAgIGVtaXR0ZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBmLCBmYWxzZSk7DQogICAgfSBlbHNlIGlmIChlbWl0dGVyLmRldGFjaEV2ZW50KSB7DQogICAgICBlbWl0dGVyLmRldGFjaEV2ZW50KCJvbiIgKyB0eXBlLCBmKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIG1hcCQkMSA9IGVtaXR0ZXIuX2hhbmRsZXJzLCBhcnIgPSBtYXAkJDEgJiYgbWFwJCQxW3R5cGVdOw0KICAgICAgaWYgKGFycikgew0KICAgICAgICB2YXIgaW5kZXggPSBpbmRleE9mKGFyciwgZik7DQogICAgICAgIGlmIChpbmRleCA+IC0xKQ0KICAgICAgICAgIHsgbWFwJCQxW3R5cGVdID0gYXJyLnNsaWNlKDAsIGluZGV4KS5jb25jYXQoYXJyLnNsaWNlKGluZGV4ICsgMSkpOyB9DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc2lnbmFsKGVtaXR0ZXIsIHR5cGUgLyosIHZhbHVlcy4uLiovKSB7DQogICAgdmFyIGhhbmRsZXJzID0gZ2V0SGFuZGxlcnMoZW1pdHRlciwgdHlwZSk7DQogICAgaWYgKCFoYW5kbGVycy5sZW5ndGgpIHsgcmV0dXJuIH0NCiAgICB2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBoYW5kbGVycy5sZW5ndGg7ICsraSkgeyBoYW5kbGVyc1tpXS5hcHBseShudWxsLCBhcmdzKTsgfQ0KICB9DQoNCiAgLy8gVGhlIERPTSBldmVudHMgdGhhdCBDb2RlTWlycm9yIGhhbmRsZXMgY2FuIGJlIG92ZXJyaWRkZW4gYnkNCiAgLy8gcmVnaXN0ZXJpbmcgYSAobm9uLURPTSkgaGFuZGxlciBvbiB0aGUgZWRpdG9yIGZvciB0aGUgZXZlbnQgbmFtZSwNCiAgLy8gYW5kIHByZXZlbnREZWZhdWx0LWluZyB0aGUgZXZlbnQgaW4gdGhhdCBoYW5kbGVyLg0KICBmdW5jdGlvbiBzaWduYWxET01FdmVudChjbSwgZSwgb3ZlcnJpZGUpIHsNCiAgICBpZiAodHlwZW9mIGUgPT0gInN0cmluZyIpDQogICAgICB7IGUgPSB7dHlwZTogZSwgcHJldmVudERlZmF1bHQ6IGZ1bmN0aW9uKCkgeyB0aGlzLmRlZmF1bHRQcmV2ZW50ZWQgPSB0cnVlOyB9fTsgfQ0KICAgIHNpZ25hbChjbSwgb3ZlcnJpZGUgfHwgZS50eXBlLCBjbSwgZSk7DQogICAgcmV0dXJuIGVfZGVmYXVsdFByZXZlbnRlZChlKSB8fCBlLmNvZGVtaXJyb3JJZ25vcmUNCiAgfQ0KDQogIGZ1bmN0aW9uIHNpZ25hbEN1cnNvckFjdGl2aXR5KGNtKSB7DQogICAgdmFyIGFyciA9IGNtLl9oYW5kbGVycyAmJiBjbS5faGFuZGxlcnMuY3Vyc29yQWN0aXZpdHk7DQogICAgaWYgKCFhcnIpIHsgcmV0dXJuIH0NCiAgICB2YXIgc2V0ID0gY20uY3VyT3AuY3Vyc29yQWN0aXZpdHlIYW5kbGVycyB8fCAoY20uY3VyT3AuY3Vyc29yQWN0aXZpdHlIYW5kbGVycyA9IFtdKTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkgeyBpZiAoaW5kZXhPZihzZXQsIGFycltpXSkgPT0gLTEpDQogICAgICB7IHNldC5wdXNoKGFycltpXSk7IH0gfQ0KICB9DQoNCiAgZnVuY3Rpb24gaGFzSGFuZGxlcihlbWl0dGVyLCB0eXBlKSB7DQogICAgcmV0dXJuIGdldEhhbmRsZXJzKGVtaXR0ZXIsIHR5cGUpLmxlbmd0aCA+IDANCiAgfQ0KDQogIC8vIEFkZCBvbiBhbmQgb2ZmIG1ldGhvZHMgdG8gYSBjb25zdHJ1Y3RvcidzIHByb3RvdHlwZSwgdG8gbWFrZQ0KICAvLyByZWdpc3RlcmluZyBldmVudHMgb24gc3VjaCBvYmplY3RzIG1vcmUgY29udmVuaWVudC4NCiAgZnVuY3Rpb24gZXZlbnRNaXhpbihjdG9yKSB7DQogICAgY3Rvci5wcm90b3R5cGUub24gPSBmdW5jdGlvbih0eXBlLCBmKSB7b24odGhpcywgdHlwZSwgZik7fTsNCiAgICBjdG9yLnByb3RvdHlwZS5vZmYgPSBmdW5jdGlvbih0eXBlLCBmKSB7b2ZmKHRoaXMsIHR5cGUsIGYpO307DQogIH0NCg0KICAvLyBEdWUgdG8gdGhlIGZhY3QgdGhhdCB3ZSBzdGlsbCBzdXBwb3J0IGp1cmFzc2ljIElFIHZlcnNpb25zLCBzb21lDQogIC8vIGNvbXBhdGliaWxpdHkgd3JhcHBlcnMgYXJlIG5lZWRlZC4NCg0KICBmdW5jdGlvbiBlX3ByZXZlbnREZWZhdWx0KGUpIHsNCiAgICBpZiAoZS5wcmV2ZW50RGVmYXVsdCkgeyBlLnByZXZlbnREZWZhdWx0KCk7IH0NCiAgICBlbHNlIHsgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOyB9DQogIH0NCiAgZnVuY3Rpb24gZV9zdG9wUHJvcGFnYXRpb24oZSkgew0KICAgIGlmIChlLnN0b3BQcm9wYWdhdGlvbikgeyBlLnN0b3BQcm9wYWdhdGlvbigpOyB9DQogICAgZWxzZSB7IGUuY2FuY2VsQnViYmxlID0gdHJ1ZTsgfQ0KICB9DQogIGZ1bmN0aW9uIGVfZGVmYXVsdFByZXZlbnRlZChlKSB7DQogICAgcmV0dXJuIGUuZGVmYXVsdFByZXZlbnRlZCAhPSBudWxsID8gZS5kZWZhdWx0UHJldmVudGVkIDogZS5yZXR1cm5WYWx1ZSA9PSBmYWxzZQ0KICB9DQogIGZ1bmN0aW9uIGVfc3RvcChlKSB7ZV9wcmV2ZW50RGVmYXVsdChlKTsgZV9zdG9wUHJvcGFnYXRpb24oZSk7fQ0KDQogIGZ1bmN0aW9uIGVfdGFyZ2V0KGUpIHtyZXR1cm4gZS50YXJnZXQgfHwgZS5zcmNFbGVtZW50fQ0KICBmdW5jdGlvbiBlX2J1dHRvbihlKSB7DQogICAgdmFyIGIgPSBlLndoaWNoOw0KICAgIGlmIChiID09IG51bGwpIHsNCiAgICAgIGlmIChlLmJ1dHRvbiAmIDEpIHsgYiA9IDE7IH0NCiAgICAgIGVsc2UgaWYgKGUuYnV0dG9uICYgMikgeyBiID0gMzsgfQ0KICAgICAgZWxzZSBpZiAoZS5idXR0b24gJiA0KSB7IGIgPSAyOyB9DQogICAgfQ0KICAgIGlmIChtYWMgJiYgZS5jdHJsS2V5ICYmIGIgPT0gMSkgeyBiID0gMzsgfQ0KICAgIHJldHVybiBiDQogIH0NCg0KICAvLyBEZXRlY3QgZHJhZy1hbmQtZHJvcA0KICB2YXIgZHJhZ0FuZERyb3AgPSBmdW5jdGlvbigpIHsNCiAgICAvLyBUaGVyZSBpcyAqc29tZSoga2luZCBvZiBkcmFnLWFuZC1kcm9wIHN1cHBvcnQgaW4gSUU2LTgsIGJ1dCBJDQogICAgLy8gY291bGRuJ3QgZ2V0IGl0IHRvIHdvcmsgeWV0Lg0KICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIHZhciBkaXYgPSBlbHQoJ2RpdicpOw0KICAgIHJldHVybiAiZHJhZ2dhYmxlIiBpbiBkaXYgfHwgImRyYWdEcm9wIiBpbiBkaXYNCiAgfSgpOw0KDQogIHZhciB6d3NwU3VwcG9ydGVkOw0KICBmdW5jdGlvbiB6ZXJvV2lkdGhFbGVtZW50KG1lYXN1cmUpIHsNCiAgICBpZiAoendzcFN1cHBvcnRlZCA9PSBudWxsKSB7DQogICAgICB2YXIgdGVzdCA9IGVsdCgic3BhbiIsICJcdTIwMGIiKTsNCiAgICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKG1lYXN1cmUsIGVsdCgic3BhbiIsIFt0ZXN0LCBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgieCIpXSkpOw0KICAgICAgaWYgKG1lYXN1cmUuZmlyc3RDaGlsZC5vZmZzZXRIZWlnaHQgIT0gMCkNCiAgICAgICAgeyB6d3NwU3VwcG9ydGVkID0gdGVzdC5vZmZzZXRXaWR0aCA8PSAxICYmIHRlc3Qub2Zmc2V0SGVpZ2h0ID4gMiAmJiAhKGllICYmIGllX3ZlcnNpb24gPCA4KTsgfQ0KICAgIH0NCiAgICB2YXIgbm9kZSA9IHp3c3BTdXBwb3J0ZWQgPyBlbHQoInNwYW4iLCAiXHUyMDBiIikgOg0KICAgICAgZWx0KCJzcGFuIiwgIlx1MDBhMCIsIG51bGwsICJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IHdpZHRoOiAxcHg7IG1hcmdpbi1yaWdodDogLTFweCIpOw0KICAgIG5vZGUuc2V0QXR0cmlidXRlKCJjbS10ZXh0IiwgIiIpOw0KICAgIHJldHVybiBub2RlDQogIH0NCg0KICAvLyBGZWF0dXJlLWRldGVjdCBJRSdzIGNydW1teSBjbGllbnQgcmVjdCByZXBvcnRpbmcgZm9yIGJpZGkgdGV4dA0KICB2YXIgYmFkQmlkaVJlY3RzOw0KICBmdW5jdGlvbiBoYXNCYWRCaWRpUmVjdHMobWVhc3VyZSkgew0KICAgIGlmIChiYWRCaWRpUmVjdHMgIT0gbnVsbCkgeyByZXR1cm4gYmFkQmlkaVJlY3RzIH0NCiAgICB2YXIgdHh0ID0gcmVtb3ZlQ2hpbGRyZW5BbmRBZGQobWVhc3VyZSwgZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIkFcdTA2MmVBIikpOw0KICAgIHZhciByMCA9IHJhbmdlKHR4dCwgMCwgMSkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgdmFyIHIxID0gcmFuZ2UodHh0LCAxLCAyKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICByZW1vdmVDaGlsZHJlbihtZWFzdXJlKTsNCiAgICBpZiAoIXIwIHx8IHIwLmxlZnQgPT0gcjAucmlnaHQpIHsgcmV0dXJuIGZhbHNlIH0gLy8gU2FmYXJpIHJldHVybnMgbnVsbCBpbiBzb21lIGNhc2VzICgjMjc4MCkNCiAgICByZXR1cm4gYmFkQmlkaVJlY3RzID0gKHIxLnJpZ2h0IC0gcjAucmlnaHQgPCAzKQ0KICB9DQoNCiAgLy8gU2VlIGlmICIiLnNwbGl0IGlzIHRoZSBicm9rZW4gSUUgdmVyc2lvbiwgaWYgc28sIHByb3ZpZGUgYW4NCiAgLy8gYWx0ZXJuYXRpdmUgd2F5IHRvIHNwbGl0IGxpbmVzLg0KICB2YXIgc3BsaXRMaW5lc0F1dG8gPSAiXG5cbmIiLnNwbGl0KC9cbi8pLmxlbmd0aCAhPSAzID8gZnVuY3Rpb24gKHN0cmluZykgew0KICAgIHZhciBwb3MgPSAwLCByZXN1bHQgPSBbXSwgbCA9IHN0cmluZy5sZW5ndGg7DQogICAgd2hpbGUgKHBvcyA8PSBsKSB7DQogICAgICB2YXIgbmwgPSBzdHJpbmcuaW5kZXhPZigiXG4iLCBwb3MpOw0KICAgICAgaWYgKG5sID09IC0xKSB7IG5sID0gc3RyaW5nLmxlbmd0aDsgfQ0KICAgICAgdmFyIGxpbmUgPSBzdHJpbmcuc2xpY2UocG9zLCBzdHJpbmcuY2hhckF0KG5sIC0gMSkgPT0gIlxyIiA/IG5sIC0gMSA6IG5sKTsNCiAgICAgIHZhciBydCA9IGxpbmUuaW5kZXhPZigiXHIiKTsNCiAgICAgIGlmIChydCAhPSAtMSkgew0KICAgICAgICByZXN1bHQucHVzaChsaW5lLnNsaWNlKDAsIHJ0KSk7DQogICAgICAgIHBvcyArPSBydCArIDE7DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXN1bHQucHVzaChsaW5lKTsNCiAgICAgICAgcG9zID0gbmwgKyAxOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0DQogIH0gOiBmdW5jdGlvbiAoc3RyaW5nKSB7IHJldHVybiBzdHJpbmcuc3BsaXQoL1xyXG4/fFxuLyk7IH07DQoNCiAgdmFyIGhhc1NlbGVjdGlvbiA9IHdpbmRvdy5nZXRTZWxlY3Rpb24gPyBmdW5jdGlvbiAodGUpIHsNCiAgICB0cnkgeyByZXR1cm4gdGUuc2VsZWN0aW9uU3RhcnQgIT0gdGUuc2VsZWN0aW9uRW5kIH0NCiAgICBjYXRjaChlKSB7IHJldHVybiBmYWxzZSB9DQogIH0gOiBmdW5jdGlvbiAodGUpIHsNCiAgICB2YXIgcmFuZ2UkJDE7DQogICAgdHJ5IHtyYW5nZSQkMSA9IHRlLm93bmVyRG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCk7fQ0KICAgIGNhdGNoKGUpIHt9DQogICAgaWYgKCFyYW5nZSQkMSB8fCByYW5nZSQkMS5wYXJlbnRFbGVtZW50KCkgIT0gdGUpIHsgcmV0dXJuIGZhbHNlIH0NCiAgICByZXR1cm4gcmFuZ2UkJDEuY29tcGFyZUVuZFBvaW50cygiU3RhcnRUb0VuZCIsIHJhbmdlJCQxKSAhPSAwDQogIH07DQoNCiAgdmFyIGhhc0NvcHlFdmVudCA9IChmdW5jdGlvbiAoKSB7DQogICAgdmFyIGUgPSBlbHQoImRpdiIpOw0KICAgIGlmICgib25jb3B5IiBpbiBlKSB7IHJldHVybiB0cnVlIH0NCiAgICBlLnNldEF0dHJpYnV0ZSgib25jb3B5IiwgInJldHVybjsiKTsNCiAgICByZXR1cm4gdHlwZW9mIGUub25jb3B5ID09ICJmdW5jdGlvbiINCiAgfSkoKTsNCg0KICB2YXIgYmFkWm9vbWVkUmVjdHMgPSBudWxsOw0KICBmdW5jdGlvbiBoYXNCYWRab29tZWRSZWN0cyhtZWFzdXJlKSB7DQogICAgaWYgKGJhZFpvb21lZFJlY3RzICE9IG51bGwpIHsgcmV0dXJuIGJhZFpvb21lZFJlY3RzIH0NCiAgICB2YXIgbm9kZSA9IHJlbW92ZUNoaWxkcmVuQW5kQWRkKG1lYXN1cmUsIGVsdCgic3BhbiIsICJ4IikpOw0KICAgIHZhciBub3JtYWwgPSBub2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIHZhciBmcm9tUmFuZ2UgPSByYW5nZShub2RlLCAwLCAxKS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICByZXR1cm4gYmFkWm9vbWVkUmVjdHMgPSBNYXRoLmFicyhub3JtYWwubGVmdCAtIGZyb21SYW5nZS5sZWZ0KSA+IDENCiAgfQ0KDQogIC8vIEtub3duIG1vZGVzLCBieSBuYW1lIGFuZCBieSBNSU1FDQogIHZhciBtb2RlcyA9IHt9LCBtaW1lTW9kZXMgPSB7fTsNCg0KICAvLyBFeHRyYSBhcmd1bWVudHMgYXJlIHN0b3JlZCBhcyB0aGUgbW9kZSdzIGRlcGVuZGVuY2llcywgd2hpY2ggaXMNCiAgLy8gdXNlZCBieSAobGVnYWN5KSBtZWNoYW5pc21zIGxpa2UgbG9hZG1vZGUuanMgdG8gYXV0b21hdGljYWxseQ0KICAvLyBsb2FkIGEgbW9kZS4gKFByZWZlcnJlZCBtZWNoYW5pc20gaXMgdGhlIHJlcXVpcmUvZGVmaW5lIGNhbGxzLikNCiAgZnVuY3Rpb24gZGVmaW5lTW9kZShuYW1lLCBtb2RlKSB7DQogICAgaWYgKGFyZ3VtZW50cy5sZW5ndGggPiAyKQ0KICAgICAgeyBtb2RlLmRlcGVuZGVuY2llcyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMik7IH0NCiAgICBtb2Rlc1tuYW1lXSA9IG1vZGU7DQogIH0NCg0KICBmdW5jdGlvbiBkZWZpbmVNSU1FKG1pbWUsIHNwZWMpIHsNCiAgICBtaW1lTW9kZXNbbWltZV0gPSBzcGVjOw0KICB9DQoNCiAgLy8gR2l2ZW4gYSBNSU1FIHR5cGUsIGEge25hbWUsIC4uLm9wdGlvbnN9IGNvbmZpZyBvYmplY3QsIG9yIGEgbmFtZQ0KICAvLyBzdHJpbmcsIHJldHVybiBhIG1vZGUgY29uZmlnIG9iamVjdC4NCiAgZnVuY3Rpb24gcmVzb2x2ZU1vZGUoc3BlYykgew0KICAgIGlmICh0eXBlb2Ygc3BlYyA9PSAic3RyaW5nIiAmJiBtaW1lTW9kZXMuaGFzT3duUHJvcGVydHkoc3BlYykpIHsNCiAgICAgIHNwZWMgPSBtaW1lTW9kZXNbc3BlY107DQogICAgfSBlbHNlIGlmIChzcGVjICYmIHR5cGVvZiBzcGVjLm5hbWUgPT0gInN0cmluZyIgJiYgbWltZU1vZGVzLmhhc093blByb3BlcnR5KHNwZWMubmFtZSkpIHsNCiAgICAgIHZhciBmb3VuZCA9IG1pbWVNb2Rlc1tzcGVjLm5hbWVdOw0KICAgICAgaWYgKHR5cGVvZiBmb3VuZCA9PSAic3RyaW5nIikgeyBmb3VuZCA9IHtuYW1lOiBmb3VuZH07IH0NCiAgICAgIHNwZWMgPSBjcmVhdGVPYmooZm91bmQsIHNwZWMpOw0KICAgICAgc3BlYy5uYW1lID0gZm91bmQubmFtZTsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBzcGVjID09ICJzdHJpbmciICYmIC9eW1x3XC1dK1wvW1x3XC1dK1wreG1sJC8udGVzdChzcGVjKSkgew0KICAgICAgcmV0dXJuIHJlc29sdmVNb2RlKCJhcHBsaWNhdGlvbi94bWwiKQ0KICAgIH0gZWxzZSBpZiAodHlwZW9mIHNwZWMgPT0gInN0cmluZyIgJiYgL15bXHdcLV0rXC9bXHdcLV0rXCtqc29uJC8udGVzdChzcGVjKSkgew0KICAgICAgcmV0dXJuIHJlc29sdmVNb2RlKCJhcHBsaWNhdGlvbi9qc29uIikNCiAgICB9DQogICAgaWYgKHR5cGVvZiBzcGVjID09ICJzdHJpbmciKSB7IHJldHVybiB7bmFtZTogc3BlY30gfQ0KICAgIGVsc2UgeyByZXR1cm4gc3BlYyB8fCB7bmFtZTogIm51bGwifSB9DQogIH0NCg0KICAvLyBHaXZlbiBhIG1vZGUgc3BlYyAoYW55dGhpbmcgdGhhdCByZXNvbHZlTW9kZSBhY2NlcHRzKSwgZmluZCBhbmQNCiAgLy8gaW5pdGlhbGl6ZSBhbiBhY3R1YWwgbW9kZSBvYmplY3QuDQogIGZ1bmN0aW9uIGdldE1vZGUob3B0aW9ucywgc3BlYykgew0KICAgIHNwZWMgPSByZXNvbHZlTW9kZShzcGVjKTsNCiAgICB2YXIgbWZhY3RvcnkgPSBtb2Rlc1tzcGVjLm5hbWVdOw0KICAgIGlmICghbWZhY3RvcnkpIHsgcmV0dXJuIGdldE1vZGUob3B0aW9ucywgInRleHQvcGxhaW4iKSB9DQogICAgdmFyIG1vZGVPYmogPSBtZmFjdG9yeShvcHRpb25zLCBzcGVjKTsNCiAgICBpZiAobW9kZUV4dGVuc2lvbnMuaGFzT3duUHJvcGVydHkoc3BlYy5uYW1lKSkgew0KICAgICAgdmFyIGV4dHMgPSBtb2RlRXh0ZW5zaW9uc1tzcGVjLm5hbWVdOw0KICAgICAgZm9yICh2YXIgcHJvcCBpbiBleHRzKSB7DQogICAgICAgIGlmICghZXh0cy5oYXNPd25Qcm9wZXJ0eShwcm9wKSkgeyBjb250aW51ZSB9DQogICAgICAgIGlmIChtb2RlT2JqLmhhc093blByb3BlcnR5KHByb3ApKSB7IG1vZGVPYmpbIl8iICsgcHJvcF0gPSBtb2RlT2JqW3Byb3BdOyB9DQogICAgICAgIG1vZGVPYmpbcHJvcF0gPSBleHRzW3Byb3BdOw0KICAgICAgfQ0KICAgIH0NCiAgICBtb2RlT2JqLm5hbWUgPSBzcGVjLm5hbWU7DQogICAgaWYgKHNwZWMuaGVscGVyVHlwZSkgeyBtb2RlT2JqLmhlbHBlclR5cGUgPSBzcGVjLmhlbHBlclR5cGU7IH0NCiAgICBpZiAoc3BlYy5tb2RlUHJvcHMpIHsgZm9yICh2YXIgcHJvcCQxIGluIHNwZWMubW9kZVByb3BzKQ0KICAgICAgeyBtb2RlT2JqW3Byb3AkMV0gPSBzcGVjLm1vZGVQcm9wc1twcm9wJDFdOyB9IH0NCg0KICAgIHJldHVybiBtb2RlT2JqDQogIH0NCg0KICAvLyBUaGlzIGNhbiBiZSB1c2VkIHRvIGF0dGFjaCBwcm9wZXJ0aWVzIHRvIG1vZGUgb2JqZWN0cyBmcm9tDQogIC8vIG91dHNpZGUgdGhlIGFjdHVhbCBtb2RlIGRlZmluaXRpb24uDQogIHZhciBtb2RlRXh0ZW5zaW9ucyA9IHt9Ow0KICBmdW5jdGlvbiBleHRlbmRNb2RlKG1vZGUsIHByb3BlcnRpZXMpIHsNCiAgICB2YXIgZXh0cyA9IG1vZGVFeHRlbnNpb25zLmhhc093blByb3BlcnR5KG1vZGUpID8gbW9kZUV4dGVuc2lvbnNbbW9kZV0gOiAobW9kZUV4dGVuc2lvbnNbbW9kZV0gPSB7fSk7DQogICAgY29weU9iaihwcm9wZXJ0aWVzLCBleHRzKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvcHlTdGF0ZShtb2RlLCBzdGF0ZSkgew0KICAgIGlmIChzdGF0ZSA9PT0gdHJ1ZSkgeyByZXR1cm4gc3RhdGUgfQ0KICAgIGlmIChtb2RlLmNvcHlTdGF0ZSkgeyByZXR1cm4gbW9kZS5jb3B5U3RhdGUoc3RhdGUpIH0NCiAgICB2YXIgbnN0YXRlID0ge307DQogICAgZm9yICh2YXIgbiBpbiBzdGF0ZSkgew0KICAgICAgdmFyIHZhbCA9IHN0YXRlW25dOw0KICAgICAgaWYgKHZhbCBpbnN0YW5jZW9mIEFycmF5KSB7IHZhbCA9IHZhbC5jb25jYXQoW10pOyB9DQogICAgICBuc3RhdGVbbl0gPSB2YWw7DQogICAgfQ0KICAgIHJldHVybiBuc3RhdGUNCiAgfQ0KDQogIC8vIEdpdmVuIGEgbW9kZSBhbmQgYSBzdGF0ZSAoZm9yIHRoYXQgbW9kZSksIGZpbmQgdGhlIGlubmVyIG1vZGUgYW5kDQogIC8vIHN0YXRlIGF0IHRoZSBwb3NpdGlvbiB0aGF0IHRoZSBzdGF0ZSByZWZlcnMgdG8uDQogIGZ1bmN0aW9uIGlubmVyTW9kZShtb2RlLCBzdGF0ZSkgew0KICAgIHZhciBpbmZvOw0KICAgIHdoaWxlIChtb2RlLmlubmVyTW9kZSkgew0KICAgICAgaW5mbyA9IG1vZGUuaW5uZXJNb2RlKHN0YXRlKTsNCiAgICAgIGlmICghaW5mbyB8fCBpbmZvLm1vZGUgPT0gbW9kZSkgeyBicmVhayB9DQogICAgICBzdGF0ZSA9IGluZm8uc3RhdGU7DQogICAgICBtb2RlID0gaW5mby5tb2RlOw0KICAgIH0NCiAgICByZXR1cm4gaW5mbyB8fCB7bW9kZTogbW9kZSwgc3RhdGU6IHN0YXRlfQ0KICB9DQoNCiAgZnVuY3Rpb24gc3RhcnRTdGF0ZShtb2RlLCBhMSwgYTIpIHsNCiAgICByZXR1cm4gbW9kZS5zdGFydFN0YXRlID8gbW9kZS5zdGFydFN0YXRlKGExLCBhMikgOiB0cnVlDQogIH0NCg0KICAvLyBTVFJJTkcgU1RSRUFNDQoNCiAgLy8gRmVkIHRvIHRoZSBtb2RlIHBhcnNlcnMsIHByb3ZpZGVzIGhlbHBlciBmdW5jdGlvbnMgdG8gbWFrZQ0KICAvLyBwYXJzZXJzIG1vcmUgc3VjY2luY3QuDQoNCiAgdmFyIFN0cmluZ1N0cmVhbSA9IGZ1bmN0aW9uKHN0cmluZywgdGFiU2l6ZSwgbGluZU9yYWNsZSkgew0KICAgIHRoaXMucG9zID0gdGhpcy5zdGFydCA9IDA7DQogICAgdGhpcy5zdHJpbmcgPSBzdHJpbmc7DQogICAgdGhpcy50YWJTaXplID0gdGFiU2l6ZSB8fCA4Ow0KICAgIHRoaXMubGFzdENvbHVtblBvcyA9IHRoaXMubGFzdENvbHVtblZhbHVlID0gMDsNCiAgICB0aGlzLmxpbmVTdGFydCA9IDA7DQogICAgdGhpcy5saW5lT3JhY2xlID0gbGluZU9yYWNsZTsNCiAgfTsNCg0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLmVvbCA9IGZ1bmN0aW9uICgpIHtyZXR1cm4gdGhpcy5wb3MgPj0gdGhpcy5zdHJpbmcubGVuZ3RofTsNCiAgU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5zb2wgPSBmdW5jdGlvbiAoKSB7cmV0dXJuIHRoaXMucG9zID09IHRoaXMubGluZVN0YXJ0fTsNCiAgU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5wZWVrID0gZnVuY3Rpb24gKCkge3JldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpIHx8IHVuZGVmaW5lZH07DQogIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAodGhpcy5wb3MgPCB0aGlzLnN0cmluZy5sZW5ndGgpDQogICAgICB7IHJldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MrKykgfQ0KICB9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLmVhdCA9IGZ1bmN0aW9uIChtYXRjaCkgew0KICAgIHZhciBjaCA9IHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcyk7DQogICAgdmFyIG9rOw0KICAgIGlmICh0eXBlb2YgbWF0Y2ggPT0gInN0cmluZyIpIHsgb2sgPSBjaCA9PSBtYXRjaDsgfQ0KICAgIGVsc2UgeyBvayA9IGNoICYmIChtYXRjaC50ZXN0ID8gbWF0Y2gudGVzdChjaCkgOiBtYXRjaChjaCkpOyB9DQogICAgaWYgKG9rKSB7Kyt0aGlzLnBvczsgcmV0dXJuIGNofQ0KICB9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLmVhdFdoaWxlID0gZnVuY3Rpb24gKG1hdGNoKSB7DQogICAgdmFyIHN0YXJ0ID0gdGhpcy5wb3M7DQogICAgd2hpbGUgKHRoaXMuZWF0KG1hdGNoKSl7fQ0KICAgIHJldHVybiB0aGlzLnBvcyA+IHN0YXJ0DQogIH07DQogIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUuZWF0U3BhY2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIHZhciBzdGFydCA9IHRoaXMucG9zOw0KICAgIHdoaWxlICgvW1xzXHUwMGEwXS8udGVzdCh0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpKSkgeyArK3RoaXMkMS5wb3M7IH0NCiAgICByZXR1cm4gdGhpcy5wb3MgPiBzdGFydA0KICB9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLnNraXBUb0VuZCA9IGZ1bmN0aW9uICgpIHt0aGlzLnBvcyA9IHRoaXMuc3RyaW5nLmxlbmd0aDt9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLnNraXBUbyA9IGZ1bmN0aW9uIChjaCkgew0KICAgIHZhciBmb3VuZCA9IHRoaXMuc3RyaW5nLmluZGV4T2YoY2gsIHRoaXMucG9zKTsNCiAgICBpZiAoZm91bmQgPiAtMSkge3RoaXMucG9zID0gZm91bmQ7IHJldHVybiB0cnVlfQ0KICB9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLmJhY2tVcCA9IGZ1bmN0aW9uIChuKSB7dGhpcy5wb3MgLT0gbjt9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLmNvbHVtbiA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAodGhpcy5sYXN0Q29sdW1uUG9zIDwgdGhpcy5zdGFydCkgew0KICAgICAgdGhpcy5sYXN0Q29sdW1uVmFsdWUgPSBjb3VudENvbHVtbih0aGlzLnN0cmluZywgdGhpcy5zdGFydCwgdGhpcy50YWJTaXplLCB0aGlzLmxhc3RDb2x1bW5Qb3MsIHRoaXMubGFzdENvbHVtblZhbHVlKTsNCiAgICAgIHRoaXMubGFzdENvbHVtblBvcyA9IHRoaXMuc3RhcnQ7DQogICAgfQ0KICAgIHJldHVybiB0aGlzLmxhc3RDb2x1bW5WYWx1ZSAtICh0aGlzLmxpbmVTdGFydCA/IGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCB0aGlzLmxpbmVTdGFydCwgdGhpcy50YWJTaXplKSA6IDApDQogIH07DQogIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUuaW5kZW50YXRpb24gPSBmdW5jdGlvbiAoKSB7DQogICAgcmV0dXJuIGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCBudWxsLCB0aGlzLnRhYlNpemUpIC0NCiAgICAgICh0aGlzLmxpbmVTdGFydCA/IGNvdW50Q29sdW1uKHRoaXMuc3RyaW5nLCB0aGlzLmxpbmVTdGFydCwgdGhpcy50YWJTaXplKSA6IDApDQogIH07DQogIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUubWF0Y2ggPSBmdW5jdGlvbiAocGF0dGVybiwgY29uc3VtZSwgY2FzZUluc2Vuc2l0aXZlKSB7DQogICAgaWYgKHR5cGVvZiBwYXR0ZXJuID09ICJzdHJpbmciKSB7DQogICAgICB2YXIgY2FzZWQgPSBmdW5jdGlvbiAoc3RyKSB7IHJldHVybiBjYXNlSW5zZW5zaXRpdmUgPyBzdHIudG9Mb3dlckNhc2UoKSA6IHN0cjsgfTsNCiAgICAgIHZhciBzdWJzdHIgPSB0aGlzLnN0cmluZy5zdWJzdHIodGhpcy5wb3MsIHBhdHRlcm4ubGVuZ3RoKTsNCiAgICAgIGlmIChjYXNlZChzdWJzdHIpID09IGNhc2VkKHBhdHRlcm4pKSB7DQogICAgICAgIGlmIChjb25zdW1lICE9PSBmYWxzZSkgeyB0aGlzLnBvcyArPSBwYXR0ZXJuLmxlbmd0aDsgfQ0KICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICB2YXIgbWF0Y2ggPSB0aGlzLnN0cmluZy5zbGljZSh0aGlzLnBvcykubWF0Y2gocGF0dGVybik7DQogICAgICBpZiAobWF0Y2ggJiYgbWF0Y2guaW5kZXggPiAwKSB7IHJldHVybiBudWxsIH0NCiAgICAgIGlmIChtYXRjaCAmJiBjb25zdW1lICE9PSBmYWxzZSkgeyB0aGlzLnBvcyArPSBtYXRjaFswXS5sZW5ndGg7IH0NCiAgICAgIHJldHVybiBtYXRjaA0KICAgIH0NCiAgfTsNCiAgU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5jdXJyZW50ID0gZnVuY3Rpb24gKCl7cmV0dXJuIHRoaXMuc3RyaW5nLnNsaWNlKHRoaXMuc3RhcnQsIHRoaXMucG9zKX07DQogIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUuaGlkZUZpcnN0Q2hhcnMgPSBmdW5jdGlvbiAobiwgaW5uZXIpIHsNCiAgICB0aGlzLmxpbmVTdGFydCArPSBuOw0KICAgIHRyeSB7IHJldHVybiBpbm5lcigpIH0NCiAgICBmaW5hbGx5IHsgdGhpcy5saW5lU3RhcnQgLT0gbjsgfQ0KICB9Ow0KICBTdHJpbmdTdHJlYW0ucHJvdG90eXBlLmxvb2tBaGVhZCA9IGZ1bmN0aW9uIChuKSB7DQogICAgdmFyIG9yYWNsZSA9IHRoaXMubGluZU9yYWNsZTsNCiAgICByZXR1cm4gb3JhY2xlICYmIG9yYWNsZS5sb29rQWhlYWQobikNCiAgfTsNCiAgU3RyaW5nU3RyZWFtLnByb3RvdHlwZS5iYXNlVG9rZW4gPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIG9yYWNsZSA9IHRoaXMubGluZU9yYWNsZTsNCiAgICByZXR1cm4gb3JhY2xlICYmIG9yYWNsZS5iYXNlVG9rZW4odGhpcy5wb3MpDQogIH07DQoNCiAgLy8gRmluZCB0aGUgbGluZSBvYmplY3QgY29ycmVzcG9uZGluZyB0byB0aGUgZ2l2ZW4gbGluZSBudW1iZXIuDQogIGZ1bmN0aW9uIGdldExpbmUoZG9jLCBuKSB7DQogICAgbiAtPSBkb2MuZmlyc3Q7DQogICAgaWYgKG4gPCAwIHx8IG4gPj0gZG9jLnNpemUpIHsgdGhyb3cgbmV3IEVycm9yKCJUaGVyZSBpcyBubyBsaW5lICIgKyAobiArIGRvYy5maXJzdCkgKyAiIGluIHRoZSBkb2N1bWVudC4iKSB9DQogICAgdmFyIGNodW5rID0gZG9jOw0KICAgIHdoaWxlICghY2h1bmsubGluZXMpIHsNCiAgICAgIGZvciAodmFyIGkgPSAwOzsgKytpKSB7DQogICAgICAgIHZhciBjaGlsZCA9IGNodW5rLmNoaWxkcmVuW2ldLCBzeiA9IGNoaWxkLmNodW5rU2l6ZSgpOw0KICAgICAgICBpZiAobiA8IHN6KSB7IGNodW5rID0gY2hpbGQ7IGJyZWFrIH0NCiAgICAgICAgbiAtPSBzejsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGNodW5rLmxpbmVzW25dDQogIH0NCg0KICAvLyBHZXQgdGhlIHBhcnQgb2YgYSBkb2N1bWVudCBiZXR3ZWVuIHR3byBwb3NpdGlvbnMsIGFzIGFuIGFycmF5IG9mDQogIC8vIHN0cmluZ3MuDQogIGZ1bmN0aW9uIGdldEJldHdlZW4oZG9jLCBzdGFydCwgZW5kKSB7DQogICAgdmFyIG91dCA9IFtdLCBuID0gc3RhcnQubGluZTsNCiAgICBkb2MuaXRlcihzdGFydC5saW5lLCBlbmQubGluZSArIDEsIGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICB2YXIgdGV4dCA9IGxpbmUudGV4dDsNCiAgICAgIGlmIChuID09IGVuZC5saW5lKSB7IHRleHQgPSB0ZXh0LnNsaWNlKDAsIGVuZC5jaCk7IH0NCiAgICAgIGlmIChuID09IHN0YXJ0LmxpbmUpIHsgdGV4dCA9IHRleHQuc2xpY2Uoc3RhcnQuY2gpOyB9DQogICAgICBvdXQucHVzaCh0ZXh0KTsNCiAgICAgICsrbjsNCiAgICB9KTsNCiAgICByZXR1cm4gb3V0DQogIH0NCiAgLy8gR2V0IHRoZSBsaW5lcyBiZXR3ZWVuIGZyb20gYW5kIHRvLCBhcyBhcnJheSBvZiBzdHJpbmdzLg0KICBmdW5jdGlvbiBnZXRMaW5lcyhkb2MsIGZyb20sIHRvKSB7DQogICAgdmFyIG91dCA9IFtdOw0KICAgIGRvYy5pdGVyKGZyb20sIHRvLCBmdW5jdGlvbiAobGluZSkgeyBvdXQucHVzaChsaW5lLnRleHQpOyB9KTsgLy8gaXRlciBhYm9ydHMgd2hlbiBjYWxsYmFjayByZXR1cm5zIHRydXRoeSB2YWx1ZQ0KICAgIHJldHVybiBvdXQNCiAgfQ0KDQogIC8vIFVwZGF0ZSB0aGUgaGVpZ2h0IG9mIGEgbGluZSwgcHJvcGFnYXRpbmcgdGhlIGhlaWdodCBjaGFuZ2UNCiAgLy8gdXB3YXJkcyB0byBwYXJlbnQgbm9kZXMuDQogIGZ1bmN0aW9uIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgaGVpZ2h0KSB7DQogICAgdmFyIGRpZmYgPSBoZWlnaHQgLSBsaW5lLmhlaWdodDsNCiAgICBpZiAoZGlmZikgeyBmb3IgKHZhciBuID0gbGluZTsgbjsgbiA9IG4ucGFyZW50KSB7IG4uaGVpZ2h0ICs9IGRpZmY7IH0gfQ0KICB9DQoNCiAgLy8gR2l2ZW4gYSBsaW5lIG9iamVjdCwgZmluZCBpdHMgbGluZSBudW1iZXIgYnkgd2Fsa2luZyB1cCB0aHJvdWdoDQogIC8vIGl0cyBwYXJlbnQgbGlua3MuDQogIGZ1bmN0aW9uIGxpbmVObyhsaW5lKSB7DQogICAgaWYgKGxpbmUucGFyZW50ID09IG51bGwpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHZhciBjdXIgPSBsaW5lLnBhcmVudCwgbm8gPSBpbmRleE9mKGN1ci5saW5lcywgbGluZSk7DQogICAgZm9yICh2YXIgY2h1bmsgPSBjdXIucGFyZW50OyBjaHVuazsgY3VyID0gY2h1bmssIGNodW5rID0gY2h1bmsucGFyZW50KSB7DQogICAgICBmb3IgKHZhciBpID0gMDs7ICsraSkgew0KICAgICAgICBpZiAoY2h1bmsuY2hpbGRyZW5baV0gPT0gY3VyKSB7IGJyZWFrIH0NCiAgICAgICAgbm8gKz0gY2h1bmsuY2hpbGRyZW5baV0uY2h1bmtTaXplKCk7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBubyArIGN1ci5maXJzdA0KICB9DQoNCiAgLy8gRmluZCB0aGUgbGluZSBhdCB0aGUgZ2l2ZW4gdmVydGljYWwgcG9zaXRpb24sIHVzaW5nIHRoZSBoZWlnaHQNCiAgLy8gaW5mb3JtYXRpb24gaW4gdGhlIGRvY3VtZW50IHRyZWUuDQogIGZ1bmN0aW9uIGxpbmVBdEhlaWdodChjaHVuaywgaCkgew0KICAgIHZhciBuID0gY2h1bmsuZmlyc3Q7DQogICAgb3V0ZXI6IGRvIHsNCiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGNodW5rLmNoaWxkcmVuLmxlbmd0aDsgKytpJDEpIHsNCiAgICAgICAgdmFyIGNoaWxkID0gY2h1bmsuY2hpbGRyZW5baSQxXSwgY2ggPSBjaGlsZC5oZWlnaHQ7DQogICAgICAgIGlmIChoIDwgY2gpIHsgY2h1bmsgPSBjaGlsZDsgY29udGludWUgb3V0ZXIgfQ0KICAgICAgICBoIC09IGNoOw0KICAgICAgICBuICs9IGNoaWxkLmNodW5rU2l6ZSgpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIG4NCiAgICB9IHdoaWxlICghY2h1bmsubGluZXMpDQogICAgdmFyIGkgPSAwOw0KICAgIGZvciAoOyBpIDwgY2h1bmsubGluZXMubGVuZ3RoOyArK2kpIHsNCiAgICAgIHZhciBsaW5lID0gY2h1bmsubGluZXNbaV0sIGxoID0gbGluZS5oZWlnaHQ7DQogICAgICBpZiAoaCA8IGxoKSB7IGJyZWFrIH0NCiAgICAgIGggLT0gbGg7DQogICAgfQ0KICAgIHJldHVybiBuICsgaQ0KICB9DQoNCiAgZnVuY3Rpb24gaXNMaW5lKGRvYywgbCkge3JldHVybiBsID49IGRvYy5maXJzdCAmJiBsIDwgZG9jLmZpcnN0ICsgZG9jLnNpemV9DQoNCiAgZnVuY3Rpb24gbGluZU51bWJlckZvcihvcHRpb25zLCBpKSB7DQogICAgcmV0dXJuIFN0cmluZyhvcHRpb25zLmxpbmVOdW1iZXJGb3JtYXR0ZXIoaSArIG9wdGlvbnMuZmlyc3RMaW5lTnVtYmVyKSkNCiAgfQ0KDQogIC8vIEEgUG9zIGluc3RhbmNlIHJlcHJlc2VudHMgYSBwb3NpdGlvbiB3aXRoaW4gdGhlIHRleHQuDQogIGZ1bmN0aW9uIFBvcyhsaW5lLCBjaCwgc3RpY2t5KSB7DQogICAgaWYgKCBzdGlja3kgPT09IHZvaWQgMCApIHN0aWNreSA9IG51bGw7DQoNCiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgUG9zKSkgeyByZXR1cm4gbmV3IFBvcyhsaW5lLCBjaCwgc3RpY2t5KSB9DQogICAgdGhpcy5saW5lID0gbGluZTsNCiAgICB0aGlzLmNoID0gY2g7DQogICAgdGhpcy5zdGlja3kgPSBzdGlja3k7DQogIH0NCg0KICAvLyBDb21wYXJlIHR3byBwb3NpdGlvbnMsIHJldHVybiAwIGlmIHRoZXkgYXJlIHRoZSBzYW1lLCBhIG5lZ2F0aXZlDQogIC8vIG51bWJlciB3aGVuIGEgaXMgbGVzcywgYW5kIGEgcG9zaXRpdmUgbnVtYmVyIG90aGVyd2lzZS4NCiAgZnVuY3Rpb24gY21wKGEsIGIpIHsgcmV0dXJuIGEubGluZSAtIGIubGluZSB8fCBhLmNoIC0gYi5jaCB9DQoNCiAgZnVuY3Rpb24gZXF1YWxDdXJzb3JQb3MoYSwgYikgeyByZXR1cm4gYS5zdGlja3kgPT0gYi5zdGlja3kgJiYgY21wKGEsIGIpID09IDAgfQ0KDQogIGZ1bmN0aW9uIGNvcHlQb3MoeCkge3JldHVybiBQb3MoeC5saW5lLCB4LmNoKX0NCiAgZnVuY3Rpb24gbWF4UG9zKGEsIGIpIHsgcmV0dXJuIGNtcChhLCBiKSA8IDAgPyBiIDogYSB9DQogIGZ1bmN0aW9uIG1pblBvcyhhLCBiKSB7IHJldHVybiBjbXAoYSwgYikgPCAwID8gYSA6IGIgfQ0KDQogIC8vIE1vc3Qgb2YgdGhlIGV4dGVybmFsIEFQSSBjbGlwcyBnaXZlbiBwb3NpdGlvbnMgdG8gbWFrZSBzdXJlIHRoZXkNCiAgLy8gYWN0dWFsbHkgZXhpc3Qgd2l0aGluIHRoZSBkb2N1bWVudC4NCiAgZnVuY3Rpb24gY2xpcExpbmUoZG9jLCBuKSB7cmV0dXJuIE1hdGgubWF4KGRvYy5maXJzdCwgTWF0aC5taW4obiwgZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxKSl9DQogIGZ1bmN0aW9uIGNsaXBQb3MoZG9jLCBwb3MpIHsNCiAgICBpZiAocG9zLmxpbmUgPCBkb2MuZmlyc3QpIHsgcmV0dXJuIFBvcyhkb2MuZmlyc3QsIDApIH0NCiAgICB2YXIgbGFzdCA9IGRvYy5maXJzdCArIGRvYy5zaXplIC0gMTsNCiAgICBpZiAocG9zLmxpbmUgPiBsYXN0KSB7IHJldHVybiBQb3MobGFzdCwgZ2V0TGluZShkb2MsIGxhc3QpLnRleHQubGVuZ3RoKSB9DQogICAgcmV0dXJuIGNsaXBUb0xlbihwb3MsIGdldExpbmUoZG9jLCBwb3MubGluZSkudGV4dC5sZW5ndGgpDQogIH0NCiAgZnVuY3Rpb24gY2xpcFRvTGVuKHBvcywgbGluZWxlbikgew0KICAgIHZhciBjaCA9IHBvcy5jaDsNCiAgICBpZiAoY2ggPT0gbnVsbCB8fCBjaCA+IGxpbmVsZW4pIHsgcmV0dXJuIFBvcyhwb3MubGluZSwgbGluZWxlbikgfQ0KICAgIGVsc2UgaWYgKGNoIDwgMCkgeyByZXR1cm4gUG9zKHBvcy5saW5lLCAwKSB9DQogICAgZWxzZSB7IHJldHVybiBwb3MgfQ0KICB9DQogIGZ1bmN0aW9uIGNsaXBQb3NBcnJheShkb2MsIGFycmF5KSB7DQogICAgdmFyIG91dCA9IFtdOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJyYXkubGVuZ3RoOyBpKyspIHsgb3V0W2ldID0gY2xpcFBvcyhkb2MsIGFycmF5W2ldKTsgfQ0KICAgIHJldHVybiBvdXQNCiAgfQ0KDQogIHZhciBTYXZlZENvbnRleHQgPSBmdW5jdGlvbihzdGF0ZSwgbG9va0FoZWFkKSB7DQogICAgdGhpcy5zdGF0ZSA9IHN0YXRlOw0KICAgIHRoaXMubG9va0FoZWFkID0gbG9va0FoZWFkOw0KICB9Ow0KDQogIHZhciBDb250ZXh0ID0gZnVuY3Rpb24oZG9jLCBzdGF0ZSwgbGluZSwgbG9va0FoZWFkKSB7DQogICAgdGhpcy5zdGF0ZSA9IHN0YXRlOw0KICAgIHRoaXMuZG9jID0gZG9jOw0KICAgIHRoaXMubGluZSA9IGxpbmU7DQogICAgdGhpcy5tYXhMb29rQWhlYWQgPSBsb29rQWhlYWQgfHwgMDsNCiAgICB0aGlzLmJhc2VUb2tlbnMgPSBudWxsOw0KICAgIHRoaXMuYmFzZVRva2VuUG9zID0gMTsNCiAgfTsNCg0KICBDb250ZXh0LnByb3RvdHlwZS5sb29rQWhlYWQgPSBmdW5jdGlvbiAobikgew0KICAgIHZhciBsaW5lID0gdGhpcy5kb2MuZ2V0TGluZSh0aGlzLmxpbmUgKyBuKTsNCiAgICBpZiAobGluZSAhPSBudWxsICYmIG4gPiB0aGlzLm1heExvb2tBaGVhZCkgeyB0aGlzLm1heExvb2tBaGVhZCA9IG47IH0NCiAgICByZXR1cm4gbGluZQ0KICB9Ow0KDQogIENvbnRleHQucHJvdG90eXBlLmJhc2VUb2tlbiA9IGZ1bmN0aW9uIChuKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIGlmICghdGhpcy5iYXNlVG9rZW5zKSB7IHJldHVybiBudWxsIH0NCiAgICB3aGlsZSAodGhpcy5iYXNlVG9rZW5zW3RoaXMuYmFzZVRva2VuUG9zXSA8PSBuKQ0KICAgICAgeyB0aGlzJDEuYmFzZVRva2VuUG9zICs9IDI7IH0NCiAgICB2YXIgdHlwZSA9IHRoaXMuYmFzZVRva2Vuc1t0aGlzLmJhc2VUb2tlblBvcyArIDFdOw0KICAgIHJldHVybiB7dHlwZTogdHlwZSAmJiB0eXBlLnJlcGxhY2UoLyggfF4pb3ZlcmxheSAuKi8sICIiKSwNCiAgICAgICAgICAgIHNpemU6IHRoaXMuYmFzZVRva2Vuc1t0aGlzLmJhc2VUb2tlblBvc10gLSBufQ0KICB9Ow0KDQogIENvbnRleHQucHJvdG90eXBlLm5leHRMaW5lID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMubGluZSsrOw0KICAgIGlmICh0aGlzLm1heExvb2tBaGVhZCA+IDApIHsgdGhpcy5tYXhMb29rQWhlYWQtLTsgfQ0KICB9Ow0KDQogIENvbnRleHQuZnJvbVNhdmVkID0gZnVuY3Rpb24gKGRvYywgc2F2ZWQsIGxpbmUpIHsNCiAgICBpZiAoc2F2ZWQgaW5zdGFuY2VvZiBTYXZlZENvbnRleHQpDQogICAgICB7IHJldHVybiBuZXcgQ29udGV4dChkb2MsIGNvcHlTdGF0ZShkb2MubW9kZSwgc2F2ZWQuc3RhdGUpLCBsaW5lLCBzYXZlZC5sb29rQWhlYWQpIH0NCiAgICBlbHNlDQogICAgICB7IHJldHVybiBuZXcgQ29udGV4dChkb2MsIGNvcHlTdGF0ZShkb2MubW9kZSwgc2F2ZWQpLCBsaW5lKSB9DQogIH07DQoNCiAgQ29udGV4dC5wcm90b3R5cGUuc2F2ZSA9IGZ1bmN0aW9uIChjb3B5KSB7DQogICAgdmFyIHN0YXRlID0gY29weSAhPT0gZmFsc2UgPyBjb3B5U3RhdGUodGhpcy5kb2MubW9kZSwgdGhpcy5zdGF0ZSkgOiB0aGlzLnN0YXRlOw0KICAgIHJldHVybiB0aGlzLm1heExvb2tBaGVhZCA+IDAgPyBuZXcgU2F2ZWRDb250ZXh0KHN0YXRlLCB0aGlzLm1heExvb2tBaGVhZCkgOiBzdGF0ZQ0KICB9Ow0KDQoNCiAgLy8gQ29tcHV0ZSBhIHN0eWxlIGFycmF5IChhbiBhcnJheSBzdGFydGluZyB3aXRoIGEgbW9kZSBnZW5lcmF0aW9uDQogIC8vIC0tIGZvciBpbnZhbGlkYXRpb24gLS0gZm9sbG93ZWQgYnkgcGFpcnMgb2YgZW5kIHBvc2l0aW9ucyBhbmQNCiAgLy8gc3R5bGUgc3RyaW5ncyksIHdoaWNoIGlzIHVzZWQgdG8gaGlnaGxpZ2h0IHRoZSB0b2tlbnMgb24gdGhlDQogIC8vIGxpbmUuDQogIGZ1bmN0aW9uIGhpZ2hsaWdodExpbmUoY20sIGxpbmUsIGNvbnRleHQsIGZvcmNlVG9FbmQpIHsNCiAgICAvLyBBIHN0eWxlcyBhcnJheSBhbHdheXMgc3RhcnRzIHdpdGggYSBudW1iZXIgaWRlbnRpZnlpbmcgdGhlDQogICAgLy8gbW9kZS9vdmVybGF5cyB0aGF0IGl0IGlzIGJhc2VkIG9uIChmb3IgZWFzeSBpbnZhbGlkYXRpb24pLg0KICAgIHZhciBzdCA9IFtjbS5zdGF0ZS5tb2RlR2VuXSwgbGluZUNsYXNzZXMgPSB7fTsNCiAgICAvLyBDb21wdXRlIHRoZSBiYXNlIGFycmF5IG9mIHN0eWxlcw0KICAgIHJ1bk1vZGUoY20sIGxpbmUudGV4dCwgY20uZG9jLm1vZGUsIGNvbnRleHQsIGZ1bmN0aW9uIChlbmQsIHN0eWxlKSB7IHJldHVybiBzdC5wdXNoKGVuZCwgc3R5bGUpOyB9LA0KICAgICAgICAgICAgbGluZUNsYXNzZXMsIGZvcmNlVG9FbmQpOw0KICAgIHZhciBzdGF0ZSA9IGNvbnRleHQuc3RhdGU7DQoNCiAgICAvLyBSdW4gb3ZlcmxheXMsIGFkanVzdCBzdHlsZSBhcnJheS4NCiAgICB2YXIgbG9vcCA9IGZ1bmN0aW9uICggbyApIHsNCiAgICAgIGNvbnRleHQuYmFzZVRva2VucyA9IHN0Ow0KICAgICAgdmFyIG92ZXJsYXkgPSBjbS5zdGF0ZS5vdmVybGF5c1tvXSwgaSA9IDEsIGF0ID0gMDsNCiAgICAgIGNvbnRleHQuc3RhdGUgPSB0cnVlOw0KICAgICAgcnVuTW9kZShjbSwgbGluZS50ZXh0LCBvdmVybGF5Lm1vZGUsIGNvbnRleHQsIGZ1bmN0aW9uIChlbmQsIHN0eWxlKSB7DQogICAgICAgIHZhciBzdGFydCA9IGk7DQogICAgICAgIC8vIEVuc3VyZSB0aGVyZSdzIGEgdG9rZW4gZW5kIGF0IHRoZSBjdXJyZW50IHBvc2l0aW9uLCBhbmQgdGhhdCBpIHBvaW50cyBhdCBpdA0KICAgICAgICB3aGlsZSAoYXQgPCBlbmQpIHsNCiAgICAgICAgICB2YXIgaV9lbmQgPSBzdFtpXTsNCiAgICAgICAgICBpZiAoaV9lbmQgPiBlbmQpDQogICAgICAgICAgICB7IHN0LnNwbGljZShpLCAxLCBlbmQsIHN0W2krMV0sIGlfZW5kKTsgfQ0KICAgICAgICAgIGkgKz0gMjsNCiAgICAgICAgICBhdCA9IE1hdGgubWluKGVuZCwgaV9lbmQpOw0KICAgICAgICB9DQogICAgICAgIGlmICghc3R5bGUpIHsgcmV0dXJuIH0NCiAgICAgICAgaWYgKG92ZXJsYXkub3BhcXVlKSB7DQogICAgICAgICAgc3Quc3BsaWNlKHN0YXJ0LCBpIC0gc3RhcnQsIGVuZCwgIm92ZXJsYXkgIiArIHN0eWxlKTsNCiAgICAgICAgICBpID0gc3RhcnQgKyAyOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGZvciAoOyBzdGFydCA8IGk7IHN0YXJ0ICs9IDIpIHsNCiAgICAgICAgICAgIHZhciBjdXIgPSBzdFtzdGFydCsxXTsNCiAgICAgICAgICAgIHN0W3N0YXJ0KzFdID0gKGN1ciA/IGN1ciArICIgIiA6ICIiKSArICJvdmVybGF5ICIgKyBzdHlsZTsNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0sIGxpbmVDbGFzc2VzKTsNCiAgICAgIGNvbnRleHQuc3RhdGUgPSBzdGF0ZTsNCiAgICAgIGNvbnRleHQuYmFzZVRva2VucyA9IG51bGw7DQogICAgICBjb250ZXh0LmJhc2VUb2tlblBvcyA9IDE7DQogICAgfTsNCg0KICAgIGZvciAodmFyIG8gPSAwOyBvIDwgY20uc3RhdGUub3ZlcmxheXMubGVuZ3RoOyArK28pIGxvb3AoIG8gKTsNCg0KICAgIHJldHVybiB7c3R5bGVzOiBzdCwgY2xhc3NlczogbGluZUNsYXNzZXMuYmdDbGFzcyB8fCBsaW5lQ2xhc3Nlcy50ZXh0Q2xhc3MgPyBsaW5lQ2xhc3NlcyA6IG51bGx9DQogIH0NCg0KICBmdW5jdGlvbiBnZXRMaW5lU3R5bGVzKGNtLCBsaW5lLCB1cGRhdGVGcm9udGllcikgew0KICAgIGlmICghbGluZS5zdHlsZXMgfHwgbGluZS5zdHlsZXNbMF0gIT0gY20uc3RhdGUubW9kZUdlbikgew0KICAgICAgdmFyIGNvbnRleHQgPSBnZXRDb250ZXh0QmVmb3JlKGNtLCBsaW5lTm8obGluZSkpOw0KICAgICAgdmFyIHJlc2V0U3RhdGUgPSBsaW5lLnRleHQubGVuZ3RoID4gY20ub3B0aW9ucy5tYXhIaWdobGlnaHRMZW5ndGggJiYgY29weVN0YXRlKGNtLmRvYy5tb2RlLCBjb250ZXh0LnN0YXRlKTsNCiAgICAgIHZhciByZXN1bHQgPSBoaWdobGlnaHRMaW5lKGNtLCBsaW5lLCBjb250ZXh0KTsNCiAgICAgIGlmIChyZXNldFN0YXRlKSB7IGNvbnRleHQuc3RhdGUgPSByZXNldFN0YXRlOyB9DQogICAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBjb250ZXh0LnNhdmUoIXJlc2V0U3RhdGUpOw0KICAgICAgbGluZS5zdHlsZXMgPSByZXN1bHQuc3R5bGVzOw0KICAgICAgaWYgKHJlc3VsdC5jbGFzc2VzKSB7IGxpbmUuc3R5bGVDbGFzc2VzID0gcmVzdWx0LmNsYXNzZXM7IH0NCiAgICAgIGVsc2UgaWYgKGxpbmUuc3R5bGVDbGFzc2VzKSB7IGxpbmUuc3R5bGVDbGFzc2VzID0gbnVsbDsgfQ0KICAgICAgaWYgKHVwZGF0ZUZyb250aWVyID09PSBjbS5kb2MuaGlnaGxpZ2h0RnJvbnRpZXIpDQogICAgICAgIHsgY20uZG9jLm1vZGVGcm9udGllciA9IE1hdGgubWF4KGNtLmRvYy5tb2RlRnJvbnRpZXIsICsrY20uZG9jLmhpZ2hsaWdodEZyb250aWVyKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gbGluZS5zdHlsZXMNCiAgfQ0KDQogIGZ1bmN0aW9uIGdldENvbnRleHRCZWZvcmUoY20sIG4sIHByZWNpc2UpIHsNCiAgICB2YXIgZG9jID0gY20uZG9jLCBkaXNwbGF5ID0gY20uZGlzcGxheTsNCiAgICBpZiAoIWRvYy5tb2RlLnN0YXJ0U3RhdGUpIHsgcmV0dXJuIG5ldyBDb250ZXh0KGRvYywgdHJ1ZSwgbikgfQ0KICAgIHZhciBzdGFydCA9IGZpbmRTdGFydExpbmUoY20sIG4sIHByZWNpc2UpOw0KICAgIHZhciBzYXZlZCA9IHN0YXJ0ID4gZG9jLmZpcnN0ICYmIGdldExpbmUoZG9jLCBzdGFydCAtIDEpLnN0YXRlQWZ0ZXI7DQogICAgdmFyIGNvbnRleHQgPSBzYXZlZCA/IENvbnRleHQuZnJvbVNhdmVkKGRvYywgc2F2ZWQsIHN0YXJ0KSA6IG5ldyBDb250ZXh0KGRvYywgc3RhcnRTdGF0ZShkb2MubW9kZSksIHN0YXJ0KTsNCg0KICAgIGRvYy5pdGVyKHN0YXJ0LCBuLCBmdW5jdGlvbiAobGluZSkgew0KICAgICAgcHJvY2Vzc0xpbmUoY20sIGxpbmUudGV4dCwgY29udGV4dCk7DQogICAgICB2YXIgcG9zID0gY29udGV4dC5saW5lOw0KICAgICAgbGluZS5zdGF0ZUFmdGVyID0gcG9zID09IG4gLSAxIHx8IHBvcyAlIDUgPT0gMCB8fCBwb3MgPj0gZGlzcGxheS52aWV3RnJvbSAmJiBwb3MgPCBkaXNwbGF5LnZpZXdUbyA/IGNvbnRleHQuc2F2ZSgpIDogbnVsbDsNCiAgICAgIGNvbnRleHQubmV4dExpbmUoKTsNCiAgICB9KTsNCiAgICBpZiAocHJlY2lzZSkgeyBkb2MubW9kZUZyb250aWVyID0gY29udGV4dC5saW5lOyB9DQogICAgcmV0dXJuIGNvbnRleHQNCiAgfQ0KDQogIC8vIExpZ2h0d2VpZ2h0IGZvcm0gb2YgaGlnaGxpZ2h0IC0tIHByb2NlZWQgb3ZlciB0aGlzIGxpbmUgYW5kDQogIC8vIHVwZGF0ZSBzdGF0ZSwgYnV0IGRvbid0IHNhdmUgYSBzdHlsZSBhcnJheS4gVXNlZCBmb3IgbGluZXMgdGhhdA0KICAvLyBhcmVuJ3QgY3VycmVudGx5IHZpc2libGUuDQogIGZ1bmN0aW9uIHByb2Nlc3NMaW5lKGNtLCB0ZXh0LCBjb250ZXh0LCBzdGFydEF0KSB7DQogICAgdmFyIG1vZGUgPSBjbS5kb2MubW9kZTsNCiAgICB2YXIgc3RyZWFtID0gbmV3IFN0cmluZ1N0cmVhbSh0ZXh0LCBjbS5vcHRpb25zLnRhYlNpemUsIGNvbnRleHQpOw0KICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3MgPSBzdGFydEF0IHx8IDA7DQogICAgaWYgKHRleHQgPT0gIiIpIHsgY2FsbEJsYW5rTGluZShtb2RlLCBjb250ZXh0LnN0YXRlKTsgfQ0KICAgIHdoaWxlICghc3RyZWFtLmVvbCgpKSB7DQogICAgICByZWFkVG9rZW4obW9kZSwgc3RyZWFtLCBjb250ZXh0LnN0YXRlKTsNCiAgICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3M7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gY2FsbEJsYW5rTGluZShtb2RlLCBzdGF0ZSkgew0KICAgIGlmIChtb2RlLmJsYW5rTGluZSkgeyByZXR1cm4gbW9kZS5ibGFua0xpbmUoc3RhdGUpIH0NCiAgICBpZiAoIW1vZGUuaW5uZXJNb2RlKSB7IHJldHVybiB9DQogICAgdmFyIGlubmVyID0gaW5uZXJNb2RlKG1vZGUsIHN0YXRlKTsNCiAgICBpZiAoaW5uZXIubW9kZS5ibGFua0xpbmUpIHsgcmV0dXJuIGlubmVyLm1vZGUuYmxhbmtMaW5lKGlubmVyLnN0YXRlKSB9DQogIH0NCg0KICBmdW5jdGlvbiByZWFkVG9rZW4obW9kZSwgc3RyZWFtLCBzdGF0ZSwgaW5uZXIpIHsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IDEwOyBpKyspIHsNCiAgICAgIGlmIChpbm5lcikgeyBpbm5lclswXSA9IGlubmVyTW9kZShtb2RlLCBzdGF0ZSkubW9kZTsgfQ0KICAgICAgdmFyIHN0eWxlID0gbW9kZS50b2tlbihzdHJlYW0sIHN0YXRlKTsNCiAgICAgIGlmIChzdHJlYW0ucG9zID4gc3RyZWFtLnN0YXJ0KSB7IHJldHVybiBzdHlsZSB9DQogICAgfQ0KICAgIHRocm93IG5ldyBFcnJvcigiTW9kZSAiICsgbW9kZS5uYW1lICsgIiBmYWlsZWQgdG8gYWR2YW5jZSBzdHJlYW0uIikNCiAgfQ0KDQogIHZhciBUb2tlbiA9IGZ1bmN0aW9uKHN0cmVhbSwgdHlwZSwgc3RhdGUpIHsNCiAgICB0aGlzLnN0YXJ0ID0gc3RyZWFtLnN0YXJ0OyB0aGlzLmVuZCA9IHN0cmVhbS5wb3M7DQogICAgdGhpcy5zdHJpbmcgPSBzdHJlYW0uY3VycmVudCgpOw0KICAgIHRoaXMudHlwZSA9IHR5cGUgfHwgbnVsbDsNCiAgICB0aGlzLnN0YXRlID0gc3RhdGU7DQogIH07DQoNCiAgLy8gVXRpbGl0eSBmb3IgZ2V0VG9rZW5BdCBhbmQgZ2V0TGluZVRva2Vucw0KICBmdW5jdGlvbiB0YWtlVG9rZW4oY20sIHBvcywgcHJlY2lzZSwgYXNBcnJheSkgew0KICAgIHZhciBkb2MgPSBjbS5kb2MsIG1vZGUgPSBkb2MubW9kZSwgc3R5bGU7DQogICAgcG9zID0gY2xpcFBvcyhkb2MsIHBvcyk7DQogICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgcG9zLmxpbmUpLCBjb250ZXh0ID0gZ2V0Q29udGV4dEJlZm9yZShjbSwgcG9zLmxpbmUsIHByZWNpc2UpOw0KICAgIHZhciBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKGxpbmUudGV4dCwgY20ub3B0aW9ucy50YWJTaXplLCBjb250ZXh0KSwgdG9rZW5zOw0KICAgIGlmIChhc0FycmF5KSB7IHRva2VucyA9IFtdOyB9DQogICAgd2hpbGUgKChhc0FycmF5IHx8IHN0cmVhbS5wb3MgPCBwb3MuY2gpICYmICFzdHJlYW0uZW9sKCkpIHsNCiAgICAgIHN0cmVhbS5zdGFydCA9IHN0cmVhbS5wb3M7DQogICAgICBzdHlsZSA9IHJlYWRUb2tlbihtb2RlLCBzdHJlYW0sIGNvbnRleHQuc3RhdGUpOw0KICAgICAgaWYgKGFzQXJyYXkpIHsgdG9rZW5zLnB1c2gobmV3IFRva2VuKHN0cmVhbSwgc3R5bGUsIGNvcHlTdGF0ZShkb2MubW9kZSwgY29udGV4dC5zdGF0ZSkpKTsgfQ0KICAgIH0NCiAgICByZXR1cm4gYXNBcnJheSA/IHRva2VucyA6IG5ldyBUb2tlbihzdHJlYW0sIHN0eWxlLCBjb250ZXh0LnN0YXRlKQ0KICB9DQoNCiAgZnVuY3Rpb24gZXh0cmFjdExpbmVDbGFzc2VzKHR5cGUsIG91dHB1dCkgew0KICAgIGlmICh0eXBlKSB7IGZvciAoOzspIHsNCiAgICAgIHZhciBsaW5lQ2xhc3MgPSB0eXBlLm1hdGNoKC8oPzpefFxzKylsaW5lLShiYWNrZ3JvdW5kLSk/KFxTKykvKTsNCiAgICAgIGlmICghbGluZUNsYXNzKSB7IGJyZWFrIH0NCiAgICAgIHR5cGUgPSB0eXBlLnNsaWNlKDAsIGxpbmVDbGFzcy5pbmRleCkgKyB0eXBlLnNsaWNlKGxpbmVDbGFzcy5pbmRleCArIGxpbmVDbGFzc1swXS5sZW5ndGgpOw0KICAgICAgdmFyIHByb3AgPSBsaW5lQ2xhc3NbMV0gPyAiYmdDbGFzcyIgOiAidGV4dENsYXNzIjsNCiAgICAgIGlmIChvdXRwdXRbcHJvcF0gPT0gbnVsbCkNCiAgICAgICAgeyBvdXRwdXRbcHJvcF0gPSBsaW5lQ2xhc3NbMl07IH0NCiAgICAgIGVsc2UgaWYgKCEobmV3IFJlZ0V4cCgiKD86XnxccykiICsgbGluZUNsYXNzWzJdICsgIig/OiR8XHMpIikpLnRlc3Qob3V0cHV0W3Byb3BdKSkNCiAgICAgICAgeyBvdXRwdXRbcHJvcF0gKz0gIiAiICsgbGluZUNsYXNzWzJdOyB9DQogICAgfSB9DQogICAgcmV0dXJuIHR5cGUNCiAgfQ0KDQogIC8vIFJ1biB0aGUgZ2l2ZW4gbW9kZSdzIHBhcnNlciBvdmVyIGEgbGluZSwgY2FsbGluZyBmIGZvciBlYWNoIHRva2VuLg0KICBmdW5jdGlvbiBydW5Nb2RlKGNtLCB0ZXh0LCBtb2RlLCBjb250ZXh0LCBmLCBsaW5lQ2xhc3NlcywgZm9yY2VUb0VuZCkgew0KICAgIHZhciBmbGF0dGVuU3BhbnMgPSBtb2RlLmZsYXR0ZW5TcGFuczsNCiAgICBpZiAoZmxhdHRlblNwYW5zID09IG51bGwpIHsgZmxhdHRlblNwYW5zID0gY20ub3B0aW9ucy5mbGF0dGVuU3BhbnM7IH0NCiAgICB2YXIgY3VyU3RhcnQgPSAwLCBjdXJTdHlsZSA9IG51bGw7DQogICAgdmFyIHN0cmVhbSA9IG5ldyBTdHJpbmdTdHJlYW0odGV4dCwgY20ub3B0aW9ucy50YWJTaXplLCBjb250ZXh0KSwgc3R5bGU7DQogICAgdmFyIGlubmVyID0gY20ub3B0aW9ucy5hZGRNb2RlQ2xhc3MgJiYgW251bGxdOw0KICAgIGlmICh0ZXh0ID09ICIiKSB7IGV4dHJhY3RMaW5lQ2xhc3NlcyhjYWxsQmxhbmtMaW5lKG1vZGUsIGNvbnRleHQuc3RhdGUpLCBsaW5lQ2xhc3Nlcyk7IH0NCiAgICB3aGlsZSAoIXN0cmVhbS5lb2woKSkgew0KICAgICAgaWYgKHN0cmVhbS5wb3MgPiBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aCkgew0KICAgICAgICBmbGF0dGVuU3BhbnMgPSBmYWxzZTsNCiAgICAgICAgaWYgKGZvcmNlVG9FbmQpIHsgcHJvY2Vzc0xpbmUoY20sIHRleHQsIGNvbnRleHQsIHN0cmVhbS5wb3MpOyB9DQogICAgICAgIHN0cmVhbS5wb3MgPSB0ZXh0Lmxlbmd0aDsNCiAgICAgICAgc3R5bGUgPSBudWxsOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgc3R5bGUgPSBleHRyYWN0TGluZUNsYXNzZXMocmVhZFRva2VuKG1vZGUsIHN0cmVhbSwgY29udGV4dC5zdGF0ZSwgaW5uZXIpLCBsaW5lQ2xhc3Nlcyk7DQogICAgICB9DQogICAgICBpZiAoaW5uZXIpIHsNCiAgICAgICAgdmFyIG1OYW1lID0gaW5uZXJbMF0ubmFtZTsNCiAgICAgICAgaWYgKG1OYW1lKSB7IHN0eWxlID0gIm0tIiArIChzdHlsZSA/IG1OYW1lICsgIiAiICsgc3R5bGUgOiBtTmFtZSk7IH0NCiAgICAgIH0NCiAgICAgIGlmICghZmxhdHRlblNwYW5zIHx8IGN1clN0eWxlICE9IHN0eWxlKSB7DQogICAgICAgIHdoaWxlIChjdXJTdGFydCA8IHN0cmVhbS5zdGFydCkgew0KICAgICAgICAgIGN1clN0YXJ0ID0gTWF0aC5taW4oc3RyZWFtLnN0YXJ0LCBjdXJTdGFydCArIDUwMDApOw0KICAgICAgICAgIGYoY3VyU3RhcnQsIGN1clN0eWxlKTsNCiAgICAgICAgfQ0KICAgICAgICBjdXJTdHlsZSA9IHN0eWxlOw0KICAgICAgfQ0KICAgICAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvczsNCiAgICB9DQogICAgd2hpbGUgKGN1clN0YXJ0IDwgc3RyZWFtLnBvcykgew0KICAgICAgLy8gV2Via2l0IHNlZW1zIHRvIHJlZnVzZSB0byByZW5kZXIgdGV4dCBub2RlcyBsb25nZXIgdGhhbiA1NzQ0NA0KICAgICAgLy8gY2hhcmFjdGVycywgYW5kIHJldHVybnMgaW5hY2N1cmF0ZSBtZWFzdXJlbWVudHMgaW4gbm9kZXMNCiAgICAgIC8vIHN0YXJ0aW5nIGFyb3VuZCA1MDAwIGNoYXJzLg0KICAgICAgdmFyIHBvcyA9IE1hdGgubWluKHN0cmVhbS5wb3MsIGN1clN0YXJ0ICsgNTAwMCk7DQogICAgICBmKHBvcywgY3VyU3R5bGUpOw0KICAgICAgY3VyU3RhcnQgPSBwb3M7DQogICAgfQ0KICB9DQoNCiAgLy8gRmluZHMgdGhlIGxpbmUgdG8gc3RhcnQgd2l0aCB3aGVuIHN0YXJ0aW5nIGEgcGFyc2UuIFRyaWVzIHRvDQogIC8vIGZpbmQgYSBsaW5lIHdpdGggYSBzdGF0ZUFmdGVyLCBzbyB0aGF0IGl0IGNhbiBzdGFydCB3aXRoIGENCiAgLy8gdmFsaWQgc3RhdGUuIElmIHRoYXQgZmFpbHMsIGl0IHJldHVybnMgdGhlIGxpbmUgd2l0aCB0aGUNCiAgLy8gc21hbGxlc3QgaW5kZW50YXRpb24sIHdoaWNoIHRlbmRzIHRvIG5lZWQgdGhlIGxlYXN0IGNvbnRleHQgdG8NCiAgLy8gcGFyc2UgY29ycmVjdGx5Lg0KICBmdW5jdGlvbiBmaW5kU3RhcnRMaW5lKGNtLCBuLCBwcmVjaXNlKSB7DQogICAgdmFyIG1pbmluZGVudCwgbWlubGluZSwgZG9jID0gY20uZG9jOw0KICAgIHZhciBsaW0gPSBwcmVjaXNlID8gLTEgOiBuIC0gKGNtLmRvYy5tb2RlLmlubmVyTW9kZSA/IDEwMDAgOiAxMDApOw0KICAgIGZvciAodmFyIHNlYXJjaCA9IG47IHNlYXJjaCA+IGxpbTsgLS1zZWFyY2gpIHsNCiAgICAgIGlmIChzZWFyY2ggPD0gZG9jLmZpcnN0KSB7IHJldHVybiBkb2MuZmlyc3QgfQ0KICAgICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgc2VhcmNoIC0gMSksIGFmdGVyID0gbGluZS5zdGF0ZUFmdGVyOw0KICAgICAgaWYgKGFmdGVyICYmICghcHJlY2lzZSB8fCBzZWFyY2ggKyAoYWZ0ZXIgaW5zdGFuY2VvZiBTYXZlZENvbnRleHQgPyBhZnRlci5sb29rQWhlYWQgOiAwKSA8PSBkb2MubW9kZUZyb250aWVyKSkNCiAgICAgICAgeyByZXR1cm4gc2VhcmNoIH0NCiAgICAgIHZhciBpbmRlbnRlZCA9IGNvdW50Q29sdW1uKGxpbmUudGV4dCwgbnVsbCwgY20ub3B0aW9ucy50YWJTaXplKTsNCiAgICAgIGlmIChtaW5saW5lID09IG51bGwgfHwgbWluaW5kZW50ID4gaW5kZW50ZWQpIHsNCiAgICAgICAgbWlubGluZSA9IHNlYXJjaCAtIDE7DQogICAgICAgIG1pbmluZGVudCA9IGluZGVudGVkOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbWlubGluZQ0KICB9DQoNCiAgZnVuY3Rpb24gcmV0cmVhdEZyb250aWVyKGRvYywgbikgew0KICAgIGRvYy5tb2RlRnJvbnRpZXIgPSBNYXRoLm1pbihkb2MubW9kZUZyb250aWVyLCBuKTsNCiAgICBpZiAoZG9jLmhpZ2hsaWdodEZyb250aWVyIDwgbiAtIDEwKSB7IHJldHVybiB9DQogICAgdmFyIHN0YXJ0ID0gZG9jLmZpcnN0Ow0KICAgIGZvciAodmFyIGxpbmUgPSBuIC0gMTsgbGluZSA+IHN0YXJ0OyBsaW5lLS0pIHsNCiAgICAgIHZhciBzYXZlZCA9IGdldExpbmUoZG9jLCBsaW5lKS5zdGF0ZUFmdGVyOw0KICAgICAgLy8gY2hhbmdlIGlzIG9uIDMNCiAgICAgIC8vIHN0YXRlIG9uIGxpbmUgMSBsb29rZWQgYWhlYWQgMiAtLSBzbyBzYXcgMw0KICAgICAgLy8gdGVzdCAxICsgMiA8IDMgc2hvdWxkIGNvdmVyIHRoaXMNCiAgICAgIGlmIChzYXZlZCAmJiAoIShzYXZlZCBpbnN0YW5jZW9mIFNhdmVkQ29udGV4dCkgfHwgbGluZSArIHNhdmVkLmxvb2tBaGVhZCA8IG4pKSB7DQogICAgICAgIHN0YXJ0ID0gbGluZSArIDE7DQogICAgICAgIGJyZWFrDQogICAgICB9DQogICAgfQ0KICAgIGRvYy5oaWdobGlnaHRGcm9udGllciA9IE1hdGgubWluKGRvYy5oaWdobGlnaHRGcm9udGllciwgc3RhcnQpOw0KICB9DQoNCiAgLy8gT3B0aW1pemUgc29tZSBjb2RlIHdoZW4gdGhlc2UgZmVhdHVyZXMgYXJlIG5vdCB1c2VkLg0KICB2YXIgc2F3UmVhZE9ubHlTcGFucyA9IGZhbHNlLCBzYXdDb2xsYXBzZWRTcGFucyA9IGZhbHNlOw0KDQogIGZ1bmN0aW9uIHNlZVJlYWRPbmx5U3BhbnMoKSB7DQogICAgc2F3UmVhZE9ubHlTcGFucyA9IHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBzZWVDb2xsYXBzZWRTcGFucygpIHsNCiAgICBzYXdDb2xsYXBzZWRTcGFucyA9IHRydWU7DQogIH0NCg0KICAvLyBURVhUTUFSS0VSIFNQQU5TDQoNCiAgZnVuY3Rpb24gTWFya2VkU3BhbihtYXJrZXIsIGZyb20sIHRvKSB7DQogICAgdGhpcy5tYXJrZXIgPSBtYXJrZXI7DQogICAgdGhpcy5mcm9tID0gZnJvbTsgdGhpcy50byA9IHRvOw0KICB9DQoNCiAgLy8gU2VhcmNoIGFuIGFycmF5IG9mIHNwYW5zIGZvciBhIHNwYW4gbWF0Y2hpbmcgdGhlIGdpdmVuIG1hcmtlci4NCiAgZnVuY3Rpb24gZ2V0TWFya2VkU3BhbkZvcihzcGFucywgbWFya2VyKSB7DQogICAgaWYgKHNwYW5zKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpIHsNCiAgICAgIHZhciBzcGFuID0gc3BhbnNbaV07DQogICAgICBpZiAoc3Bhbi5tYXJrZXIgPT0gbWFya2VyKSB7IHJldHVybiBzcGFuIH0NCiAgICB9IH0NCiAgfQ0KICAvLyBSZW1vdmUgYSBzcGFuIGZyb20gYW4gYXJyYXksIHJldHVybmluZyB1bmRlZmluZWQgaWYgbm8gc3BhbnMgYXJlDQogIC8vIGxlZnQgKHdlIGRvbid0IHN0b3JlIGFycmF5cyBmb3IgbGluZXMgd2l0aG91dCBzcGFucykuDQogIGZ1bmN0aW9uIHJlbW92ZU1hcmtlZFNwYW4oc3BhbnMsIHNwYW4pIHsNCiAgICB2YXIgcjsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKQ0KICAgICAgeyBpZiAoc3BhbnNbaV0gIT0gc3BhbikgeyAociB8fCAociA9IFtdKSkucHVzaChzcGFuc1tpXSk7IH0gfQ0KICAgIHJldHVybiByDQogIH0NCiAgLy8gQWRkIGEgc3BhbiB0byBhIGxpbmUuDQogIGZ1bmN0aW9uIGFkZE1hcmtlZFNwYW4obGluZSwgc3Bhbikgew0KICAgIGxpbmUubWFya2VkU3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zID8gbGluZS5tYXJrZWRTcGFucy5jb25jYXQoW3NwYW5dKSA6IFtzcGFuXTsNCiAgICBzcGFuLm1hcmtlci5hdHRhY2hMaW5lKGxpbmUpOw0KICB9DQoNCiAgLy8gVXNlZCBmb3IgdGhlIGFsZ29yaXRobSB0aGF0IGFkanVzdHMgbWFya2VycyBmb3IgYSBjaGFuZ2UgaW4gdGhlDQogIC8vIGRvY3VtZW50LiBUaGVzZSBmdW5jdGlvbnMgY3V0IGFuIGFycmF5IG9mIHNwYW5zIGF0IGEgZ2l2ZW4NCiAgLy8gY2hhcmFjdGVyIHBvc2l0aW9uLCByZXR1cm5pbmcgYW4gYXJyYXkgb2YgcmVtYWluaW5nIGNodW5rcyAob3INCiAgLy8gdW5kZWZpbmVkIGlmIG5vdGhpbmcgcmVtYWlucykuDQogIGZ1bmN0aW9uIG1hcmtlZFNwYW5zQmVmb3JlKG9sZCwgc3RhcnRDaCwgaXNJbnNlcnQpIHsNCiAgICB2YXIgbnc7DQogICAgaWYgKG9sZCkgeyBmb3IgKHZhciBpID0gMDsgaSA8IG9sZC5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIHNwYW4gPSBvbGRbaV0sIG1hcmtlciA9IHNwYW4ubWFya2VyOw0KICAgICAgdmFyIHN0YXJ0c0JlZm9yZSA9IHNwYW4uZnJvbSA9PSBudWxsIHx8IChtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IHNwYW4uZnJvbSA8PSBzdGFydENoIDogc3Bhbi5mcm9tIDwgc3RhcnRDaCk7DQogICAgICBpZiAoc3RhcnRzQmVmb3JlIHx8IHNwYW4uZnJvbSA9PSBzdGFydENoICYmIG1hcmtlci50eXBlID09ICJib29rbWFyayIgJiYgKCFpc0luc2VydCB8fCAhc3Bhbi5tYXJrZXIuaW5zZXJ0TGVmdCkpIHsNCiAgICAgICAgdmFyIGVuZHNBZnRlciA9IHNwYW4udG8gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gc3Bhbi50byA+PSBzdGFydENoIDogc3Bhbi50byA+IHN0YXJ0Q2gpDQogICAgICAgIDsobncgfHwgKG53ID0gW10pKS5wdXNoKG5ldyBNYXJrZWRTcGFuKG1hcmtlciwgc3Bhbi5mcm9tLCBlbmRzQWZ0ZXIgPyBudWxsIDogc3Bhbi50bykpOw0KICAgICAgfQ0KICAgIH0gfQ0KICAgIHJldHVybiBudw0KICB9DQogIGZ1bmN0aW9uIG1hcmtlZFNwYW5zQWZ0ZXIob2xkLCBlbmRDaCwgaXNJbnNlcnQpIHsNCiAgICB2YXIgbnc7DQogICAgaWYgKG9sZCkgeyBmb3IgKHZhciBpID0gMDsgaSA8IG9sZC5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIHNwYW4gPSBvbGRbaV0sIG1hcmtlciA9IHNwYW4ubWFya2VyOw0KICAgICAgdmFyIGVuZHNBZnRlciA9IHNwYW4udG8gPT0gbnVsbCB8fCAobWFya2VyLmluY2x1c2l2ZVJpZ2h0ID8gc3Bhbi50byA+PSBlbmRDaCA6IHNwYW4udG8gPiBlbmRDaCk7DQogICAgICBpZiAoZW5kc0FmdGVyIHx8IHNwYW4uZnJvbSA9PSBlbmRDaCAmJiBtYXJrZXIudHlwZSA9PSAiYm9va21hcmsiICYmICghaXNJbnNlcnQgfHwgc3Bhbi5tYXJrZXIuaW5zZXJ0TGVmdCkpIHsNCiAgICAgICAgdmFyIHN0YXJ0c0JlZm9yZSA9IHNwYW4uZnJvbSA9PSBudWxsIHx8IChtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IHNwYW4uZnJvbSA8PSBlbmRDaCA6IHNwYW4uZnJvbSA8IGVuZENoKQ0KICAgICAgICA7KG53IHx8IChudyA9IFtdKSkucHVzaChuZXcgTWFya2VkU3BhbihtYXJrZXIsIHN0YXJ0c0JlZm9yZSA/IG51bGwgOiBzcGFuLmZyb20gLSBlbmRDaCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuLnRvID09IG51bGwgPyBudWxsIDogc3Bhbi50byAtIGVuZENoKSk7DQogICAgICB9DQogICAgfSB9DQogICAgcmV0dXJuIG53DQogIH0NCg0KICAvLyBHaXZlbiBhIGNoYW5nZSBvYmplY3QsIGNvbXB1dGUgdGhlIG5ldyBzZXQgb2YgbWFya2VyIHNwYW5zIHRoYXQNCiAgLy8gY292ZXIgdGhlIGxpbmUgaW4gd2hpY2ggdGhlIGNoYW5nZSB0b29rIHBsYWNlLiBSZW1vdmVzIHNwYW5zDQogIC8vIGVudGlyZWx5IHdpdGhpbiB0aGUgY2hhbmdlLCByZWNvbm5lY3RzIHNwYW5zIGJlbG9uZ2luZyB0byB0aGUNCiAgLy8gc2FtZSBtYXJrZXIgdGhhdCBhcHBlYXIgb24gYm90aCBzaWRlcyBvZiB0aGUgY2hhbmdlLCBhbmQgY3V0cyBvZmYNCiAgLy8gc3BhbnMgcGFydGlhbGx5IHdpdGhpbiB0aGUgY2hhbmdlLiBSZXR1cm5zIGFuIGFycmF5IG9mIHNwYW4NCiAgLy8gYXJyYXlzIHdpdGggb25lIGVsZW1lbnQgZm9yIGVhY2ggbGluZSBpbiAoYWZ0ZXIpIHRoZSBjaGFuZ2UuDQogIGZ1bmN0aW9uIHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpIHsNCiAgICBpZiAoY2hhbmdlLmZ1bGwpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHZhciBvbGRGaXJzdCA9IGlzTGluZShkb2MsIGNoYW5nZS5mcm9tLmxpbmUpICYmIGdldExpbmUoZG9jLCBjaGFuZ2UuZnJvbS5saW5lKS5tYXJrZWRTcGFuczsNCiAgICB2YXIgb2xkTGFzdCA9IGlzTGluZShkb2MsIGNoYW5nZS50by5saW5lKSAmJiBnZXRMaW5lKGRvYywgY2hhbmdlLnRvLmxpbmUpLm1hcmtlZFNwYW5zOw0KICAgIGlmICghb2xkRmlyc3QgJiYgIW9sZExhc3QpIHsgcmV0dXJuIG51bGwgfQ0KDQogICAgdmFyIHN0YXJ0Q2ggPSBjaGFuZ2UuZnJvbS5jaCwgZW5kQ2ggPSBjaGFuZ2UudG8uY2gsIGlzSW5zZXJ0ID0gY21wKGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pID09IDA7DQogICAgLy8gR2V0IHRoZSBzcGFucyB0aGF0ICdzdGljayBvdXQnIG9uIGJvdGggc2lkZXMNCiAgICB2YXIgZmlyc3QgPSBtYXJrZWRTcGFuc0JlZm9yZShvbGRGaXJzdCwgc3RhcnRDaCwgaXNJbnNlcnQpOw0KICAgIHZhciBsYXN0ID0gbWFya2VkU3BhbnNBZnRlcihvbGRMYXN0LCBlbmRDaCwgaXNJbnNlcnQpOw0KDQogICAgLy8gTmV4dCwgbWVyZ2UgdGhvc2UgdHdvIGVuZHMNCiAgICB2YXIgc2FtZUxpbmUgPSBjaGFuZ2UudGV4dC5sZW5ndGggPT0gMSwgb2Zmc2V0ID0gbHN0KGNoYW5nZS50ZXh0KS5sZW5ndGggKyAoc2FtZUxpbmUgPyBzdGFydENoIDogMCk7DQogICAgaWYgKGZpcnN0KSB7DQogICAgICAvLyBGaXggdXAgLnRvIHByb3BlcnRpZXMgb2YgZmlyc3QNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZmlyc3QubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgdmFyIHNwYW4gPSBmaXJzdFtpXTsNCiAgICAgICAgaWYgKHNwYW4udG8gPT0gbnVsbCkgew0KICAgICAgICAgIHZhciBmb3VuZCA9IGdldE1hcmtlZFNwYW5Gb3IobGFzdCwgc3Bhbi5tYXJrZXIpOw0KICAgICAgICAgIGlmICghZm91bmQpIHsgc3Bhbi50byA9IHN0YXJ0Q2g7IH0NCiAgICAgICAgICBlbHNlIGlmIChzYW1lTGluZSkgeyBzcGFuLnRvID0gZm91bmQudG8gPT0gbnVsbCA/IG51bGwgOiBmb3VuZC50byArIG9mZnNldDsgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICAgIGlmIChsYXN0KSB7DQogICAgICAvLyBGaXggdXAgLmZyb20gaW4gbGFzdCAob3IgbW92ZSB0aGVtIGludG8gZmlyc3QgaW4gY2FzZSBvZiBzYW1lTGluZSkNCiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGxhc3QubGVuZ3RoOyArK2kkMSkgew0KICAgICAgICB2YXIgc3BhbiQxID0gbGFzdFtpJDFdOw0KICAgICAgICBpZiAoc3BhbiQxLnRvICE9IG51bGwpIHsgc3BhbiQxLnRvICs9IG9mZnNldDsgfQ0KICAgICAgICBpZiAoc3BhbiQxLmZyb20gPT0gbnVsbCkgew0KICAgICAgICAgIHZhciBmb3VuZCQxID0gZ2V0TWFya2VkU3BhbkZvcihmaXJzdCwgc3BhbiQxLm1hcmtlcik7DQogICAgICAgICAgaWYgKCFmb3VuZCQxKSB7DQogICAgICAgICAgICBzcGFuJDEuZnJvbSA9IG9mZnNldDsNCiAgICAgICAgICAgIGlmIChzYW1lTGluZSkgeyAoZmlyc3QgfHwgKGZpcnN0ID0gW10pKS5wdXNoKHNwYW4kMSk7IH0NCiAgICAgICAgICB9DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc3BhbiQxLmZyb20gKz0gb2Zmc2V0Ow0KICAgICAgICAgIGlmIChzYW1lTGluZSkgeyAoZmlyc3QgfHwgKGZpcnN0ID0gW10pKS5wdXNoKHNwYW4kMSk7IH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgICAvLyBNYWtlIHN1cmUgd2UgZGlkbid0IGNyZWF0ZSBhbnkgemVyby1sZW5ndGggc3BhbnMNCiAgICBpZiAoZmlyc3QpIHsgZmlyc3QgPSBjbGVhckVtcHR5U3BhbnMoZmlyc3QpOyB9DQogICAgaWYgKGxhc3QgJiYgbGFzdCAhPSBmaXJzdCkgeyBsYXN0ID0gY2xlYXJFbXB0eVNwYW5zKGxhc3QpOyB9DQoNCiAgICB2YXIgbmV3TWFya2VycyA9IFtmaXJzdF07DQogICAgaWYgKCFzYW1lTGluZSkgew0KICAgICAgLy8gRmlsbCBnYXAgd2l0aCB3aG9sZS1saW5lLXNwYW5zDQogICAgICB2YXIgZ2FwID0gY2hhbmdlLnRleHQubGVuZ3RoIC0gMiwgZ2FwTWFya2VyczsNCiAgICAgIGlmIChnYXAgPiAwICYmIGZpcnN0KQ0KICAgICAgICB7IGZvciAodmFyIGkkMiA9IDA7IGkkMiA8IGZpcnN0Lmxlbmd0aDsgKytpJDIpDQogICAgICAgICAgeyBpZiAoZmlyc3RbaSQyXS50byA9PSBudWxsKQ0KICAgICAgICAgICAgeyAoZ2FwTWFya2VycyB8fCAoZ2FwTWFya2VycyA9IFtdKSkucHVzaChuZXcgTWFya2VkU3BhbihmaXJzdFtpJDJdLm1hcmtlciwgbnVsbCwgbnVsbCkpOyB9IH0gfQ0KICAgICAgZm9yICh2YXIgaSQzID0gMDsgaSQzIDwgZ2FwOyArK2kkMykNCiAgICAgICAgeyBuZXdNYXJrZXJzLnB1c2goZ2FwTWFya2Vycyk7IH0NCiAgICAgIG5ld01hcmtlcnMucHVzaChsYXN0KTsNCiAgICB9DQogICAgcmV0dXJuIG5ld01hcmtlcnMNCiAgfQ0KDQogIC8vIFJlbW92ZSBzcGFucyB0aGF0IGFyZSBlbXB0eSBhbmQgZG9uJ3QgaGF2ZSBhIGNsZWFyV2hlbkVtcHR5DQogIC8vIG9wdGlvbiBvZiBmYWxzZS4NCiAgZnVuY3Rpb24gY2xlYXJFbXB0eVNwYW5zKHNwYW5zKSB7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTsNCiAgICAgIGlmIChzcGFuLmZyb20gIT0gbnVsbCAmJiBzcGFuLmZyb20gPT0gc3Bhbi50byAmJiBzcGFuLm1hcmtlci5jbGVhcldoZW5FbXB0eSAhPT0gZmFsc2UpDQogICAgICAgIHsgc3BhbnMuc3BsaWNlKGktLSwgMSk7IH0NCiAgICB9DQogICAgaWYgKCFzcGFucy5sZW5ndGgpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHJldHVybiBzcGFucw0KICB9DQoNCiAgLy8gVXNlZCB0byAnY2xpcCcgb3V0IHJlYWRPbmx5IHJhbmdlcyB3aGVuIG1ha2luZyBhIGNoYW5nZS4NCiAgZnVuY3Rpb24gcmVtb3ZlUmVhZE9ubHlSYW5nZXMoZG9jLCBmcm9tLCB0bykgew0KICAgIHZhciBtYXJrZXJzID0gbnVsbDsNCiAgICBkb2MuaXRlcihmcm9tLmxpbmUsIHRvLmxpbmUgKyAxLCBmdW5jdGlvbiAobGluZSkgew0KICAgICAgaWYgKGxpbmUubWFya2VkU3BhbnMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLm1hcmtlZFNwYW5zLmxlbmd0aDsgKytpKSB7DQogICAgICAgIHZhciBtYXJrID0gbGluZS5tYXJrZWRTcGFuc1tpXS5tYXJrZXI7DQogICAgICAgIGlmIChtYXJrLnJlYWRPbmx5ICYmICghbWFya2VycyB8fCBpbmRleE9mKG1hcmtlcnMsIG1hcmspID09IC0xKSkNCiAgICAgICAgICB7IChtYXJrZXJzIHx8IChtYXJrZXJzID0gW10pKS5wdXNoKG1hcmspOyB9DQogICAgICB9IH0NCiAgICB9KTsNCiAgICBpZiAoIW1hcmtlcnMpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHZhciBwYXJ0cyA9IFt7ZnJvbTogZnJvbSwgdG86IHRvfV07DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXJrZXJzLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgbWsgPSBtYXJrZXJzW2ldLCBtID0gbWsuZmluZCgwKTsNCiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgcGFydHMubGVuZ3RoOyArK2opIHsNCiAgICAgICAgdmFyIHAgPSBwYXJ0c1tqXTsNCiAgICAgICAgaWYgKGNtcChwLnRvLCBtLmZyb20pIDwgMCB8fCBjbXAocC5mcm9tLCBtLnRvKSA+IDApIHsgY29udGludWUgfQ0KICAgICAgICB2YXIgbmV3UGFydHMgPSBbaiwgMV0sIGRmcm9tID0gY21wKHAuZnJvbSwgbS5mcm9tKSwgZHRvID0gY21wKHAudG8sIG0udG8pOw0KICAgICAgICBpZiAoZGZyb20gPCAwIHx8ICFtay5pbmNsdXNpdmVMZWZ0ICYmICFkZnJvbSkNCiAgICAgICAgICB7IG5ld1BhcnRzLnB1c2goe2Zyb206IHAuZnJvbSwgdG86IG0uZnJvbX0pOyB9DQogICAgICAgIGlmIChkdG8gPiAwIHx8ICFtay5pbmNsdXNpdmVSaWdodCAmJiAhZHRvKQ0KICAgICAgICAgIHsgbmV3UGFydHMucHVzaCh7ZnJvbTogbS50bywgdG86IHAudG99KTsgfQ0KICAgICAgICBwYXJ0cy5zcGxpY2UuYXBwbHkocGFydHMsIG5ld1BhcnRzKTsNCiAgICAgICAgaiArPSBuZXdQYXJ0cy5sZW5ndGggLSAzOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcGFydHMNCiAgfQ0KDQogIC8vIENvbm5lY3Qgb3IgZGlzY29ubmVjdCBzcGFucyBmcm9tIGEgbGluZS4NCiAgZnVuY3Rpb24gZGV0YWNoTWFya2VkU3BhbnMobGluZSkgew0KICAgIHZhciBzcGFucyA9IGxpbmUubWFya2VkU3BhbnM7DQogICAgaWYgKCFzcGFucykgeyByZXR1cm4gfQ0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BhbnMubGVuZ3RoOyArK2kpDQogICAgICB7IHNwYW5zW2ldLm1hcmtlci5kZXRhY2hMaW5lKGxpbmUpOyB9DQogICAgbGluZS5tYXJrZWRTcGFucyA9IG51bGw7DQogIH0NCiAgZnVuY3Rpb24gYXR0YWNoTWFya2VkU3BhbnMobGluZSwgc3BhbnMpIHsNCiAgICBpZiAoIXNwYW5zKSB7IHJldHVybiB9DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkNCiAgICAgIHsgc3BhbnNbaV0ubWFya2VyLmF0dGFjaExpbmUobGluZSk7IH0NCiAgICBsaW5lLm1hcmtlZFNwYW5zID0gc3BhbnM7DQogIH0NCg0KICAvLyBIZWxwZXJzIHVzZWQgd2hlbiBjb21wdXRpbmcgd2hpY2ggb3ZlcmxhcHBpbmcgY29sbGFwc2VkIHNwYW4NCiAgLy8gY291bnRzIGFzIHRoZSBsYXJnZXIgb25lLg0KICBmdW5jdGlvbiBleHRyYUxlZnQobWFya2VyKSB7IHJldHVybiBtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IC0xIDogMCB9DQogIGZ1bmN0aW9uIGV4dHJhUmlnaHQobWFya2VyKSB7IHJldHVybiBtYXJrZXIuaW5jbHVzaXZlUmlnaHQgPyAxIDogMCB9DQoNCiAgLy8gUmV0dXJucyBhIG51bWJlciBpbmRpY2F0aW5nIHdoaWNoIG9mIHR3byBvdmVybGFwcGluZyBjb2xsYXBzZWQNCiAgLy8gc3BhbnMgaXMgbGFyZ2VyIChhbmQgdGh1cyBpbmNsdWRlcyB0aGUgb3RoZXIpLiBGYWxscyBiYWNrIHRvDQogIC8vIGNvbXBhcmluZyBpZHMgd2hlbiB0aGUgc3BhbnMgY292ZXIgZXhhY3RseSB0aGUgc2FtZSByYW5nZS4NCiAgZnVuY3Rpb24gY29tcGFyZUNvbGxhcHNlZE1hcmtlcnMoYSwgYikgew0KICAgIHZhciBsZW5EaWZmID0gYS5saW5lcy5sZW5ndGggLSBiLmxpbmVzLmxlbmd0aDsNCiAgICBpZiAobGVuRGlmZiAhPSAwKSB7IHJldHVybiBsZW5EaWZmIH0NCiAgICB2YXIgYVBvcyA9IGEuZmluZCgpLCBiUG9zID0gYi5maW5kKCk7DQogICAgdmFyIGZyb21DbXAgPSBjbXAoYVBvcy5mcm9tLCBiUG9zLmZyb20pIHx8IGV4dHJhTGVmdChhKSAtIGV4dHJhTGVmdChiKTsNCiAgICBpZiAoZnJvbUNtcCkgeyByZXR1cm4gLWZyb21DbXAgfQ0KICAgIHZhciB0b0NtcCA9IGNtcChhUG9zLnRvLCBiUG9zLnRvKSB8fCBleHRyYVJpZ2h0KGEpIC0gZXh0cmFSaWdodChiKTsNCiAgICBpZiAodG9DbXApIHsgcmV0dXJuIHRvQ21wIH0NCiAgICByZXR1cm4gYi5pZCAtIGEuaWQNCiAgfQ0KDQogIC8vIEZpbmQgb3V0IHdoZXRoZXIgYSBsaW5lIGVuZHMgb3Igc3RhcnRzIGluIGEgY29sbGFwc2VkIHNwYW4uIElmDQogIC8vIHNvLCByZXR1cm4gdGhlIG1hcmtlciBmb3IgdGhhdCBzcGFuLg0KICBmdW5jdGlvbiBjb2xsYXBzZWRTcGFuQXRTaWRlKGxpbmUsIHN0YXJ0KSB7DQogICAgdmFyIHNwcyA9IHNhd0NvbGxhcHNlZFNwYW5zICYmIGxpbmUubWFya2VkU3BhbnMsIGZvdW5kOw0KICAgIGlmIChzcHMpIHsgZm9yICh2YXIgc3AgPSAodm9pZCAwKSwgaSA9IDA7IGkgPCBzcHMubGVuZ3RoOyArK2kpIHsNCiAgICAgIHNwID0gc3BzW2ldOw0KICAgICAgaWYgKHNwLm1hcmtlci5jb2xsYXBzZWQgJiYgKHN0YXJ0ID8gc3AuZnJvbSA6IHNwLnRvKSA9PSBudWxsICYmDQogICAgICAgICAgKCFmb3VuZCB8fCBjb21wYXJlQ29sbGFwc2VkTWFya2Vycyhmb3VuZCwgc3AubWFya2VyKSA8IDApKQ0KICAgICAgICB7IGZvdW5kID0gc3AubWFya2VyOyB9DQogICAgfSB9DQogICAgcmV0dXJuIGZvdW5kDQogIH0NCiAgZnVuY3Rpb24gY29sbGFwc2VkU3BhbkF0U3RhcnQobGluZSkgeyByZXR1cm4gY29sbGFwc2VkU3BhbkF0U2lkZShsaW5lLCB0cnVlKSB9DQogIGZ1bmN0aW9uIGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSB7IHJldHVybiBjb2xsYXBzZWRTcGFuQXRTaWRlKGxpbmUsIGZhbHNlKSB9DQoNCiAgZnVuY3Rpb24gY29sbGFwc2VkU3BhbkFyb3VuZChsaW5lLCBjaCkgew0KICAgIHZhciBzcHMgPSBzYXdDb2xsYXBzZWRTcGFucyAmJiBsaW5lLm1hcmtlZFNwYW5zLCBmb3VuZDsNCiAgICBpZiAoc3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgc3AgPSBzcHNbaV07DQogICAgICBpZiAoc3AubWFya2VyLmNvbGxhcHNlZCAmJiAoc3AuZnJvbSA9PSBudWxsIHx8IHNwLmZyb20gPCBjaCkgJiYgKHNwLnRvID09IG51bGwgfHwgc3AudG8gPiBjaCkgJiYNCiAgICAgICAgICAoIWZvdW5kIHx8IGNvbXBhcmVDb2xsYXBzZWRNYXJrZXJzKGZvdW5kLCBzcC5tYXJrZXIpIDwgMCkpIHsgZm91bmQgPSBzcC5tYXJrZXI7IH0NCiAgICB9IH0NCiAgICByZXR1cm4gZm91bmQNCiAgfQ0KDQogIC8vIFRlc3Qgd2hldGhlciB0aGVyZSBleGlzdHMgYSBjb2xsYXBzZWQgc3BhbiB0aGF0IHBhcnRpYWxseQ0KICAvLyBvdmVybGFwcyAoY292ZXJzIHRoZSBzdGFydCBvciBlbmQsIGJ1dCBub3QgYm90aCkgb2YgYSBuZXcgc3Bhbi4NCiAgLy8gU3VjaCBvdmVybGFwIGlzIG5vdCBhbGxvd2VkLg0KICBmdW5jdGlvbiBjb25mbGljdGluZ0NvbGxhcHNlZFJhbmdlKGRvYywgbGluZU5vJCQxLCBmcm9tLCB0bywgbWFya2VyKSB7DQogICAgdmFyIGxpbmUgPSBnZXRMaW5lKGRvYywgbGluZU5vJCQxKTsNCiAgICB2YXIgc3BzID0gc2F3Q29sbGFwc2VkU3BhbnMgJiYgbGluZS5tYXJrZWRTcGFuczsNCiAgICBpZiAoc3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgc3AgPSBzcHNbaV07DQogICAgICBpZiAoIXNwLm1hcmtlci5jb2xsYXBzZWQpIHsgY29udGludWUgfQ0KICAgICAgdmFyIGZvdW5kID0gc3AubWFya2VyLmZpbmQoMCk7DQogICAgICB2YXIgZnJvbUNtcCA9IGNtcChmb3VuZC5mcm9tLCBmcm9tKSB8fCBleHRyYUxlZnQoc3AubWFya2VyKSAtIGV4dHJhTGVmdChtYXJrZXIpOw0KICAgICAgdmFyIHRvQ21wID0gY21wKGZvdW5kLnRvLCB0bykgfHwgZXh0cmFSaWdodChzcC5tYXJrZXIpIC0gZXh0cmFSaWdodChtYXJrZXIpOw0KICAgICAgaWYgKGZyb21DbXAgPj0gMCAmJiB0b0NtcCA8PSAwIHx8IGZyb21DbXAgPD0gMCAmJiB0b0NtcCA+PSAwKSB7IGNvbnRpbnVlIH0NCiAgICAgIGlmIChmcm9tQ21wIDw9IDAgJiYgKHNwLm1hcmtlci5pbmNsdXNpdmVSaWdodCAmJiBtYXJrZXIuaW5jbHVzaXZlTGVmdCA/IGNtcChmb3VuZC50bywgZnJvbSkgPj0gMCA6IGNtcChmb3VuZC50bywgZnJvbSkgPiAwKSB8fA0KICAgICAgICAgIGZyb21DbXAgPj0gMCAmJiAoc3AubWFya2VyLmluY2x1c2l2ZVJpZ2h0ICYmIG1hcmtlci5pbmNsdXNpdmVMZWZ0ID8gY21wKGZvdW5kLmZyb20sIHRvKSA8PSAwIDogY21wKGZvdW5kLmZyb20sIHRvKSA8IDApKQ0KICAgICAgICB7IHJldHVybiB0cnVlIH0NCiAgICB9IH0NCiAgfQ0KDQogIC8vIEEgdmlzdWFsIGxpbmUgaXMgYSBsaW5lIGFzIGRyYXduIG9uIHRoZSBzY3JlZW4uIEZvbGRpbmcsIGZvcg0KICAvLyBleGFtcGxlLCBjYW4gY2F1c2UgbXVsdGlwbGUgbG9naWNhbCBsaW5lcyB0byBhcHBlYXIgb24gdGhlIHNhbWUNCiAgLy8gdmlzdWFsIGxpbmUuIFRoaXMgZmluZHMgdGhlIHN0YXJ0IG9mIHRoZSB2aXN1YWwgbGluZSB0aGF0IHRoZQ0KICAvLyBnaXZlbiBsaW5lIGlzIHBhcnQgb2YgKHVzdWFsbHkgdGhhdCBpcyB0aGUgbGluZSBpdHNlbGYpLg0KICBmdW5jdGlvbiB2aXN1YWxMaW5lKGxpbmUpIHsNCiAgICB2YXIgbWVyZ2VkOw0KICAgIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRTdGFydChsaW5lKSkNCiAgICAgIHsgbGluZSA9IG1lcmdlZC5maW5kKC0xLCB0cnVlKS5saW5lOyB9DQogICAgcmV0dXJuIGxpbmUNCiAgfQ0KDQogIGZ1bmN0aW9uIHZpc3VhbExpbmVFbmQobGluZSkgew0KICAgIHZhciBtZXJnZWQ7DQogICAgd2hpbGUgKG1lcmdlZCA9IGNvbGxhcHNlZFNwYW5BdEVuZChsaW5lKSkNCiAgICAgIHsgbGluZSA9IG1lcmdlZC5maW5kKDEsIHRydWUpLmxpbmU7IH0NCiAgICByZXR1cm4gbGluZQ0KICB9DQoNCiAgLy8gUmV0dXJucyBhbiBhcnJheSBvZiBsb2dpY2FsIGxpbmVzIHRoYXQgY29udGludWUgdGhlIHZpc3VhbCBsaW5lDQogIC8vIHN0YXJ0ZWQgYnkgdGhlIGFyZ3VtZW50LCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG5vIHN1Y2ggbGluZXMuDQogIGZ1bmN0aW9uIHZpc3VhbExpbmVDb250aW51ZWQobGluZSkgew0KICAgIHZhciBtZXJnZWQsIGxpbmVzOw0KICAgIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRFbmQobGluZSkpIHsNCiAgICAgIGxpbmUgPSBtZXJnZWQuZmluZCgxLCB0cnVlKS5saW5lDQogICAgICA7KGxpbmVzIHx8IChsaW5lcyA9IFtdKSkucHVzaChsaW5lKTsNCiAgICB9DQogICAgcmV0dXJuIGxpbmVzDQogIH0NCg0KICAvLyBHZXQgdGhlIGxpbmUgbnVtYmVyIG9mIHRoZSBzdGFydCBvZiB0aGUgdmlzdWFsIGxpbmUgdGhhdCB0aGUNCiAgLy8gZ2l2ZW4gbGluZSBudW1iZXIgaXMgcGFydCBvZi4NCiAgZnVuY3Rpb24gdmlzdWFsTGluZU5vKGRvYywgbGluZU4pIHsNCiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBsaW5lTiksIHZpcyA9IHZpc3VhbExpbmUobGluZSk7DQogICAgaWYgKGxpbmUgPT0gdmlzKSB7IHJldHVybiBsaW5lTiB9DQogICAgcmV0dXJuIGxpbmVObyh2aXMpDQogIH0NCg0KICAvLyBHZXQgdGhlIGxpbmUgbnVtYmVyIG9mIHRoZSBzdGFydCBvZiB0aGUgbmV4dCB2aXN1YWwgbGluZSBhZnRlcg0KICAvLyB0aGUgZ2l2ZW4gbGluZS4NCiAgZnVuY3Rpb24gdmlzdWFsTGluZUVuZE5vKGRvYywgbGluZU4pIHsNCiAgICBpZiAobGluZU4gPiBkb2MubGFzdExpbmUoKSkgeyByZXR1cm4gbGluZU4gfQ0KICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIGxpbmVOKSwgbWVyZ2VkOw0KICAgIGlmICghbGluZUlzSGlkZGVuKGRvYywgbGluZSkpIHsgcmV0dXJuIGxpbmVOIH0NCiAgICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0RW5kKGxpbmUpKQ0KICAgICAgeyBsaW5lID0gbWVyZ2VkLmZpbmQoMSwgdHJ1ZSkubGluZTsgfQ0KICAgIHJldHVybiBsaW5lTm8obGluZSkgKyAxDQogIH0NCg0KICAvLyBDb21wdXRlIHdoZXRoZXIgYSBsaW5lIGlzIGhpZGRlbi4gTGluZXMgY291bnQgYXMgaGlkZGVuIHdoZW4gdGhleQ0KICAvLyBhcmUgcGFydCBvZiBhIHZpc3VhbCBsaW5lIHRoYXQgc3RhcnRzIHdpdGggYW5vdGhlciBsaW5lLCBvciB3aGVuDQogIC8vIHRoZXkgYXJlIGVudGlyZWx5IGNvdmVyZWQgYnkgY29sbGFwc2VkLCBub24td2lkZ2V0IHNwYW4uDQogIGZ1bmN0aW9uIGxpbmVJc0hpZGRlbihkb2MsIGxpbmUpIHsNCiAgICB2YXIgc3BzID0gc2F3Q29sbGFwc2VkU3BhbnMgJiYgbGluZS5tYXJrZWRTcGFuczsNCiAgICBpZiAoc3BzKSB7IGZvciAodmFyIHNwID0gKHZvaWQgMCksIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKSB7DQogICAgICBzcCA9IHNwc1tpXTsNCiAgICAgIGlmICghc3AubWFya2VyLmNvbGxhcHNlZCkgeyBjb250aW51ZSB9DQogICAgICBpZiAoc3AuZnJvbSA9PSBudWxsKSB7IHJldHVybiB0cnVlIH0NCiAgICAgIGlmIChzcC5tYXJrZXIud2lkZ2V0Tm9kZSkgeyBjb250aW51ZSB9DQogICAgICBpZiAoc3AuZnJvbSA9PSAwICYmIHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0ICYmIGxpbmVJc0hpZGRlbklubmVyKGRvYywgbGluZSwgc3ApKQ0KICAgICAgICB7IHJldHVybiB0cnVlIH0NCiAgICB9IH0NCiAgfQ0KICBmdW5jdGlvbiBsaW5lSXNIaWRkZW5Jbm5lcihkb2MsIGxpbmUsIHNwYW4pIHsNCiAgICBpZiAoc3Bhbi50byA9PSBudWxsKSB7DQogICAgICB2YXIgZW5kID0gc3Bhbi5tYXJrZXIuZmluZCgxLCB0cnVlKTsNCiAgICAgIHJldHVybiBsaW5lSXNIaWRkZW5Jbm5lcihkb2MsIGVuZC5saW5lLCBnZXRNYXJrZWRTcGFuRm9yKGVuZC5saW5lLm1hcmtlZFNwYW5zLCBzcGFuLm1hcmtlcikpDQogICAgfQ0KICAgIGlmIChzcGFuLm1hcmtlci5pbmNsdXNpdmVSaWdodCAmJiBzcGFuLnRvID09IGxpbmUudGV4dC5sZW5ndGgpDQogICAgICB7IHJldHVybiB0cnVlIH0NCiAgICBmb3IgKHZhciBzcCA9ICh2b2lkIDApLCBpID0gMDsgaSA8IGxpbmUubWFya2VkU3BhbnMubGVuZ3RoOyArK2kpIHsNCiAgICAgIHNwID0gbGluZS5tYXJrZWRTcGFuc1tpXTsNCiAgICAgIGlmIChzcC5tYXJrZXIuY29sbGFwc2VkICYmICFzcC5tYXJrZXIud2lkZ2V0Tm9kZSAmJiBzcC5mcm9tID09IHNwYW4udG8gJiYNCiAgICAgICAgICAoc3AudG8gPT0gbnVsbCB8fCBzcC50byAhPSBzcGFuLmZyb20pICYmDQogICAgICAgICAgKHNwLm1hcmtlci5pbmNsdXNpdmVMZWZ0IHx8IHNwYW4ubWFya2VyLmluY2x1c2l2ZVJpZ2h0KSAmJg0KICAgICAgICAgIGxpbmVJc0hpZGRlbklubmVyKGRvYywgbGluZSwgc3ApKSB7IHJldHVybiB0cnVlIH0NCiAgICB9DQogIH0NCg0KICAvLyBGaW5kIHRoZSBoZWlnaHQgYWJvdmUgdGhlIGdpdmVuIGxpbmUuDQogIGZ1bmN0aW9uIGhlaWdodEF0TGluZShsaW5lT2JqKSB7DQogICAgbGluZU9iaiA9IHZpc3VhbExpbmUobGluZU9iaik7DQoNCiAgICB2YXIgaCA9IDAsIGNodW5rID0gbGluZU9iai5wYXJlbnQ7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVuay5saW5lcy5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIGxpbmUgPSBjaHVuay5saW5lc1tpXTsNCiAgICAgIGlmIChsaW5lID09IGxpbmVPYmopIHsgYnJlYWsgfQ0KICAgICAgZWxzZSB7IGggKz0gbGluZS5oZWlnaHQ7IH0NCiAgICB9DQogICAgZm9yICh2YXIgcCA9IGNodW5rLnBhcmVudDsgcDsgY2h1bmsgPSBwLCBwID0gY2h1bmsucGFyZW50KSB7DQogICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBwLmNoaWxkcmVuLmxlbmd0aDsgKytpJDEpIHsNCiAgICAgICAgdmFyIGN1ciA9IHAuY2hpbGRyZW5baSQxXTsNCiAgICAgICAgaWYgKGN1ciA9PSBjaHVuaykgeyBicmVhayB9DQogICAgICAgIGVsc2UgeyBoICs9IGN1ci5oZWlnaHQ7IH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGgNCiAgfQ0KDQogIC8vIENvbXB1dGUgdGhlIGNoYXJhY3RlciBsZW5ndGggb2YgYSBsaW5lLCB0YWtpbmcgaW50byBhY2NvdW50DQogIC8vIGNvbGxhcHNlZCByYW5nZXMgKHNlZSBtYXJrVGV4dCkgdGhhdCBtaWdodCBoaWRlIHBhcnRzLCBhbmQgam9pbg0KICAvLyBvdGhlciBsaW5lcyBvbnRvIGl0Lg0KICBmdW5jdGlvbiBsaW5lTGVuZ3RoKGxpbmUpIHsNCiAgICBpZiAobGluZS5oZWlnaHQgPT0gMCkgeyByZXR1cm4gMCB9DQogICAgdmFyIGxlbiA9IGxpbmUudGV4dC5sZW5ndGgsIG1lcmdlZCwgY3VyID0gbGluZTsNCiAgICB3aGlsZSAobWVyZ2VkID0gY29sbGFwc2VkU3BhbkF0U3RhcnQoY3VyKSkgew0KICAgICAgdmFyIGZvdW5kID0gbWVyZ2VkLmZpbmQoMCwgdHJ1ZSk7DQogICAgICBjdXIgPSBmb3VuZC5mcm9tLmxpbmU7DQogICAgICBsZW4gKz0gZm91bmQuZnJvbS5jaCAtIGZvdW5kLnRvLmNoOw0KICAgIH0NCiAgICBjdXIgPSBsaW5lOw0KICAgIHdoaWxlIChtZXJnZWQgPSBjb2xsYXBzZWRTcGFuQXRFbmQoY3VyKSkgew0KICAgICAgdmFyIGZvdW5kJDEgPSBtZXJnZWQuZmluZCgwLCB0cnVlKTsNCiAgICAgIGxlbiAtPSBjdXIudGV4dC5sZW5ndGggLSBmb3VuZCQxLmZyb20uY2g7DQogICAgICBjdXIgPSBmb3VuZCQxLnRvLmxpbmU7DQogICAgICBsZW4gKz0gY3VyLnRleHQubGVuZ3RoIC0gZm91bmQkMS50by5jaDsNCiAgICB9DQogICAgcmV0dXJuIGxlbg0KICB9DQoNCiAgLy8gRmluZCB0aGUgbG9uZ2VzdCBsaW5lIGluIHRoZSBkb2N1bWVudC4NCiAgZnVuY3Rpb24gZmluZE1heExpbmUoY20pIHsNCiAgICB2YXIgZCA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYzsNCiAgICBkLm1heExpbmUgPSBnZXRMaW5lKGRvYywgZG9jLmZpcnN0KTsNCiAgICBkLm1heExpbmVMZW5ndGggPSBsaW5lTGVuZ3RoKGQubWF4TGluZSk7DQogICAgZC5tYXhMaW5lQ2hhbmdlZCA9IHRydWU7DQogICAgZG9jLml0ZXIoZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgIHZhciBsZW4gPSBsaW5lTGVuZ3RoKGxpbmUpOw0KICAgICAgaWYgKGxlbiA+IGQubWF4TGluZUxlbmd0aCkgew0KICAgICAgICBkLm1heExpbmVMZW5ndGggPSBsZW47DQogICAgICAgIGQubWF4TGluZSA9IGxpbmU7DQogICAgICB9DQogICAgfSk7DQogIH0NCg0KICAvLyBMSU5FIERBVEEgU1RSVUNUVVJFDQoNCiAgLy8gTGluZSBvYmplY3RzLiBUaGVzZSBob2xkIHN0YXRlIHJlbGF0ZWQgdG8gYSBsaW5lLCBpbmNsdWRpbmcNCiAgLy8gaGlnaGxpZ2h0aW5nIGluZm8gKHRoZSBzdHlsZXMgYXJyYXkpLg0KICB2YXIgTGluZSA9IGZ1bmN0aW9uKHRleHQsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCkgew0KICAgIHRoaXMudGV4dCA9IHRleHQ7DQogICAgYXR0YWNoTWFya2VkU3BhbnModGhpcywgbWFya2VkU3BhbnMpOw0KICAgIHRoaXMuaGVpZ2h0ID0gZXN0aW1hdGVIZWlnaHQgPyBlc3RpbWF0ZUhlaWdodCh0aGlzKSA6IDE7DQogIH07DQoNCiAgTGluZS5wcm90b3R5cGUubGluZU5vID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbGluZU5vKHRoaXMpIH07DQogIGV2ZW50TWl4aW4oTGluZSk7DQoNCiAgLy8gQ2hhbmdlIHRoZSBjb250ZW50ICh0ZXh0LCBtYXJrZXJzKSBvZiBhIGxpbmUuIEF1dG9tYXRpY2FsbHkNCiAgLy8gaW52YWxpZGF0ZXMgY2FjaGVkIGluZm9ybWF0aW9uIGFuZCB0cmllcyB0byByZS1lc3RpbWF0ZSB0aGUNCiAgLy8gbGluZSdzIGhlaWdodC4NCiAgZnVuY3Rpb24gdXBkYXRlTGluZShsaW5lLCB0ZXh0LCBtYXJrZWRTcGFucywgZXN0aW1hdGVIZWlnaHQpIHsNCiAgICBsaW5lLnRleHQgPSB0ZXh0Ow0KICAgIGlmIChsaW5lLnN0YXRlQWZ0ZXIpIHsgbGluZS5zdGF0ZUFmdGVyID0gbnVsbDsgfQ0KICAgIGlmIChsaW5lLnN0eWxlcykgeyBsaW5lLnN0eWxlcyA9IG51bGw7IH0NCiAgICBpZiAobGluZS5vcmRlciAhPSBudWxsKSB7IGxpbmUub3JkZXIgPSBudWxsOyB9DQogICAgZGV0YWNoTWFya2VkU3BhbnMobGluZSk7DQogICAgYXR0YWNoTWFya2VkU3BhbnMobGluZSwgbWFya2VkU3BhbnMpOw0KICAgIHZhciBlc3RIZWlnaHQgPSBlc3RpbWF0ZUhlaWdodCA/IGVzdGltYXRlSGVpZ2h0KGxpbmUpIDogMTsNCiAgICBpZiAoZXN0SGVpZ2h0ICE9IGxpbmUuaGVpZ2h0KSB7IHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgZXN0SGVpZ2h0KTsgfQ0KICB9DQoNCiAgLy8gRGV0YWNoIGEgbGluZSBmcm9tIHRoZSBkb2N1bWVudCB0cmVlIGFuZCBpdHMgbWFya2Vycy4NCiAgZnVuY3Rpb24gY2xlYW5VcExpbmUobGluZSkgew0KICAgIGxpbmUucGFyZW50ID0gbnVsbDsNCiAgICBkZXRhY2hNYXJrZWRTcGFucyhsaW5lKTsNCiAgfQ0KDQogIC8vIENvbnZlcnQgYSBzdHlsZSBhcyByZXR1cm5lZCBieSBhIG1vZGUgKGVpdGhlciBudWxsLCBvciBhIHN0cmluZw0KICAvLyBjb250YWluaW5nIG9uZSBvciBtb3JlIHN0eWxlcykgdG8gYSBDU1Mgc3R5bGUuIFRoaXMgaXMgY2FjaGVkLA0KICAvLyBhbmQgYWxzbyBsb29rcyBmb3IgbGluZS13aWRlIHN0eWxlcy4NCiAgdmFyIHN0eWxlVG9DbGFzc0NhY2hlID0ge30sIHN0eWxlVG9DbGFzc0NhY2hlV2l0aE1vZGUgPSB7fTsNCiAgZnVuY3Rpb24gaW50ZXJwcmV0VG9rZW5TdHlsZShzdHlsZSwgb3B0aW9ucykgew0KICAgIGlmICghc3R5bGUgfHwgL15ccyokLy50ZXN0KHN0eWxlKSkgeyByZXR1cm4gbnVsbCB9DQogICAgdmFyIGNhY2hlID0gb3B0aW9ucy5hZGRNb2RlQ2xhc3MgPyBzdHlsZVRvQ2xhc3NDYWNoZVdpdGhNb2RlIDogc3R5bGVUb0NsYXNzQ2FjaGU7DQogICAgcmV0dXJuIGNhY2hlW3N0eWxlXSB8fA0KICAgICAgKGNhY2hlW3N0eWxlXSA9IHN0eWxlLnJlcGxhY2UoL1xTKy9nLCAiY20tJCYiKSkNCiAgfQ0KDQogIC8vIFJlbmRlciB0aGUgRE9NIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB0ZXh0IG9mIGEgbGluZS4gQWxzbyBidWlsZHMNCiAgLy8gdXAgYSAnbGluZSBtYXAnLCB3aGljaCBwb2ludHMgYXQgdGhlIERPTSBub2RlcyB0aGF0IHJlcHJlc2VudA0KICAvLyBzcGVjaWZpYyBzdHJldGNoZXMgb2YgdGV4dCwgYW5kIGlzIHVzZWQgYnkgdGhlIG1lYXN1cmluZyBjb2RlLg0KICAvLyBUaGUgcmV0dXJuZWQgb2JqZWN0IGNvbnRhaW5zIHRoZSBET00gbm9kZSwgdGhpcyBtYXAsIGFuZA0KICAvLyBpbmZvcm1hdGlvbiBhYm91dCBsaW5lLXdpZGUgc3R5bGVzIHRoYXQgd2VyZSBzZXQgYnkgdGhlIG1vZGUuDQogIGZ1bmN0aW9uIGJ1aWxkTGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KSB7DQogICAgLy8gVGhlIHBhZGRpbmctcmlnaHQgZm9yY2VzIHRoZSBlbGVtZW50IHRvIGhhdmUgYSAnYm9yZGVyJywgd2hpY2gNCiAgICAvLyBpcyBuZWVkZWQgb24gV2Via2l0IHRvIGJlIGFibGUgdG8gZ2V0IGxpbmUtbGV2ZWwgYm91bmRpbmcNCiAgICAvLyByZWN0YW5nbGVzIGZvciBpdCAoaW4gbWVhc3VyZUNoYXIpLg0KICAgIHZhciBjb250ZW50ID0gZWx0UCgic3BhbiIsIG51bGwsIG51bGwsIHdlYmtpdCA/ICJwYWRkaW5nLXJpZ2h0OiAuMXB4IiA6IG51bGwpOw0KICAgIHZhciBidWlsZGVyID0ge3ByZTogZWx0UCgicHJlIiwgW2NvbnRlbnRdLCAiQ29kZU1pcnJvci1saW5lIiksIGNvbnRlbnQ6IGNvbnRlbnQsDQogICAgICAgICAgICAgICAgICAgY29sOiAwLCBwb3M6IDAsIGNtOiBjbSwNCiAgICAgICAgICAgICAgICAgICB0cmFpbGluZ1NwYWNlOiBmYWxzZSwNCiAgICAgICAgICAgICAgICAgICBzcGxpdFNwYWNlczogY20uZ2V0T3B0aW9uKCJsaW5lV3JhcHBpbmciKX07DQogICAgbGluZVZpZXcubWVhc3VyZSA9IHt9Ow0KDQogICAgLy8gSXRlcmF0ZSBvdmVyIHRoZSBsb2dpY2FsIGxpbmVzIHRoYXQgbWFrZSB1cCB0aGlzIHZpc3VhbCBsaW5lLg0KICAgIGZvciAodmFyIGkgPSAwOyBpIDw9IChsaW5lVmlldy5yZXN0ID8gbGluZVZpZXcucmVzdC5sZW5ndGggOiAwKTsgaSsrKSB7DQogICAgICB2YXIgbGluZSA9IGkgPyBsaW5lVmlldy5yZXN0W2kgLSAxXSA6IGxpbmVWaWV3LmxpbmUsIG9yZGVyID0gKHZvaWQgMCk7DQogICAgICBidWlsZGVyLnBvcyA9IDA7DQogICAgICBidWlsZGVyLmFkZFRva2VuID0gYnVpbGRUb2tlbjsNCiAgICAgIC8vIE9wdGlvbmFsbHkgd2lyZSBpbiBzb21lIGhhY2tzIGludG8gdGhlIHRva2VuLXJlbmRlcmluZw0KICAgICAgLy8gYWxnb3JpdGhtLCB0byBkZWFsIHdpdGggYnJvd3NlciBxdWlya3MuDQogICAgICBpZiAoaGFzQmFkQmlkaVJlY3RzKGNtLmRpc3BsYXkubWVhc3VyZSkgJiYgKG9yZGVyID0gZ2V0T3JkZXIobGluZSwgY20uZG9jLmRpcmVjdGlvbikpKQ0KICAgICAgICB7IGJ1aWxkZXIuYWRkVG9rZW4gPSBidWlsZFRva2VuQmFkQmlkaShidWlsZGVyLmFkZFRva2VuLCBvcmRlcik7IH0NCiAgICAgIGJ1aWxkZXIubWFwID0gW107DQogICAgICB2YXIgYWxsb3dGcm9udGllclVwZGF0ZSA9IGxpbmVWaWV3ICE9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCAmJiBsaW5lTm8obGluZSk7DQogICAgICBpbnNlcnRMaW5lQ29udGVudChsaW5lLCBidWlsZGVyLCBnZXRMaW5lU3R5bGVzKGNtLCBsaW5lLCBhbGxvd0Zyb250aWVyVXBkYXRlKSk7DQogICAgICBpZiAobGluZS5zdHlsZUNsYXNzZXMpIHsNCiAgICAgICAgaWYgKGxpbmUuc3R5bGVDbGFzc2VzLmJnQ2xhc3MpDQogICAgICAgICAgeyBidWlsZGVyLmJnQ2xhc3MgPSBqb2luQ2xhc3NlcyhsaW5lLnN0eWxlQ2xhc3Nlcy5iZ0NsYXNzLCBidWlsZGVyLmJnQ2xhc3MgfHwgIiIpOyB9DQogICAgICAgIGlmIChsaW5lLnN0eWxlQ2xhc3Nlcy50ZXh0Q2xhc3MpDQogICAgICAgICAgeyBidWlsZGVyLnRleHRDbGFzcyA9IGpvaW5DbGFzc2VzKGxpbmUuc3R5bGVDbGFzc2VzLnRleHRDbGFzcywgYnVpbGRlci50ZXh0Q2xhc3MgfHwgIiIpOyB9DQogICAgICB9DQoNCiAgICAgIC8vIEVuc3VyZSBhdCBsZWFzdCBhIHNpbmdsZSBub2RlIGlzIHByZXNlbnQsIGZvciBtZWFzdXJpbmcuDQogICAgICBpZiAoYnVpbGRlci5tYXAubGVuZ3RoID09IDApDQogICAgICAgIHsgYnVpbGRlci5tYXAucHVzaCgwLCAwLCBidWlsZGVyLmNvbnRlbnQuYXBwZW5kQ2hpbGQoemVyb1dpZHRoRWxlbWVudChjbS5kaXNwbGF5Lm1lYXN1cmUpKSk7IH0NCg0KICAgICAgLy8gU3RvcmUgdGhlIG1hcCBhbmQgYSBjYWNoZSBvYmplY3QgZm9yIHRoZSBjdXJyZW50IGxvZ2ljYWwgbGluZQ0KICAgICAgaWYgKGkgPT0gMCkgew0KICAgICAgICBsaW5lVmlldy5tZWFzdXJlLm1hcCA9IGJ1aWxkZXIubWFwOw0KICAgICAgICBsaW5lVmlldy5tZWFzdXJlLmNhY2hlID0ge307DQogICAgICB9IGVsc2Ugew0KICAobGluZVZpZXcubWVhc3VyZS5tYXBzIHx8IChsaW5lVmlldy5tZWFzdXJlLm1hcHMgPSBbXSkpLnB1c2goYnVpbGRlci5tYXApDQogICAgICAgIDsobGluZVZpZXcubWVhc3VyZS5jYWNoZXMgfHwgKGxpbmVWaWV3Lm1lYXN1cmUuY2FjaGVzID0gW10pKS5wdXNoKHt9KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICAvLyBTZWUgaXNzdWUgIzI5MDENCiAgICBpZiAod2Via2l0KSB7DQogICAgICB2YXIgbGFzdCA9IGJ1aWxkZXIuY29udGVudC5sYXN0Q2hpbGQ7DQogICAgICBpZiAoL1xiY20tdGFiXGIvLnRlc3QobGFzdC5jbGFzc05hbWUpIHx8IChsYXN0LnF1ZXJ5U2VsZWN0b3IgJiYgbGFzdC5xdWVyeVNlbGVjdG9yKCIuY20tdGFiIikpKQ0KICAgICAgICB7IGJ1aWxkZXIuY29udGVudC5jbGFzc05hbWUgPSAiY20tdGFiLXdyYXAtaGFjayI7IH0NCiAgICB9DQoNCiAgICBzaWduYWwoY20sICJyZW5kZXJMaW5lIiwgY20sIGxpbmVWaWV3LmxpbmUsIGJ1aWxkZXIucHJlKTsNCiAgICBpZiAoYnVpbGRlci5wcmUuY2xhc3NOYW1lKQ0KICAgICAgeyBidWlsZGVyLnRleHRDbGFzcyA9IGpvaW5DbGFzc2VzKGJ1aWxkZXIucHJlLmNsYXNzTmFtZSwgYnVpbGRlci50ZXh0Q2xhc3MgfHwgIiIpOyB9DQoNCiAgICByZXR1cm4gYnVpbGRlcg0KICB9DQoNCiAgZnVuY3Rpb24gZGVmYXVsdFNwZWNpYWxDaGFyUGxhY2Vob2xkZXIoY2gpIHsNCiAgICB2YXIgdG9rZW4gPSBlbHQoInNwYW4iLCAiXHUyMDIyIiwgImNtLWludmFsaWRjaGFyIik7DQogICAgdG9rZW4udGl0bGUgPSAiXFx1IiArIGNoLmNoYXJDb2RlQXQoMCkudG9TdHJpbmcoMTYpOw0KICAgIHRva2VuLnNldEF0dHJpYnV0ZSgiYXJpYS1sYWJlbCIsIHRva2VuLnRpdGxlKTsNCiAgICByZXR1cm4gdG9rZW4NCiAgfQ0KDQogIC8vIEJ1aWxkIHVwIHRoZSBET00gcmVwcmVzZW50YXRpb24gZm9yIGEgc2luZ2xlIHRva2VuLCBhbmQgYWRkIGl0IHRvDQogIC8vIHRoZSBsaW5lIG1hcC4gVGFrZXMgY2FyZSB0byByZW5kZXIgc3BlY2lhbCBjaGFyYWN0ZXJzIHNlcGFyYXRlbHkuDQogIGZ1bmN0aW9uIGJ1aWxkVG9rZW4oYnVpbGRlciwgdGV4dCwgc3R5bGUsIHN0YXJ0U3R5bGUsIGVuZFN0eWxlLCBjc3MsIGF0dHJpYnV0ZXMpIHsNCiAgICBpZiAoIXRleHQpIHsgcmV0dXJuIH0NCiAgICB2YXIgZGlzcGxheVRleHQgPSBidWlsZGVyLnNwbGl0U3BhY2VzID8gc3BsaXRTcGFjZXModGV4dCwgYnVpbGRlci50cmFpbGluZ1NwYWNlKSA6IHRleHQ7DQogICAgdmFyIHNwZWNpYWwgPSBidWlsZGVyLmNtLnN0YXRlLnNwZWNpYWxDaGFycywgbXVzdFdyYXAgPSBmYWxzZTsNCiAgICB2YXIgY29udGVudDsNCiAgICBpZiAoIXNwZWNpYWwudGVzdCh0ZXh0KSkgew0KICAgICAgYnVpbGRlci5jb2wgKz0gdGV4dC5sZW5ndGg7DQogICAgICBjb250ZW50ID0gZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoZGlzcGxheVRleHQpOw0KICAgICAgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyB0ZXh0Lmxlbmd0aCwgY29udGVudCk7DQogICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIHsgbXVzdFdyYXAgPSB0cnVlOyB9DQogICAgICBidWlsZGVyLnBvcyArPSB0ZXh0Lmxlbmd0aDsNCiAgICB9IGVsc2Ugew0KICAgICAgY29udGVudCA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICAgIHZhciBwb3MgPSAwOw0KICAgICAgd2hpbGUgKHRydWUpIHsNCiAgICAgICAgc3BlY2lhbC5sYXN0SW5kZXggPSBwb3M7DQogICAgICAgIHZhciBtID0gc3BlY2lhbC5leGVjKHRleHQpOw0KICAgICAgICB2YXIgc2tpcHBlZCA9IG0gPyBtLmluZGV4IC0gcG9zIDogdGV4dC5sZW5ndGggLSBwb3M7DQogICAgICAgIGlmIChza2lwcGVkKSB7DQogICAgICAgICAgdmFyIHR4dCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGRpc3BsYXlUZXh0LnNsaWNlKHBvcywgcG9zICsgc2tpcHBlZCkpOw0KICAgICAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgOSkgeyBjb250ZW50LmFwcGVuZENoaWxkKGVsdCgic3BhbiIsIFt0eHRdKSk7IH0NCiAgICAgICAgICBlbHNlIHsgY29udGVudC5hcHBlbmRDaGlsZCh0eHQpOyB9DQogICAgICAgICAgYnVpbGRlci5tYXAucHVzaChidWlsZGVyLnBvcywgYnVpbGRlci5wb3MgKyBza2lwcGVkLCB0eHQpOw0KICAgICAgICAgIGJ1aWxkZXIuY29sICs9IHNraXBwZWQ7DQogICAgICAgICAgYnVpbGRlci5wb3MgKz0gc2tpcHBlZDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW0pIHsgYnJlYWsgfQ0KICAgICAgICBwb3MgKz0gc2tpcHBlZCArIDE7DQogICAgICAgIHZhciB0eHQkMSA9ICh2b2lkIDApOw0KICAgICAgICBpZiAobVswXSA9PSAiXHQiKSB7DQogICAgICAgICAgdmFyIHRhYlNpemUgPSBidWlsZGVyLmNtLm9wdGlvbnMudGFiU2l6ZSwgdGFiV2lkdGggPSB0YWJTaXplIC0gYnVpbGRlci5jb2wgJSB0YWJTaXplOw0KICAgICAgICAgIHR4dCQxID0gY29udGVudC5hcHBlbmRDaGlsZChlbHQoInNwYW4iLCBzcGFjZVN0cih0YWJXaWR0aCksICJjbS10YWIiKSk7DQogICAgICAgICAgdHh0JDEuc2V0QXR0cmlidXRlKCJyb2xlIiwgInByZXNlbnRhdGlvbiIpOw0KICAgICAgICAgIHR4dCQxLnNldEF0dHJpYnV0ZSgiY20tdGV4dCIsICJcdCIpOw0KICAgICAgICAgIGJ1aWxkZXIuY29sICs9IHRhYldpZHRoOw0KICAgICAgICB9IGVsc2UgaWYgKG1bMF0gPT0gIlxyIiB8fCBtWzBdID09ICJcbiIpIHsNCiAgICAgICAgICB0eHQkMSA9IGNvbnRlbnQuYXBwZW5kQ2hpbGQoZWx0KCJzcGFuIiwgbVswXSA9PSAiXHIiID8gIlx1MjQwZCIgOiAiXHUyNDI0IiwgImNtLWludmFsaWRjaGFyIikpOw0KICAgICAgICAgIHR4dCQxLnNldEF0dHJpYnV0ZSgiY20tdGV4dCIsIG1bMF0pOw0KICAgICAgICAgIGJ1aWxkZXIuY29sICs9IDE7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgdHh0JDEgPSBidWlsZGVyLmNtLm9wdGlvbnMuc3BlY2lhbENoYXJQbGFjZWhvbGRlcihtWzBdKTsNCiAgICAgICAgICB0eHQkMS5zZXRBdHRyaWJ1dGUoImNtLXRleHQiLCBtWzBdKTsNCiAgICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIHsgY29udGVudC5hcHBlbmRDaGlsZChlbHQoInNwYW4iLCBbdHh0JDFdKSk7IH0NCiAgICAgICAgICBlbHNlIHsgY29udGVudC5hcHBlbmRDaGlsZCh0eHQkMSk7IH0NCiAgICAgICAgICBidWlsZGVyLmNvbCArPSAxOw0KICAgICAgICB9DQogICAgICAgIGJ1aWxkZXIubWFwLnB1c2goYnVpbGRlci5wb3MsIGJ1aWxkZXIucG9zICsgMSwgdHh0JDEpOw0KICAgICAgICBidWlsZGVyLnBvcysrOw0KICAgICAgfQ0KICAgIH0NCiAgICBidWlsZGVyLnRyYWlsaW5nU3BhY2UgPSBkaXNwbGF5VGV4dC5jaGFyQ29kZUF0KHRleHQubGVuZ3RoIC0gMSkgPT0gMzI7DQogICAgaWYgKHN0eWxlIHx8IHN0YXJ0U3R5bGUgfHwgZW5kU3R5bGUgfHwgbXVzdFdyYXAgfHwgY3NzKSB7DQogICAgICB2YXIgZnVsbFN0eWxlID0gc3R5bGUgfHwgIiI7DQogICAgICBpZiAoc3RhcnRTdHlsZSkgeyBmdWxsU3R5bGUgKz0gc3RhcnRTdHlsZTsgfQ0KICAgICAgaWYgKGVuZFN0eWxlKSB7IGZ1bGxTdHlsZSArPSBlbmRTdHlsZTsgfQ0KICAgICAgdmFyIHRva2VuID0gZWx0KCJzcGFuIiwgW2NvbnRlbnRdLCBmdWxsU3R5bGUsIGNzcyk7DQogICAgICBpZiAoYXR0cmlidXRlcykgew0KICAgICAgICBmb3IgKHZhciBhdHRyIGluIGF0dHJpYnV0ZXMpIHsgaWYgKGF0dHJpYnV0ZXMuaGFzT3duUHJvcGVydHkoYXR0cikgJiYgYXR0ciAhPSAic3R5bGUiICYmIGF0dHIgIT0gImNsYXNzIikNCiAgICAgICAgICB7IHRva2VuLnNldEF0dHJpYnV0ZShhdHRyLCBhdHRyaWJ1dGVzW2F0dHJdKTsgfSB9DQogICAgICB9DQogICAgICByZXR1cm4gYnVpbGRlci5jb250ZW50LmFwcGVuZENoaWxkKHRva2VuKQ0KICAgIH0NCiAgICBidWlsZGVyLmNvbnRlbnQuYXBwZW5kQ2hpbGQoY29udGVudCk7DQogIH0NCg0KICAvLyBDaGFuZ2Ugc29tZSBzcGFjZXMgdG8gTkJTUCB0byBwcmV2ZW50IHRoZSBicm93c2VyIGZyb20gY29sbGFwc2luZw0KICAvLyB0cmFpbGluZyBzcGFjZXMgYXQgdGhlIGVuZCBvZiBhIGxpbmUgd2hlbiByZW5kZXJpbmcgdGV4dCAoaXNzdWUgIzEzNjIpLg0KICBmdW5jdGlvbiBzcGxpdFNwYWNlcyh0ZXh0LCB0cmFpbGluZ0JlZm9yZSkgew0KICAgIGlmICh0ZXh0Lmxlbmd0aCA+IDEgJiYgIS8gIC8udGVzdCh0ZXh0KSkgeyByZXR1cm4gdGV4dCB9DQogICAgdmFyIHNwYWNlQmVmb3JlID0gdHJhaWxpbmdCZWZvcmUsIHJlc3VsdCA9ICIiOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIGNoID0gdGV4dC5jaGFyQXQoaSk7DQogICAgICBpZiAoY2ggPT0gIiAiICYmIHNwYWNlQmVmb3JlICYmIChpID09IHRleHQubGVuZ3RoIC0gMSB8fCB0ZXh0LmNoYXJDb2RlQXQoaSArIDEpID09IDMyKSkNCiAgICAgICAgeyBjaCA9ICJcdTAwYTAiOyB9DQogICAgICByZXN1bHQgKz0gY2g7DQogICAgICBzcGFjZUJlZm9yZSA9IGNoID09ICIgIjsNCiAgICB9DQogICAgcmV0dXJuIHJlc3VsdA0KICB9DQoNCiAgLy8gV29yayBhcm91bmQgbm9uc2Vuc2UgZGltZW5zaW9ucyBiZWluZyByZXBvcnRlZCBmb3Igc3RyZXRjaGVzIG9mDQogIC8vIHJpZ2h0LXRvLWxlZnQgdGV4dC4NCiAgZnVuY3Rpb24gYnVpbGRUb2tlbkJhZEJpZGkoaW5uZXIsIG9yZGVyKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChidWlsZGVyLCB0ZXh0LCBzdHlsZSwgc3RhcnRTdHlsZSwgZW5kU3R5bGUsIGNzcywgYXR0cmlidXRlcykgew0KICAgICAgc3R5bGUgPSBzdHlsZSA/IHN0eWxlICsgIiBjbS1mb3JjZS1ib3JkZXIiIDogImNtLWZvcmNlLWJvcmRlciI7DQogICAgICB2YXIgc3RhcnQgPSBidWlsZGVyLnBvcywgZW5kID0gc3RhcnQgKyB0ZXh0Lmxlbmd0aDsNCiAgICAgIGZvciAoOzspIHsNCiAgICAgICAgLy8gRmluZCB0aGUgcGFydCB0aGF0IG92ZXJsYXBzIHdpdGggdGhlIHN0YXJ0IG9mIHRoaXMgdGV4dA0KICAgICAgICB2YXIgcGFydCA9ICh2b2lkIDApOw0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgcGFydCA9IG9yZGVyW2ldOw0KICAgICAgICAgIGlmIChwYXJ0LnRvID4gc3RhcnQgJiYgcGFydC5mcm9tIDw9IHN0YXJ0KSB7IGJyZWFrIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAocGFydC50byA+PSBlbmQpIHsgcmV0dXJuIGlubmVyKGJ1aWxkZXIsIHRleHQsIHN0eWxlLCBzdGFydFN0eWxlLCBlbmRTdHlsZSwgY3NzLCBhdHRyaWJ1dGVzKSB9DQogICAgICAgIGlubmVyKGJ1aWxkZXIsIHRleHQuc2xpY2UoMCwgcGFydC50byAtIHN0YXJ0KSwgc3R5bGUsIHN0YXJ0U3R5bGUsIG51bGwsIGNzcywgYXR0cmlidXRlcyk7DQogICAgICAgIHN0YXJ0U3R5bGUgPSBudWxsOw0KICAgICAgICB0ZXh0ID0gdGV4dC5zbGljZShwYXJ0LnRvIC0gc3RhcnQpOw0KICAgICAgICBzdGFydCA9IHBhcnQudG87DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gYnVpbGRDb2xsYXBzZWRTcGFuKGJ1aWxkZXIsIHNpemUsIG1hcmtlciwgaWdub3JlV2lkZ2V0KSB7DQogICAgdmFyIHdpZGdldCA9ICFpZ25vcmVXaWRnZXQgJiYgbWFya2VyLndpZGdldE5vZGU7DQogICAgaWYgKHdpZGdldCkgeyBidWlsZGVyLm1hcC5wdXNoKGJ1aWxkZXIucG9zLCBidWlsZGVyLnBvcyArIHNpemUsIHdpZGdldCk7IH0NCiAgICBpZiAoIWlnbm9yZVdpZGdldCAmJiBidWlsZGVyLmNtLmRpc3BsYXkuaW5wdXQubmVlZHNDb250ZW50QXR0cmlidXRlKSB7DQogICAgICBpZiAoIXdpZGdldCkNCiAgICAgICAgeyB3aWRnZXQgPSBidWlsZGVyLmNvbnRlbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpKTsgfQ0KICAgICAgd2lkZ2V0LnNldEF0dHJpYnV0ZSgiY20tbWFya2VyIiwgbWFya2VyLmlkKTsNCiAgICB9DQogICAgaWYgKHdpZGdldCkgew0KICAgICAgYnVpbGRlci5jbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUod2lkZ2V0KTsNCiAgICAgIGJ1aWxkZXIuY29udGVudC5hcHBlbmRDaGlsZCh3aWRnZXQpOw0KICAgIH0NCiAgICBidWlsZGVyLnBvcyArPSBzaXplOw0KICAgIGJ1aWxkZXIudHJhaWxpbmdTcGFjZSA9IGZhbHNlOw0KICB9DQoNCiAgLy8gT3V0cHV0cyBhIG51bWJlciBvZiBzcGFucyB0byBtYWtlIHVwIGEgbGluZSwgdGFraW5nIGhpZ2hsaWdodGluZw0KICAvLyBhbmQgbWFya2VkIHRleHQgaW50byBhY2NvdW50Lg0KICBmdW5jdGlvbiBpbnNlcnRMaW5lQ29udGVudChsaW5lLCBidWlsZGVyLCBzdHlsZXMpIHsNCiAgICB2YXIgc3BhbnMgPSBsaW5lLm1hcmtlZFNwYW5zLCBhbGxUZXh0ID0gbGluZS50ZXh0LCBhdCA9IDA7DQogICAgaWYgKCFzcGFucykgew0KICAgICAgZm9yICh2YXIgaSQxID0gMTsgaSQxIDwgc3R5bGVzLmxlbmd0aDsgaSQxKz0yKQ0KICAgICAgICB7IGJ1aWxkZXIuYWRkVG9rZW4oYnVpbGRlciwgYWxsVGV4dC5zbGljZShhdCwgYXQgPSBzdHlsZXNbaSQxXSksIGludGVycHJldFRva2VuU3R5bGUoc3R5bGVzW2kkMSsxXSwgYnVpbGRlci5jbS5vcHRpb25zKSk7IH0NCiAgICAgIHJldHVybg0KICAgIH0NCg0KICAgIHZhciBsZW4gPSBhbGxUZXh0Lmxlbmd0aCwgcG9zID0gMCwgaSA9IDEsIHRleHQgPSAiIiwgc3R5bGUsIGNzczsNCiAgICB2YXIgbmV4dENoYW5nZSA9IDAsIHNwYW5TdHlsZSwgc3BhbkVuZFN0eWxlLCBzcGFuU3RhcnRTdHlsZSwgY29sbGFwc2VkLCBhdHRyaWJ1dGVzOw0KICAgIGZvciAoOzspIHsNCiAgICAgIGlmIChuZXh0Q2hhbmdlID09IHBvcykgeyAvLyBVcGRhdGUgY3VycmVudCBtYXJrZXIgc2V0DQogICAgICAgIHNwYW5TdHlsZSA9IHNwYW5FbmRTdHlsZSA9IHNwYW5TdGFydFN0eWxlID0gY3NzID0gIiI7DQogICAgICAgIGF0dHJpYnV0ZXMgPSBudWxsOw0KICAgICAgICBjb2xsYXBzZWQgPSBudWxsOyBuZXh0Q2hhbmdlID0gSW5maW5pdHk7DQogICAgICAgIHZhciBmb3VuZEJvb2ttYXJrcyA9IFtdLCBlbmRTdHlsZXMgPSAodm9pZCAwKTsNCiAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBzcGFucy5sZW5ndGg7ICsraikgew0KICAgICAgICAgIHZhciBzcCA9IHNwYW5zW2pdLCBtID0gc3AubWFya2VyOw0KICAgICAgICAgIGlmIChtLnR5cGUgPT0gImJvb2ttYXJrIiAmJiBzcC5mcm9tID09IHBvcyAmJiBtLndpZGdldE5vZGUpIHsNCiAgICAgICAgICAgIGZvdW5kQm9va21hcmtzLnB1c2gobSk7DQogICAgICAgICAgfSBlbHNlIGlmIChzcC5mcm9tIDw9IHBvcyAmJiAoc3AudG8gPT0gbnVsbCB8fCBzcC50byA+IHBvcyB8fCBtLmNvbGxhcHNlZCAmJiBzcC50byA9PSBwb3MgJiYgc3AuZnJvbSA9PSBwb3MpKSB7DQogICAgICAgICAgICBpZiAoc3AudG8gIT0gbnVsbCAmJiBzcC50byAhPSBwb3MgJiYgbmV4dENoYW5nZSA+IHNwLnRvKSB7DQogICAgICAgICAgICAgIG5leHRDaGFuZ2UgPSBzcC50bzsNCiAgICAgICAgICAgICAgc3BhbkVuZFN0eWxlID0gIiI7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAobS5jbGFzc05hbWUpIHsgc3BhblN0eWxlICs9ICIgIiArIG0uY2xhc3NOYW1lOyB9DQogICAgICAgICAgICBpZiAobS5jc3MpIHsgY3NzID0gKGNzcyA/IGNzcyArICI7IiA6ICIiKSArIG0uY3NzOyB9DQogICAgICAgICAgICBpZiAobS5zdGFydFN0eWxlICYmIHNwLmZyb20gPT0gcG9zKSB7IHNwYW5TdGFydFN0eWxlICs9ICIgIiArIG0uc3RhcnRTdHlsZTsgfQ0KICAgICAgICAgICAgaWYgKG0uZW5kU3R5bGUgJiYgc3AudG8gPT0gbmV4dENoYW5nZSkgeyAoZW5kU3R5bGVzIHx8IChlbmRTdHlsZXMgPSBbXSkpLnB1c2gobS5lbmRTdHlsZSwgc3AudG8pOyB9DQogICAgICAgICAgICAvLyBzdXBwb3J0IGZvciB0aGUgb2xkIHRpdGxlIHByb3BlcnR5DQogICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vY29kZW1pcnJvci9Db2RlTWlycm9yL3B1bGwvNTY3Mw0KICAgICAgICAgICAgaWYgKG0udGl0bGUpIHsgKGF0dHJpYnV0ZXMgfHwgKGF0dHJpYnV0ZXMgPSB7fSkpLnRpdGxlID0gbS50aXRsZTsgfQ0KICAgICAgICAgICAgaWYgKG0uYXR0cmlidXRlcykgew0KICAgICAgICAgICAgICBmb3IgKHZhciBhdHRyIGluIG0uYXR0cmlidXRlcykNCiAgICAgICAgICAgICAgICB7IChhdHRyaWJ1dGVzIHx8IChhdHRyaWJ1dGVzID0ge30pKVthdHRyXSA9IG0uYXR0cmlidXRlc1thdHRyXTsgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgaWYgKG0uY29sbGFwc2VkICYmICghY29sbGFwc2VkIHx8IGNvbXBhcmVDb2xsYXBzZWRNYXJrZXJzKGNvbGxhcHNlZC5tYXJrZXIsIG0pIDwgMCkpDQogICAgICAgICAgICAgIHsgY29sbGFwc2VkID0gc3A7IH0NCiAgICAgICAgICB9IGVsc2UgaWYgKHNwLmZyb20gPiBwb3MgJiYgbmV4dENoYW5nZSA+IHNwLmZyb20pIHsNCiAgICAgICAgICAgIG5leHRDaGFuZ2UgPSBzcC5mcm9tOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoZW5kU3R5bGVzKSB7IGZvciAodmFyIGokMSA9IDA7IGokMSA8IGVuZFN0eWxlcy5sZW5ndGg7IGokMSArPSAyKQ0KICAgICAgICAgIHsgaWYgKGVuZFN0eWxlc1tqJDEgKyAxXSA9PSBuZXh0Q2hhbmdlKSB7IHNwYW5FbmRTdHlsZSArPSAiICIgKyBlbmRTdHlsZXNbaiQxXTsgfSB9IH0NCg0KICAgICAgICBpZiAoIWNvbGxhcHNlZCB8fCBjb2xsYXBzZWQuZnJvbSA9PSBwb3MpIHsgZm9yICh2YXIgaiQyID0gMDsgaiQyIDwgZm91bmRCb29rbWFya3MubGVuZ3RoOyArK2okMikNCiAgICAgICAgICB7IGJ1aWxkQ29sbGFwc2VkU3BhbihidWlsZGVyLCAwLCBmb3VuZEJvb2ttYXJrc1tqJDJdKTsgfSB9DQogICAgICAgIGlmIChjb2xsYXBzZWQgJiYgKGNvbGxhcHNlZC5mcm9tIHx8IDApID09IHBvcykgew0KICAgICAgICAgIGJ1aWxkQ29sbGFwc2VkU3BhbihidWlsZGVyLCAoY29sbGFwc2VkLnRvID09IG51bGwgPyBsZW4gKyAxIDogY29sbGFwc2VkLnRvKSAtIHBvcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sbGFwc2VkLm1hcmtlciwgY29sbGFwc2VkLmZyb20gPT0gbnVsbCk7DQogICAgICAgICAgaWYgKGNvbGxhcHNlZC50byA9PSBudWxsKSB7IHJldHVybiB9DQogICAgICAgICAgaWYgKGNvbGxhcHNlZC50byA9PSBwb3MpIHsgY29sbGFwc2VkID0gZmFsc2U7IH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKHBvcyA+PSBsZW4pIHsgYnJlYWsgfQ0KDQogICAgICB2YXIgdXB0byA9IE1hdGgubWluKGxlbiwgbmV4dENoYW5nZSk7DQogICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICBpZiAodGV4dCkgew0KICAgICAgICAgIHZhciBlbmQgPSBwb3MgKyB0ZXh0Lmxlbmd0aDsNCiAgICAgICAgICBpZiAoIWNvbGxhcHNlZCkgew0KICAgICAgICAgICAgdmFyIHRva2VuVGV4dCA9IGVuZCA+IHVwdG8gPyB0ZXh0LnNsaWNlKDAsIHVwdG8gLSBwb3MpIDogdGV4dDsNCiAgICAgICAgICAgIGJ1aWxkZXIuYWRkVG9rZW4oYnVpbGRlciwgdG9rZW5UZXh0LCBzdHlsZSA/IHN0eWxlICsgc3BhblN0eWxlIDogc3BhblN0eWxlLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzcGFuU3RhcnRTdHlsZSwgcG9zICsgdG9rZW5UZXh0Lmxlbmd0aCA9PSBuZXh0Q2hhbmdlID8gc3BhbkVuZFN0eWxlIDogIiIsIGNzcywgYXR0cmlidXRlcyk7DQogICAgICAgICAgfQ0KICAgICAgICAgIGlmIChlbmQgPj0gdXB0bykge3RleHQgPSB0ZXh0LnNsaWNlKHVwdG8gLSBwb3MpOyBwb3MgPSB1cHRvOyBicmVha30NCiAgICAgICAgICBwb3MgPSBlbmQ7DQogICAgICAgICAgc3BhblN0YXJ0U3R5bGUgPSAiIjsNCiAgICAgICAgfQ0KICAgICAgICB0ZXh0ID0gYWxsVGV4dC5zbGljZShhdCwgYXQgPSBzdHlsZXNbaSsrXSk7DQogICAgICAgIHN0eWxlID0gaW50ZXJwcmV0VG9rZW5TdHlsZShzdHlsZXNbaSsrXSwgYnVpbGRlci5jbS5vcHRpb25zKTsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KDQogIC8vIFRoZXNlIG9iamVjdHMgYXJlIHVzZWQgdG8gcmVwcmVzZW50IHRoZSB2aXNpYmxlIChjdXJyZW50bHkgZHJhd24pDQogIC8vIHBhcnQgb2YgdGhlIGRvY3VtZW50LiBBIExpbmVWaWV3IG1heSBjb3JyZXNwb25kIHRvIG11bHRpcGxlDQogIC8vIGxvZ2ljYWwgbGluZXMsIGlmIHRob3NlIGFyZSBjb25uZWN0ZWQgYnkgY29sbGFwc2VkIHJhbmdlcy4NCiAgZnVuY3Rpb24gTGluZVZpZXcoZG9jLCBsaW5lLCBsaW5lTikgew0KICAgIC8vIFRoZSBzdGFydGluZyBsaW5lDQogICAgdGhpcy5saW5lID0gbGluZTsNCiAgICAvLyBDb250aW51aW5nIGxpbmVzLCBpZiBhbnkNCiAgICB0aGlzLnJlc3QgPSB2aXN1YWxMaW5lQ29udGludWVkKGxpbmUpOw0KICAgIC8vIE51bWJlciBvZiBsb2dpY2FsIGxpbmVzIGluIHRoaXMgdmlzdWFsIGxpbmUNCiAgICB0aGlzLnNpemUgPSB0aGlzLnJlc3QgPyBsaW5lTm8obHN0KHRoaXMucmVzdCkpIC0gbGluZU4gKyAxIDogMTsNCiAgICB0aGlzLm5vZGUgPSB0aGlzLnRleHQgPSBudWxsOw0KICAgIHRoaXMuaGlkZGVuID0gbGluZUlzSGlkZGVuKGRvYywgbGluZSk7DQogIH0NCg0KICAvLyBDcmVhdGUgYSByYW5nZSBvZiBMaW5lVmlldyBvYmplY3RzIGZvciB0aGUgZ2l2ZW4gbGluZXMuDQogIGZ1bmN0aW9uIGJ1aWxkVmlld0FycmF5KGNtLCBmcm9tLCB0bykgew0KICAgIHZhciBhcnJheSA9IFtdLCBuZXh0UG9zOw0KICAgIGZvciAodmFyIHBvcyA9IGZyb207IHBvcyA8IHRvOyBwb3MgPSBuZXh0UG9zKSB7DQogICAgICB2YXIgdmlldyA9IG5ldyBMaW5lVmlldyhjbS5kb2MsIGdldExpbmUoY20uZG9jLCBwb3MpLCBwb3MpOw0KICAgICAgbmV4dFBvcyA9IHBvcyArIHZpZXcuc2l6ZTsNCiAgICAgIGFycmF5LnB1c2godmlldyk7DQogICAgfQ0KICAgIHJldHVybiBhcnJheQ0KICB9DQoNCiAgdmFyIG9wZXJhdGlvbkdyb3VwID0gbnVsbDsNCg0KICBmdW5jdGlvbiBwdXNoT3BlcmF0aW9uKG9wKSB7DQogICAgaWYgKG9wZXJhdGlvbkdyb3VwKSB7DQogICAgICBvcGVyYXRpb25Hcm91cC5vcHMucHVzaChvcCk7DQogICAgfSBlbHNlIHsNCiAgICAgIG9wLm93bnNHcm91cCA9IG9wZXJhdGlvbkdyb3VwID0gew0KICAgICAgICBvcHM6IFtvcF0sDQogICAgICAgIGRlbGF5ZWRDYWxsYmFja3M6IFtdDQogICAgICB9Ow0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGZpcmVDYWxsYmFja3NGb3JPcHMoZ3JvdXApIHsNCiAgICAvLyBDYWxscyBkZWxheWVkIGNhbGxiYWNrcyBhbmQgY3Vyc29yQWN0aXZpdHkgaGFuZGxlcnMgdW50aWwgbm8NCiAgICAvLyBuZXcgb25lcyBhcHBlYXINCiAgICB2YXIgY2FsbGJhY2tzID0gZ3JvdXAuZGVsYXllZENhbGxiYWNrcywgaSA9IDA7DQogICAgZG8gew0KICAgICAgZm9yICg7IGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpKyspDQogICAgICAgIHsgY2FsbGJhY2tzW2ldLmNhbGwobnVsbCk7IH0NCiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgZ3JvdXAub3BzLmxlbmd0aDsgaisrKSB7DQogICAgICAgIHZhciBvcCA9IGdyb3VwLm9wc1tqXTsNCiAgICAgICAgaWYgKG9wLmN1cnNvckFjdGl2aXR5SGFuZGxlcnMpDQogICAgICAgICAgeyB3aGlsZSAob3AuY3Vyc29yQWN0aXZpdHlDYWxsZWQgPCBvcC5jdXJzb3JBY3Rpdml0eUhhbmRsZXJzLmxlbmd0aCkNCiAgICAgICAgICAgIHsgb3AuY3Vyc29yQWN0aXZpdHlIYW5kbGVyc1tvcC5jdXJzb3JBY3Rpdml0eUNhbGxlZCsrXS5jYWxsKG51bGwsIG9wLmNtKTsgfSB9DQogICAgICB9DQogICAgfSB3aGlsZSAoaSA8IGNhbGxiYWNrcy5sZW5ndGgpDQogIH0NCg0KICBmdW5jdGlvbiBmaW5pc2hPcGVyYXRpb24ob3AsIGVuZENiKSB7DQogICAgdmFyIGdyb3VwID0gb3Aub3duc0dyb3VwOw0KICAgIGlmICghZ3JvdXApIHsgcmV0dXJuIH0NCg0KICAgIHRyeSB7IGZpcmVDYWxsYmFja3NGb3JPcHMoZ3JvdXApOyB9DQogICAgZmluYWxseSB7DQogICAgICBvcGVyYXRpb25Hcm91cCA9IG51bGw7DQogICAgICBlbmRDYihncm91cCk7DQogICAgfQ0KICB9DQoNCiAgdmFyIG9ycGhhbkRlbGF5ZWRDYWxsYmFja3MgPSBudWxsOw0KDQogIC8vIE9mdGVuLCB3ZSB3YW50IHRvIHNpZ25hbCBldmVudHMgYXQgYSBwb2ludCB3aGVyZSB3ZSBhcmUgaW4gdGhlDQogIC8vIG1pZGRsZSBvZiBzb21lIHdvcmssIGJ1dCBkb24ndCB3YW50IHRoZSBoYW5kbGVyIHRvIHN0YXJ0IGNhbGxpbmcNCiAgLy8gb3RoZXIgbWV0aG9kcyBvbiB0aGUgZWRpdG9yLCB3aGljaCBtaWdodCBiZSBpbiBhbiBpbmNvbnNpc3RlbnQNCiAgLy8gc3RhdGUgb3Igc2ltcGx5IG5vdCBleHBlY3QgYW55IG90aGVyIGV2ZW50cyB0byBoYXBwZW4uDQogIC8vIHNpZ25hbExhdGVyIGxvb2tzIHdoZXRoZXIgdGhlcmUgYXJlIGFueSBoYW5kbGVycywgYW5kIHNjaGVkdWxlcw0KICAvLyB0aGVtIHRvIGJlIGV4ZWN1dGVkIHdoZW4gdGhlIGxhc3Qgb3BlcmF0aW9uIGVuZHMsIG9yLCBpZiBubw0KICAvLyBvcGVyYXRpb24gaXMgYWN0aXZlLCB3aGVuIGEgdGltZW91dCBmaXJlcy4NCiAgZnVuY3Rpb24gc2lnbmFsTGF0ZXIoZW1pdHRlciwgdHlwZSAvKiwgdmFsdWVzLi4uKi8pIHsNCiAgICB2YXIgYXJyID0gZ2V0SGFuZGxlcnMoZW1pdHRlciwgdHlwZSk7DQogICAgaWYgKCFhcnIubGVuZ3RoKSB7IHJldHVybiB9DQogICAgdmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDIpLCBsaXN0Ow0KICAgIGlmIChvcGVyYXRpb25Hcm91cCkgew0KICAgICAgbGlzdCA9IG9wZXJhdGlvbkdyb3VwLmRlbGF5ZWRDYWxsYmFja3M7DQogICAgfSBlbHNlIGlmIChvcnBoYW5EZWxheWVkQ2FsbGJhY2tzKSB7DQogICAgICBsaXN0ID0gb3JwaGFuRGVsYXllZENhbGxiYWNrczsNCiAgICB9IGVsc2Ugew0KICAgICAgbGlzdCA9IG9ycGhhbkRlbGF5ZWRDYWxsYmFja3MgPSBbXTsNCiAgICAgIHNldFRpbWVvdXQoZmlyZU9ycGhhbkRlbGF5ZWQsIDApOw0KICAgIH0NCiAgICB2YXIgbG9vcCA9IGZ1bmN0aW9uICggaSApIHsNCiAgICAgIGxpc3QucHVzaChmdW5jdGlvbiAoKSB7IHJldHVybiBhcnJbaV0uYXBwbHkobnVsbCwgYXJncyk7IH0pOw0KICAgIH07DQoNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFyci5sZW5ndGg7ICsraSkNCiAgICAgIGxvb3AoIGkgKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGZpcmVPcnBoYW5EZWxheWVkKCkgew0KICAgIHZhciBkZWxheWVkID0gb3JwaGFuRGVsYXllZENhbGxiYWNrczsNCiAgICBvcnBoYW5EZWxheWVkQ2FsbGJhY2tzID0gbnVsbDsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRlbGF5ZWQubGVuZ3RoOyArK2kpIHsgZGVsYXllZFtpXSgpOyB9DQogIH0NCg0KICAvLyBXaGVuIGFuIGFzcGVjdCBvZiBhIGxpbmUgY2hhbmdlcywgYSBzdHJpbmcgaXMgYWRkZWQgdG8NCiAgLy8gbGluZVZpZXcuY2hhbmdlcy4gVGhpcyB1cGRhdGVzIHRoZSByZWxldmFudCBwYXJ0IG9mIHRoZSBsaW5lJ3MNCiAgLy8gRE9NIHN0cnVjdHVyZS4NCiAgZnVuY3Rpb24gdXBkYXRlTGluZUZvckNoYW5nZXMoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcykgew0KICAgIGZvciAodmFyIGogPSAwOyBqIDwgbGluZVZpZXcuY2hhbmdlcy5sZW5ndGg7IGorKykgew0KICAgICAgdmFyIHR5cGUgPSBsaW5lVmlldy5jaGFuZ2VzW2pdOw0KICAgICAgaWYgKHR5cGUgPT0gInRleHQiKSB7IHVwZGF0ZUxpbmVUZXh0KGNtLCBsaW5lVmlldyk7IH0NCiAgICAgIGVsc2UgaWYgKHR5cGUgPT0gImd1dHRlciIpIHsgdXBkYXRlTGluZUd1dHRlcihjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKTsgfQ0KICAgICAgZWxzZSBpZiAodHlwZSA9PSAiY2xhc3MiKSB7IHVwZGF0ZUxpbmVDbGFzc2VzKGNtLCBsaW5lVmlldyk7IH0NCiAgICAgIGVsc2UgaWYgKHR5cGUgPT0gIndpZGdldCIpIHsgdXBkYXRlTGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKTsgfQ0KICAgIH0NCiAgICBsaW5lVmlldy5jaGFuZ2VzID0gbnVsbDsNCiAgfQ0KDQogIC8vIExpbmVzIHdpdGggZ3V0dGVyIGVsZW1lbnRzLCB3aWRnZXRzIG9yIGEgYmFja2dyb3VuZCBjbGFzcyBuZWVkIHRvDQogIC8vIGJlIHdyYXBwZWQsIGFuZCBoYXZlIHRoZSBleHRyYSBlbGVtZW50cyBhZGRlZCB0byB0aGUgd3JhcHBlciBkaXYNCiAgZnVuY3Rpb24gZW5zdXJlTGluZVdyYXBwZWQobGluZVZpZXcpIHsNCiAgICBpZiAobGluZVZpZXcubm9kZSA9PSBsaW5lVmlldy50ZXh0KSB7DQogICAgICBsaW5lVmlldy5ub2RlID0gZWx0KCJkaXYiLCBudWxsLCBudWxsLCAicG9zaXRpb246IHJlbGF0aXZlIik7DQogICAgICBpZiAobGluZVZpZXcudGV4dC5wYXJlbnROb2RlKQ0KICAgICAgICB7IGxpbmVWaWV3LnRleHQucGFyZW50Tm9kZS5yZXBsYWNlQ2hpbGQobGluZVZpZXcubm9kZSwgbGluZVZpZXcudGV4dCk7IH0NCiAgICAgIGxpbmVWaWV3Lm5vZGUuYXBwZW5kQ2hpbGQobGluZVZpZXcudGV4dCk7DQogICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIHsgbGluZVZpZXcubm9kZS5zdHlsZS56SW5kZXggPSAyOyB9DQogICAgfQ0KICAgIHJldHVybiBsaW5lVmlldy5ub2RlDQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVMaW5lQmFja2dyb3VuZChjbSwgbGluZVZpZXcpIHsNCiAgICB2YXIgY2xzID0gbGluZVZpZXcuYmdDbGFzcyA/IGxpbmVWaWV3LmJnQ2xhc3MgKyAiICIgKyAobGluZVZpZXcubGluZS5iZ0NsYXNzIHx8ICIiKSA6IGxpbmVWaWV3LmxpbmUuYmdDbGFzczsNCiAgICBpZiAoY2xzKSB7IGNscyArPSAiIENvZGVNaXJyb3ItbGluZWJhY2tncm91bmQiOyB9DQogICAgaWYgKGxpbmVWaWV3LmJhY2tncm91bmQpIHsNCiAgICAgIGlmIChjbHMpIHsgbGluZVZpZXcuYmFja2dyb3VuZC5jbGFzc05hbWUgPSBjbHM7IH0NCiAgICAgIGVsc2UgeyBsaW5lVmlldy5iYWNrZ3JvdW5kLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobGluZVZpZXcuYmFja2dyb3VuZCk7IGxpbmVWaWV3LmJhY2tncm91bmQgPSBudWxsOyB9DQogICAgfSBlbHNlIGlmIChjbHMpIHsNCiAgICAgIHZhciB3cmFwID0gZW5zdXJlTGluZVdyYXBwZWQobGluZVZpZXcpOw0KICAgICAgbGluZVZpZXcuYmFja2dyb3VuZCA9IHdyYXAuaW5zZXJ0QmVmb3JlKGVsdCgiZGl2IiwgbnVsbCwgY2xzKSwgd3JhcC5maXJzdENoaWxkKTsNCiAgICAgIGNtLmRpc3BsYXkuaW5wdXQuc2V0VW5lZGl0YWJsZShsaW5lVmlldy5iYWNrZ3JvdW5kKTsNCiAgICB9DQogIH0NCg0KICAvLyBXcmFwcGVyIGFyb3VuZCBidWlsZExpbmVDb250ZW50IHdoaWNoIHdpbGwgcmV1c2UgdGhlIHN0cnVjdHVyZQ0KICAvLyBpbiBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgd2hlbiBwb3NzaWJsZS4NCiAgZnVuY3Rpb24gZ2V0TGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KSB7DQogICAgdmFyIGV4dCA9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZDsNCiAgICBpZiAoZXh0ICYmIGV4dC5saW5lID09IGxpbmVWaWV3LmxpbmUpIHsNCiAgICAgIGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCA9IG51bGw7DQogICAgICBsaW5lVmlldy5tZWFzdXJlID0gZXh0Lm1lYXN1cmU7DQogICAgICByZXR1cm4gZXh0LmJ1aWx0DQogICAgfQ0KICAgIHJldHVybiBidWlsZExpbmVDb250ZW50KGNtLCBsaW5lVmlldykNCiAgfQ0KDQogIC8vIFJlZHJhdyB0aGUgbGluZSdzIHRleHQuIEludGVyYWN0cyB3aXRoIHRoZSBiYWNrZ3JvdW5kIGFuZCB0ZXh0DQogIC8vIGNsYXNzZXMgYmVjYXVzZSB0aGUgbW9kZSBtYXkgb3V0cHV0IHRva2VucyB0aGF0IGluZmx1ZW5jZSB0aGVzZQ0KICAvLyBjbGFzc2VzLg0KICBmdW5jdGlvbiB1cGRhdGVMaW5lVGV4dChjbSwgbGluZVZpZXcpIHsNCiAgICB2YXIgY2xzID0gbGluZVZpZXcudGV4dC5jbGFzc05hbWU7DQogICAgdmFyIGJ1aWx0ID0gZ2V0TGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KTsNCiAgICBpZiAobGluZVZpZXcudGV4dCA9PSBsaW5lVmlldy5ub2RlKSB7IGxpbmVWaWV3Lm5vZGUgPSBidWlsdC5wcmU7IH0NCiAgICBsaW5lVmlldy50ZXh0LnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKGJ1aWx0LnByZSwgbGluZVZpZXcudGV4dCk7DQogICAgbGluZVZpZXcudGV4dCA9IGJ1aWx0LnByZTsNCiAgICBpZiAoYnVpbHQuYmdDbGFzcyAhPSBsaW5lVmlldy5iZ0NsYXNzIHx8IGJ1aWx0LnRleHRDbGFzcyAhPSBsaW5lVmlldy50ZXh0Q2xhc3MpIHsNCiAgICAgIGxpbmVWaWV3LmJnQ2xhc3MgPSBidWlsdC5iZ0NsYXNzOw0KICAgICAgbGluZVZpZXcudGV4dENsYXNzID0gYnVpbHQudGV4dENsYXNzOw0KICAgICAgdXBkYXRlTGluZUNsYXNzZXMoY20sIGxpbmVWaWV3KTsNCiAgICB9IGVsc2UgaWYgKGNscykgew0KICAgICAgbGluZVZpZXcudGV4dC5jbGFzc05hbWUgPSBjbHM7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlTGluZUNsYXNzZXMoY20sIGxpbmVWaWV3KSB7DQogICAgdXBkYXRlTGluZUJhY2tncm91bmQoY20sIGxpbmVWaWV3KTsNCiAgICBpZiAobGluZVZpZXcubGluZS53cmFwQ2xhc3MpDQogICAgICB7IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KS5jbGFzc05hbWUgPSBsaW5lVmlldy5saW5lLndyYXBDbGFzczsgfQ0KICAgIGVsc2UgaWYgKGxpbmVWaWV3Lm5vZGUgIT0gbGluZVZpZXcudGV4dCkNCiAgICAgIHsgbGluZVZpZXcubm9kZS5jbGFzc05hbWUgPSAiIjsgfQ0KICAgIHZhciB0ZXh0Q2xhc3MgPSBsaW5lVmlldy50ZXh0Q2xhc3MgPyBsaW5lVmlldy50ZXh0Q2xhc3MgKyAiICIgKyAobGluZVZpZXcubGluZS50ZXh0Q2xhc3MgfHwgIiIpIDogbGluZVZpZXcubGluZS50ZXh0Q2xhc3M7DQogICAgbGluZVZpZXcudGV4dC5jbGFzc05hbWUgPSB0ZXh0Q2xhc3MgfHwgIiI7DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVMaW5lR3V0dGVyKGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpIHsNCiAgICBpZiAobGluZVZpZXcuZ3V0dGVyKSB7DQogICAgICBsaW5lVmlldy5ub2RlLnJlbW92ZUNoaWxkKGxpbmVWaWV3Lmd1dHRlcik7DQogICAgICBsaW5lVmlldy5ndXR0ZXIgPSBudWxsOw0KICAgIH0NCiAgICBpZiAobGluZVZpZXcuZ3V0dGVyQmFja2dyb3VuZCkgew0KICAgICAgbGluZVZpZXcubm9kZS5yZW1vdmVDaGlsZChsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kKTsNCiAgICAgIGxpbmVWaWV3Lmd1dHRlckJhY2tncm91bmQgPSBudWxsOw0KICAgIH0NCiAgICBpZiAobGluZVZpZXcubGluZS5ndXR0ZXJDbGFzcykgew0KICAgICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7DQogICAgICBsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kID0gZWx0KCJkaXYiLCBudWxsLCAiQ29kZU1pcnJvci1ndXR0ZXItYmFja2dyb3VuZCAiICsgbGluZVZpZXcubGluZS5ndXR0ZXJDbGFzcywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJsZWZ0OiAiICsgKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBkaW1zLmZpeGVkUG9zIDogLWRpbXMuZ3V0dGVyVG90YWxXaWR0aCkgKyAicHg7IHdpZHRoOiAiICsgKGRpbXMuZ3V0dGVyVG90YWxXaWR0aCkgKyAicHgiKSk7DQogICAgICBjbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUobGluZVZpZXcuZ3V0dGVyQmFja2dyb3VuZCk7DQogICAgICB3cmFwLmluc2VydEJlZm9yZShsaW5lVmlldy5ndXR0ZXJCYWNrZ3JvdW5kLCBsaW5lVmlldy50ZXh0KTsNCiAgICB9DQogICAgdmFyIG1hcmtlcnMgPSBsaW5lVmlldy5saW5lLmd1dHRlck1hcmtlcnM7DQogICAgaWYgKGNtLm9wdGlvbnMubGluZU51bWJlcnMgfHwgbWFya2Vycykgew0KICAgICAgdmFyIHdyYXAkMSA9IGVuc3VyZUxpbmVXcmFwcGVkKGxpbmVWaWV3KTsNCiAgICAgIHZhciBndXR0ZXJXcmFwID0gbGluZVZpZXcuZ3V0dGVyID0gZWx0KCJkaXYiLCBudWxsLCAiQ29kZU1pcnJvci1ndXR0ZXItd3JhcHBlciIsICgibGVmdDogIiArIChjbS5vcHRpb25zLmZpeGVkR3V0dGVyID8gZGltcy5maXhlZFBvcyA6IC1kaW1zLmd1dHRlclRvdGFsV2lkdGgpICsgInB4IikpOw0KICAgICAgY20uZGlzcGxheS5pbnB1dC5zZXRVbmVkaXRhYmxlKGd1dHRlcldyYXApOw0KICAgICAgd3JhcCQxLmluc2VydEJlZm9yZShndXR0ZXJXcmFwLCBsaW5lVmlldy50ZXh0KTsNCiAgICAgIGlmIChsaW5lVmlldy5saW5lLmd1dHRlckNsYXNzKQ0KICAgICAgICB7IGd1dHRlcldyYXAuY2xhc3NOYW1lICs9ICIgIiArIGxpbmVWaWV3LmxpbmUuZ3V0dGVyQ2xhc3M7IH0NCiAgICAgIGlmIChjbS5vcHRpb25zLmxpbmVOdW1iZXJzICYmICghbWFya2VycyB8fCAhbWFya2Vyc1siQ29kZU1pcnJvci1saW5lbnVtYmVycyJdKSkNCiAgICAgICAgeyBsaW5lVmlldy5saW5lTnVtYmVyID0gZ3V0dGVyV3JhcC5hcHBlbmRDaGlsZCgNCiAgICAgICAgICBlbHQoImRpdiIsIGxpbmVOdW1iZXJGb3IoY20ub3B0aW9ucywgbGluZU4pLA0KICAgICAgICAgICAgICAiQ29kZU1pcnJvci1saW5lbnVtYmVyIENvZGVNaXJyb3ItZ3V0dGVyLWVsdCIsDQogICAgICAgICAgICAgICgibGVmdDogIiArIChkaW1zLmd1dHRlckxlZnRbIkNvZGVNaXJyb3ItbGluZW51bWJlcnMiXSkgKyAicHg7IHdpZHRoOiAiICsgKGNtLmRpc3BsYXkubGluZU51bUlubmVyV2lkdGgpICsgInB4IikpKTsgfQ0KICAgICAgaWYgKG1hcmtlcnMpIHsgZm9yICh2YXIgayA9IDA7IGsgPCBjbS5kaXNwbGF5Lmd1dHRlclNwZWNzLmxlbmd0aDsgKytrKSB7DQogICAgICAgIHZhciBpZCA9IGNtLmRpc3BsYXkuZ3V0dGVyU3BlY3Nba10uY2xhc3NOYW1lLCBmb3VuZCA9IG1hcmtlcnMuaGFzT3duUHJvcGVydHkoaWQpICYmIG1hcmtlcnNbaWRdOw0KICAgICAgICBpZiAoZm91bmQpDQogICAgICAgICAgeyBndXR0ZXJXcmFwLmFwcGVuZENoaWxkKGVsdCgiZGl2IiwgW2ZvdW5kXSwgIkNvZGVNaXJyb3ItZ3V0dGVyLWVsdCIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKCJsZWZ0OiAiICsgKGRpbXMuZ3V0dGVyTGVmdFtpZF0pICsgInB4OyB3aWR0aDogIiArIChkaW1zLmd1dHRlcldpZHRoW2lkXSkgKyAicHgiKSkpOyB9DQogICAgICB9IH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVMaW5lV2lkZ2V0cyhjbSwgbGluZVZpZXcsIGRpbXMpIHsNCiAgICBpZiAobGluZVZpZXcuYWxpZ25hYmxlKSB7IGxpbmVWaWV3LmFsaWduYWJsZSA9IG51bGw7IH0NCiAgICB2YXIgaXNXaWRnZXQgPSBjbGFzc1Rlc3QoIkNvZGVNaXJyb3ItbGluZXdpZGdldCIpOw0KICAgIGZvciAodmFyIG5vZGUgPSBsaW5lVmlldy5ub2RlLmZpcnN0Q2hpbGQsIG5leHQgPSAodm9pZCAwKTsgbm9kZTsgbm9kZSA9IG5leHQpIHsNCiAgICAgIG5leHQgPSBub2RlLm5leHRTaWJsaW5nOw0KICAgICAgaWYgKGlzV2lkZ2V0LnRlc3Qobm9kZS5jbGFzc05hbWUpKSB7IGxpbmVWaWV3Lm5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7IH0NCiAgICB9DQogICAgaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKTsNCiAgfQ0KDQogIC8vIEJ1aWxkIGEgbGluZSdzIERPTSByZXByZXNlbnRhdGlvbiBmcm9tIHNjcmF0Y2gNCiAgZnVuY3Rpb24gYnVpbGRMaW5lRWxlbWVudChjbSwgbGluZVZpZXcsIGxpbmVOLCBkaW1zKSB7DQogICAgdmFyIGJ1aWx0ID0gZ2V0TGluZUNvbnRlbnQoY20sIGxpbmVWaWV3KTsNCiAgICBsaW5lVmlldy50ZXh0ID0gbGluZVZpZXcubm9kZSA9IGJ1aWx0LnByZTsNCiAgICBpZiAoYnVpbHQuYmdDbGFzcykgeyBsaW5lVmlldy5iZ0NsYXNzID0gYnVpbHQuYmdDbGFzczsgfQ0KICAgIGlmIChidWlsdC50ZXh0Q2xhc3MpIHsgbGluZVZpZXcudGV4dENsYXNzID0gYnVpbHQudGV4dENsYXNzOyB9DQoNCiAgICB1cGRhdGVMaW5lQ2xhc3NlcyhjbSwgbGluZVZpZXcpOw0KICAgIHVwZGF0ZUxpbmVHdXR0ZXIoY20sIGxpbmVWaWV3LCBsaW5lTiwgZGltcyk7DQogICAgaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKTsNCiAgICByZXR1cm4gbGluZVZpZXcubm9kZQ0KICB9DQoNCiAgLy8gQSBsaW5lVmlldyBtYXkgY29udGFpbiBtdWx0aXBsZSBsb2dpY2FsIGxpbmVzICh3aGVuIG1lcmdlZCBieQ0KICAvLyBjb2xsYXBzZWQgc3BhbnMpLiBUaGUgd2lkZ2V0cyBmb3IgYWxsIG9mIHRoZW0gbmVlZCB0byBiZSBkcmF3bi4NCiAgZnVuY3Rpb24gaW5zZXJ0TGluZVdpZGdldHMoY20sIGxpbmVWaWV3LCBkaW1zKSB7DQogICAgaW5zZXJ0TGluZVdpZGdldHNGb3IoY20sIGxpbmVWaWV3LmxpbmUsIGxpbmVWaWV3LCBkaW1zLCB0cnVlKTsNCiAgICBpZiAobGluZVZpZXcucmVzdCkgeyBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmVWaWV3LnJlc3QubGVuZ3RoOyBpKyspDQogICAgICB7IGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lVmlldy5yZXN0W2ldLCBsaW5lVmlldywgZGltcywgZmFsc2UpOyB9IH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGluc2VydExpbmVXaWRnZXRzRm9yKGNtLCBsaW5lLCBsaW5lVmlldywgZGltcywgYWxsb3dBYm92ZSkgew0KICAgIGlmICghbGluZS53aWRnZXRzKSB7IHJldHVybiB9DQogICAgdmFyIHdyYXAgPSBlbnN1cmVMaW5lV3JhcHBlZChsaW5lVmlldyk7DQogICAgZm9yICh2YXIgaSA9IDAsIHdzID0gbGluZS53aWRnZXRzOyBpIDwgd3MubGVuZ3RoOyArK2kpIHsNCiAgICAgIHZhciB3aWRnZXQgPSB3c1tpXSwgbm9kZSA9IGVsdCgiZGl2IiwgW3dpZGdldC5ub2RlXSwgIkNvZGVNaXJyb3ItbGluZXdpZGdldCIgKyAod2lkZ2V0LmNsYXNzTmFtZSA/ICIgIiArIHdpZGdldC5jbGFzc05hbWUgOiAiIikpOw0KICAgICAgaWYgKCF3aWRnZXQuaGFuZGxlTW91c2VFdmVudHMpIHsgbm9kZS5zZXRBdHRyaWJ1dGUoImNtLWlnbm9yZS1ldmVudHMiLCAidHJ1ZSIpOyB9DQogICAgICBwb3NpdGlvbkxpbmVXaWRnZXQod2lkZ2V0LCBub2RlLCBsaW5lVmlldywgZGltcyk7DQogICAgICBjbS5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUobm9kZSk7DQogICAgICBpZiAoYWxsb3dBYm92ZSAmJiB3aWRnZXQuYWJvdmUpDQogICAgICAgIHsgd3JhcC5pbnNlcnRCZWZvcmUobm9kZSwgbGluZVZpZXcuZ3V0dGVyIHx8IGxpbmVWaWV3LnRleHQpOyB9DQogICAgICBlbHNlDQogICAgICAgIHsgd3JhcC5hcHBlbmRDaGlsZChub2RlKTsgfQ0KICAgICAgc2lnbmFsTGF0ZXIod2lkZ2V0LCAicmVkcmF3Iik7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gcG9zaXRpb25MaW5lV2lkZ2V0KHdpZGdldCwgbm9kZSwgbGluZVZpZXcsIGRpbXMpIHsNCiAgICBpZiAod2lkZ2V0Lm5vSFNjcm9sbCkgew0KICAobGluZVZpZXcuYWxpZ25hYmxlIHx8IChsaW5lVmlldy5hbGlnbmFibGUgPSBbXSkpLnB1c2gobm9kZSk7DQogICAgICB2YXIgd2lkdGggPSBkaW1zLndyYXBwZXJXaWR0aDsNCiAgICAgIG5vZGUuc3R5bGUubGVmdCA9IGRpbXMuZml4ZWRQb3MgKyAicHgiOw0KICAgICAgaWYgKCF3aWRnZXQuY292ZXJHdXR0ZXIpIHsNCiAgICAgICAgd2lkdGggLT0gZGltcy5ndXR0ZXJUb3RhbFdpZHRoOw0KICAgICAgICBub2RlLnN0eWxlLnBhZGRpbmdMZWZ0ID0gZGltcy5ndXR0ZXJUb3RhbFdpZHRoICsgInB4IjsNCiAgICAgIH0NCiAgICAgIG5vZGUuc3R5bGUud2lkdGggPSB3aWR0aCArICJweCI7DQogICAgfQ0KICAgIGlmICh3aWRnZXQuY292ZXJHdXR0ZXIpIHsNCiAgICAgIG5vZGUuc3R5bGUuekluZGV4ID0gNTsNCiAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSAicmVsYXRpdmUiOw0KICAgICAgaWYgKCF3aWRnZXQubm9IU2Nyb2xsKSB7IG5vZGUuc3R5bGUubWFyZ2luTGVmdCA9IC1kaW1zLmd1dHRlclRvdGFsV2lkdGggKyAicHgiOyB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gd2lkZ2V0SGVpZ2h0KHdpZGdldCkgew0KICAgIGlmICh3aWRnZXQuaGVpZ2h0ICE9IG51bGwpIHsgcmV0dXJuIHdpZGdldC5oZWlnaHQgfQ0KICAgIHZhciBjbSA9IHdpZGdldC5kb2MuY207DQogICAgaWYgKCFjbSkgeyByZXR1cm4gMCB9DQogICAgaWYgKCFjb250YWlucyhkb2N1bWVudC5ib2R5LCB3aWRnZXQubm9kZSkpIHsNCiAgICAgIHZhciBwYXJlbnRTdHlsZSA9ICJwb3NpdGlvbjogcmVsYXRpdmU7IjsNCiAgICAgIGlmICh3aWRnZXQuY292ZXJHdXR0ZXIpDQogICAgICAgIHsgcGFyZW50U3R5bGUgKz0gIm1hcmdpbi1sZWZ0OiAtIiArIGNtLmRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aCArICJweDsiOyB9DQogICAgICBpZiAod2lkZ2V0Lm5vSFNjcm9sbCkNCiAgICAgICAgeyBwYXJlbnRTdHlsZSArPSAid2lkdGg6ICIgKyBjbS5kaXNwbGF5LndyYXBwZXIuY2xpZW50V2lkdGggKyAicHg7IjsgfQ0KICAgICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoY20uZGlzcGxheS5tZWFzdXJlLCBlbHQoImRpdiIsIFt3aWRnZXQubm9kZV0sIG51bGwsIHBhcmVudFN0eWxlKSk7DQogICAgfQ0KICAgIHJldHVybiB3aWRnZXQuaGVpZ2h0ID0gd2lkZ2V0Lm5vZGUucGFyZW50Tm9kZS5vZmZzZXRIZWlnaHQNCiAgfQ0KDQogIC8vIFJldHVybiB0cnVlIHdoZW4gdGhlIGdpdmVuIG1vdXNlIGV2ZW50IGhhcHBlbmVkIGluIGEgd2lkZ2V0DQogIGZ1bmN0aW9uIGV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkgew0KICAgIGZvciAodmFyIG4gPSBlX3RhcmdldChlKTsgbiAhPSBkaXNwbGF5LndyYXBwZXI7IG4gPSBuLnBhcmVudE5vZGUpIHsNCiAgICAgIGlmICghbiB8fCAobi5ub2RlVHlwZSA9PSAxICYmIG4uZ2V0QXR0cmlidXRlKCJjbS1pZ25vcmUtZXZlbnRzIikgPT0gInRydWUiKSB8fA0KICAgICAgICAgIChuLnBhcmVudE5vZGUgPT0gZGlzcGxheS5zaXplciAmJiBuICE9IGRpc3BsYXkubW92ZXIpKQ0KICAgICAgICB7IHJldHVybiB0cnVlIH0NCiAgICB9DQogIH0NCg0KICAvLyBQT1NJVElPTiBNRUFTVVJFTUVOVA0KDQogIGZ1bmN0aW9uIHBhZGRpbmdUb3AoZGlzcGxheSkge3JldHVybiBkaXNwbGF5LmxpbmVTcGFjZS5vZmZzZXRUb3B9DQogIGZ1bmN0aW9uIHBhZGRpbmdWZXJ0KGRpc3BsYXkpIHtyZXR1cm4gZGlzcGxheS5tb3Zlci5vZmZzZXRIZWlnaHQgLSBkaXNwbGF5LmxpbmVTcGFjZS5vZmZzZXRIZWlnaHR9DQogIGZ1bmN0aW9uIHBhZGRpbmdIKGRpc3BsYXkpIHsNCiAgICBpZiAoZGlzcGxheS5jYWNoZWRQYWRkaW5nSCkgeyByZXR1cm4gZGlzcGxheS5jYWNoZWRQYWRkaW5nSCB9DQogICAgdmFyIGUgPSByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5Lm1lYXN1cmUsIGVsdCgicHJlIiwgIngiLCAiQ29kZU1pcnJvci1saW5lLWxpa2UiKSk7DQogICAgdmFyIHN0eWxlID0gd2luZG93LmdldENvbXB1dGVkU3R5bGUgPyB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlKSA6IGUuY3VycmVudFN0eWxlOw0KICAgIHZhciBkYXRhID0ge2xlZnQ6IHBhcnNlSW50KHN0eWxlLnBhZGRpbmdMZWZ0KSwgcmlnaHQ6IHBhcnNlSW50KHN0eWxlLnBhZGRpbmdSaWdodCl9Ow0KICAgIGlmICghaXNOYU4oZGF0YS5sZWZ0KSAmJiAhaXNOYU4oZGF0YS5yaWdodCkpIHsgZGlzcGxheS5jYWNoZWRQYWRkaW5nSCA9IGRhdGE7IH0NCiAgICByZXR1cm4gZGF0YQ0KICB9DQoNCiAgZnVuY3Rpb24gc2Nyb2xsR2FwKGNtKSB7IHJldHVybiBzY3JvbGxlckdhcCAtIGNtLmRpc3BsYXkubmF0aXZlQmFyV2lkdGggfQ0KICBmdW5jdGlvbiBkaXNwbGF5V2lkdGgoY20pIHsNCiAgICByZXR1cm4gY20uZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aCAtIHNjcm9sbEdhcChjbSkgLSBjbS5kaXNwbGF5LmJhcldpZHRoDQogIH0NCiAgZnVuY3Rpb24gZGlzcGxheUhlaWdodChjbSkgew0KICAgIHJldHVybiBjbS5kaXNwbGF5LnNjcm9sbGVyLmNsaWVudEhlaWdodCAtIHNjcm9sbEdhcChjbSkgLSBjbS5kaXNwbGF5LmJhckhlaWdodA0KICB9DQoNCiAgLy8gRW5zdXJlIHRoZSBsaW5lVmlldy53cmFwcGluZy5oZWlnaHRzIGFycmF5IGlzIHBvcHVsYXRlZC4gVGhpcyBpcw0KICAvLyBhbiBhcnJheSBvZiBib3R0b20gb2Zmc2V0cyBmb3IgdGhlIGxpbmVzIHRoYXQgbWFrZSB1cCBhIGRyYXduDQogIC8vIGxpbmUuIFdoZW4gbGluZVdyYXBwaW5nIGlzIG9uLCB0aGVyZSBtaWdodCBiZSBtb3JlIHRoYW4gb25lDQogIC8vIGhlaWdodC4NCiAgZnVuY3Rpb24gZW5zdXJlTGluZUhlaWdodHMoY20sIGxpbmVWaWV3LCByZWN0KSB7DQogICAgdmFyIHdyYXBwaW5nID0gY20ub3B0aW9ucy5saW5lV3JhcHBpbmc7DQogICAgdmFyIGN1cldpZHRoID0gd3JhcHBpbmcgJiYgZGlzcGxheVdpZHRoKGNtKTsNCiAgICBpZiAoIWxpbmVWaWV3Lm1lYXN1cmUuaGVpZ2h0cyB8fCB3cmFwcGluZyAmJiBsaW5lVmlldy5tZWFzdXJlLndpZHRoICE9IGN1cldpZHRoKSB7DQogICAgICB2YXIgaGVpZ2h0cyA9IGxpbmVWaWV3Lm1lYXN1cmUuaGVpZ2h0cyA9IFtdOw0KICAgICAgaWYgKHdyYXBwaW5nKSB7DQogICAgICAgIGxpbmVWaWV3Lm1lYXN1cmUud2lkdGggPSBjdXJXaWR0aDsNCiAgICAgICAgdmFyIHJlY3RzID0gbGluZVZpZXcudGV4dC5maXJzdENoaWxkLmdldENsaWVudFJlY3RzKCk7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcmVjdHMubGVuZ3RoIC0gMTsgaSsrKSB7DQogICAgICAgICAgdmFyIGN1ciA9IHJlY3RzW2ldLCBuZXh0ID0gcmVjdHNbaSArIDFdOw0KICAgICAgICAgIGlmIChNYXRoLmFicyhjdXIuYm90dG9tIC0gbmV4dC5ib3R0b20pID4gMikNCiAgICAgICAgICAgIHsgaGVpZ2h0cy5wdXNoKChjdXIuYm90dG9tICsgbmV4dC50b3ApIC8gMiAtIHJlY3QudG9wKTsgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgICBoZWlnaHRzLnB1c2gocmVjdC5ib3R0b20gLSByZWN0LnRvcCk7DQogICAgfQ0KICB9DQoNCiAgLy8gRmluZCBhIGxpbmUgbWFwIChtYXBwaW5nIGNoYXJhY3RlciBvZmZzZXRzIHRvIHRleHQgbm9kZXMpIGFuZCBhDQogIC8vIG1lYXN1cmVtZW50IGNhY2hlIGZvciB0aGUgZ2l2ZW4gbGluZSBudW1iZXIuIChBIGxpbmUgdmlldyBtaWdodA0KICAvLyBjb250YWluIG11bHRpcGxlIGxpbmVzIHdoZW4gY29sbGFwc2VkIHJhbmdlcyBhcmUgcHJlc2VudC4pDQogIGZ1bmN0aW9uIG1hcEZyb21MaW5lVmlldyhsaW5lVmlldywgbGluZSwgbGluZU4pIHsNCiAgICBpZiAobGluZVZpZXcubGluZSA9PSBsaW5lKQ0KICAgICAgeyByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXAsIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlfSB9DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lVmlldy5yZXN0Lmxlbmd0aDsgaSsrKQ0KICAgICAgeyBpZiAobGluZVZpZXcucmVzdFtpXSA9PSBsaW5lKQ0KICAgICAgICB7IHJldHVybiB7bWFwOiBsaW5lVmlldy5tZWFzdXJlLm1hcHNbaV0sIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlc1tpXX0gfSB9DQogICAgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkkMSsrKQ0KICAgICAgeyBpZiAobGluZU5vKGxpbmVWaWV3LnJlc3RbaSQxXSkgPiBsaW5lTikNCiAgICAgICAgeyByZXR1cm4ge21hcDogbGluZVZpZXcubWVhc3VyZS5tYXBzW2kkMV0sIGNhY2hlOiBsaW5lVmlldy5tZWFzdXJlLmNhY2hlc1tpJDFdLCBiZWZvcmU6IHRydWV9IH0gfQ0KICB9DQoNCiAgLy8gUmVuZGVyIGEgbGluZSBpbnRvIHRoZSBoaWRkZW4gbm9kZSBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQuIFVzZWQNCiAgLy8gd2hlbiBtZWFzdXJlbWVudCBpcyBuZWVkZWQgZm9yIGEgbGluZSB0aGF0J3Mgbm90IGluIHRoZSB2aWV3cG9ydC4NCiAgZnVuY3Rpb24gdXBkYXRlRXh0ZXJuYWxNZWFzdXJlbWVudChjbSwgbGluZSkgew0KICAgIGxpbmUgPSB2aXN1YWxMaW5lKGxpbmUpOw0KICAgIHZhciBsaW5lTiA9IGxpbmVObyhsaW5lKTsNCiAgICB2YXIgdmlldyA9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZCA9IG5ldyBMaW5lVmlldyhjbS5kb2MsIGxpbmUsIGxpbmVOKTsNCiAgICB2aWV3LmxpbmVOID0gbGluZU47DQogICAgdmFyIGJ1aWx0ID0gdmlldy5idWlsdCA9IGJ1aWxkTGluZUNvbnRlbnQoY20sIHZpZXcpOw0KICAgIHZpZXcudGV4dCA9IGJ1aWx0LnByZTsNCiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChjbS5kaXNwbGF5LmxpbmVNZWFzdXJlLCBidWlsdC5wcmUpOw0KICAgIHJldHVybiB2aWV3DQogIH0NCg0KICAvLyBHZXQgYSB7dG9wLCBib3R0b20sIGxlZnQsIHJpZ2h0fSBib3ggKGluIGxpbmUtbG9jYWwgY29vcmRpbmF0ZXMpDQogIC8vIGZvciBhIGdpdmVuIGNoYXJhY3Rlci4NCiAgZnVuY3Rpb24gbWVhc3VyZUNoYXIoY20sIGxpbmUsIGNoLCBiaWFzKSB7DQogICAgcmV0dXJuIG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZSksIGNoLCBiaWFzKQ0KICB9DQoNCiAgLy8gRmluZCBhIGxpbmUgdmlldyB0aGF0IGNvcnJlc3BvbmRzIHRvIHRoZSBnaXZlbiBsaW5lIG51bWJlci4NCiAgZnVuY3Rpb24gZmluZFZpZXdGb3JMaW5lKGNtLCBsaW5lTikgew0KICAgIGlmIChsaW5lTiA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tICYmIGxpbmVOIDwgY20uZGlzcGxheS52aWV3VG8pDQogICAgICB7IHJldHVybiBjbS5kaXNwbGF5LnZpZXdbZmluZFZpZXdJbmRleChjbSwgbGluZU4pXSB9DQogICAgdmFyIGV4dCA9IGNtLmRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZDsNCiAgICBpZiAoZXh0ICYmIGxpbmVOID49IGV4dC5saW5lTiAmJiBsaW5lTiA8IGV4dC5saW5lTiArIGV4dC5zaXplKQ0KICAgICAgeyByZXR1cm4gZXh0IH0NCiAgfQ0KDQogIC8vIE1lYXN1cmVtZW50IGNhbiBiZSBzcGxpdCBpbiB0d28gc3RlcHMsIHRoZSBzZXQtdXAgd29yayB0aGF0DQogIC8vIGFwcGxpZXMgdG8gdGhlIHdob2xlIGxpbmUsIGFuZCB0aGUgbWVhc3VyZW1lbnQgb2YgdGhlIGFjdHVhbA0KICAvLyBjaGFyYWN0ZXIuIEZ1bmN0aW9ucyBsaWtlIGNvb3Jkc0NoYXIsIHRoYXQgbmVlZCB0byBkbyBhIGxvdCBvZg0KICAvLyBtZWFzdXJlbWVudHMgaW4gYSByb3csIGNhbiB0aHVzIGVuc3VyZSB0aGF0IHRoZSBzZXQtdXAgd29yayBpcw0KICAvLyBvbmx5IGRvbmUgb25jZS4NCiAgZnVuY3Rpb24gcHJlcGFyZU1lYXN1cmVGb3JMaW5lKGNtLCBsaW5lKSB7DQogICAgdmFyIGxpbmVOID0gbGluZU5vKGxpbmUpOw0KICAgIHZhciB2aWV3ID0gZmluZFZpZXdGb3JMaW5lKGNtLCBsaW5lTik7DQogICAgaWYgKHZpZXcgJiYgIXZpZXcudGV4dCkgew0KICAgICAgdmlldyA9IG51bGw7DQogICAgfSBlbHNlIGlmICh2aWV3ICYmIHZpZXcuY2hhbmdlcykgew0KICAgICAgdXBkYXRlTGluZUZvckNoYW5nZXMoY20sIHZpZXcsIGxpbmVOLCBnZXREaW1lbnNpb25zKGNtKSk7DQogICAgICBjbS5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7DQogICAgfQ0KICAgIGlmICghdmlldykNCiAgICAgIHsgdmlldyA9IHVwZGF0ZUV4dGVybmFsTWVhc3VyZW1lbnQoY20sIGxpbmUpOyB9DQoNCiAgICB2YXIgaW5mbyA9IG1hcEZyb21MaW5lVmlldyh2aWV3LCBsaW5lLCBsaW5lTik7DQogICAgcmV0dXJuIHsNCiAgICAgIGxpbmU6IGxpbmUsIHZpZXc6IHZpZXcsIHJlY3Q6IG51bGwsDQogICAgICBtYXA6IGluZm8ubWFwLCBjYWNoZTogaW5mby5jYWNoZSwgYmVmb3JlOiBpbmZvLmJlZm9yZSwNCiAgICAgIGhhc0hlaWdodHM6IGZhbHNlDQogICAgfQ0KICB9DQoNCiAgLy8gR2l2ZW4gYSBwcmVwYXJlZCBtZWFzdXJlbWVudCBvYmplY3QsIG1lYXN1cmVzIHRoZSBwb3NpdGlvbiBvZiBhbg0KICAvLyBhY3R1YWwgY2hhcmFjdGVyIChvciBmZXRjaGVzIGl0IGZyb20gdGhlIGNhY2hlKS4NCiAgZnVuY3Rpb24gbWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZWQsIGNoLCBiaWFzLCB2YXJIZWlnaHQpIHsNCiAgICBpZiAocHJlcGFyZWQuYmVmb3JlKSB7IGNoID0gLTE7IH0NCiAgICB2YXIga2V5ID0gY2ggKyAoYmlhcyB8fCAiIiksIGZvdW5kOw0KICAgIGlmIChwcmVwYXJlZC5jYWNoZS5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQogICAgICBmb3VuZCA9IHByZXBhcmVkLmNhY2hlW2tleV07DQogICAgfSBlbHNlIHsNCiAgICAgIGlmICghcHJlcGFyZWQucmVjdCkNCiAgICAgICAgeyBwcmVwYXJlZC5yZWN0ID0gcHJlcGFyZWQudmlldy50ZXh0LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOyB9DQogICAgICBpZiAoIXByZXBhcmVkLmhhc0hlaWdodHMpIHsNCiAgICAgICAgZW5zdXJlTGluZUhlaWdodHMoY20sIHByZXBhcmVkLnZpZXcsIHByZXBhcmVkLnJlY3QpOw0KICAgICAgICBwcmVwYXJlZC5oYXNIZWlnaHRzID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGZvdW5kID0gbWVhc3VyZUNoYXJJbm5lcihjbSwgcHJlcGFyZWQsIGNoLCBiaWFzKTsNCiAgICAgIGlmICghZm91bmQuYm9ndXMpIHsgcHJlcGFyZWQuY2FjaGVba2V5XSA9IGZvdW5kOyB9DQogICAgfQ0KICAgIHJldHVybiB7bGVmdDogZm91bmQubGVmdCwgcmlnaHQ6IGZvdW5kLnJpZ2h0LA0KICAgICAgICAgICAgdG9wOiB2YXJIZWlnaHQgPyBmb3VuZC5ydG9wIDogZm91bmQudG9wLA0KICAgICAgICAgICAgYm90dG9tOiB2YXJIZWlnaHQgPyBmb3VuZC5yYm90dG9tIDogZm91bmQuYm90dG9tfQ0KICB9DQoNCiAgdmFyIG51bGxSZWN0ID0ge2xlZnQ6IDAsIHJpZ2h0OiAwLCB0b3A6IDAsIGJvdHRvbTogMH07DQoNCiAgZnVuY3Rpb24gbm9kZUFuZE9mZnNldEluTGluZU1hcChtYXAkJDEsIGNoLCBiaWFzKSB7DQogICAgdmFyIG5vZGUsIHN0YXJ0LCBlbmQsIGNvbGxhcHNlLCBtU3RhcnQsIG1FbmQ7DQogICAgLy8gRmlyc3QsIHNlYXJjaCB0aGUgbGluZSBtYXAgZm9yIHRoZSB0ZXh0IG5vZGUgY29ycmVzcG9uZGluZyB0bywNCiAgICAvLyBvciBjbG9zZXN0IHRvLCB0aGUgdGFyZ2V0IGNoYXJhY3Rlci4NCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcCQkMS5sZW5ndGg7IGkgKz0gMykgew0KICAgICAgbVN0YXJ0ID0gbWFwJCQxW2ldOw0KICAgICAgbUVuZCA9IG1hcCQkMVtpICsgMV07DQogICAgICBpZiAoY2ggPCBtU3RhcnQpIHsNCiAgICAgICAgc3RhcnQgPSAwOyBlbmQgPSAxOw0KICAgICAgICBjb2xsYXBzZSA9ICJsZWZ0IjsNCiAgICAgIH0gZWxzZSBpZiAoY2ggPCBtRW5kKSB7DQogICAgICAgIHN0YXJ0ID0gY2ggLSBtU3RhcnQ7DQogICAgICAgIGVuZCA9IHN0YXJ0ICsgMTsNCiAgICAgIH0gZWxzZSBpZiAoaSA9PSBtYXAkJDEubGVuZ3RoIC0gMyB8fCBjaCA9PSBtRW5kICYmIG1hcCQkMVtpICsgM10gPiBjaCkgew0KICAgICAgICBlbmQgPSBtRW5kIC0gbVN0YXJ0Ow0KICAgICAgICBzdGFydCA9IGVuZCAtIDE7DQogICAgICAgIGlmIChjaCA+PSBtRW5kKSB7IGNvbGxhcHNlID0gInJpZ2h0IjsgfQ0KICAgICAgfQ0KICAgICAgaWYgKHN0YXJ0ICE9IG51bGwpIHsNCiAgICAgICAgbm9kZSA9IG1hcCQkMVtpICsgMl07DQogICAgICAgIGlmIChtU3RhcnQgPT0gbUVuZCAmJiBiaWFzID09IChub2RlLmluc2VydExlZnQgPyAibGVmdCIgOiAicmlnaHQiKSkNCiAgICAgICAgICB7IGNvbGxhcHNlID0gYmlhczsgfQ0KICAgICAgICBpZiAoYmlhcyA9PSAibGVmdCIgJiYgc3RhcnQgPT0gMCkNCiAgICAgICAgICB7IHdoaWxlIChpICYmIG1hcCQkMVtpIC0gMl0gPT0gbWFwJCQxW2kgLSAzXSAmJiBtYXAkJDFbaSAtIDFdLmluc2VydExlZnQpIHsNCiAgICAgICAgICAgIG5vZGUgPSBtYXAkJDFbKGkgLT0gMykgKyAyXTsNCiAgICAgICAgICAgIGNvbGxhcHNlID0gImxlZnQiOw0KICAgICAgICAgIH0gfQ0KICAgICAgICBpZiAoYmlhcyA9PSAicmlnaHQiICYmIHN0YXJ0ID09IG1FbmQgLSBtU3RhcnQpDQogICAgICAgICAgeyB3aGlsZSAoaSA8IG1hcCQkMS5sZW5ndGggLSAzICYmIG1hcCQkMVtpICsgM10gPT0gbWFwJCQxW2kgKyA0XSAmJiAhbWFwJCQxW2kgKyA1XS5pbnNlcnRMZWZ0KSB7DQogICAgICAgICAgICBub2RlID0gbWFwJCQxWyhpICs9IDMpICsgMl07DQogICAgICAgICAgICBjb2xsYXBzZSA9ICJyaWdodCI7DQogICAgICAgICAgfSB9DQogICAgICAgIGJyZWFrDQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiB7bm9kZTogbm9kZSwgc3RhcnQ6IHN0YXJ0LCBlbmQ6IGVuZCwgY29sbGFwc2U6IGNvbGxhcHNlLCBjb3ZlclN0YXJ0OiBtU3RhcnQsIGNvdmVyRW5kOiBtRW5kfQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0VXNlZnVsUmVjdChyZWN0cywgYmlhcykgew0KICAgIHZhciByZWN0ID0gbnVsbFJlY3Q7DQogICAgaWYgKGJpYXMgPT0gImxlZnQiKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgcmVjdHMubGVuZ3RoOyBpKyspIHsNCiAgICAgIGlmICgocmVjdCA9IHJlY3RzW2ldKS5sZWZ0ICE9IHJlY3QucmlnaHQpIHsgYnJlYWsgfQ0KICAgIH0gfSBlbHNlIHsgZm9yICh2YXIgaSQxID0gcmVjdHMubGVuZ3RoIC0gMTsgaSQxID49IDA7IGkkMS0tKSB7DQogICAgICBpZiAoKHJlY3QgPSByZWN0c1tpJDFdKS5sZWZ0ICE9IHJlY3QucmlnaHQpIHsgYnJlYWsgfQ0KICAgIH0gfQ0KICAgIHJldHVybiByZWN0DQogIH0NCg0KICBmdW5jdGlvbiBtZWFzdXJlQ2hhcklubmVyKGNtLCBwcmVwYXJlZCwgY2gsIGJpYXMpIHsNCiAgICB2YXIgcGxhY2UgPSBub2RlQW5kT2Zmc2V0SW5MaW5lTWFwKHByZXBhcmVkLm1hcCwgY2gsIGJpYXMpOw0KICAgIHZhciBub2RlID0gcGxhY2Uubm9kZSwgc3RhcnQgPSBwbGFjZS5zdGFydCwgZW5kID0gcGxhY2UuZW5kLCBjb2xsYXBzZSA9IHBsYWNlLmNvbGxhcHNlOw0KDQogICAgdmFyIHJlY3Q7DQogICAgaWYgKG5vZGUubm9kZVR5cGUgPT0gMykgeyAvLyBJZiBpdCBpcyBhIHRleHQgbm9kZSwgdXNlIGEgcmFuZ2UgdG8gcmV0cmlldmUgdGhlIGNvb3JkaW5hdGVzLg0KICAgICAgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgNDsgaSQxKyspIHsgLy8gUmV0cnkgYSBtYXhpbXVtIG9mIDQgdGltZXMgd2hlbiBub25zZW5zZSByZWN0YW5nbGVzIGFyZSByZXR1cm5lZA0KICAgICAgICB3aGlsZSAoc3RhcnQgJiYgaXNFeHRlbmRpbmdDaGFyKHByZXBhcmVkLmxpbmUudGV4dC5jaGFyQXQocGxhY2UuY292ZXJTdGFydCArIHN0YXJ0KSkpIHsgLS1zdGFydDsgfQ0KICAgICAgICB3aGlsZSAocGxhY2UuY292ZXJTdGFydCArIGVuZCA8IHBsYWNlLmNvdmVyRW5kICYmIGlzRXh0ZW5kaW5nQ2hhcihwcmVwYXJlZC5saW5lLnRleHQuY2hhckF0KHBsYWNlLmNvdmVyU3RhcnQgKyBlbmQpKSkgeyArK2VuZDsgfQ0KICAgICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkgJiYgc3RhcnQgPT0gMCAmJiBlbmQgPT0gcGxhY2UuY292ZXJFbmQgLSBwbGFjZS5jb3ZlclN0YXJ0KQ0KICAgICAgICAgIHsgcmVjdCA9IG5vZGUucGFyZW50Tm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgfQ0KICAgICAgICBlbHNlDQogICAgICAgICAgeyByZWN0ID0gZ2V0VXNlZnVsUmVjdChyYW5nZShub2RlLCBzdGFydCwgZW5kKS5nZXRDbGllbnRSZWN0cygpLCBiaWFzKTsgfQ0KICAgICAgICBpZiAocmVjdC5sZWZ0IHx8IHJlY3QucmlnaHQgfHwgc3RhcnQgPT0gMCkgeyBicmVhayB9DQogICAgICAgIGVuZCA9IHN0YXJ0Ow0KICAgICAgICBzdGFydCA9IHN0YXJ0IC0gMTsNCiAgICAgICAgY29sbGFwc2UgPSAicmlnaHQiOw0KICAgICAgfQ0KICAgICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCAxMSkgeyByZWN0ID0gbWF5YmVVcGRhdGVSZWN0Rm9yWm9vbWluZyhjbS5kaXNwbGF5Lm1lYXN1cmUsIHJlY3QpOyB9DQogICAgfSBlbHNlIHsgLy8gSWYgaXQgaXMgYSB3aWRnZXQsIHNpbXBseSBnZXQgdGhlIGJveCBmb3IgdGhlIHdob2xlIHdpZGdldC4NCiAgICAgIGlmIChzdGFydCA+IDApIHsgY29sbGFwc2UgPSBiaWFzID0gInJpZ2h0IjsgfQ0KICAgICAgdmFyIHJlY3RzOw0KICAgICAgaWYgKGNtLm9wdGlvbnMubGluZVdyYXBwaW5nICYmIChyZWN0cyA9IG5vZGUuZ2V0Q2xpZW50UmVjdHMoKSkubGVuZ3RoID4gMSkNCiAgICAgICAgeyByZWN0ID0gcmVjdHNbYmlhcyA9PSAicmlnaHQiID8gcmVjdHMubGVuZ3RoIC0gMSA6IDBdOyB9DQogICAgICBlbHNlDQogICAgICAgIHsgcmVjdCA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7IH0NCiAgICB9DQogICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA5ICYmICFzdGFydCAmJiAoIXJlY3QgfHwgIXJlY3QubGVmdCAmJiAhcmVjdC5yaWdodCkpIHsNCiAgICAgIHZhciByU3BhbiA9IG5vZGUucGFyZW50Tm9kZS5nZXRDbGllbnRSZWN0cygpWzBdOw0KICAgICAgaWYgKHJTcGFuKQ0KICAgICAgICB7IHJlY3QgPSB7bGVmdDogclNwYW4ubGVmdCwgcmlnaHQ6IHJTcGFuLmxlZnQgKyBjaGFyV2lkdGgoY20uZGlzcGxheSksIHRvcDogclNwYW4udG9wLCBib3R0b206IHJTcGFuLmJvdHRvbX07IH0NCiAgICAgIGVsc2UNCiAgICAgICAgeyByZWN0ID0gbnVsbFJlY3Q7IH0NCiAgICB9DQoNCiAgICB2YXIgcnRvcCA9IHJlY3QudG9wIC0gcHJlcGFyZWQucmVjdC50b3AsIHJib3QgPSByZWN0LmJvdHRvbSAtIHByZXBhcmVkLnJlY3QudG9wOw0KICAgIHZhciBtaWQgPSAocnRvcCArIHJib3QpIC8gMjsNCiAgICB2YXIgaGVpZ2h0cyA9IHByZXBhcmVkLnZpZXcubWVhc3VyZS5oZWlnaHRzOw0KICAgIHZhciBpID0gMDsNCiAgICBmb3IgKDsgaSA8IGhlaWdodHMubGVuZ3RoIC0gMTsgaSsrKQ0KICAgICAgeyBpZiAobWlkIDwgaGVpZ2h0c1tpXSkgeyBicmVhayB9IH0NCiAgICB2YXIgdG9wID0gaSA/IGhlaWdodHNbaSAtIDFdIDogMCwgYm90ID0gaGVpZ2h0c1tpXTsNCiAgICB2YXIgcmVzdWx0ID0ge2xlZnQ6IChjb2xsYXBzZSA9PSAicmlnaHQiID8gcmVjdC5yaWdodCA6IHJlY3QubGVmdCkgLSBwcmVwYXJlZC5yZWN0LmxlZnQsDQogICAgICAgICAgICAgICAgICByaWdodDogKGNvbGxhcHNlID09ICJsZWZ0IiA/IHJlY3QubGVmdCA6IHJlY3QucmlnaHQpIC0gcHJlcGFyZWQucmVjdC5sZWZ0LA0KICAgICAgICAgICAgICAgICAgdG9wOiB0b3AsIGJvdHRvbTogYm90fTsNCiAgICBpZiAoIXJlY3QubGVmdCAmJiAhcmVjdC5yaWdodCkgeyByZXN1bHQuYm9ndXMgPSB0cnVlOyB9DQogICAgaWYgKCFjbS5vcHRpb25zLnNpbmdsZUN1cnNvckhlaWdodFBlckxpbmUpIHsgcmVzdWx0LnJ0b3AgPSBydG9wOyByZXN1bHQucmJvdHRvbSA9IHJib3Q7IH0NCg0KICAgIHJldHVybiByZXN1bHQNCiAgfQ0KDQogIC8vIFdvcmsgYXJvdW5kIHByb2JsZW0gd2l0aCBib3VuZGluZyBjbGllbnQgcmVjdHMgb24gcmFuZ2VzIGJlaW5nDQogIC8vIHJldHVybmVkIGluY29ycmVjdGx5IHdoZW4gem9vbWVkIG9uIElFMTAgYW5kIGJlbG93Lg0KICBmdW5jdGlvbiBtYXliZVVwZGF0ZVJlY3RGb3Jab29taW5nKG1lYXN1cmUsIHJlY3QpIHsNCiAgICBpZiAoIXdpbmRvdy5zY3JlZW4gfHwgc2NyZWVuLmxvZ2ljYWxYRFBJID09IG51bGwgfHwNCiAgICAgICAgc2NyZWVuLmxvZ2ljYWxYRFBJID09IHNjcmVlbi5kZXZpY2VYRFBJIHx8ICFoYXNCYWRab29tZWRSZWN0cyhtZWFzdXJlKSkNCiAgICAgIHsgcmV0dXJuIHJlY3QgfQ0KICAgIHZhciBzY2FsZVggPSBzY3JlZW4ubG9naWNhbFhEUEkgLyBzY3JlZW4uZGV2aWNlWERQSTsNCiAgICB2YXIgc2NhbGVZID0gc2NyZWVuLmxvZ2ljYWxZRFBJIC8gc2NyZWVuLmRldmljZVlEUEk7DQogICAgcmV0dXJuIHtsZWZ0OiByZWN0LmxlZnQgKiBzY2FsZVgsIHJpZ2h0OiByZWN0LnJpZ2h0ICogc2NhbGVYLA0KICAgICAgICAgICAgdG9wOiByZWN0LnRvcCAqIHNjYWxlWSwgYm90dG9tOiByZWN0LmJvdHRvbSAqIHNjYWxlWX0NCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFyTGluZU1lYXN1cmVtZW50Q2FjaGVGb3IobGluZVZpZXcpIHsNCiAgICBpZiAobGluZVZpZXcubWVhc3VyZSkgew0KICAgICAgbGluZVZpZXcubWVhc3VyZS5jYWNoZSA9IHt9Ow0KICAgICAgbGluZVZpZXcubWVhc3VyZS5oZWlnaHRzID0gbnVsbDsNCiAgICAgIGlmIChsaW5lVmlldy5yZXN0KSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZVZpZXcucmVzdC5sZW5ndGg7IGkrKykNCiAgICAgICAgeyBsaW5lVmlldy5tZWFzdXJlLmNhY2hlc1tpXSA9IHt9OyB9IH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlKGNtKSB7DQogICAgY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmUgPSBudWxsOw0KICAgIHJlbW92ZUNoaWxkcmVuKGNtLmRpc3BsYXkubGluZU1lYXN1cmUpOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20uZGlzcGxheS52aWV3Lmxlbmd0aDsgaSsrKQ0KICAgICAgeyBjbGVhckxpbmVNZWFzdXJlbWVudENhY2hlRm9yKGNtLmRpc3BsYXkudmlld1tpXSk7IH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGNsZWFyQ2FjaGVzKGNtKSB7DQogICAgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZShjbSk7DQogICAgY20uZGlzcGxheS5jYWNoZWRDaGFyV2lkdGggPSBjbS5kaXNwbGF5LmNhY2hlZFRleHRIZWlnaHQgPSBjbS5kaXNwbGF5LmNhY2hlZFBhZGRpbmdIID0gbnVsbDsNCiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7IGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSB0cnVlOyB9DQogICAgY20uZGlzcGxheS5saW5lTnVtQ2hhcnMgPSBudWxsOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFnZVNjcm9sbFgoKSB7DQogICAgLy8gV29yayBhcm91bmQgaHR0cHM6Ly9idWdzLmNocm9taXVtLm9yZy9wL2Nocm9taXVtL2lzc3Vlcy9kZXRhaWw/aWQ9NDg5MjA2DQogICAgLy8gd2hpY2ggY2F1c2VzIHBhZ2VfT2Zmc2V0IGFuZCBib3VuZGluZyBjbGllbnQgcmVjdHMgdG8gdXNlDQogICAgLy8gZGlmZmVyZW50IHJlZmVyZW5jZSB2aWV3cG9ydHMgYW5kIGludmFsaWRhdGUgb3VyIGNhbGN1bGF0aW9ucy4NCiAgICBpZiAoY2hyb21lICYmIGFuZHJvaWQpIHsgcmV0dXJuIC0oZG9jdW1lbnQuYm9keS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5sZWZ0IC0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5ib2R5KS5tYXJnaW5MZWZ0KSkgfQ0KICAgIHJldHVybiB3aW5kb3cucGFnZVhPZmZzZXQgfHwgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCB8fCBkb2N1bWVudC5ib2R5KS5zY3JvbGxMZWZ0DQogIH0NCiAgZnVuY3Rpb24gcGFnZVNjcm9sbFkoKSB7DQogICAgaWYgKGNocm9tZSAmJiBhbmRyb2lkKSB7IHJldHVybiAtKGRvY3VtZW50LmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkudG9wIC0gcGFyc2VJbnQoZ2V0Q29tcHV0ZWRTdHlsZShkb2N1bWVudC5ib2R5KS5tYXJnaW5Ub3ApKSB9DQogICAgcmV0dXJuIHdpbmRvdy5wYWdlWU9mZnNldCB8fCAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50IHx8IGRvY3VtZW50LmJvZHkpLnNjcm9sbFRvcA0KICB9DQoNCiAgZnVuY3Rpb24gd2lkZ2V0VG9wSGVpZ2h0KGxpbmVPYmopIHsNCiAgICB2YXIgaGVpZ2h0ID0gMDsNCiAgICBpZiAobGluZU9iai53aWRnZXRzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZU9iai53aWRnZXRzLmxlbmd0aDsgKytpKSB7IGlmIChsaW5lT2JqLndpZGdldHNbaV0uYWJvdmUpDQogICAgICB7IGhlaWdodCArPSB3aWRnZXRIZWlnaHQobGluZU9iai53aWRnZXRzW2ldKTsgfSB9IH0NCiAgICByZXR1cm4gaGVpZ2h0DQogIH0NCg0KICAvLyBDb252ZXJ0cyBhIHt0b3AsIGJvdHRvbSwgbGVmdCwgcmlnaHR9IGJveCBmcm9tIGxpbmUtbG9jYWwNCiAgLy8gY29vcmRpbmF0ZXMgaW50byBhbm90aGVyIGNvb3JkaW5hdGUgc3lzdGVtLiBDb250ZXh0IG1heSBiZSBvbmUgb2YNCiAgLy8gImxpbmUiLCAiZGl2IiAoZGlzcGxheS5saW5lRGl2KSwgImxvY2FsIi4vbnVsbCAoZWRpdG9yKSwgIndpbmRvdyIsDQogIC8vIG9yICJwYWdlIi4NCiAgZnVuY3Rpb24gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCByZWN0LCBjb250ZXh0LCBpbmNsdWRlV2lkZ2V0cykgew0KICAgIGlmICghaW5jbHVkZVdpZGdldHMpIHsNCiAgICAgIHZhciBoZWlnaHQgPSB3aWRnZXRUb3BIZWlnaHQobGluZU9iaik7DQogICAgICByZWN0LnRvcCArPSBoZWlnaHQ7IHJlY3QuYm90dG9tICs9IGhlaWdodDsNCiAgICB9DQogICAgaWYgKGNvbnRleHQgPT0gImxpbmUiKSB7IHJldHVybiByZWN0IH0NCiAgICBpZiAoIWNvbnRleHQpIHsgY29udGV4dCA9ICJsb2NhbCI7IH0NCiAgICB2YXIgeU9mZiA9IGhlaWdodEF0TGluZShsaW5lT2JqKTsNCiAgICBpZiAoY29udGV4dCA9PSAibG9jYWwiKSB7IHlPZmYgKz0gcGFkZGluZ1RvcChjbS5kaXNwbGF5KTsgfQ0KICAgIGVsc2UgeyB5T2ZmIC09IGNtLmRpc3BsYXkudmlld09mZnNldDsgfQ0KICAgIGlmIChjb250ZXh0ID09ICJwYWdlIiB8fCBjb250ZXh0ID09ICJ3aW5kb3ciKSB7DQogICAgICB2YXIgbE9mZiA9IGNtLmRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgICAgeU9mZiArPSBsT2ZmLnRvcCArIChjb250ZXh0ID09ICJ3aW5kb3ciID8gMCA6IHBhZ2VTY3JvbGxZKCkpOw0KICAgICAgdmFyIHhPZmYgPSBsT2ZmLmxlZnQgKyAoY29udGV4dCA9PSAid2luZG93IiA/IDAgOiBwYWdlU2Nyb2xsWCgpKTsNCiAgICAgIHJlY3QubGVmdCArPSB4T2ZmOyByZWN0LnJpZ2h0ICs9IHhPZmY7DQogICAgfQ0KICAgIHJlY3QudG9wICs9IHlPZmY7IHJlY3QuYm90dG9tICs9IHlPZmY7DQogICAgcmV0dXJuIHJlY3QNCiAgfQ0KDQogIC8vIENvdmVydHMgYSBib3ggZnJvbSAiZGl2IiBjb29yZHMgdG8gYW5vdGhlciBjb29yZGluYXRlIHN5c3RlbS4NCiAgLy8gQ29udGV4dCBtYXkgYmUgIndpbmRvdyIsICJwYWdlIiwgImRpdiIsIG9yICJsb2NhbCIuL251bGwuDQogIGZ1bmN0aW9uIGZyb21Db29yZFN5c3RlbShjbSwgY29vcmRzLCBjb250ZXh0KSB7DQogICAgaWYgKGNvbnRleHQgPT0gImRpdiIpIHsgcmV0dXJuIGNvb3JkcyB9DQogICAgdmFyIGxlZnQgPSBjb29yZHMubGVmdCwgdG9wID0gY29vcmRzLnRvcDsNCiAgICAvLyBGaXJzdCBtb3ZlIGludG8gInBhZ2UiIGNvb3JkaW5hdGUgc3lzdGVtDQogICAgaWYgKGNvbnRleHQgPT0gInBhZ2UiKSB7DQogICAgICBsZWZ0IC09IHBhZ2VTY3JvbGxYKCk7DQogICAgICB0b3AgLT0gcGFnZVNjcm9sbFkoKTsNCiAgICB9IGVsc2UgaWYgKGNvbnRleHQgPT0gImxvY2FsIiB8fCAhY29udGV4dCkgew0KICAgICAgdmFyIGxvY2FsQm94ID0gY20uZGlzcGxheS5zaXplci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgIGxlZnQgKz0gbG9jYWxCb3gubGVmdDsNCiAgICAgIHRvcCArPSBsb2NhbEJveC50b3A7DQogICAgfQ0KDQogICAgdmFyIGxpbmVTcGFjZUJveCA9IGNtLmRpc3BsYXkubGluZVNwYWNlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIHJldHVybiB7bGVmdDogbGVmdCAtIGxpbmVTcGFjZUJveC5sZWZ0LCB0b3A6IHRvcCAtIGxpbmVTcGFjZUJveC50b3B9DQogIH0NCg0KICBmdW5jdGlvbiBjaGFyQ29vcmRzKGNtLCBwb3MsIGNvbnRleHQsIGxpbmVPYmosIGJpYXMpIHsNCiAgICBpZiAoIWxpbmVPYmopIHsgbGluZU9iaiA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7IH0NCiAgICByZXR1cm4gaW50b0Nvb3JkU3lzdGVtKGNtLCBsaW5lT2JqLCBtZWFzdXJlQ2hhcihjbSwgbGluZU9iaiwgcG9zLmNoLCBiaWFzKSwgY29udGV4dCkNCiAgfQ0KDQogIC8vIFJldHVybnMgYSBib3ggZm9yIGEgZ2l2ZW4gY3Vyc29yIHBvc2l0aW9uLCB3aGljaCBtYXkgaGF2ZSBhbg0KICAvLyAnb3RoZXInIHByb3BlcnR5IGNvbnRhaW5pbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBzZWNvbmRhcnkgY3Vyc29yDQogIC8vIG9uIGEgYmlkaSBib3VuZGFyeS4NCiAgLy8gQSBjdXJzb3IgUG9zKGxpbmUsIGNoYXIsICJiZWZvcmUiKSBpcyBvbiB0aGUgc2FtZSB2aXN1YWwgbGluZSBhcyBgY2hhciAtIDFgDQogIC8vIGFuZCBhZnRlciBgY2hhciAtIDFgIGluIHdyaXRpbmcgb3JkZXIgb2YgYGNoYXIgLSAxYA0KICAvLyBBIGN1cnNvciBQb3MobGluZSwgY2hhciwgImFmdGVyIikgaXMgb24gdGhlIHNhbWUgdmlzdWFsIGxpbmUgYXMgYGNoYXJgDQogIC8vIGFuZCBiZWZvcmUgYGNoYXJgIGluIHdyaXRpbmcgb3JkZXIgb2YgYGNoYXJgDQogIC8vIEV4YW1wbGVzICh1cHBlci1jYXNlIGxldHRlcnMgYXJlIFJUTCwgbG93ZXItY2FzZSBhcmUgTFRSKToNCiAgLy8gICAgIFBvcygwLCAxLCAuLi4pDQogIC8vICAgICBiZWZvcmUgICBhZnRlcg0KICAvLyBhYiAgICAgYXxiICAgICBhfGINCiAgLy8gYUIgICAgIGF8QiAgICAgYUJ8DQogIC8vIEFiICAgICB8QWIgICAgIEF8Yg0KICAvLyBBQiAgICAgQnxBICAgICBCfEENCiAgLy8gRXZlcnkgcG9zaXRpb24gYWZ0ZXIgdGhlIGxhc3QgY2hhcmFjdGVyIG9uIGEgbGluZSBpcyBjb25zaWRlcmVkIHRvIHN0aWNrDQogIC8vIHRvIHRoZSBsYXN0IGNoYXJhY3RlciBvbiB0aGUgbGluZS4NCiAgZnVuY3Rpb24gY3Vyc29yQ29vcmRzKGNtLCBwb3MsIGNvbnRleHQsIGxpbmVPYmosIHByZXBhcmVkTWVhc3VyZSwgdmFySGVpZ2h0KSB7DQogICAgbGluZU9iaiA9IGxpbmVPYmogfHwgZ2V0TGluZShjbS5kb2MsIHBvcy5saW5lKTsNCiAgICBpZiAoIXByZXBhcmVkTWVhc3VyZSkgeyBwcmVwYXJlZE1lYXN1cmUgPSBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmVPYmopOyB9DQogICAgZnVuY3Rpb24gZ2V0KGNoLCByaWdodCkgew0KICAgICAgdmFyIG0gPSBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZE1lYXN1cmUsIGNoLCByaWdodCA/ICJyaWdodCIgOiAibGVmdCIsIHZhckhlaWdodCk7DQogICAgICBpZiAocmlnaHQpIHsgbS5sZWZ0ID0gbS5yaWdodDsgfSBlbHNlIHsgbS5yaWdodCA9IG0ubGVmdDsgfQ0KICAgICAgcmV0dXJuIGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbSwgY29udGV4dCkNCiAgICB9DQogICAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZU9iaiwgY20uZG9jLmRpcmVjdGlvbiksIGNoID0gcG9zLmNoLCBzdGlja3kgPSBwb3Muc3RpY2t5Ow0KICAgIGlmIChjaCA+PSBsaW5lT2JqLnRleHQubGVuZ3RoKSB7DQogICAgICBjaCA9IGxpbmVPYmoudGV4dC5sZW5ndGg7DQogICAgICBzdGlja3kgPSAiYmVmb3JlIjsNCiAgICB9IGVsc2UgaWYgKGNoIDw9IDApIHsNCiAgICAgIGNoID0gMDsNCiAgICAgIHN0aWNreSA9ICJhZnRlciI7DQogICAgfQ0KICAgIGlmICghb3JkZXIpIHsgcmV0dXJuIGdldChzdGlja3kgPT0gImJlZm9yZSIgPyBjaCAtIDEgOiBjaCwgc3RpY2t5ID09ICJiZWZvcmUiKSB9DQoNCiAgICBmdW5jdGlvbiBnZXRCaWRpKGNoLCBwYXJ0UG9zLCBpbnZlcnQpIHsNCiAgICAgIHZhciBwYXJ0ID0gb3JkZXJbcGFydFBvc10sIHJpZ2h0ID0gcGFydC5sZXZlbCA9PSAxOw0KICAgICAgcmV0dXJuIGdldChpbnZlcnQgPyBjaCAtIDEgOiBjaCwgcmlnaHQgIT0gaW52ZXJ0KQ0KICAgIH0NCiAgICB2YXIgcGFydFBvcyA9IGdldEJpZGlQYXJ0QXQob3JkZXIsIGNoLCBzdGlja3kpOw0KICAgIHZhciBvdGhlciA9IGJpZGlPdGhlcjsNCiAgICB2YXIgdmFsID0gZ2V0QmlkaShjaCwgcGFydFBvcywgc3RpY2t5ID09ICJiZWZvcmUiKTsNCiAgICBpZiAob3RoZXIgIT0gbnVsbCkgeyB2YWwub3RoZXIgPSBnZXRCaWRpKGNoLCBvdGhlciwgc3RpY2t5ICE9ICJiZWZvcmUiKTsgfQ0KICAgIHJldHVybiB2YWwNCiAgfQ0KDQogIC8vIFVzZWQgdG8gY2hlYXBseSBlc3RpbWF0ZSB0aGUgY29vcmRpbmF0ZXMgZm9yIGEgcG9zaXRpb24uIFVzZWQgZm9yDQogIC8vIGludGVybWVkaWF0ZSBzY3JvbGwgdXBkYXRlcy4NCiAgZnVuY3Rpb24gZXN0aW1hdGVDb29yZHMoY20sIHBvcykgew0KICAgIHZhciBsZWZ0ID0gMDsNCiAgICBwb3MgPSBjbGlwUG9zKGNtLmRvYywgcG9zKTsNCiAgICBpZiAoIWNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7IGxlZnQgPSBjaGFyV2lkdGgoY20uZGlzcGxheSkgKiBwb3MuY2g7IH0NCiAgICB2YXIgbGluZU9iaiA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7DQogICAgdmFyIHRvcCA9IGhlaWdodEF0TGluZShsaW5lT2JqKSArIHBhZGRpbmdUb3AoY20uZGlzcGxheSk7DQogICAgcmV0dXJuIHtsZWZ0OiBsZWZ0LCByaWdodDogbGVmdCwgdG9wOiB0b3AsIGJvdHRvbTogdG9wICsgbGluZU9iai5oZWlnaHR9DQogIH0NCg0KICAvLyBQb3NpdGlvbnMgcmV0dXJuZWQgYnkgY29vcmRzQ2hhciBjb250YWluIHNvbWUgZXh0cmEgaW5mb3JtYXRpb24uDQogIC8vIHhSZWwgaXMgdGhlIHJlbGF0aXZlIHggcG9zaXRpb24gb2YgdGhlIGlucHV0IGNvb3JkaW5hdGVzIGNvbXBhcmVkDQogIC8vIHRvIHRoZSBmb3VuZCBwb3NpdGlvbiAoc28geFJlbCA+IDAgbWVhbnMgdGhlIGNvb3JkaW5hdGVzIGFyZSB0bw0KICAvLyB0aGUgcmlnaHQgb2YgdGhlIGNoYXJhY3RlciBwb3NpdGlvbiwgZm9yIGV4YW1wbGUpLiBXaGVuIG91dHNpZGUNCiAgLy8gaXMgdHJ1ZSwgdGhhdCBtZWFucyB0aGUgY29vcmRpbmF0ZXMgbGllIG91dHNpZGUgdGhlIGxpbmUncw0KICAvLyB2ZXJ0aWNhbCByYW5nZS4NCiAgZnVuY3Rpb24gUG9zV2l0aEluZm8obGluZSwgY2gsIHN0aWNreSwgb3V0c2lkZSwgeFJlbCkgew0KICAgIHZhciBwb3MgPSBQb3MobGluZSwgY2gsIHN0aWNreSk7DQogICAgcG9zLnhSZWwgPSB4UmVsOw0KICAgIGlmIChvdXRzaWRlKSB7IHBvcy5vdXRzaWRlID0gb3V0c2lkZTsgfQ0KICAgIHJldHVybiBwb3MNCiAgfQ0KDQogIC8vIENvbXB1dGUgdGhlIGNoYXJhY3RlciBwb3NpdGlvbiBjbG9zZXN0IHRvIHRoZSBnaXZlbiBjb29yZGluYXRlcy4NCiAgLy8gSW5wdXQgbXVzdCBiZSBsaW5lU3BhY2UtbG9jYWwgKCJkaXYiIGNvb3JkaW5hdGUgc3lzdGVtKS4NCiAgZnVuY3Rpb24gY29vcmRzQ2hhcihjbSwgeCwgeSkgew0KICAgIHZhciBkb2MgPSBjbS5kb2M7DQogICAgeSArPSBjbS5kaXNwbGF5LnZpZXdPZmZzZXQ7DQogICAgaWYgKHkgPCAwKSB7IHJldHVybiBQb3NXaXRoSW5mbyhkb2MuZmlyc3QsIDAsIG51bGwsIC0xLCAtMSkgfQ0KICAgIHZhciBsaW5lTiA9IGxpbmVBdEhlaWdodChkb2MsIHkpLCBsYXN0ID0gZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxOw0KICAgIGlmIChsaW5lTiA+IGxhc3QpDQogICAgICB7IHJldHVybiBQb3NXaXRoSW5mbyhkb2MuZmlyc3QgKyBkb2Muc2l6ZSAtIDEsIGdldExpbmUoZG9jLCBsYXN0KS50ZXh0Lmxlbmd0aCwgbnVsbCwgMSwgMSkgfQ0KICAgIGlmICh4IDwgMCkgeyB4ID0gMDsgfQ0KDQogICAgdmFyIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZU4pOw0KICAgIGZvciAoOzspIHsNCiAgICAgIHZhciBmb3VuZCA9IGNvb3Jkc0NoYXJJbm5lcihjbSwgbGluZU9iaiwgbGluZU4sIHgsIHkpOw0KICAgICAgdmFyIGNvbGxhcHNlZCA9IGNvbGxhcHNlZFNwYW5Bcm91bmQobGluZU9iaiwgZm91bmQuY2ggKyAoZm91bmQueFJlbCA+IDAgfHwgZm91bmQub3V0c2lkZSA+IDAgPyAxIDogMCkpOw0KICAgICAgaWYgKCFjb2xsYXBzZWQpIHsgcmV0dXJuIGZvdW5kIH0NCiAgICAgIHZhciByYW5nZUVuZCA9IGNvbGxhcHNlZC5maW5kKDEpOw0KICAgICAgaWYgKHJhbmdlRW5kLmxpbmUgPT0gbGluZU4pIHsgcmV0dXJuIHJhbmdlRW5kIH0NCiAgICAgIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZU4gPSByYW5nZUVuZC5saW5lKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiB3cmFwcGVkTGluZUV4dGVudChjbSwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlLCB5KSB7DQogICAgeSAtPSB3aWRnZXRUb3BIZWlnaHQobGluZU9iaik7DQogICAgdmFyIGVuZCA9IGxpbmVPYmoudGV4dC5sZW5ndGg7DQogICAgdmFyIGJlZ2luID0gZmluZEZpcnN0KGZ1bmN0aW9uIChjaCkgeyByZXR1cm4gbWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZWRNZWFzdXJlLCBjaCAtIDEpLmJvdHRvbSA8PSB5OyB9LCBlbmQsIDApOw0KICAgIGVuZCA9IGZpbmRGaXJzdChmdW5jdGlvbiAoY2gpIHsgcmV0dXJuIG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXBhcmVkTWVhc3VyZSwgY2gpLnRvcCA+IHk7IH0sIGJlZ2luLCBlbmQpOw0KICAgIHJldHVybiB7YmVnaW46IGJlZ2luLCBlbmQ6IGVuZH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHdyYXBwZWRMaW5lRXh0ZW50Q2hhcihjbSwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlLCB0YXJnZXQpIHsNCiAgICBpZiAoIXByZXBhcmVkTWVhc3VyZSkgeyBwcmVwYXJlZE1lYXN1cmUgPSBwcmVwYXJlTWVhc3VyZUZvckxpbmUoY20sIGxpbmVPYmopOyB9DQogICAgdmFyIHRhcmdldFRvcCA9IGludG9Db29yZFN5c3RlbShjbSwgbGluZU9iaiwgbWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZWRNZWFzdXJlLCB0YXJnZXQpLCAibGluZSIpLnRvcDsNCiAgICByZXR1cm4gd3JhcHBlZExpbmVFeHRlbnQoY20sIGxpbmVPYmosIHByZXBhcmVkTWVhc3VyZSwgdGFyZ2V0VG9wKQ0KICB9DQoNCiAgLy8gUmV0dXJucyB0cnVlIGlmIHRoZSBnaXZlbiBzaWRlIG9mIGEgYm94IGlzIGFmdGVyIHRoZSBnaXZlbg0KICAvLyBjb29yZGluYXRlcywgaW4gdG9wLXRvLWJvdHRvbSwgbGVmdC10by1yaWdodCBvcmRlci4NCiAgZnVuY3Rpb24gYm94SXNBZnRlcihib3gsIHgsIHksIGxlZnQpIHsNCiAgICByZXR1cm4gYm94LmJvdHRvbSA8PSB5ID8gZmFsc2UgOiBib3gudG9wID4geSA/IHRydWUgOiAobGVmdCA/IGJveC5sZWZ0IDogYm94LnJpZ2h0KSA+IHgNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvb3Jkc0NoYXJJbm5lcihjbSwgbGluZU9iaiwgbGluZU5vJCQxLCB4LCB5KSB7DQogICAgLy8gTW92ZSB5IGludG8gbGluZS1sb2NhbCBjb29yZGluYXRlIHNwYWNlDQogICAgeSAtPSBoZWlnaHRBdExpbmUobGluZU9iaik7DQogICAgdmFyIHByZXBhcmVkTWVhc3VyZSA9IHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZU9iaik7DQogICAgLy8gV2hlbiBkaXJlY3RseSBjYWxsaW5nIGBtZWFzdXJlQ2hhclByZXBhcmVkYCwgd2UgaGF2ZSB0byBhZGp1c3QNCiAgICAvLyBmb3IgdGhlIHdpZGdldHMgYXQgdGhpcyBsaW5lLg0KICAgIHZhciB3aWRnZXRIZWlnaHQkJDEgPSB3aWRnZXRUb3BIZWlnaHQobGluZU9iaik7DQogICAgdmFyIGJlZ2luID0gMCwgZW5kID0gbGluZU9iai50ZXh0Lmxlbmd0aCwgbHRyID0gdHJ1ZTsNCg0KICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmVPYmosIGNtLmRvYy5kaXJlY3Rpb24pOw0KICAgIC8vIElmIHRoZSBsaW5lIGlzbid0IHBsYWluIGxlZnQtdG8tcmlnaHQgdGV4dCwgZmlyc3QgZmlndXJlIG91dA0KICAgIC8vIHdoaWNoIGJpZGkgc2VjdGlvbiB0aGUgY29vcmRpbmF0ZXMgZmFsbCBpbnRvLg0KICAgIGlmIChvcmRlcikgew0KICAgICAgdmFyIHBhcnQgPSAoY20ub3B0aW9ucy5saW5lV3JhcHBpbmcgPyBjb29yZHNCaWRpUGFydFdyYXBwZWQgOiBjb29yZHNCaWRpUGFydCkNCiAgICAgICAgICAgICAgICAgICAoY20sIGxpbmVPYmosIGxpbmVObyQkMSwgcHJlcGFyZWRNZWFzdXJlLCBvcmRlciwgeCwgeSk7DQogICAgICBsdHIgPSBwYXJ0LmxldmVsICE9IDE7DQogICAgICAvLyBUaGUgYXdrd2FyZCAtMSBvZmZzZXRzIGFyZSBuZWVkZWQgYmVjYXVzZSBmaW5kRmlyc3QgKGNhbGxlZA0KICAgICAgLy8gb24gdGhlc2UgYmVsb3cpIHdpbGwgdHJlYXQgaXRzIGZpcnN0IGJvdW5kIGFzIGluY2x1c2l2ZSwNCiAgICAgIC8vIHNlY29uZCBhcyBleGNsdXNpdmUsIGJ1dCB3ZSB3YW50IHRvIGFjdHVhbGx5IGFkZHJlc3MgdGhlDQogICAgICAvLyBjaGFyYWN0ZXJzIGluIHRoZSBwYXJ0J3MgcmFuZ2UNCiAgICAgIGJlZ2luID0gbHRyID8gcGFydC5mcm9tIDogcGFydC50byAtIDE7DQogICAgICBlbmQgPSBsdHIgPyBwYXJ0LnRvIDogcGFydC5mcm9tIC0gMTsNCiAgICB9DQoNCiAgICAvLyBBIGJpbmFyeSBzZWFyY2ggdG8gZmluZCB0aGUgZmlyc3QgY2hhcmFjdGVyIHdob3NlIGJvdW5kaW5nIGJveA0KICAgIC8vIHN0YXJ0cyBhZnRlciB0aGUgY29vcmRpbmF0ZXMuIElmIHdlIHJ1biBhY3Jvc3MgYW55IHdob3NlIGJveCB3cmFwDQogICAgLy8gdGhlIGNvb3JkaW5hdGVzLCBzdG9yZSB0aGF0Lg0KICAgIHZhciBjaEFyb3VuZCA9IG51bGwsIGJveEFyb3VuZCA9IG51bGw7DQogICAgdmFyIGNoID0gZmluZEZpcnN0KGZ1bmN0aW9uIChjaCkgew0KICAgICAgdmFyIGJveCA9IG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXBhcmVkTWVhc3VyZSwgY2gpOw0KICAgICAgYm94LnRvcCArPSB3aWRnZXRIZWlnaHQkJDE7IGJveC5ib3R0b20gKz0gd2lkZ2V0SGVpZ2h0JCQxOw0KICAgICAgaWYgKCFib3hJc0FmdGVyKGJveCwgeCwgeSwgZmFsc2UpKSB7IHJldHVybiBmYWxzZSB9DQogICAgICBpZiAoYm94LnRvcCA8PSB5ICYmIGJveC5sZWZ0IDw9IHgpIHsNCiAgICAgICAgY2hBcm91bmQgPSBjaDsNCiAgICAgICAgYm94QXJvdW5kID0gYm94Ow0KICAgICAgfQ0KICAgICAgcmV0dXJuIHRydWUNCiAgICB9LCBiZWdpbiwgZW5kKTsNCg0KICAgIHZhciBiYXNlWCwgc3RpY2t5LCBvdXRzaWRlID0gZmFsc2U7DQogICAgLy8gSWYgYSBib3ggYXJvdW5kIHRoZSBjb29yZGluYXRlcyB3YXMgZm91bmQsIHVzZSB0aGF0DQogICAgaWYgKGJveEFyb3VuZCkgew0KICAgICAgLy8gRGlzdGluZ3Vpc2ggY29vcmRpbmF0ZXMgbmVhcmVyIHRvIHRoZSBsZWZ0IG9yIHJpZ2h0IHNpZGUgb2YgdGhlIGJveA0KICAgICAgdmFyIGF0TGVmdCA9IHggLSBib3hBcm91bmQubGVmdCA8IGJveEFyb3VuZC5yaWdodCAtIHgsIGF0U3RhcnQgPSBhdExlZnQgPT0gbHRyOw0KICAgICAgY2ggPSBjaEFyb3VuZCArIChhdFN0YXJ0ID8gMCA6IDEpOw0KICAgICAgc3RpY2t5ID0gYXRTdGFydCA/ICJhZnRlciIgOiAiYmVmb3JlIjsNCiAgICAgIGJhc2VYID0gYXRMZWZ0ID8gYm94QXJvdW5kLmxlZnQgOiBib3hBcm91bmQucmlnaHQ7DQogICAgfSBlbHNlIHsNCiAgICAgIC8vIChBZGp1c3QgZm9yIGV4dGVuZGVkIGJvdW5kLCBpZiBuZWNlc3NhcnkuKQ0KICAgICAgaWYgKCFsdHIgJiYgKGNoID09IGVuZCB8fCBjaCA9PSBiZWdpbikpIHsgY2grKzsgfQ0KICAgICAgLy8gVG8gZGV0ZXJtaW5lIHdoaWNoIHNpZGUgdG8gYXNzb2NpYXRlIHdpdGgsIGdldCB0aGUgYm94IHRvIHRoZQ0KICAgICAgLy8gbGVmdCBvZiB0aGUgY2hhcmFjdGVyIGFuZCBjb21wYXJlIGl0J3MgdmVydGljYWwgcG9zaXRpb24gdG8gdGhlDQogICAgICAvLyBjb29yZGluYXRlcw0KICAgICAgc3RpY2t5ID0gY2ggPT0gMCA/ICJhZnRlciIgOiBjaCA9PSBsaW5lT2JqLnRleHQubGVuZ3RoID8gImJlZm9yZSIgOg0KICAgICAgICAobWVhc3VyZUNoYXJQcmVwYXJlZChjbSwgcHJlcGFyZWRNZWFzdXJlLCBjaCAtIChsdHIgPyAxIDogMCkpLmJvdHRvbSArIHdpZGdldEhlaWdodCQkMSA8PSB5KSA9PSBsdHIgPw0KICAgICAgICAiYWZ0ZXIiIDogImJlZm9yZSI7DQogICAgICAvLyBOb3cgZ2V0IGFjY3VyYXRlIGNvb3JkaW5hdGVzIGZvciB0aGlzIHBsYWNlLCBpbiBvcmRlciB0byBnZXQgYQ0KICAgICAgLy8gYmFzZSBYIHBvc2l0aW9uDQogICAgICB2YXIgY29vcmRzID0gY3Vyc29yQ29vcmRzKGNtLCBQb3MobGluZU5vJCQxLCBjaCwgc3RpY2t5KSwgImxpbmUiLCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUpOw0KICAgICAgYmFzZVggPSBjb29yZHMubGVmdDsNCiAgICAgIG91dHNpZGUgPSB5IDwgY29vcmRzLnRvcCA/IC0xIDogeSA+PSBjb29yZHMuYm90dG9tID8gMSA6IDA7DQogICAgfQ0KDQogICAgY2ggPSBza2lwRXh0ZW5kaW5nQ2hhcnMobGluZU9iai50ZXh0LCBjaCwgMSk7DQogICAgcmV0dXJuIFBvc1dpdGhJbmZvKGxpbmVObyQkMSwgY2gsIHN0aWNreSwgb3V0c2lkZSwgeCAtIGJhc2VYKQ0KICB9DQoNCiAgZnVuY3Rpb24gY29vcmRzQmlkaVBhcnQoY20sIGxpbmVPYmosIGxpbmVObyQkMSwgcHJlcGFyZWRNZWFzdXJlLCBvcmRlciwgeCwgeSkgew0KICAgIC8vIEJpZGkgcGFydHMgYXJlIHNvcnRlZCBsZWZ0LXRvLXJpZ2h0LCBhbmQgaW4gYSBub24tbGluZS13cmFwcGluZw0KICAgIC8vIHNpdHVhdGlvbiwgd2UgY2FuIHRha2UgdGhpcyBvcmRlcmluZyB0byBjb3JyZXNwb25kIHRvIHRoZSB2aXN1YWwNCiAgICAvLyBvcmRlcmluZy4gVGhpcyBmaW5kcyB0aGUgZmlyc3QgcGFydCB3aG9zZSBlbmQgaXMgYWZ0ZXIgdGhlIGdpdmVuDQogICAgLy8gY29vcmRpbmF0ZXMuDQogICAgdmFyIGluZGV4ID0gZmluZEZpcnN0KGZ1bmN0aW9uIChpKSB7DQogICAgICB2YXIgcGFydCA9IG9yZGVyW2ldLCBsdHIgPSBwYXJ0LmxldmVsICE9IDE7DQogICAgICByZXR1cm4gYm94SXNBZnRlcihjdXJzb3JDb29yZHMoY20sIFBvcyhsaW5lTm8kJDEsIGx0ciA/IHBhcnQudG8gOiBwYXJ0LmZyb20sIGx0ciA/ICJiZWZvcmUiIDogImFmdGVyIiksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgImxpbmUiLCBsaW5lT2JqLCBwcmVwYXJlZE1lYXN1cmUpLCB4LCB5LCB0cnVlKQ0KICAgIH0sIDAsIG9yZGVyLmxlbmd0aCAtIDEpOw0KICAgIHZhciBwYXJ0ID0gb3JkZXJbaW5kZXhdOw0KICAgIC8vIElmIHRoaXMgaXNuJ3QgdGhlIGZpcnN0IHBhcnQsIHRoZSBwYXJ0J3Mgc3RhcnQgaXMgYWxzbyBhZnRlcg0KICAgIC8vIHRoZSBjb29yZGluYXRlcywgYW5kIHRoZSBjb29yZGluYXRlcyBhcmVuJ3Qgb24gdGhlIHNhbWUgbGluZSBhcw0KICAgIC8vIHRoYXQgc3RhcnQsIG1vdmUgb25lIHBhcnQgYmFjay4NCiAgICBpZiAoaW5kZXggPiAwKSB7DQogICAgICB2YXIgbHRyID0gcGFydC5sZXZlbCAhPSAxOw0KICAgICAgdmFyIHN0YXJ0ID0gY3Vyc29yQ29vcmRzKGNtLCBQb3MobGluZU5vJCQxLCBsdHIgPyBwYXJ0LmZyb20gOiBwYXJ0LnRvLCBsdHIgPyAiYWZ0ZXIiIDogImJlZm9yZSIpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsaW5lIiwgbGluZU9iaiwgcHJlcGFyZWRNZWFzdXJlKTsNCiAgICAgIGlmIChib3hJc0FmdGVyKHN0YXJ0LCB4LCB5LCB0cnVlKSAmJiBzdGFydC50b3AgPiB5KQ0KICAgICAgICB7IHBhcnQgPSBvcmRlcltpbmRleCAtIDFdOyB9DQogICAgfQ0KICAgIHJldHVybiBwYXJ0DQogIH0NCg0KICBmdW5jdGlvbiBjb29yZHNCaWRpUGFydFdyYXBwZWQoY20sIGxpbmVPYmosIF9saW5lTm8sIHByZXBhcmVkTWVhc3VyZSwgb3JkZXIsIHgsIHkpIHsNCiAgICAvLyBJbiBhIHdyYXBwZWQgbGluZSwgcnRsIHRleHQgb24gd3JhcHBpbmcgYm91bmRhcmllcyBjYW4gZG8gdGhpbmdzDQogICAgLy8gdGhhdCBkb24ndCBjb3JyZXNwb25kIHRvIHRoZSBvcmRlcmluZyBpbiBvdXIgYG9yZGVyYCBhcnJheSBhdA0KICAgIC8vIGFsbCwgc28gYSBiaW5hcnkgc2VhcmNoIGRvZXNuJ3Qgd29yaywgYW5kIHdlIHdhbnQgdG8gcmV0dXJuIGENCiAgICAvLyBwYXJ0IHRoYXQgb25seSBzcGFucyBvbmUgbGluZSBzbyB0aGF0IHRoZSBiaW5hcnkgc2VhcmNoIGluDQogICAgLy8gY29vcmRzQ2hhcklubmVyIGlzIHNhZmUuIEFzIHN1Y2gsIHdlIGZpcnN0IGZpbmQgdGhlIGV4dGVudCBvZiB0aGUNCiAgICAvLyB3cmFwcGVkIGxpbmUsIGFuZCB0aGVuIGRvIGEgZmxhdCBzZWFyY2ggaW4gd2hpY2ggd2UgZGlzY2FyZCBhbnkNCiAgICAvLyBzcGFucyB0aGF0IGFyZW4ndCBvbiB0aGUgbGluZS4NCiAgICB2YXIgcmVmID0gd3JhcHBlZExpbmVFeHRlbnQoY20sIGxpbmVPYmosIHByZXBhcmVkTWVhc3VyZSwgeSk7DQogICAgdmFyIGJlZ2luID0gcmVmLmJlZ2luOw0KICAgIHZhciBlbmQgPSByZWYuZW5kOw0KICAgIGlmICgvXHMvLnRlc3QobGluZU9iai50ZXh0LmNoYXJBdChlbmQgLSAxKSkpIHsgZW5kLS07IH0NCiAgICB2YXIgcGFydCA9IG51bGwsIGNsb3Nlc3REaXN0ID0gbnVsbDsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG9yZGVyLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgcCA9IG9yZGVyW2ldOw0KICAgICAgaWYgKHAuZnJvbSA+PSBlbmQgfHwgcC50byA8PSBiZWdpbikgeyBjb250aW51ZSB9DQogICAgICB2YXIgbHRyID0gcC5sZXZlbCAhPSAxOw0KICAgICAgdmFyIGVuZFggPSBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwYXJlZE1lYXN1cmUsIGx0ciA/IE1hdGgubWluKGVuZCwgcC50bykgLSAxIDogTWF0aC5tYXgoYmVnaW4sIHAuZnJvbSkpLnJpZ2h0Ow0KICAgICAgLy8gV2VpZ2ggYWdhaW5zdCBzcGFucyBlbmRpbmcgYmVmb3JlIHRoaXMsIHNvIHRoYXQgdGhleSBhcmUgb25seQ0KICAgICAgLy8gcGlja2VkIGlmIG5vdGhpbmcgZW5kcyBhZnRlcg0KICAgICAgdmFyIGRpc3QgPSBlbmRYIDwgeCA/IHggLSBlbmRYICsgMWU5IDogZW5kWCAtIHg7DQogICAgICBpZiAoIXBhcnQgfHwgY2xvc2VzdERpc3QgPiBkaXN0KSB7DQogICAgICAgIHBhcnQgPSBwOw0KICAgICAgICBjbG9zZXN0RGlzdCA9IGRpc3Q7DQogICAgICB9DQogICAgfQ0KICAgIGlmICghcGFydCkgeyBwYXJ0ID0gb3JkZXJbb3JkZXIubGVuZ3RoIC0gMV07IH0NCiAgICAvLyBDbGlwIHRoZSBwYXJ0IHRvIHRoZSB3cmFwcGVkIGxpbmUuDQogICAgaWYgKHBhcnQuZnJvbSA8IGJlZ2luKSB7IHBhcnQgPSB7ZnJvbTogYmVnaW4sIHRvOiBwYXJ0LnRvLCBsZXZlbDogcGFydC5sZXZlbH07IH0NCiAgICBpZiAocGFydC50byA+IGVuZCkgeyBwYXJ0ID0ge2Zyb206IHBhcnQuZnJvbSwgdG86IGVuZCwgbGV2ZWw6IHBhcnQubGV2ZWx9OyB9DQogICAgcmV0dXJuIHBhcnQNCiAgfQ0KDQogIHZhciBtZWFzdXJlVGV4dDsNCiAgLy8gQ29tcHV0ZSB0aGUgZGVmYXVsdCB0ZXh0IGhlaWdodC4NCiAgZnVuY3Rpb24gdGV4dEhlaWdodChkaXNwbGF5KSB7DQogICAgaWYgKGRpc3BsYXkuY2FjaGVkVGV4dEhlaWdodCAhPSBudWxsKSB7IHJldHVybiBkaXNwbGF5LmNhY2hlZFRleHRIZWlnaHQgfQ0KICAgIGlmIChtZWFzdXJlVGV4dCA9PSBudWxsKSB7DQogICAgICBtZWFzdXJlVGV4dCA9IGVsdCgicHJlIiwgbnVsbCwgIkNvZGVNaXJyb3ItbGluZS1saWtlIik7DQogICAgICAvLyBNZWFzdXJlIGEgYnVuY2ggb2YgbGluZXMsIGZvciBicm93c2VycyB0aGF0IGNvbXB1dGUNCiAgICAgIC8vIGZyYWN0aW9uYWwgaGVpZ2h0cy4NCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgNDk7ICsraSkgew0KICAgICAgICBtZWFzdXJlVGV4dC5hcHBlbmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZSgieCIpKTsNCiAgICAgICAgbWVhc3VyZVRleHQuYXBwZW5kQ2hpbGQoZWx0KCJiciIpKTsNCiAgICAgIH0NCiAgICAgIG1lYXN1cmVUZXh0LmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCJ4IikpOw0KICAgIH0NCiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChkaXNwbGF5Lm1lYXN1cmUsIG1lYXN1cmVUZXh0KTsNCiAgICB2YXIgaGVpZ2h0ID0gbWVhc3VyZVRleHQub2Zmc2V0SGVpZ2h0IC8gNTA7DQogICAgaWYgKGhlaWdodCA+IDMpIHsgZGlzcGxheS5jYWNoZWRUZXh0SGVpZ2h0ID0gaGVpZ2h0OyB9DQogICAgcmVtb3ZlQ2hpbGRyZW4oZGlzcGxheS5tZWFzdXJlKTsNCiAgICByZXR1cm4gaGVpZ2h0IHx8IDENCiAgfQ0KDQogIC8vIENvbXB1dGUgdGhlIGRlZmF1bHQgY2hhcmFjdGVyIHdpZHRoLg0KICBmdW5jdGlvbiBjaGFyV2lkdGgoZGlzcGxheSkgew0KICAgIGlmIChkaXNwbGF5LmNhY2hlZENoYXJXaWR0aCAhPSBudWxsKSB7IHJldHVybiBkaXNwbGF5LmNhY2hlZENoYXJXaWR0aCB9DQogICAgdmFyIGFuY2hvciA9IGVsdCgic3BhbiIsICJ4eHh4eHh4eHh4Iik7DQogICAgdmFyIHByZSA9IGVsdCgicHJlIiwgW2FuY2hvcl0sICJDb2RlTWlycm9yLWxpbmUtbGlrZSIpOw0KICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkubWVhc3VyZSwgcHJlKTsNCiAgICB2YXIgcmVjdCA9IGFuY2hvci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgd2lkdGggPSAocmVjdC5yaWdodCAtIHJlY3QubGVmdCkgLyAxMDsNCiAgICBpZiAod2lkdGggPiAyKSB7IGRpc3BsYXkuY2FjaGVkQ2hhcldpZHRoID0gd2lkdGg7IH0NCiAgICByZXR1cm4gd2lkdGggfHwgMTANCiAgfQ0KDQogIC8vIERvIGEgYnVsay1yZWFkIG9mIHRoZSBET00gcG9zaXRpb25zIGFuZCBzaXplcyBuZWVkZWQgdG8gZHJhdyB0aGUNCiAgLy8gdmlldywgc28gdGhhdCB3ZSBkb24ndCBpbnRlcmxlYXZlIHJlYWRpbmcgYW5kIHdyaXRpbmcgdG8gdGhlIERPTS4NCiAgZnVuY3Rpb24gZ2V0RGltZW5zaW9ucyhjbSkgew0KICAgIHZhciBkID0gY20uZGlzcGxheSwgbGVmdCA9IHt9LCB3aWR0aCA9IHt9Ow0KICAgIHZhciBndXR0ZXJMZWZ0ID0gZC5ndXR0ZXJzLmNsaWVudExlZnQ7DQogICAgZm9yICh2YXIgbiA9IGQuZ3V0dGVycy5maXJzdENoaWxkLCBpID0gMDsgbjsgbiA9IG4ubmV4dFNpYmxpbmcsICsraSkgew0KICAgICAgdmFyIGlkID0gY20uZGlzcGxheS5ndXR0ZXJTcGVjc1tpXS5jbGFzc05hbWU7DQogICAgICBsZWZ0W2lkXSA9IG4ub2Zmc2V0TGVmdCArIG4uY2xpZW50TGVmdCArIGd1dHRlckxlZnQ7DQogICAgICB3aWR0aFtpZF0gPSBuLmNsaWVudFdpZHRoOw0KICAgIH0NCiAgICByZXR1cm4ge2ZpeGVkUG9zOiBjb21wZW5zYXRlRm9ySFNjcm9sbChkKSwNCiAgICAgICAgICAgIGd1dHRlclRvdGFsV2lkdGg6IGQuZ3V0dGVycy5vZmZzZXRXaWR0aCwNCiAgICAgICAgICAgIGd1dHRlckxlZnQ6IGxlZnQsDQogICAgICAgICAgICBndXR0ZXJXaWR0aDogd2lkdGgsDQogICAgICAgICAgICB3cmFwcGVyV2lkdGg6IGQud3JhcHBlci5jbGllbnRXaWR0aH0NCiAgfQ0KDQogIC8vIENvbXB1dGVzIGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCArIGRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aCwNCiAgLy8gYnV0IHVzaW5nIGdldEJvdW5kaW5nQ2xpZW50UmVjdCB0byBnZXQgYSBzdWItcGl4ZWwtYWNjdXJhdGUNCiAgLy8gcmVzdWx0Lg0KICBmdW5jdGlvbiBjb21wZW5zYXRlRm9ySFNjcm9sbChkaXNwbGF5KSB7DQogICAgcmV0dXJuIGRpc3BsYXkuc2Nyb2xsZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdCAtIGRpc3BsYXkuc2l6ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkubGVmdA0KICB9DQoNCiAgLy8gUmV0dXJucyBhIGZ1bmN0aW9uIHRoYXQgZXN0aW1hdGVzIHRoZSBoZWlnaHQgb2YgYSBsaW5lLCB0byB1c2UgYXMNCiAgLy8gZmlyc3QgYXBwcm94aW1hdGlvbiB1bnRpbCB0aGUgbGluZSBiZWNvbWVzIHZpc2libGUgKGFuZCBpcyB0aHVzDQogIC8vIHByb3Blcmx5IG1lYXN1cmFibGUpLg0KICBmdW5jdGlvbiBlc3RpbWF0ZUhlaWdodChjbSkgew0KICAgIHZhciB0aCA9IHRleHRIZWlnaHQoY20uZGlzcGxheSksIHdyYXBwaW5nID0gY20ub3B0aW9ucy5saW5lV3JhcHBpbmc7DQogICAgdmFyIHBlckxpbmUgPSB3cmFwcGluZyAmJiBNYXRoLm1heCg1LCBjbS5kaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoIC8gY2hhcldpZHRoKGNtLmRpc3BsYXkpIC0gMyk7DQogICAgcmV0dXJuIGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICBpZiAobGluZUlzSGlkZGVuKGNtLmRvYywgbGluZSkpIHsgcmV0dXJuIDAgfQ0KDQogICAgICB2YXIgd2lkZ2V0c0hlaWdodCA9IDA7DQogICAgICBpZiAobGluZS53aWRnZXRzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS53aWRnZXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgIGlmIChsaW5lLndpZGdldHNbaV0uaGVpZ2h0KSB7IHdpZGdldHNIZWlnaHQgKz0gbGluZS53aWRnZXRzW2ldLmhlaWdodDsgfQ0KICAgICAgfSB9DQoNCiAgICAgIGlmICh3cmFwcGluZykNCiAgICAgICAgeyByZXR1cm4gd2lkZ2V0c0hlaWdodCArIChNYXRoLmNlaWwobGluZS50ZXh0Lmxlbmd0aCAvIHBlckxpbmUpIHx8IDEpICogdGggfQ0KICAgICAgZWxzZQ0KICAgICAgICB7IHJldHVybiB3aWRnZXRzSGVpZ2h0ICsgdGggfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGVzdGltYXRlTGluZUhlaWdodHMoY20pIHsNCiAgICB2YXIgZG9jID0gY20uZG9jLCBlc3QgPSBlc3RpbWF0ZUhlaWdodChjbSk7DQogICAgZG9jLml0ZXIoZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgIHZhciBlc3RIZWlnaHQgPSBlc3QobGluZSk7DQogICAgICBpZiAoZXN0SGVpZ2h0ICE9IGxpbmUuaGVpZ2h0KSB7IHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgZXN0SGVpZ2h0KTsgfQ0KICAgIH0pOw0KICB9DQoNCiAgLy8gR2l2ZW4gYSBtb3VzZSBldmVudCwgZmluZCB0aGUgY29ycmVzcG9uZGluZyBwb3NpdGlvbi4gSWYgbGliZXJhbA0KICAvLyBpcyBmYWxzZSwgaXQgY2hlY2tzIHdoZXRoZXIgYSBndXR0ZXIgb3Igc2Nyb2xsYmFyIHdhcyBjbGlja2VkLA0KICAvLyBhbmQgcmV0dXJucyBudWxsIGlmIGl0IHdhcy4gZm9yUmVjdCBpcyB1c2VkIGJ5IHJlY3Rhbmd1bGFyDQogIC8vIHNlbGVjdGlvbnMsIGFuZCB0cmllcyB0byBlc3RpbWF0ZSBhIGNoYXJhY3RlciBwb3NpdGlvbiBldmVuIGZvcg0KICAvLyBjb29yZGluYXRlcyBiZXlvbmQgdGhlIHJpZ2h0IG9mIHRoZSB0ZXh0Lg0KICBmdW5jdGlvbiBwb3NGcm9tTW91c2UoY20sIGUsIGxpYmVyYWwsIGZvclJlY3QpIHsNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7DQogICAgaWYgKCFsaWJlcmFsICYmIGVfdGFyZ2V0KGUpLmdldEF0dHJpYnV0ZSgiY20tbm90LWNvbnRlbnQiKSA9PSAidHJ1ZSIpIHsgcmV0dXJuIG51bGwgfQ0KDQogICAgdmFyIHgsIHksIHNwYWNlID0gZGlzcGxheS5saW5lU3BhY2UuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgLy8gRmFpbHMgdW5wcmVkaWN0YWJseSBvbiBJRVs2N10gd2hlbiBtb3VzZSBpcyBkcmFnZ2VkIGFyb3VuZCBxdWlja2x5Lg0KICAgIHRyeSB7IHggPSBlLmNsaWVudFggLSBzcGFjZS5sZWZ0OyB5ID0gZS5jbGllbnRZIC0gc3BhY2UudG9wOyB9DQogICAgY2F0Y2ggKGUpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHZhciBjb29yZHMgPSBjb29yZHNDaGFyKGNtLCB4LCB5KSwgbGluZTsNCiAgICBpZiAoZm9yUmVjdCAmJiBjb29yZHMueFJlbCA+IDAgJiYgKGxpbmUgPSBnZXRMaW5lKGNtLmRvYywgY29vcmRzLmxpbmUpLnRleHQpLmxlbmd0aCA9PSBjb29yZHMuY2gpIHsNCiAgICAgIHZhciBjb2xEaWZmID0gY291bnRDb2x1bW4obGluZSwgbGluZS5sZW5ndGgsIGNtLm9wdGlvbnMudGFiU2l6ZSkgLSBsaW5lLmxlbmd0aDsNCiAgICAgIGNvb3JkcyA9IFBvcyhjb29yZHMubGluZSwgTWF0aC5tYXgoMCwgTWF0aC5yb3VuZCgoeCAtIHBhZGRpbmdIKGNtLmRpc3BsYXkpLmxlZnQpIC8gY2hhcldpZHRoKGNtLmRpc3BsYXkpKSAtIGNvbERpZmYpKTsNCiAgICB9DQogICAgcmV0dXJuIGNvb3Jkcw0KICB9DQoNCiAgLy8gRmluZCB0aGUgdmlldyBlbGVtZW50IGNvcnJlc3BvbmRpbmcgdG8gYSBnaXZlbiBsaW5lLiBSZXR1cm4gbnVsbA0KICAvLyB3aGVuIHRoZSBsaW5lIGlzbid0IHZpc2libGUuDQogIGZ1bmN0aW9uIGZpbmRWaWV3SW5kZXgoY20sIG4pIHsNCiAgICBpZiAobiA+PSBjbS5kaXNwbGF5LnZpZXdUbykgeyByZXR1cm4gbnVsbCB9DQogICAgbiAtPSBjbS5kaXNwbGF5LnZpZXdGcm9tOw0KICAgIGlmIChuIDwgMCkgeyByZXR1cm4gbnVsbCB9DQogICAgdmFyIHZpZXcgPSBjbS5kaXNwbGF5LnZpZXc7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7DQogICAgICBuIC09IHZpZXdbaV0uc2l6ZTsNCiAgICAgIGlmIChuIDwgMCkgeyByZXR1cm4gaSB9DQogICAgfQ0KICB9DQoNCiAgLy8gVXBkYXRlcyB0aGUgZGlzcGxheS52aWV3IGRhdGEgc3RydWN0dXJlIGZvciBhIGdpdmVuIGNoYW5nZSB0byB0aGUNCiAgLy8gZG9jdW1lbnQuIEZyb20gYW5kIHRvIGFyZSBpbiBwcmUtY2hhbmdlIGNvb3JkaW5hdGVzLiBMZW5kaWZmIGlzDQogIC8vIHRoZSBhbW91bnQgb2YgbGluZXMgYWRkZWQgb3Igc3VidHJhY3RlZCBieSB0aGUgY2hhbmdlLiBUaGlzIGlzDQogIC8vIHVzZWQgZm9yIGNoYW5nZXMgdGhhdCBzcGFuIG11bHRpcGxlIGxpbmVzLCBvciBjaGFuZ2UgdGhlIHdheQ0KICAvLyBsaW5lcyBhcmUgZGl2aWRlZCBpbnRvIHZpc3VhbCBsaW5lcy4gcmVnTGluZUNoYW5nZSAoYmVsb3cpDQogIC8vIHJlZ2lzdGVycyBzaW5nbGUtbGluZSBjaGFuZ2VzLg0KICBmdW5jdGlvbiByZWdDaGFuZ2UoY20sIGZyb20sIHRvLCBsZW5kaWZmKSB7DQogICAgaWYgKGZyb20gPT0gbnVsbCkgeyBmcm9tID0gY20uZG9jLmZpcnN0OyB9DQogICAgaWYgKHRvID09IG51bGwpIHsgdG8gPSBjbS5kb2MuZmlyc3QgKyBjbS5kb2Muc2l6ZTsgfQ0KICAgIGlmICghbGVuZGlmZikgeyBsZW5kaWZmID0gMDsgfQ0KDQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5Ow0KICAgIGlmIChsZW5kaWZmICYmIHRvIDwgZGlzcGxheS52aWV3VG8gJiYNCiAgICAgICAgKGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPT0gbnVsbCB8fCBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID4gZnJvbSkpDQogICAgICB7IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPSBmcm9tOyB9DQoNCiAgICBjbS5jdXJPcC52aWV3Q2hhbmdlZCA9IHRydWU7DQoNCiAgICBpZiAoZnJvbSA+PSBkaXNwbGF5LnZpZXdUbykgeyAvLyBDaGFuZ2UgYWZ0ZXINCiAgICAgIGlmIChzYXdDb2xsYXBzZWRTcGFucyAmJiB2aXN1YWxMaW5lTm8oY20uZG9jLCBmcm9tKSA8IGRpc3BsYXkudmlld1RvKQ0KICAgICAgICB7IHJlc2V0VmlldyhjbSk7IH0NCiAgICB9IGVsc2UgaWYgKHRvIDw9IGRpc3BsYXkudmlld0Zyb20pIHsgLy8gQ2hhbmdlIGJlZm9yZQ0KICAgICAgaWYgKHNhd0NvbGxhcHNlZFNwYW5zICYmIHZpc3VhbExpbmVFbmRObyhjbS5kb2MsIHRvICsgbGVuZGlmZikgPiBkaXNwbGF5LnZpZXdGcm9tKSB7DQogICAgICAgIHJlc2V0VmlldyhjbSk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBkaXNwbGF5LnZpZXdGcm9tICs9IGxlbmRpZmY7DQogICAgICAgIGRpc3BsYXkudmlld1RvICs9IGxlbmRpZmY7DQogICAgICB9DQogICAgfSBlbHNlIGlmIChmcm9tIDw9IGRpc3BsYXkudmlld0Zyb20gJiYgdG8gPj0gZGlzcGxheS52aWV3VG8pIHsgLy8gRnVsbCBvdmVybGFwDQogICAgICByZXNldFZpZXcoY20pOw0KICAgIH0gZWxzZSBpZiAoZnJvbSA8PSBkaXNwbGF5LnZpZXdGcm9tKSB7IC8vIFRvcCBvdmVybGFwDQogICAgICB2YXIgY3V0ID0gdmlld0N1dHRpbmdQb2ludChjbSwgdG8sIHRvICsgbGVuZGlmZiwgMSk7DQogICAgICBpZiAoY3V0KSB7DQogICAgICAgIGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZShjdXQuaW5kZXgpOw0KICAgICAgICBkaXNwbGF5LnZpZXdGcm9tID0gY3V0LmxpbmVOOw0KICAgICAgICBkaXNwbGF5LnZpZXdUbyArPSBsZW5kaWZmOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcmVzZXRWaWV3KGNtKTsNCiAgICAgIH0NCiAgICB9IGVsc2UgaWYgKHRvID49IGRpc3BsYXkudmlld1RvKSB7IC8vIEJvdHRvbSBvdmVybGFwDQogICAgICB2YXIgY3V0JDEgPSB2aWV3Q3V0dGluZ1BvaW50KGNtLCBmcm9tLCBmcm9tLCAtMSk7DQogICAgICBpZiAoY3V0JDEpIHsNCiAgICAgICAgZGlzcGxheS52aWV3ID0gZGlzcGxheS52aWV3LnNsaWNlKDAsIGN1dCQxLmluZGV4KTsNCiAgICAgICAgZGlzcGxheS52aWV3VG8gPSBjdXQkMS5saW5lTjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc2V0VmlldyhjbSk7DQogICAgICB9DQogICAgfSBlbHNlIHsgLy8gR2FwIGluIHRoZSBtaWRkbGUNCiAgICAgIHZhciBjdXRUb3AgPSB2aWV3Q3V0dGluZ1BvaW50KGNtLCBmcm9tLCBmcm9tLCAtMSk7DQogICAgICB2YXIgY3V0Qm90ID0gdmlld0N1dHRpbmdQb2ludChjbSwgdG8sIHRvICsgbGVuZGlmZiwgMSk7DQogICAgICBpZiAoY3V0VG9wICYmIGN1dEJvdCkgew0KICAgICAgICBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoMCwgY3V0VG9wLmluZGV4KQ0KICAgICAgICAgIC5jb25jYXQoYnVpbGRWaWV3QXJyYXkoY20sIGN1dFRvcC5saW5lTiwgY3V0Qm90LmxpbmVOKSkNCiAgICAgICAgICAuY29uY2F0KGRpc3BsYXkudmlldy5zbGljZShjdXRCb3QuaW5kZXgpKTsNCiAgICAgICAgZGlzcGxheS52aWV3VG8gKz0gbGVuZGlmZjsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHJlc2V0VmlldyhjbSk7DQogICAgICB9DQogICAgfQ0KDQogICAgdmFyIGV4dCA9IGRpc3BsYXkuZXh0ZXJuYWxNZWFzdXJlZDsNCiAgICBpZiAoZXh0KSB7DQogICAgICBpZiAodG8gPCBleHQubGluZU4pDQogICAgICAgIHsgZXh0LmxpbmVOICs9IGxlbmRpZmY7IH0NCiAgICAgIGVsc2UgaWYgKGZyb20gPCBleHQubGluZU4gKyBleHQuc2l6ZSkNCiAgICAgICAgeyBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBudWxsOyB9DQogICAgfQ0KICB9DQoNCiAgLy8gUmVnaXN0ZXIgYSBjaGFuZ2UgdG8gYSBzaW5nbGUgbGluZS4gVHlwZSBtdXN0IGJlIG9uZSBvZiAidGV4dCIsDQogIC8vICJndXR0ZXIiLCAiY2xhc3MiLCAid2lkZ2V0Ig0KICBmdW5jdGlvbiByZWdMaW5lQ2hhbmdlKGNtLCBsaW5lLCB0eXBlKSB7DQogICAgY20uY3VyT3Audmlld0NoYW5nZWQgPSB0cnVlOw0KICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgZXh0ID0gY20uZGlzcGxheS5leHRlcm5hbE1lYXN1cmVkOw0KICAgIGlmIChleHQgJiYgbGluZSA+PSBleHQubGluZU4gJiYgbGluZSA8IGV4dC5saW5lTiArIGV4dC5zaXplKQ0KICAgICAgeyBkaXNwbGF5LmV4dGVybmFsTWVhc3VyZWQgPSBudWxsOyB9DQoNCiAgICBpZiAobGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHwgbGluZSA+PSBkaXNwbGF5LnZpZXdUbykgeyByZXR1cm4gfQ0KICAgIHZhciBsaW5lVmlldyA9IGRpc3BsYXkudmlld1tmaW5kVmlld0luZGV4KGNtLCBsaW5lKV07DQogICAgaWYgKGxpbmVWaWV3Lm5vZGUgPT0gbnVsbCkgeyByZXR1cm4gfQ0KICAgIHZhciBhcnIgPSBsaW5lVmlldy5jaGFuZ2VzIHx8IChsaW5lVmlldy5jaGFuZ2VzID0gW10pOw0KICAgIGlmIChpbmRleE9mKGFyciwgdHlwZSkgPT0gLTEpIHsgYXJyLnB1c2godHlwZSk7IH0NCiAgfQ0KDQogIC8vIENsZWFyIHRoZSB2aWV3Lg0KICBmdW5jdGlvbiByZXNldFZpZXcoY20pIHsNCiAgICBjbS5kaXNwbGF5LnZpZXdGcm9tID0gY20uZGlzcGxheS52aWV3VG8gPSBjbS5kb2MuZmlyc3Q7DQogICAgY20uZGlzcGxheS52aWV3ID0gW107DQogICAgY20uZGlzcGxheS52aWV3T2Zmc2V0ID0gMDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHZpZXdDdXR0aW5nUG9pbnQoY20sIG9sZE4sIG5ld04sIGRpcikgew0KICAgIHZhciBpbmRleCA9IGZpbmRWaWV3SW5kZXgoY20sIG9sZE4pLCBkaWZmLCB2aWV3ID0gY20uZGlzcGxheS52aWV3Ow0KICAgIGlmICghc2F3Q29sbGFwc2VkU3BhbnMgfHwgbmV3TiA9PSBjbS5kb2MuZmlyc3QgKyBjbS5kb2Muc2l6ZSkNCiAgICAgIHsgcmV0dXJuIHtpbmRleDogaW5kZXgsIGxpbmVOOiBuZXdOfSB9DQogICAgdmFyIG4gPSBjbS5kaXNwbGF5LnZpZXdGcm9tOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5kZXg7IGkrKykNCiAgICAgIHsgbiArPSB2aWV3W2ldLnNpemU7IH0NCiAgICBpZiAobiAhPSBvbGROKSB7DQogICAgICBpZiAoZGlyID4gMCkgew0KICAgICAgICBpZiAoaW5kZXggPT0gdmlldy5sZW5ndGggLSAxKSB7IHJldHVybiBudWxsIH0NCiAgICAgICAgZGlmZiA9IChuICsgdmlld1tpbmRleF0uc2l6ZSkgLSBvbGROOw0KICAgICAgICBpbmRleCsrOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZGlmZiA9IG4gLSBvbGROOw0KICAgICAgfQ0KICAgICAgb2xkTiArPSBkaWZmOyBuZXdOICs9IGRpZmY7DQogICAgfQ0KICAgIHdoaWxlICh2aXN1YWxMaW5lTm8oY20uZG9jLCBuZXdOKSAhPSBuZXdOKSB7DQogICAgICBpZiAoaW5kZXggPT0gKGRpciA8IDAgPyAwIDogdmlldy5sZW5ndGggLSAxKSkgeyByZXR1cm4gbnVsbCB9DQogICAgICBuZXdOICs9IGRpciAqIHZpZXdbaW5kZXggLSAoZGlyIDwgMCA/IDEgOiAwKV0uc2l6ZTsNCiAgICAgIGluZGV4ICs9IGRpcjsNCiAgICB9DQogICAgcmV0dXJuIHtpbmRleDogaW5kZXgsIGxpbmVOOiBuZXdOfQ0KICB9DQoNCiAgLy8gRm9yY2UgdGhlIHZpZXcgdG8gY292ZXIgYSBnaXZlbiByYW5nZSwgYWRkaW5nIGVtcHR5IHZpZXcgZWxlbWVudA0KICAvLyBvciBjbGlwcGluZyBvZmYgZXhpc3Rpbmcgb25lcyBhcyBuZWVkZWQuDQogIGZ1bmN0aW9uIGFkanVzdFZpZXcoY20sIGZyb20sIHRvKSB7DQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCB2aWV3ID0gZGlzcGxheS52aWV3Ow0KICAgIGlmICh2aWV3Lmxlbmd0aCA9PSAwIHx8IGZyb20gPj0gZGlzcGxheS52aWV3VG8gfHwgdG8gPD0gZGlzcGxheS52aWV3RnJvbSkgew0KICAgICAgZGlzcGxheS52aWV3ID0gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIHRvKTsNCiAgICAgIGRpc3BsYXkudmlld0Zyb20gPSBmcm9tOw0KICAgIH0gZWxzZSB7DQogICAgICBpZiAoZGlzcGxheS52aWV3RnJvbSA+IGZyb20pDQogICAgICAgIHsgZGlzcGxheS52aWV3ID0gYnVpbGRWaWV3QXJyYXkoY20sIGZyb20sIGRpc3BsYXkudmlld0Zyb20pLmNvbmNhdChkaXNwbGF5LnZpZXcpOyB9DQogICAgICBlbHNlIGlmIChkaXNwbGF5LnZpZXdGcm9tIDwgZnJvbSkNCiAgICAgICAgeyBkaXNwbGF5LnZpZXcgPSBkaXNwbGF5LnZpZXcuc2xpY2UoZmluZFZpZXdJbmRleChjbSwgZnJvbSkpOyB9DQogICAgICBkaXNwbGF5LnZpZXdGcm9tID0gZnJvbTsNCiAgICAgIGlmIChkaXNwbGF5LnZpZXdUbyA8IHRvKQ0KICAgICAgICB7IGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5jb25jYXQoYnVpbGRWaWV3QXJyYXkoY20sIGRpc3BsYXkudmlld1RvLCB0bykpOyB9DQogICAgICBlbHNlIGlmIChkaXNwbGF5LnZpZXdUbyA+IHRvKQ0KICAgICAgICB7IGRpc3BsYXkudmlldyA9IGRpc3BsYXkudmlldy5zbGljZSgwLCBmaW5kVmlld0luZGV4KGNtLCB0bykpOyB9DQogICAgfQ0KICAgIGRpc3BsYXkudmlld1RvID0gdG87DQogIH0NCg0KICAvLyBDb3VudCB0aGUgbnVtYmVyIG9mIGxpbmVzIGluIHRoZSB2aWV3IHdob3NlIERPTSByZXByZXNlbnRhdGlvbiBpcw0KICAvLyBvdXQgb2YgZGF0ZSAob3Igbm9uZXhpc3RlbnQpLg0KICBmdW5jdGlvbiBjb3VudERpcnR5VmlldyhjbSkgew0KICAgIHZhciB2aWV3ID0gY20uZGlzcGxheS52aWV3LCBkaXJ0eSA9IDA7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgbGluZVZpZXcgPSB2aWV3W2ldOw0KICAgICAgaWYgKCFsaW5lVmlldy5oaWRkZW4gJiYgKCFsaW5lVmlldy5ub2RlIHx8IGxpbmVWaWV3LmNoYW5nZXMpKSB7ICsrZGlydHk7IH0NCiAgICB9DQogICAgcmV0dXJuIGRpcnR5DQogIH0NCg0KICBmdW5jdGlvbiB1cGRhdGVTZWxlY3Rpb24oY20pIHsNCiAgICBjbS5kaXNwbGF5LmlucHV0LnNob3dTZWxlY3Rpb24oY20uZGlzcGxheS5pbnB1dC5wcmVwYXJlU2VsZWN0aW9uKCkpOw0KICB9DQoNCiAgZnVuY3Rpb24gcHJlcGFyZVNlbGVjdGlvbihjbSwgcHJpbWFyeSkgew0KICAgIGlmICggcHJpbWFyeSA9PT0gdm9pZCAwICkgcHJpbWFyeSA9IHRydWU7DQoNCiAgICB2YXIgZG9jID0gY20uZG9jLCByZXN1bHQgPSB7fTsNCiAgICB2YXIgY3VyRnJhZ21lbnQgPSByZXN1bHQuY3Vyc29ycyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICB2YXIgc2VsRnJhZ21lbnQgPSByZXN1bHQuc2VsZWN0aW9uID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgaWYgKCFwcmltYXJ5ICYmIGkgPT0gZG9jLnNlbC5wcmltSW5kZXgpIHsgY29udGludWUgfQ0KICAgICAgdmFyIHJhbmdlJCQxID0gZG9jLnNlbC5yYW5nZXNbaV07DQogICAgICBpZiAocmFuZ2UkJDEuZnJvbSgpLmxpbmUgPj0gY20uZGlzcGxheS52aWV3VG8gfHwgcmFuZ2UkJDEudG8oKS5saW5lIDwgY20uZGlzcGxheS52aWV3RnJvbSkgeyBjb250aW51ZSB9DQogICAgICB2YXIgY29sbGFwc2VkID0gcmFuZ2UkJDEuZW1wdHkoKTsNCiAgICAgIGlmIChjb2xsYXBzZWQgfHwgY20ub3B0aW9ucy5zaG93Q3Vyc29yV2hlblNlbGVjdGluZykNCiAgICAgICAgeyBkcmF3U2VsZWN0aW9uQ3Vyc29yKGNtLCByYW5nZSQkMS5oZWFkLCBjdXJGcmFnbWVudCk7IH0NCiAgICAgIGlmICghY29sbGFwc2VkKQ0KICAgICAgICB7IGRyYXdTZWxlY3Rpb25SYW5nZShjbSwgcmFuZ2UkJDEsIHNlbEZyYWdtZW50KTsgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0DQogIH0NCg0KICAvLyBEcmF3cyBhIGN1cnNvciBmb3IgdGhlIGdpdmVuIHJhbmdlDQogIGZ1bmN0aW9uIGRyYXdTZWxlY3Rpb25DdXJzb3IoY20sIGhlYWQsIG91dHB1dCkgew0KICAgIHZhciBwb3MgPSBjdXJzb3JDb29yZHMoY20sIGhlYWQsICJkaXYiLCBudWxsLCBudWxsLCAhY20ub3B0aW9ucy5zaW5nbGVDdXJzb3JIZWlnaHRQZXJMaW5lKTsNCg0KICAgIHZhciBjdXJzb3IgPSBvdXRwdXQuYXBwZW5kQ2hpbGQoZWx0KCJkaXYiLCAiXHUwMGEwIiwgIkNvZGVNaXJyb3ItY3Vyc29yIikpOw0KICAgIGN1cnNvci5zdHlsZS5sZWZ0ID0gcG9zLmxlZnQgKyAicHgiOw0KICAgIGN1cnNvci5zdHlsZS50b3AgPSBwb3MudG9wICsgInB4IjsNCiAgICBjdXJzb3Iuc3R5bGUuaGVpZ2h0ID0gTWF0aC5tYXgoMCwgcG9zLmJvdHRvbSAtIHBvcy50b3ApICogY20ub3B0aW9ucy5jdXJzb3JIZWlnaHQgKyAicHgiOw0KDQogICAgaWYgKHBvcy5vdGhlcikgew0KICAgICAgLy8gU2Vjb25kYXJ5IGN1cnNvciwgc2hvd24gd2hlbiBvbiBhICdqdW1wJyBpbiBiaS1kaXJlY3Rpb25hbCB0ZXh0DQogICAgICB2YXIgb3RoZXJDdXJzb3IgPSBvdXRwdXQuYXBwZW5kQ2hpbGQoZWx0KCJkaXYiLCAiXHUwMGEwIiwgIkNvZGVNaXJyb3ItY3Vyc29yIENvZGVNaXJyb3Itc2Vjb25kYXJ5Y3Vyc29yIikpOw0KICAgICAgb3RoZXJDdXJzb3Iuc3R5bGUuZGlzcGxheSA9ICIiOw0KICAgICAgb3RoZXJDdXJzb3Iuc3R5bGUubGVmdCA9IHBvcy5vdGhlci5sZWZ0ICsgInB4IjsNCiAgICAgIG90aGVyQ3Vyc29yLnN0eWxlLnRvcCA9IHBvcy5vdGhlci50b3AgKyAicHgiOw0KICAgICAgb3RoZXJDdXJzb3Iuc3R5bGUuaGVpZ2h0ID0gKHBvcy5vdGhlci5ib3R0b20gLSBwb3Mub3RoZXIudG9wKSAqIC44NSArICJweCI7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gY21wQ29vcmRzKGEsIGIpIHsgcmV0dXJuIGEudG9wIC0gYi50b3AgfHwgYS5sZWZ0IC0gYi5sZWZ0IH0NCg0KICAvLyBEcmF3cyB0aGUgZ2l2ZW4gcmFuZ2UgYXMgYSBoaWdobGlnaHRlZCBzZWxlY3Rpb24NCiAgZnVuY3Rpb24gZHJhd1NlbGVjdGlvblJhbmdlKGNtLCByYW5nZSQkMSwgb3V0cHV0KSB7DQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7DQogICAgdmFyIGZyYWdtZW50ID0gZG9jdW1lbnQuY3JlYXRlRG9jdW1lbnRGcmFnbWVudCgpOw0KICAgIHZhciBwYWRkaW5nID0gcGFkZGluZ0goY20uZGlzcGxheSksIGxlZnRTaWRlID0gcGFkZGluZy5sZWZ0Ow0KICAgIHZhciByaWdodFNpZGUgPSBNYXRoLm1heChkaXNwbGF5LnNpemVyV2lkdGgsIGRpc3BsYXlXaWR0aChjbSkgLSBkaXNwbGF5LnNpemVyLm9mZnNldExlZnQpIC0gcGFkZGluZy5yaWdodDsNCiAgICB2YXIgZG9jTFRSID0gZG9jLmRpcmVjdGlvbiA9PSAibHRyIjsNCg0KICAgIGZ1bmN0aW9uIGFkZChsZWZ0LCB0b3AsIHdpZHRoLCBib3R0b20pIHsNCiAgICAgIGlmICh0b3AgPCAwKSB7IHRvcCA9IDA7IH0NCiAgICAgIHRvcCA9IE1hdGgucm91bmQodG9wKTsNCiAgICAgIGJvdHRvbSA9IE1hdGgucm91bmQoYm90dG9tKTsNCiAgICAgIGZyYWdtZW50LmFwcGVuZENoaWxkKGVsdCgiZGl2IiwgbnVsbCwgIkNvZGVNaXJyb3Itc2VsZWN0ZWQiLCAoInBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogIiArIGxlZnQgKyAicHg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvcDogIiArIHRvcCArICJweDsgd2lkdGg6ICIgKyAod2lkdGggPT0gbnVsbCA/IHJpZ2h0U2lkZSAtIGxlZnQgOiB3aWR0aCkgKyAicHg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodDogIiArIChib3R0b20gLSB0b3ApICsgInB4IikpKTsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkcmF3Rm9yTGluZShsaW5lLCBmcm9tQXJnLCB0b0FyZykgew0KICAgICAgdmFyIGxpbmVPYmogPSBnZXRMaW5lKGRvYywgbGluZSk7DQogICAgICB2YXIgbGluZUxlbiA9IGxpbmVPYmoudGV4dC5sZW5ndGg7DQogICAgICB2YXIgc3RhcnQsIGVuZDsNCiAgICAgIGZ1bmN0aW9uIGNvb3JkcyhjaCwgYmlhcykgew0KICAgICAgICByZXR1cm4gY2hhckNvb3JkcyhjbSwgUG9zKGxpbmUsIGNoKSwgImRpdiIsIGxpbmVPYmosIGJpYXMpDQogICAgICB9DQoNCiAgICAgIGZ1bmN0aW9uIHdyYXBYKHBvcywgZGlyLCBzaWRlKSB7DQogICAgICAgIHZhciBleHRlbnQgPSB3cmFwcGVkTGluZUV4dGVudENoYXIoY20sIGxpbmVPYmosIG51bGwsIHBvcyk7DQogICAgICAgIHZhciBwcm9wID0gKGRpciA9PSAibHRyIikgPT0gKHNpZGUgPT0gImFmdGVyIikgPyAibGVmdCIgOiAicmlnaHQiOw0KICAgICAgICB2YXIgY2ggPSBzaWRlID09ICJhZnRlciIgPyBleHRlbnQuYmVnaW4gOiBleHRlbnQuZW5kIC0gKC9ccy8udGVzdChsaW5lT2JqLnRleHQuY2hhckF0KGV4dGVudC5lbmQgLSAxKSkgPyAyIDogMSk7DQogICAgICAgIHJldHVybiBjb29yZHMoY2gsIHByb3ApW3Byb3BdDQogICAgICB9DQoNCiAgICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmVPYmosIGRvYy5kaXJlY3Rpb24pOw0KICAgICAgaXRlcmF0ZUJpZGlTZWN0aW9ucyhvcmRlciwgZnJvbUFyZyB8fCAwLCB0b0FyZyA9PSBudWxsID8gbGluZUxlbiA6IHRvQXJnLCBmdW5jdGlvbiAoZnJvbSwgdG8sIGRpciwgaSkgew0KICAgICAgICB2YXIgbHRyID0gZGlyID09ICJsdHIiOw0KICAgICAgICB2YXIgZnJvbVBvcyA9IGNvb3Jkcyhmcm9tLCBsdHIgPyAibGVmdCIgOiAicmlnaHQiKTsNCiAgICAgICAgdmFyIHRvUG9zID0gY29vcmRzKHRvIC0gMSwgbHRyID8gInJpZ2h0IiA6ICJsZWZ0Iik7DQoNCiAgICAgICAgdmFyIG9wZW5TdGFydCA9IGZyb21BcmcgPT0gbnVsbCAmJiBmcm9tID09IDAsIG9wZW5FbmQgPSB0b0FyZyA9PSBudWxsICYmIHRvID09IGxpbmVMZW47DQogICAgICAgIHZhciBmaXJzdCA9IGkgPT0gMCwgbGFzdCA9ICFvcmRlciB8fCBpID09IG9yZGVyLmxlbmd0aCAtIDE7DQogICAgICAgIGlmICh0b1Bvcy50b3AgLSBmcm9tUG9zLnRvcCA8PSAzKSB7IC8vIFNpbmdsZSBsaW5lDQogICAgICAgICAgdmFyIG9wZW5MZWZ0ID0gKGRvY0xUUiA/IG9wZW5TdGFydCA6IG9wZW5FbmQpICYmIGZpcnN0Ow0KICAgICAgICAgIHZhciBvcGVuUmlnaHQgPSAoZG9jTFRSID8gb3BlbkVuZCA6IG9wZW5TdGFydCkgJiYgbGFzdDsNCiAgICAgICAgICB2YXIgbGVmdCA9IG9wZW5MZWZ0ID8gbGVmdFNpZGUgOiAobHRyID8gZnJvbVBvcyA6IHRvUG9zKS5sZWZ0Ow0KICAgICAgICAgIHZhciByaWdodCA9IG9wZW5SaWdodCA/IHJpZ2h0U2lkZSA6IChsdHIgPyB0b1BvcyA6IGZyb21Qb3MpLnJpZ2h0Ow0KICAgICAgICAgIGFkZChsZWZ0LCBmcm9tUG9zLnRvcCwgcmlnaHQgLSBsZWZ0LCBmcm9tUG9zLmJvdHRvbSk7DQogICAgICAgIH0gZWxzZSB7IC8vIE11bHRpcGxlIGxpbmVzDQogICAgICAgICAgdmFyIHRvcExlZnQsIHRvcFJpZ2h0LCBib3RMZWZ0LCBib3RSaWdodDsNCiAgICAgICAgICBpZiAobHRyKSB7DQogICAgICAgICAgICB0b3BMZWZ0ID0gZG9jTFRSICYmIG9wZW5TdGFydCAmJiBmaXJzdCA/IGxlZnRTaWRlIDogZnJvbVBvcy5sZWZ0Ow0KICAgICAgICAgICAgdG9wUmlnaHQgPSBkb2NMVFIgPyByaWdodFNpZGUgOiB3cmFwWChmcm9tLCBkaXIsICJiZWZvcmUiKTsNCiAgICAgICAgICAgIGJvdExlZnQgPSBkb2NMVFIgPyBsZWZ0U2lkZSA6IHdyYXBYKHRvLCBkaXIsICJhZnRlciIpOw0KICAgICAgICAgICAgYm90UmlnaHQgPSBkb2NMVFIgJiYgb3BlbkVuZCAmJiBsYXN0ID8gcmlnaHRTaWRlIDogdG9Qb3MucmlnaHQ7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRvcExlZnQgPSAhZG9jTFRSID8gbGVmdFNpZGUgOiB3cmFwWChmcm9tLCBkaXIsICJiZWZvcmUiKTsNCiAgICAgICAgICAgIHRvcFJpZ2h0ID0gIWRvY0xUUiAmJiBvcGVuU3RhcnQgJiYgZmlyc3QgPyByaWdodFNpZGUgOiBmcm9tUG9zLnJpZ2h0Ow0KICAgICAgICAgICAgYm90TGVmdCA9ICFkb2NMVFIgJiYgb3BlbkVuZCAmJiBsYXN0ID8gbGVmdFNpZGUgOiB0b1Bvcy5sZWZ0Ow0KICAgICAgICAgICAgYm90UmlnaHQgPSAhZG9jTFRSID8gcmlnaHRTaWRlIDogd3JhcFgodG8sIGRpciwgImFmdGVyIik7DQogICAgICAgICAgfQ0KICAgICAgICAgIGFkZCh0b3BMZWZ0LCBmcm9tUG9zLnRvcCwgdG9wUmlnaHQgLSB0b3BMZWZ0LCBmcm9tUG9zLmJvdHRvbSk7DQogICAgICAgICAgaWYgKGZyb21Qb3MuYm90dG9tIDwgdG9Qb3MudG9wKSB7IGFkZChsZWZ0U2lkZSwgZnJvbVBvcy5ib3R0b20sIG51bGwsIHRvUG9zLnRvcCk7IH0NCiAgICAgICAgICBhZGQoYm90TGVmdCwgdG9Qb3MudG9wLCBib3RSaWdodCAtIGJvdExlZnQsIHRvUG9zLmJvdHRvbSk7DQogICAgICAgIH0NCg0KICAgICAgICBpZiAoIXN0YXJ0IHx8IGNtcENvb3Jkcyhmcm9tUG9zLCBzdGFydCkgPCAwKSB7IHN0YXJ0ID0gZnJvbVBvczsgfQ0KICAgICAgICBpZiAoY21wQ29vcmRzKHRvUG9zLCBzdGFydCkgPCAwKSB7IHN0YXJ0ID0gdG9Qb3M7IH0NCiAgICAgICAgaWYgKCFlbmQgfHwgY21wQ29vcmRzKGZyb21Qb3MsIGVuZCkgPCAwKSB7IGVuZCA9IGZyb21Qb3M7IH0NCiAgICAgICAgaWYgKGNtcENvb3Jkcyh0b1BvcywgZW5kKSA8IDApIHsgZW5kID0gdG9Qb3M7IH0NCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIHtzdGFydDogc3RhcnQsIGVuZDogZW5kfQ0KICAgIH0NCg0KICAgIHZhciBzRnJvbSA9IHJhbmdlJCQxLmZyb20oKSwgc1RvID0gcmFuZ2UkJDEudG8oKTsNCiAgICBpZiAoc0Zyb20ubGluZSA9PSBzVG8ubGluZSkgew0KICAgICAgZHJhd0ZvckxpbmUoc0Zyb20ubGluZSwgc0Zyb20uY2gsIHNUby5jaCk7DQogICAgfSBlbHNlIHsNCiAgICAgIHZhciBmcm9tTGluZSA9IGdldExpbmUoZG9jLCBzRnJvbS5saW5lKSwgdG9MaW5lID0gZ2V0TGluZShkb2MsIHNUby5saW5lKTsNCiAgICAgIHZhciBzaW5nbGVWTGluZSA9IHZpc3VhbExpbmUoZnJvbUxpbmUpID09IHZpc3VhbExpbmUodG9MaW5lKTsNCiAgICAgIHZhciBsZWZ0RW5kID0gZHJhd0ZvckxpbmUoc0Zyb20ubGluZSwgc0Zyb20uY2gsIHNpbmdsZVZMaW5lID8gZnJvbUxpbmUudGV4dC5sZW5ndGggKyAxIDogbnVsbCkuZW5kOw0KICAgICAgdmFyIHJpZ2h0U3RhcnQgPSBkcmF3Rm9yTGluZShzVG8ubGluZSwgc2luZ2xlVkxpbmUgPyAwIDogbnVsbCwgc1RvLmNoKS5zdGFydDsNCiAgICAgIGlmIChzaW5nbGVWTGluZSkgew0KICAgICAgICBpZiAobGVmdEVuZC50b3AgPCByaWdodFN0YXJ0LnRvcCAtIDIpIHsNCiAgICAgICAgICBhZGQobGVmdEVuZC5yaWdodCwgbGVmdEVuZC50b3AsIG51bGwsIGxlZnRFbmQuYm90dG9tKTsNCiAgICAgICAgICBhZGQobGVmdFNpZGUsIHJpZ2h0U3RhcnQudG9wLCByaWdodFN0YXJ0LmxlZnQsIHJpZ2h0U3RhcnQuYm90dG9tKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBhZGQobGVmdEVuZC5yaWdodCwgbGVmdEVuZC50b3AsIHJpZ2h0U3RhcnQubGVmdCAtIGxlZnRFbmQucmlnaHQsIGxlZnRFbmQuYm90dG9tKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGxlZnRFbmQuYm90dG9tIDwgcmlnaHRTdGFydC50b3ApDQogICAgICAgIHsgYWRkKGxlZnRTaWRlLCBsZWZ0RW5kLmJvdHRvbSwgbnVsbCwgcmlnaHRTdGFydC50b3ApOyB9DQogICAgfQ0KDQogICAgb3V0cHV0LmFwcGVuZENoaWxkKGZyYWdtZW50KTsNCiAgfQ0KDQogIC8vIEN1cnNvci1ibGlua2luZw0KICBmdW5jdGlvbiByZXN0YXJ0QmxpbmsoY20pIHsNCiAgICBpZiAoIWNtLnN0YXRlLmZvY3VzZWQpIHsgcmV0dXJuIH0NCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7DQogICAgY2xlYXJJbnRlcnZhbChkaXNwbGF5LmJsaW5rZXIpOw0KICAgIHZhciBvbiA9IHRydWU7DQogICAgZGlzcGxheS5jdXJzb3JEaXYuc3R5bGUudmlzaWJpbGl0eSA9ICIiOw0KICAgIGlmIChjbS5vcHRpb25zLmN1cnNvckJsaW5rUmF0ZSA+IDApDQogICAgICB7IGRpc3BsYXkuYmxpbmtlciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRpc3BsYXkuY3Vyc29yRGl2LnN0eWxlLnZpc2liaWxpdHkgPSAob24gPSAhb24pID8gIiIgOiAiaGlkZGVuIjsgfSwNCiAgICAgICAgY20ub3B0aW9ucy5jdXJzb3JCbGlua1JhdGUpOyB9DQogICAgZWxzZSBpZiAoY20ub3B0aW9ucy5jdXJzb3JCbGlua1JhdGUgPCAwKQ0KICAgICAgeyBkaXNwbGF5LmN1cnNvckRpdi5zdHlsZS52aXNpYmlsaXR5ID0gImhpZGRlbiI7IH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGVuc3VyZUZvY3VzKGNtKSB7DQogICAgaWYgKCFjbS5zdGF0ZS5mb2N1c2VkKSB7IGNtLmRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgb25Gb2N1cyhjbSk7IH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGRlbGF5Qmx1ckV2ZW50KGNtKSB7DQogICAgY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQgPSB0cnVlOw0KICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyBpZiAoY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQpIHsNCiAgICAgIGNtLnN0YXRlLmRlbGF5aW5nQmx1ckV2ZW50ID0gZmFsc2U7DQogICAgICBvbkJsdXIoY20pOw0KICAgIH0gfSwgMTAwKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG9uRm9jdXMoY20sIGUpIHsNCiAgICBpZiAoY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQpIHsgY20uc3RhdGUuZGVsYXlpbmdCbHVyRXZlbnQgPSBmYWxzZTsgfQ0KDQogICAgaWYgKGNtLm9wdGlvbnMucmVhZE9ubHkgPT0gIm5vY3Vyc29yIikgeyByZXR1cm4gfQ0KICAgIGlmICghY20uc3RhdGUuZm9jdXNlZCkgew0KICAgICAgc2lnbmFsKGNtLCAiZm9jdXMiLCBjbSwgZSk7DQogICAgICBjbS5zdGF0ZS5mb2N1c2VkID0gdHJ1ZTsNCiAgICAgIGFkZENsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgIkNvZGVNaXJyb3ItZm9jdXNlZCIpOw0KICAgICAgLy8gVGhpcyB0ZXN0IHByZXZlbnRzIHRoaXMgZnJvbSBmaXJpbmcgd2hlbiBhIGNvbnRleHQNCiAgICAgIC8vIG1lbnUgaXMgY2xvc2VkIChzaW5jZSB0aGUgaW5wdXQgcmVzZXQgd291bGQga2lsbCB0aGUNCiAgICAgIC8vIHNlbGVjdC1hbGwgZGV0ZWN0aW9uIGhhY2spDQogICAgICBpZiAoIWNtLmN1ck9wICYmIGNtLmRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgIT0gY20uZG9jLnNlbCkgew0KICAgICAgICBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KCk7DQogICAgICAgIGlmICh3ZWJraXQpIHsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBjbS5kaXNwbGF5LmlucHV0LnJlc2V0KHRydWUpOyB9LCAyMCk7IH0gLy8gSXNzdWUgIzE3MzANCiAgICAgIH0NCiAgICAgIGNtLmRpc3BsYXkuaW5wdXQucmVjZWl2ZWRGb2N1cygpOw0KICAgIH0NCiAgICByZXN0YXJ0QmxpbmsoY20pOw0KICB9DQogIGZ1bmN0aW9uIG9uQmx1cihjbSwgZSkgew0KICAgIGlmIChjbS5zdGF0ZS5kZWxheWluZ0JsdXJFdmVudCkgeyByZXR1cm4gfQ0KDQogICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHsNCiAgICAgIHNpZ25hbChjbSwgImJsdXIiLCBjbSwgZSk7DQogICAgICBjbS5zdGF0ZS5mb2N1c2VkID0gZmFsc2U7DQogICAgICBybUNsYXNzKGNtLmRpc3BsYXkud3JhcHBlciwgIkNvZGVNaXJyb3ItZm9jdXNlZCIpOw0KICAgIH0NCiAgICBjbGVhckludGVydmFsKGNtLmRpc3BsYXkuYmxpbmtlcik7DQogICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGlmICghY20uc3RhdGUuZm9jdXNlZCkgeyBjbS5kaXNwbGF5LnNoaWZ0ID0gZmFsc2U7IH0gfSwgMTUwKTsNCiAgfQ0KDQogIC8vIFJlYWQgdGhlIGFjdHVhbCBoZWlnaHRzIG9mIHRoZSByZW5kZXJlZCBsaW5lcywgYW5kIHVwZGF0ZSB0aGVpcg0KICAvLyBzdG9yZWQgaGVpZ2h0cyB0byBtYXRjaC4NCiAgZnVuY3Rpb24gdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pIHsNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7DQogICAgdmFyIHByZXZCb3R0b20gPSBkaXNwbGF5LmxpbmVEaXYub2Zmc2V0VG9wOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZGlzcGxheS52aWV3Lmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgY3VyID0gZGlzcGxheS52aWV3W2ldLCB3cmFwcGluZyA9IGNtLm9wdGlvbnMubGluZVdyYXBwaW5nOw0KICAgICAgdmFyIGhlaWdodCA9ICh2b2lkIDApLCB3aWR0aCA9IDA7DQogICAgICBpZiAoY3VyLmhpZGRlbikgeyBjb250aW51ZSB9DQogICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIHsNCiAgICAgICAgdmFyIGJvdCA9IGN1ci5ub2RlLm9mZnNldFRvcCArIGN1ci5ub2RlLm9mZnNldEhlaWdodDsNCiAgICAgICAgaGVpZ2h0ID0gYm90IC0gcHJldkJvdHRvbTsNCiAgICAgICAgcHJldkJvdHRvbSA9IGJvdDsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBib3ggPSBjdXIubm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgICAgaGVpZ2h0ID0gYm94LmJvdHRvbSAtIGJveC50b3A7DQogICAgICAgIC8vIENoZWNrIHRoYXQgbGluZXMgZG9uJ3QgZXh0ZW5kIHBhc3QgdGhlIHJpZ2h0IG9mIHRoZSBjdXJyZW50DQogICAgICAgIC8vIGVkaXRvciB3aWR0aA0KICAgICAgICBpZiAoIXdyYXBwaW5nICYmIGN1ci50ZXh0LmZpcnN0Q2hpbGQpDQogICAgICAgICAgeyB3aWR0aCA9IGN1ci50ZXh0LmZpcnN0Q2hpbGQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQgLSBib3gubGVmdCAtIDE7IH0NCiAgICAgIH0NCiAgICAgIHZhciBkaWZmID0gY3VyLmxpbmUuaGVpZ2h0IC0gaGVpZ2h0Ow0KICAgICAgaWYgKGRpZmYgPiAuMDA1IHx8IGRpZmYgPCAtLjAwNSkgew0KICAgICAgICB1cGRhdGVMaW5lSGVpZ2h0KGN1ci5saW5lLCBoZWlnaHQpOw0KICAgICAgICB1cGRhdGVXaWRnZXRIZWlnaHQoY3VyLmxpbmUpOw0KICAgICAgICBpZiAoY3VyLnJlc3QpIHsgZm9yICh2YXIgaiA9IDA7IGogPCBjdXIucmVzdC5sZW5ndGg7IGorKykNCiAgICAgICAgICB7IHVwZGF0ZVdpZGdldEhlaWdodChjdXIucmVzdFtqXSk7IH0gfQ0KICAgICAgfQ0KICAgICAgaWYgKHdpZHRoID4gY20uZGlzcGxheS5zaXplcldpZHRoKSB7DQogICAgICAgIHZhciBjaFdpZHRoID0gTWF0aC5jZWlsKHdpZHRoIC8gY2hhcldpZHRoKGNtLmRpc3BsYXkpKTsNCiAgICAgICAgaWYgKGNoV2lkdGggPiBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGgpIHsNCiAgICAgICAgICBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGggPSBjaFdpZHRoOw0KICAgICAgICAgIGNtLmRpc3BsYXkubWF4TGluZSA9IGN1ci5saW5lOw0KICAgICAgICAgIGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSB0cnVlOw0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLy8gUmVhZCBhbmQgc3RvcmUgdGhlIGhlaWdodCBvZiBsaW5lIHdpZGdldHMgYXNzb2NpYXRlZCB3aXRoIHRoZQ0KICAvLyBnaXZlbiBsaW5lLg0KICBmdW5jdGlvbiB1cGRhdGVXaWRnZXRIZWlnaHQobGluZSkgew0KICAgIGlmIChsaW5lLndpZGdldHMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLndpZGdldHMubGVuZ3RoOyArK2kpIHsNCiAgICAgIHZhciB3ID0gbGluZS53aWRnZXRzW2ldLCBwYXJlbnQgPSB3Lm5vZGUucGFyZW50Tm9kZTsNCiAgICAgIGlmIChwYXJlbnQpIHsgdy5oZWlnaHQgPSBwYXJlbnQub2Zmc2V0SGVpZ2h0OyB9DQogICAgfSB9DQogIH0NCg0KICAvLyBDb21wdXRlIHRoZSBsaW5lcyB0aGF0IGFyZSB2aXNpYmxlIGluIGEgZ2l2ZW4gdmlld3BvcnQgKGRlZmF1bHRzDQogIC8vIHRoZSB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24pLiB2aWV3cG9ydCBtYXkgY29udGFpbiB0b3AsDQogIC8vIGhlaWdodCwgYW5kIGVuc3VyZSAoc2VlIG9wLnNjcm9sbFRvUG9zKSBwcm9wZXJ0aWVzLg0KICBmdW5jdGlvbiB2aXNpYmxlTGluZXMoZGlzcGxheSwgZG9jLCB2aWV3cG9ydCkgew0KICAgIHZhciB0b3AgPSB2aWV3cG9ydCAmJiB2aWV3cG9ydC50b3AgIT0gbnVsbCA/IE1hdGgubWF4KDAsIHZpZXdwb3J0LnRvcCkgOiBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcDsNCiAgICB0b3AgPSBNYXRoLmZsb29yKHRvcCAtIHBhZGRpbmdUb3AoZGlzcGxheSkpOw0KICAgIHZhciBib3R0b20gPSB2aWV3cG9ydCAmJiB2aWV3cG9ydC5ib3R0b20gIT0gbnVsbCA/IHZpZXdwb3J0LmJvdHRvbSA6IHRvcCArIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7DQoNCiAgICB2YXIgZnJvbSA9IGxpbmVBdEhlaWdodChkb2MsIHRvcCksIHRvID0gbGluZUF0SGVpZ2h0KGRvYywgYm90dG9tKTsNCiAgICAvLyBFbnN1cmUgaXMgYSB7ZnJvbToge2xpbmUsIGNofSwgdG86IHtsaW5lLCBjaH19IG9iamVjdCwgYW5kDQogICAgLy8gZm9yY2VzIHRob3NlIGxpbmVzIGludG8gdGhlIHZpZXdwb3J0IChpZiBwb3NzaWJsZSkuDQogICAgaWYgKHZpZXdwb3J0ICYmIHZpZXdwb3J0LmVuc3VyZSkgew0KICAgICAgdmFyIGVuc3VyZUZyb20gPSB2aWV3cG9ydC5lbnN1cmUuZnJvbS5saW5lLCBlbnN1cmVUbyA9IHZpZXdwb3J0LmVuc3VyZS50by5saW5lOw0KICAgICAgaWYgKGVuc3VyZUZyb20gPCBmcm9tKSB7DQogICAgICAgIGZyb20gPSBlbnN1cmVGcm9tOw0KICAgICAgICB0byA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlRnJvbSkpICsgZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCk7DQogICAgICB9IGVsc2UgaWYgKE1hdGgubWluKGVuc3VyZVRvLCBkb2MubGFzdExpbmUoKSkgPj0gdG8pIHsNCiAgICAgICAgZnJvbSA9IGxpbmVBdEhlaWdodChkb2MsIGhlaWdodEF0TGluZShnZXRMaW5lKGRvYywgZW5zdXJlVG8pKSAtIGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQpOw0KICAgICAgICB0byA9IGVuc3VyZVRvOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4ge2Zyb206IGZyb20sIHRvOiBNYXRoLm1heCh0bywgZnJvbSArIDEpfQ0KICB9DQoNCiAgLy8gU0NST0xMSU5HIFRISU5HUyBJTlRPIFZJRVcNCg0KICAvLyBJZiBhbiBlZGl0b3Igc2l0cyBvbiB0aGUgdG9wIG9yIGJvdHRvbSBvZiB0aGUgd2luZG93LCBwYXJ0aWFsbHkNCiAgLy8gc2Nyb2xsZWQgb3V0IG9mIHZpZXcsIHRoaXMgZW5zdXJlcyB0aGF0IHRoZSBjdXJzb3IgaXMgdmlzaWJsZS4NCiAgZnVuY3Rpb24gbWF5YmVTY3JvbGxXaW5kb3coY20sIHJlY3QpIHsNCiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sICJzY3JvbGxDdXJzb3JJbnRvVmlldyIpKSB7IHJldHVybiB9DQoNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGJveCA9IGRpc3BsYXkuc2l6ZXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksIGRvU2Nyb2xsID0gbnVsbDsNCiAgICBpZiAocmVjdC50b3AgKyBib3gudG9wIDwgMCkgeyBkb1Njcm9sbCA9IHRydWU7IH0NCiAgICBlbHNlIGlmIChyZWN0LmJvdHRvbSArIGJveC50b3AgPiAod2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpKSB7IGRvU2Nyb2xsID0gZmFsc2U7IH0NCiAgICBpZiAoZG9TY3JvbGwgIT0gbnVsbCAmJiAhcGhhbnRvbSkgew0KICAgICAgdmFyIHNjcm9sbE5vZGUgPSBlbHQoImRpdiIsICJcdTIwMGIiLCBudWxsLCAoInBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgICB0b3A6ICIgKyAocmVjdC50b3AgLSBkaXNwbGF5LnZpZXdPZmZzZXQgLSBwYWRkaW5nVG9wKGNtLmRpc3BsYXkpKSArICJweDtcbiAgICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6ICIgKyAocmVjdC5ib3R0b20gLSByZWN0LnRvcCArIHNjcm9sbEdhcChjbSkgKyBkaXNwbGF5LmJhckhlaWdodCkgKyAicHg7XG4gICAgICAgICAgICAgICAgICAgICAgICAgbGVmdDogIiArIChyZWN0LmxlZnQpICsgInB4OyB3aWR0aDogIiArIChNYXRoLm1heCgyLCByZWN0LnJpZ2h0IC0gcmVjdC5sZWZ0KSkgKyAicHg7IikpOw0KICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UuYXBwZW5kQ2hpbGQoc2Nyb2xsTm9kZSk7DQogICAgICBzY3JvbGxOb2RlLnNjcm9sbEludG9WaWV3KGRvU2Nyb2xsKTsNCiAgICAgIGNtLmRpc3BsYXkubGluZVNwYWNlLnJlbW92ZUNoaWxkKHNjcm9sbE5vZGUpOw0KICAgIH0NCiAgfQ0KDQogIC8vIFNjcm9sbCBhIGdpdmVuIHBvc2l0aW9uIGludG8gdmlldyAoaW1tZWRpYXRlbHkpLCB2ZXJpZnlpbmcgdGhhdA0KICAvLyBpdCBhY3R1YWxseSBiZWNhbWUgdmlzaWJsZSAoYXMgbGluZSBoZWlnaHRzIGFyZSBhY2N1cmF0ZWx5DQogIC8vIG1lYXN1cmVkLCB0aGUgcG9zaXRpb24gb2Ygc29tZXRoaW5nIG1heSAnZHJpZnQnIGR1cmluZyBkcmF3aW5nKS4NCiAgZnVuY3Rpb24gc2Nyb2xsUG9zSW50b1ZpZXcoY20sIHBvcywgZW5kLCBtYXJnaW4pIHsNCiAgICBpZiAobWFyZ2luID09IG51bGwpIHsgbWFyZ2luID0gMDsgfQ0KICAgIHZhciByZWN0Ow0KICAgIGlmICghY20ub3B0aW9ucy5saW5lV3JhcHBpbmcgJiYgcG9zID09IGVuZCkgew0KICAgICAgLy8gU2V0IHBvcyBhbmQgZW5kIHRvIHRoZSBjdXJzb3IgcG9zaXRpb25zIGFyb3VuZCB0aGUgY2hhcmFjdGVyIHBvcyBzdGlja3MgdG8NCiAgICAgIC8vIElmIHBvcy5zdGlja3kgPT0gImJlZm9yZSIsIHRoYXQgaXMgYXJvdW5kIHBvcy5jaCAtIDEsIG90aGVyd2lzZSBhcm91bmQgcG9zLmNoDQogICAgICAvLyBJZiBwb3MgPT0gUG9zKF8sIDAsICJiZWZvcmUiKSwgcG9zIGFuZCBlbmQgYXJlIHVuY2hhbmdlZA0KICAgICAgcG9zID0gcG9zLmNoID8gUG9zKHBvcy5saW5lLCBwb3Muc3RpY2t5ID09ICJiZWZvcmUiID8gcG9zLmNoIC0gMSA6IHBvcy5jaCwgImFmdGVyIikgOiBwb3M7DQogICAgICBlbmQgPSBwb3Muc3RpY2t5ID09ICJiZWZvcmUiID8gUG9zKHBvcy5saW5lLCBwb3MuY2ggKyAxLCAiYmVmb3JlIikgOiBwb3M7DQogICAgfQ0KICAgIGZvciAodmFyIGxpbWl0ID0gMDsgbGltaXQgPCA1OyBsaW1pdCsrKSB7DQogICAgICB2YXIgY2hhbmdlZCA9IGZhbHNlOw0KICAgICAgdmFyIGNvb3JkcyA9IGN1cnNvckNvb3JkcyhjbSwgcG9zKTsNCiAgICAgIHZhciBlbmRDb29yZHMgPSAhZW5kIHx8IGVuZCA9PSBwb3MgPyBjb29yZHMgOiBjdXJzb3JDb29yZHMoY20sIGVuZCk7DQogICAgICByZWN0ID0ge2xlZnQ6IE1hdGgubWluKGNvb3Jkcy5sZWZ0LCBlbmRDb29yZHMubGVmdCksDQogICAgICAgICAgICAgIHRvcDogTWF0aC5taW4oY29vcmRzLnRvcCwgZW5kQ29vcmRzLnRvcCkgLSBtYXJnaW4sDQogICAgICAgICAgICAgIHJpZ2h0OiBNYXRoLm1heChjb29yZHMubGVmdCwgZW5kQ29vcmRzLmxlZnQpLA0KICAgICAgICAgICAgICBib3R0b206IE1hdGgubWF4KGNvb3Jkcy5ib3R0b20sIGVuZENvb3Jkcy5ib3R0b20pICsgbWFyZ2lufTsNCiAgICAgIHZhciBzY3JvbGxQb3MgPSBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIHJlY3QpOw0KICAgICAgdmFyIHN0YXJ0VG9wID0gY20uZG9jLnNjcm9sbFRvcCwgc3RhcnRMZWZ0ID0gY20uZG9jLnNjcm9sbExlZnQ7DQogICAgICBpZiAoc2Nyb2xsUG9zLnNjcm9sbFRvcCAhPSBudWxsKSB7DQogICAgICAgIHVwZGF0ZVNjcm9sbFRvcChjbSwgc2Nyb2xsUG9zLnNjcm9sbFRvcCk7DQogICAgICAgIGlmIChNYXRoLmFicyhjbS5kb2Muc2Nyb2xsVG9wIC0gc3RhcnRUb3ApID4gMSkgeyBjaGFuZ2VkID0gdHJ1ZTsgfQ0KICAgICAgfQ0KICAgICAgaWYgKHNjcm9sbFBvcy5zY3JvbGxMZWZ0ICE9IG51bGwpIHsNCiAgICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgc2Nyb2xsUG9zLnNjcm9sbExlZnQpOw0KICAgICAgICBpZiAoTWF0aC5hYnMoY20uZG9jLnNjcm9sbExlZnQgLSBzdGFydExlZnQpID4gMSkgeyBjaGFuZ2VkID0gdHJ1ZTsgfQ0KICAgICAgfQ0KICAgICAgaWYgKCFjaGFuZ2VkKSB7IGJyZWFrIH0NCiAgICB9DQogICAgcmV0dXJuIHJlY3QNCiAgfQ0KDQogIC8vIFNjcm9sbCBhIGdpdmVuIHNldCBvZiBjb29yZGluYXRlcyBpbnRvIHZpZXcgKGltbWVkaWF0ZWx5KS4NCiAgZnVuY3Rpb24gc2Nyb2xsSW50b1ZpZXcoY20sIHJlY3QpIHsNCiAgICB2YXIgc2Nyb2xsUG9zID0gY2FsY3VsYXRlU2Nyb2xsUG9zKGNtLCByZWN0KTsNCiAgICBpZiAoc2Nyb2xsUG9zLnNjcm9sbFRvcCAhPSBudWxsKSB7IHVwZGF0ZVNjcm9sbFRvcChjbSwgc2Nyb2xsUG9zLnNjcm9sbFRvcCk7IH0NCiAgICBpZiAoc2Nyb2xsUG9zLnNjcm9sbExlZnQgIT0gbnVsbCkgeyBzZXRTY3JvbGxMZWZ0KGNtLCBzY3JvbGxQb3Muc2Nyb2xsTGVmdCk7IH0NCiAgfQ0KDQogIC8vIENhbGN1bGF0ZSBhIG5ldyBzY3JvbGwgcG9zaXRpb24gbmVlZGVkIHRvIHNjcm9sbCB0aGUgZ2l2ZW4NCiAgLy8gcmVjdGFuZ2xlIGludG8gdmlldy4gUmV0dXJucyBhbiBvYmplY3Qgd2l0aCBzY3JvbGxUb3AgYW5kDQogIC8vIHNjcm9sbExlZnQgcHJvcGVydGllcy4gV2hlbiB0aGVzZSBhcmUgdW5kZWZpbmVkLCB0aGUNCiAgLy8gdmVydGljYWwvaG9yaXpvbnRhbCBwb3NpdGlvbiBkb2VzIG5vdCBuZWVkIHRvIGJlIGFkanVzdGVkLg0KICBmdW5jdGlvbiBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIHJlY3QpIHsNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNuYXBNYXJnaW4gPSB0ZXh0SGVpZ2h0KGNtLmRpc3BsYXkpOw0KICAgIGlmIChyZWN0LnRvcCA8IDApIHsgcmVjdC50b3AgPSAwOyB9DQogICAgdmFyIHNjcmVlbnRvcCA9IGNtLmN1ck9wICYmIGNtLmN1ck9wLnNjcm9sbFRvcCAhPSBudWxsID8gY20uY3VyT3Auc2Nyb2xsVG9wIDogZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3A7DQogICAgdmFyIHNjcmVlbiA9IGRpc3BsYXlIZWlnaHQoY20pLCByZXN1bHQgPSB7fTsNCiAgICBpZiAocmVjdC5ib3R0b20gLSByZWN0LnRvcCA+IHNjcmVlbikgeyByZWN0LmJvdHRvbSA9IHJlY3QudG9wICsgc2NyZWVuOyB9DQogICAgdmFyIGRvY0JvdHRvbSA9IGNtLmRvYy5oZWlnaHQgKyBwYWRkaW5nVmVydChkaXNwbGF5KTsNCiAgICB2YXIgYXRUb3AgPSByZWN0LnRvcCA8IHNuYXBNYXJnaW4sIGF0Qm90dG9tID0gcmVjdC5ib3R0b20gPiBkb2NCb3R0b20gLSBzbmFwTWFyZ2luOw0KICAgIGlmIChyZWN0LnRvcCA8IHNjcmVlbnRvcCkgew0KICAgICAgcmVzdWx0LnNjcm9sbFRvcCA9IGF0VG9wID8gMCA6IHJlY3QudG9wOw0KICAgIH0gZWxzZSBpZiAocmVjdC5ib3R0b20gPiBzY3JlZW50b3AgKyBzY3JlZW4pIHsNCiAgICAgIHZhciBuZXdUb3AgPSBNYXRoLm1pbihyZWN0LnRvcCwgKGF0Qm90dG9tID8gZG9jQm90dG9tIDogcmVjdC5ib3R0b20pIC0gc2NyZWVuKTsNCiAgICAgIGlmIChuZXdUb3AgIT0gc2NyZWVudG9wKSB7IHJlc3VsdC5zY3JvbGxUb3AgPSBuZXdUb3A7IH0NCiAgICB9DQoNCiAgICB2YXIgc2NyZWVubGVmdCA9IGNtLmN1ck9wICYmIGNtLmN1ck9wLnNjcm9sbExlZnQgIT0gbnVsbCA/IGNtLmN1ck9wLnNjcm9sbExlZnQgOiBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQ7DQogICAgdmFyIHNjcmVlbncgPSBkaXNwbGF5V2lkdGgoY20pIC0gKGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBkaXNwbGF5Lmd1dHRlcnMub2Zmc2V0V2lkdGggOiAwKTsNCiAgICB2YXIgdG9vV2lkZSA9IHJlY3QucmlnaHQgLSByZWN0LmxlZnQgPiBzY3JlZW53Ow0KICAgIGlmICh0b29XaWRlKSB7IHJlY3QucmlnaHQgPSByZWN0LmxlZnQgKyBzY3JlZW53OyB9DQogICAgaWYgKHJlY3QubGVmdCA8IDEwKQ0KICAgICAgeyByZXN1bHQuc2Nyb2xsTGVmdCA9IDA7IH0NCiAgICBlbHNlIGlmIChyZWN0LmxlZnQgPCBzY3JlZW5sZWZ0KQ0KICAgICAgeyByZXN1bHQuc2Nyb2xsTGVmdCA9IE1hdGgubWF4KDAsIHJlY3QubGVmdCAtICh0b29XaWRlID8gMCA6IDEwKSk7IH0NCiAgICBlbHNlIGlmIChyZWN0LnJpZ2h0ID4gc2NyZWVudyArIHNjcmVlbmxlZnQgLSAzKQ0KICAgICAgeyByZXN1bHQuc2Nyb2xsTGVmdCA9IHJlY3QucmlnaHQgKyAodG9vV2lkZSA/IDAgOiAxMCkgLSBzY3JlZW53OyB9DQogICAgcmV0dXJuIHJlc3VsdA0KICB9DQoNCiAgLy8gU3RvcmUgYSByZWxhdGl2ZSBhZGp1c3RtZW50IHRvIHRoZSBzY3JvbGwgcG9zaXRpb24gaW4gdGhlIGN1cnJlbnQNCiAgLy8gb3BlcmF0aW9uICh0byBiZSBhcHBsaWVkIHdoZW4gdGhlIG9wZXJhdGlvbiBmaW5pc2hlcykuDQogIGZ1bmN0aW9uIGFkZFRvU2Nyb2xsVG9wKGNtLCB0b3ApIHsNCiAgICBpZiAodG9wID09IG51bGwpIHsgcmV0dXJuIH0NCiAgICByZXNvbHZlU2Nyb2xsVG9Qb3MoY20pOw0KICAgIGNtLmN1ck9wLnNjcm9sbFRvcCA9IChjbS5jdXJPcC5zY3JvbGxUb3AgPT0gbnVsbCA/IGNtLmRvYy5zY3JvbGxUb3AgOiBjbS5jdXJPcC5zY3JvbGxUb3ApICsgdG9wOw0KICB9DQoNCiAgLy8gTWFrZSBzdXJlIHRoYXQgYXQgdGhlIGVuZCBvZiB0aGUgb3BlcmF0aW9uIHRoZSBjdXJyZW50IGN1cnNvciBpcw0KICAvLyBzaG93bi4NCiAgZnVuY3Rpb24gZW5zdXJlQ3Vyc29yVmlzaWJsZShjbSkgew0KICAgIHJlc29sdmVTY3JvbGxUb1BvcyhjbSk7DQogICAgdmFyIGN1ciA9IGNtLmdldEN1cnNvcigpOw0KICAgIGNtLmN1ck9wLnNjcm9sbFRvUG9zID0ge2Zyb206IGN1ciwgdG86IGN1ciwgbWFyZ2luOiBjbS5vcHRpb25zLmN1cnNvclNjcm9sbE1hcmdpbn07DQogIH0NCg0KICBmdW5jdGlvbiBzY3JvbGxUb0Nvb3JkcyhjbSwgeCwgeSkgew0KICAgIGlmICh4ICE9IG51bGwgfHwgeSAhPSBudWxsKSB7IHJlc29sdmVTY3JvbGxUb1BvcyhjbSk7IH0NCiAgICBpZiAoeCAhPSBudWxsKSB7IGNtLmN1ck9wLnNjcm9sbExlZnQgPSB4OyB9DQogICAgaWYgKHkgIT0gbnVsbCkgeyBjbS5jdXJPcC5zY3JvbGxUb3AgPSB5OyB9DQogIH0NCg0KICBmdW5jdGlvbiBzY3JvbGxUb1JhbmdlKGNtLCByYW5nZSQkMSkgew0KICAgIHJlc29sdmVTY3JvbGxUb1BvcyhjbSk7DQogICAgY20uY3VyT3Auc2Nyb2xsVG9Qb3MgPSByYW5nZSQkMTsNCiAgfQ0KDQogIC8vIFdoZW4gYW4gb3BlcmF0aW9uIGhhcyBpdHMgc2Nyb2xsVG9Qb3MgcHJvcGVydHkgc2V0LCBhbmQgYW5vdGhlcg0KICAvLyBzY3JvbGwgYWN0aW9uIGlzIGFwcGxpZWQgYmVmb3JlIHRoZSBlbmQgb2YgdGhlIG9wZXJhdGlvbiwgdGhpcw0KICAvLyAnc2ltdWxhdGVzJyBzY3JvbGxpbmcgdGhhdCBwb3NpdGlvbiBpbnRvIHZpZXcgaW4gYSBjaGVhcCB3YXksIHNvDQogIC8vIHRoYXQgdGhlIGVmZmVjdCBvZiBpbnRlcm1lZGlhdGUgc2Nyb2xsIGNvbW1hbmRzIGlzIG5vdCBpZ25vcmVkLg0KICBmdW5jdGlvbiByZXNvbHZlU2Nyb2xsVG9Qb3MoY20pIHsNCiAgICB2YXIgcmFuZ2UkJDEgPSBjbS5jdXJPcC5zY3JvbGxUb1BvczsNCiAgICBpZiAocmFuZ2UkJDEpIHsNCiAgICAgIGNtLmN1ck9wLnNjcm9sbFRvUG9zID0gbnVsbDsNCiAgICAgIHZhciBmcm9tID0gZXN0aW1hdGVDb29yZHMoY20sIHJhbmdlJCQxLmZyb20pLCB0byA9IGVzdGltYXRlQ29vcmRzKGNtLCByYW5nZSQkMS50byk7DQogICAgICBzY3JvbGxUb0Nvb3Jkc1JhbmdlKGNtLCBmcm9tLCB0bywgcmFuZ2UkJDEubWFyZ2luKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzY3JvbGxUb0Nvb3Jkc1JhbmdlKGNtLCBmcm9tLCB0bywgbWFyZ2luKSB7DQogICAgdmFyIHNQb3MgPSBjYWxjdWxhdGVTY3JvbGxQb3MoY20sIHsNCiAgICAgIGxlZnQ6IE1hdGgubWluKGZyb20ubGVmdCwgdG8ubGVmdCksDQogICAgICB0b3A6IE1hdGgubWluKGZyb20udG9wLCB0by50b3ApIC0gbWFyZ2luLA0KICAgICAgcmlnaHQ6IE1hdGgubWF4KGZyb20ucmlnaHQsIHRvLnJpZ2h0KSwNCiAgICAgIGJvdHRvbTogTWF0aC5tYXgoZnJvbS5ib3R0b20sIHRvLmJvdHRvbSkgKyBtYXJnaW4NCiAgICB9KTsNCiAgICBzY3JvbGxUb0Nvb3JkcyhjbSwgc1Bvcy5zY3JvbGxMZWZ0LCBzUG9zLnNjcm9sbFRvcCk7DQogIH0NCg0KICAvLyBTeW5jIHRoZSBzY3JvbGxhYmxlIGFyZWEgYW5kIHNjcm9sbGJhcnMsIGVuc3VyZSB0aGUgdmlld3BvcnQNCiAgLy8gY292ZXJzIHRoZSB2aXNpYmxlIGFyZWEuDQogIGZ1bmN0aW9uIHVwZGF0ZVNjcm9sbFRvcChjbSwgdmFsKSB7DQogICAgaWYgKE1hdGguYWJzKGNtLmRvYy5zY3JvbGxUb3AgLSB2YWwpIDwgMikgeyByZXR1cm4gfQ0KICAgIGlmICghZ2Vja28pIHsgdXBkYXRlRGlzcGxheVNpbXBsZShjbSwge3RvcDogdmFsfSk7IH0NCiAgICBzZXRTY3JvbGxUb3AoY20sIHZhbCwgdHJ1ZSk7DQogICAgaWYgKGdlY2tvKSB7IHVwZGF0ZURpc3BsYXlTaW1wbGUoY20pOyB9DQogICAgc3RhcnRXb3JrZXIoY20sIDEwMCk7DQogIH0NCg0KICBmdW5jdGlvbiBzZXRTY3JvbGxUb3AoY20sIHZhbCwgZm9yY2VTY3JvbGwpIHsNCiAgICB2YWwgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbEhlaWdodCAtIGNtLmRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50SGVpZ2h0LCB2YWwpKTsNCiAgICBpZiAoY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgPT0gdmFsICYmICFmb3JjZVNjcm9sbCkgeyByZXR1cm4gfQ0KICAgIGNtLmRvYy5zY3JvbGxUb3AgPSB2YWw7DQogICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcCh2YWwpOw0KICAgIGlmIChjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcCAhPSB2YWwpIHsgY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgPSB2YWw7IH0NCiAgfQ0KDQogIC8vIFN5bmMgc2Nyb2xsZXIgYW5kIHNjcm9sbGJhciwgZW5zdXJlIHRoZSBndXR0ZXIgZWxlbWVudHMgYXJlDQogIC8vIGFsaWduZWQuDQogIGZ1bmN0aW9uIHNldFNjcm9sbExlZnQoY20sIHZhbCwgaXNTY3JvbGxlciwgZm9yY2VTY3JvbGwpIHsNCiAgICB2YWwgPSBNYXRoLm1heCgwLCBNYXRoLm1pbih2YWwsIGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsV2lkdGggLSBjbS5kaXNwbGF5LnNjcm9sbGVyLmNsaWVudFdpZHRoKSk7DQogICAgaWYgKChpc1Njcm9sbGVyID8gdmFsID09IGNtLmRvYy5zY3JvbGxMZWZ0IDogTWF0aC5hYnMoY20uZG9jLnNjcm9sbExlZnQgLSB2YWwpIDwgMikgJiYgIWZvcmNlU2Nyb2xsKSB7IHJldHVybiB9DQogICAgY20uZG9jLnNjcm9sbExlZnQgPSB2YWw7DQogICAgYWxpZ25Ib3Jpem9udGFsbHkoY20pOw0KICAgIGlmIChjbS5kaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgIT0gdmFsKSB7IGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsTGVmdCA9IHZhbDsgfQ0KICAgIGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxMZWZ0KHZhbCk7DQogIH0NCg0KICAvLyBTQ1JPTExCQVJTDQoNCiAgLy8gUHJlcGFyZSBET00gcmVhZHMgbmVlZGVkIHRvIHVwZGF0ZSB0aGUgc2Nyb2xsYmFycy4gRG9uZSBpbiBvbmUNCiAgLy8gc2hvdCB0byBtaW5pbWl6ZSB1cGRhdGUvbWVhc3VyZSByb3VuZHRyaXBzLg0KICBmdW5jdGlvbiBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSkgew0KICAgIHZhciBkID0gY20uZGlzcGxheSwgZ3V0dGVyVyA9IGQuZ3V0dGVycy5vZmZzZXRXaWR0aDsNCiAgICB2YXIgZG9jSCA9IE1hdGgucm91bmQoY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGNtLmRpc3BsYXkpKTsNCiAgICByZXR1cm4gew0KICAgICAgY2xpZW50SGVpZ2h0OiBkLnNjcm9sbGVyLmNsaWVudEhlaWdodCwNCiAgICAgIHZpZXdIZWlnaHQ6IGQud3JhcHBlci5jbGllbnRIZWlnaHQsDQogICAgICBzY3JvbGxXaWR0aDogZC5zY3JvbGxlci5zY3JvbGxXaWR0aCwgY2xpZW50V2lkdGg6IGQuc2Nyb2xsZXIuY2xpZW50V2lkdGgsDQogICAgICB2aWV3V2lkdGg6IGQud3JhcHBlci5jbGllbnRXaWR0aCwNCiAgICAgIGJhckxlZnQ6IGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIgPyBndXR0ZXJXIDogMCwNCiAgICAgIGRvY0hlaWdodDogZG9jSCwNCiAgICAgIHNjcm9sbEhlaWdodDogZG9jSCArIHNjcm9sbEdhcChjbSkgKyBkLmJhckhlaWdodCwNCiAgICAgIG5hdGl2ZUJhcldpZHRoOiBkLm5hdGl2ZUJhcldpZHRoLA0KICAgICAgZ3V0dGVyV2lkdGg6IGd1dHRlclcNCiAgICB9DQogIH0NCg0KICB2YXIgTmF0aXZlU2Nyb2xsYmFycyA9IGZ1bmN0aW9uKHBsYWNlLCBzY3JvbGwsIGNtKSB7DQogICAgdGhpcy5jbSA9IGNtOw0KICAgIHZhciB2ZXJ0ID0gdGhpcy52ZXJ0ID0gZWx0KCJkaXYiLCBbZWx0KCJkaXYiLCBudWxsLCBudWxsLCAibWluLXdpZHRoOiAxcHgiKV0sICJDb2RlTWlycm9yLXZzY3JvbGxiYXIiKTsNCiAgICB2YXIgaG9yaXogPSB0aGlzLmhvcml6ID0gZWx0KCJkaXYiLCBbZWx0KCJkaXYiLCBudWxsLCBudWxsLCAiaGVpZ2h0OiAxMDAlOyBtaW4taGVpZ2h0OiAxcHgiKV0sICJDb2RlTWlycm9yLWhzY3JvbGxiYXIiKTsNCiAgICB2ZXJ0LnRhYkluZGV4ID0gaG9yaXoudGFiSW5kZXggPSAtMTsNCiAgICBwbGFjZSh2ZXJ0KTsgcGxhY2UoaG9yaXopOw0KDQogICAgb24odmVydCwgInNjcm9sbCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICh2ZXJ0LmNsaWVudEhlaWdodCkgeyBzY3JvbGwodmVydC5zY3JvbGxUb3AsICJ2ZXJ0aWNhbCIpOyB9DQogICAgfSk7DQogICAgb24oaG9yaXosICJzY3JvbGwiLCBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoaG9yaXouY2xpZW50V2lkdGgpIHsgc2Nyb2xsKGhvcml6LnNjcm9sbExlZnQsICJob3Jpem9udGFsIik7IH0NCiAgICB9KTsNCg0KICAgIHRoaXMuY2hlY2tlZFplcm9XaWR0aCA9IGZhbHNlOw0KICAgIC8vIE5lZWQgdG8gc2V0IGEgbWluaW11bSB3aWR0aCB0byBzZWUgdGhlIHNjcm9sbGJhciBvbiBJRTcgKGJ1dCBtdXN0IG5vdCBzZXQgaXQgb24gSUU4KS4NCiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDgpIHsgdGhpcy5ob3Jpei5zdHlsZS5taW5IZWlnaHQgPSB0aGlzLnZlcnQuc3R5bGUubWluV2lkdGggPSAiMThweCI7IH0NCiAgfTsNCg0KICBOYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAobWVhc3VyZSkgew0KICAgIHZhciBuZWVkc0ggPSBtZWFzdXJlLnNjcm9sbFdpZHRoID4gbWVhc3VyZS5jbGllbnRXaWR0aCArIDE7DQogICAgdmFyIG5lZWRzViA9IG1lYXN1cmUuc2Nyb2xsSGVpZ2h0ID4gbWVhc3VyZS5jbGllbnRIZWlnaHQgKyAxOw0KICAgIHZhciBzV2lkdGggPSBtZWFzdXJlLm5hdGl2ZUJhcldpZHRoOw0KDQogICAgaWYgKG5lZWRzVikgew0KICAgICAgdGhpcy52ZXJ0LnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgICAgdGhpcy52ZXJ0LnN0eWxlLmJvdHRvbSA9IG5lZWRzSCA/IHNXaWR0aCArICJweCIgOiAiMCI7DQogICAgICB2YXIgdG90YWxIZWlnaHQgPSBtZWFzdXJlLnZpZXdIZWlnaHQgLSAobmVlZHNIID8gc1dpZHRoIDogMCk7DQogICAgICAvLyBBIGJ1ZyBpbiBJRTggY2FuIGNhdXNlIHRoaXMgdmFsdWUgdG8gYmUgbmVnYXRpdmUsIHNvIGd1YXJkIGl0Lg0KICAgICAgdGhpcy52ZXJ0LmZpcnN0Q2hpbGQuc3R5bGUuaGVpZ2h0ID0NCiAgICAgICAgTWF0aC5tYXgoMCwgbWVhc3VyZS5zY3JvbGxIZWlnaHQgLSBtZWFzdXJlLmNsaWVudEhlaWdodCArIHRvdGFsSGVpZ2h0KSArICJweCI7DQogICAgfSBlbHNlIHsNCiAgICAgIHRoaXMudmVydC5zdHlsZS5kaXNwbGF5ID0gIiI7DQogICAgICB0aGlzLnZlcnQuZmlyc3RDaGlsZC5zdHlsZS5oZWlnaHQgPSAiMCI7DQogICAgfQ0KDQogICAgaWYgKG5lZWRzSCkgew0KICAgICAgdGhpcy5ob3Jpei5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsNCiAgICAgIHRoaXMuaG9yaXouc3R5bGUucmlnaHQgPSBuZWVkc1YgPyBzV2lkdGggKyAicHgiIDogIjAiOw0KICAgICAgdGhpcy5ob3Jpei5zdHlsZS5sZWZ0ID0gbWVhc3VyZS5iYXJMZWZ0ICsgInB4IjsNCiAgICAgIHZhciB0b3RhbFdpZHRoID0gbWVhc3VyZS52aWV3V2lkdGggLSBtZWFzdXJlLmJhckxlZnQgLSAobmVlZHNWID8gc1dpZHRoIDogMCk7DQogICAgICB0aGlzLmhvcml6LmZpcnN0Q2hpbGQuc3R5bGUud2lkdGggPQ0KICAgICAgICBNYXRoLm1heCgwLCBtZWFzdXJlLnNjcm9sbFdpZHRoIC0gbWVhc3VyZS5jbGllbnRXaWR0aCArIHRvdGFsV2lkdGgpICsgInB4IjsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy5ob3Jpei5zdHlsZS5kaXNwbGF5ID0gIiI7DQogICAgICB0aGlzLmhvcml6LmZpcnN0Q2hpbGQuc3R5bGUud2lkdGggPSAiMCI7DQogICAgfQ0KDQogICAgaWYgKCF0aGlzLmNoZWNrZWRaZXJvV2lkdGggJiYgbWVhc3VyZS5jbGllbnRIZWlnaHQgPiAwKSB7DQogICAgICBpZiAoc1dpZHRoID09IDApIHsgdGhpcy56ZXJvV2lkdGhIYWNrKCk7IH0NCiAgICAgIHRoaXMuY2hlY2tlZFplcm9XaWR0aCA9IHRydWU7DQogICAgfQ0KDQogICAgcmV0dXJuIHtyaWdodDogbmVlZHNWID8gc1dpZHRoIDogMCwgYm90dG9tOiBuZWVkc0ggPyBzV2lkdGggOiAwfQ0KICB9Ow0KDQogIE5hdGl2ZVNjcm9sbGJhcnMucHJvdG90eXBlLnNldFNjcm9sbExlZnQgPSBmdW5jdGlvbiAocG9zKSB7DQogICAgaWYgKHRoaXMuaG9yaXouc2Nyb2xsTGVmdCAhPSBwb3MpIHsgdGhpcy5ob3Jpei5zY3JvbGxMZWZ0ID0gcG9zOyB9DQogICAgaWYgKHRoaXMuZGlzYWJsZUhvcml6KSB7IHRoaXMuZW5hYmxlWmVyb1dpZHRoQmFyKHRoaXMuaG9yaXosIHRoaXMuZGlzYWJsZUhvcml6LCAiaG9yaXoiKTsgfQ0KICB9Ow0KDQogIE5hdGl2ZVNjcm9sbGJhcnMucHJvdG90eXBlLnNldFNjcm9sbFRvcCA9IGZ1bmN0aW9uIChwb3MpIHsNCiAgICBpZiAodGhpcy52ZXJ0LnNjcm9sbFRvcCAhPSBwb3MpIHsgdGhpcy52ZXJ0LnNjcm9sbFRvcCA9IHBvczsgfQ0KICAgIGlmICh0aGlzLmRpc2FibGVWZXJ0KSB7IHRoaXMuZW5hYmxlWmVyb1dpZHRoQmFyKHRoaXMudmVydCwgdGhpcy5kaXNhYmxlVmVydCwgInZlcnQiKTsgfQ0KICB9Ow0KDQogIE5hdGl2ZVNjcm9sbGJhcnMucHJvdG90eXBlLnplcm9XaWR0aEhhY2sgPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIHcgPSBtYWMgJiYgIW1hY19nZU1vdW50YWluTGlvbiA/ICIxMnB4IiA6ICIxOHB4IjsNCiAgICB0aGlzLmhvcml6LnN0eWxlLmhlaWdodCA9IHRoaXMudmVydC5zdHlsZS53aWR0aCA9IHc7DQogICAgdGhpcy5ob3Jpei5zdHlsZS5wb2ludGVyRXZlbnRzID0gdGhpcy52ZXJ0LnN0eWxlLnBvaW50ZXJFdmVudHMgPSAibm9uZSI7DQogICAgdGhpcy5kaXNhYmxlSG9yaXogPSBuZXcgRGVsYXllZDsNCiAgICB0aGlzLmRpc2FibGVWZXJ0ID0gbmV3IERlbGF5ZWQ7DQogIH07DQoNCiAgTmF0aXZlU2Nyb2xsYmFycy5wcm90b3R5cGUuZW5hYmxlWmVyb1dpZHRoQmFyID0gZnVuY3Rpb24gKGJhciwgZGVsYXksIHR5cGUpIHsNCiAgICBiYXIuc3R5bGUucG9pbnRlckV2ZW50cyA9ICJhdXRvIjsNCiAgICBmdW5jdGlvbiBtYXliZURpc2FibGUoKSB7DQogICAgICAvLyBUbyBmaW5kIG91dCB3aGV0aGVyIHRoZSBzY3JvbGxiYXIgaXMgc3RpbGwgdmlzaWJsZSwgd2UNCiAgICAgIC8vIGNoZWNrIHdoZXRoZXIgdGhlIGVsZW1lbnQgdW5kZXIgdGhlIHBpeGVsIGluIHRoZSBib3R0b20NCiAgICAgIC8vIHJpZ2h0IGNvcm5lciBvZiB0aGUgc2Nyb2xsYmFyIGJveCBpcyB0aGUgc2Nyb2xsYmFyIGJveA0KICAgICAgLy8gaXRzZWxmICh3aGVuIHRoZSBiYXIgaXMgc3RpbGwgdmlzaWJsZSkgb3IgaXRzIGZpbGxlciBjaGlsZA0KICAgICAgLy8gKHdoZW4gdGhlIGJhciBpcyBoaWRkZW4pLiBJZiBpdCBpcyBzdGlsbCB2aXNpYmxlLCB3ZSBrZWVwDQogICAgICAvLyBpdCBlbmFibGVkLCBpZiBpdCdzIGhpZGRlbiwgd2UgZGlzYWJsZSBwb2ludGVyIGV2ZW50cy4NCiAgICAgIHZhciBib3ggPSBiYXIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQogICAgICB2YXIgZWx0JCQxID0gdHlwZSA9PSAidmVydCIgPyBkb2N1bWVudC5lbGVtZW50RnJvbVBvaW50KGJveC5yaWdodCAtIDEsIChib3gudG9wICsgYm94LmJvdHRvbSkgLyAyKQ0KICAgICAgICAgIDogZG9jdW1lbnQuZWxlbWVudEZyb21Qb2ludCgoYm94LnJpZ2h0ICsgYm94LmxlZnQpIC8gMiwgYm94LmJvdHRvbSAtIDEpOw0KICAgICAgaWYgKGVsdCQkMSAhPSBiYXIpIHsgYmFyLnN0eWxlLnBvaW50ZXJFdmVudHMgPSAibm9uZSI7IH0NCiAgICAgIGVsc2UgeyBkZWxheS5zZXQoMTAwMCwgbWF5YmVEaXNhYmxlKTsgfQ0KICAgIH0NCiAgICBkZWxheS5zZXQoMTAwMCwgbWF5YmVEaXNhYmxlKTsNCiAgfTsNCg0KICBOYXRpdmVTY3JvbGxiYXJzLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgcGFyZW50ID0gdGhpcy5ob3Jpei5wYXJlbnROb2RlOw0KICAgIHBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLmhvcml6KTsNCiAgICBwYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy52ZXJ0KTsNCiAgfTsNCg0KICB2YXIgTnVsbFNjcm9sbGJhcnMgPSBmdW5jdGlvbiAoKSB7fTsNCg0KICBOdWxsU2Nyb2xsYmFycy5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkgeyByZXR1cm4ge2JvdHRvbTogMCwgcmlnaHQ6IDB9IH07DQogIE51bGxTY3JvbGxiYXJzLnByb3RvdHlwZS5zZXRTY3JvbGxMZWZ0ID0gZnVuY3Rpb24gKCkge307DQogIE51bGxTY3JvbGxiYXJzLnByb3RvdHlwZS5zZXRTY3JvbGxUb3AgPSBmdW5jdGlvbiAoKSB7fTsNCiAgTnVsbFNjcm9sbGJhcnMucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkge307DQoNCiAgZnVuY3Rpb24gdXBkYXRlU2Nyb2xsYmFycyhjbSwgbWVhc3VyZSkgew0KICAgIGlmICghbWVhc3VyZSkgeyBtZWFzdXJlID0gbWVhc3VyZUZvclNjcm9sbGJhcnMoY20pOyB9DQogICAgdmFyIHN0YXJ0V2lkdGggPSBjbS5kaXNwbGF5LmJhcldpZHRoLCBzdGFydEhlaWdodCA9IGNtLmRpc3BsYXkuYmFySGVpZ2h0Ow0KICAgIHVwZGF0ZVNjcm9sbGJhcnNJbm5lcihjbSwgbWVhc3VyZSk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0ICYmIHN0YXJ0V2lkdGggIT0gY20uZGlzcGxheS5iYXJXaWR0aCB8fCBzdGFydEhlaWdodCAhPSBjbS5kaXNwbGF5LmJhckhlaWdodDsgaSsrKSB7DQogICAgICBpZiAoc3RhcnRXaWR0aCAhPSBjbS5kaXNwbGF5LmJhcldpZHRoICYmIGNtLm9wdGlvbnMubGluZVdyYXBwaW5nKQ0KICAgICAgICB7IHVwZGF0ZUhlaWdodHNJblZpZXdwb3J0KGNtKTsgfQ0KICAgICAgdXBkYXRlU2Nyb2xsYmFyc0lubmVyKGNtLCBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSkpOw0KICAgICAgc3RhcnRXaWR0aCA9IGNtLmRpc3BsYXkuYmFyV2lkdGg7IHN0YXJ0SGVpZ2h0ID0gY20uZGlzcGxheS5iYXJIZWlnaHQ7DQogICAgfQ0KICB9DQoNCiAgLy8gUmUtc3luY2hyb25pemUgdGhlIGZha2Ugc2Nyb2xsYmFycyB3aXRoIHRoZSBhY3R1YWwgc2l6ZSBvZiB0aGUNCiAgLy8gY29udGVudC4NCiAgZnVuY3Rpb24gdXBkYXRlU2Nyb2xsYmFyc0lubmVyKGNtLCBtZWFzdXJlKSB7DQogICAgdmFyIGQgPSBjbS5kaXNwbGF5Ow0KICAgIHZhciBzaXplcyA9IGQuc2Nyb2xsYmFycy51cGRhdGUobWVhc3VyZSk7DQoNCiAgICBkLnNpemVyLnN0eWxlLnBhZGRpbmdSaWdodCA9IChkLmJhcldpZHRoID0gc2l6ZXMucmlnaHQpICsgInB4IjsNCiAgICBkLnNpemVyLnN0eWxlLnBhZGRpbmdCb3R0b20gPSAoZC5iYXJIZWlnaHQgPSBzaXplcy5ib3R0b20pICsgInB4IjsNCiAgICBkLmhlaWdodEZvcmNlci5zdHlsZS5ib3JkZXJCb3R0b20gPSBzaXplcy5ib3R0b20gKyAicHggc29saWQgdHJhbnNwYXJlbnQiOw0KDQogICAgaWYgKHNpemVzLnJpZ2h0ICYmIHNpemVzLmJvdHRvbSkgew0KICAgICAgZC5zY3JvbGxiYXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7DQogICAgICBkLnNjcm9sbGJhckZpbGxlci5zdHlsZS5oZWlnaHQgPSBzaXplcy5ib3R0b20gKyAicHgiOw0KICAgICAgZC5zY3JvbGxiYXJGaWxsZXIuc3R5bGUud2lkdGggPSBzaXplcy5yaWdodCArICJweCI7DQogICAgfSBlbHNlIHsgZC5zY3JvbGxiYXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9ICIiOyB9DQogICAgaWYgKHNpemVzLmJvdHRvbSAmJiBjbS5vcHRpb25zLmNvdmVyR3V0dGVyTmV4dFRvU2Nyb2xsYmFyICYmIGNtLm9wdGlvbnMuZml4ZWRHdXR0ZXIpIHsNCiAgICAgIGQuZ3V0dGVyRmlsbGVyLnN0eWxlLmRpc3BsYXkgPSAiYmxvY2siOw0KICAgICAgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuaGVpZ2h0ID0gc2l6ZXMuYm90dG9tICsgInB4IjsNCiAgICAgIGQuZ3V0dGVyRmlsbGVyLnN0eWxlLndpZHRoID0gbWVhc3VyZS5ndXR0ZXJXaWR0aCArICJweCI7DQogICAgfSBlbHNlIHsgZC5ndXR0ZXJGaWxsZXIuc3R5bGUuZGlzcGxheSA9ICIiOyB9DQogIH0NCg0KICB2YXIgc2Nyb2xsYmFyTW9kZWwgPSB7Im5hdGl2ZSI6IE5hdGl2ZVNjcm9sbGJhcnMsICJudWxsIjogTnVsbFNjcm9sbGJhcnN9Ow0KDQogIGZ1bmN0aW9uIGluaXRTY3JvbGxiYXJzKGNtKSB7DQogICAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsYmFycykgew0KICAgICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLmNsZWFyKCk7DQogICAgICBpZiAoY20uZGlzcGxheS5zY3JvbGxiYXJzLmFkZENsYXNzKQ0KICAgICAgICB7IHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpOyB9DQogICAgfQ0KDQogICAgY20uZGlzcGxheS5zY3JvbGxiYXJzID0gbmV3IHNjcm9sbGJhck1vZGVsW2NtLm9wdGlvbnMuc2Nyb2xsYmFyU3R5bGVdKGZ1bmN0aW9uIChub2RlKSB7DQogICAgICBjbS5kaXNwbGF5LndyYXBwZXIuaW5zZXJ0QmVmb3JlKG5vZGUsIGNtLmRpc3BsYXkuc2Nyb2xsYmFyRmlsbGVyKTsNCiAgICAgIC8vIFByZXZlbnQgY2xpY2tzIGluIHRoZSBzY3JvbGxiYXJzIGZyb20ga2lsbGluZyBmb2N1cw0KICAgICAgb24obm9kZSwgIm1vdXNlZG93biIsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHsgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBjbS5kaXNwbGF5LmlucHV0LmZvY3VzKCk7IH0sIDApOyB9DQogICAgICB9KTsNCiAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJjbS1ub3QtY29udGVudCIsICJ0cnVlIik7DQogICAgfSwgZnVuY3Rpb24gKHBvcywgYXhpcykgew0KICAgICAgaWYgKGF4aXMgPT0gImhvcml6b250YWwiKSB7IHNldFNjcm9sbExlZnQoY20sIHBvcyk7IH0NCiAgICAgIGVsc2UgeyB1cGRhdGVTY3JvbGxUb3AoY20sIHBvcyk7IH0NCiAgICB9LCBjbSk7DQogICAgaWYgKGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5hZGRDbGFzcykNCiAgICAgIHsgYWRkQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCBjbS5kaXNwbGF5LnNjcm9sbGJhcnMuYWRkQ2xhc3MpOyB9DQogIH0NCg0KICAvLyBPcGVyYXRpb25zIGFyZSB1c2VkIHRvIHdyYXAgYSBzZXJpZXMgb2YgY2hhbmdlcyB0byB0aGUgZWRpdG9yDQogIC8vIHN0YXRlIGluIHN1Y2ggYSB3YXkgdGhhdCBlYWNoIGNoYW5nZSB3b24ndCBoYXZlIHRvIHVwZGF0ZSB0aGUNCiAgLy8gY3Vyc29yIGFuZCBkaXNwbGF5ICh3aGljaCB3b3VsZCBiZSBhd2t3YXJkLCBzbG93LCBhbmQNCiAgLy8gZXJyb3ItcHJvbmUpLiBJbnN0ZWFkLCBkaXNwbGF5IHVwZGF0ZXMgYXJlIGJhdGNoZWQgYW5kIHRoZW4gYWxsDQogIC8vIGNvbWJpbmVkIGFuZCBleGVjdXRlZCBhdCBvbmNlLg0KDQogIHZhciBuZXh0T3BJZCA9IDA7DQogIC8vIFN0YXJ0IGEgbmV3IG9wZXJhdGlvbi4NCiAgZnVuY3Rpb24gc3RhcnRPcGVyYXRpb24oY20pIHsNCiAgICBjbS5jdXJPcCA9IHsNCiAgICAgIGNtOiBjbSwNCiAgICAgIHZpZXdDaGFuZ2VkOiBmYWxzZSwgICAgICAvLyBGbGFnIHRoYXQgaW5kaWNhdGVzIHRoYXQgbGluZXMgbWlnaHQgbmVlZCB0byBiZSByZWRyYXduDQogICAgICBzdGFydEhlaWdodDogY20uZG9jLmhlaWdodCwgLy8gVXNlZCB0byBkZXRlY3QgbmVlZCB0byB1cGRhdGUgc2Nyb2xsYmFyDQogICAgICBmb3JjZVVwZGF0ZTogZmFsc2UsICAgICAgLy8gVXNlZCB0byBmb3JjZSBhIHJlZHJhdw0KICAgICAgdXBkYXRlSW5wdXQ6IDAsICAgICAgIC8vIFdoZXRoZXIgdG8gcmVzZXQgdGhlIGlucHV0IHRleHRhcmVhDQogICAgICB0eXBpbmc6IGZhbHNlLCAgICAgICAgICAgLy8gV2hldGhlciB0aGlzIHJlc2V0IHNob3VsZCBiZSBjYXJlZnVsIHRvIGxlYXZlIGV4aXN0aW5nIHRleHQgKGZvciBjb21wb3NpdGluZykNCiAgICAgIGNoYW5nZU9ianM6IG51bGwsICAgICAgICAvLyBBY2N1bXVsYXRlZCBjaGFuZ2VzLCBmb3IgZmlyaW5nIGNoYW5nZSBldmVudHMNCiAgICAgIGN1cnNvckFjdGl2aXR5SGFuZGxlcnM6IG51bGwsIC8vIFNldCBvZiBoYW5kbGVycyB0byBmaXJlIGN1cnNvckFjdGl2aXR5IG9uDQogICAgICBjdXJzb3JBY3Rpdml0eUNhbGxlZDogMCwgLy8gVHJhY2tzIHdoaWNoIGN1cnNvckFjdGl2aXR5IGhhbmRsZXJzIGhhdmUgYmVlbiBjYWxsZWQgYWxyZWFkeQ0KICAgICAgc2VsZWN0aW9uQ2hhbmdlZDogZmFsc2UsIC8vIFdoZXRoZXIgdGhlIHNlbGVjdGlvbiBuZWVkcyB0byBiZSByZWRyYXduDQogICAgICB1cGRhdGVNYXhMaW5lOiBmYWxzZSwgICAgLy8gU2V0IHdoZW4gdGhlIHdpZGVzdCBsaW5lIG5lZWRzIHRvIGJlIGRldGVybWluZWQgYW5ldw0KICAgICAgc2Nyb2xsTGVmdDogbnVsbCwgc2Nyb2xsVG9wOiBudWxsLCAvLyBJbnRlcm1lZGlhdGUgc2Nyb2xsIHBvc2l0aW9uLCBub3QgcHVzaGVkIHRvIERPTSB5ZXQNCiAgICAgIHNjcm9sbFRvUG9zOiBudWxsLCAgICAgICAvLyBVc2VkIHRvIHNjcm9sbCB0byBhIHNwZWNpZmljIHBvc2l0aW9uDQogICAgICBmb2N1czogZmFsc2UsDQogICAgICBpZDogKytuZXh0T3BJZCAgICAgICAgICAgLy8gVW5pcXVlIElEDQogICAgfTsNCiAgICBwdXNoT3BlcmF0aW9uKGNtLmN1ck9wKTsNCiAgfQ0KDQogIC8vIEZpbmlzaCBhbiBvcGVyYXRpb24sIHVwZGF0aW5nIHRoZSBkaXNwbGF5IGFuZCBzaWduYWxsaW5nIGRlbGF5ZWQgZXZlbnRzDQogIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbihjbSkgew0KICAgIHZhciBvcCA9IGNtLmN1ck9wOw0KICAgIGlmIChvcCkgeyBmaW5pc2hPcGVyYXRpb24ob3AsIGZ1bmN0aW9uIChncm91cCkgew0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBncm91cC5vcHMubGVuZ3RoOyBpKyspDQogICAgICAgIHsgZ3JvdXAub3BzW2ldLmNtLmN1ck9wID0gbnVsbDsgfQ0KICAgICAgZW5kT3BlcmF0aW9ucyhncm91cCk7DQogICAgfSk7IH0NCiAgfQ0KDQogIC8vIFRoZSBET00gdXBkYXRlcyBkb25lIHdoZW4gYW4gb3BlcmF0aW9uIGZpbmlzaGVzIGFyZSBiYXRjaGVkIHNvDQogIC8vIHRoYXQgdGhlIG1pbmltdW0gbnVtYmVyIG9mIHJlbGF5b3V0cyBhcmUgcmVxdWlyZWQuDQogIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbnMoZ3JvdXApIHsNCiAgICB2YXIgb3BzID0gZ3JvdXAub3BzOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3BzLmxlbmd0aDsgaSsrKSAvLyBSZWFkIERPTQ0KICAgICAgeyBlbmRPcGVyYXRpb25fUjEob3BzW2ldKTsgfQ0KICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IG9wcy5sZW5ndGg7IGkkMSsrKSAvLyBXcml0ZSBET00gKG1heWJlKQ0KICAgICAgeyBlbmRPcGVyYXRpb25fVzEob3BzW2kkMV0pOyB9DQogICAgZm9yICh2YXIgaSQyID0gMDsgaSQyIDwgb3BzLmxlbmd0aDsgaSQyKyspIC8vIFJlYWQgRE9NDQogICAgICB7IGVuZE9wZXJhdGlvbl9SMihvcHNbaSQyXSk7IH0NCiAgICBmb3IgKHZhciBpJDMgPSAwOyBpJDMgPCBvcHMubGVuZ3RoOyBpJDMrKykgLy8gV3JpdGUgRE9NIChtYXliZSkNCiAgICAgIHsgZW5kT3BlcmF0aW9uX1cyKG9wc1tpJDNdKTsgfQ0KICAgIGZvciAodmFyIGkkNCA9IDA7IGkkNCA8IG9wcy5sZW5ndGg7IGkkNCsrKSAvLyBSZWFkIERPTQ0KICAgICAgeyBlbmRPcGVyYXRpb25fZmluaXNoKG9wc1tpJDRdKTsgfQ0KICB9DQoNCiAgZnVuY3Rpb24gZW5kT3BlcmF0aW9uX1IxKG9wKSB7DQogICAgdmFyIGNtID0gb3AuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5Ow0KICAgIG1heWJlQ2xpcFNjcm9sbGJhcnMoY20pOw0KICAgIGlmIChvcC51cGRhdGVNYXhMaW5lKSB7IGZpbmRNYXhMaW5lKGNtKTsgfQ0KDQogICAgb3AubXVzdFVwZGF0ZSA9IG9wLnZpZXdDaGFuZ2VkIHx8IG9wLmZvcmNlVXBkYXRlIHx8IG9wLnNjcm9sbFRvcCAhPSBudWxsIHx8DQogICAgICBvcC5zY3JvbGxUb1BvcyAmJiAob3Auc2Nyb2xsVG9Qb3MuZnJvbS5saW5lIDwgZGlzcGxheS52aWV3RnJvbSB8fA0KICAgICAgICAgICAgICAgICAgICAgICAgIG9wLnNjcm9sbFRvUG9zLnRvLmxpbmUgPj0gZGlzcGxheS52aWV3VG8pIHx8DQogICAgICBkaXNwbGF5Lm1heExpbmVDaGFuZ2VkICYmIGNtLm9wdGlvbnMubGluZVdyYXBwaW5nOw0KICAgIG9wLnVwZGF0ZSA9IG9wLm11c3RVcGRhdGUgJiYNCiAgICAgIG5ldyBEaXNwbGF5VXBkYXRlKGNtLCBvcC5tdXN0VXBkYXRlICYmIHt0b3A6IG9wLnNjcm9sbFRvcCwgZW5zdXJlOiBvcC5zY3JvbGxUb1Bvc30sIG9wLmZvcmNlVXBkYXRlKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVuZE9wZXJhdGlvbl9XMShvcCkgew0KICAgIG9wLnVwZGF0ZWREaXNwbGF5ID0gb3AubXVzdFVwZGF0ZSAmJiB1cGRhdGVEaXNwbGF5SWZOZWVkZWQob3AuY20sIG9wLnVwZGF0ZSk7DQogIH0NCg0KICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fUjIob3ApIHsNCiAgICB2YXIgY20gPSBvcC5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7DQogICAgaWYgKG9wLnVwZGF0ZWREaXNwbGF5KSB7IHVwZGF0ZUhlaWdodHNJblZpZXdwb3J0KGNtKTsgfQ0KDQogICAgb3AuYmFyTWVhc3VyZSA9IG1lYXN1cmVGb3JTY3JvbGxiYXJzKGNtKTsNCg0KICAgIC8vIElmIHRoZSBtYXggbGluZSBjaGFuZ2VkIHNpbmNlIGl0IHdhcyBsYXN0IG1lYXN1cmVkLCBtZWFzdXJlIGl0LA0KICAgIC8vIGFuZCBlbnN1cmUgdGhlIGRvY3VtZW50J3Mgd2lkdGggbWF0Y2hlcyBpdC4NCiAgICAvLyB1cGRhdGVEaXNwbGF5X1cyIHdpbGwgdXNlIHRoZXNlIHByb3BlcnRpZXMgdG8gZG8gdGhlIGFjdHVhbCByZXNpemluZw0KICAgIGlmIChkaXNwbGF5Lm1heExpbmVDaGFuZ2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgew0KICAgICAgb3AuYWRqdXN0V2lkdGhUbyA9IG1lYXN1cmVDaGFyKGNtLCBkaXNwbGF5Lm1heExpbmUsIGRpc3BsYXkubWF4TGluZS50ZXh0Lmxlbmd0aCkubGVmdCArIDM7DQogICAgICBjbS5kaXNwbGF5LnNpemVyV2lkdGggPSBvcC5hZGp1c3RXaWR0aFRvOw0KICAgICAgb3AuYmFyTWVhc3VyZS5zY3JvbGxXaWR0aCA9DQogICAgICAgIE1hdGgubWF4KGRpc3BsYXkuc2Nyb2xsZXIuY2xpZW50V2lkdGgsIGRpc3BsYXkuc2l6ZXIub2Zmc2V0TGVmdCArIG9wLmFkanVzdFdpZHRoVG8gKyBzY3JvbGxHYXAoY20pICsgY20uZGlzcGxheS5iYXJXaWR0aCk7DQogICAgICBvcC5tYXhTY3JvbGxMZWZ0ID0gTWF0aC5tYXgoMCwgZGlzcGxheS5zaXplci5vZmZzZXRMZWZ0ICsgb3AuYWRqdXN0V2lkdGhUbyAtIGRpc3BsYXlXaWR0aChjbSkpOw0KICAgIH0NCg0KICAgIGlmIChvcC51cGRhdGVkRGlzcGxheSB8fCBvcC5zZWxlY3Rpb25DaGFuZ2VkKQ0KICAgICAgeyBvcC5wcmVwYXJlZFNlbGVjdGlvbiA9IGRpc3BsYXkuaW5wdXQucHJlcGFyZVNlbGVjdGlvbigpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fVzIob3ApIHsNCiAgICB2YXIgY20gPSBvcC5jbTsNCg0KICAgIGlmIChvcC5hZGp1c3RXaWR0aFRvICE9IG51bGwpIHsNCiAgICAgIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWluV2lkdGggPSBvcC5hZGp1c3RXaWR0aFRvICsgInB4IjsNCiAgICAgIGlmIChvcC5tYXhTY3JvbGxMZWZ0IDwgY20uZG9jLnNjcm9sbExlZnQpDQogICAgICAgIHsgc2V0U2Nyb2xsTGVmdChjbSwgTWF0aC5taW4oY20uZGlzcGxheS5zY3JvbGxlci5zY3JvbGxMZWZ0LCBvcC5tYXhTY3JvbGxMZWZ0KSwgdHJ1ZSk7IH0NCiAgICAgIGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSBmYWxzZTsNCiAgICB9DQoNCiAgICB2YXIgdGFrZUZvY3VzID0gb3AuZm9jdXMgJiYgb3AuZm9jdXMgPT0gYWN0aXZlRWx0KCk7DQogICAgaWYgKG9wLnByZXBhcmVkU2VsZWN0aW9uKQ0KICAgICAgeyBjbS5kaXNwbGF5LmlucHV0LnNob3dTZWxlY3Rpb24ob3AucHJlcGFyZWRTZWxlY3Rpb24sIHRha2VGb2N1cyk7IH0NCiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkgfHwgb3Auc3RhcnRIZWlnaHQgIT0gY20uZG9jLmhlaWdodCkNCiAgICAgIHsgdXBkYXRlU2Nyb2xsYmFycyhjbSwgb3AuYmFyTWVhc3VyZSk7IH0NCiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkpDQogICAgICB7IHNldERvY3VtZW50SGVpZ2h0KGNtLCBvcC5iYXJNZWFzdXJlKTsgfQ0KDQogICAgaWYgKG9wLnNlbGVjdGlvbkNoYW5nZWQpIHsgcmVzdGFydEJsaW5rKGNtKTsgfQ0KDQogICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQgJiYgb3AudXBkYXRlSW5wdXQpDQogICAgICB7IGNtLmRpc3BsYXkuaW5wdXQucmVzZXQob3AudHlwaW5nKTsgfQ0KICAgIGlmICh0YWtlRm9jdXMpIHsgZW5zdXJlRm9jdXMob3AuY20pOyB9DQogIH0NCg0KICBmdW5jdGlvbiBlbmRPcGVyYXRpb25fZmluaXNoKG9wKSB7DQogICAgdmFyIGNtID0gb3AuY20sIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7DQoNCiAgICBpZiAob3AudXBkYXRlZERpc3BsYXkpIHsgcG9zdFVwZGF0ZURpc3BsYXkoY20sIG9wLnVwZGF0ZSk7IH0NCg0KICAgIC8vIEFib3J0IG1vdXNlIHdoZWVsIGRlbHRhIG1lYXN1cmVtZW50LCB3aGVuIHNjcm9sbGluZyBleHBsaWNpdGx5DQogICAgaWYgKGRpc3BsYXkud2hlZWxTdGFydFggIT0gbnVsbCAmJiAob3Auc2Nyb2xsVG9wICE9IG51bGwgfHwgb3Auc2Nyb2xsTGVmdCAhPSBudWxsIHx8IG9wLnNjcm9sbFRvUG9zKSkNCiAgICAgIHsgZGlzcGxheS53aGVlbFN0YXJ0WCA9IGRpc3BsYXkud2hlZWxTdGFydFkgPSBudWxsOyB9DQoNCiAgICAvLyBQcm9wYWdhdGUgdGhlIHNjcm9sbCBwb3NpdGlvbiB0byB0aGUgYWN0dWFsIERPTSBzY3JvbGxlcg0KICAgIGlmIChvcC5zY3JvbGxUb3AgIT0gbnVsbCkgeyBzZXRTY3JvbGxUb3AoY20sIG9wLnNjcm9sbFRvcCwgb3AuZm9yY2VTY3JvbGwpOyB9DQoNCiAgICBpZiAob3Auc2Nyb2xsTGVmdCAhPSBudWxsKSB7IHNldFNjcm9sbExlZnQoY20sIG9wLnNjcm9sbExlZnQsIHRydWUsIHRydWUpOyB9DQogICAgLy8gSWYgd2UgbmVlZCB0byBzY3JvbGwgYSBzcGVjaWZpYyBwb3NpdGlvbiBpbnRvIHZpZXcsIGRvIHNvLg0KICAgIGlmIChvcC5zY3JvbGxUb1Bvcykgew0KICAgICAgdmFyIHJlY3QgPSBzY3JvbGxQb3NJbnRvVmlldyhjbSwgY2xpcFBvcyhkb2MsIG9wLnNjcm9sbFRvUG9zLmZyb20pLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwUG9zKGRvYywgb3Auc2Nyb2xsVG9Qb3MudG8pLCBvcC5zY3JvbGxUb1Bvcy5tYXJnaW4pOw0KICAgICAgbWF5YmVTY3JvbGxXaW5kb3coY20sIHJlY3QpOw0KICAgIH0NCg0KICAgIC8vIEZpcmUgZXZlbnRzIGZvciBtYXJrZXJzIHRoYXQgYXJlIGhpZGRlbi91bmlkZGVuIGJ5IGVkaXRpbmcgb3INCiAgICAvLyB1bmRvaW5nDQogICAgdmFyIGhpZGRlbiA9IG9wLm1heWJlSGlkZGVuTWFya2VycywgdW5oaWRkZW4gPSBvcC5tYXliZVVuaGlkZGVuTWFya2VyczsNCiAgICBpZiAoaGlkZGVuKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgaGlkZGVuLmxlbmd0aDsgKytpKQ0KICAgICAgeyBpZiAoIWhpZGRlbltpXS5saW5lcy5sZW5ndGgpIHsgc2lnbmFsKGhpZGRlbltpXSwgImhpZGUiKTsgfSB9IH0NCiAgICBpZiAodW5oaWRkZW4pIHsgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgdW5oaWRkZW4ubGVuZ3RoOyArK2kkMSkNCiAgICAgIHsgaWYgKHVuaGlkZGVuW2kkMV0ubGluZXMubGVuZ3RoKSB7IHNpZ25hbCh1bmhpZGRlbltpJDFdLCAidW5oaWRlIik7IH0gfSB9DQoNCiAgICBpZiAoZGlzcGxheS53cmFwcGVyLm9mZnNldEhlaWdodCkNCiAgICAgIHsgZG9jLnNjcm9sbFRvcCA9IGNtLmRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wOyB9DQoNCiAgICAvLyBGaXJlIGNoYW5nZSBldmVudHMsIGFuZCBkZWxheWVkIGV2ZW50IGhhbmRsZXJzDQogICAgaWYgKG9wLmNoYW5nZU9ianMpDQogICAgICB7IHNpZ25hbChjbSwgImNoYW5nZXMiLCBjbSwgb3AuY2hhbmdlT2Jqcyk7IH0NCiAgICBpZiAob3AudXBkYXRlKQ0KICAgICAgeyBvcC51cGRhdGUuZmluaXNoKCk7IH0NCiAgfQ0KDQogIC8vIFJ1biB0aGUgZ2l2ZW4gZnVuY3Rpb24gaW4gYW4gb3BlcmF0aW9uDQogIGZ1bmN0aW9uIHJ1bkluT3AoY20sIGYpIHsNCiAgICBpZiAoY20uY3VyT3ApIHsgcmV0dXJuIGYoKSB9DQogICAgc3RhcnRPcGVyYXRpb24oY20pOw0KICAgIHRyeSB7IHJldHVybiBmKCkgfQ0KICAgIGZpbmFsbHkgeyBlbmRPcGVyYXRpb24oY20pOyB9DQogIH0NCiAgLy8gV3JhcHMgYSBmdW5jdGlvbiBpbiBhbiBvcGVyYXRpb24uIFJldHVybnMgdGhlIHdyYXBwZWQgZnVuY3Rpb24uDQogIGZ1bmN0aW9uIG9wZXJhdGlvbihjbSwgZikgew0KICAgIHJldHVybiBmdW5jdGlvbigpIHsNCiAgICAgIGlmIChjbS5jdXJPcCkgeyByZXR1cm4gZi5hcHBseShjbSwgYXJndW1lbnRzKSB9DQogICAgICBzdGFydE9wZXJhdGlvbihjbSk7DQogICAgICB0cnkgeyByZXR1cm4gZi5hcHBseShjbSwgYXJndW1lbnRzKSB9DQogICAgICBmaW5hbGx5IHsgZW5kT3BlcmF0aW9uKGNtKTsgfQ0KICAgIH0NCiAgfQ0KICAvLyBVc2VkIHRvIGFkZCBtZXRob2RzIHRvIGVkaXRvciBhbmQgZG9jIGluc3RhbmNlcywgd3JhcHBpbmcgdGhlbSBpbg0KICAvLyBvcGVyYXRpb25zLg0KICBmdW5jdGlvbiBtZXRob2RPcChmKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgaWYgKHRoaXMuY3VyT3ApIHsgcmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9DQogICAgICBzdGFydE9wZXJhdGlvbih0aGlzKTsNCiAgICAgIHRyeSB7IHJldHVybiBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgfQ0KICAgICAgZmluYWxseSB7IGVuZE9wZXJhdGlvbih0aGlzKTsgfQ0KICAgIH0NCiAgfQ0KICBmdW5jdGlvbiBkb2NNZXRob2RPcChmKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKCkgew0KICAgICAgdmFyIGNtID0gdGhpcy5jbTsNCiAgICAgIGlmICghY20gfHwgY20uY3VyT3ApIHsgcmV0dXJuIGYuYXBwbHkodGhpcywgYXJndW1lbnRzKSB9DQogICAgICBzdGFydE9wZXJhdGlvbihjbSk7DQogICAgICB0cnkgeyByZXR1cm4gZi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIH0NCiAgICAgIGZpbmFsbHkgeyBlbmRPcGVyYXRpb24oY20pOyB9DQogICAgfQ0KICB9DQoNCiAgLy8gSElHSExJR0hUIFdPUktFUg0KDQogIGZ1bmN0aW9uIHN0YXJ0V29ya2VyKGNtLCB0aW1lKSB7DQogICAgaWYgKGNtLmRvYy5oaWdobGlnaHRGcm9udGllciA8IGNtLmRpc3BsYXkudmlld1RvKQ0KICAgICAgeyBjbS5zdGF0ZS5oaWdobGlnaHQuc2V0KHRpbWUsIGJpbmQoaGlnaGxpZ2h0V29ya2VyLCBjbSkpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBoaWdobGlnaHRXb3JrZXIoY20pIHsNCiAgICB2YXIgZG9jID0gY20uZG9jOw0KICAgIGlmIChkb2MuaGlnaGxpZ2h0RnJvbnRpZXIgPj0gY20uZGlzcGxheS52aWV3VG8pIHsgcmV0dXJuIH0NCiAgICB2YXIgZW5kID0gK25ldyBEYXRlICsgY20ub3B0aW9ucy53b3JrVGltZTsNCiAgICB2YXIgY29udGV4dCA9IGdldENvbnRleHRCZWZvcmUoY20sIGRvYy5oaWdobGlnaHRGcm9udGllcik7DQogICAgdmFyIGNoYW5nZWRMaW5lcyA9IFtdOw0KDQogICAgZG9jLml0ZXIoY29udGV4dC5saW5lLCBNYXRoLm1pbihkb2MuZmlyc3QgKyBkb2Muc2l6ZSwgY20uZGlzcGxheS52aWV3VG8gKyA1MDApLCBmdW5jdGlvbiAobGluZSkgew0KICAgICAgaWYgKGNvbnRleHQubGluZSA+PSBjbS5kaXNwbGF5LnZpZXdGcm9tKSB7IC8vIFZpc2libGUNCiAgICAgICAgdmFyIG9sZFN0eWxlcyA9IGxpbmUuc3R5bGVzOw0KICAgICAgICB2YXIgcmVzZXRTdGF0ZSA9IGxpbmUudGV4dC5sZW5ndGggPiBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aCA/IGNvcHlTdGF0ZShkb2MubW9kZSwgY29udGV4dC5zdGF0ZSkgOiBudWxsOw0KICAgICAgICB2YXIgaGlnaGxpZ2h0ZWQgPSBoaWdobGlnaHRMaW5lKGNtLCBsaW5lLCBjb250ZXh0LCB0cnVlKTsNCiAgICAgICAgaWYgKHJlc2V0U3RhdGUpIHsgY29udGV4dC5zdGF0ZSA9IHJlc2V0U3RhdGU7IH0NCiAgICAgICAgbGluZS5zdHlsZXMgPSBoaWdobGlnaHRlZC5zdHlsZXM7DQogICAgICAgIHZhciBvbGRDbHMgPSBsaW5lLnN0eWxlQ2xhc3NlcywgbmV3Q2xzID0gaGlnaGxpZ2h0ZWQuY2xhc3NlczsNCiAgICAgICAgaWYgKG5ld0NscykgeyBsaW5lLnN0eWxlQ2xhc3NlcyA9IG5ld0NsczsgfQ0KICAgICAgICBlbHNlIGlmIChvbGRDbHMpIHsgbGluZS5zdHlsZUNsYXNzZXMgPSBudWxsOyB9DQogICAgICAgIHZhciBpc2NoYW5nZSA9ICFvbGRTdHlsZXMgfHwgb2xkU3R5bGVzLmxlbmd0aCAhPSBsaW5lLnN0eWxlcy5sZW5ndGggfHwNCiAgICAgICAgICBvbGRDbHMgIT0gbmV3Q2xzICYmICghb2xkQ2xzIHx8ICFuZXdDbHMgfHwgb2xkQ2xzLmJnQ2xhc3MgIT0gbmV3Q2xzLmJnQ2xhc3MgfHwgb2xkQ2xzLnRleHRDbGFzcyAhPSBuZXdDbHMudGV4dENsYXNzKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7ICFpc2NoYW5nZSAmJiBpIDwgb2xkU3R5bGVzLmxlbmd0aDsgKytpKSB7IGlzY2hhbmdlID0gb2xkU3R5bGVzW2ldICE9IGxpbmUuc3R5bGVzW2ldOyB9DQogICAgICAgIGlmIChpc2NoYW5nZSkgeyBjaGFuZ2VkTGluZXMucHVzaChjb250ZXh0LmxpbmUpOyB9DQogICAgICAgIGxpbmUuc3RhdGVBZnRlciA9IGNvbnRleHQuc2F2ZSgpOw0KICAgICAgICBjb250ZXh0Lm5leHRMaW5lKCk7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBpZiAobGluZS50ZXh0Lmxlbmd0aCA8PSBjbS5vcHRpb25zLm1heEhpZ2hsaWdodExlbmd0aCkNCiAgICAgICAgICB7IHByb2Nlc3NMaW5lKGNtLCBsaW5lLnRleHQsIGNvbnRleHQpOyB9DQogICAgICAgIGxpbmUuc3RhdGVBZnRlciA9IGNvbnRleHQubGluZSAlIDUgPT0gMCA/IGNvbnRleHQuc2F2ZSgpIDogbnVsbDsNCiAgICAgICAgY29udGV4dC5uZXh0TGluZSgpOw0KICAgICAgfQ0KICAgICAgaWYgKCtuZXcgRGF0ZSA+IGVuZCkgew0KICAgICAgICBzdGFydFdvcmtlcihjbSwgY20ub3B0aW9ucy53b3JrRGVsYXkpOw0KICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgfQ0KICAgIH0pOw0KICAgIGRvYy5oaWdobGlnaHRGcm9udGllciA9IGNvbnRleHQubGluZTsNCiAgICBkb2MubW9kZUZyb250aWVyID0gTWF0aC5tYXgoZG9jLm1vZGVGcm9udGllciwgY29udGV4dC5saW5lKTsNCiAgICBpZiAoY2hhbmdlZExpbmVzLmxlbmd0aCkgeyBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYW5nZWRMaW5lcy5sZW5ndGg7IGkrKykNCiAgICAgICAgeyByZWdMaW5lQ2hhbmdlKGNtLCBjaGFuZ2VkTGluZXNbaV0sICJ0ZXh0Iik7IH0NCiAgICB9KTsgfQ0KICB9DQoNCiAgLy8gRElTUExBWSBEUkFXSU5HDQoNCiAgdmFyIERpc3BsYXlVcGRhdGUgPSBmdW5jdGlvbihjbSwgdmlld3BvcnQsIGZvcmNlKSB7DQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5Ow0KDQogICAgdGhpcy52aWV3cG9ydCA9IHZpZXdwb3J0Ow0KICAgIC8vIFN0b3JlIHNvbWUgdmFsdWVzIHRoYXQgd2UnbGwgbmVlZCBsYXRlciAoYnV0IGRvbid0IHdhbnQgdG8gZm9yY2UgYSByZWxheW91dCBmb3IpDQogICAgdGhpcy52aXNpYmxlID0gdmlzaWJsZUxpbmVzKGRpc3BsYXksIGNtLmRvYywgdmlld3BvcnQpOw0KICAgIHRoaXMuZWRpdG9ySXNIaWRkZW4gPSAhZGlzcGxheS53cmFwcGVyLm9mZnNldFdpZHRoOw0KICAgIHRoaXMud3JhcHBlckhlaWdodCA9IGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQ7DQogICAgdGhpcy53cmFwcGVyV2lkdGggPSBkaXNwbGF5LndyYXBwZXIuY2xpZW50V2lkdGg7DQogICAgdGhpcy5vbGREaXNwbGF5V2lkdGggPSBkaXNwbGF5V2lkdGgoY20pOw0KICAgIHRoaXMuZm9yY2UgPSBmb3JjZTsNCiAgICB0aGlzLmRpbXMgPSBnZXREaW1lbnNpb25zKGNtKTsNCiAgICB0aGlzLmV2ZW50cyA9IFtdOw0KICB9Ow0KDQogIERpc3BsYXlVcGRhdGUucHJvdG90eXBlLnNpZ25hbCA9IGZ1bmN0aW9uIChlbWl0dGVyLCB0eXBlKSB7DQogICAgaWYgKGhhc0hhbmRsZXIoZW1pdHRlciwgdHlwZSkpDQogICAgICB7IHRoaXMuZXZlbnRzLnB1c2goYXJndW1lbnRzKTsgfQ0KICB9Ow0KICBEaXNwbGF5VXBkYXRlLnByb3RvdHlwZS5maW5pc2ggPSBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5ldmVudHMubGVuZ3RoOyBpKyspDQogICAgICB7IHNpZ25hbC5hcHBseShudWxsLCB0aGlzJDEuZXZlbnRzW2ldKTsgfQ0KICB9Ow0KDQogIGZ1bmN0aW9uIG1heWJlQ2xpcFNjcm9sbGJhcnMoY20pIHsNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXk7DQogICAgaWYgKCFkaXNwbGF5LnNjcm9sbGJhcnNDbGlwcGVkICYmIGRpc3BsYXkuc2Nyb2xsZXIub2Zmc2V0V2lkdGgpIHsNCiAgICAgIGRpc3BsYXkubmF0aXZlQmFyV2lkdGggPSBkaXNwbGF5LnNjcm9sbGVyLm9mZnNldFdpZHRoIC0gZGlzcGxheS5zY3JvbGxlci5jbGllbnRXaWR0aDsNCiAgICAgIGRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLmhlaWdodCA9IHNjcm9sbEdhcChjbSkgKyAicHgiOw0KICAgICAgZGlzcGxheS5zaXplci5zdHlsZS5tYXJnaW5Cb3R0b20gPSAtZGlzcGxheS5uYXRpdmVCYXJXaWR0aCArICJweCI7DQogICAgICBkaXNwbGF5LnNpemVyLnN0eWxlLmJvcmRlclJpZ2h0V2lkdGggPSBzY3JvbGxHYXAoY20pICsgInB4IjsNCiAgICAgIGRpc3BsYXkuc2Nyb2xsYmFyc0NsaXBwZWQgPSB0cnVlOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHNlbGVjdGlvblNuYXBzaG90KGNtKSB7DQogICAgaWYgKGNtLmhhc0ZvY3VzKCkpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHZhciBhY3RpdmUgPSBhY3RpdmVFbHQoKTsNCiAgICBpZiAoIWFjdGl2ZSB8fCAhY29udGFpbnMoY20uZGlzcGxheS5saW5lRGl2LCBhY3RpdmUpKSB7IHJldHVybiBudWxsIH0NCiAgICB2YXIgcmVzdWx0ID0ge2FjdGl2ZUVsdDogYWN0aXZlfTsNCiAgICBpZiAod2luZG93LmdldFNlbGVjdGlvbikgew0KICAgICAgdmFyIHNlbCA9IHdpbmRvdy5nZXRTZWxlY3Rpb24oKTsNCiAgICAgIGlmIChzZWwuYW5jaG9yTm9kZSAmJiBzZWwuZXh0ZW5kICYmIGNvbnRhaW5zKGNtLmRpc3BsYXkubGluZURpdiwgc2VsLmFuY2hvck5vZGUpKSB7DQogICAgICAgIHJlc3VsdC5hbmNob3JOb2RlID0gc2VsLmFuY2hvck5vZGU7DQogICAgICAgIHJlc3VsdC5hbmNob3JPZmZzZXQgPSBzZWwuYW5jaG9yT2Zmc2V0Ow0KICAgICAgICByZXN1bHQuZm9jdXNOb2RlID0gc2VsLmZvY3VzTm9kZTsNCiAgICAgICAgcmVzdWx0LmZvY3VzT2Zmc2V0ID0gc2VsLmZvY3VzT2Zmc2V0Ow0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gcmVzdWx0DQogIH0NCg0KICBmdW5jdGlvbiByZXN0b3JlU2VsZWN0aW9uKHNuYXBzaG90KSB7DQogICAgaWYgKCFzbmFwc2hvdCB8fCAhc25hcHNob3QuYWN0aXZlRWx0IHx8IHNuYXBzaG90LmFjdGl2ZUVsdCA9PSBhY3RpdmVFbHQoKSkgeyByZXR1cm4gfQ0KICAgIHNuYXBzaG90LmFjdGl2ZUVsdC5mb2N1cygpOw0KICAgIGlmIChzbmFwc2hvdC5hbmNob3JOb2RlICYmIGNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHNuYXBzaG90LmFuY2hvck5vZGUpICYmIGNvbnRhaW5zKGRvY3VtZW50LmJvZHksIHNuYXBzaG90LmZvY3VzTm9kZSkpIHsNCiAgICAgIHZhciBzZWwgPSB3aW5kb3cuZ2V0U2VsZWN0aW9uKCksIHJhbmdlJCQxID0gZG9jdW1lbnQuY3JlYXRlUmFuZ2UoKTsNCiAgICAgIHJhbmdlJCQxLnNldEVuZChzbmFwc2hvdC5hbmNob3JOb2RlLCBzbmFwc2hvdC5hbmNob3JPZmZzZXQpOw0KICAgICAgcmFuZ2UkJDEuY29sbGFwc2UoZmFsc2UpOw0KICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpOw0KICAgICAgc2VsLmFkZFJhbmdlKHJhbmdlJCQxKTsNCiAgICAgIHNlbC5leHRlbmQoc25hcHNob3QuZm9jdXNOb2RlLCBzbmFwc2hvdC5mb2N1c09mZnNldCk7DQogICAgfQ0KICB9DQoNCiAgLy8gRG9lcyB0aGUgYWN0dWFsIHVwZGF0aW5nIG9mIHRoZSBsaW5lIGRpc3BsYXkuIEJhaWxzIG91dA0KICAvLyAocmV0dXJuaW5nIGZhbHNlKSB3aGVuIHRoZXJlIGlzIG5vdGhpbmcgdG8gYmUgZG9uZSBhbmQgZm9yY2VkIGlzDQogIC8vIGZhbHNlLg0KICBmdW5jdGlvbiB1cGRhdGVEaXNwbGF5SWZOZWVkZWQoY20sIHVwZGF0ZSkgew0KICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheSwgZG9jID0gY20uZG9jOw0KDQogICAgaWYgKHVwZGF0ZS5lZGl0b3JJc0hpZGRlbikgew0KICAgICAgcmVzZXRWaWV3KGNtKTsNCiAgICAgIHJldHVybiBmYWxzZQ0KICAgIH0NCg0KICAgIC8vIEJhaWwgb3V0IGlmIHRoZSB2aXNpYmxlIGFyZWEgaXMgYWxyZWFkeSByZW5kZXJlZCBhbmQgbm90aGluZyBjaGFuZ2VkLg0KICAgIGlmICghdXBkYXRlLmZvcmNlICYmDQogICAgICAgIHVwZGF0ZS52aXNpYmxlLmZyb20gPj0gZGlzcGxheS52aWV3RnJvbSAmJiB1cGRhdGUudmlzaWJsZS50byA8PSBkaXNwbGF5LnZpZXdUbyAmJg0KICAgICAgICAoZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycyA9PSBudWxsIHx8IGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPj0gZGlzcGxheS52aWV3VG8pICYmDQogICAgICAgIGRpc3BsYXkucmVuZGVyZWRWaWV3ID09IGRpc3BsYXkudmlldyAmJiBjb3VudERpcnR5VmlldyhjbSkgPT0gMCkNCiAgICAgIHsgcmV0dXJuIGZhbHNlIH0NCg0KICAgIGlmIChtYXliZVVwZGF0ZUxpbmVOdW1iZXJXaWR0aChjbSkpIHsNCiAgICAgIHJlc2V0VmlldyhjbSk7DQogICAgICB1cGRhdGUuZGltcyA9IGdldERpbWVuc2lvbnMoY20pOw0KICAgIH0NCg0KICAgIC8vIENvbXB1dGUgYSBzdWl0YWJsZSBuZXcgdmlld3BvcnQgKGZyb20gJiB0bykNCiAgICB2YXIgZW5kID0gZG9jLmZpcnN0ICsgZG9jLnNpemU7DQogICAgdmFyIGZyb20gPSBNYXRoLm1heCh1cGRhdGUudmlzaWJsZS5mcm9tIC0gY20ub3B0aW9ucy52aWV3cG9ydE1hcmdpbiwgZG9jLmZpcnN0KTsNCiAgICB2YXIgdG8gPSBNYXRoLm1pbihlbmQsIHVwZGF0ZS52aXNpYmxlLnRvICsgY20ub3B0aW9ucy52aWV3cG9ydE1hcmdpbik7DQogICAgaWYgKGRpc3BsYXkudmlld0Zyb20gPCBmcm9tICYmIGZyb20gLSBkaXNwbGF5LnZpZXdGcm9tIDwgMjApIHsgZnJvbSA9IE1hdGgubWF4KGRvYy5maXJzdCwgZGlzcGxheS52aWV3RnJvbSk7IH0NCiAgICBpZiAoZGlzcGxheS52aWV3VG8gPiB0byAmJiBkaXNwbGF5LnZpZXdUbyAtIHRvIDwgMjApIHsgdG8gPSBNYXRoLm1pbihlbmQsIGRpc3BsYXkudmlld1RvKTsgfQ0KICAgIGlmIChzYXdDb2xsYXBzZWRTcGFucykgew0KICAgICAgZnJvbSA9IHZpc3VhbExpbmVObyhjbS5kb2MsIGZyb20pOw0KICAgICAgdG8gPSB2aXN1YWxMaW5lRW5kTm8oY20uZG9jLCB0byk7DQogICAgfQ0KDQogICAgdmFyIGRpZmZlcmVudCA9IGZyb20gIT0gZGlzcGxheS52aWV3RnJvbSB8fCB0byAhPSBkaXNwbGF5LnZpZXdUbyB8fA0KICAgICAgZGlzcGxheS5sYXN0V3JhcEhlaWdodCAhPSB1cGRhdGUud3JhcHBlckhlaWdodCB8fCBkaXNwbGF5Lmxhc3RXcmFwV2lkdGggIT0gdXBkYXRlLndyYXBwZXJXaWR0aDsNCiAgICBhZGp1c3RWaWV3KGNtLCBmcm9tLCB0byk7DQoNCiAgICBkaXNwbGF5LnZpZXdPZmZzZXQgPSBoZWlnaHRBdExpbmUoZ2V0TGluZShjbS5kb2MsIGRpc3BsYXkudmlld0Zyb20pKTsNCiAgICAvLyBQb3NpdGlvbiB0aGUgbW92ZXIgZGl2IHRvIGFsaWduIHdpdGggdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uDQogICAgY20uZGlzcGxheS5tb3Zlci5zdHlsZS50b3AgPSBkaXNwbGF5LnZpZXdPZmZzZXQgKyAicHgiOw0KDQogICAgdmFyIHRvVXBkYXRlID0gY291bnREaXJ0eVZpZXcoY20pOw0KICAgIGlmICghZGlmZmVyZW50ICYmIHRvVXBkYXRlID09IDAgJiYgIXVwZGF0ZS5mb3JjZSAmJiBkaXNwbGF5LnJlbmRlcmVkVmlldyA9PSBkaXNwbGF5LnZpZXcgJiYNCiAgICAgICAgKGRpc3BsYXkudXBkYXRlTGluZU51bWJlcnMgPT0gbnVsbCB8fCBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID49IGRpc3BsYXkudmlld1RvKSkNCiAgICAgIHsgcmV0dXJuIGZhbHNlIH0NCg0KICAgIC8vIEZvciBiaWcgY2hhbmdlcywgd2UgaGlkZSB0aGUgZW5jbG9zaW5nIGVsZW1lbnQgZHVyaW5nIHRoZQ0KICAgIC8vIHVwZGF0ZSwgc2luY2UgdGhhdCBzcGVlZHMgdXAgdGhlIG9wZXJhdGlvbnMgb24gbW9zdCBicm93c2Vycy4NCiAgICB2YXIgc2VsU25hcHNob3QgPSBzZWxlY3Rpb25TbmFwc2hvdChjbSk7DQogICAgaWYgKHRvVXBkYXRlID4gNCkgeyBkaXNwbGF5LmxpbmVEaXYuc3R5bGUuZGlzcGxheSA9ICJub25lIjsgfQ0KICAgIHBhdGNoRGlzcGxheShjbSwgZGlzcGxheS51cGRhdGVMaW5lTnVtYmVycywgdXBkYXRlLmRpbXMpOw0KICAgIGlmICh0b1VwZGF0ZSA+IDQpIHsgZGlzcGxheS5saW5lRGl2LnN0eWxlLmRpc3BsYXkgPSAiIjsgfQ0KICAgIGRpc3BsYXkucmVuZGVyZWRWaWV3ID0gZGlzcGxheS52aWV3Ow0KICAgIC8vIFRoZXJlIG1pZ2h0IGhhdmUgYmVlbiBhIHdpZGdldCB3aXRoIGEgZm9jdXNlZCBlbGVtZW50IHRoYXQgZ290DQogICAgLy8gaGlkZGVuIG9yIHVwZGF0ZWQsIGlmIHNvIHJlLWZvY3VzIGl0Lg0KICAgIHJlc3RvcmVTZWxlY3Rpb24oc2VsU25hcHNob3QpOw0KDQogICAgLy8gUHJldmVudCBzZWxlY3Rpb24gYW5kIGN1cnNvcnMgZnJvbSBpbnRlcmZlcmluZyB3aXRoIHRoZSBzY3JvbGwNCiAgICAvLyB3aWR0aCBhbmQgaGVpZ2h0Lg0KICAgIHJlbW92ZUNoaWxkcmVuKGRpc3BsYXkuY3Vyc29yRGl2KTsNCiAgICByZW1vdmVDaGlsZHJlbihkaXNwbGF5LnNlbGVjdGlvbkRpdik7DQogICAgZGlzcGxheS5ndXR0ZXJzLnN0eWxlLmhlaWdodCA9IGRpc3BsYXkuc2l6ZXIuc3R5bGUubWluSGVpZ2h0ID0gMDsNCg0KICAgIGlmIChkaWZmZXJlbnQpIHsNCiAgICAgIGRpc3BsYXkubGFzdFdyYXBIZWlnaHQgPSB1cGRhdGUud3JhcHBlckhlaWdodDsNCiAgICAgIGRpc3BsYXkubGFzdFdyYXBXaWR0aCA9IHVwZGF0ZS53cmFwcGVyV2lkdGg7DQogICAgICBzdGFydFdvcmtlcihjbSwgNDAwKTsNCiAgICB9DQoNCiAgICBkaXNwbGF5LnVwZGF0ZUxpbmVOdW1iZXJzID0gbnVsbDsNCg0KICAgIHJldHVybiB0cnVlDQogIH0NCg0KICBmdW5jdGlvbiBwb3N0VXBkYXRlRGlzcGxheShjbSwgdXBkYXRlKSB7DQogICAgdmFyIHZpZXdwb3J0ID0gdXBkYXRlLnZpZXdwb3J0Ow0KDQogICAgZm9yICh2YXIgZmlyc3QgPSB0cnVlOzsgZmlyc3QgPSBmYWxzZSkgew0KICAgICAgaWYgKCFmaXJzdCB8fCAhY20ub3B0aW9ucy5saW5lV3JhcHBpbmcgfHwgdXBkYXRlLm9sZERpc3BsYXlXaWR0aCA9PSBkaXNwbGF5V2lkdGgoY20pKSB7DQogICAgICAgIC8vIENsaXAgZm9yY2VkIHZpZXdwb3J0IHRvIGFjdHVhbCBzY3JvbGxhYmxlIGFyZWEuDQogICAgICAgIGlmICh2aWV3cG9ydCAmJiB2aWV3cG9ydC50b3AgIT0gbnVsbCkNCiAgICAgICAgICB7IHZpZXdwb3J0ID0ge3RvcDogTWF0aC5taW4oY20uZG9jLmhlaWdodCArIHBhZGRpbmdWZXJ0KGNtLmRpc3BsYXkpIC0gZGlzcGxheUhlaWdodChjbSksIHZpZXdwb3J0LnRvcCl9OyB9DQogICAgICAgIC8vIFVwZGF0ZWQgbGluZSBoZWlnaHRzIG1pZ2h0IHJlc3VsdCBpbiB0aGUgZHJhd24gYXJlYSBub3QNCiAgICAgICAgLy8gYWN0dWFsbHkgY292ZXJpbmcgdGhlIHZpZXdwb3J0LiBLZWVwIGxvb3BpbmcgdW50aWwgaXQgZG9lcy4NCiAgICAgICAgdXBkYXRlLnZpc2libGUgPSB2aXNpYmxlTGluZXMoY20uZGlzcGxheSwgY20uZG9jLCB2aWV3cG9ydCk7DQogICAgICAgIGlmICh1cGRhdGUudmlzaWJsZS5mcm9tID49IGNtLmRpc3BsYXkudmlld0Zyb20gJiYgdXBkYXRlLnZpc2libGUudG8gPD0gY20uZGlzcGxheS52aWV3VG8pDQogICAgICAgICAgeyBicmVhayB9DQogICAgICB9IGVsc2UgaWYgKGZpcnN0KSB7DQogICAgICAgIHVwZGF0ZS52aXNpYmxlID0gdmlzaWJsZUxpbmVzKGNtLmRpc3BsYXksIGNtLmRvYywgdmlld3BvcnQpOw0KICAgICAgfQ0KICAgICAgaWYgKCF1cGRhdGVEaXNwbGF5SWZOZWVkZWQoY20sIHVwZGF0ZSkpIHsgYnJlYWsgfQ0KICAgICAgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pOw0KICAgICAgdmFyIGJhck1lYXN1cmUgPSBtZWFzdXJlRm9yU2Nyb2xsYmFycyhjbSk7DQogICAgICB1cGRhdGVTZWxlY3Rpb24oY20pOw0KICAgICAgdXBkYXRlU2Nyb2xsYmFycyhjbSwgYmFyTWVhc3VyZSk7DQogICAgICBzZXREb2N1bWVudEhlaWdodChjbSwgYmFyTWVhc3VyZSk7DQogICAgICB1cGRhdGUuZm9yY2UgPSBmYWxzZTsNCiAgICB9DQoNCiAgICB1cGRhdGUuc2lnbmFsKGNtLCAidXBkYXRlIiwgY20pOw0KICAgIGlmIChjbS5kaXNwbGF5LnZpZXdGcm9tICE9IGNtLmRpc3BsYXkucmVwb3J0ZWRWaWV3RnJvbSB8fCBjbS5kaXNwbGF5LnZpZXdUbyAhPSBjbS5kaXNwbGF5LnJlcG9ydGVkVmlld1RvKSB7DQogICAgICB1cGRhdGUuc2lnbmFsKGNtLCAidmlld3BvcnRDaGFuZ2UiLCBjbSwgY20uZGlzcGxheS52aWV3RnJvbSwgY20uZGlzcGxheS52aWV3VG8pOw0KICAgICAgY20uZGlzcGxheS5yZXBvcnRlZFZpZXdGcm9tID0gY20uZGlzcGxheS52aWV3RnJvbTsgY20uZGlzcGxheS5yZXBvcnRlZFZpZXdUbyA9IGNtLmRpc3BsYXkudmlld1RvOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHVwZGF0ZURpc3BsYXlTaW1wbGUoY20sIHZpZXdwb3J0KSB7DQogICAgdmFyIHVwZGF0ZSA9IG5ldyBEaXNwbGF5VXBkYXRlKGNtLCB2aWV3cG9ydCk7DQogICAgaWYgKHVwZGF0ZURpc3BsYXlJZk5lZWRlZChjbSwgdXBkYXRlKSkgew0KICAgICAgdXBkYXRlSGVpZ2h0c0luVmlld3BvcnQoY20pOw0KICAgICAgcG9zdFVwZGF0ZURpc3BsYXkoY20sIHVwZGF0ZSk7DQogICAgICB2YXIgYmFyTWVhc3VyZSA9IG1lYXN1cmVGb3JTY3JvbGxiYXJzKGNtKTsNCiAgICAgIHVwZGF0ZVNlbGVjdGlvbihjbSk7DQogICAgICB1cGRhdGVTY3JvbGxiYXJzKGNtLCBiYXJNZWFzdXJlKTsNCiAgICAgIHNldERvY3VtZW50SGVpZ2h0KGNtLCBiYXJNZWFzdXJlKTsNCiAgICAgIHVwZGF0ZS5maW5pc2goKTsNCiAgICB9DQogIH0NCg0KICAvLyBTeW5jIHRoZSBhY3R1YWwgZGlzcGxheSBET00gc3RydWN0dXJlIHdpdGggZGlzcGxheS52aWV3LCByZW1vdmluZw0KICAvLyBub2RlcyBmb3IgbGluZXMgdGhhdCBhcmUgbm8gbG9uZ2VyIGluIHZpZXcsIGFuZCBjcmVhdGluZyB0aGUgb25lcw0KICAvLyB0aGF0IGFyZSBub3QgdGhlcmUgeWV0LCBhbmQgdXBkYXRpbmcgdGhlIG9uZXMgdGhhdCBhcmUgb3V0IG9mDQogIC8vIGRhdGUuDQogIGZ1bmN0aW9uIHBhdGNoRGlzcGxheShjbSwgdXBkYXRlTnVtYmVyc0Zyb20sIGRpbXMpIHsNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIGxpbmVOdW1iZXJzID0gY20ub3B0aW9ucy5saW5lTnVtYmVyczsNCiAgICB2YXIgY29udGFpbmVyID0gZGlzcGxheS5saW5lRGl2LCBjdXIgPSBjb250YWluZXIuZmlyc3RDaGlsZDsNCg0KICAgIGZ1bmN0aW9uIHJtKG5vZGUpIHsNCiAgICAgIHZhciBuZXh0ID0gbm9kZS5uZXh0U2libGluZzsNCiAgICAgIC8vIFdvcmtzIGFyb3VuZCBhIHRocm93LXNjcm9sbCBidWcgaW4gT1MgWCBXZWJraXQNCiAgICAgIGlmICh3ZWJraXQgJiYgbWFjICYmIGNtLmRpc3BsYXkuY3VycmVudFdoZWVsVGFyZ2V0ID09IG5vZGUpDQogICAgICAgIHsgbm9kZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOyB9DQogICAgICBlbHNlDQogICAgICAgIHsgbm9kZS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpOyB9DQogICAgICByZXR1cm4gbmV4dA0KICAgIH0NCg0KICAgIHZhciB2aWV3ID0gZGlzcGxheS52aWV3LCBsaW5lTiA9IGRpc3BsYXkudmlld0Zyb207DQogICAgLy8gTG9vcCBvdmVyIHRoZSBlbGVtZW50cyBpbiB0aGUgdmlldywgc3luY2luZyBjdXIgKHRoZSBET00gbm9kZXMNCiAgICAvLyBpbiBkaXNwbGF5LmxpbmVEaXYpIHdpdGggdGhlIHZpZXcgYXMgd2UgZ28uDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB2aWV3Lmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgbGluZVZpZXcgPSB2aWV3W2ldOw0KICAgICAgaWYgKGxpbmVWaWV3LmhpZGRlbikgOyBlbHNlIGlmICghbGluZVZpZXcubm9kZSB8fCBsaW5lVmlldy5ub2RlLnBhcmVudE5vZGUgIT0gY29udGFpbmVyKSB7IC8vIE5vdCBkcmF3biB5ZXQNCiAgICAgICAgdmFyIG5vZGUgPSBidWlsZExpbmVFbGVtZW50KGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpOw0KICAgICAgICBjb250YWluZXIuaW5zZXJ0QmVmb3JlKG5vZGUsIGN1cik7DQogICAgICB9IGVsc2UgeyAvLyBBbHJlYWR5IGRyYXduDQogICAgICAgIHdoaWxlIChjdXIgIT0gbGluZVZpZXcubm9kZSkgeyBjdXIgPSBybShjdXIpOyB9DQogICAgICAgIHZhciB1cGRhdGVOdW1iZXIgPSBsaW5lTnVtYmVycyAmJiB1cGRhdGVOdW1iZXJzRnJvbSAhPSBudWxsICYmDQogICAgICAgICAgdXBkYXRlTnVtYmVyc0Zyb20gPD0gbGluZU4gJiYgbGluZVZpZXcubGluZU51bWJlcjsNCiAgICAgICAgaWYgKGxpbmVWaWV3LmNoYW5nZXMpIHsNCiAgICAgICAgICBpZiAoaW5kZXhPZihsaW5lVmlldy5jaGFuZ2VzLCAiZ3V0dGVyIikgPiAtMSkgeyB1cGRhdGVOdW1iZXIgPSBmYWxzZTsgfQ0KICAgICAgICAgIHVwZGF0ZUxpbmVGb3JDaGFuZ2VzKGNtLCBsaW5lVmlldywgbGluZU4sIGRpbXMpOw0KICAgICAgICB9DQogICAgICAgIGlmICh1cGRhdGVOdW1iZXIpIHsNCiAgICAgICAgICByZW1vdmVDaGlsZHJlbihsaW5lVmlldy5saW5lTnVtYmVyKTsNCiAgICAgICAgICBsaW5lVmlldy5saW5lTnVtYmVyLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGxpbmVOdW1iZXJGb3IoY20ub3B0aW9ucywgbGluZU4pKSk7DQogICAgICAgIH0NCiAgICAgICAgY3VyID0gbGluZVZpZXcubm9kZS5uZXh0U2libGluZzsNCiAgICAgIH0NCiAgICAgIGxpbmVOICs9IGxpbmVWaWV3LnNpemU7DQogICAgfQ0KICAgIHdoaWxlIChjdXIpIHsgY3VyID0gcm0oY3VyKTsgfQ0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlR3V0dGVyU3BhY2UoZGlzcGxheSkgew0KICAgIHZhciB3aWR0aCA9IGRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aDsNCiAgICBkaXNwbGF5LnNpemVyLnN0eWxlLm1hcmdpbkxlZnQgPSB3aWR0aCArICJweCI7DQogIH0NCg0KICBmdW5jdGlvbiBzZXREb2N1bWVudEhlaWdodChjbSwgbWVhc3VyZSkgew0KICAgIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWluSGVpZ2h0ID0gbWVhc3VyZS5kb2NIZWlnaHQgKyAicHgiOw0KICAgIGNtLmRpc3BsYXkuaGVpZ2h0Rm9yY2VyLnN0eWxlLnRvcCA9IG1lYXN1cmUuZG9jSGVpZ2h0ICsgInB4IjsNCiAgICBjbS5kaXNwbGF5Lmd1dHRlcnMuc3R5bGUuaGVpZ2h0ID0gKG1lYXN1cmUuZG9jSGVpZ2h0ICsgY20uZGlzcGxheS5iYXJIZWlnaHQgKyBzY3JvbGxHYXAoY20pKSArICJweCI7DQogIH0NCg0KICAvLyBSZS1hbGlnbiBsaW5lIG51bWJlcnMgYW5kIGd1dHRlciBtYXJrcyB0byBjb21wZW5zYXRlIGZvcg0KICAvLyBob3Jpem9udGFsIHNjcm9sbGluZy4NCiAgZnVuY3Rpb24gYWxpZ25Ib3Jpem9udGFsbHkoY20pIHsNCiAgICB2YXIgZGlzcGxheSA9IGNtLmRpc3BsYXksIHZpZXcgPSBkaXNwbGF5LnZpZXc7DQogICAgaWYgKCFkaXNwbGF5LmFsaWduV2lkZ2V0cyAmJiAoIWRpc3BsYXkuZ3V0dGVycy5maXJzdENoaWxkIHx8ICFjbS5vcHRpb25zLmZpeGVkR3V0dGVyKSkgeyByZXR1cm4gfQ0KICAgIHZhciBjb21wID0gY29tcGVuc2F0ZUZvckhTY3JvbGwoZGlzcGxheSkgLSBkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbExlZnQgKyBjbS5kb2Muc2Nyb2xsTGVmdDsNCiAgICB2YXIgZ3V0dGVyVyA9IGRpc3BsYXkuZ3V0dGVycy5vZmZzZXRXaWR0aCwgbGVmdCA9IGNvbXAgKyAicHgiOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykgeyBpZiAoIXZpZXdbaV0uaGlkZGVuKSB7DQogICAgICBpZiAoY20ub3B0aW9ucy5maXhlZEd1dHRlcikgew0KICAgICAgICBpZiAodmlld1tpXS5ndXR0ZXIpDQogICAgICAgICAgeyB2aWV3W2ldLmd1dHRlci5zdHlsZS5sZWZ0ID0gbGVmdDsgfQ0KICAgICAgICBpZiAodmlld1tpXS5ndXR0ZXJCYWNrZ3JvdW5kKQ0KICAgICAgICAgIHsgdmlld1tpXS5ndXR0ZXJCYWNrZ3JvdW5kLnN0eWxlLmxlZnQgPSBsZWZ0OyB9DQogICAgICB9DQogICAgICB2YXIgYWxpZ24gPSB2aWV3W2ldLmFsaWduYWJsZTsNCiAgICAgIGlmIChhbGlnbikgeyBmb3IgKHZhciBqID0gMDsgaiA8IGFsaWduLmxlbmd0aDsgaisrKQ0KICAgICAgICB7IGFsaWduW2pdLnN0eWxlLmxlZnQgPSBsZWZ0OyB9IH0NCiAgICB9IH0NCiAgICBpZiAoY20ub3B0aW9ucy5maXhlZEd1dHRlcikNCiAgICAgIHsgZGlzcGxheS5ndXR0ZXJzLnN0eWxlLmxlZnQgPSAoY29tcCArIGd1dHRlclcpICsgInB4IjsgfQ0KICB9DQoNCiAgLy8gVXNlZCB0byBlbnN1cmUgdGhhdCB0aGUgbGluZSBudW1iZXIgZ3V0dGVyIGlzIHN0aWxsIHRoZSByaWdodA0KICAvLyBzaXplIGZvciB0aGUgY3VycmVudCBkb2N1bWVudCBzaXplLiBSZXR1cm5zIHRydWUgd2hlbiBhbiB1cGRhdGUNCiAgLy8gaXMgbmVlZGVkLg0KICBmdW5jdGlvbiBtYXliZVVwZGF0ZUxpbmVOdW1iZXJXaWR0aChjbSkgew0KICAgIGlmICghY20ub3B0aW9ucy5saW5lTnVtYmVycykgeyByZXR1cm4gZmFsc2UgfQ0KICAgIHZhciBkb2MgPSBjbS5kb2MsIGxhc3QgPSBsaW5lTnVtYmVyRm9yKGNtLm9wdGlvbnMsIGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSksIGRpc3BsYXkgPSBjbS5kaXNwbGF5Ow0KICAgIGlmIChsYXN0Lmxlbmd0aCAhPSBkaXNwbGF5LmxpbmVOdW1DaGFycykgew0KICAgICAgdmFyIHRlc3QgPSBkaXNwbGF5Lm1lYXN1cmUuYXBwZW5kQ2hpbGQoZWx0KCJkaXYiLCBbZWx0KCJkaXYiLCBsYXN0KV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIkNvZGVNaXJyb3ItbGluZW51bWJlciBDb2RlTWlycm9yLWd1dHRlci1lbHQiKSk7DQogICAgICB2YXIgaW5uZXJXID0gdGVzdC5maXJzdENoaWxkLm9mZnNldFdpZHRoLCBwYWRkaW5nID0gdGVzdC5vZmZzZXRXaWR0aCAtIGlubmVyVzsNCiAgICAgIGRpc3BsYXkubGluZUd1dHRlci5zdHlsZS53aWR0aCA9ICIiOw0KICAgICAgZGlzcGxheS5saW5lTnVtSW5uZXJXaWR0aCA9IE1hdGgubWF4KGlubmVyVywgZGlzcGxheS5saW5lR3V0dGVyLm9mZnNldFdpZHRoIC0gcGFkZGluZykgKyAxOw0KICAgICAgZGlzcGxheS5saW5lTnVtV2lkdGggPSBkaXNwbGF5LmxpbmVOdW1Jbm5lcldpZHRoICsgcGFkZGluZzsNCiAgICAgIGRpc3BsYXkubGluZU51bUNoYXJzID0gZGlzcGxheS5saW5lTnVtSW5uZXJXaWR0aCA/IGxhc3QubGVuZ3RoIDogLTE7DQogICAgICBkaXNwbGF5LmxpbmVHdXR0ZXIuc3R5bGUud2lkdGggPSBkaXNwbGF5LmxpbmVOdW1XaWR0aCArICJweCI7DQogICAgICB1cGRhdGVHdXR0ZXJTcGFjZShjbS5kaXNwbGF5KTsNCiAgICAgIHJldHVybiB0cnVlDQogICAgfQ0KICAgIHJldHVybiBmYWxzZQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0R3V0dGVycyhndXR0ZXJzLCBsaW5lTnVtYmVycykgew0KICAgIHZhciByZXN1bHQgPSBbXSwgc2F3TGluZU51bWJlcnMgPSBmYWxzZTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGd1dHRlcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBuYW1lID0gZ3V0dGVyc1tpXSwgc3R5bGUgPSBudWxsOw0KICAgICAgaWYgKHR5cGVvZiBuYW1lICE9ICJzdHJpbmciKSB7IHN0eWxlID0gbmFtZS5zdHlsZTsgbmFtZSA9IG5hbWUuY2xhc3NOYW1lOyB9DQogICAgICBpZiAobmFtZSA9PSAiQ29kZU1pcnJvci1saW5lbnVtYmVycyIpIHsNCiAgICAgICAgaWYgKCFsaW5lTnVtYmVycykgeyBjb250aW51ZSB9DQogICAgICAgIGVsc2UgeyBzYXdMaW5lTnVtYmVycyA9IHRydWU7IH0NCiAgICAgIH0NCiAgICAgIHJlc3VsdC5wdXNoKHtjbGFzc05hbWU6IG5hbWUsIHN0eWxlOiBzdHlsZX0pOw0KICAgIH0NCiAgICBpZiAobGluZU51bWJlcnMgJiYgIXNhd0xpbmVOdW1iZXJzKSB7IHJlc3VsdC5wdXNoKHtjbGFzc05hbWU6ICJDb2RlTWlycm9yLWxpbmVudW1iZXJzIiwgc3R5bGU6IG51bGx9KTsgfQ0KICAgIHJldHVybiByZXN1bHQNCiAgfQ0KDQogIC8vIFJlYnVpbGQgdGhlIGd1dHRlciBlbGVtZW50cywgZW5zdXJlIHRoZSBtYXJnaW4gdG8gdGhlIGxlZnQgb2YgdGhlDQogIC8vIGNvZGUgbWF0Y2hlcyB0aGVpciB3aWR0aC4NCiAgZnVuY3Rpb24gcmVuZGVyR3V0dGVycyhkaXNwbGF5KSB7DQogICAgdmFyIGd1dHRlcnMgPSBkaXNwbGF5Lmd1dHRlcnMsIHNwZWNzID0gZGlzcGxheS5ndXR0ZXJTcGVjczsNCiAgICByZW1vdmVDaGlsZHJlbihndXR0ZXJzKTsNCiAgICBkaXNwbGF5LmxpbmVHdXR0ZXIgPSBudWxsOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3BlY3MubGVuZ3RoOyArK2kpIHsNCiAgICAgIHZhciByZWYgPSBzcGVjc1tpXTsNCiAgICAgIHZhciBjbGFzc05hbWUgPSByZWYuY2xhc3NOYW1lOw0KICAgICAgdmFyIHN0eWxlID0gcmVmLnN0eWxlOw0KICAgICAgdmFyIGdFbHQgPSBndXR0ZXJzLmFwcGVuZENoaWxkKGVsdCgiZGl2IiwgbnVsbCwgIkNvZGVNaXJyb3ItZ3V0dGVyICIgKyBjbGFzc05hbWUpKTsNCiAgICAgIGlmIChzdHlsZSkgeyBnRWx0LnN0eWxlLmNzc1RleHQgPSBzdHlsZTsgfQ0KICAgICAgaWYgKGNsYXNzTmFtZSA9PSAiQ29kZU1pcnJvci1saW5lbnVtYmVycyIpIHsNCiAgICAgICAgZGlzcGxheS5saW5lR3V0dGVyID0gZ0VsdDsNCiAgICAgICAgZ0VsdC5zdHlsZS53aWR0aCA9IChkaXNwbGF5LmxpbmVOdW1XaWR0aCB8fCAxKSArICJweCI7DQogICAgICB9DQogICAgfQ0KICAgIGd1dHRlcnMuc3R5bGUuZGlzcGxheSA9IHNwZWNzLmxlbmd0aCA/ICIiIDogIm5vbmUiOw0KICAgIHVwZGF0ZUd1dHRlclNwYWNlKGRpc3BsYXkpOw0KICB9DQoNCiAgZnVuY3Rpb24gdXBkYXRlR3V0dGVycyhjbSkgew0KICAgIHJlbmRlckd1dHRlcnMoY20uZGlzcGxheSk7DQogICAgcmVnQ2hhbmdlKGNtKTsNCiAgICBhbGlnbkhvcml6b250YWxseShjbSk7DQogIH0NCg0KICAvLyBUaGUgZGlzcGxheSBoYW5kbGVzIHRoZSBET00gaW50ZWdyYXRpb24sIGJvdGggZm9yIGlucHV0IHJlYWRpbmcNCiAgLy8gYW5kIGNvbnRlbnQgZHJhd2luZy4gSXQgaG9sZHMgcmVmZXJlbmNlcyB0byBET00gbm9kZXMgYW5kDQogIC8vIGRpc3BsYXktcmVsYXRlZCBzdGF0ZS4NCg0KICBmdW5jdGlvbiBEaXNwbGF5KHBsYWNlLCBkb2MsIGlucHV0LCBvcHRpb25zKSB7DQogICAgdmFyIGQgPSB0aGlzOw0KICAgIHRoaXMuaW5wdXQgPSBpbnB1dDsNCg0KICAgIC8vIENvdmVycyBib3R0b20tcmlnaHQgc3F1YXJlIHdoZW4gYm90aCBzY3JvbGxiYXJzIGFyZSBwcmVzZW50Lg0KICAgIGQuc2Nyb2xsYmFyRmlsbGVyID0gZWx0KCJkaXYiLCBudWxsLCAiQ29kZU1pcnJvci1zY3JvbGxiYXItZmlsbGVyIik7DQogICAgZC5zY3JvbGxiYXJGaWxsZXIuc2V0QXR0cmlidXRlKCJjbS1ub3QtY29udGVudCIsICJ0cnVlIik7DQogICAgLy8gQ292ZXJzIGJvdHRvbSBvZiBndXR0ZXIgd2hlbiBjb3Zlckd1dHRlck5leHRUb1Njcm9sbGJhciBpcyBvbg0KICAgIC8vIGFuZCBoIHNjcm9sbGJhciBpcyBwcmVzZW50Lg0KICAgIGQuZ3V0dGVyRmlsbGVyID0gZWx0KCJkaXYiLCBudWxsLCAiQ29kZU1pcnJvci1ndXR0ZXItZmlsbGVyIik7DQogICAgZC5ndXR0ZXJGaWxsZXIuc2V0QXR0cmlidXRlKCJjbS1ub3QtY29udGVudCIsICJ0cnVlIik7DQogICAgLy8gV2lsbCBjb250YWluIHRoZSBhY3R1YWwgY29kZSwgcG9zaXRpb25lZCB0byBjb3ZlciB0aGUgdmlld3BvcnQuDQogICAgZC5saW5lRGl2ID0gZWx0UCgiZGl2IiwgbnVsbCwgIkNvZGVNaXJyb3ItY29kZSIpOw0KICAgIC8vIEVsZW1lbnRzIGFyZSBhZGRlZCB0byB0aGVzZSB0byByZXByZXNlbnQgc2VsZWN0aW9uIGFuZCBjdXJzb3JzLg0KICAgIGQuc2VsZWN0aW9uRGl2ID0gZWx0KCJkaXYiLCBudWxsLCBudWxsLCAicG9zaXRpb246IHJlbGF0aXZlOyB6LWluZGV4OiAxIik7DQogICAgZC5jdXJzb3JEaXYgPSBlbHQoImRpdiIsIG51bGwsICJDb2RlTWlycm9yLWN1cnNvcnMiKTsNCiAgICAvLyBBIHZpc2liaWxpdHk6IGhpZGRlbiBlbGVtZW50IHVzZWQgdG8gZmluZCB0aGUgc2l6ZSBvZiB0aGluZ3MuDQogICAgZC5tZWFzdXJlID0gZWx0KCJkaXYiLCBudWxsLCAiQ29kZU1pcnJvci1tZWFzdXJlIik7DQogICAgLy8gV2hlbiBsaW5lcyBvdXRzaWRlIG9mIHRoZSB2aWV3cG9ydCBhcmUgbWVhc3VyZWQsIHRoZXkgYXJlIGRyYXduIGluIHRoaXMuDQogICAgZC5saW5lTWVhc3VyZSA9IGVsdCgiZGl2IiwgbnVsbCwgIkNvZGVNaXJyb3ItbWVhc3VyZSIpOw0KICAgIC8vIFdyYXBzIGV2ZXJ5dGhpbmcgdGhhdCBuZWVkcyB0byBleGlzdCBpbnNpZGUgdGhlIHZlcnRpY2FsbHktcGFkZGVkIGNvb3JkaW5hdGUgc3lzdGVtDQogICAgZC5saW5lU3BhY2UgPSBlbHRQKCJkaXYiLCBbZC5tZWFzdXJlLCBkLmxpbmVNZWFzdXJlLCBkLnNlbGVjdGlvbkRpdiwgZC5jdXJzb3JEaXYsIGQubGluZURpdl0sDQogICAgICAgICAgICAgICAgICAgICAgbnVsbCwgInBvc2l0aW9uOiByZWxhdGl2ZTsgb3V0bGluZTogbm9uZSIpOw0KICAgIHZhciBsaW5lcyA9IGVsdFAoImRpdiIsIFtkLmxpbmVTcGFjZV0sICJDb2RlTWlycm9yLWxpbmVzIik7DQogICAgLy8gTW92ZWQgYXJvdW5kIGl0cyBwYXJlbnQgdG8gY292ZXIgdmlzaWJsZSB2aWV3Lg0KICAgIGQubW92ZXIgPSBlbHQoImRpdiIsIFtsaW5lc10sIG51bGwsICJwb3NpdGlvbjogcmVsYXRpdmUiKTsNCiAgICAvLyBTZXQgdG8gdGhlIGhlaWdodCBvZiB0aGUgZG9jdW1lbnQsIGFsbG93aW5nIHNjcm9sbGluZy4NCiAgICBkLnNpemVyID0gZWx0KCJkaXYiLCBbZC5tb3Zlcl0sICJDb2RlTWlycm9yLXNpemVyIik7DQogICAgZC5zaXplcldpZHRoID0gbnVsbDsNCiAgICAvLyBCZWhhdmlvciBvZiBlbHRzIHdpdGggb3ZlcmZsb3c6IGF1dG8gYW5kIHBhZGRpbmcgaXMNCiAgICAvLyBpbmNvbnNpc3RlbnQgYWNyb3NzIGJyb3dzZXJzLiBUaGlzIGlzIHVzZWQgdG8gZW5zdXJlIHRoZQ0KICAgIC8vIHNjcm9sbGFibGUgYXJlYSBpcyBiaWcgZW5vdWdoLg0KICAgIGQuaGVpZ2h0Rm9yY2VyID0gZWx0KCJkaXYiLCBudWxsLCBudWxsLCAicG9zaXRpb246IGFic29sdXRlOyBoZWlnaHQ6ICIgKyBzY3JvbGxlckdhcCArICJweDsgd2lkdGg6IDFweDsiKTsNCiAgICAvLyBXaWxsIGNvbnRhaW4gdGhlIGd1dHRlcnMsIGlmIGFueS4NCiAgICBkLmd1dHRlcnMgPSBlbHQoImRpdiIsIG51bGwsICJDb2RlTWlycm9yLWd1dHRlcnMiKTsNCiAgICBkLmxpbmVHdXR0ZXIgPSBudWxsOw0KICAgIC8vIEFjdHVhbCBzY3JvbGxhYmxlIGVsZW1lbnQuDQogICAgZC5zY3JvbGxlciA9IGVsdCgiZGl2IiwgW2Quc2l6ZXIsIGQuaGVpZ2h0Rm9yY2VyLCBkLmd1dHRlcnNdLCAiQ29kZU1pcnJvci1zY3JvbGwiKTsNCiAgICBkLnNjcm9sbGVyLnNldEF0dHJpYnV0ZSgidGFiSW5kZXgiLCAiLTEiKTsNCiAgICAvLyBUaGUgZWxlbWVudCBpbiB3aGljaCB0aGUgZWRpdG9yIGxpdmVzLg0KICAgIGQud3JhcHBlciA9IGVsdCgiZGl2IiwgW2Quc2Nyb2xsYmFyRmlsbGVyLCBkLmd1dHRlckZpbGxlciwgZC5zY3JvbGxlcl0sICJDb2RlTWlycm9yIik7DQoNCiAgICAvLyBXb3JrIGFyb3VuZCBJRTcgei1pbmRleCBidWcgKG5vdCBwZXJmZWN0LCBoZW5jZSBJRTcgbm90IHJlYWxseSBiZWluZyBzdXBwb3J0ZWQpDQogICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCA4KSB7IGQuZ3V0dGVycy5zdHlsZS56SW5kZXggPSAtMTsgZC5zY3JvbGxlci5zdHlsZS5wYWRkaW5nUmlnaHQgPSAwOyB9DQogICAgaWYgKCF3ZWJraXQgJiYgIShnZWNrbyAmJiBtb2JpbGUpKSB7IGQuc2Nyb2xsZXIuZHJhZ2dhYmxlID0gdHJ1ZTsgfQ0KDQogICAgaWYgKHBsYWNlKSB7DQogICAgICBpZiAocGxhY2UuYXBwZW5kQ2hpbGQpIHsgcGxhY2UuYXBwZW5kQ2hpbGQoZC53cmFwcGVyKTsgfQ0KICAgICAgZWxzZSB7IHBsYWNlKGQud3JhcHBlcik7IH0NCiAgICB9DQoNCiAgICAvLyBDdXJyZW50IHJlbmRlcmVkIHJhbmdlIChtYXkgYmUgYmlnZ2VyIHRoYW4gdGhlIHZpZXcgd2luZG93KS4NCiAgICBkLnZpZXdGcm9tID0gZC52aWV3VG8gPSBkb2MuZmlyc3Q7DQogICAgZC5yZXBvcnRlZFZpZXdGcm9tID0gZC5yZXBvcnRlZFZpZXdUbyA9IGRvYy5maXJzdDsNCiAgICAvLyBJbmZvcm1hdGlvbiBhYm91dCB0aGUgcmVuZGVyZWQgbGluZXMuDQogICAgZC52aWV3ID0gW107DQogICAgZC5yZW5kZXJlZFZpZXcgPSBudWxsOw0KICAgIC8vIEhvbGRzIGluZm8gYWJvdXQgYSBzaW5nbGUgcmVuZGVyZWQgbGluZSB3aGVuIGl0IHdhcyByZW5kZXJlZA0KICAgIC8vIGZvciBtZWFzdXJlbWVudCwgd2hpbGUgbm90IGluIHZpZXcuDQogICAgZC5leHRlcm5hbE1lYXN1cmVkID0gbnVsbDsNCiAgICAvLyBFbXB0eSBzcGFjZSAoaW4gcGl4ZWxzKSBhYm92ZSB0aGUgdmlldw0KICAgIGQudmlld09mZnNldCA9IDA7DQogICAgZC5sYXN0V3JhcEhlaWdodCA9IGQubGFzdFdyYXBXaWR0aCA9IDA7DQogICAgZC51cGRhdGVMaW5lTnVtYmVycyA9IG51bGw7DQoNCiAgICBkLm5hdGl2ZUJhcldpZHRoID0gZC5iYXJIZWlnaHQgPSBkLmJhcldpZHRoID0gMDsNCiAgICBkLnNjcm9sbGJhcnNDbGlwcGVkID0gZmFsc2U7DQoNCiAgICAvLyBVc2VkIHRvIG9ubHkgcmVzaXplIHRoZSBsaW5lIG51bWJlciBndXR0ZXIgd2hlbiBuZWNlc3NhcnkgKHdoZW4NCiAgICAvLyB0aGUgYW1vdW50IG9mIGxpbmVzIGNyb3NzZXMgYSBib3VuZGFyeSB0aGF0IG1ha2VzIGl0cyB3aWR0aCBjaGFuZ2UpDQogICAgZC5saW5lTnVtV2lkdGggPSBkLmxpbmVOdW1Jbm5lcldpZHRoID0gZC5saW5lTnVtQ2hhcnMgPSBudWxsOw0KICAgIC8vIFNldCB0byB0cnVlIHdoZW4gYSBub24taG9yaXpvbnRhbC1zY3JvbGxpbmcgbGluZSB3aWRnZXQgaXMNCiAgICAvLyBhZGRlZC4gQXMgYW4gb3B0aW1pemF0aW9uLCBsaW5lIHdpZGdldCBhbGlnbmluZyBpcyBza2lwcGVkIHdoZW4NCiAgICAvLyB0aGlzIGlzIGZhbHNlLg0KICAgIGQuYWxpZ25XaWRnZXRzID0gZmFsc2U7DQoNCiAgICBkLmNhY2hlZENoYXJXaWR0aCA9IGQuY2FjaGVkVGV4dEhlaWdodCA9IGQuY2FjaGVkUGFkZGluZ0ggPSBudWxsOw0KDQogICAgLy8gVHJhY2tzIHRoZSBtYXhpbXVtIGxpbmUgbGVuZ3RoIHNvIHRoYXQgdGhlIGhvcml6b250YWwgc2Nyb2xsYmFyDQogICAgLy8gY2FuIGJlIGtlcHQgc3RhdGljIHdoZW4gc2Nyb2xsaW5nLg0KICAgIGQubWF4TGluZSA9IG51bGw7DQogICAgZC5tYXhMaW5lTGVuZ3RoID0gMDsNCiAgICBkLm1heExpbmVDaGFuZ2VkID0gZmFsc2U7DQoNCiAgICAvLyBVc2VkIGZvciBtZWFzdXJpbmcgd2hlZWwgc2Nyb2xsaW5nIGdyYW51bGFyaXR5DQogICAgZC53aGVlbERYID0gZC53aGVlbERZID0gZC53aGVlbFN0YXJ0WCA9IGQud2hlZWxTdGFydFkgPSBudWxsOw0KDQogICAgLy8gVHJ1ZSB3aGVuIHNoaWZ0IGlzIGhlbGQgZG93bi4NCiAgICBkLnNoaWZ0ID0gZmFsc2U7DQoNCiAgICAvLyBVc2VkIHRvIHRyYWNrIHdoZXRoZXIgYW55dGhpbmcgaGFwcGVuZWQgc2luY2UgdGhlIGNvbnRleHQgbWVudQ0KICAgIC8vIHdhcyBvcGVuZWQuDQogICAgZC5zZWxGb3JDb250ZXh0TWVudSA9IG51bGw7DQoNCiAgICBkLmFjdGl2ZVRvdWNoID0gbnVsbDsNCg0KICAgIGQuZ3V0dGVyU3BlY3MgPSBnZXRHdXR0ZXJzKG9wdGlvbnMuZ3V0dGVycywgb3B0aW9ucy5saW5lTnVtYmVycyk7DQogICAgcmVuZGVyR3V0dGVycyhkKTsNCg0KICAgIGlucHV0LmluaXQoZCk7DQogIH0NCg0KICAvLyBTaW5jZSB0aGUgZGVsdGEgdmFsdWVzIHJlcG9ydGVkIG9uIG1vdXNlIHdoZWVsIGV2ZW50cyBhcmUNCiAgLy8gdW5zdGFuZGFyZGl6ZWQgYmV0d2VlbiBicm93c2VycyBhbmQgZXZlbiBicm93c2VyIHZlcnNpb25zLCBhbmQNCiAgLy8gZ2VuZXJhbGx5IGhvcnJpYmx5IHVucHJlZGljdGFibGUsIHRoaXMgY29kZSBzdGFydHMgYnkgbWVhc3VyaW5nDQogIC8vIHRoZSBzY3JvbGwgZWZmZWN0IHRoYXQgdGhlIGZpcnN0IGZldyBtb3VzZSB3aGVlbCBldmVudHMgaGF2ZSwNCiAgLy8gYW5kLCBmcm9tIHRoYXQsIGRldGVjdHMgdGhlIHdheSBpdCBjYW4gY29udmVydCBkZWx0YXMgdG8gcGl4ZWwNCiAgLy8gb2Zmc2V0cyBhZnRlcndhcmRzLg0KICAvLw0KICAvLyBUaGUgcmVhc29uIHdlIHdhbnQgdG8ga25vdyB0aGUgYW1vdW50IGEgd2hlZWwgZXZlbnQgd2lsbCBzY3JvbGwNCiAgLy8gaXMgdGhhdCBpdCBnaXZlcyB1cyBhIGNoYW5jZSB0byB1cGRhdGUgdGhlIGRpc3BsYXkgYmVmb3JlIHRoZQ0KICAvLyBhY3R1YWwgc2Nyb2xsaW5nIGhhcHBlbnMsIHJlZHVjaW5nIGZsaWNrZXJpbmcuDQoNCiAgdmFyIHdoZWVsU2FtcGxlcyA9IDAsIHdoZWVsUGl4ZWxzUGVyVW5pdCA9IG51bGw7DQogIC8vIEZpbGwgaW4gYSBicm93c2VyLWRldGVjdGVkIHN0YXJ0aW5nIHZhbHVlIG9uIGJyb3dzZXJzIHdoZXJlIHdlDQogIC8vIGtub3cgb25lLiBUaGVzZSBkb24ndCBoYXZlIHRvIGJlIGFjY3VyYXRlIC0tIHRoZSByZXN1bHQgb2YgdGhlbQ0KICAvLyBiZWluZyB3cm9uZyB3b3VsZCBqdXN0IGJlIGEgc2xpZ2h0IGZsaWNrZXIgb24gdGhlIGZpcnN0IHdoZWVsDQogIC8vIHNjcm9sbCAoaWYgaXQgaXMgbGFyZ2UgZW5vdWdoKS4NCiAgaWYgKGllKSB7IHdoZWVsUGl4ZWxzUGVyVW5pdCA9IC0uNTM7IH0NCiAgZWxzZSBpZiAoZ2Vja28pIHsgd2hlZWxQaXhlbHNQZXJVbml0ID0gMTU7IH0NCiAgZWxzZSBpZiAoY2hyb21lKSB7IHdoZWVsUGl4ZWxzUGVyVW5pdCA9IC0uNzsgfQ0KICBlbHNlIGlmIChzYWZhcmkpIHsgd2hlZWxQaXhlbHNQZXJVbml0ID0gLTEvMzsgfQ0KDQogIGZ1bmN0aW9uIHdoZWVsRXZlbnREZWx0YShlKSB7DQogICAgdmFyIGR4ID0gZS53aGVlbERlbHRhWCwgZHkgPSBlLndoZWVsRGVsdGFZOw0KICAgIGlmIChkeCA9PSBudWxsICYmIGUuZGV0YWlsICYmIGUuYXhpcyA9PSBlLkhPUklaT05UQUxfQVhJUykgeyBkeCA9IGUuZGV0YWlsOyB9DQogICAgaWYgKGR5ID09IG51bGwgJiYgZS5kZXRhaWwgJiYgZS5heGlzID09IGUuVkVSVElDQUxfQVhJUykgeyBkeSA9IGUuZGV0YWlsOyB9DQogICAgZWxzZSBpZiAoZHkgPT0gbnVsbCkgeyBkeSA9IGUud2hlZWxEZWx0YTsgfQ0KICAgIHJldHVybiB7eDogZHgsIHk6IGR5fQ0KICB9DQogIGZ1bmN0aW9uIHdoZWVsRXZlbnRQaXhlbHMoZSkgew0KICAgIHZhciBkZWx0YSA9IHdoZWVsRXZlbnREZWx0YShlKTsNCiAgICBkZWx0YS54ICo9IHdoZWVsUGl4ZWxzUGVyVW5pdDsNCiAgICBkZWx0YS55ICo9IHdoZWVsUGl4ZWxzUGVyVW5pdDsNCiAgICByZXR1cm4gZGVsdGENCiAgfQ0KDQogIGZ1bmN0aW9uIG9uU2Nyb2xsV2hlZWwoY20sIGUpIHsNCiAgICB2YXIgZGVsdGEgPSB3aGVlbEV2ZW50RGVsdGEoZSksIGR4ID0gZGVsdGEueCwgZHkgPSBkZWx0YS55Ow0KDQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBzY3JvbGwgPSBkaXNwbGF5LnNjcm9sbGVyOw0KICAgIC8vIFF1aXQgaWYgdGhlcmUncyBub3RoaW5nIHRvIHNjcm9sbCBoZXJlDQogICAgdmFyIGNhblNjcm9sbFggPSBzY3JvbGwuc2Nyb2xsV2lkdGggPiBzY3JvbGwuY2xpZW50V2lkdGg7DQogICAgdmFyIGNhblNjcm9sbFkgPSBzY3JvbGwuc2Nyb2xsSGVpZ2h0ID4gc2Nyb2xsLmNsaWVudEhlaWdodDsNCiAgICBpZiAoIShkeCAmJiBjYW5TY3JvbGxYIHx8IGR5ICYmIGNhblNjcm9sbFkpKSB7IHJldHVybiB9DQoNCiAgICAvLyBXZWJraXQgYnJvd3NlcnMgb24gT1MgWCBhYm9ydCBtb21lbnR1bSBzY3JvbGxzIHdoZW4gdGhlIHRhcmdldA0KICAgIC8vIG9mIHRoZSBzY3JvbGwgZXZlbnQgaXMgcmVtb3ZlZCBmcm9tIHRoZSBzY3JvbGxhYmxlIGVsZW1lbnQuDQogICAgLy8gVGhpcyBoYWNrIChzZWUgcmVsYXRlZCBjb2RlIGluIHBhdGNoRGlzcGxheSkgbWFrZXMgc3VyZSB0aGUNCiAgICAvLyBlbGVtZW50IGlzIGtlcHQgYXJvdW5kLg0KICAgIGlmIChkeSAmJiBtYWMgJiYgd2Via2l0KSB7DQogICAgICBvdXRlcjogZm9yICh2YXIgY3VyID0gZS50YXJnZXQsIHZpZXcgPSBkaXNwbGF5LnZpZXc7IGN1ciAhPSBzY3JvbGw7IGN1ciA9IGN1ci5wYXJlbnROb2RlKSB7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmlldy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgIGlmICh2aWV3W2ldLm5vZGUgPT0gY3VyKSB7DQogICAgICAgICAgICBjbS5kaXNwbGF5LmN1cnJlbnRXaGVlbFRhcmdldCA9IGN1cjsNCiAgICAgICAgICAgIGJyZWFrIG91dGVyDQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICB9DQogICAgfQ0KDQogICAgLy8gT24gc29tZSBicm93c2VycywgaG9yaXpvbnRhbCBzY3JvbGxpbmcgd2lsbCBjYXVzZSByZWRyYXdzIHRvDQogICAgLy8gaGFwcGVuIGJlZm9yZSB0aGUgZ3V0dGVyIGhhcyBiZWVuIHJlYWxpZ25lZCwgY2F1c2luZyBpdCB0bw0KICAgIC8vIHdyaWdnbGUgYXJvdW5kIGluIGEgbW9zdCB1bnNlZW1seSB3YXkuIFdoZW4gd2UgaGF2ZSBhbg0KICAgIC8vIGVzdGltYXRlZCBwaXhlbHMvZGVsdGEgdmFsdWUsIHdlIGp1c3QgaGFuZGxlIGhvcml6b250YWwNCiAgICAvLyBzY3JvbGxpbmcgZW50aXJlbHkgaGVyZS4gSXQnbGwgYmUgc2xpZ2h0bHkgb2ZmIGZyb20gbmF0aXZlLCBidXQNCiAgICAvLyBiZXR0ZXIgdGhhbiBnbGl0Y2hpbmcgb3V0Lg0KICAgIGlmIChkeCAmJiAhZ2Vja28gJiYgIXByZXN0byAmJiB3aGVlbFBpeGVsc1BlclVuaXQgIT0gbnVsbCkgew0KICAgICAgaWYgKGR5ICYmIGNhblNjcm9sbFkpDQogICAgICAgIHsgdXBkYXRlU2Nyb2xsVG9wKGNtLCBNYXRoLm1heCgwLCBzY3JvbGwuc2Nyb2xsVG9wICsgZHkgKiB3aGVlbFBpeGVsc1BlclVuaXQpKTsgfQ0KICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgTWF0aC5tYXgoMCwgc2Nyb2xsLnNjcm9sbExlZnQgKyBkeCAqIHdoZWVsUGl4ZWxzUGVyVW5pdCkpOw0KICAgICAgLy8gT25seSBwcmV2ZW50IGRlZmF1bHQgc2Nyb2xsaW5nIGlmIHZlcnRpY2FsIHNjcm9sbGluZyBpcw0KICAgICAgLy8gYWN0dWFsbHkgcG9zc2libGUuIE90aGVyd2lzZSwgaXQgY2F1c2VzIHZlcnRpY2FsIHNjcm9sbA0KICAgICAgLy8gaml0dGVyIG9uIE9TWCB0cmFja3BhZHMgd2hlbiBkZWx0YVggaXMgc21hbGwgYW5kIGRlbHRhWQ0KICAgICAgLy8gaXMgbGFyZ2UgKGlzc3VlICMzNTc5KQ0KICAgICAgaWYgKCFkeSB8fCAoZHkgJiYgY2FuU2Nyb2xsWSkpDQogICAgICAgIHsgZV9wcmV2ZW50RGVmYXVsdChlKTsgfQ0KICAgICAgZGlzcGxheS53aGVlbFN0YXJ0WCA9IG51bGw7IC8vIEFib3J0IG1lYXN1cmVtZW50LCBpZiBpbiBwcm9ncmVzcw0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgLy8gJ1Byb2plY3QnIHRoZSB2aXNpYmxlIHZpZXdwb3J0IHRvIGNvdmVyIHRoZSBhcmVhIHRoYXQgaXMgYmVpbmcNCiAgICAvLyBzY3JvbGxlZCBpbnRvIHZpZXcgKGlmIHdlIGtub3cgZW5vdWdoIHRvIGVzdGltYXRlIGl0KS4NCiAgICBpZiAoZHkgJiYgd2hlZWxQaXhlbHNQZXJVbml0ICE9IG51bGwpIHsNCiAgICAgIHZhciBwaXhlbHMgPSBkeSAqIHdoZWVsUGl4ZWxzUGVyVW5pdDsNCiAgICAgIHZhciB0b3AgPSBjbS5kb2Muc2Nyb2xsVG9wLCBib3QgPSB0b3AgKyBkaXNwbGF5LndyYXBwZXIuY2xpZW50SGVpZ2h0Ow0KICAgICAgaWYgKHBpeGVscyA8IDApIHsgdG9wID0gTWF0aC5tYXgoMCwgdG9wICsgcGl4ZWxzIC0gNTApOyB9DQogICAgICBlbHNlIHsgYm90ID0gTWF0aC5taW4oY20uZG9jLmhlaWdodCwgYm90ICsgcGl4ZWxzICsgNTApOyB9DQogICAgICB1cGRhdGVEaXNwbGF5U2ltcGxlKGNtLCB7dG9wOiB0b3AsIGJvdHRvbTogYm90fSk7DQogICAgfQ0KDQogICAgaWYgKHdoZWVsU2FtcGxlcyA8IDIwKSB7DQogICAgICBpZiAoZGlzcGxheS53aGVlbFN0YXJ0WCA9PSBudWxsKSB7DQogICAgICAgIGRpc3BsYXkud2hlZWxTdGFydFggPSBzY3JvbGwuc2Nyb2xsTGVmdDsgZGlzcGxheS53aGVlbFN0YXJ0WSA9IHNjcm9sbC5zY3JvbGxUb3A7DQogICAgICAgIGRpc3BsYXkud2hlZWxEWCA9IGR4OyBkaXNwbGF5LndoZWVsRFkgPSBkeTsNCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgICAgaWYgKGRpc3BsYXkud2hlZWxTdGFydFggPT0gbnVsbCkgeyByZXR1cm4gfQ0KICAgICAgICAgIHZhciBtb3ZlZFggPSBzY3JvbGwuc2Nyb2xsTGVmdCAtIGRpc3BsYXkud2hlZWxTdGFydFg7DQogICAgICAgICAgdmFyIG1vdmVkWSA9IHNjcm9sbC5zY3JvbGxUb3AgLSBkaXNwbGF5LndoZWVsU3RhcnRZOw0KICAgICAgICAgIHZhciBzYW1wbGUgPSAobW92ZWRZICYmIGRpc3BsYXkud2hlZWxEWSAmJiBtb3ZlZFkgLyBkaXNwbGF5LndoZWVsRFkpIHx8DQogICAgICAgICAgICAobW92ZWRYICYmIGRpc3BsYXkud2hlZWxEWCAmJiBtb3ZlZFggLyBkaXNwbGF5LndoZWVsRFgpOw0KICAgICAgICAgIGRpc3BsYXkud2hlZWxTdGFydFggPSBkaXNwbGF5LndoZWVsU3RhcnRZID0gbnVsbDsNCiAgICAgICAgICBpZiAoIXNhbXBsZSkgeyByZXR1cm4gfQ0KICAgICAgICAgIHdoZWVsUGl4ZWxzUGVyVW5pdCA9ICh3aGVlbFBpeGVsc1BlclVuaXQgKiB3aGVlbFNhbXBsZXMgKyBzYW1wbGUpIC8gKHdoZWVsU2FtcGxlcyArIDEpOw0KICAgICAgICAgICsrd2hlZWxTYW1wbGVzOw0KICAgICAgICB9LCAyMDApOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgZGlzcGxheS53aGVlbERYICs9IGR4OyBkaXNwbGF5LndoZWVsRFkgKz0gZHk7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLy8gU2VsZWN0aW9uIG9iamVjdHMgYXJlIGltbXV0YWJsZS4gQSBuZXcgb25lIGlzIGNyZWF0ZWQgZXZlcnkgdGltZQ0KICAvLyB0aGUgc2VsZWN0aW9uIGNoYW5nZXMuIEEgc2VsZWN0aW9uIGlzIG9uZSBvciBtb3JlIG5vbi1vdmVybGFwcGluZw0KICAvLyAoYW5kIG5vbi10b3VjaGluZykgcmFuZ2VzLCBzb3J0ZWQsIGFuZCBhbiBpbnRlZ2VyIHRoYXQgaW5kaWNhdGVzDQogIC8vIHdoaWNoIG9uZSBpcyB0aGUgcHJpbWFyeSBzZWxlY3Rpb24gKHRoZSBvbmUgdGhhdCdzIHNjcm9sbGVkIGludG8NCiAgLy8gdmlldywgdGhhdCBnZXRDdXJzb3IgcmV0dXJucywgZXRjKS4NCiAgdmFyIFNlbGVjdGlvbiA9IGZ1bmN0aW9uKHJhbmdlcywgcHJpbUluZGV4KSB7DQogICAgdGhpcy5yYW5nZXMgPSByYW5nZXM7DQogICAgdGhpcy5wcmltSW5kZXggPSBwcmltSW5kZXg7DQogIH07DQoNCiAgU2VsZWN0aW9uLnByb3RvdHlwZS5wcmltYXJ5ID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy5yYW5nZXNbdGhpcy5wcmltSW5kZXhdIH07DQoNCiAgU2VsZWN0aW9uLnByb3RvdHlwZS5lcXVhbHMgPSBmdW5jdGlvbiAob3RoZXIpIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgaWYgKG90aGVyID09IHRoaXMpIHsgcmV0dXJuIHRydWUgfQ0KICAgIGlmIChvdGhlci5wcmltSW5kZXggIT0gdGhpcy5wcmltSW5kZXggfHwgb3RoZXIucmFuZ2VzLmxlbmd0aCAhPSB0aGlzLnJhbmdlcy5sZW5ndGgpIHsgcmV0dXJuIGZhbHNlIH0NCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmFuZ2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgaGVyZSA9IHRoaXMkMS5yYW5nZXNbaV0sIHRoZXJlID0gb3RoZXIucmFuZ2VzW2ldOw0KICAgICAgaWYgKCFlcXVhbEN1cnNvclBvcyhoZXJlLmFuY2hvciwgdGhlcmUuYW5jaG9yKSB8fCAhZXF1YWxDdXJzb3JQb3MoaGVyZS5oZWFkLCB0aGVyZS5oZWFkKSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIH0NCiAgICByZXR1cm4gdHJ1ZQ0KICB9Ow0KDQogIFNlbGVjdGlvbi5wcm90b3R5cGUuZGVlcENvcHkgPSBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIHZhciBvdXQgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMucmFuZ2VzLmxlbmd0aDsgaSsrKQ0KICAgICAgeyBvdXRbaV0gPSBuZXcgUmFuZ2UoY29weVBvcyh0aGlzJDEucmFuZ2VzW2ldLmFuY2hvciksIGNvcHlQb3ModGhpcyQxLnJhbmdlc1tpXS5oZWFkKSk7IH0NCiAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihvdXQsIHRoaXMucHJpbUluZGV4KQ0KICB9Ow0KDQogIFNlbGVjdGlvbi5wcm90b3R5cGUuc29tZXRoaW5nU2VsZWN0ZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5yYW5nZXMubGVuZ3RoOyBpKyspDQogICAgICB7IGlmICghdGhpcyQxLnJhbmdlc1tpXS5lbXB0eSgpKSB7IHJldHVybiB0cnVlIH0gfQ0KICAgIHJldHVybiBmYWxzZQ0KICB9Ow0KDQogIFNlbGVjdGlvbi5wcm90b3R5cGUuY29udGFpbnMgPSBmdW5jdGlvbiAocG9zLCBlbmQpIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgaWYgKCFlbmQpIHsgZW5kID0gcG9zOyB9DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnJhbmdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIHJhbmdlID0gdGhpcyQxLnJhbmdlc1tpXTsNCiAgICAgIGlmIChjbXAoZW5kLCByYW5nZS5mcm9tKCkpID49IDAgJiYgY21wKHBvcywgcmFuZ2UudG8oKSkgPD0gMCkNCiAgICAgICAgeyByZXR1cm4gaSB9DQogICAgfQ0KICAgIHJldHVybiAtMQ0KICB9Ow0KDQogIHZhciBSYW5nZSA9IGZ1bmN0aW9uKGFuY2hvciwgaGVhZCkgew0KICAgIHRoaXMuYW5jaG9yID0gYW5jaG9yOyB0aGlzLmhlYWQgPSBoZWFkOw0KICB9Ow0KDQogIFJhbmdlLnByb3RvdHlwZS5mcm9tID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gbWluUG9zKHRoaXMuYW5jaG9yLCB0aGlzLmhlYWQpIH07DQogIFJhbmdlLnByb3RvdHlwZS50byA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1heFBvcyh0aGlzLmFuY2hvciwgdGhpcy5oZWFkKSB9Ow0KICBSYW5nZS5wcm90b3R5cGUuZW1wdHkgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzLmhlYWQubGluZSA9PSB0aGlzLmFuY2hvci5saW5lICYmIHRoaXMuaGVhZC5jaCA9PSB0aGlzLmFuY2hvci5jaCB9Ow0KDQogIC8vIFRha2UgYW4gdW5zb3J0ZWQsIHBvdGVudGlhbGx5IG92ZXJsYXBwaW5nIHNldCBvZiByYW5nZXMsIGFuZA0KICAvLyBidWlsZCBhIHNlbGVjdGlvbiBvdXQgb2YgaXQuICdDb25zdW1lcycgcmFuZ2VzIGFycmF5IChtb2RpZnlpbmcNCiAgLy8gaXQpLg0KICBmdW5jdGlvbiBub3JtYWxpemVTZWxlY3Rpb24oY20sIHJhbmdlcywgcHJpbUluZGV4KSB7DQogICAgdmFyIG1heVRvdWNoID0gY20gJiYgY20ub3B0aW9ucy5zZWxlY3Rpb25zTWF5VG91Y2g7DQogICAgdmFyIHByaW0gPSByYW5nZXNbcHJpbUluZGV4XTsNCiAgICByYW5nZXMuc29ydChmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gY21wKGEuZnJvbSgpLCBiLmZyb20oKSk7IH0pOw0KICAgIHByaW1JbmRleCA9IGluZGV4T2YocmFuZ2VzLCBwcmltKTsNCiAgICBmb3IgKHZhciBpID0gMTsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIGN1ciA9IHJhbmdlc1tpXSwgcHJldiA9IHJhbmdlc1tpIC0gMV07DQogICAgICB2YXIgZGlmZiA9IGNtcChwcmV2LnRvKCksIGN1ci5mcm9tKCkpOw0KICAgICAgaWYgKG1heVRvdWNoICYmICFjdXIuZW1wdHkoKSA/IGRpZmYgPiAwIDogZGlmZiA+PSAwKSB7DQogICAgICAgIHZhciBmcm9tID0gbWluUG9zKHByZXYuZnJvbSgpLCBjdXIuZnJvbSgpKSwgdG8gPSBtYXhQb3MocHJldi50bygpLCBjdXIudG8oKSk7DQogICAgICAgIHZhciBpbnYgPSBwcmV2LmVtcHR5KCkgPyBjdXIuZnJvbSgpID09IGN1ci5oZWFkIDogcHJldi5mcm9tKCkgPT0gcHJldi5oZWFkOw0KICAgICAgICBpZiAoaSA8PSBwcmltSW5kZXgpIHsgLS1wcmltSW5kZXg7IH0NCiAgICAgICAgcmFuZ2VzLnNwbGljZSgtLWksIDIsIG5ldyBSYW5nZShpbnYgPyB0byA6IGZyb20sIGludiA/IGZyb20gOiB0bykpOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihyYW5nZXMsIHByaW1JbmRleCkNCiAgfQ0KDQogIGZ1bmN0aW9uIHNpbXBsZVNlbGVjdGlvbihhbmNob3IsIGhlYWQpIHsNCiAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihbbmV3IFJhbmdlKGFuY2hvciwgaGVhZCB8fCBhbmNob3IpXSwgMCkNCiAgfQ0KDQogIC8vIENvbXB1dGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBlbmQgb2YgYSBjaGFuZ2UgKGl0cyAndG8nIHByb3BlcnR5DQogIC8vIHJlZmVycyB0byB0aGUgcHJlLWNoYW5nZSBlbmQpLg0KICBmdW5jdGlvbiBjaGFuZ2VFbmQoY2hhbmdlKSB7DQogICAgaWYgKCFjaGFuZ2UudGV4dCkgeyByZXR1cm4gY2hhbmdlLnRvIH0NCiAgICByZXR1cm4gUG9zKGNoYW5nZS5mcm9tLmxpbmUgKyBjaGFuZ2UudGV4dC5sZW5ndGggLSAxLA0KICAgICAgICAgICAgICAgbHN0KGNoYW5nZS50ZXh0KS5sZW5ndGggKyAoY2hhbmdlLnRleHQubGVuZ3RoID09IDEgPyBjaGFuZ2UuZnJvbS5jaCA6IDApKQ0KICB9DQoNCiAgLy8gQWRqdXN0IGEgcG9zaXRpb24gdG8gcmVmZXIgdG8gdGhlIHBvc3QtY2hhbmdlIHBvc2l0aW9uIG9mIHRoZQ0KICAvLyBzYW1lIHRleHQsIG9yIHRoZSBlbmQgb2YgdGhlIGNoYW5nZSBpZiB0aGUgY2hhbmdlIGNvdmVycyBpdC4NCiAgZnVuY3Rpb24gYWRqdXN0Rm9yQ2hhbmdlKHBvcywgY2hhbmdlKSB7DQogICAgaWYgKGNtcChwb3MsIGNoYW5nZS5mcm9tKSA8IDApIHsgcmV0dXJuIHBvcyB9DQogICAgaWYgKGNtcChwb3MsIGNoYW5nZS50bykgPD0gMCkgeyByZXR1cm4gY2hhbmdlRW5kKGNoYW5nZSkgfQ0KDQogICAgdmFyIGxpbmUgPSBwb3MubGluZSArIGNoYW5nZS50ZXh0Lmxlbmd0aCAtIChjaGFuZ2UudG8ubGluZSAtIGNoYW5nZS5mcm9tLmxpbmUpIC0gMSwgY2ggPSBwb3MuY2g7DQogICAgaWYgKHBvcy5saW5lID09IGNoYW5nZS50by5saW5lKSB7IGNoICs9IGNoYW5nZUVuZChjaGFuZ2UpLmNoIC0gY2hhbmdlLnRvLmNoOyB9DQogICAgcmV0dXJuIFBvcyhsaW5lLCBjaCkNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSkgew0KICAgIHZhciBvdXQgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpXTsNCiAgICAgIG91dC5wdXNoKG5ldyBSYW5nZShhZGp1c3RGb3JDaGFuZ2UocmFuZ2UuYW5jaG9yLCBjaGFuZ2UpLA0KICAgICAgICAgICAgICAgICAgICAgICAgIGFkanVzdEZvckNoYW5nZShyYW5nZS5oZWFkLCBjaGFuZ2UpKSk7DQogICAgfQ0KICAgIHJldHVybiBub3JtYWxpemVTZWxlY3Rpb24oZG9jLmNtLCBvdXQsIGRvYy5zZWwucHJpbUluZGV4KQ0KICB9DQoNCiAgZnVuY3Rpb24gb2Zmc2V0UG9zKHBvcywgb2xkLCBudykgew0KICAgIGlmIChwb3MubGluZSA9PSBvbGQubGluZSkNCiAgICAgIHsgcmV0dXJuIFBvcyhudy5saW5lLCBwb3MuY2ggLSBvbGQuY2ggKyBudy5jaCkgfQ0KICAgIGVsc2UNCiAgICAgIHsgcmV0dXJuIFBvcyhudy5saW5lICsgKHBvcy5saW5lIC0gb2xkLmxpbmUpLCBwb3MuY2gpIH0NCiAgfQ0KDQogIC8vIFVzZWQgYnkgcmVwbGFjZVNlbGVjdGlvbnMgdG8gYWxsb3cgbW92aW5nIHRoZSBzZWxlY3Rpb24gdG8gdGhlDQogIC8vIHN0YXJ0IG9yIGFyb3VuZCB0aGUgcmVwbGFjZWQgdGVzdC4gSGludCBtYXkgYmUgInN0YXJ0IiBvciAiYXJvdW5kIi4NCiAgZnVuY3Rpb24gY29tcHV0ZVJlcGxhY2VkU2VsKGRvYywgY2hhbmdlcywgaGludCkgew0KICAgIHZhciBvdXQgPSBbXTsNCiAgICB2YXIgb2xkUHJldiA9IFBvcyhkb2MuZmlyc3QsIDApLCBuZXdQcmV2ID0gb2xkUHJldjsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYW5nZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBjaGFuZ2UgPSBjaGFuZ2VzW2ldOw0KICAgICAgdmFyIGZyb20gPSBvZmZzZXRQb3MoY2hhbmdlLmZyb20sIG9sZFByZXYsIG5ld1ByZXYpOw0KICAgICAgdmFyIHRvID0gb2Zmc2V0UG9zKGNoYW5nZUVuZChjaGFuZ2UpLCBvbGRQcmV2LCBuZXdQcmV2KTsNCiAgICAgIG9sZFByZXYgPSBjaGFuZ2UudG87DQogICAgICBuZXdQcmV2ID0gdG87DQogICAgICBpZiAoaGludCA9PSAiYXJvdW5kIikgew0KICAgICAgICB2YXIgcmFuZ2UgPSBkb2Muc2VsLnJhbmdlc1tpXSwgaW52ID0gY21wKHJhbmdlLmhlYWQsIHJhbmdlLmFuY2hvcikgPCAwOw0KICAgICAgICBvdXRbaV0gPSBuZXcgUmFuZ2UoaW52ID8gdG8gOiBmcm9tLCBpbnYgPyBmcm9tIDogdG8pOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgb3V0W2ldID0gbmV3IFJhbmdlKGZyb20sIGZyb20pOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3IFNlbGVjdGlvbihvdXQsIGRvYy5zZWwucHJpbUluZGV4KQ0KICB9DQoNCiAgLy8gVXNlZCB0byBnZXQgdGhlIGVkaXRvciBpbnRvIGEgY29uc2lzdGVudCBzdGF0ZSBhZ2FpbiB3aGVuIG9wdGlvbnMgY2hhbmdlLg0KDQogIGZ1bmN0aW9uIGxvYWRNb2RlKGNtKSB7DQogICAgY20uZG9jLm1vZGUgPSBnZXRNb2RlKGNtLm9wdGlvbnMsIGNtLmRvYy5tb2RlT3B0aW9uKTsNCiAgICByZXNldE1vZGVTdGF0ZShjbSk7DQogIH0NCg0KICBmdW5jdGlvbiByZXNldE1vZGVTdGF0ZShjbSkgew0KICAgIGNtLmRvYy5pdGVyKGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICBpZiAobGluZS5zdGF0ZUFmdGVyKSB7IGxpbmUuc3RhdGVBZnRlciA9IG51bGw7IH0NCiAgICAgIGlmIChsaW5lLnN0eWxlcykgeyBsaW5lLnN0eWxlcyA9IG51bGw7IH0NCiAgICB9KTsNCiAgICBjbS5kb2MubW9kZUZyb250aWVyID0gY20uZG9jLmhpZ2hsaWdodEZyb250aWVyID0gY20uZG9jLmZpcnN0Ow0KICAgIHN0YXJ0V29ya2VyKGNtLCAxMDApOw0KICAgIGNtLnN0YXRlLm1vZGVHZW4rKzsNCiAgICBpZiAoY20uY3VyT3ApIHsgcmVnQ2hhbmdlKGNtKTsgfQ0KICB9DQoNCiAgLy8gRE9DVU1FTlQgREFUQSBTVFJVQ1RVUkUNCg0KICAvLyBCeSBkZWZhdWx0LCB1cGRhdGVzIHRoYXQgc3RhcnQgYW5kIGVuZCBhdCB0aGUgYmVnaW5uaW5nIG9mIGEgbGluZQ0KICAvLyBhcmUgdHJlYXRlZCBzcGVjaWFsbHksIGluIG9yZGVyIHRvIG1ha2UgdGhlIGFzc29jaWF0aW9uIG9mIGxpbmUNCiAgLy8gd2lkZ2V0cyBhbmQgbWFya2VyIGVsZW1lbnRzIHdpdGggdGhlIHRleHQgYmVoYXZlIG1vcmUgaW50dWl0aXZlLg0KICBmdW5jdGlvbiBpc1dob2xlTGluZVVwZGF0ZShkb2MsIGNoYW5nZSkgew0KICAgIHJldHVybiBjaGFuZ2UuZnJvbS5jaCA9PSAwICYmIGNoYW5nZS50by5jaCA9PSAwICYmIGxzdChjaGFuZ2UudGV4dCkgPT0gIiIgJiYNCiAgICAgICghZG9jLmNtIHx8IGRvYy5jbS5vcHRpb25zLndob2xlTGluZVVwZGF0ZUJlZm9yZSkNCiAgfQ0KDQogIC8vIFBlcmZvcm0gYSBjaGFuZ2Ugb24gdGhlIGRvY3VtZW50IGRhdGEgc3RydWN0dXJlLg0KICBmdW5jdGlvbiB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIG1hcmtlZFNwYW5zLCBlc3RpbWF0ZUhlaWdodCQkMSkgew0KICAgIGZ1bmN0aW9uIHNwYW5zRm9yKG4pIHtyZXR1cm4gbWFya2VkU3BhbnMgPyBtYXJrZWRTcGFuc1tuXSA6IG51bGx9DQogICAgZnVuY3Rpb24gdXBkYXRlKGxpbmUsIHRleHQsIHNwYW5zKSB7DQogICAgICB1cGRhdGVMaW5lKGxpbmUsIHRleHQsIHNwYW5zLCBlc3RpbWF0ZUhlaWdodCQkMSk7DQogICAgICBzaWduYWxMYXRlcihsaW5lLCAiY2hhbmdlIiwgbGluZSwgY2hhbmdlKTsNCiAgICB9DQogICAgZnVuY3Rpb24gbGluZXNGb3Ioc3RhcnQsIGVuZCkgew0KICAgICAgdmFyIHJlc3VsdCA9IFtdOw0KICAgICAgZm9yICh2YXIgaSA9IHN0YXJ0OyBpIDwgZW5kOyArK2kpDQogICAgICAgIHsgcmVzdWx0LnB1c2gobmV3IExpbmUodGV4dFtpXSwgc3BhbnNGb3IoaSksIGVzdGltYXRlSGVpZ2h0JCQxKSk7IH0NCiAgICAgIHJldHVybiByZXN1bHQNCiAgICB9DQoNCiAgICB2YXIgZnJvbSA9IGNoYW5nZS5mcm9tLCB0byA9IGNoYW5nZS50bywgdGV4dCA9IGNoYW5nZS50ZXh0Ow0KICAgIHZhciBmaXJzdExpbmUgPSBnZXRMaW5lKGRvYywgZnJvbS5saW5lKSwgbGFzdExpbmUgPSBnZXRMaW5lKGRvYywgdG8ubGluZSk7DQogICAgdmFyIGxhc3RUZXh0ID0gbHN0KHRleHQpLCBsYXN0U3BhbnMgPSBzcGFuc0Zvcih0ZXh0Lmxlbmd0aCAtIDEpLCBubGluZXMgPSB0by5saW5lIC0gZnJvbS5saW5lOw0KDQogICAgLy8gQWRqdXN0IHRoZSBsaW5lIHN0cnVjdHVyZQ0KICAgIGlmIChjaGFuZ2UuZnVsbCkgew0KICAgICAgZG9jLmluc2VydCgwLCBsaW5lc0ZvcigwLCB0ZXh0Lmxlbmd0aCkpOw0KICAgICAgZG9jLnJlbW92ZSh0ZXh0Lmxlbmd0aCwgZG9jLnNpemUgLSB0ZXh0Lmxlbmd0aCk7DQogICAgfSBlbHNlIGlmIChpc1dob2xlTGluZVVwZGF0ZShkb2MsIGNoYW5nZSkpIHsNCiAgICAgIC8vIFRoaXMgaXMgYSB3aG9sZS1saW5lIHJlcGxhY2UuIFRyZWF0ZWQgc3BlY2lhbGx5IHRvIG1ha2UNCiAgICAgIC8vIHN1cmUgbGluZSBvYmplY3RzIG1vdmUgdGhlIHdheSB0aGV5IGFyZSBzdXBwb3NlZCB0by4NCiAgICAgIHZhciBhZGRlZCA9IGxpbmVzRm9yKDAsIHRleHQubGVuZ3RoIC0gMSk7DQogICAgICB1cGRhdGUobGFzdExpbmUsIGxhc3RMaW5lLnRleHQsIGxhc3RTcGFucyk7DQogICAgICBpZiAobmxpbmVzKSB7IGRvYy5yZW1vdmUoZnJvbS5saW5lLCBubGluZXMpOyB9DQogICAgICBpZiAoYWRkZWQubGVuZ3RoKSB7IGRvYy5pbnNlcnQoZnJvbS5saW5lLCBhZGRlZCk7IH0NCiAgICB9IGVsc2UgaWYgKGZpcnN0TGluZSA9PSBsYXN0TGluZSkgew0KICAgICAgaWYgKHRleHQubGVuZ3RoID09IDEpIHsNCiAgICAgICAgdXBkYXRlKGZpcnN0TGluZSwgZmlyc3RMaW5lLnRleHQuc2xpY2UoMCwgZnJvbS5jaCkgKyBsYXN0VGV4dCArIGZpcnN0TGluZS50ZXh0LnNsaWNlKHRvLmNoKSwgbGFzdFNwYW5zKTsNCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciBhZGRlZCQxID0gbGluZXNGb3IoMSwgdGV4dC5sZW5ndGggLSAxKTsNCiAgICAgICAgYWRkZWQkMS5wdXNoKG5ldyBMaW5lKGxhc3RUZXh0ICsgZmlyc3RMaW5lLnRleHQuc2xpY2UodG8uY2gpLCBsYXN0U3BhbnMsIGVzdGltYXRlSGVpZ2h0JCQxKSk7DQogICAgICAgIHVwZGF0ZShmaXJzdExpbmUsIGZpcnN0TGluZS50ZXh0LnNsaWNlKDAsIGZyb20uY2gpICsgdGV4dFswXSwgc3BhbnNGb3IoMCkpOw0KICAgICAgICBkb2MuaW5zZXJ0KGZyb20ubGluZSArIDEsIGFkZGVkJDEpOw0KICAgICAgfQ0KICAgIH0gZWxzZSBpZiAodGV4dC5sZW5ndGggPT0gMSkgew0KICAgICAgdXBkYXRlKGZpcnN0TGluZSwgZmlyc3RMaW5lLnRleHQuc2xpY2UoMCwgZnJvbS5jaCkgKyB0ZXh0WzBdICsgbGFzdExpbmUudGV4dC5zbGljZSh0by5jaCksIHNwYW5zRm9yKDApKTsNCiAgICAgIGRvYy5yZW1vdmUoZnJvbS5saW5lICsgMSwgbmxpbmVzKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdXBkYXRlKGZpcnN0TGluZSwgZmlyc3RMaW5lLnRleHQuc2xpY2UoMCwgZnJvbS5jaCkgKyB0ZXh0WzBdLCBzcGFuc0ZvcigwKSk7DQogICAgICB1cGRhdGUobGFzdExpbmUsIGxhc3RUZXh0ICsgbGFzdExpbmUudGV4dC5zbGljZSh0by5jaCksIGxhc3RTcGFucyk7DQogICAgICB2YXIgYWRkZWQkMiA9IGxpbmVzRm9yKDEsIHRleHQubGVuZ3RoIC0gMSk7DQogICAgICBpZiAobmxpbmVzID4gMSkgeyBkb2MucmVtb3ZlKGZyb20ubGluZSArIDEsIG5saW5lcyAtIDEpOyB9DQogICAgICBkb2MuaW5zZXJ0KGZyb20ubGluZSArIDEsIGFkZGVkJDIpOw0KICAgIH0NCg0KICAgIHNpZ25hbExhdGVyKGRvYywgImNoYW5nZSIsIGRvYywgY2hhbmdlKTsNCiAgfQ0KDQogIC8vIENhbGwgZiBmb3IgYWxsIGxpbmtlZCBkb2N1bWVudHMuDQogIGZ1bmN0aW9uIGxpbmtlZERvY3MoZG9jLCBmLCBzaGFyZWRIaXN0T25seSkgew0KICAgIGZ1bmN0aW9uIHByb3BhZ2F0ZShkb2MsIHNraXAsIHNoYXJlZEhpc3QpIHsNCiAgICAgIGlmIChkb2MubGlua2VkKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLmxpbmtlZC5sZW5ndGg7ICsraSkgew0KICAgICAgICB2YXIgcmVsID0gZG9jLmxpbmtlZFtpXTsNCiAgICAgICAgaWYgKHJlbC5kb2MgPT0gc2tpcCkgeyBjb250aW51ZSB9DQogICAgICAgIHZhciBzaGFyZWQgPSBzaGFyZWRIaXN0ICYmIHJlbC5zaGFyZWRIaXN0Ow0KICAgICAgICBpZiAoc2hhcmVkSGlzdE9ubHkgJiYgIXNoYXJlZCkgeyBjb250aW51ZSB9DQogICAgICAgIGYocmVsLmRvYywgc2hhcmVkKTsNCiAgICAgICAgcHJvcGFnYXRlKHJlbC5kb2MsIGRvYywgc2hhcmVkKTsNCiAgICAgIH0gfQ0KICAgIH0NCiAgICBwcm9wYWdhdGUoZG9jLCBudWxsLCB0cnVlKTsNCiAgfQ0KDQogIC8vIEF0dGFjaCBhIGRvY3VtZW50IHRvIGFuIGVkaXRvci4NCiAgZnVuY3Rpb24gYXR0YWNoRG9jKGNtLCBkb2MpIHsNCiAgICBpZiAoZG9jLmNtKSB7IHRocm93IG5ldyBFcnJvcigiVGhpcyBkb2N1bWVudCBpcyBhbHJlYWR5IGluIHVzZS4iKSB9DQogICAgY20uZG9jID0gZG9jOw0KICAgIGRvYy5jbSA9IGNtOw0KICAgIGVzdGltYXRlTGluZUhlaWdodHMoY20pOw0KICAgIGxvYWRNb2RlKGNtKTsNCiAgICBzZXREaXJlY3Rpb25DbGFzcyhjbSk7DQogICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgeyBmaW5kTWF4TGluZShjbSk7IH0NCiAgICBjbS5vcHRpb25zLm1vZGUgPSBkb2MubW9kZU9wdGlvbjsNCiAgICByZWdDaGFuZ2UoY20pOw0KICB9DQoNCiAgZnVuY3Rpb24gc2V0RGlyZWN0aW9uQ2xhc3MoY20pIHsNCiAgKGNtLmRvYy5kaXJlY3Rpb24gPT0gInJ0bCIgPyBhZGRDbGFzcyA6IHJtQ2xhc3MpKGNtLmRpc3BsYXkubGluZURpdiwgIkNvZGVNaXJyb3ItcnRsIik7DQogIH0NCg0KICBmdW5jdGlvbiBkaXJlY3Rpb25DaGFuZ2VkKGNtKSB7DQogICAgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkgew0KICAgICAgc2V0RGlyZWN0aW9uQ2xhc3MoY20pOw0KICAgICAgcmVnQ2hhbmdlKGNtKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIEhpc3Rvcnkoc3RhcnRHZW4pIHsNCiAgICAvLyBBcnJheXMgb2YgY2hhbmdlIGV2ZW50cyBhbmQgc2VsZWN0aW9ucy4gRG9pbmcgc29tZXRoaW5nIGFkZHMgYW4NCiAgICAvLyBldmVudCB0byBkb25lIGFuZCBjbGVhcnMgdW5kby4gVW5kb2luZyBtb3ZlcyBldmVudHMgZnJvbSBkb25lDQogICAgLy8gdG8gdW5kb25lLCByZWRvaW5nIG1vdmVzIHRoZW0gaW4gdGhlIG90aGVyIGRpcmVjdGlvbi4NCiAgICB0aGlzLmRvbmUgPSBbXTsgdGhpcy51bmRvbmUgPSBbXTsNCiAgICB0aGlzLnVuZG9EZXB0aCA9IEluZmluaXR5Ow0KICAgIC8vIFVzZWQgdG8gdHJhY2sgd2hlbiBjaGFuZ2VzIGNhbiBiZSBtZXJnZWQgaW50byBhIHNpbmdsZSB1bmRvDQogICAgLy8gZXZlbnQNCiAgICB0aGlzLmxhc3RNb2RUaW1lID0gdGhpcy5sYXN0U2VsVGltZSA9IDA7DQogICAgdGhpcy5sYXN0T3AgPSB0aGlzLmxhc3RTZWxPcCA9IG51bGw7DQogICAgdGhpcy5sYXN0T3JpZ2luID0gdGhpcy5sYXN0U2VsT3JpZ2luID0gbnVsbDsNCiAgICAvLyBVc2VkIGJ5IHRoZSBpc0NsZWFuKCkgbWV0aG9kDQogICAgdGhpcy5nZW5lcmF0aW9uID0gdGhpcy5tYXhHZW5lcmF0aW9uID0gc3RhcnRHZW4gfHwgMTsNCiAgfQ0KDQogIC8vIENyZWF0ZSBhIGhpc3RvcnkgY2hhbmdlIGV2ZW50IGZyb20gYW4gdXBkYXRlRG9jLXN0eWxlIGNoYW5nZQ0KICAvLyBvYmplY3QuDQogIGZ1bmN0aW9uIGhpc3RvcnlDaGFuZ2VGcm9tQ2hhbmdlKGRvYywgY2hhbmdlKSB7DQogICAgdmFyIGhpc3RDaGFuZ2UgPSB7ZnJvbTogY29weVBvcyhjaGFuZ2UuZnJvbSksIHRvOiBjaGFuZ2VFbmQoY2hhbmdlKSwgdGV4dDogZ2V0QmV0d2Vlbihkb2MsIGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pfTsNCiAgICBhdHRhY2hMb2NhbFNwYW5zKGRvYywgaGlzdENoYW5nZSwgY2hhbmdlLmZyb20ubGluZSwgY2hhbmdlLnRvLmxpbmUgKyAxKTsNCiAgICBsaW5rZWREb2NzKGRvYywgZnVuY3Rpb24gKGRvYykgeyByZXR1cm4gYXR0YWNoTG9jYWxTcGFucyhkb2MsIGhpc3RDaGFuZ2UsIGNoYW5nZS5mcm9tLmxpbmUsIGNoYW5nZS50by5saW5lICsgMSk7IH0sIHRydWUpOw0KICAgIHJldHVybiBoaXN0Q2hhbmdlDQogIH0NCg0KICAvLyBQb3AgYWxsIHNlbGVjdGlvbiBldmVudHMgb2ZmIHRoZSBlbmQgb2YgYSBoaXN0b3J5IGFycmF5LiBTdG9wIGF0DQogIC8vIGEgY2hhbmdlIGV2ZW50Lg0KICBmdW5jdGlvbiBjbGVhclNlbGVjdGlvbkV2ZW50cyhhcnJheSkgew0KICAgIHdoaWxlIChhcnJheS5sZW5ndGgpIHsNCiAgICAgIHZhciBsYXN0ID0gbHN0KGFycmF5KTsNCiAgICAgIGlmIChsYXN0LnJhbmdlcykgeyBhcnJheS5wb3AoKTsgfQ0KICAgICAgZWxzZSB7IGJyZWFrIH0NCiAgICB9DQogIH0NCg0KICAvLyBGaW5kIHRoZSB0b3AgY2hhbmdlIGV2ZW50IGluIHRoZSBoaXN0b3J5LiBQb3Agb2ZmIHNlbGVjdGlvbg0KICAvLyBldmVudHMgdGhhdCBhcmUgaW4gdGhlIHdheS4NCiAgZnVuY3Rpb24gbGFzdENoYW5nZUV2ZW50KGhpc3QsIGZvcmNlKSB7DQogICAgaWYgKGZvcmNlKSB7DQogICAgICBjbGVhclNlbGVjdGlvbkV2ZW50cyhoaXN0LmRvbmUpOw0KICAgICAgcmV0dXJuIGxzdChoaXN0LmRvbmUpDQogICAgfSBlbHNlIGlmIChoaXN0LmRvbmUubGVuZ3RoICYmICFsc3QoaGlzdC5kb25lKS5yYW5nZXMpIHsNCiAgICAgIHJldHVybiBsc3QoaGlzdC5kb25lKQ0KICAgIH0gZWxzZSBpZiAoaGlzdC5kb25lLmxlbmd0aCA+IDEgJiYgIWhpc3QuZG9uZVtoaXN0LmRvbmUubGVuZ3RoIC0gMl0ucmFuZ2VzKSB7DQogICAgICBoaXN0LmRvbmUucG9wKCk7DQogICAgICByZXR1cm4gbHN0KGhpc3QuZG9uZSkNCiAgICB9DQogIH0NCg0KICAvLyBSZWdpc3RlciBhIGNoYW5nZSBpbiB0aGUgaGlzdG9yeS4gTWVyZ2VzIGNoYW5nZXMgdGhhdCBhcmUgd2l0aGluDQogIC8vIGEgc2luZ2xlIG9wZXJhdGlvbiwgb3IgYXJlIGNsb3NlIHRvZ2V0aGVyIHdpdGggYW4gb3JpZ2luIHRoYXQNCiAgLy8gYWxsb3dzIG1lcmdpbmcgKHN0YXJ0aW5nIHdpdGggIisiKSBpbnRvIGEgc2luZ2xlIGV2ZW50Lg0KICBmdW5jdGlvbiBhZGRDaGFuZ2VUb0hpc3RvcnkoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBvcElkKSB7DQogICAgdmFyIGhpc3QgPSBkb2MuaGlzdG9yeTsNCiAgICBoaXN0LnVuZG9uZS5sZW5ndGggPSAwOw0KICAgIHZhciB0aW1lID0gK25ldyBEYXRlLCBjdXI7DQogICAgdmFyIGxhc3Q7DQoNCiAgICBpZiAoKGhpc3QubGFzdE9wID09IG9wSWQgfHwNCiAgICAgICAgIGhpc3QubGFzdE9yaWdpbiA9PSBjaGFuZ2Uub3JpZ2luICYmIGNoYW5nZS5vcmlnaW4gJiYNCiAgICAgICAgICgoY2hhbmdlLm9yaWdpbi5jaGFyQXQoMCkgPT0gIisiICYmIGhpc3QubGFzdE1vZFRpbWUgPiB0aW1lIC0gKGRvYy5jbSA/IGRvYy5jbS5vcHRpb25zLmhpc3RvcnlFdmVudERlbGF5IDogNTAwKSkgfHwNCiAgICAgICAgICBjaGFuZ2Uub3JpZ2luLmNoYXJBdCgwKSA9PSAiKiIpKSAmJg0KICAgICAgICAoY3VyID0gbGFzdENoYW5nZUV2ZW50KGhpc3QsIGhpc3QubGFzdE9wID09IG9wSWQpKSkgew0KICAgICAgLy8gTWVyZ2UgdGhpcyBjaGFuZ2UgaW50byB0aGUgbGFzdCBldmVudA0KICAgICAgbGFzdCA9IGxzdChjdXIuY2hhbmdlcyk7DQogICAgICBpZiAoY21wKGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pID09IDAgJiYgY21wKGNoYW5nZS5mcm9tLCBsYXN0LnRvKSA9PSAwKSB7DQogICAgICAgIC8vIE9wdGltaXplZCBjYXNlIGZvciBzaW1wbGUgaW5zZXJ0aW9uIC0tIGRvbid0IHdhbnQgdG8gYWRkDQogICAgICAgIC8vIG5ldyBjaGFuZ2VzZXRzIGZvciBldmVyeSBjaGFyYWN0ZXIgdHlwZWQNCiAgICAgICAgbGFzdC50byA9IGNoYW5nZUVuZChjaGFuZ2UpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgLy8gQWRkIG5ldyBzdWItZXZlbnQNCiAgICAgICAgY3VyLmNoYW5nZXMucHVzaChoaXN0b3J5Q2hhbmdlRnJvbUNoYW5nZShkb2MsIGNoYW5nZSkpOw0KICAgICAgfQ0KICAgIH0gZWxzZSB7DQogICAgICAvLyBDYW4gbm90IGJlIG1lcmdlZCwgc3RhcnQgYSBuZXcgZXZlbnQuDQogICAgICB2YXIgYmVmb3JlID0gbHN0KGhpc3QuZG9uZSk7DQogICAgICBpZiAoIWJlZm9yZSB8fCAhYmVmb3JlLnJhbmdlcykNCiAgICAgICAgeyBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KGRvYy5zZWwsIGhpc3QuZG9uZSk7IH0NCiAgICAgIGN1ciA9IHtjaGFuZ2VzOiBbaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpXSwNCiAgICAgICAgICAgICBnZW5lcmF0aW9uOiBoaXN0LmdlbmVyYXRpb259Ow0KICAgICAgaGlzdC5kb25lLnB1c2goY3VyKTsNCiAgICAgIHdoaWxlIChoaXN0LmRvbmUubGVuZ3RoID4gaGlzdC51bmRvRGVwdGgpIHsNCiAgICAgICAgaGlzdC5kb25lLnNoaWZ0KCk7DQogICAgICAgIGlmICghaGlzdC5kb25lWzBdLnJhbmdlcykgeyBoaXN0LmRvbmUuc2hpZnQoKTsgfQ0KICAgICAgfQ0KICAgIH0NCiAgICBoaXN0LmRvbmUucHVzaChzZWxBZnRlcik7DQogICAgaGlzdC5nZW5lcmF0aW9uID0gKytoaXN0Lm1heEdlbmVyYXRpb247DQogICAgaGlzdC5sYXN0TW9kVGltZSA9IGhpc3QubGFzdFNlbFRpbWUgPSB0aW1lOw0KICAgIGhpc3QubGFzdE9wID0gaGlzdC5sYXN0U2VsT3AgPSBvcElkOw0KICAgIGhpc3QubGFzdE9yaWdpbiA9IGhpc3QubGFzdFNlbE9yaWdpbiA9IGNoYW5nZS5vcmlnaW47DQoNCiAgICBpZiAoIWxhc3QpIHsgc2lnbmFsKGRvYywgImhpc3RvcnlBZGRlZCIpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBzZWxlY3Rpb25FdmVudENhbkJlTWVyZ2VkKGRvYywgb3JpZ2luLCBwcmV2LCBzZWwpIHsNCiAgICB2YXIgY2ggPSBvcmlnaW4uY2hhckF0KDApOw0KICAgIHJldHVybiBjaCA9PSAiKiIgfHwNCiAgICAgIGNoID09ICIrIiAmJg0KICAgICAgcHJldi5yYW5nZXMubGVuZ3RoID09IHNlbC5yYW5nZXMubGVuZ3RoICYmDQogICAgICBwcmV2LnNvbWV0aGluZ1NlbGVjdGVkKCkgPT0gc2VsLnNvbWV0aGluZ1NlbGVjdGVkKCkgJiYNCiAgICAgIG5ldyBEYXRlIC0gZG9jLmhpc3RvcnkubGFzdFNlbFRpbWUgPD0gKGRvYy5jbSA/IGRvYy5jbS5vcHRpb25zLmhpc3RvcnlFdmVudERlbGF5IDogNTAwKQ0KICB9DQoNCiAgLy8gQ2FsbGVkIHdoZW5ldmVyIHRoZSBzZWxlY3Rpb24gY2hhbmdlcywgc2V0cyB0aGUgbmV3IHNlbGVjdGlvbiBhcw0KICAvLyB0aGUgcGVuZGluZyBzZWxlY3Rpb24gaW4gdGhlIGhpc3RvcnksIGFuZCBwdXNoZXMgdGhlIG9sZCBwZW5kaW5nDQogIC8vIHNlbGVjdGlvbiBpbnRvIHRoZSAnZG9uZScgYXJyYXkgd2hlbiBpdCB3YXMgc2lnbmlmaWNhbnRseQ0KICAvLyBkaWZmZXJlbnQgKGluIG51bWJlciBvZiBzZWxlY3RlZCByYW5nZXMsIGVtcHRpbmVzcywgb3IgdGltZSkuDQogIGZ1bmN0aW9uIGFkZFNlbGVjdGlvblRvSGlzdG9yeShkb2MsIHNlbCwgb3BJZCwgb3B0aW9ucykgew0KICAgIHZhciBoaXN0ID0gZG9jLmhpc3RvcnksIG9yaWdpbiA9IG9wdGlvbnMgJiYgb3B0aW9ucy5vcmlnaW47DQoNCiAgICAvLyBBIG5ldyBldmVudCBpcyBzdGFydGVkIHdoZW4gdGhlIHByZXZpb3VzIG9yaWdpbiBkb2VzIG5vdCBtYXRjaA0KICAgIC8vIHRoZSBjdXJyZW50LCBvciB0aGUgb3JpZ2lucyBkb24ndCBhbGxvdyBtYXRjaGluZy4gT3JpZ2lucw0KICAgIC8vIHN0YXJ0aW5nIHdpdGggKiBhcmUgYWx3YXlzIG1lcmdlZCwgdGhvc2Ugc3RhcnRpbmcgd2l0aCArIGFyZQ0KICAgIC8vIG1lcmdlZCB3aGVuIHNpbWlsYXIgYW5kIGNsb3NlIHRvZ2V0aGVyIGluIHRpbWUuDQogICAgaWYgKG9wSWQgPT0gaGlzdC5sYXN0U2VsT3AgfHwNCiAgICAgICAgKG9yaWdpbiAmJiBoaXN0Lmxhc3RTZWxPcmlnaW4gPT0gb3JpZ2luICYmDQogICAgICAgICAoaGlzdC5sYXN0TW9kVGltZSA9PSBoaXN0Lmxhc3RTZWxUaW1lICYmIGhpc3QubGFzdE9yaWdpbiA9PSBvcmlnaW4gfHwNCiAgICAgICAgICBzZWxlY3Rpb25FdmVudENhbkJlTWVyZ2VkKGRvYywgb3JpZ2luLCBsc3QoaGlzdC5kb25lKSwgc2VsKSkpKQ0KICAgICAgeyBoaXN0LmRvbmVbaGlzdC5kb25lLmxlbmd0aCAtIDFdID0gc2VsOyB9DQogICAgZWxzZQ0KICAgICAgeyBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KHNlbCwgaGlzdC5kb25lKTsgfQ0KDQogICAgaGlzdC5sYXN0U2VsVGltZSA9ICtuZXcgRGF0ZTsNCiAgICBoaXN0Lmxhc3RTZWxPcmlnaW4gPSBvcmlnaW47DQogICAgaGlzdC5sYXN0U2VsT3AgPSBvcElkOw0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuY2xlYXJSZWRvICE9PSBmYWxzZSkNCiAgICAgIHsgY2xlYXJTZWxlY3Rpb25FdmVudHMoaGlzdC51bmRvbmUpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KHNlbCwgZGVzdCkgew0KICAgIHZhciB0b3AgPSBsc3QoZGVzdCk7DQogICAgaWYgKCEodG9wICYmIHRvcC5yYW5nZXMgJiYgdG9wLmVxdWFscyhzZWwpKSkNCiAgICAgIHsgZGVzdC5wdXNoKHNlbCk7IH0NCiAgfQ0KDQogIC8vIFVzZWQgdG8gc3RvcmUgbWFya2VkIHNwYW4gaW5mb3JtYXRpb24gaW4gdGhlIGhpc3RvcnkuDQogIGZ1bmN0aW9uIGF0dGFjaExvY2FsU3BhbnMoZG9jLCBjaGFuZ2UsIGZyb20sIHRvKSB7DQogICAgdmFyIGV4aXN0aW5nID0gY2hhbmdlWyJzcGFuc18iICsgZG9jLmlkXSwgbiA9IDA7DQogICAgZG9jLml0ZXIoTWF0aC5tYXgoZG9jLmZpcnN0LCBmcm9tKSwgTWF0aC5taW4oZG9jLmZpcnN0ICsgZG9jLnNpemUsIHRvKSwgZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgIGlmIChsaW5lLm1hcmtlZFNwYW5zKQ0KICAgICAgICB7IChleGlzdGluZyB8fCAoZXhpc3RpbmcgPSBjaGFuZ2VbInNwYW5zXyIgKyBkb2MuaWRdID0ge30pKVtuXSA9IGxpbmUubWFya2VkU3BhbnM7IH0NCiAgICAgICsrbjsNCiAgICB9KTsNCiAgfQ0KDQogIC8vIFdoZW4gdW4vcmUtZG9pbmcgcmVzdG9yZXMgdGV4dCBjb250YWluaW5nIG1hcmtlZCBzcGFucywgdGhvc2UNCiAgLy8gdGhhdCBoYXZlIGJlZW4gZXhwbGljaXRseSBjbGVhcmVkIHNob3VsZCBub3QgYmUgcmVzdG9yZWQuDQogIGZ1bmN0aW9uIHJlbW92ZUNsZWFyZWRTcGFucyhzcGFucykgew0KICAgIGlmICghc3BhbnMpIHsgcmV0dXJuIG51bGwgfQ0KICAgIHZhciBvdXQ7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBzcGFucy5sZW5ndGg7ICsraSkgew0KICAgICAgaWYgKHNwYW5zW2ldLm1hcmtlci5leHBsaWNpdGx5Q2xlYXJlZCkgeyBpZiAoIW91dCkgeyBvdXQgPSBzcGFucy5zbGljZSgwLCBpKTsgfSB9DQogICAgICBlbHNlIGlmIChvdXQpIHsgb3V0LnB1c2goc3BhbnNbaV0pOyB9DQogICAgfQ0KICAgIHJldHVybiAhb3V0ID8gc3BhbnMgOiBvdXQubGVuZ3RoID8gb3V0IDogbnVsbA0KICB9DQoNCiAgLy8gUmV0cmlldmUgYW5kIGZpbHRlciB0aGUgb2xkIG1hcmtlZCBzcGFucyBzdG9yZWQgaW4gYSBjaGFuZ2UgZXZlbnQuDQogIGZ1bmN0aW9uIGdldE9sZFNwYW5zKGRvYywgY2hhbmdlKSB7DQogICAgdmFyIGZvdW5kID0gY2hhbmdlWyJzcGFuc18iICsgZG9jLmlkXTsNCiAgICBpZiAoIWZvdW5kKSB7IHJldHVybiBudWxsIH0NCiAgICB2YXIgbncgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoYW5nZS50ZXh0Lmxlbmd0aDsgKytpKQ0KICAgICAgeyBudy5wdXNoKHJlbW92ZUNsZWFyZWRTcGFucyhmb3VuZFtpXSkpOyB9DQogICAgcmV0dXJuIG53DQogIH0NCg0KICAvLyBVc2VkIGZvciB1bi9yZS1kb2luZyBjaGFuZ2VzIGZyb20gdGhlIGhpc3RvcnkuIENvbWJpbmVzIHRoZQ0KICAvLyByZXN1bHQgb2YgY29tcHV0aW5nIHRoZSBleGlzdGluZyBzcGFucyB3aXRoIHRoZSBzZXQgb2Ygc3BhbnMgdGhhdA0KICAvLyBleGlzdGVkIGluIHRoZSBoaXN0b3J5IChzbyB0aGF0IGRlbGV0aW5nIGFyb3VuZCBhIHNwYW4gYW5kIHRoZW4NCiAgLy8gdW5kb2luZyBicmluZ3MgYmFjayB0aGUgc3BhbikuDQogIGZ1bmN0aW9uIG1lcmdlT2xkU3BhbnMoZG9jLCBjaGFuZ2UpIHsNCiAgICB2YXIgb2xkID0gZ2V0T2xkU3BhbnMoZG9jLCBjaGFuZ2UpOw0KICAgIHZhciBzdHJldGNoZWQgPSBzdHJldGNoU3BhbnNPdmVyQ2hhbmdlKGRvYywgY2hhbmdlKTsNCiAgICBpZiAoIW9sZCkgeyByZXR1cm4gc3RyZXRjaGVkIH0NCiAgICBpZiAoIXN0cmV0Y2hlZCkgeyByZXR1cm4gb2xkIH0NCg0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb2xkLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgb2xkQ3VyID0gb2xkW2ldLCBzdHJldGNoQ3VyID0gc3RyZXRjaGVkW2ldOw0KICAgICAgaWYgKG9sZEN1ciAmJiBzdHJldGNoQ3VyKSB7DQogICAgICAgIHNwYW5zOiBmb3IgKHZhciBqID0gMDsgaiA8IHN0cmV0Y2hDdXIubGVuZ3RoOyArK2opIHsNCiAgICAgICAgICB2YXIgc3BhbiA9IHN0cmV0Y2hDdXJbal07DQogICAgICAgICAgZm9yICh2YXIgayA9IDA7IGsgPCBvbGRDdXIubGVuZ3RoOyArK2spDQogICAgICAgICAgICB7IGlmIChvbGRDdXJba10ubWFya2VyID09IHNwYW4ubWFya2VyKSB7IGNvbnRpbnVlIHNwYW5zIH0gfQ0KICAgICAgICAgIG9sZEN1ci5wdXNoKHNwYW4pOw0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHN0cmV0Y2hDdXIpIHsNCiAgICAgICAgb2xkW2ldID0gc3RyZXRjaEN1cjsNCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIG9sZA0KICB9DQoNCiAgLy8gVXNlZCBib3RoIHRvIHByb3ZpZGUgYSBKU09OLXNhZmUgb2JqZWN0IGluIC5nZXRIaXN0b3J5LCBhbmQsIHdoZW4NCiAgLy8gZGV0YWNoaW5nIGEgZG9jdW1lbnQsIHRvIHNwbGl0IHRoZSBoaXN0b3J5IGluIHR3bw0KICBmdW5jdGlvbiBjb3B5SGlzdG9yeUFycmF5KGV2ZW50cywgbmV3R3JvdXAsIGluc3RhbnRpYXRlU2VsKSB7DQogICAgdmFyIGNvcHkgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGV2ZW50cy5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIGV2ZW50ID0gZXZlbnRzW2ldOw0KICAgICAgaWYgKGV2ZW50LnJhbmdlcykgew0KICAgICAgICBjb3B5LnB1c2goaW5zdGFudGlhdGVTZWwgPyBTZWxlY3Rpb24ucHJvdG90eXBlLmRlZXBDb3B5LmNhbGwoZXZlbnQpIDogZXZlbnQpOw0KICAgICAgICBjb250aW51ZQ0KICAgICAgfQ0KICAgICAgdmFyIGNoYW5nZXMgPSBldmVudC5jaGFuZ2VzLCBuZXdDaGFuZ2VzID0gW107DQogICAgICBjb3B5LnB1c2goe2NoYW5nZXM6IG5ld0NoYW5nZXN9KTsNCiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgY2hhbmdlcy5sZW5ndGg7ICsraikgew0KICAgICAgICB2YXIgY2hhbmdlID0gY2hhbmdlc1tqXSwgbSA9ICh2b2lkIDApOw0KICAgICAgICBuZXdDaGFuZ2VzLnB1c2goe2Zyb206IGNoYW5nZS5mcm9tLCB0bzogY2hhbmdlLnRvLCB0ZXh0OiBjaGFuZ2UudGV4dH0pOw0KICAgICAgICBpZiAobmV3R3JvdXApIHsgZm9yICh2YXIgcHJvcCBpbiBjaGFuZ2UpIHsgaWYgKG0gPSBwcm9wLm1hdGNoKC9ec3BhbnNfKFxkKykkLykpIHsNCiAgICAgICAgICBpZiAoaW5kZXhPZihuZXdHcm91cCwgTnVtYmVyKG1bMV0pKSA+IC0xKSB7DQogICAgICAgICAgICBsc3QobmV3Q2hhbmdlcylbcHJvcF0gPSBjaGFuZ2VbcHJvcF07DQogICAgICAgICAgICBkZWxldGUgY2hhbmdlW3Byb3BdOw0KICAgICAgICAgIH0NCiAgICAgICAgfSB9IH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGNvcHkNCiAgfQ0KDQogIC8vIFRoZSAnc2Nyb2xsJyBwYXJhbWV0ZXIgZ2l2ZW4gdG8gbWFueSBvZiB0aGVzZSBpbmRpY2F0ZWQgd2hldGhlcg0KICAvLyB0aGUgbmV3IGN1cnNvciBwb3NpdGlvbiBzaG91bGQgYmUgc2Nyb2xsZWQgaW50byB2aWV3IGFmdGVyDQogIC8vIG1vZGlmeWluZyB0aGUgc2VsZWN0aW9uLg0KDQogIC8vIElmIHNoaWZ0IGlzIGhlbGQgb3IgdGhlIGV4dGVuZCBmbGFnIGlzIHNldCwgZXh0ZW5kcyBhIHJhbmdlIHRvDQogIC8vIGluY2x1ZGUgYSBnaXZlbiBwb3NpdGlvbiAoYW5kIG9wdGlvbmFsbHkgYSBzZWNvbmQgcG9zaXRpb24pLg0KICAvLyBPdGhlcndpc2UsIHNpbXBseSByZXR1cm5zIHRoZSByYW5nZSBiZXR3ZWVuIHRoZSBnaXZlbiBwb3NpdGlvbnMuDQogIC8vIFVzZWQgZm9yIGN1cnNvciBtb3Rpb24gYW5kIHN1Y2guDQogIGZ1bmN0aW9uIGV4dGVuZFJhbmdlKHJhbmdlLCBoZWFkLCBvdGhlciwgZXh0ZW5kKSB7DQogICAgaWYgKGV4dGVuZCkgew0KICAgICAgdmFyIGFuY2hvciA9IHJhbmdlLmFuY2hvcjsNCiAgICAgIGlmIChvdGhlcikgew0KICAgICAgICB2YXIgcG9zQmVmb3JlID0gY21wKGhlYWQsIGFuY2hvcikgPCAwOw0KICAgICAgICBpZiAocG9zQmVmb3JlICE9IChjbXAob3RoZXIsIGFuY2hvcikgPCAwKSkgew0KICAgICAgICAgIGFuY2hvciA9IGhlYWQ7DQogICAgICAgICAgaGVhZCA9IG90aGVyOw0KICAgICAgICB9IGVsc2UgaWYgKHBvc0JlZm9yZSAhPSAoY21wKGhlYWQsIG90aGVyKSA8IDApKSB7DQogICAgICAgICAgaGVhZCA9IG90aGVyOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gbmV3IFJhbmdlKGFuY2hvciwgaGVhZCkNCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIG5ldyBSYW5nZShvdGhlciB8fCBoZWFkLCBoZWFkKQ0KICAgIH0NCiAgfQ0KDQogIC8vIEV4dGVuZCB0aGUgcHJpbWFyeSBzZWxlY3Rpb24gcmFuZ2UsIGRpc2NhcmQgdGhlIHJlc3QuDQogIGZ1bmN0aW9uIGV4dGVuZFNlbGVjdGlvbihkb2MsIGhlYWQsIG90aGVyLCBvcHRpb25zLCBleHRlbmQpIHsNCiAgICBpZiAoZXh0ZW5kID09IG51bGwpIHsgZXh0ZW5kID0gZG9jLmNtICYmIChkb2MuY20uZGlzcGxheS5zaGlmdCB8fCBkb2MuZXh0ZW5kKTsgfQ0KICAgIHNldFNlbGVjdGlvbihkb2MsIG5ldyBTZWxlY3Rpb24oW2V4dGVuZFJhbmdlKGRvYy5zZWwucHJpbWFyeSgpLCBoZWFkLCBvdGhlciwgZXh0ZW5kKV0sIDApLCBvcHRpb25zKTsNCiAgfQ0KDQogIC8vIEV4dGVuZCBhbGwgc2VsZWN0aW9ucyAocG9zIGlzIGFuIGFycmF5IG9mIHNlbGVjdGlvbnMgd2l0aCBsZW5ndGgNCiAgLy8gZXF1YWwgdGhlIG51bWJlciBvZiBzZWxlY3Rpb25zKQ0KICBmdW5jdGlvbiBleHRlbmRTZWxlY3Rpb25zKGRvYywgaGVhZHMsIG9wdGlvbnMpIHsNCiAgICB2YXIgb3V0ID0gW107DQogICAgdmFyIGV4dGVuZCA9IGRvYy5jbSAmJiAoZG9jLmNtLmRpc3BsYXkuc2hpZnQgfHwgZG9jLmV4dGVuZCk7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykNCiAgICAgIHsgb3V0W2ldID0gZXh0ZW5kUmFuZ2UoZG9jLnNlbC5yYW5nZXNbaV0sIGhlYWRzW2ldLCBudWxsLCBleHRlbmQpOyB9DQogICAgdmFyIG5ld1NlbCA9IG5vcm1hbGl6ZVNlbGVjdGlvbihkb2MuY20sIG91dCwgZG9jLnNlbC5wcmltSW5kZXgpOw0KICAgIHNldFNlbGVjdGlvbihkb2MsIG5ld1NlbCwgb3B0aW9ucyk7DQogIH0NCg0KICAvLyBVcGRhdGVzIGEgc2luZ2xlIHJhbmdlIGluIHRoZSBzZWxlY3Rpb24uDQogIGZ1bmN0aW9uIHJlcGxhY2VPbmVTZWxlY3Rpb24oZG9jLCBpLCByYW5nZSwgb3B0aW9ucykgew0KICAgIHZhciByYW5nZXMgPSBkb2Muc2VsLnJhbmdlcy5zbGljZSgwKTsNCiAgICByYW5nZXNbaV0gPSByYW5nZTsNCiAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24oZG9jLmNtLCByYW5nZXMsIGRvYy5zZWwucHJpbUluZGV4KSwgb3B0aW9ucyk7DQogIH0NCg0KICAvLyBSZXNldCB0aGUgc2VsZWN0aW9uIHRvIGEgc2luZ2xlIHJhbmdlLg0KICBmdW5jdGlvbiBzZXRTaW1wbGVTZWxlY3Rpb24oZG9jLCBhbmNob3IsIGhlYWQsIG9wdGlvbnMpIHsNCiAgICBzZXRTZWxlY3Rpb24oZG9jLCBzaW1wbGVTZWxlY3Rpb24oYW5jaG9yLCBoZWFkKSwgb3B0aW9ucyk7DQogIH0NCg0KICAvLyBHaXZlIGJlZm9yZVNlbGVjdGlvbkNoYW5nZSBoYW5kbGVycyBhIGNoYW5nZSB0byBpbmZsdWVuY2UgYQ0KICAvLyBzZWxlY3Rpb24gdXBkYXRlLg0KICBmdW5jdGlvbiBmaWx0ZXJTZWxlY3Rpb25DaGFuZ2UoZG9jLCBzZWwsIG9wdGlvbnMpIHsNCiAgICB2YXIgb2JqID0gew0KICAgICAgcmFuZ2VzOiBzZWwucmFuZ2VzLA0KICAgICAgdXBkYXRlOiBmdW5jdGlvbihyYW5nZXMpIHsNCiAgICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgICAgdGhpcy5yYW5nZXMgPSBbXTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspDQogICAgICAgICAgeyB0aGlzJDEucmFuZ2VzW2ldID0gbmV3IFJhbmdlKGNsaXBQb3MoZG9jLCByYW5nZXNbaV0uYW5jaG9yKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGlwUG9zKGRvYywgcmFuZ2VzW2ldLmhlYWQpKTsgfQ0KICAgICAgfSwNCiAgICAgIG9yaWdpbjogb3B0aW9ucyAmJiBvcHRpb25zLm9yaWdpbg0KICAgIH07DQogICAgc2lnbmFsKGRvYywgImJlZm9yZVNlbGVjdGlvbkNoYW5nZSIsIGRvYywgb2JqKTsNCiAgICBpZiAoZG9jLmNtKSB7IHNpZ25hbChkb2MuY20sICJiZWZvcmVTZWxlY3Rpb25DaGFuZ2UiLCBkb2MuY20sIG9iaik7IH0NCiAgICBpZiAob2JqLnJhbmdlcyAhPSBzZWwucmFuZ2VzKSB7IHJldHVybiBub3JtYWxpemVTZWxlY3Rpb24oZG9jLmNtLCBvYmoucmFuZ2VzLCBvYmoucmFuZ2VzLmxlbmd0aCAtIDEpIH0NCiAgICBlbHNlIHsgcmV0dXJuIHNlbCB9DQogIH0NCg0KICBmdW5jdGlvbiBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeShkb2MsIHNlbCwgb3B0aW9ucykgew0KICAgIHZhciBkb25lID0gZG9jLmhpc3RvcnkuZG9uZSwgbGFzdCA9IGxzdChkb25lKTsNCiAgICBpZiAobGFzdCAmJiBsYXN0LnJhbmdlcykgew0KICAgICAgZG9uZVtkb25lLmxlbmd0aCAtIDFdID0gc2VsOw0KICAgICAgc2V0U2VsZWN0aW9uTm9VbmRvKGRvYywgc2VsLCBvcHRpb25zKTsNCiAgICB9IGVsc2Ugew0KICAgICAgc2V0U2VsZWN0aW9uKGRvYywgc2VsLCBvcHRpb25zKTsNCiAgICB9DQogIH0NCg0KICAvLyBTZXQgYSBuZXcgc2VsZWN0aW9uLg0KICBmdW5jdGlvbiBzZXRTZWxlY3Rpb24oZG9jLCBzZWwsIG9wdGlvbnMpIHsNCiAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWwsIG9wdGlvbnMpOw0KICAgIGFkZFNlbGVjdGlvblRvSGlzdG9yeShkb2MsIGRvYy5zZWwsIGRvYy5jbSA/IGRvYy5jbS5jdXJPcC5pZCA6IE5hTiwgb3B0aW9ucyk7DQogIH0NCg0KICBmdW5jdGlvbiBzZXRTZWxlY3Rpb25Ob1VuZG8oZG9jLCBzZWwsIG9wdGlvbnMpIHsNCiAgICBpZiAoaGFzSGFuZGxlcihkb2MsICJiZWZvcmVTZWxlY3Rpb25DaGFuZ2UiKSB8fCBkb2MuY20gJiYgaGFzSGFuZGxlcihkb2MuY20sICJiZWZvcmVTZWxlY3Rpb25DaGFuZ2UiKSkNCiAgICAgIHsgc2VsID0gZmlsdGVyU2VsZWN0aW9uQ2hhbmdlKGRvYywgc2VsLCBvcHRpb25zKTsgfQ0KDQogICAgdmFyIGJpYXMgPSBvcHRpb25zICYmIG9wdGlvbnMuYmlhcyB8fA0KICAgICAgKGNtcChzZWwucHJpbWFyeSgpLmhlYWQsIGRvYy5zZWwucHJpbWFyeSgpLmhlYWQpIDwgMCA/IC0xIDogMSk7DQogICAgc2V0U2VsZWN0aW9uSW5uZXIoZG9jLCBza2lwQXRvbWljSW5TZWxlY3Rpb24oZG9jLCBzZWwsIGJpYXMsIHRydWUpKTsNCg0KICAgIGlmICghKG9wdGlvbnMgJiYgb3B0aW9ucy5zY3JvbGwgPT09IGZhbHNlKSAmJiBkb2MuY20pDQogICAgICB7IGVuc3VyZUN1cnNvclZpc2libGUoZG9jLmNtKTsgfQ0KICB9DQoNCiAgZnVuY3Rpb24gc2V0U2VsZWN0aW9uSW5uZXIoZG9jLCBzZWwpIHsNCiAgICBpZiAoc2VsLmVxdWFscyhkb2Muc2VsKSkgeyByZXR1cm4gfQ0KDQogICAgZG9jLnNlbCA9IHNlbDsNCg0KICAgIGlmIChkb2MuY20pIHsNCiAgICAgIGRvYy5jbS5jdXJPcC51cGRhdGVJbnB1dCA9IDE7DQogICAgICBkb2MuY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7DQogICAgICBzaWduYWxDdXJzb3JBY3Rpdml0eShkb2MuY20pOw0KICAgIH0NCiAgICBzaWduYWxMYXRlcihkb2MsICJjdXJzb3JBY3Rpdml0eSIsIGRvYyk7DQogIH0NCg0KICAvLyBWZXJpZnkgdGhhdCB0aGUgc2VsZWN0aW9uIGRvZXMgbm90IHBhcnRpYWxseSBzZWxlY3QgYW55IGF0b21pYw0KICAvLyBtYXJrZWQgcmFuZ2VzLg0KICBmdW5jdGlvbiByZUNoZWNrU2VsZWN0aW9uKGRvYykgew0KICAgIHNldFNlbGVjdGlvbklubmVyKGRvYywgc2tpcEF0b21pY0luU2VsZWN0aW9uKGRvYywgZG9jLnNlbCwgbnVsbCwgZmFsc2UpKTsNCiAgfQ0KDQogIC8vIFJldHVybiBhIHNlbGVjdGlvbiB0aGF0IGRvZXMgbm90IHBhcnRpYWxseSBzZWxlY3QgYW55IGF0b21pYw0KICAvLyByYW5nZXMuDQogIGZ1bmN0aW9uIHNraXBBdG9taWNJblNlbGVjdGlvbihkb2MsIHNlbCwgYmlhcywgbWF5Q2xlYXIpIHsNCiAgICB2YXIgb3V0Ow0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc2VsLnJhbmdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIHJhbmdlID0gc2VsLnJhbmdlc1tpXTsNCiAgICAgIHZhciBvbGQgPSBzZWwucmFuZ2VzLmxlbmd0aCA9PSBkb2Muc2VsLnJhbmdlcy5sZW5ndGggJiYgZG9jLnNlbC5yYW5nZXNbaV07DQogICAgICB2YXIgbmV3QW5jaG9yID0gc2tpcEF0b21pYyhkb2MsIHJhbmdlLmFuY2hvciwgb2xkICYmIG9sZC5hbmNob3IsIGJpYXMsIG1heUNsZWFyKTsNCiAgICAgIHZhciBuZXdIZWFkID0gc2tpcEF0b21pYyhkb2MsIHJhbmdlLmhlYWQsIG9sZCAmJiBvbGQuaGVhZCwgYmlhcywgbWF5Q2xlYXIpOw0KICAgICAgaWYgKG91dCB8fCBuZXdBbmNob3IgIT0gcmFuZ2UuYW5jaG9yIHx8IG5ld0hlYWQgIT0gcmFuZ2UuaGVhZCkgew0KICAgICAgICBpZiAoIW91dCkgeyBvdXQgPSBzZWwucmFuZ2VzLnNsaWNlKDAsIGkpOyB9DQogICAgICAgIG91dFtpXSA9IG5ldyBSYW5nZShuZXdBbmNob3IsIG5ld0hlYWQpOw0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gb3V0ID8gbm9ybWFsaXplU2VsZWN0aW9uKGRvYy5jbSwgb3V0LCBzZWwucHJpbUluZGV4KSA6IHNlbA0KICB9DQoNCiAgZnVuY3Rpb24gc2tpcEF0b21pY0lubmVyKGRvYywgcG9zLCBvbGRQb3MsIGRpciwgbWF5Q2xlYXIpIHsNCiAgICB2YXIgbGluZSA9IGdldExpbmUoZG9jLCBwb3MubGluZSk7DQogICAgaWYgKGxpbmUubWFya2VkU3BhbnMpIHsgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lLm1hcmtlZFNwYW5zLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgc3AgPSBsaW5lLm1hcmtlZFNwYW5zW2ldLCBtID0gc3AubWFya2VyOw0KDQogICAgICAvLyBEZXRlcm1pbmUgaWYgd2Ugc2hvdWxkIHByZXZlbnQgdGhlIGN1cnNvciBiZWluZyBwbGFjZWQgdG8gdGhlIGxlZnQvcmlnaHQgb2YgYW4gYXRvbWljIG1hcmtlcg0KICAgICAgLy8gSGlzdG9yaWNhbGx5IHRoaXMgd2FzIGRldGVybWluZWQgdXNpbmcgdGhlIGluY2x1c2l2ZUxlZnQvUmlnaHQgb3B0aW9uLCBidXQgdGhlIG5ldyB3YXkgdG8gY29udHJvbCBpdA0KICAgICAgLy8gaXMgd2l0aCBzZWxlY3RMZWZ0L1JpZ2h0DQogICAgICB2YXIgcHJldmVudEN1cnNvckxlZnQgPSAoInNlbGVjdExlZnQiIGluIG0pID8gIW0uc2VsZWN0TGVmdCA6IG0uaW5jbHVzaXZlTGVmdDsNCiAgICAgIHZhciBwcmV2ZW50Q3Vyc29yUmlnaHQgPSAoInNlbGVjdFJpZ2h0IiBpbiBtKSA/ICFtLnNlbGVjdFJpZ2h0IDogbS5pbmNsdXNpdmVSaWdodDsNCg0KICAgICAgaWYgKChzcC5mcm9tID09IG51bGwgfHwgKHByZXZlbnRDdXJzb3JMZWZ0ID8gc3AuZnJvbSA8PSBwb3MuY2ggOiBzcC5mcm9tIDwgcG9zLmNoKSkgJiYNCiAgICAgICAgICAoc3AudG8gPT0gbnVsbCB8fCAocHJldmVudEN1cnNvclJpZ2h0ID8gc3AudG8gPj0gcG9zLmNoIDogc3AudG8gPiBwb3MuY2gpKSkgew0KICAgICAgICBpZiAobWF5Q2xlYXIpIHsNCiAgICAgICAgICBzaWduYWwobSwgImJlZm9yZUN1cnNvckVudGVyIik7DQogICAgICAgICAgaWYgKG0uZXhwbGljaXRseUNsZWFyZWQpIHsNCiAgICAgICAgICAgIGlmICghbGluZS5tYXJrZWRTcGFucykgeyBicmVhayB9DQogICAgICAgICAgICBlbHNlIHstLWk7IGNvbnRpbnVlfQ0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoIW0uYXRvbWljKSB7IGNvbnRpbnVlIH0NCg0KICAgICAgICBpZiAob2xkUG9zKSB7DQogICAgICAgICAgdmFyIG5lYXIgPSBtLmZpbmQoZGlyIDwgMCA/IDEgOiAtMSksIGRpZmYgPSAodm9pZCAwKTsNCiAgICAgICAgICBpZiAoZGlyIDwgMCA/IHByZXZlbnRDdXJzb3JSaWdodCA6IHByZXZlbnRDdXJzb3JMZWZ0KQ0KICAgICAgICAgICAgeyBuZWFyID0gbW92ZVBvcyhkb2MsIG5lYXIsIC1kaXIsIG5lYXIgJiYgbmVhci5saW5lID09IHBvcy5saW5lID8gbGluZSA6IG51bGwpOyB9DQogICAgICAgICAgaWYgKG5lYXIgJiYgbmVhci5saW5lID09IHBvcy5saW5lICYmIChkaWZmID0gY21wKG5lYXIsIG9sZFBvcykpICYmIChkaXIgPCAwID8gZGlmZiA8IDAgOiBkaWZmID4gMCkpDQogICAgICAgICAgICB7IHJldHVybiBza2lwQXRvbWljSW5uZXIoZG9jLCBuZWFyLCBwb3MsIGRpciwgbWF5Q2xlYXIpIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHZhciBmYXIgPSBtLmZpbmQoZGlyIDwgMCA/IC0xIDogMSk7DQogICAgICAgIGlmIChkaXIgPCAwID8gcHJldmVudEN1cnNvckxlZnQgOiBwcmV2ZW50Q3Vyc29yUmlnaHQpDQogICAgICAgICAgeyBmYXIgPSBtb3ZlUG9zKGRvYywgZmFyLCBkaXIsIGZhci5saW5lID09IHBvcy5saW5lID8gbGluZSA6IG51bGwpOyB9DQogICAgICAgIHJldHVybiBmYXIgPyBza2lwQXRvbWljSW5uZXIoZG9jLCBmYXIsIHBvcywgZGlyLCBtYXlDbGVhcikgOiBudWxsDQogICAgICB9DQogICAgfSB9DQogICAgcmV0dXJuIHBvcw0KICB9DQoNCiAgLy8gRW5zdXJlIGEgZ2l2ZW4gcG9zaXRpb24gaXMgbm90IGluc2lkZSBhbiBhdG9taWMgcmFuZ2UuDQogIGZ1bmN0aW9uIHNraXBBdG9taWMoZG9jLCBwb3MsIG9sZFBvcywgYmlhcywgbWF5Q2xlYXIpIHsNCiAgICB2YXIgZGlyID0gYmlhcyB8fCAxOw0KICAgIHZhciBmb3VuZCA9IHNraXBBdG9taWNJbm5lcihkb2MsIHBvcywgb2xkUG9zLCBkaXIsIG1heUNsZWFyKSB8fA0KICAgICAgICAoIW1heUNsZWFyICYmIHNraXBBdG9taWNJbm5lcihkb2MsIHBvcywgb2xkUG9zLCBkaXIsIHRydWUpKSB8fA0KICAgICAgICBza2lwQXRvbWljSW5uZXIoZG9jLCBwb3MsIG9sZFBvcywgLWRpciwgbWF5Q2xlYXIpIHx8DQogICAgICAgICghbWF5Q2xlYXIgJiYgc2tpcEF0b21pY0lubmVyKGRvYywgcG9zLCBvbGRQb3MsIC1kaXIsIHRydWUpKTsNCiAgICBpZiAoIWZvdW5kKSB7DQogICAgICBkb2MuY2FudEVkaXQgPSB0cnVlOw0KICAgICAgcmV0dXJuIFBvcyhkb2MuZmlyc3QsIDApDQogICAgfQ0KICAgIHJldHVybiBmb3VuZA0KICB9DQoNCiAgZnVuY3Rpb24gbW92ZVBvcyhkb2MsIHBvcywgZGlyLCBsaW5lKSB7DQogICAgaWYgKGRpciA8IDAgJiYgcG9zLmNoID09IDApIHsNCiAgICAgIGlmIChwb3MubGluZSA+IGRvYy5maXJzdCkgeyByZXR1cm4gY2xpcFBvcyhkb2MsIFBvcyhwb3MubGluZSAtIDEpKSB9DQogICAgICBlbHNlIHsgcmV0dXJuIG51bGwgfQ0KICAgIH0gZWxzZSBpZiAoZGlyID4gMCAmJiBwb3MuY2ggPT0gKGxpbmUgfHwgZ2V0TGluZShkb2MsIHBvcy5saW5lKSkudGV4dC5sZW5ndGgpIHsNCiAgICAgIGlmIChwb3MubGluZSA8IGRvYy5maXJzdCArIGRvYy5zaXplIC0gMSkgeyByZXR1cm4gUG9zKHBvcy5saW5lICsgMSwgMCkgfQ0KICAgICAgZWxzZSB7IHJldHVybiBudWxsIH0NCiAgICB9IGVsc2Ugew0KICAgICAgcmV0dXJuIG5ldyBQb3MocG9zLmxpbmUsIHBvcy5jaCArIGRpcikNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBzZWxlY3RBbGwoY20pIHsNCiAgICBjbS5zZXRTZWxlY3Rpb24oUG9zKGNtLmZpcnN0TGluZSgpLCAwKSwgUG9zKGNtLmxhc3RMaW5lKCkpLCBzZWxfZG9udFNjcm9sbCk7DQogIH0NCg0KICAvLyBVUERBVElORw0KDQogIC8vIEFsbG93ICJiZWZvcmVDaGFuZ2UiIGV2ZW50IGhhbmRsZXJzIHRvIGluZmx1ZW5jZSBhIGNoYW5nZQ0KICBmdW5jdGlvbiBmaWx0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UsIHVwZGF0ZSkgew0KICAgIHZhciBvYmogPSB7DQogICAgICBjYW5jZWxlZDogZmFsc2UsDQogICAgICBmcm9tOiBjaGFuZ2UuZnJvbSwNCiAgICAgIHRvOiBjaGFuZ2UudG8sDQogICAgICB0ZXh0OiBjaGFuZ2UudGV4dCwNCiAgICAgIG9yaWdpbjogY2hhbmdlLm9yaWdpbiwNCiAgICAgIGNhbmNlbDogZnVuY3Rpb24gKCkgeyByZXR1cm4gb2JqLmNhbmNlbGVkID0gdHJ1ZTsgfQ0KICAgIH07DQogICAgaWYgKHVwZGF0ZSkgeyBvYmoudXBkYXRlID0gZnVuY3Rpb24gKGZyb20sIHRvLCB0ZXh0LCBvcmlnaW4pIHsNCiAgICAgIGlmIChmcm9tKSB7IG9iai5mcm9tID0gY2xpcFBvcyhkb2MsIGZyb20pOyB9DQogICAgICBpZiAodG8pIHsgb2JqLnRvID0gY2xpcFBvcyhkb2MsIHRvKTsgfQ0KICAgICAgaWYgKHRleHQpIHsgb2JqLnRleHQgPSB0ZXh0OyB9DQogICAgICBpZiAob3JpZ2luICE9PSB1bmRlZmluZWQpIHsgb2JqLm9yaWdpbiA9IG9yaWdpbjsgfQ0KICAgIH07IH0NCiAgICBzaWduYWwoZG9jLCAiYmVmb3JlQ2hhbmdlIiwgZG9jLCBvYmopOw0KICAgIGlmIChkb2MuY20pIHsgc2lnbmFsKGRvYy5jbSwgImJlZm9yZUNoYW5nZSIsIGRvYy5jbSwgb2JqKTsgfQ0KDQogICAgaWYgKG9iai5jYW5jZWxlZCkgew0KICAgICAgaWYgKGRvYy5jbSkgeyBkb2MuY20uY3VyT3AudXBkYXRlSW5wdXQgPSAyOyB9DQogICAgICByZXR1cm4gbnVsbA0KICAgIH0NCiAgICByZXR1cm4ge2Zyb206IG9iai5mcm9tLCB0bzogb2JqLnRvLCB0ZXh0OiBvYmoudGV4dCwgb3JpZ2luOiBvYmoub3JpZ2lufQ0KICB9DQoNCiAgLy8gQXBwbHkgYSBjaGFuZ2UgdG8gYSBkb2N1bWVudCwgYW5kIGFkZCBpdCB0byB0aGUgZG9jdW1lbnQncw0KICAvLyBoaXN0b3J5LCBhbmQgcHJvcGFnYXRpbmcgaXQgdG8gYWxsIGxpbmtlZCBkb2N1bWVudHMuDQogIGZ1bmN0aW9uIG1ha2VDaGFuZ2UoZG9jLCBjaGFuZ2UsIGlnbm9yZVJlYWRPbmx5KSB7DQogICAgaWYgKGRvYy5jbSkgew0KICAgICAgaWYgKCFkb2MuY20uY3VyT3ApIHsgcmV0dXJuIG9wZXJhdGlvbihkb2MuY20sIG1ha2VDaGFuZ2UpKGRvYywgY2hhbmdlLCBpZ25vcmVSZWFkT25seSkgfQ0KICAgICAgaWYgKGRvYy5jbS5zdGF0ZS5zdXBwcmVzc0VkaXRzKSB7IHJldHVybiB9DQogICAgfQ0KDQogICAgaWYgKGhhc0hhbmRsZXIoZG9jLCAiYmVmb3JlQ2hhbmdlIikgfHwgZG9jLmNtICYmIGhhc0hhbmRsZXIoZG9jLmNtLCAiYmVmb3JlQ2hhbmdlIikpIHsNCiAgICAgIGNoYW5nZSA9IGZpbHRlckNoYW5nZShkb2MsIGNoYW5nZSwgdHJ1ZSk7DQogICAgICBpZiAoIWNoYW5nZSkgeyByZXR1cm4gfQ0KICAgIH0NCg0KICAgIC8vIFBvc3NpYmx5IHNwbGl0IG9yIHN1cHByZXNzIHRoZSB1cGRhdGUgYmFzZWQgb24gdGhlIHByZXNlbmNlDQogICAgLy8gb2YgcmVhZC1vbmx5IHNwYW5zIGluIGl0cyByYW5nZS4NCiAgICB2YXIgc3BsaXQgPSBzYXdSZWFkT25seVNwYW5zICYmICFpZ25vcmVSZWFkT25seSAmJiByZW1vdmVSZWFkT25seVJhbmdlcyhkb2MsIGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pOw0KICAgIGlmIChzcGxpdCkgew0KICAgICAgZm9yICh2YXIgaSA9IHNwbGl0Lmxlbmd0aCAtIDE7IGkgPj0gMDsgLS1pKQ0KICAgICAgICB7IG1ha2VDaGFuZ2VJbm5lcihkb2MsIHtmcm9tOiBzcGxpdFtpXS5mcm9tLCB0bzogc3BsaXRbaV0udG8sIHRleHQ6IGkgPyBbIiJdIDogY2hhbmdlLnRleHQsIG9yaWdpbjogY2hhbmdlLm9yaWdpbn0pOyB9DQogICAgfSBlbHNlIHsNCiAgICAgIG1ha2VDaGFuZ2VJbm5lcihkb2MsIGNoYW5nZSk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gbWFrZUNoYW5nZUlubmVyKGRvYywgY2hhbmdlKSB7DQogICAgaWYgKGNoYW5nZS50ZXh0Lmxlbmd0aCA9PSAxICYmIGNoYW5nZS50ZXh0WzBdID09ICIiICYmIGNtcChjaGFuZ2UuZnJvbSwgY2hhbmdlLnRvKSA9PSAwKSB7IHJldHVybiB9DQogICAgdmFyIHNlbEFmdGVyID0gY29tcHV0ZVNlbEFmdGVyQ2hhbmdlKGRvYywgY2hhbmdlKTsNCiAgICBhZGRDaGFuZ2VUb0hpc3RvcnkoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBkb2MuY20gPyBkb2MuY20uY3VyT3AuaWQgOiBOYU4pOw0KDQogICAgbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIHN0cmV0Y2hTcGFuc092ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UpKTsNCiAgICB2YXIgcmViYXNlZCA9IFtdOw0KDQogICAgbGlua2VkRG9jcyhkb2MsIGZ1bmN0aW9uIChkb2MsIHNoYXJlZEhpc3QpIHsNCiAgICAgIGlmICghc2hhcmVkSGlzdCAmJiBpbmRleE9mKHJlYmFzZWQsIGRvYy5oaXN0b3J5KSA9PSAtMSkgew0KICAgICAgICByZWJhc2VIaXN0KGRvYy5oaXN0b3J5LCBjaGFuZ2UpOw0KICAgICAgICByZWJhc2VkLnB1c2goZG9jLmhpc3RvcnkpOw0KICAgICAgfQ0KICAgICAgbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgbnVsbCwgc3RyZXRjaFNwYW5zT3ZlckNoYW5nZShkb2MsIGNoYW5nZSkpOw0KICAgIH0pOw0KICB9DQoNCiAgLy8gUmV2ZXJ0IGEgY2hhbmdlIHN0b3JlZCBpbiBhIGRvY3VtZW50J3MgaGlzdG9yeS4NCiAgZnVuY3Rpb24gbWFrZUNoYW5nZUZyb21IaXN0b3J5KGRvYywgdHlwZSwgYWxsb3dTZWxlY3Rpb25Pbmx5KSB7DQogICAgdmFyIHN1cHByZXNzID0gZG9jLmNtICYmIGRvYy5jbS5zdGF0ZS5zdXBwcmVzc0VkaXRzOw0KICAgIGlmIChzdXBwcmVzcyAmJiAhYWxsb3dTZWxlY3Rpb25Pbmx5KSB7IHJldHVybiB9DQoNCiAgICB2YXIgaGlzdCA9IGRvYy5oaXN0b3J5LCBldmVudCwgc2VsQWZ0ZXIgPSBkb2Muc2VsOw0KICAgIHZhciBzb3VyY2UgPSB0eXBlID09ICJ1bmRvIiA/IGhpc3QuZG9uZSA6IGhpc3QudW5kb25lLCBkZXN0ID0gdHlwZSA9PSAidW5kbyIgPyBoaXN0LnVuZG9uZSA6IGhpc3QuZG9uZTsNCg0KICAgIC8vIFZlcmlmeSB0aGF0IHRoZXJlIGlzIGEgdXNlYWJsZSBldmVudCAoc28gdGhhdCBjdHJsLXogd29uJ3QNCiAgICAvLyBuZWVkbGVzc2x5IGNsZWFyIHNlbGVjdGlvbiBldmVudHMpDQogICAgdmFyIGkgPSAwOw0KICAgIGZvciAoOyBpIDwgc291cmNlLmxlbmd0aDsgaSsrKSB7DQogICAgICBldmVudCA9IHNvdXJjZVtpXTsNCiAgICAgIGlmIChhbGxvd1NlbGVjdGlvbk9ubHkgPyBldmVudC5yYW5nZXMgJiYgIWV2ZW50LmVxdWFscyhkb2Muc2VsKSA6ICFldmVudC5yYW5nZXMpDQogICAgICAgIHsgYnJlYWsgfQ0KICAgIH0NCiAgICBpZiAoaSA9PSBzb3VyY2UubGVuZ3RoKSB7IHJldHVybiB9DQogICAgaGlzdC5sYXN0T3JpZ2luID0gaGlzdC5sYXN0U2VsT3JpZ2luID0gbnVsbDsNCg0KICAgIGZvciAoOzspIHsNCiAgICAgIGV2ZW50ID0gc291cmNlLnBvcCgpOw0KICAgICAgaWYgKGV2ZW50LnJhbmdlcykgew0KICAgICAgICBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KGV2ZW50LCBkZXN0KTsNCiAgICAgICAgaWYgKGFsbG93U2VsZWN0aW9uT25seSAmJiAhZXZlbnQuZXF1YWxzKGRvYy5zZWwpKSB7DQogICAgICAgICAgc2V0U2VsZWN0aW9uKGRvYywgZXZlbnQsIHtjbGVhclJlZG86IGZhbHNlfSk7DQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgc2VsQWZ0ZXIgPSBldmVudDsNCiAgICAgIH0gZWxzZSBpZiAoc3VwcHJlc3MpIHsNCiAgICAgICAgc291cmNlLnB1c2goZXZlbnQpOw0KICAgICAgICByZXR1cm4NCiAgICAgIH0gZWxzZSB7IGJyZWFrIH0NCiAgICB9DQoNCiAgICAvLyBCdWlsZCB1cCBhIHJldmVyc2UgY2hhbmdlIG9iamVjdCB0byBhZGQgdG8gdGhlIG9wcG9zaXRlIGhpc3RvcnkNCiAgICAvLyBzdGFjayAocmVkbyB3aGVuIHVuZG9pbmcsIGFuZCB2aWNlIHZlcnNhKS4NCiAgICB2YXIgYW50aUNoYW5nZXMgPSBbXTsNCiAgICBwdXNoU2VsZWN0aW9uVG9IaXN0b3J5KHNlbEFmdGVyLCBkZXN0KTsNCiAgICBkZXN0LnB1c2goe2NoYW5nZXM6IGFudGlDaGFuZ2VzLCBnZW5lcmF0aW9uOiBoaXN0LmdlbmVyYXRpb259KTsNCiAgICBoaXN0LmdlbmVyYXRpb24gPSBldmVudC5nZW5lcmF0aW9uIHx8ICsraGlzdC5tYXhHZW5lcmF0aW9uOw0KDQogICAgdmFyIGZpbHRlciA9IGhhc0hhbmRsZXIoZG9jLCAiYmVmb3JlQ2hhbmdlIikgfHwgZG9jLmNtICYmIGhhc0hhbmRsZXIoZG9jLmNtLCAiYmVmb3JlQ2hhbmdlIik7DQoNCiAgICB2YXIgbG9vcCA9IGZ1bmN0aW9uICggaSApIHsNCiAgICAgIHZhciBjaGFuZ2UgPSBldmVudC5jaGFuZ2VzW2ldOw0KICAgICAgY2hhbmdlLm9yaWdpbiA9IHR5cGU7DQogICAgICBpZiAoZmlsdGVyICYmICFmaWx0ZXJDaGFuZ2UoZG9jLCBjaGFuZ2UsIGZhbHNlKSkgew0KICAgICAgICBzb3VyY2UubGVuZ3RoID0gMDsNCiAgICAgICAgcmV0dXJuIHt9DQogICAgICB9DQoNCiAgICAgIGFudGlDaGFuZ2VzLnB1c2goaGlzdG9yeUNoYW5nZUZyb21DaGFuZ2UoZG9jLCBjaGFuZ2UpKTsNCg0KICAgICAgdmFyIGFmdGVyID0gaSA/IGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSkgOiBsc3Qoc291cmNlKTsNCiAgICAgIG1ha2VDaGFuZ2VTaW5nbGVEb2MoZG9jLCBjaGFuZ2UsIGFmdGVyLCBtZXJnZU9sZFNwYW5zKGRvYywgY2hhbmdlKSk7DQogICAgICBpZiAoIWkgJiYgZG9jLmNtKSB7IGRvYy5jbS5zY3JvbGxJbnRvVmlldyh7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBjaGFuZ2VFbmQoY2hhbmdlKX0pOyB9DQogICAgICB2YXIgcmViYXNlZCA9IFtdOw0KDQogICAgICAvLyBQcm9wYWdhdGUgdG8gdGhlIGxpbmtlZCBkb2N1bWVudHMNCiAgICAgIGxpbmtlZERvY3MoZG9jLCBmdW5jdGlvbiAoZG9jLCBzaGFyZWRIaXN0KSB7DQogICAgICAgIGlmICghc2hhcmVkSGlzdCAmJiBpbmRleE9mKHJlYmFzZWQsIGRvYy5oaXN0b3J5KSA9PSAtMSkgew0KICAgICAgICAgIHJlYmFzZUhpc3QoZG9jLmhpc3RvcnksIGNoYW5nZSk7DQogICAgICAgICAgcmViYXNlZC5wdXNoKGRvYy5oaXN0b3J5KTsNCiAgICAgICAgfQ0KICAgICAgICBtYWtlQ2hhbmdlU2luZ2xlRG9jKGRvYywgY2hhbmdlLCBudWxsLCBtZXJnZU9sZFNwYW5zKGRvYywgY2hhbmdlKSk7DQogICAgICB9KTsNCiAgICB9Ow0KDQogICAgZm9yICh2YXIgaSQxID0gZXZlbnQuY2hhbmdlcy5sZW5ndGggLSAxOyBpJDEgPj0gMDsgLS1pJDEpIHsNCiAgICAgIHZhciByZXR1cm5lZCA9IGxvb3AoIGkkMSApOw0KDQogICAgICBpZiAoIHJldHVybmVkICkgcmV0dXJuIHJldHVybmVkLnY7DQogICAgfQ0KICB9DQoNCiAgLy8gU3ViLXZpZXdzIG5lZWQgdGhlaXIgbGluZSBudW1iZXJzIHNoaWZ0ZWQgd2hlbiB0ZXh0IGlzIGFkZGVkDQogIC8vIGFib3ZlIG9yIGJlbG93IHRoZW0gaW4gdGhlIHBhcmVudCBkb2N1bWVudC4NCiAgZnVuY3Rpb24gc2hpZnREb2MoZG9jLCBkaXN0YW5jZSkgew0KICAgIGlmIChkaXN0YW5jZSA9PSAwKSB7IHJldHVybiB9DQogICAgZG9jLmZpcnN0ICs9IGRpc3RhbmNlOw0KICAgIGRvYy5zZWwgPSBuZXcgU2VsZWN0aW9uKG1hcChkb2Muc2VsLnJhbmdlcywgZnVuY3Rpb24gKHJhbmdlKSB7IHJldHVybiBuZXcgUmFuZ2UoDQogICAgICBQb3MocmFuZ2UuYW5jaG9yLmxpbmUgKyBkaXN0YW5jZSwgcmFuZ2UuYW5jaG9yLmNoKSwNCiAgICAgIFBvcyhyYW5nZS5oZWFkLmxpbmUgKyBkaXN0YW5jZSwgcmFuZ2UuaGVhZC5jaCkNCiAgICApOyB9KSwgZG9jLnNlbC5wcmltSW5kZXgpOw0KICAgIGlmIChkb2MuY20pIHsNCiAgICAgIHJlZ0NoYW5nZShkb2MuY20sIGRvYy5maXJzdCwgZG9jLmZpcnN0IC0gZGlzdGFuY2UsIGRpc3RhbmNlKTsNCiAgICAgIGZvciAodmFyIGQgPSBkb2MuY20uZGlzcGxheSwgbCA9IGQudmlld0Zyb207IGwgPCBkLnZpZXdUbzsgbCsrKQ0KICAgICAgICB7IHJlZ0xpbmVDaGFuZ2UoZG9jLmNtLCBsLCAiZ3V0dGVyIik7IH0NCiAgICB9DQogIH0NCg0KICAvLyBNb3JlIGxvd2VyLWxldmVsIGNoYW5nZSBmdW5jdGlvbiwgaGFuZGxpbmcgb25seSBhIHNpbmdsZSBkb2N1bWVudA0KICAvLyAobm90IGxpbmtlZCBvbmVzKS4NCiAgZnVuY3Rpb24gbWFrZUNoYW5nZVNpbmdsZURvYyhkb2MsIGNoYW5nZSwgc2VsQWZ0ZXIsIHNwYW5zKSB7DQogICAgaWYgKGRvYy5jbSAmJiAhZG9jLmNtLmN1ck9wKQ0KICAgICAgeyByZXR1cm4gb3BlcmF0aW9uKGRvYy5jbSwgbWFrZUNoYW5nZVNpbmdsZURvYykoZG9jLCBjaGFuZ2UsIHNlbEFmdGVyLCBzcGFucykgfQ0KDQogICAgaWYgKGNoYW5nZS50by5saW5lIDwgZG9jLmZpcnN0KSB7DQogICAgICBzaGlmdERvYyhkb2MsIGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDEgLSAoY2hhbmdlLnRvLmxpbmUgLSBjaGFuZ2UuZnJvbS5saW5lKSk7DQogICAgICByZXR1cm4NCiAgICB9DQogICAgaWYgKGNoYW5nZS5mcm9tLmxpbmUgPiBkb2MubGFzdExpbmUoKSkgeyByZXR1cm4gfQ0KDQogICAgLy8gQ2xpcCB0aGUgY2hhbmdlIHRvIHRoZSBzaXplIG9mIHRoaXMgZG9jDQogICAgaWYgKGNoYW5nZS5mcm9tLmxpbmUgPCBkb2MuZmlyc3QpIHsNCiAgICAgIHZhciBzaGlmdCA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtIDEgLSAoZG9jLmZpcnN0IC0gY2hhbmdlLmZyb20ubGluZSk7DQogICAgICBzaGlmdERvYyhkb2MsIHNoaWZ0KTsNCiAgICAgIGNoYW5nZSA9IHtmcm9tOiBQb3MoZG9jLmZpcnN0LCAwKSwgdG86IFBvcyhjaGFuZ2UudG8ubGluZSArIHNoaWZ0LCBjaGFuZ2UudG8uY2gpLA0KICAgICAgICAgICAgICAgIHRleHQ6IFtsc3QoY2hhbmdlLnRleHQpXSwgb3JpZ2luOiBjaGFuZ2Uub3JpZ2lufTsNCiAgICB9DQogICAgdmFyIGxhc3QgPSBkb2MubGFzdExpbmUoKTsNCiAgICBpZiAoY2hhbmdlLnRvLmxpbmUgPiBsYXN0KSB7DQogICAgICBjaGFuZ2UgPSB7ZnJvbTogY2hhbmdlLmZyb20sIHRvOiBQb3MobGFzdCwgZ2V0TGluZShkb2MsIGxhc3QpLnRleHQubGVuZ3RoKSwNCiAgICAgICAgICAgICAgICB0ZXh0OiBbY2hhbmdlLnRleHRbMF1dLCBvcmlnaW46IGNoYW5nZS5vcmlnaW59Ow0KICAgIH0NCg0KICAgIGNoYW5nZS5yZW1vdmVkID0gZ2V0QmV0d2Vlbihkb2MsIGNoYW5nZS5mcm9tLCBjaGFuZ2UudG8pOw0KDQogICAgaWYgKCFzZWxBZnRlcikgeyBzZWxBZnRlciA9IGNvbXB1dGVTZWxBZnRlckNoYW5nZShkb2MsIGNoYW5nZSk7IH0NCiAgICBpZiAoZG9jLmNtKSB7IG1ha2VDaGFuZ2VTaW5nbGVEb2NJbkVkaXRvcihkb2MuY20sIGNoYW5nZSwgc3BhbnMpOyB9DQogICAgZWxzZSB7IHVwZGF0ZURvYyhkb2MsIGNoYW5nZSwgc3BhbnMpOyB9DQogICAgc2V0U2VsZWN0aW9uTm9VbmRvKGRvYywgc2VsQWZ0ZXIsIHNlbF9kb250U2Nyb2xsKTsNCg0KICAgIGlmIChkb2MuY2FudEVkaXQgJiYgc2tpcEF0b21pYyhkb2MsIFBvcyhkb2MuZmlyc3RMaW5lKCksIDApKSkNCiAgICAgIHsgZG9jLmNhbnRFZGl0ID0gZmFsc2U7IH0NCiAgfQ0KDQogIC8vIEhhbmRsZSB0aGUgaW50ZXJhY3Rpb24gb2YgYSBjaGFuZ2UgdG8gYSBkb2N1bWVudCB3aXRoIHRoZSBlZGl0b3INCiAgLy8gdGhhdCB0aGlzIGRvY3VtZW50IGlzIHBhcnQgb2YuDQogIGZ1bmN0aW9uIG1ha2VDaGFuZ2VTaW5nbGVEb2NJbkVkaXRvcihjbSwgY2hhbmdlLCBzcGFucykgew0KICAgIHZhciBkb2MgPSBjbS5kb2MsIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBmcm9tID0gY2hhbmdlLmZyb20sIHRvID0gY2hhbmdlLnRvOw0KDQogICAgdmFyIHJlY29tcHV0ZU1heExlbmd0aCA9IGZhbHNlLCBjaGVja1dpZHRoU3RhcnQgPSBmcm9tLmxpbmU7DQogICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgew0KICAgICAgY2hlY2tXaWR0aFN0YXJ0ID0gbGluZU5vKHZpc3VhbExpbmUoZ2V0TGluZShkb2MsIGZyb20ubGluZSkpKTsNCiAgICAgIGRvYy5pdGVyKGNoZWNrV2lkdGhTdGFydCwgdG8ubGluZSArIDEsIGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIGlmIChsaW5lID09IGRpc3BsYXkubWF4TGluZSkgew0KICAgICAgICAgIHJlY29tcHV0ZU1heExlbmd0aCA9IHRydWU7DQogICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgfQ0KICAgICAgfSk7DQogICAgfQ0KDQogICAgaWYgKGRvYy5zZWwuY29udGFpbnMoY2hhbmdlLmZyb20sIGNoYW5nZS50bykgPiAtMSkNCiAgICAgIHsgc2lnbmFsQ3Vyc29yQWN0aXZpdHkoY20pOyB9DQoNCiAgICB1cGRhdGVEb2MoZG9jLCBjaGFuZ2UsIHNwYW5zLCBlc3RpbWF0ZUhlaWdodChjbSkpOw0KDQogICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgew0KICAgICAgZG9jLml0ZXIoY2hlY2tXaWR0aFN0YXJ0LCBmcm9tLmxpbmUgKyBjaGFuZ2UudGV4dC5sZW5ndGgsIGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIHZhciBsZW4gPSBsaW5lTGVuZ3RoKGxpbmUpOw0KICAgICAgICBpZiAobGVuID4gZGlzcGxheS5tYXhMaW5lTGVuZ3RoKSB7DQogICAgICAgICAgZGlzcGxheS5tYXhMaW5lID0gbGluZTsNCiAgICAgICAgICBkaXNwbGF5Lm1heExpbmVMZW5ndGggPSBsZW47DQogICAgICAgICAgZGlzcGxheS5tYXhMaW5lQ2hhbmdlZCA9IHRydWU7DQogICAgICAgICAgcmVjb21wdXRlTWF4TGVuZ3RoID0gZmFsc2U7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgICAgaWYgKHJlY29tcHV0ZU1heExlbmd0aCkgeyBjbS5jdXJPcC51cGRhdGVNYXhMaW5lID0gdHJ1ZTsgfQ0KICAgIH0NCg0KICAgIHJldHJlYXRGcm9udGllcihkb2MsIGZyb20ubGluZSk7DQogICAgc3RhcnRXb3JrZXIoY20sIDQwMCk7DQoNCiAgICB2YXIgbGVuZGlmZiA9IGNoYW5nZS50ZXh0Lmxlbmd0aCAtICh0by5saW5lIC0gZnJvbS5saW5lKSAtIDE7DQogICAgLy8gUmVtZW1iZXIgdGhhdCB0aGVzZSBsaW5lcyBjaGFuZ2VkLCBmb3IgdXBkYXRpbmcgdGhlIGRpc3BsYXkNCiAgICBpZiAoY2hhbmdlLmZ1bGwpDQogICAgICB7IHJlZ0NoYW5nZShjbSk7IH0NCiAgICBlbHNlIGlmIChmcm9tLmxpbmUgPT0gdG8ubGluZSAmJiBjaGFuZ2UudGV4dC5sZW5ndGggPT0gMSAmJiAhaXNXaG9sZUxpbmVVcGRhdGUoY20uZG9jLCBjaGFuZ2UpKQ0KICAgICAgeyByZWdMaW5lQ2hhbmdlKGNtLCBmcm9tLmxpbmUsICJ0ZXh0Iik7IH0NCiAgICBlbHNlDQogICAgICB7IHJlZ0NoYW5nZShjbSwgZnJvbS5saW5lLCB0by5saW5lICsgMSwgbGVuZGlmZik7IH0NCg0KICAgIHZhciBjaGFuZ2VzSGFuZGxlciA9IGhhc0hhbmRsZXIoY20sICJjaGFuZ2VzIiksIGNoYW5nZUhhbmRsZXIgPSBoYXNIYW5kbGVyKGNtLCAiY2hhbmdlIik7DQogICAgaWYgKGNoYW5nZUhhbmRsZXIgfHwgY2hhbmdlc0hhbmRsZXIpIHsNCiAgICAgIHZhciBvYmogPSB7DQogICAgICAgIGZyb206IGZyb20sIHRvOiB0bywNCiAgICAgICAgdGV4dDogY2hhbmdlLnRleHQsDQogICAgICAgIHJlbW92ZWQ6IGNoYW5nZS5yZW1vdmVkLA0KICAgICAgICBvcmlnaW46IGNoYW5nZS5vcmlnaW4NCiAgICAgIH07DQogICAgICBpZiAoY2hhbmdlSGFuZGxlcikgeyBzaWduYWxMYXRlcihjbSwgImNoYW5nZSIsIGNtLCBvYmopOyB9DQogICAgICBpZiAoY2hhbmdlc0hhbmRsZXIpIHsgKGNtLmN1ck9wLmNoYW5nZU9ianMgfHwgKGNtLmN1ck9wLmNoYW5nZU9ianMgPSBbXSkpLnB1c2gob2JqKTsgfQ0KICAgIH0NCiAgICBjbS5kaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gbnVsbDsNCiAgfQ0KDQogIGZ1bmN0aW9uIHJlcGxhY2VSYW5nZShkb2MsIGNvZGUsIGZyb20sIHRvLCBvcmlnaW4pIHsNCiAgICB2YXIgYXNzaWduOw0KDQogICAgaWYgKCF0bykgeyB0byA9IGZyb207IH0NCiAgICBpZiAoY21wKHRvLCBmcm9tKSA8IDApIHsgKGFzc2lnbiA9IFt0bywgZnJvbV0sIGZyb20gPSBhc3NpZ25bMF0sIHRvID0gYXNzaWduWzFdKTsgfQ0KICAgIGlmICh0eXBlb2YgY29kZSA9PSAic3RyaW5nIikgeyBjb2RlID0gZG9jLnNwbGl0TGluZXMoY29kZSk7IH0NCiAgICBtYWtlQ2hhbmdlKGRvYywge2Zyb206IGZyb20sIHRvOiB0bywgdGV4dDogY29kZSwgb3JpZ2luOiBvcmlnaW59KTsNCiAgfQ0KDQogIC8vIFJlYmFzaW5nL3Jlc2V0dGluZyBoaXN0b3J5IHRvIGRlYWwgd2l0aCBleHRlcm5hbGx5LXNvdXJjZWQgY2hhbmdlcw0KDQogIGZ1bmN0aW9uIHJlYmFzZUhpc3RTZWxTaW5nbGUocG9zLCBmcm9tLCB0bywgZGlmZikgew0KICAgIGlmICh0byA8IHBvcy5saW5lKSB7DQogICAgICBwb3MubGluZSArPSBkaWZmOw0KICAgIH0gZWxzZSBpZiAoZnJvbSA8IHBvcy5saW5lKSB7DQogICAgICBwb3MubGluZSA9IGZyb207DQogICAgICBwb3MuY2ggPSAwOw0KICAgIH0NCiAgfQ0KDQogIC8vIFRyaWVzIHRvIHJlYmFzZSBhbiBhcnJheSBvZiBoaXN0b3J5IGV2ZW50cyBnaXZlbiBhIGNoYW5nZSBpbiB0aGUNCiAgLy8gZG9jdW1lbnQuIElmIHRoZSBjaGFuZ2UgdG91Y2hlcyB0aGUgc2FtZSBsaW5lcyBhcyB0aGUgZXZlbnQsIHRoZQ0KICAvLyBldmVudCwgYW5kIGV2ZXJ5dGhpbmcgJ2JlaGluZCcgaXQsIGlzIGRpc2NhcmRlZC4gSWYgdGhlIGNoYW5nZSBpcw0KICAvLyBiZWZvcmUgdGhlIGV2ZW50LCB0aGUgZXZlbnQncyBwb3NpdGlvbnMgYXJlIHVwZGF0ZWQuIFVzZXMgYQ0KICAvLyBjb3B5LW9uLXdyaXRlIHNjaGVtZSBmb3IgdGhlIHBvc2l0aW9ucywgdG8gYXZvaWQgaGF2aW5nIHRvDQogIC8vIHJlYWxsb2NhdGUgdGhlbSBhbGwgb24gZXZlcnkgcmViYXNlLCBidXQgYWxzbyBhdm9pZCBwcm9ibGVtcyB3aXRoDQogIC8vIHNoYXJlZCBwb3NpdGlvbiBvYmplY3RzIGJlaW5nIHVuc2FmZWx5IHVwZGF0ZWQuDQogIGZ1bmN0aW9uIHJlYmFzZUhpc3RBcnJheShhcnJheSwgZnJvbSwgdG8sIGRpZmYpIHsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGFycmF5Lmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgc3ViID0gYXJyYXlbaV0sIG9rID0gdHJ1ZTsNCiAgICAgIGlmIChzdWIucmFuZ2VzKSB7DQogICAgICAgIGlmICghc3ViLmNvcGllZCkgeyBzdWIgPSBhcnJheVtpXSA9IHN1Yi5kZWVwQ29weSgpOyBzdWIuY29waWVkID0gdHJ1ZTsgfQ0KICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IHN1Yi5yYW5nZXMubGVuZ3RoOyBqKyspIHsNCiAgICAgICAgICByZWJhc2VIaXN0U2VsU2luZ2xlKHN1Yi5yYW5nZXNbal0uYW5jaG9yLCBmcm9tLCB0bywgZGlmZik7DQogICAgICAgICAgcmViYXNlSGlzdFNlbFNpbmdsZShzdWIucmFuZ2VzW2pdLmhlYWQsIGZyb20sIHRvLCBkaWZmKTsNCiAgICAgICAgfQ0KICAgICAgICBjb250aW51ZQ0KICAgICAgfQ0KICAgICAgZm9yICh2YXIgaiQxID0gMDsgaiQxIDwgc3ViLmNoYW5nZXMubGVuZ3RoOyArK2okMSkgew0KICAgICAgICB2YXIgY3VyID0gc3ViLmNoYW5nZXNbaiQxXTsNCiAgICAgICAgaWYgKHRvIDwgY3VyLmZyb20ubGluZSkgew0KICAgICAgICAgIGN1ci5mcm9tID0gUG9zKGN1ci5mcm9tLmxpbmUgKyBkaWZmLCBjdXIuZnJvbS5jaCk7DQogICAgICAgICAgY3VyLnRvID0gUG9zKGN1ci50by5saW5lICsgZGlmZiwgY3VyLnRvLmNoKTsNCiAgICAgICAgfSBlbHNlIGlmIChmcm9tIDw9IGN1ci50by5saW5lKSB7DQogICAgICAgICAgb2sgPSBmYWxzZTsNCiAgICAgICAgICBicmVhaw0KICAgICAgICB9DQogICAgICB9DQogICAgICBpZiAoIW9rKSB7DQogICAgICAgIGFycmF5LnNwbGljZSgwLCBpICsgMSk7DQogICAgICAgIGkgPSAwOw0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHJlYmFzZUhpc3QoaGlzdCwgY2hhbmdlKSB7DQogICAgdmFyIGZyb20gPSBjaGFuZ2UuZnJvbS5saW5lLCB0byA9IGNoYW5nZS50by5saW5lLCBkaWZmID0gY2hhbmdlLnRleHQubGVuZ3RoIC0gKHRvIC0gZnJvbSkgLSAxOw0KICAgIHJlYmFzZUhpc3RBcnJheShoaXN0LmRvbmUsIGZyb20sIHRvLCBkaWZmKTsNCiAgICByZWJhc2VIaXN0QXJyYXkoaGlzdC51bmRvbmUsIGZyb20sIHRvLCBkaWZmKTsNCiAgfQ0KDQogIC8vIFV0aWxpdHkgZm9yIGFwcGx5aW5nIGEgY2hhbmdlIHRvIGEgbGluZSBieSBoYW5kbGUgb3IgbnVtYmVyLA0KICAvLyByZXR1cm5pbmcgdGhlIG51bWJlciBhbmQgb3B0aW9uYWxseSByZWdpc3RlcmluZyB0aGUgbGluZSBhcw0KICAvLyBjaGFuZ2VkLg0KICBmdW5jdGlvbiBjaGFuZ2VMaW5lKGRvYywgaGFuZGxlLCBjaGFuZ2VUeXBlLCBvcCkgew0KICAgIHZhciBubyA9IGhhbmRsZSwgbGluZSA9IGhhbmRsZTsNCiAgICBpZiAodHlwZW9mIGhhbmRsZSA9PSAibnVtYmVyIikgeyBsaW5lID0gZ2V0TGluZShkb2MsIGNsaXBMaW5lKGRvYywgaGFuZGxlKSk7IH0NCiAgICBlbHNlIHsgbm8gPSBsaW5lTm8oaGFuZGxlKTsgfQ0KICAgIGlmIChubyA9PSBudWxsKSB7IHJldHVybiBudWxsIH0NCiAgICBpZiAob3AobGluZSwgbm8pICYmIGRvYy5jbSkgeyByZWdMaW5lQ2hhbmdlKGRvYy5jbSwgbm8sIGNoYW5nZVR5cGUpOyB9DQogICAgcmV0dXJuIGxpbmUNCiAgfQ0KDQogIC8vIFRoZSBkb2N1bWVudCBpcyByZXByZXNlbnRlZCBhcyBhIEJUcmVlIGNvbnNpc3Rpbmcgb2YgbGVhdmVzLCB3aXRoDQogIC8vIGNodW5rIG9mIGxpbmVzIGluIHRoZW0sIGFuZCBicmFuY2hlcywgd2l0aCB1cCB0byB0ZW4gbGVhdmVzIG9yDQogIC8vIG90aGVyIGJyYW5jaCBub2RlcyBiZWxvdyB0aGVtLiBUaGUgdG9wIG5vZGUgaXMgYWx3YXlzIGEgYnJhbmNoDQogIC8vIG5vZGUsIGFuZCBpcyB0aGUgZG9jdW1lbnQgb2JqZWN0IGl0c2VsZiAobWVhbmluZyBpdCBoYXMNCiAgLy8gYWRkaXRpb25hbCBtZXRob2RzIGFuZCBwcm9wZXJ0aWVzKS4NCiAgLy8NCiAgLy8gQWxsIG5vZGVzIGhhdmUgcGFyZW50IGxpbmtzLiBUaGUgdHJlZSBpcyB1c2VkIGJvdGggdG8gZ28gZnJvbQ0KICAvLyBsaW5lIG51bWJlcnMgdG8gbGluZSBvYmplY3RzLCBhbmQgdG8gZ28gZnJvbSBvYmplY3RzIHRvIG51bWJlcnMuDQogIC8vIEl0IGFsc28gaW5kZXhlcyBieSBoZWlnaHQsIGFuZCBpcyB1c2VkIHRvIGNvbnZlcnQgYmV0d2VlbiBoZWlnaHQNCiAgLy8gYW5kIGxpbmUgb2JqZWN0LCBhbmQgdG8gZmluZCB0aGUgdG90YWwgaGVpZ2h0IG9mIHRoZSBkb2N1bWVudC4NCiAgLy8NCiAgLy8gU2VlIGFsc28gaHR0cDovL21hcmlqbmhhdmVyYmVrZS5ubC9ibG9nL2NvZGVtaXJyb3ItbGluZS10cmVlLmh0bWwNCg0KICBmdW5jdGlvbiBMZWFmQ2h1bmsobGluZXMpIHsNCiAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIHRoaXMubGluZXMgPSBsaW5lczsNCiAgICB0aGlzLnBhcmVudCA9IG51bGw7DQogICAgdmFyIGhlaWdodCA9IDA7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7ICsraSkgew0KICAgICAgbGluZXNbaV0ucGFyZW50ID0gdGhpcyQxOw0KICAgICAgaGVpZ2h0ICs9IGxpbmVzW2ldLmhlaWdodDsNCiAgICB9DQogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7DQogIH0NCg0KICBMZWFmQ2h1bmsucHJvdG90eXBlID0gew0KICAgIGNodW5rU2l6ZTogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLmxpbmVzLmxlbmd0aCB9LA0KDQogICAgLy8gUmVtb3ZlIHRoZSBuIGxpbmVzIGF0IG9mZnNldCAnYXQnLg0KICAgIHJlbW92ZUlubmVyOiBmdW5jdGlvbihhdCwgbikgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgIGZvciAodmFyIGkgPSBhdCwgZSA9IGF0ICsgbjsgaSA8IGU7ICsraSkgew0KICAgICAgICB2YXIgbGluZSA9IHRoaXMkMS5saW5lc1tpXTsNCiAgICAgICAgdGhpcyQxLmhlaWdodCAtPSBsaW5lLmhlaWdodDsNCiAgICAgICAgY2xlYW5VcExpbmUobGluZSk7DQogICAgICAgIHNpZ25hbExhdGVyKGxpbmUsICJkZWxldGUiKTsNCiAgICAgIH0NCiAgICAgIHRoaXMubGluZXMuc3BsaWNlKGF0LCBuKTsNCiAgICB9LA0KDQogICAgLy8gSGVscGVyIHVzZWQgdG8gY29sbGFwc2UgYSBzbWFsbCBicmFuY2ggaW50byBhIHNpbmdsZSBsZWFmLg0KICAgIGNvbGxhcHNlOiBmdW5jdGlvbihsaW5lcykgew0KICAgICAgbGluZXMucHVzaC5hcHBseShsaW5lcywgdGhpcy5saW5lcyk7DQogICAgfSwNCg0KICAgIC8vIEluc2VydCB0aGUgZ2l2ZW4gYXJyYXkgb2YgbGluZXMgYXQgb2Zmc2V0ICdhdCcsIGNvdW50IHRoZW0gYXMNCiAgICAvLyBoYXZpbmcgdGhlIGdpdmVuIGhlaWdodC4NCiAgICBpbnNlcnRJbm5lcjogZnVuY3Rpb24oYXQsIGxpbmVzLCBoZWlnaHQpIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgICB0aGlzLmhlaWdodCArPSBoZWlnaHQ7DQogICAgICB0aGlzLmxpbmVzID0gdGhpcy5saW5lcy5zbGljZSgwLCBhdCkuY29uY2F0KGxpbmVzKS5jb25jYXQodGhpcy5saW5lcy5zbGljZShhdCkpOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5lcy5sZW5ndGg7ICsraSkgeyBsaW5lc1tpXS5wYXJlbnQgPSB0aGlzJDE7IH0NCiAgICB9LA0KDQogICAgLy8gVXNlZCB0byBpdGVyYXRlIG92ZXIgYSBwYXJ0IG9mIHRoZSB0cmVlLg0KICAgIGl0ZXJOOiBmdW5jdGlvbihhdCwgbiwgb3ApIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgICBmb3IgKHZhciBlID0gYXQgKyBuOyBhdCA8IGU7ICsrYXQpDQogICAgICAgIHsgaWYgKG9wKHRoaXMkMS5saW5lc1thdF0pKSB7IHJldHVybiB0cnVlIH0gfQ0KICAgIH0NCiAgfTsNCg0KICBmdW5jdGlvbiBCcmFuY2hDaHVuayhjaGlsZHJlbikgew0KICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgdGhpcy5jaGlsZHJlbiA9IGNoaWxkcmVuOw0KICAgIHZhciBzaXplID0gMCwgaGVpZ2h0ID0gMDsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgKytpKSB7DQogICAgICB2YXIgY2ggPSBjaGlsZHJlbltpXTsNCiAgICAgIHNpemUgKz0gY2guY2h1bmtTaXplKCk7IGhlaWdodCArPSBjaC5oZWlnaHQ7DQogICAgICBjaC5wYXJlbnQgPSB0aGlzJDE7DQogICAgfQ0KICAgIHRoaXMuc2l6ZSA9IHNpemU7DQogICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7DQogICAgdGhpcy5wYXJlbnQgPSBudWxsOw0KICB9DQoNCiAgQnJhbmNoQ2h1bmsucHJvdG90eXBlID0gew0KICAgIGNodW5rU2l6ZTogZnVuY3Rpb24oKSB7IHJldHVybiB0aGlzLnNpemUgfSwNCg0KICAgIHJlbW92ZUlubmVyOiBmdW5jdGlvbihhdCwgbikgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgIHRoaXMuc2l6ZSAtPSBuOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7DQogICAgICAgIHZhciBjaGlsZCA9IHRoaXMkMS5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTsNCiAgICAgICAgaWYgKGF0IDwgc3opIHsNCiAgICAgICAgICB2YXIgcm0gPSBNYXRoLm1pbihuLCBzeiAtIGF0KSwgb2xkSGVpZ2h0ID0gY2hpbGQuaGVpZ2h0Ow0KICAgICAgICAgIGNoaWxkLnJlbW92ZUlubmVyKGF0LCBybSk7DQogICAgICAgICAgdGhpcyQxLmhlaWdodCAtPSBvbGRIZWlnaHQgLSBjaGlsZC5oZWlnaHQ7DQogICAgICAgICAgaWYgKHN6ID09IHJtKSB7IHRoaXMkMS5jaGlsZHJlbi5zcGxpY2UoaS0tLCAxKTsgY2hpbGQucGFyZW50ID0gbnVsbDsgfQ0KICAgICAgICAgIGlmICgobiAtPSBybSkgPT0gMCkgeyBicmVhayB9DQogICAgICAgICAgYXQgPSAwOw0KICAgICAgICB9IGVsc2UgeyBhdCAtPSBzejsgfQ0KICAgICAgfQ0KICAgICAgLy8gSWYgdGhlIHJlc3VsdCBpcyBzbWFsbGVyIHRoYW4gMjUgbGluZXMsIGVuc3VyZSB0aGF0IGl0IGlzIGENCiAgICAgIC8vIHNpbmdsZSBsZWFmIG5vZGUuDQogICAgICBpZiAodGhpcy5zaXplIC0gbiA8IDI1ICYmDQogICAgICAgICAgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoID4gMSB8fCAhKHRoaXMuY2hpbGRyZW5bMF0gaW5zdGFuY2VvZiBMZWFmQ2h1bmspKSkgew0KICAgICAgICB2YXIgbGluZXMgPSBbXTsNCiAgICAgICAgdGhpcy5jb2xsYXBzZShsaW5lcyk7DQogICAgICAgIHRoaXMuY2hpbGRyZW4gPSBbbmV3IExlYWZDaHVuayhsaW5lcyldOw0KICAgICAgICB0aGlzLmNoaWxkcmVuWzBdLnBhcmVudCA9IHRoaXM7DQogICAgICB9DQogICAgfSwNCg0KICAgIGNvbGxhcHNlOiBmdW5jdGlvbihsaW5lcykgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5jaGlsZHJlbi5sZW5ndGg7ICsraSkgeyB0aGlzJDEuY2hpbGRyZW5baV0uY29sbGFwc2UobGluZXMpOyB9DQogICAgfSwNCg0KICAgIGluc2VydElubmVyOiBmdW5jdGlvbihhdCwgbGluZXMsIGhlaWdodCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgIHRoaXMuc2l6ZSArPSBsaW5lcy5sZW5ndGg7DQogICAgICB0aGlzLmhlaWdodCArPSBoZWlnaHQ7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgdmFyIGNoaWxkID0gdGhpcyQxLmNoaWxkcmVuW2ldLCBzeiA9IGNoaWxkLmNodW5rU2l6ZSgpOw0KICAgICAgICBpZiAoYXQgPD0gc3opIHsNCiAgICAgICAgICBjaGlsZC5pbnNlcnRJbm5lcihhdCwgbGluZXMsIGhlaWdodCk7DQogICAgICAgICAgaWYgKGNoaWxkLmxpbmVzICYmIGNoaWxkLmxpbmVzLmxlbmd0aCA+IDUwKSB7DQogICAgICAgICAgICAvLyBUbyBhdm9pZCBtZW1vcnkgdGhyYXNoaW5nIHdoZW4gY2hpbGQubGluZXMgaXMgaHVnZSAoZS5nLiBmaXJzdCB2aWV3IG9mIGEgbGFyZ2UgZmlsZSksIGl0J3MgbmV2ZXIgc3BsaWNlZC4NCiAgICAgICAgICAgIC8vIEluc3RlYWQsIHNtYWxsIHNsaWNlcyBhcmUgdGFrZW4uIFRoZXkncmUgdGFrZW4gaW4gb3JkZXIgYmVjYXVzZSBzZXF1ZW50aWFsIG1lbW9yeSBhY2Nlc3NlcyBhcmUgZmFzdGVzdC4NCiAgICAgICAgICAgIHZhciByZW1haW5pbmcgPSBjaGlsZC5saW5lcy5sZW5ndGggJSAyNSArIDI1Ow0KICAgICAgICAgICAgZm9yICh2YXIgcG9zID0gcmVtYWluaW5nOyBwb3MgPCBjaGlsZC5saW5lcy5sZW5ndGg7KSB7DQogICAgICAgICAgICAgIHZhciBsZWFmID0gbmV3IExlYWZDaHVuayhjaGlsZC5saW5lcy5zbGljZShwb3MsIHBvcyArPSAyNSkpOw0KICAgICAgICAgICAgICBjaGlsZC5oZWlnaHQgLT0gbGVhZi5oZWlnaHQ7DQogICAgICAgICAgICAgIHRoaXMkMS5jaGlsZHJlbi5zcGxpY2UoKytpLCAwLCBsZWFmKTsNCiAgICAgICAgICAgICAgbGVhZi5wYXJlbnQgPSB0aGlzJDE7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBjaGlsZC5saW5lcyA9IGNoaWxkLmxpbmVzLnNsaWNlKDAsIHJlbWFpbmluZyk7DQogICAgICAgICAgICB0aGlzJDEubWF5YmVTcGlsbCgpOw0KICAgICAgICAgIH0NCiAgICAgICAgICBicmVhaw0KICAgICAgICB9DQogICAgICAgIGF0IC09IHN6Ow0KICAgICAgfQ0KICAgIH0sDQoNCiAgICAvLyBXaGVuIGEgbm9kZSBoYXMgZ3Jvd24sIGNoZWNrIHdoZXRoZXIgaXQgc2hvdWxkIGJlIHNwbGl0Lg0KICAgIG1heWJlU3BpbGw6IGZ1bmN0aW9uKCkgew0KICAgICAgaWYgKHRoaXMuY2hpbGRyZW4ubGVuZ3RoIDw9IDEwKSB7IHJldHVybiB9DQogICAgICB2YXIgbWUgPSB0aGlzOw0KICAgICAgZG8gew0KICAgICAgICB2YXIgc3BpbGxlZCA9IG1lLmNoaWxkcmVuLnNwbGljZShtZS5jaGlsZHJlbi5sZW5ndGggLSA1LCA1KTsNCiAgICAgICAgdmFyIHNpYmxpbmcgPSBuZXcgQnJhbmNoQ2h1bmsoc3BpbGxlZCk7DQogICAgICAgIGlmICghbWUucGFyZW50KSB7IC8vIEJlY29tZSB0aGUgcGFyZW50IG5vZGUNCiAgICAgICAgICB2YXIgY29weSA9IG5ldyBCcmFuY2hDaHVuayhtZS5jaGlsZHJlbik7DQogICAgICAgICAgY29weS5wYXJlbnQgPSBtZTsNCiAgICAgICAgICBtZS5jaGlsZHJlbiA9IFtjb3B5LCBzaWJsaW5nXTsNCiAgICAgICAgICBtZSA9IGNvcHk7DQogICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBtZS5zaXplIC09IHNpYmxpbmcuc2l6ZTsNCiAgICAgICAgICBtZS5oZWlnaHQgLT0gc2libGluZy5oZWlnaHQ7DQogICAgICAgICAgdmFyIG15SW5kZXggPSBpbmRleE9mKG1lLnBhcmVudC5jaGlsZHJlbiwgbWUpOw0KICAgICAgICAgIG1lLnBhcmVudC5jaGlsZHJlbi5zcGxpY2UobXlJbmRleCArIDEsIDAsIHNpYmxpbmcpOw0KICAgICAgICB9DQogICAgICAgIHNpYmxpbmcucGFyZW50ID0gbWUucGFyZW50Ow0KICAgICAgfSB3aGlsZSAobWUuY2hpbGRyZW4ubGVuZ3RoID4gMTApDQogICAgICBtZS5wYXJlbnQubWF5YmVTcGlsbCgpOw0KICAgIH0sDQoNCiAgICBpdGVyTjogZnVuY3Rpb24oYXQsIG4sIG9wKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7DQogICAgICAgIHZhciBjaGlsZCA9IHRoaXMkMS5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTsNCiAgICAgICAgaWYgKGF0IDwgc3opIHsNCiAgICAgICAgICB2YXIgdXNlZCA9IE1hdGgubWluKG4sIHN6IC0gYXQpOw0KICAgICAgICAgIGlmIChjaGlsZC5pdGVyTihhdCwgdXNlZCwgb3ApKSB7IHJldHVybiB0cnVlIH0NCiAgICAgICAgICBpZiAoKG4gLT0gdXNlZCkgPT0gMCkgeyBicmVhayB9DQogICAgICAgICAgYXQgPSAwOw0KICAgICAgICB9IGVsc2UgeyBhdCAtPSBzejsgfQ0KICAgICAgfQ0KICAgIH0NCiAgfTsNCg0KICAvLyBMaW5lIHdpZGdldHMgYXJlIGJsb2NrIGVsZW1lbnRzIGRpc3BsYXllZCBhYm92ZSBvciBiZWxvdyBhIGxpbmUuDQoNCiAgdmFyIExpbmVXaWRnZXQgPSBmdW5jdGlvbihkb2MsIG5vZGUsIG9wdGlvbnMpIHsNCiAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIGlmIChvcHRpb25zKSB7IGZvciAodmFyIG9wdCBpbiBvcHRpb25zKSB7IGlmIChvcHRpb25zLmhhc093blByb3BlcnR5KG9wdCkpDQogICAgICB7IHRoaXMkMVtvcHRdID0gb3B0aW9uc1tvcHRdOyB9IH0gfQ0KICAgIHRoaXMuZG9jID0gZG9jOw0KICAgIHRoaXMubm9kZSA9IG5vZGU7DQogIH07DQoNCiAgTGluZVdpZGdldC5wcm90b3R5cGUuY2xlYXIgPSBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIHZhciBjbSA9IHRoaXMuZG9jLmNtLCB3cyA9IHRoaXMubGluZS53aWRnZXRzLCBsaW5lID0gdGhpcy5saW5lLCBubyA9IGxpbmVObyhsaW5lKTsNCiAgICBpZiAobm8gPT0gbnVsbCB8fCAhd3MpIHsgcmV0dXJuIH0NCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHdzLmxlbmd0aDsgKytpKSB7IGlmICh3c1tpXSA9PSB0aGlzJDEpIHsgd3Muc3BsaWNlKGktLSwgMSk7IH0gfQ0KICAgIGlmICghd3MubGVuZ3RoKSB7IGxpbmUud2lkZ2V0cyA9IG51bGw7IH0NCiAgICB2YXIgaGVpZ2h0ID0gd2lkZ2V0SGVpZ2h0KHRoaXMpOw0KICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgTWF0aC5tYXgoMCwgbGluZS5oZWlnaHQgLSBoZWlnaHQpKTsNCiAgICBpZiAoY20pIHsNCiAgICAgIHJ1bkluT3AoY20sIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgYWRqdXN0U2Nyb2xsV2hlbkFib3ZlVmlzaWJsZShjbSwgbGluZSwgLWhlaWdodCk7DQogICAgICAgIHJlZ0xpbmVDaGFuZ2UoY20sIG5vLCAid2lkZ2V0Iik7DQogICAgICB9KTsNCiAgICAgIHNpZ25hbExhdGVyKGNtLCAibGluZVdpZGdldENsZWFyZWQiLCBjbSwgdGhpcywgbm8pOw0KICAgIH0NCiAgfTsNCg0KICBMaW5lV2lkZ2V0LnByb3RvdHlwZS5jaGFuZ2VkID0gZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICB2YXIgb2xkSCA9IHRoaXMuaGVpZ2h0LCBjbSA9IHRoaXMuZG9jLmNtLCBsaW5lID0gdGhpcy5saW5lOw0KICAgIHRoaXMuaGVpZ2h0ID0gbnVsbDsNCiAgICB2YXIgZGlmZiA9IHdpZGdldEhlaWdodCh0aGlzKSAtIG9sZEg7DQogICAgaWYgKCFkaWZmKSB7IHJldHVybiB9DQogICAgaWYgKCFsaW5lSXNIaWRkZW4odGhpcy5kb2MsIGxpbmUpKSB7IHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgbGluZS5oZWlnaHQgKyBkaWZmKTsgfQ0KICAgIGlmIChjbSkgew0KICAgICAgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkgew0KICAgICAgICBjbS5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7DQogICAgICAgIGFkanVzdFNjcm9sbFdoZW5BYm92ZVZpc2libGUoY20sIGxpbmUsIGRpZmYpOw0KICAgICAgICBzaWduYWxMYXRlcihjbSwgImxpbmVXaWRnZXRDaGFuZ2VkIiwgY20sIHRoaXMkMSwgbGluZU5vKGxpbmUpKTsNCiAgICAgIH0pOw0KICAgIH0NCiAgfTsNCiAgZXZlbnRNaXhpbihMaW5lV2lkZ2V0KTsNCg0KICBmdW5jdGlvbiBhZGp1c3RTY3JvbGxXaGVuQWJvdmVWaXNpYmxlKGNtLCBsaW5lLCBkaWZmKSB7DQogICAgaWYgKGhlaWdodEF0TGluZShsaW5lKSA8ICgoY20uY3VyT3AgJiYgY20uY3VyT3Auc2Nyb2xsVG9wKSB8fCBjbS5kb2Muc2Nyb2xsVG9wKSkNCiAgICAgIHsgYWRkVG9TY3JvbGxUb3AoY20sIGRpZmYpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBhZGRMaW5lV2lkZ2V0KGRvYywgaGFuZGxlLCBub2RlLCBvcHRpb25zKSB7DQogICAgdmFyIHdpZGdldCA9IG5ldyBMaW5lV2lkZ2V0KGRvYywgbm9kZSwgb3B0aW9ucyk7DQogICAgdmFyIGNtID0gZG9jLmNtOw0KICAgIGlmIChjbSAmJiB3aWRnZXQubm9IU2Nyb2xsKSB7IGNtLmRpc3BsYXkuYWxpZ25XaWRnZXRzID0gdHJ1ZTsgfQ0KICAgIGNoYW5nZUxpbmUoZG9jLCBoYW5kbGUsICJ3aWRnZXQiLCBmdW5jdGlvbiAobGluZSkgew0KICAgICAgdmFyIHdpZGdldHMgPSBsaW5lLndpZGdldHMgfHwgKGxpbmUud2lkZ2V0cyA9IFtdKTsNCiAgICAgIGlmICh3aWRnZXQuaW5zZXJ0QXQgPT0gbnVsbCkgeyB3aWRnZXRzLnB1c2god2lkZ2V0KTsgfQ0KICAgICAgZWxzZSB7IHdpZGdldHMuc3BsaWNlKE1hdGgubWluKHdpZGdldHMubGVuZ3RoIC0gMSwgTWF0aC5tYXgoMCwgd2lkZ2V0Lmluc2VydEF0KSksIDAsIHdpZGdldCk7IH0NCiAgICAgIHdpZGdldC5saW5lID0gbGluZTsNCiAgICAgIGlmIChjbSAmJiAhbGluZUlzSGlkZGVuKGRvYywgbGluZSkpIHsNCiAgICAgICAgdmFyIGFib3ZlVmlzaWJsZSA9IGhlaWdodEF0TGluZShsaW5lKSA8IGRvYy5zY3JvbGxUb3A7DQogICAgICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgbGluZS5oZWlnaHQgKyB3aWRnZXRIZWlnaHQod2lkZ2V0KSk7DQogICAgICAgIGlmIChhYm92ZVZpc2libGUpIHsgYWRkVG9TY3JvbGxUb3AoY20sIHdpZGdldC5oZWlnaHQpOyB9DQogICAgICAgIGNtLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0cnVlDQogICAgfSk7DQogICAgaWYgKGNtKSB7IHNpZ25hbExhdGVyKGNtLCAibGluZVdpZGdldEFkZGVkIiwgY20sIHdpZGdldCwgdHlwZW9mIGhhbmRsZSA9PSAibnVtYmVyIiA/IGhhbmRsZSA6IGxpbmVObyhoYW5kbGUpKTsgfQ0KICAgIHJldHVybiB3aWRnZXQNCiAgfQ0KDQogIC8vIFRFWFRNQVJLRVJTDQoNCiAgLy8gQ3JlYXRlZCB3aXRoIG1hcmtUZXh0IGFuZCBzZXRCb29rbWFyayBtZXRob2RzLiBBIFRleHRNYXJrZXIgaXMgYQ0KICAvLyBoYW5kbGUgdGhhdCBjYW4gYmUgdXNlZCB0byBjbGVhciBvciBmaW5kIGEgbWFya2VkIHBvc2l0aW9uIGluIHRoZQ0KICAvLyBkb2N1bWVudC4gTGluZSBvYmplY3RzIGhvbGQgYXJyYXlzIChtYXJrZWRTcGFucykgY29udGFpbmluZw0KICAvLyB7ZnJvbSwgdG8sIG1hcmtlcn0gb2JqZWN0IHBvaW50aW5nIHRvIHN1Y2ggbWFya2VyIG9iamVjdHMsIGFuZA0KICAvLyBpbmRpY2F0aW5nIHRoYXQgc3VjaCBhIG1hcmtlciBpcyBwcmVzZW50IG9uIHRoYXQgbGluZS4gTXVsdGlwbGUNCiAgLy8gbGluZXMgbWF5IHBvaW50IHRvIHRoZSBzYW1lIG1hcmtlciB3aGVuIGl0IHNwYW5zIGFjcm9zcyBsaW5lcy4NCiAgLy8gVGhlIHNwYW5zIHdpbGwgaGF2ZSBudWxsIGZvciB0aGVpciBmcm9tL3RvIHByb3BlcnRpZXMgd2hlbiB0aGUNCiAgLy8gbWFya2VyIGNvbnRpbnVlcyBiZXlvbmQgdGhlIHN0YXJ0L2VuZCBvZiB0aGUgbGluZS4gTWFya2VycyBoYXZlDQogIC8vIGxpbmtzIGJhY2sgdG8gdGhlIGxpbmVzIHRoZXkgY3VycmVudGx5IHRvdWNoLg0KDQogIC8vIENvbGxhcHNlZCBtYXJrZXJzIGhhdmUgdW5pcXVlIGlkcywgaW4gb3JkZXIgdG8gYmUgYWJsZSB0byBvcmRlcg0KICAvLyB0aGVtLCB3aGljaCBpcyBuZWVkZWQgZm9yIHVuaXF1ZWx5IGRldGVybWluaW5nIGFuIG91dGVyIG1hcmtlcg0KICAvLyB3aGVuIHRoZXkgb3ZlcmxhcCAodGhleSBtYXkgbmVzdCwgYnV0IG5vdCBwYXJ0aWFsbHkgb3ZlcmxhcCkuDQogIHZhciBuZXh0TWFya2VySWQgPSAwOw0KDQogIHZhciBUZXh0TWFya2VyID0gZnVuY3Rpb24oZG9jLCB0eXBlKSB7DQogICAgdGhpcy5saW5lcyA9IFtdOw0KICAgIHRoaXMudHlwZSA9IHR5cGU7DQogICAgdGhpcy5kb2MgPSBkb2M7DQogICAgdGhpcy5pZCA9ICsrbmV4dE1hcmtlcklkOw0KICB9Ow0KDQogIC8vIENsZWFyIHRoZSBtYXJrZXIuDQogIFRleHRNYXJrZXIucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICBpZiAodGhpcy5leHBsaWNpdGx5Q2xlYXJlZCkgeyByZXR1cm4gfQ0KICAgIHZhciBjbSA9IHRoaXMuZG9jLmNtLCB3aXRoT3AgPSBjbSAmJiAhY20uY3VyT3A7DQogICAgaWYgKHdpdGhPcCkgeyBzdGFydE9wZXJhdGlvbihjbSk7IH0NCiAgICBpZiAoaGFzSGFuZGxlcih0aGlzLCAiY2xlYXIiKSkgew0KICAgICAgdmFyIGZvdW5kID0gdGhpcy5maW5kKCk7DQogICAgICBpZiAoZm91bmQpIHsgc2lnbmFsTGF0ZXIodGhpcywgImNsZWFyIiwgZm91bmQuZnJvbSwgZm91bmQudG8pOyB9DQogICAgfQ0KICAgIHZhciBtaW4gPSBudWxsLCBtYXggPSBudWxsOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5lcy5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIGxpbmUgPSB0aGlzJDEubGluZXNbaV07DQogICAgICB2YXIgc3BhbiA9IGdldE1hcmtlZFNwYW5Gb3IobGluZS5tYXJrZWRTcGFucywgdGhpcyQxKTsNCiAgICAgIGlmIChjbSAmJiAhdGhpcyQxLmNvbGxhcHNlZCkgeyByZWdMaW5lQ2hhbmdlKGNtLCBsaW5lTm8obGluZSksICJ0ZXh0Iik7IH0NCiAgICAgIGVsc2UgaWYgKGNtKSB7DQogICAgICAgIGlmIChzcGFuLnRvICE9IG51bGwpIHsgbWF4ID0gbGluZU5vKGxpbmUpOyB9DQogICAgICAgIGlmIChzcGFuLmZyb20gIT0gbnVsbCkgeyBtaW4gPSBsaW5lTm8obGluZSk7IH0NCiAgICAgIH0NCiAgICAgIGxpbmUubWFya2VkU3BhbnMgPSByZW1vdmVNYXJrZWRTcGFuKGxpbmUubWFya2VkU3BhbnMsIHNwYW4pOw0KICAgICAgaWYgKHNwYW4uZnJvbSA9PSBudWxsICYmIHRoaXMkMS5jb2xsYXBzZWQgJiYgIWxpbmVJc0hpZGRlbih0aGlzJDEuZG9jLCBsaW5lKSAmJiBjbSkNCiAgICAgICAgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIHRleHRIZWlnaHQoY20uZGlzcGxheSkpOyB9DQogICAgfQ0KICAgIGlmIChjbSAmJiB0aGlzLmNvbGxhcHNlZCAmJiAhY20ub3B0aW9ucy5saW5lV3JhcHBpbmcpIHsgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgdGhpcy5saW5lcy5sZW5ndGg7ICsraSQxKSB7DQogICAgICB2YXIgdmlzdWFsID0gdmlzdWFsTGluZSh0aGlzJDEubGluZXNbaSQxXSksIGxlbiA9IGxpbmVMZW5ndGgodmlzdWFsKTsNCiAgICAgIGlmIChsZW4gPiBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGgpIHsNCiAgICAgICAgY20uZGlzcGxheS5tYXhMaW5lID0gdmlzdWFsOw0KICAgICAgICBjbS5kaXNwbGF5Lm1heExpbmVMZW5ndGggPSBsZW47DQogICAgICAgIGNtLmRpc3BsYXkubWF4TGluZUNoYW5nZWQgPSB0cnVlOw0KICAgICAgfQ0KICAgIH0gfQ0KDQogICAgaWYgKG1pbiAhPSBudWxsICYmIGNtICYmIHRoaXMuY29sbGFwc2VkKSB7IHJlZ0NoYW5nZShjbSwgbWluLCBtYXggKyAxKTsgfQ0KICAgIHRoaXMubGluZXMubGVuZ3RoID0gMDsNCiAgICB0aGlzLmV4cGxpY2l0bHlDbGVhcmVkID0gdHJ1ZTsNCiAgICBpZiAodGhpcy5hdG9taWMgJiYgdGhpcy5kb2MuY2FudEVkaXQpIHsNCiAgICAgIHRoaXMuZG9jLmNhbnRFZGl0ID0gZmFsc2U7DQogICAgICBpZiAoY20pIHsgcmVDaGVja1NlbGVjdGlvbihjbS5kb2MpOyB9DQogICAgfQ0KICAgIGlmIChjbSkgeyBzaWduYWxMYXRlcihjbSwgIm1hcmtlckNsZWFyZWQiLCBjbSwgdGhpcywgbWluLCBtYXgpOyB9DQogICAgaWYgKHdpdGhPcCkgeyBlbmRPcGVyYXRpb24oY20pOyB9DQogICAgaWYgKHRoaXMucGFyZW50KSB7IHRoaXMucGFyZW50LmNsZWFyKCk7IH0NCiAgfTsNCg0KICAvLyBGaW5kIHRoZSBwb3NpdGlvbiBvZiB0aGUgbWFya2VyIGluIHRoZSBkb2N1bWVudC4gUmV0dXJucyBhIHtmcm9tLA0KICAvLyB0b30gb2JqZWN0IGJ5IGRlZmF1bHQuIFNpZGUgY2FuIGJlIHBhc3NlZCB0byBnZXQgYSBzcGVjaWZpYyBzaWRlDQogIC8vIC0tIDAgKGJvdGgpLCAtMSAobGVmdCksIG9yIDEgKHJpZ2h0KS4gV2hlbiBsaW5lT2JqIGlzIHRydWUsIHRoZQ0KICAvLyBQb3Mgb2JqZWN0cyByZXR1cm5lZCBjb250YWluIGEgbGluZSBvYmplY3QsIHJhdGhlciB0aGFuIGEgbGluZQ0KICAvLyBudW1iZXIgKHVzZWQgdG8gcHJldmVudCBsb29raW5nIHVwIHRoZSBzYW1lIGxpbmUgdHdpY2UpLg0KICBUZXh0TWFya2VyLnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24gKHNpZGUsIGxpbmVPYmopIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgaWYgKHNpZGUgPT0gbnVsbCAmJiB0aGlzLnR5cGUgPT0gImJvb2ttYXJrIikgeyBzaWRlID0gMTsgfQ0KICAgIHZhciBmcm9tLCB0bzsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGluZXMubGVuZ3RoOyArK2kpIHsNCiAgICAgIHZhciBsaW5lID0gdGhpcyQxLmxpbmVzW2ldOw0KICAgICAgdmFyIHNwYW4gPSBnZXRNYXJrZWRTcGFuRm9yKGxpbmUubWFya2VkU3BhbnMsIHRoaXMkMSk7DQogICAgICBpZiAoc3Bhbi5mcm9tICE9IG51bGwpIHsNCiAgICAgICAgZnJvbSA9IFBvcyhsaW5lT2JqID8gbGluZSA6IGxpbmVObyhsaW5lKSwgc3Bhbi5mcm9tKTsNCiAgICAgICAgaWYgKHNpZGUgPT0gLTEpIHsgcmV0dXJuIGZyb20gfQ0KICAgICAgfQ0KICAgICAgaWYgKHNwYW4udG8gIT0gbnVsbCkgew0KICAgICAgICB0byA9IFBvcyhsaW5lT2JqID8gbGluZSA6IGxpbmVObyhsaW5lKSwgc3Bhbi50byk7DQogICAgICAgIGlmIChzaWRlID09IDEpIHsgcmV0dXJuIHRvIH0NCiAgICAgIH0NCiAgICB9DQogICAgcmV0dXJuIGZyb20gJiYge2Zyb206IGZyb20sIHRvOiB0b30NCiAgfTsNCg0KICAvLyBTaWduYWxzIHRoYXQgdGhlIG1hcmtlcidzIHdpZGdldCBjaGFuZ2VkLCBhbmQgc3Vycm91bmRpbmcgbGF5b3V0DQogIC8vIHNob3VsZCBiZSByZWNvbXB1dGVkLg0KICBUZXh0TWFya2VyLnByb3RvdHlwZS5jaGFuZ2VkID0gZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICB2YXIgcG9zID0gdGhpcy5maW5kKC0xLCB0cnVlKSwgd2lkZ2V0ID0gdGhpcywgY20gPSB0aGlzLmRvYy5jbTsNCiAgICBpZiAoIXBvcyB8fCAhY20pIHsgcmV0dXJuIH0NCiAgICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgbGluZSA9IHBvcy5saW5lLCBsaW5lTiA9IGxpbmVObyhwb3MubGluZSk7DQogICAgICB2YXIgdmlldyA9IGZpbmRWaWV3Rm9yTGluZShjbSwgbGluZU4pOw0KICAgICAgaWYgKHZpZXcpIHsNCiAgICAgICAgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZUZvcih2aWV3KTsNCiAgICAgICAgY20uY3VyT3Auc2VsZWN0aW9uQ2hhbmdlZCA9IGNtLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTsNCiAgICAgIH0NCiAgICAgIGNtLmN1ck9wLnVwZGF0ZU1heExpbmUgPSB0cnVlOw0KICAgICAgaWYgKCFsaW5lSXNIaWRkZW4od2lkZ2V0LmRvYywgbGluZSkgJiYgd2lkZ2V0LmhlaWdodCAhPSBudWxsKSB7DQogICAgICAgIHZhciBvbGRIZWlnaHQgPSB3aWRnZXQuaGVpZ2h0Ow0KICAgICAgICB3aWRnZXQuaGVpZ2h0ID0gbnVsbDsNCiAgICAgICAgdmFyIGRIZWlnaHQgPSB3aWRnZXRIZWlnaHQod2lkZ2V0KSAtIG9sZEhlaWdodDsNCiAgICAgICAgaWYgKGRIZWlnaHQpDQogICAgICAgICAgeyB1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsIGxpbmUuaGVpZ2h0ICsgZEhlaWdodCk7IH0NCiAgICAgIH0NCiAgICAgIHNpZ25hbExhdGVyKGNtLCAibWFya2VyQ2hhbmdlZCIsIGNtLCB0aGlzJDEpOw0KICAgIH0pOw0KICB9Ow0KDQogIFRleHRNYXJrZXIucHJvdG90eXBlLmF0dGFjaExpbmUgPSBmdW5jdGlvbiAobGluZSkgew0KICAgIGlmICghdGhpcy5saW5lcy5sZW5ndGggJiYgdGhpcy5kb2MuY20pIHsNCiAgICAgIHZhciBvcCA9IHRoaXMuZG9jLmNtLmN1ck9wOw0KICAgICAgaWYgKCFvcC5tYXliZUhpZGRlbk1hcmtlcnMgfHwgaW5kZXhPZihvcC5tYXliZUhpZGRlbk1hcmtlcnMsIHRoaXMpID09IC0xKQ0KICAgICAgICB7IChvcC5tYXliZVVuaGlkZGVuTWFya2VycyB8fCAob3AubWF5YmVVbmhpZGRlbk1hcmtlcnMgPSBbXSkpLnB1c2godGhpcyk7IH0NCiAgICB9DQogICAgdGhpcy5saW5lcy5wdXNoKGxpbmUpOw0KICB9Ow0KDQogIFRleHRNYXJrZXIucHJvdG90eXBlLmRldGFjaExpbmUgPSBmdW5jdGlvbiAobGluZSkgew0KICAgIHRoaXMubGluZXMuc3BsaWNlKGluZGV4T2YodGhpcy5saW5lcywgbGluZSksIDEpOw0KICAgIGlmICghdGhpcy5saW5lcy5sZW5ndGggJiYgdGhpcy5kb2MuY20pIHsNCiAgICAgIHZhciBvcCA9IHRoaXMuZG9jLmNtLmN1ck9wDQogICAgICA7KG9wLm1heWJlSGlkZGVuTWFya2VycyB8fCAob3AubWF5YmVIaWRkZW5NYXJrZXJzID0gW10pKS5wdXNoKHRoaXMpOw0KICAgIH0NCiAgfTsNCiAgZXZlbnRNaXhpbihUZXh0TWFya2VyKTsNCg0KICAvLyBDcmVhdGUgYSBtYXJrZXIsIHdpcmUgaXQgdXAgdG8gdGhlIHJpZ2h0IGxpbmVzLCBhbmQNCiAgZnVuY3Rpb24gbWFya1RleHQoZG9jLCBmcm9tLCB0bywgb3B0aW9ucywgdHlwZSkgew0KICAgIC8vIFNoYXJlZCBtYXJrZXJzIChhY3Jvc3MgbGlua2VkIGRvY3VtZW50cykgYXJlIGhhbmRsZWQgc2VwYXJhdGVseQ0KICAgIC8vIChtYXJrVGV4dFNoYXJlZCB3aWxsIGNhbGwgb3V0IHRvIHRoaXMgYWdhaW4sIG9uY2UgcGVyDQogICAgLy8gZG9jdW1lbnQpLg0KICAgIGlmIChvcHRpb25zICYmIG9wdGlvbnMuc2hhcmVkKSB7IHJldHVybiBtYXJrVGV4dFNoYXJlZChkb2MsIGZyb20sIHRvLCBvcHRpb25zLCB0eXBlKSB9DQogICAgLy8gRW5zdXJlIHdlIGFyZSBpbiBhbiBvcGVyYXRpb24uDQogICAgaWYgKGRvYy5jbSAmJiAhZG9jLmNtLmN1ck9wKSB7IHJldHVybiBvcGVyYXRpb24oZG9jLmNtLCBtYXJrVGV4dCkoZG9jLCBmcm9tLCB0bywgb3B0aW9ucywgdHlwZSkgfQ0KDQogICAgdmFyIG1hcmtlciA9IG5ldyBUZXh0TWFya2VyKGRvYywgdHlwZSksIGRpZmYgPSBjbXAoZnJvbSwgdG8pOw0KICAgIGlmIChvcHRpb25zKSB7IGNvcHlPYmoob3B0aW9ucywgbWFya2VyLCBmYWxzZSk7IH0NCiAgICAvLyBEb24ndCBjb25uZWN0IGVtcHR5IG1hcmtlcnMgdW5sZXNzIGNsZWFyV2hlbkVtcHR5IGlzIGZhbHNlDQogICAgaWYgKGRpZmYgPiAwIHx8IGRpZmYgPT0gMCAmJiBtYXJrZXIuY2xlYXJXaGVuRW1wdHkgIT09IGZhbHNlKQ0KICAgICAgeyByZXR1cm4gbWFya2VyIH0NCiAgICBpZiAobWFya2VyLnJlcGxhY2VkV2l0aCkgew0KICAgICAgLy8gU2hvd2luZyB1cCBhcyBhIHdpZGdldCBpbXBsaWVzIGNvbGxhcHNlZCAod2lkZ2V0IHJlcGxhY2VzIHRleHQpDQogICAgICBtYXJrZXIuY29sbGFwc2VkID0gdHJ1ZTsNCiAgICAgIG1hcmtlci53aWRnZXROb2RlID0gZWx0UCgic3BhbiIsIFttYXJrZXIucmVwbGFjZWRXaXRoXSwgIkNvZGVNaXJyb3Itd2lkZ2V0Iik7DQogICAgICBpZiAoIW9wdGlvbnMuaGFuZGxlTW91c2VFdmVudHMpIHsgbWFya2VyLndpZGdldE5vZGUuc2V0QXR0cmlidXRlKCJjbS1pZ25vcmUtZXZlbnRzIiwgInRydWUiKTsgfQ0KICAgICAgaWYgKG9wdGlvbnMuaW5zZXJ0TGVmdCkgeyBtYXJrZXIud2lkZ2V0Tm9kZS5pbnNlcnRMZWZ0ID0gdHJ1ZTsgfQ0KICAgIH0NCiAgICBpZiAobWFya2VyLmNvbGxhcHNlZCkgew0KICAgICAgaWYgKGNvbmZsaWN0aW5nQ29sbGFwc2VkUmFuZ2UoZG9jLCBmcm9tLmxpbmUsIGZyb20sIHRvLCBtYXJrZXIpIHx8DQogICAgICAgICAgZnJvbS5saW5lICE9IHRvLmxpbmUgJiYgY29uZmxpY3RpbmdDb2xsYXBzZWRSYW5nZShkb2MsIHRvLmxpbmUsIGZyb20sIHRvLCBtYXJrZXIpKQ0KICAgICAgICB7IHRocm93IG5ldyBFcnJvcigiSW5zZXJ0aW5nIGNvbGxhcHNlZCBtYXJrZXIgcGFydGlhbGx5IG92ZXJsYXBwaW5nIGFuIGV4aXN0aW5nIG9uZSIpIH0NCiAgICAgIHNlZUNvbGxhcHNlZFNwYW5zKCk7DQogICAgfQ0KDQogICAgaWYgKG1hcmtlci5hZGRUb0hpc3RvcnkpDQogICAgICB7IGFkZENoYW5nZVRvSGlzdG9yeShkb2MsIHtmcm9tOiBmcm9tLCB0bzogdG8sIG9yaWdpbjogIm1hcmtUZXh0In0sIGRvYy5zZWwsIE5hTik7IH0NCg0KICAgIHZhciBjdXJMaW5lID0gZnJvbS5saW5lLCBjbSA9IGRvYy5jbSwgdXBkYXRlTWF4TGluZTsNCiAgICBkb2MuaXRlcihjdXJMaW5lLCB0by5saW5lICsgMSwgZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgIGlmIChjbSAmJiBtYXJrZXIuY29sbGFwc2VkICYmICFjbS5vcHRpb25zLmxpbmVXcmFwcGluZyAmJiB2aXN1YWxMaW5lKGxpbmUpID09IGNtLmRpc3BsYXkubWF4TGluZSkNCiAgICAgICAgeyB1cGRhdGVNYXhMaW5lID0gdHJ1ZTsgfQ0KICAgICAgaWYgKG1hcmtlci5jb2xsYXBzZWQgJiYgY3VyTGluZSAhPSBmcm9tLmxpbmUpIHsgdXBkYXRlTGluZUhlaWdodChsaW5lLCAwKTsgfQ0KICAgICAgYWRkTWFya2VkU3BhbihsaW5lLCBuZXcgTWFya2VkU3BhbihtYXJrZXIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ckxpbmUgPT0gZnJvbS5saW5lID8gZnJvbS5jaCA6IG51bGwsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1ckxpbmUgPT0gdG8ubGluZSA/IHRvLmNoIDogbnVsbCkpOw0KICAgICAgKytjdXJMaW5lOw0KICAgIH0pOw0KICAgIC8vIGxpbmVJc0hpZGRlbiBkZXBlbmRzIG9uIHRoZSBwcmVzZW5jZSBvZiB0aGUgc3BhbnMsIHNvIG5lZWRzIGEgc2Vjb25kIHBhc3MNCiAgICBpZiAobWFya2VyLmNvbGxhcHNlZCkgeyBkb2MuaXRlcihmcm9tLmxpbmUsIHRvLmxpbmUgKyAxLCBmdW5jdGlvbiAobGluZSkgew0KICAgICAgaWYgKGxpbmVJc0hpZGRlbihkb2MsIGxpbmUpKSB7IHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgMCk7IH0NCiAgICB9KTsgfQ0KDQogICAgaWYgKG1hcmtlci5jbGVhck9uRW50ZXIpIHsgb24obWFya2VyLCAiYmVmb3JlQ3Vyc29yRW50ZXIiLCBmdW5jdGlvbiAoKSB7IHJldHVybiBtYXJrZXIuY2xlYXIoKTsgfSk7IH0NCg0KICAgIGlmIChtYXJrZXIucmVhZE9ubHkpIHsNCiAgICAgIHNlZVJlYWRPbmx5U3BhbnMoKTsNCiAgICAgIGlmIChkb2MuaGlzdG9yeS5kb25lLmxlbmd0aCB8fCBkb2MuaGlzdG9yeS51bmRvbmUubGVuZ3RoKQ0KICAgICAgICB7IGRvYy5jbGVhckhpc3RvcnkoKTsgfQ0KICAgIH0NCiAgICBpZiAobWFya2VyLmNvbGxhcHNlZCkgew0KICAgICAgbWFya2VyLmlkID0gKytuZXh0TWFya2VySWQ7DQogICAgICBtYXJrZXIuYXRvbWljID0gdHJ1ZTsNCiAgICB9DQogICAgaWYgKGNtKSB7DQogICAgICAvLyBTeW5jIGVkaXRvciBzdGF0ZQ0KICAgICAgaWYgKHVwZGF0ZU1heExpbmUpIHsgY20uY3VyT3AudXBkYXRlTWF4TGluZSA9IHRydWU7IH0NCiAgICAgIGlmIChtYXJrZXIuY29sbGFwc2VkKQ0KICAgICAgICB7IHJlZ0NoYW5nZShjbSwgZnJvbS5saW5lLCB0by5saW5lICsgMSk7IH0NCiAgICAgIGVsc2UgaWYgKG1hcmtlci5jbGFzc05hbWUgfHwgbWFya2VyLnN0YXJ0U3R5bGUgfHwgbWFya2VyLmVuZFN0eWxlIHx8IG1hcmtlci5jc3MgfHwNCiAgICAgICAgICAgICAgIG1hcmtlci5hdHRyaWJ1dGVzIHx8IG1hcmtlci50aXRsZSkNCiAgICAgICAgeyBmb3IgKHZhciBpID0gZnJvbS5saW5lOyBpIDw9IHRvLmxpbmU7IGkrKykgeyByZWdMaW5lQ2hhbmdlKGNtLCBpLCAidGV4dCIpOyB9IH0NCiAgICAgIGlmIChtYXJrZXIuYXRvbWljKSB7IHJlQ2hlY2tTZWxlY3Rpb24oY20uZG9jKTsgfQ0KICAgICAgc2lnbmFsTGF0ZXIoY20sICJtYXJrZXJBZGRlZCIsIGNtLCBtYXJrZXIpOw0KICAgIH0NCiAgICByZXR1cm4gbWFya2VyDQogIH0NCg0KICAvLyBTSEFSRUQgVEVYVE1BUktFUlMNCg0KICAvLyBBIHNoYXJlZCBtYXJrZXIgc3BhbnMgbXVsdGlwbGUgbGlua2VkIGRvY3VtZW50cy4gSXQgaXMNCiAgLy8gaW1wbGVtZW50ZWQgYXMgYSBtZXRhLW1hcmtlci1vYmplY3QgY29udHJvbGxpbmcgbXVsdGlwbGUgbm9ybWFsDQogIC8vIG1hcmtlcnMuDQogIHZhciBTaGFyZWRUZXh0TWFya2VyID0gZnVuY3Rpb24obWFya2VycywgcHJpbWFyeSkgew0KICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgdGhpcy5tYXJrZXJzID0gbWFya2VyczsNCiAgICB0aGlzLnByaW1hcnkgPSBwcmltYXJ5Ow0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya2Vycy5sZW5ndGg7ICsraSkNCiAgICAgIHsgbWFya2Vyc1tpXS5wYXJlbnQgPSB0aGlzJDE7IH0NCiAgfTsNCg0KICBTaGFyZWRUZXh0TWFya2VyLnByb3RvdHlwZS5jbGVhciA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgaWYgKHRoaXMuZXhwbGljaXRseUNsZWFyZWQpIHsgcmV0dXJuIH0NCiAgICB0aGlzLmV4cGxpY2l0bHlDbGVhcmVkID0gdHJ1ZTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubWFya2Vycy5sZW5ndGg7ICsraSkNCiAgICAgIHsgdGhpcyQxLm1hcmtlcnNbaV0uY2xlYXIoKTsgfQ0KICAgIHNpZ25hbExhdGVyKHRoaXMsICJjbGVhciIpOw0KICB9Ow0KDQogIFNoYXJlZFRleHRNYXJrZXIucHJvdG90eXBlLmZpbmQgPSBmdW5jdGlvbiAoc2lkZSwgbGluZU9iaikgew0KICAgIHJldHVybiB0aGlzLnByaW1hcnkuZmluZChzaWRlLCBsaW5lT2JqKQ0KICB9Ow0KICBldmVudE1peGluKFNoYXJlZFRleHRNYXJrZXIpOw0KDQogIGZ1bmN0aW9uIG1hcmtUZXh0U2hhcmVkKGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpIHsNCiAgICBvcHRpb25zID0gY29weU9iaihvcHRpb25zKTsNCiAgICBvcHRpb25zLnNoYXJlZCA9IGZhbHNlOw0KICAgIHZhciBtYXJrZXJzID0gW21hcmtUZXh0KGRvYywgZnJvbSwgdG8sIG9wdGlvbnMsIHR5cGUpXSwgcHJpbWFyeSA9IG1hcmtlcnNbMF07DQogICAgdmFyIHdpZGdldCA9IG9wdGlvbnMud2lkZ2V0Tm9kZTsNCiAgICBsaW5rZWREb2NzKGRvYywgZnVuY3Rpb24gKGRvYykgew0KICAgICAgaWYgKHdpZGdldCkgeyBvcHRpb25zLndpZGdldE5vZGUgPSB3aWRnZXQuY2xvbmVOb2RlKHRydWUpOyB9DQogICAgICBtYXJrZXJzLnB1c2gobWFya1RleHQoZG9jLCBjbGlwUG9zKGRvYywgZnJvbSksIGNsaXBQb3MoZG9jLCB0byksIG9wdGlvbnMsIHR5cGUpKTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZG9jLmxpbmtlZC5sZW5ndGg7ICsraSkNCiAgICAgICAgeyBpZiAoZG9jLmxpbmtlZFtpXS5pc1BhcmVudCkgeyByZXR1cm4gfSB9DQogICAgICBwcmltYXJ5ID0gbHN0KG1hcmtlcnMpOw0KICAgIH0pOw0KICAgIHJldHVybiBuZXcgU2hhcmVkVGV4dE1hcmtlcihtYXJrZXJzLCBwcmltYXJ5KQ0KICB9DQoNCiAgZnVuY3Rpb24gZmluZFNoYXJlZE1hcmtlcnMoZG9jKSB7DQogICAgcmV0dXJuIGRvYy5maW5kTWFya3MoUG9zKGRvYy5maXJzdCwgMCksIGRvYy5jbGlwUG9zKFBvcyhkb2MubGFzdExpbmUoKSkpLCBmdW5jdGlvbiAobSkgeyByZXR1cm4gbS5wYXJlbnQ7IH0pDQogIH0NCg0KICBmdW5jdGlvbiBjb3B5U2hhcmVkTWFya2Vycyhkb2MsIG1hcmtlcnMpIHsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcmtlcnMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBtYXJrZXIgPSBtYXJrZXJzW2ldLCBwb3MgPSBtYXJrZXIuZmluZCgpOw0KICAgICAgdmFyIG1Gcm9tID0gZG9jLmNsaXBQb3MocG9zLmZyb20pLCBtVG8gPSBkb2MuY2xpcFBvcyhwb3MudG8pOw0KICAgICAgaWYgKGNtcChtRnJvbSwgbVRvKSkgew0KICAgICAgICB2YXIgc3ViTWFyayA9IG1hcmtUZXh0KGRvYywgbUZyb20sIG1UbywgbWFya2VyLnByaW1hcnksIG1hcmtlci5wcmltYXJ5LnR5cGUpOw0KICAgICAgICBtYXJrZXIubWFya2Vycy5wdXNoKHN1Yk1hcmspOw0KICAgICAgICBzdWJNYXJrLnBhcmVudCA9IG1hcmtlcjsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBkZXRhY2hTaGFyZWRNYXJrZXJzKG1hcmtlcnMpIHsNCiAgICB2YXIgbG9vcCA9IGZ1bmN0aW9uICggaSApIHsNCiAgICAgIHZhciBtYXJrZXIgPSBtYXJrZXJzW2ldLCBsaW5rZWQgPSBbbWFya2VyLnByaW1hcnkuZG9jXTsNCiAgICAgIGxpbmtlZERvY3MobWFya2VyLnByaW1hcnkuZG9jLCBmdW5jdGlvbiAoZCkgeyByZXR1cm4gbGlua2VkLnB1c2goZCk7IH0pOw0KICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCBtYXJrZXIubWFya2Vycy5sZW5ndGg7IGorKykgew0KICAgICAgICB2YXIgc3ViTWFya2VyID0gbWFya2VyLm1hcmtlcnNbal07DQogICAgICAgIGlmIChpbmRleE9mKGxpbmtlZCwgc3ViTWFya2VyLmRvYykgPT0gLTEpIHsNCiAgICAgICAgICBzdWJNYXJrZXIucGFyZW50ID0gbnVsbDsNCiAgICAgICAgICBtYXJrZXIubWFya2Vycy5zcGxpY2Uoai0tLCAxKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH07DQoNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1hcmtlcnMubGVuZ3RoOyBpKyspIGxvb3AoIGkgKTsNCiAgfQ0KDQogIHZhciBuZXh0RG9jSWQgPSAwOw0KICB2YXIgRG9jID0gZnVuY3Rpb24odGV4dCwgbW9kZSwgZmlyc3RMaW5lLCBsaW5lU2VwLCBkaXJlY3Rpb24pIHsNCiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgRG9jKSkgeyByZXR1cm4gbmV3IERvYyh0ZXh0LCBtb2RlLCBmaXJzdExpbmUsIGxpbmVTZXAsIGRpcmVjdGlvbikgfQ0KICAgIGlmIChmaXJzdExpbmUgPT0gbnVsbCkgeyBmaXJzdExpbmUgPSAwOyB9DQoNCiAgICBCcmFuY2hDaHVuay5jYWxsKHRoaXMsIFtuZXcgTGVhZkNodW5rKFtuZXcgTGluZSgiIiwgbnVsbCldKV0pOw0KICAgIHRoaXMuZmlyc3QgPSBmaXJzdExpbmU7DQogICAgdGhpcy5zY3JvbGxUb3AgPSB0aGlzLnNjcm9sbExlZnQgPSAwOw0KICAgIHRoaXMuY2FudEVkaXQgPSBmYWxzZTsNCiAgICB0aGlzLmNsZWFuR2VuZXJhdGlvbiA9IDE7DQogICAgdGhpcy5tb2RlRnJvbnRpZXIgPSB0aGlzLmhpZ2hsaWdodEZyb250aWVyID0gZmlyc3RMaW5lOw0KICAgIHZhciBzdGFydCA9IFBvcyhmaXJzdExpbmUsIDApOw0KICAgIHRoaXMuc2VsID0gc2ltcGxlU2VsZWN0aW9uKHN0YXJ0KTsNCiAgICB0aGlzLmhpc3RvcnkgPSBuZXcgSGlzdG9yeShudWxsKTsNCiAgICB0aGlzLmlkID0gKytuZXh0RG9jSWQ7DQogICAgdGhpcy5tb2RlT3B0aW9uID0gbW9kZTsNCiAgICB0aGlzLmxpbmVTZXAgPSBsaW5lU2VwOw0KICAgIHRoaXMuZGlyZWN0aW9uID0gKGRpcmVjdGlvbiA9PSAicnRsIikgPyAicnRsIiA6ICJsdHIiOw0KICAgIHRoaXMuZXh0ZW5kID0gZmFsc2U7DQoNCiAgICBpZiAodHlwZW9mIHRleHQgPT0gInN0cmluZyIpIHsgdGV4dCA9IHRoaXMuc3BsaXRMaW5lcyh0ZXh0KTsgfQ0KICAgIHVwZGF0ZURvYyh0aGlzLCB7ZnJvbTogc3RhcnQsIHRvOiBzdGFydCwgdGV4dDogdGV4dH0pOw0KICAgIHNldFNlbGVjdGlvbih0aGlzLCBzaW1wbGVTZWxlY3Rpb24oc3RhcnQpLCBzZWxfZG9udFNjcm9sbCk7DQogIH07DQoNCiAgRG9jLnByb3RvdHlwZSA9IGNyZWF0ZU9iaihCcmFuY2hDaHVuay5wcm90b3R5cGUsIHsNCiAgICBjb25zdHJ1Y3RvcjogRG9jLA0KICAgIC8vIEl0ZXJhdGUgb3ZlciB0aGUgZG9jdW1lbnQuIFN1cHBvcnRzIHR3byBmb3JtcyAtLSB3aXRoIG9ubHkgb25lDQogICAgLy8gYXJndW1lbnQsIGl0IGNhbGxzIHRoYXQgZm9yIGVhY2ggbGluZSBpbiB0aGUgZG9jdW1lbnQuIFdpdGgNCiAgICAvLyB0aHJlZSwgaXQgaXRlcmF0ZXMgb3ZlciB0aGUgcmFuZ2UgZ2l2ZW4gYnkgdGhlIGZpcnN0IHR3byAod2l0aA0KICAgIC8vIHRoZSBzZWNvbmQgYmVpbmcgbm9uLWluY2x1c2l2ZSkuDQogICAgaXRlcjogZnVuY3Rpb24oZnJvbSwgdG8sIG9wKSB7DQogICAgICBpZiAob3ApIHsgdGhpcy5pdGVyTihmcm9tIC0gdGhpcy5maXJzdCwgdG8gLSBmcm9tLCBvcCk7IH0NCiAgICAgIGVsc2UgeyB0aGlzLml0ZXJOKHRoaXMuZmlyc3QsIHRoaXMuZmlyc3QgKyB0aGlzLnNpemUsIGZyb20pOyB9DQogICAgfSwNCg0KICAgIC8vIE5vbi1wdWJsaWMgaW50ZXJmYWNlIGZvciBhZGRpbmcgYW5kIHJlbW92aW5nIGxpbmVzLg0KICAgIGluc2VydDogZnVuY3Rpb24oYXQsIGxpbmVzKSB7DQogICAgICB2YXIgaGVpZ2h0ID0gMDsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyArK2kpIHsgaGVpZ2h0ICs9IGxpbmVzW2ldLmhlaWdodDsgfQ0KICAgICAgdGhpcy5pbnNlcnRJbm5lcihhdCAtIHRoaXMuZmlyc3QsIGxpbmVzLCBoZWlnaHQpOw0KICAgIH0sDQogICAgcmVtb3ZlOiBmdW5jdGlvbihhdCwgbikgeyB0aGlzLnJlbW92ZUlubmVyKGF0IC0gdGhpcy5maXJzdCwgbik7IH0sDQoNCiAgICAvLyBGcm9tIGhlcmUsIHRoZSBtZXRob2RzIGFyZSBwYXJ0IG9mIHRoZSBwdWJsaWMgaW50ZXJmYWNlLiBNb3N0DQogICAgLy8gYXJlIGFsc28gYXZhaWxhYmxlIGZyb20gQ29kZU1pcnJvciAoZWRpdG9yKSBpbnN0YW5jZXMuDQoNCiAgICBnZXRWYWx1ZTogZnVuY3Rpb24obGluZVNlcCkgew0KICAgICAgdmFyIGxpbmVzID0gZ2V0TGluZXModGhpcywgdGhpcy5maXJzdCwgdGhpcy5maXJzdCArIHRoaXMuc2l6ZSk7DQogICAgICBpZiAobGluZVNlcCA9PT0gZmFsc2UpIHsgcmV0dXJuIGxpbmVzIH0NCiAgICAgIHJldHVybiBsaW5lcy5qb2luKGxpbmVTZXAgfHwgdGhpcy5saW5lU2VwYXJhdG9yKCkpDQogICAgfSwNCiAgICBzZXRWYWx1ZTogZG9jTWV0aG9kT3AoZnVuY3Rpb24oY29kZSkgew0KICAgICAgdmFyIHRvcCA9IFBvcyh0aGlzLmZpcnN0LCAwKSwgbGFzdCA9IHRoaXMuZmlyc3QgKyB0aGlzLnNpemUgLSAxOw0KICAgICAgbWFrZUNoYW5nZSh0aGlzLCB7ZnJvbTogdG9wLCB0bzogUG9zKGxhc3QsIGdldExpbmUodGhpcywgbGFzdCkudGV4dC5sZW5ndGgpLA0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogdGhpcy5zcGxpdExpbmVzKGNvZGUpLCBvcmlnaW46ICJzZXRWYWx1ZSIsIGZ1bGw6IHRydWV9LCB0cnVlKTsNCiAgICAgIGlmICh0aGlzLmNtKSB7IHNjcm9sbFRvQ29vcmRzKHRoaXMuY20sIDAsIDApOyB9DQogICAgICBzZXRTZWxlY3Rpb24odGhpcywgc2ltcGxlU2VsZWN0aW9uKHRvcCksIHNlbF9kb250U2Nyb2xsKTsNCiAgICB9KSwNCiAgICByZXBsYWNlUmFuZ2U6IGZ1bmN0aW9uKGNvZGUsIGZyb20sIHRvLCBvcmlnaW4pIHsNCiAgICAgIGZyb20gPSBjbGlwUG9zKHRoaXMsIGZyb20pOw0KICAgICAgdG8gPSB0byA/IGNsaXBQb3ModGhpcywgdG8pIDogZnJvbTsNCiAgICAgIHJlcGxhY2VSYW5nZSh0aGlzLCBjb2RlLCBmcm9tLCB0bywgb3JpZ2luKTsNCiAgICB9LA0KICAgIGdldFJhbmdlOiBmdW5jdGlvbihmcm9tLCB0bywgbGluZVNlcCkgew0KICAgICAgdmFyIGxpbmVzID0gZ2V0QmV0d2Vlbih0aGlzLCBjbGlwUG9zKHRoaXMsIGZyb20pLCBjbGlwUG9zKHRoaXMsIHRvKSk7DQogICAgICBpZiAobGluZVNlcCA9PT0gZmFsc2UpIHsgcmV0dXJuIGxpbmVzIH0NCiAgICAgIHJldHVybiBsaW5lcy5qb2luKGxpbmVTZXAgfHwgdGhpcy5saW5lU2VwYXJhdG9yKCkpDQogICAgfSwNCg0KICAgIGdldExpbmU6IGZ1bmN0aW9uKGxpbmUpIHt2YXIgbCA9IHRoaXMuZ2V0TGluZUhhbmRsZShsaW5lKTsgcmV0dXJuIGwgJiYgbC50ZXh0fSwNCg0KICAgIGdldExpbmVIYW5kbGU6IGZ1bmN0aW9uKGxpbmUpIHtpZiAoaXNMaW5lKHRoaXMsIGxpbmUpKSB7IHJldHVybiBnZXRMaW5lKHRoaXMsIGxpbmUpIH19LA0KICAgIGdldExpbmVOdW1iZXI6IGZ1bmN0aW9uKGxpbmUpIHtyZXR1cm4gbGluZU5vKGxpbmUpfSwNCg0KICAgIGdldExpbmVIYW5kbGVWaXN1YWxTdGFydDogZnVuY3Rpb24obGluZSkgew0KICAgICAgaWYgKHR5cGVvZiBsaW5lID09ICJudW1iZXIiKSB7IGxpbmUgPSBnZXRMaW5lKHRoaXMsIGxpbmUpOyB9DQogICAgICByZXR1cm4gdmlzdWFsTGluZShsaW5lKQ0KICAgIH0sDQoNCiAgICBsaW5lQ291bnQ6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLnNpemV9LA0KICAgIGZpcnN0TGluZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMuZmlyc3R9LA0KICAgIGxhc3RMaW5lOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5maXJzdCArIHRoaXMuc2l6ZSAtIDF9LA0KDQogICAgY2xpcFBvczogZnVuY3Rpb24ocG9zKSB7cmV0dXJuIGNsaXBQb3ModGhpcywgcG9zKX0sDQoNCiAgICBnZXRDdXJzb3I6IGZ1bmN0aW9uKHN0YXJ0KSB7DQogICAgICB2YXIgcmFuZ2UkJDEgPSB0aGlzLnNlbC5wcmltYXJ5KCksIHBvczsNCiAgICAgIGlmIChzdGFydCA9PSBudWxsIHx8IHN0YXJ0ID09ICJoZWFkIikgeyBwb3MgPSByYW5nZSQkMS5oZWFkOyB9DQogICAgICBlbHNlIGlmIChzdGFydCA9PSAiYW5jaG9yIikgeyBwb3MgPSByYW5nZSQkMS5hbmNob3I7IH0NCiAgICAgIGVsc2UgaWYgKHN0YXJ0ID09ICJlbmQiIHx8IHN0YXJ0ID09ICJ0byIgfHwgc3RhcnQgPT09IGZhbHNlKSB7IHBvcyA9IHJhbmdlJCQxLnRvKCk7IH0NCiAgICAgIGVsc2UgeyBwb3MgPSByYW5nZSQkMS5mcm9tKCk7IH0NCiAgICAgIHJldHVybiBwb3MNCiAgICB9LA0KICAgIGxpc3RTZWxlY3Rpb25zOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuc2VsLnJhbmdlcyB9LA0KICAgIHNvbWV0aGluZ1NlbGVjdGVkOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5zZWwuc29tZXRoaW5nU2VsZWN0ZWQoKX0sDQoNCiAgICBzZXRDdXJzb3I6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGxpbmUsIGNoLCBvcHRpb25zKSB7DQogICAgICBzZXRTaW1wbGVTZWxlY3Rpb24odGhpcywgY2xpcFBvcyh0aGlzLCB0eXBlb2YgbGluZSA9PSAibnVtYmVyIiA/IFBvcyhsaW5lLCBjaCB8fCAwKSA6IGxpbmUpLCBudWxsLCBvcHRpb25zKTsNCiAgICB9KSwNCiAgICBzZXRTZWxlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGFuY2hvciwgaGVhZCwgb3B0aW9ucykgew0KICAgICAgc2V0U2ltcGxlU2VsZWN0aW9uKHRoaXMsIGNsaXBQb3ModGhpcywgYW5jaG9yKSwgY2xpcFBvcyh0aGlzLCBoZWFkIHx8IGFuY2hvciksIG9wdGlvbnMpOw0KICAgIH0pLA0KICAgIGV4dGVuZFNlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oaGVhZCwgb3RoZXIsIG9wdGlvbnMpIHsNCiAgICAgIGV4dGVuZFNlbGVjdGlvbih0aGlzLCBjbGlwUG9zKHRoaXMsIGhlYWQpLCBvdGhlciAmJiBjbGlwUG9zKHRoaXMsIG90aGVyKSwgb3B0aW9ucyk7DQogICAgfSksDQogICAgZXh0ZW5kU2VsZWN0aW9uczogZG9jTWV0aG9kT3AoZnVuY3Rpb24oaGVhZHMsIG9wdGlvbnMpIHsNCiAgICAgIGV4dGVuZFNlbGVjdGlvbnModGhpcywgY2xpcFBvc0FycmF5KHRoaXMsIGhlYWRzKSwgb3B0aW9ucyk7DQogICAgfSksDQogICAgZXh0ZW5kU2VsZWN0aW9uc0J5OiBkb2NNZXRob2RPcChmdW5jdGlvbihmLCBvcHRpb25zKSB7DQogICAgICB2YXIgaGVhZHMgPSBtYXAodGhpcy5zZWwucmFuZ2VzLCBmKTsNCiAgICAgIGV4dGVuZFNlbGVjdGlvbnModGhpcywgY2xpcFBvc0FycmF5KHRoaXMsIGhlYWRzKSwgb3B0aW9ucyk7DQogICAgfSksDQogICAgc2V0U2VsZWN0aW9uczogZG9jTWV0aG9kT3AoZnVuY3Rpb24ocmFuZ2VzLCBwcmltYXJ5LCBvcHRpb25zKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgaWYgKCFyYW5nZXMubGVuZ3RoKSB7IHJldHVybiB9DQogICAgICB2YXIgb3V0ID0gW107DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykNCiAgICAgICAgeyBvdXRbaV0gPSBuZXcgUmFuZ2UoY2xpcFBvcyh0aGlzJDEsIHJhbmdlc1tpXS5hbmNob3IpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xpcFBvcyh0aGlzJDEsIHJhbmdlc1tpXS5oZWFkKSk7IH0NCiAgICAgIGlmIChwcmltYXJ5ID09IG51bGwpIHsgcHJpbWFyeSA9IE1hdGgubWluKHJhbmdlcy5sZW5ndGggLSAxLCB0aGlzLnNlbC5wcmltSW5kZXgpOyB9DQogICAgICBzZXRTZWxlY3Rpb24odGhpcywgbm9ybWFsaXplU2VsZWN0aW9uKHRoaXMuY20sIG91dCwgcHJpbWFyeSksIG9wdGlvbnMpOw0KICAgIH0pLA0KICAgIGFkZFNlbGVjdGlvbjogZG9jTWV0aG9kT3AoZnVuY3Rpb24oYW5jaG9yLCBoZWFkLCBvcHRpb25zKSB7DQogICAgICB2YXIgcmFuZ2VzID0gdGhpcy5zZWwucmFuZ2VzLnNsaWNlKDApOw0KICAgICAgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKGNsaXBQb3ModGhpcywgYW5jaG9yKSwgY2xpcFBvcyh0aGlzLCBoZWFkIHx8IGFuY2hvcikpKTsNCiAgICAgIHNldFNlbGVjdGlvbih0aGlzLCBub3JtYWxpemVTZWxlY3Rpb24odGhpcy5jbSwgcmFuZ2VzLCByYW5nZXMubGVuZ3RoIC0gMSksIG9wdGlvbnMpOw0KICAgIH0pLA0KDQogICAgZ2V0U2VsZWN0aW9uOiBmdW5jdGlvbihsaW5lU2VwKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgdmFyIHJhbmdlcyA9IHRoaXMuc2VsLnJhbmdlcywgbGluZXM7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICB2YXIgc2VsID0gZ2V0QmV0d2Vlbih0aGlzJDEsIHJhbmdlc1tpXS5mcm9tKCksIHJhbmdlc1tpXS50bygpKTsNCiAgICAgICAgbGluZXMgPSBsaW5lcyA/IGxpbmVzLmNvbmNhdChzZWwpIDogc2VsOw0KICAgICAgfQ0KICAgICAgaWYgKGxpbmVTZXAgPT09IGZhbHNlKSB7IHJldHVybiBsaW5lcyB9DQogICAgICBlbHNlIHsgcmV0dXJuIGxpbmVzLmpvaW4obGluZVNlcCB8fCB0aGlzLmxpbmVTZXBhcmF0b3IoKSkgfQ0KICAgIH0sDQogICAgZ2V0U2VsZWN0aW9uczogZnVuY3Rpb24obGluZVNlcCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgIHZhciBwYXJ0cyA9IFtdLCByYW5nZXMgPSB0aGlzLnNlbC5yYW5nZXM7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHJhbmdlcy5sZW5ndGg7IGkrKykgew0KICAgICAgICB2YXIgc2VsID0gZ2V0QmV0d2Vlbih0aGlzJDEsIHJhbmdlc1tpXS5mcm9tKCksIHJhbmdlc1tpXS50bygpKTsNCiAgICAgICAgaWYgKGxpbmVTZXAgIT09IGZhbHNlKSB7IHNlbCA9IHNlbC5qb2luKGxpbmVTZXAgfHwgdGhpcyQxLmxpbmVTZXBhcmF0b3IoKSk7IH0NCiAgICAgICAgcGFydHNbaV0gPSBzZWw7DQogICAgICB9DQogICAgICByZXR1cm4gcGFydHMNCiAgICB9LA0KICAgIHJlcGxhY2VTZWxlY3Rpb246IGZ1bmN0aW9uKGNvZGUsIGNvbGxhcHNlLCBvcmlnaW4pIHsNCiAgICAgIHZhciBkdXAgPSBbXTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKQ0KICAgICAgICB7IGR1cFtpXSA9IGNvZGU7IH0NCiAgICAgIHRoaXMucmVwbGFjZVNlbGVjdGlvbnMoZHVwLCBjb2xsYXBzZSwgb3JpZ2luIHx8ICIraW5wdXQiKTsNCiAgICB9LA0KICAgIHJlcGxhY2VTZWxlY3Rpb25zOiBkb2NNZXRob2RPcChmdW5jdGlvbihjb2RlLCBjb2xsYXBzZSwgb3JpZ2luKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgdmFyIGNoYW5nZXMgPSBbXSwgc2VsID0gdGhpcy5zZWw7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHNlbC5yYW5nZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIHJhbmdlJCQxID0gc2VsLnJhbmdlc1tpXTsNCiAgICAgICAgY2hhbmdlc1tpXSA9IHtmcm9tOiByYW5nZSQkMS5mcm9tKCksIHRvOiByYW5nZSQkMS50bygpLCB0ZXh0OiB0aGlzJDEuc3BsaXRMaW5lcyhjb2RlW2ldKSwgb3JpZ2luOiBvcmlnaW59Ow0KICAgICAgfQ0KICAgICAgdmFyIG5ld1NlbCA9IGNvbGxhcHNlICYmIGNvbGxhcHNlICE9ICJlbmQiICYmIGNvbXB1dGVSZXBsYWNlZFNlbCh0aGlzLCBjaGFuZ2VzLCBjb2xsYXBzZSk7DQogICAgICBmb3IgKHZhciBpJDEgPSBjaGFuZ2VzLmxlbmd0aCAtIDE7IGkkMSA+PSAwOyBpJDEtLSkNCiAgICAgICAgeyBtYWtlQ2hhbmdlKHRoaXMkMSwgY2hhbmdlc1tpJDFdKTsgfQ0KICAgICAgaWYgKG5ld1NlbCkgeyBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeSh0aGlzLCBuZXdTZWwpOyB9DQogICAgICBlbHNlIGlmICh0aGlzLmNtKSB7IGVuc3VyZUN1cnNvclZpc2libGUodGhpcy5jbSk7IH0NCiAgICB9KSwNCiAgICB1bmRvOiBkb2NNZXRob2RPcChmdW5jdGlvbigpIHttYWtlQ2hhbmdlRnJvbUhpc3RvcnkodGhpcywgInVuZG8iKTt9KSwNCiAgICByZWRvOiBkb2NNZXRob2RPcChmdW5jdGlvbigpIHttYWtlQ2hhbmdlRnJvbUhpc3RvcnkodGhpcywgInJlZG8iKTt9KSwNCiAgICB1bmRvU2VsZWN0aW9uOiBkb2NNZXRob2RPcChmdW5jdGlvbigpIHttYWtlQ2hhbmdlRnJvbUhpc3RvcnkodGhpcywgInVuZG8iLCB0cnVlKTt9KSwNCiAgICByZWRvU2VsZWN0aW9uOiBkb2NNZXRob2RPcChmdW5jdGlvbigpIHttYWtlQ2hhbmdlRnJvbUhpc3RvcnkodGhpcywgInJlZG8iLCB0cnVlKTt9KSwNCg0KICAgIHNldEV4dGVuZGluZzogZnVuY3Rpb24odmFsKSB7dGhpcy5leHRlbmQgPSB2YWw7fSwNCiAgICBnZXRFeHRlbmRpbmc6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLmV4dGVuZH0sDQoNCiAgICBoaXN0b3J5U2l6ZTogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgaGlzdCA9IHRoaXMuaGlzdG9yeSwgZG9uZSA9IDAsIHVuZG9uZSA9IDA7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGhpc3QuZG9uZS5sZW5ndGg7IGkrKykgeyBpZiAoIWhpc3QuZG9uZVtpXS5yYW5nZXMpIHsgKytkb25lOyB9IH0NCiAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGhpc3QudW5kb25lLmxlbmd0aDsgaSQxKyspIHsgaWYgKCFoaXN0LnVuZG9uZVtpJDFdLnJhbmdlcykgeyArK3VuZG9uZTsgfSB9DQogICAgICByZXR1cm4ge3VuZG86IGRvbmUsIHJlZG86IHVuZG9uZX0NCiAgICB9LA0KICAgIGNsZWFySGlzdG9yeTogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcy5oaXN0b3J5Lm1heEdlbmVyYXRpb24pOw0KICAgICAgbGlua2VkRG9jcyh0aGlzLCBmdW5jdGlvbiAoZG9jKSB7IHJldHVybiBkb2MuaGlzdG9yeSA9IHRoaXMkMS5oaXN0b3J5OyB9LCB0cnVlKTsNCiAgICB9LA0KDQogICAgbWFya0NsZWFuOiBmdW5jdGlvbigpIHsNCiAgICAgIHRoaXMuY2xlYW5HZW5lcmF0aW9uID0gdGhpcy5jaGFuZ2VHZW5lcmF0aW9uKHRydWUpOw0KICAgIH0sDQogICAgY2hhbmdlR2VuZXJhdGlvbjogZnVuY3Rpb24oZm9yY2VTcGxpdCkgew0KICAgICAgaWYgKGZvcmNlU3BsaXQpDQogICAgICAgIHsgdGhpcy5oaXN0b3J5Lmxhc3RPcCA9IHRoaXMuaGlzdG9yeS5sYXN0U2VsT3AgPSB0aGlzLmhpc3RvcnkubGFzdE9yaWdpbiA9IG51bGw7IH0NCiAgICAgIHJldHVybiB0aGlzLmhpc3RvcnkuZ2VuZXJhdGlvbg0KICAgIH0sDQogICAgaXNDbGVhbjogZnVuY3Rpb24gKGdlbikgew0KICAgICAgcmV0dXJuIHRoaXMuaGlzdG9yeS5nZW5lcmF0aW9uID09IChnZW4gfHwgdGhpcy5jbGVhbkdlbmVyYXRpb24pDQogICAgfSwNCg0KICAgIGdldEhpc3Rvcnk6IGZ1bmN0aW9uKCkgew0KICAgICAgcmV0dXJuIHtkb25lOiBjb3B5SGlzdG9yeUFycmF5KHRoaXMuaGlzdG9yeS5kb25lKSwNCiAgICAgICAgICAgICAgdW5kb25lOiBjb3B5SGlzdG9yeUFycmF5KHRoaXMuaGlzdG9yeS51bmRvbmUpfQ0KICAgIH0sDQogICAgc2V0SGlzdG9yeTogZnVuY3Rpb24oaGlzdERhdGEpIHsNCiAgICAgIHZhciBoaXN0ID0gdGhpcy5oaXN0b3J5ID0gbmV3IEhpc3RvcnkodGhpcy5oaXN0b3J5Lm1heEdlbmVyYXRpb24pOw0KICAgICAgaGlzdC5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS5kb25lLnNsaWNlKDApLCBudWxsLCB0cnVlKTsNCiAgICAgIGhpc3QudW5kb25lID0gY29weUhpc3RvcnlBcnJheShoaXN0RGF0YS51bmRvbmUuc2xpY2UoMCksIG51bGwsIHRydWUpOw0KICAgIH0sDQoNCiAgICBzZXRHdXR0ZXJNYXJrZXI6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGxpbmUsIGd1dHRlcklELCB2YWx1ZSkgew0KICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgbGluZSwgImd1dHRlciIsIGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIHZhciBtYXJrZXJzID0gbGluZS5ndXR0ZXJNYXJrZXJzIHx8IChsaW5lLmd1dHRlck1hcmtlcnMgPSB7fSk7DQogICAgICAgIG1hcmtlcnNbZ3V0dGVySURdID0gdmFsdWU7DQogICAgICAgIGlmICghdmFsdWUgJiYgaXNFbXB0eShtYXJrZXJzKSkgeyBsaW5lLmd1dHRlck1hcmtlcnMgPSBudWxsOyB9DQogICAgICAgIHJldHVybiB0cnVlDQogICAgICB9KQ0KICAgIH0pLA0KDQogICAgY2xlYXJHdXR0ZXI6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGd1dHRlcklEKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIGlmIChsaW5lLmd1dHRlck1hcmtlcnMgJiYgbGluZS5ndXR0ZXJNYXJrZXJzW2d1dHRlcklEXSkgew0KICAgICAgICAgIGNoYW5nZUxpbmUodGhpcyQxLCBsaW5lLCAiZ3V0dGVyIiwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgbGluZS5ndXR0ZXJNYXJrZXJzW2d1dHRlcklEXSA9IG51bGw7DQogICAgICAgICAgICBpZiAoaXNFbXB0eShsaW5lLmd1dHRlck1hcmtlcnMpKSB7IGxpbmUuZ3V0dGVyTWFya2VycyA9IG51bGw7IH0NCiAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0pOw0KICAgIH0pLA0KDQogICAgbGluZUluZm86IGZ1bmN0aW9uKGxpbmUpIHsNCiAgICAgIHZhciBuOw0KICAgICAgaWYgKHR5cGVvZiBsaW5lID09ICJudW1iZXIiKSB7DQogICAgICAgIGlmICghaXNMaW5lKHRoaXMsIGxpbmUpKSB7IHJldHVybiBudWxsIH0NCiAgICAgICAgbiA9IGxpbmU7DQogICAgICAgIGxpbmUgPSBnZXRMaW5lKHRoaXMsIGxpbmUpOw0KICAgICAgICBpZiAoIWxpbmUpIHsgcmV0dXJuIG51bGwgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbiA9IGxpbmVObyhsaW5lKTsNCiAgICAgICAgaWYgKG4gPT0gbnVsbCkgeyByZXR1cm4gbnVsbCB9DQogICAgICB9DQogICAgICByZXR1cm4ge2xpbmU6IG4sIGhhbmRsZTogbGluZSwgdGV4dDogbGluZS50ZXh0LCBndXR0ZXJNYXJrZXJzOiBsaW5lLmd1dHRlck1hcmtlcnMsDQogICAgICAgICAgICAgIHRleHRDbGFzczogbGluZS50ZXh0Q2xhc3MsIGJnQ2xhc3M6IGxpbmUuYmdDbGFzcywgd3JhcENsYXNzOiBsaW5lLndyYXBDbGFzcywNCiAgICAgICAgICAgICAgd2lkZ2V0czogbGluZS53aWRnZXRzfQ0KICAgIH0sDQoNCiAgICBhZGRMaW5lQ2xhc3M6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhhbmRsZSwgd2hlcmUsIGNscykgew0KICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgaGFuZGxlLCB3aGVyZSA9PSAiZ3V0dGVyIiA/ICJndXR0ZXIiIDogImNsYXNzIiwgZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgICAgdmFyIHByb3AgPSB3aGVyZSA9PSAidGV4dCIgPyAidGV4dENsYXNzIg0KICAgICAgICAgICAgICAgICA6IHdoZXJlID09ICJiYWNrZ3JvdW5kIiA/ICJiZ0NsYXNzIg0KICAgICAgICAgICAgICAgICA6IHdoZXJlID09ICJndXR0ZXIiID8gImd1dHRlckNsYXNzIiA6ICJ3cmFwQ2xhc3MiOw0KICAgICAgICBpZiAoIWxpbmVbcHJvcF0pIHsgbGluZVtwcm9wXSA9IGNsczsgfQ0KICAgICAgICBlbHNlIGlmIChjbGFzc1Rlc3QoY2xzKS50ZXN0KGxpbmVbcHJvcF0pKSB7IHJldHVybiBmYWxzZSB9DQogICAgICAgIGVsc2UgeyBsaW5lW3Byb3BdICs9ICIgIiArIGNsczsgfQ0KICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgICAgfSkNCiAgICB9KSwNCiAgICByZW1vdmVMaW5lQ2xhc3M6IGRvY01ldGhvZE9wKGZ1bmN0aW9uKGhhbmRsZSwgd2hlcmUsIGNscykgew0KICAgICAgcmV0dXJuIGNoYW5nZUxpbmUodGhpcywgaGFuZGxlLCB3aGVyZSA9PSAiZ3V0dGVyIiA/ICJndXR0ZXIiIDogImNsYXNzIiwgZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgICAgdmFyIHByb3AgPSB3aGVyZSA9PSAidGV4dCIgPyAidGV4dENsYXNzIg0KICAgICAgICAgICAgICAgICA6IHdoZXJlID09ICJiYWNrZ3JvdW5kIiA/ICJiZ0NsYXNzIg0KICAgICAgICAgICAgICAgICA6IHdoZXJlID09ICJndXR0ZXIiID8gImd1dHRlckNsYXNzIiA6ICJ3cmFwQ2xhc3MiOw0KICAgICAgICB2YXIgY3VyID0gbGluZVtwcm9wXTsNCiAgICAgICAgaWYgKCFjdXIpIHsgcmV0dXJuIGZhbHNlIH0NCiAgICAgICAgZWxzZSBpZiAoY2xzID09IG51bGwpIHsgbGluZVtwcm9wXSA9IG51bGw7IH0NCiAgICAgICAgZWxzZSB7DQogICAgICAgICAgdmFyIGZvdW5kID0gY3VyLm1hdGNoKGNsYXNzVGVzdChjbHMpKTsNCiAgICAgICAgICBpZiAoIWZvdW5kKSB7IHJldHVybiBmYWxzZSB9DQogICAgICAgICAgdmFyIGVuZCA9IGZvdW5kLmluZGV4ICsgZm91bmRbMF0ubGVuZ3RoOw0KICAgICAgICAgIGxpbmVbcHJvcF0gPSBjdXIuc2xpY2UoMCwgZm91bmQuaW5kZXgpICsgKCFmb3VuZC5pbmRleCB8fCBlbmQgPT0gY3VyLmxlbmd0aCA/ICIiIDogIiAiKSArIGN1ci5zbGljZShlbmQpIHx8IG51bGw7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgIH0pDQogICAgfSksDQoNCiAgICBhZGRMaW5lV2lkZ2V0OiBkb2NNZXRob2RPcChmdW5jdGlvbihoYW5kbGUsIG5vZGUsIG9wdGlvbnMpIHsNCiAgICAgIHJldHVybiBhZGRMaW5lV2lkZ2V0KHRoaXMsIGhhbmRsZSwgbm9kZSwgb3B0aW9ucykNCiAgICB9KSwNCiAgICByZW1vdmVMaW5lV2lkZ2V0OiBmdW5jdGlvbih3aWRnZXQpIHsgd2lkZ2V0LmNsZWFyKCk7IH0sDQoNCiAgICBtYXJrVGV4dDogZnVuY3Rpb24oZnJvbSwgdG8sIG9wdGlvbnMpIHsNCiAgICAgIHJldHVybiBtYXJrVGV4dCh0aGlzLCBjbGlwUG9zKHRoaXMsIGZyb20pLCBjbGlwUG9zKHRoaXMsIHRvKSwgb3B0aW9ucywgb3B0aW9ucyAmJiBvcHRpb25zLnR5cGUgfHwgInJhbmdlIikNCiAgICB9LA0KICAgIHNldEJvb2ttYXJrOiBmdW5jdGlvbihwb3MsIG9wdGlvbnMpIHsNCiAgICAgIHZhciByZWFsT3B0cyA9IHtyZXBsYWNlZFdpdGg6IG9wdGlvbnMgJiYgKG9wdGlvbnMubm9kZVR5cGUgPT0gbnVsbCA/IG9wdGlvbnMud2lkZ2V0IDogb3B0aW9ucyksDQogICAgICAgICAgICAgICAgICAgICAgaW5zZXJ0TGVmdDogb3B0aW9ucyAmJiBvcHRpb25zLmluc2VydExlZnQsDQogICAgICAgICAgICAgICAgICAgICAgY2xlYXJXaGVuRW1wdHk6IGZhbHNlLCBzaGFyZWQ6IG9wdGlvbnMgJiYgb3B0aW9ucy5zaGFyZWQsDQogICAgICAgICAgICAgICAgICAgICAgaGFuZGxlTW91c2VFdmVudHM6IG9wdGlvbnMgJiYgb3B0aW9ucy5oYW5kbGVNb3VzZUV2ZW50c307DQogICAgICBwb3MgPSBjbGlwUG9zKHRoaXMsIHBvcyk7DQogICAgICByZXR1cm4gbWFya1RleHQodGhpcywgcG9zLCBwb3MsIHJlYWxPcHRzLCAiYm9va21hcmsiKQ0KICAgIH0sDQogICAgZmluZE1hcmtzQXQ6IGZ1bmN0aW9uKHBvcykgew0KICAgICAgcG9zID0gY2xpcFBvcyh0aGlzLCBwb3MpOw0KICAgICAgdmFyIG1hcmtlcnMgPSBbXSwgc3BhbnMgPSBnZXRMaW5lKHRoaXMsIHBvcy5saW5lKS5tYXJrZWRTcGFuczsNCiAgICAgIGlmIChzcGFucykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgKytpKSB7DQogICAgICAgIHZhciBzcGFuID0gc3BhbnNbaV07DQogICAgICAgIGlmICgoc3Bhbi5mcm9tID09IG51bGwgfHwgc3Bhbi5mcm9tIDw9IHBvcy5jaCkgJiYNCiAgICAgICAgICAgIChzcGFuLnRvID09IG51bGwgfHwgc3Bhbi50byA+PSBwb3MuY2gpKQ0KICAgICAgICAgIHsgbWFya2Vycy5wdXNoKHNwYW4ubWFya2VyLnBhcmVudCB8fCBzcGFuLm1hcmtlcik7IH0NCiAgICAgIH0gfQ0KICAgICAgcmV0dXJuIG1hcmtlcnMNCiAgICB9LA0KICAgIGZpbmRNYXJrczogZnVuY3Rpb24oZnJvbSwgdG8sIGZpbHRlcikgew0KICAgICAgZnJvbSA9IGNsaXBQb3ModGhpcywgZnJvbSk7IHRvID0gY2xpcFBvcyh0aGlzLCB0byk7DQogICAgICB2YXIgZm91bmQgPSBbXSwgbGluZU5vJCQxID0gZnJvbS5saW5lOw0KICAgICAgdGhpcy5pdGVyKGZyb20ubGluZSwgdG8ubGluZSArIDEsIGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIHZhciBzcGFucyA9IGxpbmUubWFya2VkU3BhbnM7DQogICAgICAgIGlmIChzcGFucykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHNwYW5zLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgdmFyIHNwYW4gPSBzcGFuc1tpXTsNCiAgICAgICAgICBpZiAoIShzcGFuLnRvICE9IG51bGwgJiYgbGluZU5vJCQxID09IGZyb20ubGluZSAmJiBmcm9tLmNoID49IHNwYW4udG8gfHwNCiAgICAgICAgICAgICAgICBzcGFuLmZyb20gPT0gbnVsbCAmJiBsaW5lTm8kJDEgIT0gZnJvbS5saW5lIHx8DQogICAgICAgICAgICAgICAgc3Bhbi5mcm9tICE9IG51bGwgJiYgbGluZU5vJCQxID09IHRvLmxpbmUgJiYgc3Bhbi5mcm9tID49IHRvLmNoKSAmJg0KICAgICAgICAgICAgICAoIWZpbHRlciB8fCBmaWx0ZXIoc3Bhbi5tYXJrZXIpKSkNCiAgICAgICAgICAgIHsgZm91bmQucHVzaChzcGFuLm1hcmtlci5wYXJlbnQgfHwgc3Bhbi5tYXJrZXIpOyB9DQogICAgICAgIH0gfQ0KICAgICAgICArK2xpbmVObyQkMTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIGZvdW5kDQogICAgfSwNCiAgICBnZXRBbGxNYXJrczogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgbWFya2VycyA9IFtdOw0KICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIHZhciBzcHMgPSBsaW5lLm1hcmtlZFNwYW5zOw0KICAgICAgICBpZiAoc3BzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgc3BzLmxlbmd0aDsgKytpKQ0KICAgICAgICAgIHsgaWYgKHNwc1tpXS5mcm9tICE9IG51bGwpIHsgbWFya2Vycy5wdXNoKHNwc1tpXS5tYXJrZXIpOyB9IH0gfQ0KICAgICAgfSk7DQogICAgICByZXR1cm4gbWFya2Vycw0KICAgIH0sDQoNCiAgICBwb3NGcm9tSW5kZXg6IGZ1bmN0aW9uKG9mZikgew0KICAgICAgdmFyIGNoLCBsaW5lTm8kJDEgPSB0aGlzLmZpcnN0LCBzZXBTaXplID0gdGhpcy5saW5lU2VwYXJhdG9yKCkubGVuZ3RoOw0KICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uIChsaW5lKSB7DQogICAgICAgIHZhciBzeiA9IGxpbmUudGV4dC5sZW5ndGggKyBzZXBTaXplOw0KICAgICAgICBpZiAoc3ogPiBvZmYpIHsgY2ggPSBvZmY7IHJldHVybiB0cnVlIH0NCiAgICAgICAgb2ZmIC09IHN6Ow0KICAgICAgICArK2xpbmVObyQkMTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIGNsaXBQb3ModGhpcywgUG9zKGxpbmVObyQkMSwgY2gpKQ0KICAgIH0sDQogICAgaW5kZXhGcm9tUG9zOiBmdW5jdGlvbiAoY29vcmRzKSB7DQogICAgICBjb29yZHMgPSBjbGlwUG9zKHRoaXMsIGNvb3Jkcyk7DQogICAgICB2YXIgaW5kZXggPSBjb29yZHMuY2g7DQogICAgICBpZiAoY29vcmRzLmxpbmUgPCB0aGlzLmZpcnN0IHx8IGNvb3Jkcy5jaCA8IDApIHsgcmV0dXJuIDAgfQ0KICAgICAgdmFyIHNlcFNpemUgPSB0aGlzLmxpbmVTZXBhcmF0b3IoKS5sZW5ndGg7DQogICAgICB0aGlzLml0ZXIodGhpcy5maXJzdCwgY29vcmRzLmxpbmUsIGZ1bmN0aW9uIChsaW5lKSB7IC8vIGl0ZXIgYWJvcnRzIHdoZW4gY2FsbGJhY2sgcmV0dXJucyBhIHRydXRoeSB2YWx1ZQ0KICAgICAgICBpbmRleCArPSBsaW5lLnRleHQubGVuZ3RoICsgc2VwU2l6ZTsNCiAgICAgIH0pOw0KICAgICAgcmV0dXJuIGluZGV4DQogICAgfSwNCg0KICAgIGNvcHk6IGZ1bmN0aW9uKGNvcHlIaXN0b3J5KSB7DQogICAgICB2YXIgZG9jID0gbmV3IERvYyhnZXRMaW5lcyh0aGlzLCB0aGlzLmZpcnN0LCB0aGlzLmZpcnN0ICsgdGhpcy5zaXplKSwNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubW9kZU9wdGlvbiwgdGhpcy5maXJzdCwgdGhpcy5saW5lU2VwLCB0aGlzLmRpcmVjdGlvbik7DQogICAgICBkb2Muc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7IGRvYy5zY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0Ow0KICAgICAgZG9jLnNlbCA9IHRoaXMuc2VsOw0KICAgICAgZG9jLmV4dGVuZCA9IGZhbHNlOw0KICAgICAgaWYgKGNvcHlIaXN0b3J5KSB7DQogICAgICAgIGRvYy5oaXN0b3J5LnVuZG9EZXB0aCA9IHRoaXMuaGlzdG9yeS51bmRvRGVwdGg7DQogICAgICAgIGRvYy5zZXRIaXN0b3J5KHRoaXMuZ2V0SGlzdG9yeSgpKTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBkb2MNCiAgICB9LA0KDQogICAgbGlua2VkRG9jOiBmdW5jdGlvbihvcHRpb25zKSB7DQogICAgICBpZiAoIW9wdGlvbnMpIHsgb3B0aW9ucyA9IHt9OyB9DQogICAgICB2YXIgZnJvbSA9IHRoaXMuZmlyc3QsIHRvID0gdGhpcy5maXJzdCArIHRoaXMuc2l6ZTsNCiAgICAgIGlmIChvcHRpb25zLmZyb20gIT0gbnVsbCAmJiBvcHRpb25zLmZyb20gPiBmcm9tKSB7IGZyb20gPSBvcHRpb25zLmZyb207IH0NCiAgICAgIGlmIChvcHRpb25zLnRvICE9IG51bGwgJiYgb3B0aW9ucy50byA8IHRvKSB7IHRvID0gb3B0aW9ucy50bzsgfQ0KICAgICAgdmFyIGNvcHkgPSBuZXcgRG9jKGdldExpbmVzKHRoaXMsIGZyb20sIHRvKSwgb3B0aW9ucy5tb2RlIHx8IHRoaXMubW9kZU9wdGlvbiwgZnJvbSwgdGhpcy5saW5lU2VwLCB0aGlzLmRpcmVjdGlvbik7DQogICAgICBpZiAob3B0aW9ucy5zaGFyZWRIaXN0KSB7IGNvcHkuaGlzdG9yeSA9IHRoaXMuaGlzdG9yeQ0KICAgICAgOyB9KHRoaXMubGlua2VkIHx8ICh0aGlzLmxpbmtlZCA9IFtdKSkucHVzaCh7ZG9jOiBjb3B5LCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9KTsNCiAgICAgIGNvcHkubGlua2VkID0gW3tkb2M6IHRoaXMsIGlzUGFyZW50OiB0cnVlLCBzaGFyZWRIaXN0OiBvcHRpb25zLnNoYXJlZEhpc3R9XTsNCiAgICAgIGNvcHlTaGFyZWRNYXJrZXJzKGNvcHksIGZpbmRTaGFyZWRNYXJrZXJzKHRoaXMpKTsNCiAgICAgIHJldHVybiBjb3B5DQogICAgfSwNCiAgICB1bmxpbmtEb2M6IGZ1bmN0aW9uKG90aGVyKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgQ29kZU1pcnJvcikgeyBvdGhlciA9IG90aGVyLmRvYzsgfQ0KICAgICAgaWYgKHRoaXMubGlua2VkKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5saW5rZWQubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgdmFyIGxpbmsgPSB0aGlzJDEubGlua2VkW2ldOw0KICAgICAgICBpZiAobGluay5kb2MgIT0gb3RoZXIpIHsgY29udGludWUgfQ0KICAgICAgICB0aGlzJDEubGlua2VkLnNwbGljZShpLCAxKTsNCiAgICAgICAgb3RoZXIudW5saW5rRG9jKHRoaXMkMSk7DQogICAgICAgIGRldGFjaFNoYXJlZE1hcmtlcnMoZmluZFNoYXJlZE1hcmtlcnModGhpcyQxKSk7DQogICAgICAgIGJyZWFrDQogICAgICB9IH0NCiAgICAgIC8vIElmIHRoZSBoaXN0b3JpZXMgd2VyZSBzaGFyZWQsIHNwbGl0IHRoZW0gYWdhaW4NCiAgICAgIGlmIChvdGhlci5oaXN0b3J5ID09IHRoaXMuaGlzdG9yeSkgew0KICAgICAgICB2YXIgc3BsaXRJZHMgPSBbb3RoZXIuaWRdOw0KICAgICAgICBsaW5rZWREb2NzKG90aGVyLCBmdW5jdGlvbiAoZG9jKSB7IHJldHVybiBzcGxpdElkcy5wdXNoKGRvYy5pZCk7IH0sIHRydWUpOw0KICAgICAgICBvdGhlci5oaXN0b3J5ID0gbmV3IEhpc3RvcnkobnVsbCk7DQogICAgICAgIG90aGVyLmhpc3RvcnkuZG9uZSA9IGNvcHlIaXN0b3J5QXJyYXkodGhpcy5oaXN0b3J5LmRvbmUsIHNwbGl0SWRzKTsNCiAgICAgICAgb3RoZXIuaGlzdG9yeS51bmRvbmUgPSBjb3B5SGlzdG9yeUFycmF5KHRoaXMuaGlzdG9yeS51bmRvbmUsIHNwbGl0SWRzKTsNCiAgICAgIH0NCiAgICB9LA0KICAgIGl0ZXJMaW5rZWREb2NzOiBmdW5jdGlvbihmKSB7bGlua2VkRG9jcyh0aGlzLCBmKTt9LA0KDQogICAgZ2V0TW9kZTogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMubW9kZX0sDQogICAgZ2V0RWRpdG9yOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5jbX0sDQoNCiAgICBzcGxpdExpbmVzOiBmdW5jdGlvbihzdHIpIHsNCiAgICAgIGlmICh0aGlzLmxpbmVTZXApIHsgcmV0dXJuIHN0ci5zcGxpdCh0aGlzLmxpbmVTZXApIH0NCiAgICAgIHJldHVybiBzcGxpdExpbmVzQXV0byhzdHIpDQogICAgfSwNCiAgICBsaW5lU2VwYXJhdG9yOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMubGluZVNlcCB8fCAiXG4iIH0sDQoNCiAgICBzZXREaXJlY3Rpb246IGRvY01ldGhvZE9wKGZ1bmN0aW9uIChkaXIpIHsNCiAgICAgIGlmIChkaXIgIT0gInJ0bCIpIHsgZGlyID0gImx0ciI7IH0NCiAgICAgIGlmIChkaXIgPT0gdGhpcy5kaXJlY3Rpb24pIHsgcmV0dXJuIH0NCiAgICAgIHRoaXMuZGlyZWN0aW9uID0gZGlyOw0KICAgICAgdGhpcy5pdGVyKGZ1bmN0aW9uIChsaW5lKSB7IHJldHVybiBsaW5lLm9yZGVyID0gbnVsbDsgfSk7DQogICAgICBpZiAodGhpcy5jbSkgeyBkaXJlY3Rpb25DaGFuZ2VkKHRoaXMuY20pOyB9DQogICAgfSkNCiAgfSk7DQoNCiAgLy8gUHVibGljIGFsaWFzLg0KICBEb2MucHJvdG90eXBlLmVhY2hMaW5lID0gRG9jLnByb3RvdHlwZS5pdGVyOw0KDQogIC8vIEtsdWRnZSB0byB3b3JrIGFyb3VuZCBzdHJhbmdlIElFIGJlaGF2aW9yIHdoZXJlIGl0J2xsIHNvbWV0aW1lcw0KICAvLyByZS1maXJlIGEgc2VyaWVzIG9mIGRyYWctcmVsYXRlZCBldmVudHMgcmlnaHQgYWZ0ZXIgdGhlIGRyb3AgKCMxNTUxKQ0KICB2YXIgbGFzdERyb3AgPSAwOw0KDQogIGZ1bmN0aW9uIG9uRHJvcChlKSB7DQogICAgdmFyIGNtID0gdGhpczsNCiAgICBjbGVhckRyYWdDdXJzb3IoY20pOw0KICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSkNCiAgICAgIHsgcmV0dXJuIH0NCiAgICBlX3ByZXZlbnREZWZhdWx0KGUpOw0KICAgIGlmIChpZSkgeyBsYXN0RHJvcCA9ICtuZXcgRGF0ZTsgfQ0KICAgIHZhciBwb3MgPSBwb3NGcm9tTW91c2UoY20sIGUsIHRydWUpLCBmaWxlcyA9IGUuZGF0YVRyYW5zZmVyLmZpbGVzOw0KICAgIGlmICghcG9zIHx8IGNtLmlzUmVhZE9ubHkoKSkgeyByZXR1cm4gfQ0KICAgIC8vIE1pZ2h0IGJlIGEgZmlsZSBkcm9wLCBpbiB3aGljaCBjYXNlIHdlIHNpbXBseSBleHRyYWN0IHRoZSB0ZXh0DQogICAgLy8gYW5kIGluc2VydCBpdC4NCiAgICBpZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoICYmIHdpbmRvdy5GaWxlUmVhZGVyICYmIHdpbmRvdy5GaWxlKSB7DQogICAgICB2YXIgbiA9IGZpbGVzLmxlbmd0aCwgdGV4dCA9IEFycmF5KG4pLCByZWFkID0gMDsNCiAgICAgIHZhciBtYXJrQXNSZWFkQW5kUGFzdGVJZkFsbEZpbGVzQXJlUmVhZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKCsrcmVhZCA9PSBuKSB7DQogICAgICAgICAgb3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBwb3MgPSBjbGlwUG9zKGNtLmRvYywgcG9zKTsNCiAgICAgICAgICAgIHZhciBjaGFuZ2UgPSB7ZnJvbTogcG9zLCB0bzogcG9zLA0KICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBjbS5kb2Muc3BsaXRMaW5lcygNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQuZmlsdGVyKGZ1bmN0aW9uICh0KSB7IHJldHVybiB0ICE9IG51bGw7IH0pLmpvaW4oY20uZG9jLmxpbmVTZXBhcmF0b3IoKSkpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46ICJwYXN0ZSJ9Ow0KICAgICAgICAgICAgbWFrZUNoYW5nZShjbS5kb2MsIGNoYW5nZSk7DQogICAgICAgICAgICBzZXRTZWxlY3Rpb25SZXBsYWNlSGlzdG9yeShjbS5kb2MsIHNpbXBsZVNlbGVjdGlvbihjbGlwUG9zKGNtLmRvYywgcG9zKSwgY2xpcFBvcyhjbS5kb2MsIGNoYW5nZUVuZChjaGFuZ2UpKSkpOw0KICAgICAgICAgIH0pKCk7DQogICAgICAgIH0NCiAgICAgIH07DQogICAgICB2YXIgcmVhZFRleHRGcm9tRmlsZSA9IGZ1bmN0aW9uIChmaWxlLCBpKSB7DQogICAgICAgIGlmIChjbS5vcHRpb25zLmFsbG93RHJvcEZpbGVUeXBlcyAmJg0KICAgICAgICAgICAgaW5kZXhPZihjbS5vcHRpb25zLmFsbG93RHJvcEZpbGVUeXBlcywgZmlsZS50eXBlKSA9PSAtMSkgew0KICAgICAgICAgIG1hcmtBc1JlYWRBbmRQYXN0ZUlmQWxsRmlsZXNBcmVSZWFkKCk7DQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyOw0KICAgICAgICByZWFkZXIub25lcnJvciA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1hcmtBc1JlYWRBbmRQYXN0ZUlmQWxsRmlsZXNBcmVSZWFkKCk7IH07DQogICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgdmFyIGNvbnRlbnQgPSByZWFkZXIucmVzdWx0Ow0KICAgICAgICAgIGlmICgvW1x4MDAtXHgwOFx4MGUtXHgxZl17Mn0vLnRlc3QoY29udGVudCkpIHsNCiAgICAgICAgICAgIG1hcmtBc1JlYWRBbmRQYXN0ZUlmQWxsRmlsZXNBcmVSZWFkKCk7DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICB9DQogICAgICAgICAgdGV4dFtpXSA9IGNvbnRlbnQ7DQogICAgICAgICAgbWFya0FzUmVhZEFuZFBhc3RlSWZBbGxGaWxlc0FyZVJlYWQoKTsNCiAgICAgICAgfTsNCiAgICAgICAgcmVhZGVyLnJlYWRBc1RleHQoZmlsZSk7DQogICAgICB9Ow0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykgeyByZWFkVGV4dEZyb21GaWxlKGZpbGVzW2ldLCBpKTsgfQ0KICAgIH0gZWxzZSB7IC8vIE5vcm1hbCBkcm9wDQogICAgICAvLyBEb24ndCBkbyBhIHJlcGxhY2UgaWYgdGhlIGRyb3AgaGFwcGVuZWQgaW5zaWRlIG9mIHRoZSBzZWxlY3RlZCB0ZXh0Lg0KICAgICAgaWYgKGNtLnN0YXRlLmRyYWdnaW5nVGV4dCAmJiBjbS5kb2Muc2VsLmNvbnRhaW5zKHBvcykgPiAtMSkgew0KICAgICAgICBjbS5zdGF0ZS5kcmFnZ2luZ1RleHQoZSk7DQogICAgICAgIC8vIEVuc3VyZSB0aGUgZWRpdG9yIGlzIHJlLWZvY3VzZWQNCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBjbS5kaXNwbGF5LmlucHV0LmZvY3VzKCk7IH0sIDIwKTsNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQogICAgICB0cnkgew0KICAgICAgICB2YXIgdGV4dCQxID0gZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgiVGV4dCIpOw0KICAgICAgICBpZiAodGV4dCQxKSB7DQogICAgICAgICAgdmFyIHNlbGVjdGVkOw0KICAgICAgICAgIGlmIChjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgJiYgIWNtLnN0YXRlLmRyYWdnaW5nVGV4dC5jb3B5KQ0KICAgICAgICAgICAgeyBzZWxlY3RlZCA9IGNtLmxpc3RTZWxlY3Rpb25zKCk7IH0NCiAgICAgICAgICBzZXRTZWxlY3Rpb25Ob1VuZG8oY20uZG9jLCBzaW1wbGVTZWxlY3Rpb24ocG9zLCBwb3MpKTsNCiAgICAgICAgICBpZiAoc2VsZWN0ZWQpIHsgZm9yICh2YXIgaSQxID0gMDsgaSQxIDwgc2VsZWN0ZWQubGVuZ3RoOyArK2kkMSkNCiAgICAgICAgICAgIHsgcmVwbGFjZVJhbmdlKGNtLmRvYywgIiIsIHNlbGVjdGVkW2kkMV0uYW5jaG9yLCBzZWxlY3RlZFtpJDFdLmhlYWQsICJkcmFnIik7IH0gfQ0KICAgICAgICAgIGNtLnJlcGxhY2VTZWxlY3Rpb24odGV4dCQxLCAiYXJvdW5kIiwgInBhc3RlIik7DQogICAgICAgICAgY20uZGlzcGxheS5pbnB1dC5mb2N1cygpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICBjYXRjaChlKXt9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gb25EcmFnU3RhcnQoY20sIGUpIHsNCiAgICBpZiAoaWUgJiYgKCFjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgfHwgK25ldyBEYXRlIC0gbGFzdERyb3AgPCAxMDApKSB7IGVfc3RvcChlKTsgcmV0dXJuIH0NCiAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpIHx8IGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkpIHsgcmV0dXJuIH0NCg0KICAgIGUuZGF0YVRyYW5zZmVyLnNldERhdGEoIlRleHQiLCBjbS5nZXRTZWxlY3Rpb24oKSk7DQogICAgZS5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9ICJjb3B5TW92ZSI7DQoNCiAgICAvLyBVc2UgZHVtbXkgaW1hZ2UgaW5zdGVhZCBvZiBkZWZhdWx0IGJyb3dzZXJzIGltYWdlLg0KICAgIC8vIFJlY2VudCBTYWZhcmkgKH42LjAuMikgaGF2ZSBhIHRlbmRlbmN5IHRvIHNlZ2ZhdWx0IHdoZW4gdGhpcyBoYXBwZW5zLCBzbyB3ZSBkb24ndCBkbyBpdCB0aGVyZS4NCiAgICBpZiAoZS5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlICYmICFzYWZhcmkpIHsNCiAgICAgIHZhciBpbWcgPSBlbHQoImltZyIsIG51bGwsIG51bGwsICJwb3NpdGlvbjogZml4ZWQ7IGxlZnQ6IDA7IHRvcDogMDsiKTsNCiAgICAgIGltZy5zcmMgPSAiZGF0YTppbWFnZS9naWY7YmFzZTY0LFIwbEdPRGxoQVFBQkFBQUFBQ0g1QkFFS0FBRUFMQUFBQUFBQkFBRUFBQUlDVEFFQU93PT0iOw0KICAgICAgaWYgKHByZXN0bykgew0KICAgICAgICBpbWcud2lkdGggPSBpbWcuaGVpZ2h0ID0gMTsNCiAgICAgICAgY20uZGlzcGxheS53cmFwcGVyLmFwcGVuZENoaWxkKGltZyk7DQogICAgICAgIC8vIEZvcmNlIGEgcmVsYXlvdXQsIG9yIE9wZXJhIHdvbid0IHVzZSBvdXIgaW1hZ2UgZm9yIHNvbWUgb2JzY3VyZSByZWFzb24NCiAgICAgICAgaW1nLl90b3AgPSBpbWcub2Zmc2V0VG9wOw0KICAgICAgfQ0KICAgICAgZS5kYXRhVHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGltZywgMCwgMCk7DQogICAgICBpZiAocHJlc3RvKSB7IGltZy5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGltZyk7IH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBvbkRyYWdPdmVyKGNtLCBlKSB7DQogICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSk7DQogICAgaWYgKCFwb3MpIHsgcmV0dXJuIH0NCiAgICB2YXIgZnJhZyA9IGRvY3VtZW50LmNyZWF0ZURvY3VtZW50RnJhZ21lbnQoKTsNCiAgICBkcmF3U2VsZWN0aW9uQ3Vyc29yKGNtLCBwb3MsIGZyYWcpOw0KICAgIGlmICghY20uZGlzcGxheS5kcmFnQ3Vyc29yKSB7DQogICAgICBjbS5kaXNwbGF5LmRyYWdDdXJzb3IgPSBlbHQoImRpdiIsIG51bGwsICJDb2RlTWlycm9yLWN1cnNvcnMgQ29kZU1pcnJvci1kcmFnY3Vyc29ycyIpOw0KICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UuaW5zZXJ0QmVmb3JlKGNtLmRpc3BsYXkuZHJhZ0N1cnNvciwgY20uZGlzcGxheS5jdXJzb3JEaXYpOw0KICAgIH0NCiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZChjbS5kaXNwbGF5LmRyYWdDdXJzb3IsIGZyYWcpOw0KICB9DQoNCiAgZnVuY3Rpb24gY2xlYXJEcmFnQ3Vyc29yKGNtKSB7DQogICAgaWYgKGNtLmRpc3BsYXkuZHJhZ0N1cnNvcikgew0KICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UucmVtb3ZlQ2hpbGQoY20uZGlzcGxheS5kcmFnQ3Vyc29yKTsNCiAgICAgIGNtLmRpc3BsYXkuZHJhZ0N1cnNvciA9IG51bGw7DQogICAgfQ0KICB9DQoNCiAgLy8gVGhlc2UgbXVzdCBiZSBoYW5kbGVkIGNhcmVmdWxseSwgYmVjYXVzZSBuYWl2ZWx5IHJlZ2lzdGVyaW5nIGENCiAgLy8gaGFuZGxlciBmb3IgZWFjaCBlZGl0b3Igd2lsbCBjYXVzZSB0aGUgZWRpdG9ycyB0byBuZXZlciBiZQ0KICAvLyBnYXJiYWdlIGNvbGxlY3RlZC4NCg0KICBmdW5jdGlvbiBmb3JFYWNoQ29kZU1pcnJvcihmKSB7DQogICAgaWYgKCFkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKSB7IHJldHVybiB9DQogICAgdmFyIGJ5Q2xhc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCJDb2RlTWlycm9yIiksIGVkaXRvcnMgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5Q2xhc3MubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciBjbSA9IGJ5Q2xhc3NbaV0uQ29kZU1pcnJvcjsNCiAgICAgIGlmIChjbSkgeyBlZGl0b3JzLnB1c2goY20pOyB9DQogICAgfQ0KICAgIGlmIChlZGl0b3JzLmxlbmd0aCkgeyBlZGl0b3JzWzBdLm9wZXJhdGlvbihmdW5jdGlvbiAoKSB7DQogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGVkaXRvcnMubGVuZ3RoOyBpKyspIHsgZihlZGl0b3JzW2ldKTsgfQ0KICAgIH0pOyB9DQogIH0NCg0KICB2YXIgZ2xvYmFsc1JlZ2lzdGVyZWQgPSBmYWxzZTsNCiAgZnVuY3Rpb24gZW5zdXJlR2xvYmFsSGFuZGxlcnMoKSB7DQogICAgaWYgKGdsb2JhbHNSZWdpc3RlcmVkKSB7IHJldHVybiB9DQogICAgcmVnaXN0ZXJHbG9iYWxIYW5kbGVycygpOw0KICAgIGdsb2JhbHNSZWdpc3RlcmVkID0gdHJ1ZTsNCiAgfQ0KICBmdW5jdGlvbiByZWdpc3Rlckdsb2JhbEhhbmRsZXJzKCkgew0KICAgIC8vIFdoZW4gdGhlIHdpbmRvdyByZXNpemVzLCB3ZSBuZWVkIHRvIHJlZnJlc2ggYWN0aXZlIGVkaXRvcnMuDQogICAgdmFyIHJlc2l6ZVRpbWVyOw0KICAgIG9uKHdpbmRvdywgInJlc2l6ZSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmIChyZXNpemVUaW1lciA9PSBudWxsKSB7IHJlc2l6ZVRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICAgIHJlc2l6ZVRpbWVyID0gbnVsbDsNCiAgICAgICAgZm9yRWFjaENvZGVNaXJyb3Iob25SZXNpemUpOw0KICAgICAgfSwgMTAwKTsgfQ0KICAgIH0pOw0KICAgIC8vIFdoZW4gdGhlIHdpbmRvdyBsb3NlcyBmb2N1cywgd2Ugd2FudCB0byBzaG93IHRoZSBlZGl0b3IgYXMgYmx1cnJlZA0KICAgIG9uKHdpbmRvdywgImJsdXIiLCBmdW5jdGlvbiAoKSB7IHJldHVybiBmb3JFYWNoQ29kZU1pcnJvcihvbkJsdXIpOyB9KTsNCiAgfQ0KICAvLyBDYWxsZWQgd2hlbiB0aGUgd2luZG93IHJlc2l6ZXMNCiAgZnVuY3Rpb24gb25SZXNpemUoY20pIHsNCiAgICB2YXIgZCA9IGNtLmRpc3BsYXk7DQogICAgLy8gTWlnaHQgYmUgYSB0ZXh0IHNjYWxpbmcgb3BlcmF0aW9uLCBjbGVhciBzaXplIGNhY2hlcy4NCiAgICBkLmNhY2hlZENoYXJXaWR0aCA9IGQuY2FjaGVkVGV4dEhlaWdodCA9IGQuY2FjaGVkUGFkZGluZ0ggPSBudWxsOw0KICAgIGQuc2Nyb2xsYmFyc0NsaXBwZWQgPSBmYWxzZTsNCiAgICBjbS5zZXRTaXplKCk7DQogIH0NCg0KICB2YXIga2V5TmFtZXMgPSB7DQogICAgMzogIlBhdXNlIiwgODogIkJhY2tzcGFjZSIsIDk6ICJUYWIiLCAxMzogIkVudGVyIiwgMTY6ICJTaGlmdCIsIDE3OiAiQ3RybCIsIDE4OiAiQWx0IiwNCiAgICAxOTogIlBhdXNlIiwgMjA6ICJDYXBzTG9jayIsIDI3OiAiRXNjIiwgMzI6ICJTcGFjZSIsIDMzOiAiUGFnZVVwIiwgMzQ6ICJQYWdlRG93biIsIDM1OiAiRW5kIiwNCiAgICAzNjogIkhvbWUiLCAzNzogIkxlZnQiLCAzODogIlVwIiwgMzk6ICJSaWdodCIsIDQwOiAiRG93biIsIDQ0OiAiUHJpbnRTY3JuIiwgNDU6ICJJbnNlcnQiLA0KICAgIDQ2OiAiRGVsZXRlIiwgNTk6ICI7IiwgNjE6ICI9IiwgOTE6ICJNb2QiLCA5MjogIk1vZCIsIDkzOiAiTW9kIiwNCiAgICAxMDY6ICIqIiwgMTA3OiAiPSIsIDEwOTogIi0iLCAxMTA6ICIuIiwgMTExOiAiLyIsIDE0NTogIlNjcm9sbExvY2siLA0KICAgIDE3MzogIi0iLCAxODY6ICI7IiwgMTg3OiAiPSIsIDE4ODogIiwiLCAxODk6ICItIiwgMTkwOiAiLiIsIDE5MTogIi8iLCAxOTI6ICJgIiwgMjE5OiAiWyIsIDIyMDogIlxcIiwNCiAgICAyMjE6ICJdIiwgMjIyOiAiJyIsIDYzMjMyOiAiVXAiLCA2MzIzMzogIkRvd24iLCA2MzIzNDogIkxlZnQiLCA2MzIzNTogIlJpZ2h0IiwgNjMyNzI6ICJEZWxldGUiLA0KICAgIDYzMjczOiAiSG9tZSIsIDYzMjc1OiAiRW5kIiwgNjMyNzY6ICJQYWdlVXAiLCA2MzI3NzogIlBhZ2VEb3duIiwgNjMzMDI6ICJJbnNlcnQiDQogIH07DQoNCiAgLy8gTnVtYmVyIGtleXMNCiAgZm9yICh2YXIgaSA9IDA7IGkgPCAxMDsgaSsrKSB7IGtleU5hbWVzW2kgKyA0OF0gPSBrZXlOYW1lc1tpICsgOTZdID0gU3RyaW5nKGkpOyB9DQogIC8vIEFscGhhYmV0aWMga2V5cw0KICBmb3IgKHZhciBpJDEgPSA2NTsgaSQxIDw9IDkwOyBpJDErKykgeyBrZXlOYW1lc1tpJDFdID0gU3RyaW5nLmZyb21DaGFyQ29kZShpJDEpOyB9DQogIC8vIEZ1bmN0aW9uIGtleXMNCiAgZm9yICh2YXIgaSQyID0gMTsgaSQyIDw9IDEyOyBpJDIrKykgeyBrZXlOYW1lc1tpJDIgKyAxMTFdID0ga2V5TmFtZXNbaSQyICsgNjMyMzVdID0gIkYiICsgaSQyOyB9DQoNCiAgdmFyIGtleU1hcCA9IHt9Ow0KDQogIGtleU1hcC5iYXNpYyA9IHsNCiAgICAiTGVmdCI6ICJnb0NoYXJMZWZ0IiwgIlJpZ2h0IjogImdvQ2hhclJpZ2h0IiwgIlVwIjogImdvTGluZVVwIiwgIkRvd24iOiAiZ29MaW5lRG93biIsDQogICAgIkVuZCI6ICJnb0xpbmVFbmQiLCAiSG9tZSI6ICJnb0xpbmVTdGFydFNtYXJ0IiwgIlBhZ2VVcCI6ICJnb1BhZ2VVcCIsICJQYWdlRG93biI6ICJnb1BhZ2VEb3duIiwNCiAgICAiRGVsZXRlIjogImRlbENoYXJBZnRlciIsICJCYWNrc3BhY2UiOiAiZGVsQ2hhckJlZm9yZSIsICJTaGlmdC1CYWNrc3BhY2UiOiAiZGVsQ2hhckJlZm9yZSIsDQogICAgIlRhYiI6ICJkZWZhdWx0VGFiIiwgIlNoaWZ0LVRhYiI6ICJpbmRlbnRBdXRvIiwNCiAgICAiRW50ZXIiOiAibmV3bGluZUFuZEluZGVudCIsICJJbnNlcnQiOiAidG9nZ2xlT3ZlcndyaXRlIiwNCiAgICAiRXNjIjogInNpbmdsZVNlbGVjdGlvbiINCiAgfTsNCiAgLy8gTm90ZSB0aGF0IHRoZSBzYXZlIGFuZCBmaW5kLXJlbGF0ZWQgY29tbWFuZHMgYXJlbid0IGRlZmluZWQgYnkNCiAgLy8gZGVmYXVsdC4gVXNlciBjb2RlIG9yIGFkZG9ucyBjYW4gZGVmaW5lIHRoZW0uIFVua25vd24gY29tbWFuZHMNCiAgLy8gYXJlIHNpbXBseSBpZ25vcmVkLg0KICBrZXlNYXAucGNEZWZhdWx0ID0gew0KICAgICJDdHJsLUEiOiAic2VsZWN0QWxsIiwgIkN0cmwtRCI6ICJkZWxldGVMaW5lIiwgIkN0cmwtWiI6ICJ1bmRvIiwgIlNoaWZ0LUN0cmwtWiI6ICJyZWRvIiwgIkN0cmwtWSI6ICJyZWRvIiwNCiAgICAiQ3RybC1Ib21lIjogImdvRG9jU3RhcnQiLCAiQ3RybC1FbmQiOiAiZ29Eb2NFbmQiLCAiQ3RybC1VcCI6ICJnb0xpbmVVcCIsICJDdHJsLURvd24iOiAiZ29MaW5lRG93biIsDQogICAgIkN0cmwtTGVmdCI6ICJnb0dyb3VwTGVmdCIsICJDdHJsLVJpZ2h0IjogImdvR3JvdXBSaWdodCIsICJBbHQtTGVmdCI6ICJnb0xpbmVTdGFydCIsICJBbHQtUmlnaHQiOiAiZ29MaW5lRW5kIiwNCiAgICAiQ3RybC1CYWNrc3BhY2UiOiAiZGVsR3JvdXBCZWZvcmUiLCAiQ3RybC1EZWxldGUiOiAiZGVsR3JvdXBBZnRlciIsICJDdHJsLVMiOiAic2F2ZSIsICJDdHJsLUYiOiAiZmluZCIsDQogICAgIkN0cmwtRyI6ICJmaW5kTmV4dCIsICJTaGlmdC1DdHJsLUciOiAiZmluZFByZXYiLCAiU2hpZnQtQ3RybC1GIjogInJlcGxhY2UiLCAiU2hpZnQtQ3RybC1SIjogInJlcGxhY2VBbGwiLA0KICAgICJDdHJsLVsiOiAiaW5kZW50TGVzcyIsICJDdHJsLV0iOiAiaW5kZW50TW9yZSIsDQogICAgIkN0cmwtVSI6ICJ1bmRvU2VsZWN0aW9uIiwgIlNoaWZ0LUN0cmwtVSI6ICJyZWRvU2VsZWN0aW9uIiwgIkFsdC1VIjogInJlZG9TZWxlY3Rpb24iLA0KICAgICJmYWxsdGhyb3VnaCI6ICJiYXNpYyINCiAgfTsNCiAgLy8gVmVyeSBiYXNpYyByZWFkbGluZS9lbWFjcy1zdHlsZSBiaW5kaW5ncywgd2hpY2ggYXJlIHN0YW5kYXJkIG9uIE1hYy4NCiAga2V5TWFwLmVtYWNzeSA9IHsNCiAgICAiQ3RybC1GIjogImdvQ2hhclJpZ2h0IiwgIkN0cmwtQiI6ICJnb0NoYXJMZWZ0IiwgIkN0cmwtUCI6ICJnb0xpbmVVcCIsICJDdHJsLU4iOiAiZ29MaW5lRG93biIsDQogICAgIkFsdC1GIjogImdvV29yZFJpZ2h0IiwgIkFsdC1CIjogImdvV29yZExlZnQiLCAiQ3RybC1BIjogImdvTGluZVN0YXJ0IiwgIkN0cmwtRSI6ICJnb0xpbmVFbmQiLA0KICAgICJDdHJsLVYiOiAiZ29QYWdlRG93biIsICJTaGlmdC1DdHJsLVYiOiAiZ29QYWdlVXAiLCAiQ3RybC1EIjogImRlbENoYXJBZnRlciIsICJDdHJsLUgiOiAiZGVsQ2hhckJlZm9yZSIsDQogICAgIkFsdC1EIjogImRlbFdvcmRBZnRlciIsICJBbHQtQmFja3NwYWNlIjogImRlbFdvcmRCZWZvcmUiLCAiQ3RybC1LIjogImtpbGxMaW5lIiwgIkN0cmwtVCI6ICJ0cmFuc3Bvc2VDaGFycyIsDQogICAgIkN0cmwtTyI6ICJvcGVuTGluZSINCiAgfTsNCiAga2V5TWFwLm1hY0RlZmF1bHQgPSB7DQogICAgIkNtZC1BIjogInNlbGVjdEFsbCIsICJDbWQtRCI6ICJkZWxldGVMaW5lIiwgIkNtZC1aIjogInVuZG8iLCAiU2hpZnQtQ21kLVoiOiAicmVkbyIsICJDbWQtWSI6ICJyZWRvIiwNCiAgICAiQ21kLUhvbWUiOiAiZ29Eb2NTdGFydCIsICJDbWQtVXAiOiAiZ29Eb2NTdGFydCIsICJDbWQtRW5kIjogImdvRG9jRW5kIiwgIkNtZC1Eb3duIjogImdvRG9jRW5kIiwgIkFsdC1MZWZ0IjogImdvR3JvdXBMZWZ0IiwNCiAgICAiQWx0LVJpZ2h0IjogImdvR3JvdXBSaWdodCIsICJDbWQtTGVmdCI6ICJnb0xpbmVMZWZ0IiwgIkNtZC1SaWdodCI6ICJnb0xpbmVSaWdodCIsICJBbHQtQmFja3NwYWNlIjogImRlbEdyb3VwQmVmb3JlIiwNCiAgICAiQ3RybC1BbHQtQmFja3NwYWNlIjogImRlbEdyb3VwQWZ0ZXIiLCAiQWx0LURlbGV0ZSI6ICJkZWxHcm91cEFmdGVyIiwgIkNtZC1TIjogInNhdmUiLCAiQ21kLUYiOiAiZmluZCIsDQogICAgIkNtZC1HIjogImZpbmROZXh0IiwgIlNoaWZ0LUNtZC1HIjogImZpbmRQcmV2IiwgIkNtZC1BbHQtRiI6ICJyZXBsYWNlIiwgIlNoaWZ0LUNtZC1BbHQtRiI6ICJyZXBsYWNlQWxsIiwNCiAgICAiQ21kLVsiOiAiaW5kZW50TGVzcyIsICJDbWQtXSI6ICJpbmRlbnRNb3JlIiwgIkNtZC1CYWNrc3BhY2UiOiAiZGVsV3JhcHBlZExpbmVMZWZ0IiwgIkNtZC1EZWxldGUiOiAiZGVsV3JhcHBlZExpbmVSaWdodCIsDQogICAgIkNtZC1VIjogInVuZG9TZWxlY3Rpb24iLCAiU2hpZnQtQ21kLVUiOiAicmVkb1NlbGVjdGlvbiIsICJDdHJsLVVwIjogImdvRG9jU3RhcnQiLCAiQ3RybC1Eb3duIjogImdvRG9jRW5kIiwNCiAgICAiZmFsbHRocm91Z2giOiBbImJhc2ljIiwgImVtYWNzeSJdDQogIH07DQogIGtleU1hcFsiZGVmYXVsdCJdID0gbWFjID8ga2V5TWFwLm1hY0RlZmF1bHQgOiBrZXlNYXAucGNEZWZhdWx0Ow0KDQogIC8vIEtFWU1BUCBESVNQQVRDSA0KDQogIGZ1bmN0aW9uIG5vcm1hbGl6ZUtleU5hbWUobmFtZSkgew0KICAgIHZhciBwYXJ0cyA9IG5hbWUuc3BsaXQoLy0oPyEkKS8pOw0KICAgIG5hbWUgPSBwYXJ0c1twYXJ0cy5sZW5ndGggLSAxXTsNCiAgICB2YXIgYWx0LCBjdHJsLCBzaGlmdCwgY21kOw0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFydHMubGVuZ3RoIC0gMTsgaSsrKSB7DQogICAgICB2YXIgbW9kID0gcGFydHNbaV07DQogICAgICBpZiAoL14oY21kfG1ldGF8bSkkL2kudGVzdChtb2QpKSB7IGNtZCA9IHRydWU7IH0NCiAgICAgIGVsc2UgaWYgKC9eYShsdCk/JC9pLnRlc3QobW9kKSkgeyBhbHQgPSB0cnVlOyB9DQogICAgICBlbHNlIGlmICgvXihjfGN0cmx8Y29udHJvbCkkL2kudGVzdChtb2QpKSB7IGN0cmwgPSB0cnVlOyB9DQogICAgICBlbHNlIGlmICgvXnMoaGlmdCk/JC9pLnRlc3QobW9kKSkgeyBzaGlmdCA9IHRydWU7IH0NCiAgICAgIGVsc2UgeyB0aHJvdyBuZXcgRXJyb3IoIlVucmVjb2duaXplZCBtb2RpZmllciBuYW1lOiAiICsgbW9kKSB9DQogICAgfQ0KICAgIGlmIChhbHQpIHsgbmFtZSA9ICJBbHQtIiArIG5hbWU7IH0NCiAgICBpZiAoY3RybCkgeyBuYW1lID0gIkN0cmwtIiArIG5hbWU7IH0NCiAgICBpZiAoY21kKSB7IG5hbWUgPSAiQ21kLSIgKyBuYW1lOyB9DQogICAgaWYgKHNoaWZ0KSB7IG5hbWUgPSAiU2hpZnQtIiArIG5hbWU7IH0NCiAgICByZXR1cm4gbmFtZQ0KICB9DQoNCiAgLy8gVGhpcyBpcyBhIGtsdWRnZSB0byBrZWVwIGtleW1hcHMgbW9zdGx5IHdvcmtpbmcgYXMgcmF3IG9iamVjdHMNCiAgLy8gKGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5KSB3aGlsZSBhdCB0aGUgc2FtZSB0aW1lIHN1cHBvcnQgZmVhdHVyZXMNCiAgLy8gbGlrZSBub3JtYWxpemF0aW9uIGFuZCBtdWx0aS1zdHJva2Uga2V5IGJpbmRpbmdzLiBJdCBjb21waWxlcyBhDQogIC8vIG5ldyBub3JtYWxpemVkIGtleW1hcCwgYW5kIHRoZW4gdXBkYXRlcyB0aGUgb2xkIG9iamVjdCB0byByZWZsZWN0DQogIC8vIHRoaXMuDQogIGZ1bmN0aW9uIG5vcm1hbGl6ZUtleU1hcChrZXltYXApIHsNCiAgICB2YXIgY29weSA9IHt9Ow0KICAgIGZvciAodmFyIGtleW5hbWUgaW4ga2V5bWFwKSB7IGlmIChrZXltYXAuaGFzT3duUHJvcGVydHkoa2V5bmFtZSkpIHsNCiAgICAgIHZhciB2YWx1ZSA9IGtleW1hcFtrZXluYW1lXTsNCiAgICAgIGlmICgvXihuYW1lfGZhbGx0aHJvdWdofChkZXxhdCl0YWNoKSQvLnRlc3Qoa2V5bmFtZSkpIHsgY29udGludWUgfQ0KICAgICAgaWYgKHZhbHVlID09ICIuLi4iKSB7IGRlbGV0ZSBrZXltYXBba2V5bmFtZV07IGNvbnRpbnVlIH0NCg0KICAgICAgdmFyIGtleXMgPSBtYXAoa2V5bmFtZS5zcGxpdCgiICIpLCBub3JtYWxpemVLZXlOYW1lKTsNCiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgew0KICAgICAgICB2YXIgdmFsID0gKHZvaWQgMCksIG5hbWUgPSAodm9pZCAwKTsNCiAgICAgICAgaWYgKGkgPT0ga2V5cy5sZW5ndGggLSAxKSB7DQogICAgICAgICAgbmFtZSA9IGtleXMuam9pbigiICIpOw0KICAgICAgICAgIHZhbCA9IHZhbHVlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIG5hbWUgPSBrZXlzLnNsaWNlKDAsIGkgKyAxKS5qb2luKCIgIik7DQogICAgICAgICAgdmFsID0gIi4uLiI7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHByZXYgPSBjb3B5W25hbWVdOw0KICAgICAgICBpZiAoIXByZXYpIHsgY29weVtuYW1lXSA9IHZhbDsgfQ0KICAgICAgICBlbHNlIGlmIChwcmV2ICE9IHZhbCkgeyB0aHJvdyBuZXcgRXJyb3IoIkluY29uc2lzdGVudCBiaW5kaW5ncyBmb3IgIiArIG5hbWUpIH0NCiAgICAgIH0NCiAgICAgIGRlbGV0ZSBrZXltYXBba2V5bmFtZV07DQogICAgfSB9DQogICAgZm9yICh2YXIgcHJvcCBpbiBjb3B5KSB7IGtleW1hcFtwcm9wXSA9IGNvcHlbcHJvcF07IH0NCiAgICByZXR1cm4ga2V5bWFwDQogIH0NCg0KICBmdW5jdGlvbiBsb29rdXBLZXkoa2V5LCBtYXAkJDEsIGhhbmRsZSwgY29udGV4dCkgew0KICAgIG1hcCQkMSA9IGdldEtleU1hcChtYXAkJDEpOw0KICAgIHZhciBmb3VuZCA9IG1hcCQkMS5jYWxsID8gbWFwJCQxLmNhbGwoa2V5LCBjb250ZXh0KSA6IG1hcCQkMVtrZXldOw0KICAgIGlmIChmb3VuZCA9PT0gZmFsc2UpIHsgcmV0dXJuICJub3RoaW5nIiB9DQogICAgaWYgKGZvdW5kID09PSAiLi4uIikgeyByZXR1cm4gIm11bHRpIiB9DQogICAgaWYgKGZvdW5kICE9IG51bGwgJiYgaGFuZGxlKGZvdW5kKSkgeyByZXR1cm4gImhhbmRsZWQiIH0NCg0KICAgIGlmIChtYXAkJDEuZmFsbHRocm91Z2gpIHsNCiAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwobWFwJCQxLmZhbGx0aHJvdWdoKSAhPSAiW29iamVjdCBBcnJheV0iKQ0KICAgICAgICB7IHJldHVybiBsb29rdXBLZXkoa2V5LCBtYXAkJDEuZmFsbHRocm91Z2gsIGhhbmRsZSwgY29udGV4dCkgfQ0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXAkJDEuZmFsbHRocm91Z2gubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIHJlc3VsdCA9IGxvb2t1cEtleShrZXksIG1hcCQkMS5mYWxsdGhyb3VnaFtpXSwgaGFuZGxlLCBjb250ZXh0KTsNCiAgICAgICAgaWYgKHJlc3VsdCkgeyByZXR1cm4gcmVzdWx0IH0NCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAvLyBNb2RpZmllciBrZXkgcHJlc3NlcyBkb24ndCBjb3VudCBhcyAncmVhbCcga2V5IHByZXNzZXMgZm9yIHRoZQ0KICAvLyBwdXJwb3NlIG9mIGtleW1hcCBmYWxsdGhyb3VnaC4NCiAgZnVuY3Rpb24gaXNNb2RpZmllcktleSh2YWx1ZSkgew0KICAgIHZhciBuYW1lID0gdHlwZW9mIHZhbHVlID09ICJzdHJpbmciID8gdmFsdWUgOiBrZXlOYW1lc1t2YWx1ZS5rZXlDb2RlXTsNCiAgICByZXR1cm4gbmFtZSA9PSAiQ3RybCIgfHwgbmFtZSA9PSAiQWx0IiB8fCBuYW1lID09ICJTaGlmdCIgfHwgbmFtZSA9PSAiTW9kIg0KICB9DQoNCiAgZnVuY3Rpb24gYWRkTW9kaWZpZXJOYW1lcyhuYW1lLCBldmVudCwgbm9TaGlmdCkgew0KICAgIHZhciBiYXNlID0gbmFtZTsNCiAgICBpZiAoZXZlbnQuYWx0S2V5ICYmIGJhc2UgIT0gIkFsdCIpIHsgbmFtZSA9ICJBbHQtIiArIG5hbWU7IH0NCiAgICBpZiAoKGZsaXBDdHJsQ21kID8gZXZlbnQubWV0YUtleSA6IGV2ZW50LmN0cmxLZXkpICYmIGJhc2UgIT0gIkN0cmwiKSB7IG5hbWUgPSAiQ3RybC0iICsgbmFtZTsgfQ0KICAgIGlmICgoZmxpcEN0cmxDbWQgPyBldmVudC5jdHJsS2V5IDogZXZlbnQubWV0YUtleSkgJiYgYmFzZSAhPSAiQ21kIikgeyBuYW1lID0gIkNtZC0iICsgbmFtZTsgfQ0KICAgIGlmICghbm9TaGlmdCAmJiBldmVudC5zaGlmdEtleSAmJiBiYXNlICE9ICJTaGlmdCIpIHsgbmFtZSA9ICJTaGlmdC0iICsgbmFtZTsgfQ0KICAgIHJldHVybiBuYW1lDQogIH0NCg0KICAvLyBMb29rIHVwIHRoZSBuYW1lIG9mIGEga2V5IGFzIGluZGljYXRlZCBieSBhbiBldmVudCBvYmplY3QuDQogIGZ1bmN0aW9uIGtleU5hbWUoZXZlbnQsIG5vU2hpZnQpIHsNCiAgICBpZiAocHJlc3RvICYmIGV2ZW50LmtleUNvZGUgPT0gMzQgJiYgZXZlbnRbImNoYXIiXSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIHZhciBuYW1lID0ga2V5TmFtZXNbZXZlbnQua2V5Q29kZV07DQogICAgaWYgKG5hbWUgPT0gbnVsbCB8fCBldmVudC5hbHRHcmFwaEtleSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIC8vIEN0cmwtU2Nyb2xsTG9jayBoYXMga2V5Q29kZSAzLCBzYW1lIGFzIEN0cmwtUGF1c2UsDQogICAgLy8gc28gd2UnbGwgdXNlIGV2ZW50LmNvZGUgd2hlbiBhdmFpbGFibGUgKENocm9tZSA0OCssIEZGIDM4KywgU2FmYXJpIDEwLjErKQ0KICAgIGlmIChldmVudC5rZXlDb2RlID09IDMgJiYgZXZlbnQuY29kZSkgeyBuYW1lID0gZXZlbnQuY29kZTsgfQ0KICAgIHJldHVybiBhZGRNb2RpZmllck5hbWVzKG5hbWUsIGV2ZW50LCBub1NoaWZ0KQ0KICB9DQoNCiAgZnVuY3Rpb24gZ2V0S2V5TWFwKHZhbCkgew0KICAgIHJldHVybiB0eXBlb2YgdmFsID09ICJzdHJpbmciID8ga2V5TWFwW3ZhbF0gOiB2YWwNCiAgfQ0KDQogIC8vIEhlbHBlciBmb3IgZGVsZXRpbmcgdGV4dCBuZWFyIHRoZSBzZWxlY3Rpb24ocyksIHVzZWQgdG8gaW1wbGVtZW50DQogIC8vIGJhY2tzcGFjZSwgZGVsZXRlLCBhbmQgc2ltaWxhciBmdW5jdGlvbmFsaXR5Lg0KICBmdW5jdGlvbiBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBjb21wdXRlKSB7DQogICAgdmFyIHJhbmdlcyA9IGNtLmRvYy5zZWwucmFuZ2VzLCBraWxsID0gW107DQogICAgLy8gQnVpbGQgdXAgYSBzZXQgb2YgcmFuZ2VzIHRvIGtpbGwgZmlyc3QsIG1lcmdpbmcgb3ZlcmxhcHBpbmcNCiAgICAvLyByYW5nZXMuDQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgIHZhciB0b0tpbGwgPSBjb21wdXRlKHJhbmdlc1tpXSk7DQogICAgICB3aGlsZSAoa2lsbC5sZW5ndGggJiYgY21wKHRvS2lsbC5mcm9tLCBsc3Qoa2lsbCkudG8pIDw9IDApIHsNCiAgICAgICAgdmFyIHJlcGxhY2VkID0ga2lsbC5wb3AoKTsNCiAgICAgICAgaWYgKGNtcChyZXBsYWNlZC5mcm9tLCB0b0tpbGwuZnJvbSkgPCAwKSB7DQogICAgICAgICAgdG9LaWxsLmZyb20gPSByZXBsYWNlZC5mcm9tOw0KICAgICAgICAgIGJyZWFrDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGtpbGwucHVzaCh0b0tpbGwpOw0KICAgIH0NCiAgICAvLyBOZXh0LCByZW1vdmUgdGhvc2UgYWN0dWFsIHJhbmdlcy4NCiAgICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7DQogICAgICBmb3IgKHZhciBpID0ga2lsbC5sZW5ndGggLSAxOyBpID49IDA7IGktLSkNCiAgICAgICAgeyByZXBsYWNlUmFuZ2UoY20uZG9jLCAiIiwga2lsbFtpXS5mcm9tLCBraWxsW2ldLnRvLCAiK2RlbGV0ZSIpOyB9DQogICAgICBlbnN1cmVDdXJzb3JWaXNpYmxlKGNtKTsNCiAgICB9KTsNCiAgfQ0KDQogIGZ1bmN0aW9uIG1vdmVDaGFyTG9naWNhbGx5KGxpbmUsIGNoLCBkaXIpIHsNCiAgICB2YXIgdGFyZ2V0ID0gc2tpcEV4dGVuZGluZ0NoYXJzKGxpbmUudGV4dCwgY2ggKyBkaXIsIGRpcik7DQogICAgcmV0dXJuIHRhcmdldCA8IDAgfHwgdGFyZ2V0ID4gbGluZS50ZXh0Lmxlbmd0aCA/IG51bGwgOiB0YXJnZXQNCiAgfQ0KDQogIGZ1bmN0aW9uIG1vdmVMb2dpY2FsbHkobGluZSwgc3RhcnQsIGRpcikgew0KICAgIHZhciBjaCA9IG1vdmVDaGFyTG9naWNhbGx5KGxpbmUsIHN0YXJ0LmNoLCBkaXIpOw0KICAgIHJldHVybiBjaCA9PSBudWxsID8gbnVsbCA6IG5ldyBQb3Moc3RhcnQubGluZSwgY2gsIGRpciA8IDAgPyAiYWZ0ZXIiIDogImJlZm9yZSIpDQogIH0NCg0KICBmdW5jdGlvbiBlbmRPZkxpbmUodmlzdWFsbHksIGNtLCBsaW5lT2JqLCBsaW5lTm8sIGRpcikgew0KICAgIGlmICh2aXN1YWxseSkgew0KICAgICAgaWYgKGNtLmRvYy5kaXJlY3Rpb24gPT0gInJ0bCIpIHsgZGlyID0gLWRpcjsgfQ0KICAgICAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZU9iaiwgY20uZG9jLmRpcmVjdGlvbik7DQogICAgICBpZiAob3JkZXIpIHsNCiAgICAgICAgdmFyIHBhcnQgPSBkaXIgPCAwID8gbHN0KG9yZGVyKSA6IG9yZGVyWzBdOw0KICAgICAgICB2YXIgbW92ZUluU3RvcmFnZU9yZGVyID0gKGRpciA8IDApID09IChwYXJ0LmxldmVsID09IDEpOw0KICAgICAgICB2YXIgc3RpY2t5ID0gbW92ZUluU3RvcmFnZU9yZGVyID8gImFmdGVyIiA6ICJiZWZvcmUiOw0KICAgICAgICB2YXIgY2g7DQogICAgICAgIC8vIFdpdGggYSB3cmFwcGVkIHJ0bCBjaHVuayAocG9zc2libHkgc3Bhbm5pbmcgbXVsdGlwbGUgYmlkaSBwYXJ0cyksDQogICAgICAgIC8vIGl0IGNvdWxkIGJlIHRoYXQgdGhlIGxhc3QgYmlkaSBwYXJ0IGlzIG5vdCBvbiB0aGUgbGFzdCB2aXN1YWwgbGluZSwNCiAgICAgICAgLy8gc2luY2UgdmlzdWFsIGxpbmVzIGNvbnRhaW4gY29udGVudCBvcmRlci1jb25zZWN1dGl2ZSBjaHVua3MuDQogICAgICAgIC8vIFRodXMsIGluIHJ0bCwgd2UgYXJlIGxvb2tpbmcgZm9yIHRoZSBmaXJzdCAoY29udGVudC1vcmRlcikgY2hhcmFjdGVyDQogICAgICAgIC8vIGluIHRoZSBydGwgY2h1bmsgdGhhdCBpcyBvbiB0aGUgbGFzdCBsaW5lICh0aGF0IGlzLCB0aGUgc2FtZSBsaW5lDQogICAgICAgIC8vIGFzIHRoZSBsYXN0IChjb250ZW50LW9yZGVyKSBjaGFyYWN0ZXIpLg0KICAgICAgICBpZiAocGFydC5sZXZlbCA+IDAgfHwgY20uZG9jLmRpcmVjdGlvbiA9PSAicnRsIikgew0KICAgICAgICAgIHZhciBwcmVwID0gcHJlcGFyZU1lYXN1cmVGb3JMaW5lKGNtLCBsaW5lT2JqKTsNCiAgICAgICAgICBjaCA9IGRpciA8IDAgPyBsaW5lT2JqLnRleHQubGVuZ3RoIC0gMSA6IDA7DQogICAgICAgICAgdmFyIHRhcmdldFRvcCA9IG1lYXN1cmVDaGFyUHJlcGFyZWQoY20sIHByZXAsIGNoKS50b3A7DQogICAgICAgICAgY2ggPSBmaW5kRmlyc3QoZnVuY3Rpb24gKGNoKSB7IHJldHVybiBtZWFzdXJlQ2hhclByZXBhcmVkKGNtLCBwcmVwLCBjaCkudG9wID09IHRhcmdldFRvcDsgfSwgKGRpciA8IDApID09IChwYXJ0LmxldmVsID09IDEpID8gcGFydC5mcm9tIDogcGFydC50byAtIDEsIGNoKTsNCiAgICAgICAgICBpZiAoc3RpY2t5ID09ICJiZWZvcmUiKSB7IGNoID0gbW92ZUNoYXJMb2dpY2FsbHkobGluZU9iaiwgY2gsIDEpOyB9DQogICAgICAgIH0gZWxzZSB7IGNoID0gZGlyIDwgMCA/IHBhcnQudG8gOiBwYXJ0LmZyb207IH0NCiAgICAgICAgcmV0dXJuIG5ldyBQb3MobGluZU5vLCBjaCwgc3RpY2t5KQ0KICAgICAgfQ0KICAgIH0NCiAgICByZXR1cm4gbmV3IFBvcyhsaW5lTm8sIGRpciA8IDAgPyBsaW5lT2JqLnRleHQubGVuZ3RoIDogMCwgZGlyIDwgMCA/ICJiZWZvcmUiIDogImFmdGVyIikNCiAgfQ0KDQogIGZ1bmN0aW9uIG1vdmVWaXN1YWxseShjbSwgbGluZSwgc3RhcnQsIGRpcikgew0KICAgIHZhciBiaWRpID0gZ2V0T3JkZXIobGluZSwgY20uZG9jLmRpcmVjdGlvbik7DQogICAgaWYgKCFiaWRpKSB7IHJldHVybiBtb3ZlTG9naWNhbGx5KGxpbmUsIHN0YXJ0LCBkaXIpIH0NCiAgICBpZiAoc3RhcnQuY2ggPj0gbGluZS50ZXh0Lmxlbmd0aCkgew0KICAgICAgc3RhcnQuY2ggPSBsaW5lLnRleHQubGVuZ3RoOw0KICAgICAgc3RhcnQuc3RpY2t5ID0gImJlZm9yZSI7DQogICAgfSBlbHNlIGlmIChzdGFydC5jaCA8PSAwKSB7DQogICAgICBzdGFydC5jaCA9IDA7DQogICAgICBzdGFydC5zdGlja3kgPSAiYWZ0ZXIiOw0KICAgIH0NCiAgICB2YXIgcGFydFBvcyA9IGdldEJpZGlQYXJ0QXQoYmlkaSwgc3RhcnQuY2gsIHN0YXJ0LnN0aWNreSksIHBhcnQgPSBiaWRpW3BhcnRQb3NdOw0KICAgIGlmIChjbS5kb2MuZGlyZWN0aW9uID09ICJsdHIiICYmIHBhcnQubGV2ZWwgJSAyID09IDAgJiYgKGRpciA+IDAgPyBwYXJ0LnRvID4gc3RhcnQuY2ggOiBwYXJ0LmZyb20gPCBzdGFydC5jaCkpIHsNCiAgICAgIC8vIENhc2UgMTogV2UgbW92ZSB3aXRoaW4gYW4gbHRyIHBhcnQgaW4gYW4gbHRyIGVkaXRvci4gRXZlbiB3aXRoIHdyYXBwZWQgbGluZXMsDQogICAgICAvLyBub3RoaW5nIGludGVyZXN0aW5nIGhhcHBlbnMuDQogICAgICByZXR1cm4gbW92ZUxvZ2ljYWxseShsaW5lLCBzdGFydCwgZGlyKQ0KICAgIH0NCg0KICAgIHZhciBtdiA9IGZ1bmN0aW9uIChwb3MsIGRpcikgeyByZXR1cm4gbW92ZUNoYXJMb2dpY2FsbHkobGluZSwgcG9zIGluc3RhbmNlb2YgUG9zID8gcG9zLmNoIDogcG9zLCBkaXIpOyB9Ow0KICAgIHZhciBwcmVwOw0KICAgIHZhciBnZXRXcmFwcGVkTGluZUV4dGVudCA9IGZ1bmN0aW9uIChjaCkgew0KICAgICAgaWYgKCFjbS5vcHRpb25zLmxpbmVXcmFwcGluZykgeyByZXR1cm4ge2JlZ2luOiAwLCBlbmQ6IGxpbmUudGV4dC5sZW5ndGh9IH0NCiAgICAgIHByZXAgPSBwcmVwIHx8IHByZXBhcmVNZWFzdXJlRm9yTGluZShjbSwgbGluZSk7DQogICAgICByZXR1cm4gd3JhcHBlZExpbmVFeHRlbnRDaGFyKGNtLCBsaW5lLCBwcmVwLCBjaCkNCiAgICB9Ow0KICAgIHZhciB3cmFwcGVkTGluZUV4dGVudCA9IGdldFdyYXBwZWRMaW5lRXh0ZW50KHN0YXJ0LnN0aWNreSA9PSAiYmVmb3JlIiA/IG12KHN0YXJ0LCAtMSkgOiBzdGFydC5jaCk7DQoNCiAgICBpZiAoY20uZG9jLmRpcmVjdGlvbiA9PSAicnRsIiB8fCBwYXJ0LmxldmVsID09IDEpIHsNCiAgICAgIHZhciBtb3ZlSW5TdG9yYWdlT3JkZXIgPSAocGFydC5sZXZlbCA9PSAxKSA9PSAoZGlyIDwgMCk7DQogICAgICB2YXIgY2ggPSBtdihzdGFydCwgbW92ZUluU3RvcmFnZU9yZGVyID8gMSA6IC0xKTsNCiAgICAgIGlmIChjaCAhPSBudWxsICYmICghbW92ZUluU3RvcmFnZU9yZGVyID8gY2ggPj0gcGFydC5mcm9tICYmIGNoID49IHdyYXBwZWRMaW5lRXh0ZW50LmJlZ2luIDogY2ggPD0gcGFydC50byAmJiBjaCA8PSB3cmFwcGVkTGluZUV4dGVudC5lbmQpKSB7DQogICAgICAgIC8vIENhc2UgMjogV2UgbW92ZSB3aXRoaW4gYW4gcnRsIHBhcnQgb3IgaW4gYW4gcnRsIGVkaXRvciBvbiB0aGUgc2FtZSB2aXN1YWwgbGluZQ0KICAgICAgICB2YXIgc3RpY2t5ID0gbW92ZUluU3RvcmFnZU9yZGVyID8gImJlZm9yZSIgOiAiYWZ0ZXIiOw0KICAgICAgICByZXR1cm4gbmV3IFBvcyhzdGFydC5saW5lLCBjaCwgc3RpY2t5KQ0KICAgICAgfQ0KICAgIH0NCg0KICAgIC8vIENhc2UgMzogQ291bGQgbm90IG1vdmUgd2l0aGluIHRoaXMgYmlkaSBwYXJ0IGluIHRoaXMgdmlzdWFsIGxpbmUsIHNvIGxlYXZlDQogICAgLy8gdGhlIGN1cnJlbnQgYmlkaSBwYXJ0DQoNCiAgICB2YXIgc2VhcmNoSW5WaXN1YWxMaW5lID0gZnVuY3Rpb24gKHBhcnRQb3MsIGRpciwgd3JhcHBlZExpbmVFeHRlbnQpIHsNCiAgICAgIHZhciBnZXRSZXMgPSBmdW5jdGlvbiAoY2gsIG1vdmVJblN0b3JhZ2VPcmRlcikgeyByZXR1cm4gbW92ZUluU3RvcmFnZU9yZGVyDQogICAgICAgID8gbmV3IFBvcyhzdGFydC5saW5lLCBtdihjaCwgMSksICJiZWZvcmUiKQ0KICAgICAgICA6IG5ldyBQb3Moc3RhcnQubGluZSwgY2gsICJhZnRlciIpOyB9Ow0KDQogICAgICBmb3IgKDsgcGFydFBvcyA+PSAwICYmIHBhcnRQb3MgPCBiaWRpLmxlbmd0aDsgcGFydFBvcyArPSBkaXIpIHsNCiAgICAgICAgdmFyIHBhcnQgPSBiaWRpW3BhcnRQb3NdOw0KICAgICAgICB2YXIgbW92ZUluU3RvcmFnZU9yZGVyID0gKGRpciA+IDApID09IChwYXJ0LmxldmVsICE9IDEpOw0KICAgICAgICB2YXIgY2ggPSBtb3ZlSW5TdG9yYWdlT3JkZXIgPyB3cmFwcGVkTGluZUV4dGVudC5iZWdpbiA6IG12KHdyYXBwZWRMaW5lRXh0ZW50LmVuZCwgLTEpOw0KICAgICAgICBpZiAocGFydC5mcm9tIDw9IGNoICYmIGNoIDwgcGFydC50bykgeyByZXR1cm4gZ2V0UmVzKGNoLCBtb3ZlSW5TdG9yYWdlT3JkZXIpIH0NCiAgICAgICAgY2ggPSBtb3ZlSW5TdG9yYWdlT3JkZXIgPyBwYXJ0LmZyb20gOiBtdihwYXJ0LnRvLCAtMSk7DQogICAgICAgIGlmICh3cmFwcGVkTGluZUV4dGVudC5iZWdpbiA8PSBjaCAmJiBjaCA8IHdyYXBwZWRMaW5lRXh0ZW50LmVuZCkgeyByZXR1cm4gZ2V0UmVzKGNoLCBtb3ZlSW5TdG9yYWdlT3JkZXIpIH0NCiAgICAgIH0NCiAgICB9Ow0KDQogICAgLy8gQ2FzZSAzYTogTG9vayBmb3Igb3RoZXIgYmlkaSBwYXJ0cyBvbiB0aGUgc2FtZSB2aXN1YWwgbGluZQ0KICAgIHZhciByZXMgPSBzZWFyY2hJblZpc3VhbExpbmUocGFydFBvcyArIGRpciwgZGlyLCB3cmFwcGVkTGluZUV4dGVudCk7DQogICAgaWYgKHJlcykgeyByZXR1cm4gcmVzIH0NCg0KICAgIC8vIENhc2UgM2I6IExvb2sgZm9yIG90aGVyIGJpZGkgcGFydHMgb24gdGhlIG5leHQgdmlzdWFsIGxpbmUNCiAgICB2YXIgbmV4dENoID0gZGlyID4gMCA/IHdyYXBwZWRMaW5lRXh0ZW50LmVuZCA6IG12KHdyYXBwZWRMaW5lRXh0ZW50LmJlZ2luLCAtMSk7DQogICAgaWYgKG5leHRDaCAhPSBudWxsICYmICEoZGlyID4gMCAmJiBuZXh0Q2ggPT0gbGluZS50ZXh0Lmxlbmd0aCkpIHsNCiAgICAgIHJlcyA9IHNlYXJjaEluVmlzdWFsTGluZShkaXIgPiAwID8gMCA6IGJpZGkubGVuZ3RoIC0gMSwgZGlyLCBnZXRXcmFwcGVkTGluZUV4dGVudChuZXh0Q2gpKTsNCiAgICAgIGlmIChyZXMpIHsgcmV0dXJuIHJlcyB9DQogICAgfQ0KDQogICAgLy8gQ2FzZSA0OiBOb3doZXJlIHRvIG1vdmUNCiAgICByZXR1cm4gbnVsbA0KICB9DQoNCiAgLy8gQ29tbWFuZHMgYXJlIHBhcmFtZXRlci1sZXNzIGFjdGlvbnMgdGhhdCBjYW4gYmUgcGVyZm9ybWVkIG9uIGFuDQogIC8vIGVkaXRvciwgbW9zdGx5IHVzZWQgZm9yIGtleWJpbmRpbmdzLg0KICB2YXIgY29tbWFuZHMgPSB7DQogICAgc2VsZWN0QWxsOiBzZWxlY3RBbGwsDQogICAgc2luZ2xlU2VsZWN0aW9uOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnNldFNlbGVjdGlvbihjbS5nZXRDdXJzb3IoImFuY2hvciIpLCBjbS5nZXRDdXJzb3IoImhlYWQiKSwgc2VsX2RvbnRTY3JvbGwpOyB9LA0KICAgIGtpbGxMaW5lOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGRlbGV0ZU5lYXJTZWxlY3Rpb24oY20sIGZ1bmN0aW9uIChyYW5nZSkgew0KICAgICAgaWYgKHJhbmdlLmVtcHR5KCkpIHsNCiAgICAgICAgdmFyIGxlbiA9IGdldExpbmUoY20uZG9jLCByYW5nZS5oZWFkLmxpbmUpLnRleHQubGVuZ3RoOw0KICAgICAgICBpZiAocmFuZ2UuaGVhZC5jaCA9PSBsZW4gJiYgcmFuZ2UuaGVhZC5saW5lIDwgY20ubGFzdExpbmUoKSkNCiAgICAgICAgICB7IHJldHVybiB7ZnJvbTogcmFuZ2UuaGVhZCwgdG86IFBvcyhyYW5nZS5oZWFkLmxpbmUgKyAxLCAwKX0gfQ0KICAgICAgICBlbHNlDQogICAgICAgICAgeyByZXR1cm4ge2Zyb206IHJhbmdlLmhlYWQsIHRvOiBQb3MocmFuZ2UuaGVhZC5saW5lLCBsZW4pfSB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICByZXR1cm4ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJhbmdlLnRvKCl9DQogICAgICB9DQogICAgfSk7IH0sDQogICAgZGVsZXRlTGluZTogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBkZWxldGVOZWFyU2VsZWN0aW9uKGNtLCBmdW5jdGlvbiAocmFuZ2UpIHsgcmV0dXJuICh7DQogICAgICBmcm9tOiBQb3MocmFuZ2UuZnJvbSgpLmxpbmUsIDApLA0KICAgICAgdG86IGNsaXBQb3MoY20uZG9jLCBQb3MocmFuZ2UudG8oKS5saW5lICsgMSwgMCkpDQogICAgfSk7IH0pOyB9LA0KICAgIGRlbExpbmVMZWZ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGRlbGV0ZU5lYXJTZWxlY3Rpb24oY20sIGZ1bmN0aW9uIChyYW5nZSkgeyByZXR1cm4gKHsNCiAgICAgIGZyb206IFBvcyhyYW5nZS5mcm9tKCkubGluZSwgMCksIHRvOiByYW5nZS5mcm9tKCkNCiAgICB9KTsgfSk7IH0sDQogICAgZGVsV3JhcHBlZExpbmVMZWZ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGRlbGV0ZU5lYXJTZWxlY3Rpb24oY20sIGZ1bmN0aW9uIChyYW5nZSkgew0KICAgICAgdmFyIHRvcCA9IGNtLmNoYXJDb29yZHMocmFuZ2UuaGVhZCwgImRpdiIpLnRvcCArIDU7DQogICAgICB2YXIgbGVmdFBvcyA9IGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IDAsIHRvcDogdG9wfSwgImRpdiIpOw0KICAgICAgcmV0dXJuIHtmcm9tOiBsZWZ0UG9zLCB0bzogcmFuZ2UuZnJvbSgpfQ0KICAgIH0pOyB9LA0KICAgIGRlbFdyYXBwZWRMaW5lUmlnaHQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gZGVsZXRlTmVhclNlbGVjdGlvbihjbSwgZnVuY3Rpb24gKHJhbmdlKSB7DQogICAgICB2YXIgdG9wID0gY20uY2hhckNvb3JkcyhyYW5nZS5oZWFkLCAiZGl2IikudG9wICsgNTsNCiAgICAgIHZhciByaWdodFBvcyA9IGNtLmNvb3Jkc0NoYXIoe2xlZnQ6IGNtLmRpc3BsYXkubGluZURpdi5vZmZzZXRXaWR0aCArIDEwMCwgdG9wOiB0b3B9LCAiZGl2Iik7DQogICAgICByZXR1cm4ge2Zyb206IHJhbmdlLmZyb20oKSwgdG86IHJpZ2h0UG9zIH0NCiAgICB9KTsgfSwNCiAgICB1bmRvOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnVuZG8oKTsgfSwNCiAgICByZWRvOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlZG8oKTsgfSwNCiAgICB1bmRvU2VsZWN0aW9uOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnVuZG9TZWxlY3Rpb24oKTsgfSwNCiAgICByZWRvU2VsZWN0aW9uOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlZG9TZWxlY3Rpb24oKTsgfSwNCiAgICBnb0RvY1N0YXJ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbihQb3MoY20uZmlyc3RMaW5lKCksIDApKTsgfSwNCiAgICBnb0RvY0VuZDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5leHRlbmRTZWxlY3Rpb24oUG9zKGNtLmxhc3RMaW5lKCkpKTsgfSwNCiAgICBnb0xpbmVTdGFydDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24gKHJhbmdlKSB7IHJldHVybiBsaW5lU3RhcnQoY20sIHJhbmdlLmhlYWQubGluZSk7IH0sDQogICAgICB7b3JpZ2luOiAiK21vdmUiLCBiaWFzOiAxfQ0KICAgICk7IH0sDQogICAgZ29MaW5lU3RhcnRTbWFydDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5leHRlbmRTZWxlY3Rpb25zQnkoZnVuY3Rpb24gKHJhbmdlKSB7IHJldHVybiBsaW5lU3RhcnRTbWFydChjbSwgcmFuZ2UuaGVhZCk7IH0sDQogICAgICB7b3JpZ2luOiAiK21vdmUiLCBiaWFzOiAxfQ0KICAgICk7IH0sDQogICAgZ29MaW5lRW5kOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UpIHsgcmV0dXJuIGxpbmVFbmQoY20sIHJhbmdlLmhlYWQubGluZSk7IH0sDQogICAgICB7b3JpZ2luOiAiK21vdmUiLCBiaWFzOiAtMX0NCiAgICApOyB9LA0KICAgIGdvTGluZVJpZ2h0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UpIHsNCiAgICAgIHZhciB0b3AgPSBjbS5jdXJzb3JDb29yZHMocmFuZ2UuaGVhZCwgImRpdiIpLnRvcCArIDU7DQogICAgICByZXR1cm4gY20uY29vcmRzQ2hhcih7bGVmdDogY20uZGlzcGxheS5saW5lRGl2Lm9mZnNldFdpZHRoICsgMTAwLCB0b3A6IHRvcH0sICJkaXYiKQ0KICAgIH0sIHNlbF9tb3ZlKTsgfSwNCiAgICBnb0xpbmVMZWZ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UpIHsNCiAgICAgIHZhciB0b3AgPSBjbS5jdXJzb3JDb29yZHMocmFuZ2UuaGVhZCwgImRpdiIpLnRvcCArIDU7DQogICAgICByZXR1cm4gY20uY29vcmRzQ2hhcih7bGVmdDogMCwgdG9wOiB0b3B9LCAiZGl2IikNCiAgICB9LCBzZWxfbW92ZSk7IH0sDQogICAgZ29MaW5lTGVmdFNtYXJ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UpIHsNCiAgICAgIHZhciB0b3AgPSBjbS5jdXJzb3JDb29yZHMocmFuZ2UuaGVhZCwgImRpdiIpLnRvcCArIDU7DQogICAgICB2YXIgcG9zID0gY20uY29vcmRzQ2hhcih7bGVmdDogMCwgdG9wOiB0b3B9LCAiZGl2Iik7DQogICAgICBpZiAocG9zLmNoIDwgY20uZ2V0TGluZShwb3MubGluZSkuc2VhcmNoKC9cUy8pKSB7IHJldHVybiBsaW5lU3RhcnRTbWFydChjbSwgcmFuZ2UuaGVhZCkgfQ0KICAgICAgcmV0dXJuIHBvcw0KICAgIH0sIHNlbF9tb3ZlKTsgfSwNCiAgICBnb0xpbmVVcDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlVigtMSwgImxpbmUiKTsgfSwNCiAgICBnb0xpbmVEb3duOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVWKDEsICJsaW5lIik7IH0sDQogICAgZ29QYWdlVXA6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZVYoLTEsICJwYWdlIik7IH0sDQogICAgZ29QYWdlRG93bjogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlVigxLCAicGFnZSIpOyB9LA0KICAgIGdvQ2hhckxlZnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZUgoLTEsICJjaGFyIik7IH0sDQogICAgZ29DaGFyUmlnaHQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZUgoMSwgImNoYXIiKTsgfSwNCiAgICBnb0NvbHVtbkxlZnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZUgoLTEsICJjb2x1bW4iKTsgfSwNCiAgICBnb0NvbHVtblJpZ2h0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVIKDEsICJjb2x1bW4iKTsgfSwNCiAgICBnb1dvcmRMZWZ0OiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLm1vdmVIKC0xLCAid29yZCIpOyB9LA0KICAgIGdvR3JvdXBSaWdodDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlSCgxLCAiZ3JvdXAiKTsgfSwNCiAgICBnb0dyb3VwTGVmdDogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5tb3ZlSCgtMSwgImdyb3VwIik7IH0sDQogICAgZ29Xb3JkUmlnaHQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ubW92ZUgoMSwgIndvcmQiKTsgfSwNCiAgICBkZWxDaGFyQmVmb3JlOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmRlbGV0ZUgoLTEsICJjaGFyIik7IH0sDQogICAgZGVsQ2hhckFmdGVyOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmRlbGV0ZUgoMSwgImNoYXIiKTsgfSwNCiAgICBkZWxXb3JkQmVmb3JlOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmRlbGV0ZUgoLTEsICJ3b3JkIik7IH0sDQogICAgZGVsV29yZEFmdGVyOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmRlbGV0ZUgoMSwgIndvcmQiKTsgfSwNCiAgICBkZWxHcm91cEJlZm9yZTogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5kZWxldGVIKC0xLCAiZ3JvdXAiKTsgfSwNCiAgICBkZWxHcm91cEFmdGVyOiBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLmRlbGV0ZUgoMSwgImdyb3VwIik7IH0sDQogICAgaW5kZW50QXV0bzogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5pbmRlbnRTZWxlY3Rpb24oInNtYXJ0Iik7IH0sDQogICAgaW5kZW50TW9yZTogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5pbmRlbnRTZWxlY3Rpb24oImFkZCIpOyB9LA0KICAgIGluZGVudExlc3M6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20uaW5kZW50U2VsZWN0aW9uKCJzdWJ0cmFjdCIpOyB9LA0KICAgIGluc2VydFRhYjogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5yZXBsYWNlU2VsZWN0aW9uKCJcdCIpOyB9LA0KICAgIGluc2VydFNvZnRUYWI6IGZ1bmN0aW9uIChjbSkgew0KICAgICAgdmFyIHNwYWNlcyA9IFtdLCByYW5nZXMgPSBjbS5saXN0U2VsZWN0aW9ucygpLCB0YWJTaXplID0gY20ub3B0aW9ucy50YWJTaXplOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgdmFyIHBvcyA9IHJhbmdlc1tpXS5mcm9tKCk7DQogICAgICAgIHZhciBjb2wgPSBjb3VudENvbHVtbihjbS5nZXRMaW5lKHBvcy5saW5lKSwgcG9zLmNoLCB0YWJTaXplKTsNCiAgICAgICAgc3BhY2VzLnB1c2goc3BhY2VTdHIodGFiU2l6ZSAtIGNvbCAlIHRhYlNpemUpKTsNCiAgICAgIH0NCiAgICAgIGNtLnJlcGxhY2VTZWxlY3Rpb25zKHNwYWNlcyk7DQogICAgfSwNCiAgICBkZWZhdWx0VGFiOiBmdW5jdGlvbiAoY20pIHsNCiAgICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7IGNtLmluZGVudFNlbGVjdGlvbigiYWRkIik7IH0NCiAgICAgIGVsc2UgeyBjbS5leGVjQ29tbWFuZCgiaW5zZXJ0VGFiIik7IH0NCiAgICB9LA0KICAgIC8vIFN3YXAgdGhlIHR3byBjaGFycyBsZWZ0IGFuZCByaWdodCBvZiBlYWNoIHNlbGVjdGlvbidzIGhlYWQuDQogICAgLy8gTW92ZSBjdXJzb3IgYmVoaW5kIHRoZSB0d28gc3dhcHBlZCBjaGFyYWN0ZXJzIGFmdGVyd2FyZHMuDQogICAgLy8NCiAgICAvLyBEb2Vzbid0IGNvbnNpZGVyIGxpbmUgZmVlZHMgYSBjaGFyYWN0ZXIuDQogICAgLy8gRG9lc24ndCBzY2FuIG1vcmUgdGhhbiBvbmUgbGluZSBhYm92ZSB0byBmaW5kIGEgY2hhcmFjdGVyLg0KICAgIC8vIERvZXNuJ3QgZG8gYW55dGhpbmcgb24gYW4gZW1wdHkgbGluZS4NCiAgICAvLyBEb2Vzbid0IGRvIGFueXRoaW5nIHdpdGggbm9uLWVtcHR5IHNlbGVjdGlvbnMuDQogICAgdHJhbnNwb3NlQ2hhcnM6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHJhbmdlcyA9IGNtLmxpc3RTZWxlY3Rpb25zKCksIG5ld1NlbCA9IFtdOw0KICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgaWYgKCFyYW5nZXNbaV0uZW1wdHkoKSkgeyBjb250aW51ZSB9DQogICAgICAgIHZhciBjdXIgPSByYW5nZXNbaV0uaGVhZCwgbGluZSA9IGdldExpbmUoY20uZG9jLCBjdXIubGluZSkudGV4dDsNCiAgICAgICAgaWYgKGxpbmUpIHsNCiAgICAgICAgICBpZiAoY3VyLmNoID09IGxpbmUubGVuZ3RoKSB7IGN1ciA9IG5ldyBQb3MoY3VyLmxpbmUsIGN1ci5jaCAtIDEpOyB9DQogICAgICAgICAgaWYgKGN1ci5jaCA+IDApIHsNCiAgICAgICAgICAgIGN1ciA9IG5ldyBQb3MoY3VyLmxpbmUsIGN1ci5jaCArIDEpOw0KICAgICAgICAgICAgY20ucmVwbGFjZVJhbmdlKGxpbmUuY2hhckF0KGN1ci5jaCAtIDEpICsgbGluZS5jaGFyQXQoY3VyLmNoIC0gMiksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgUG9zKGN1ci5saW5lLCBjdXIuY2ggLSAyKSwgY3VyLCAiK3RyYW5zcG9zZSIpOw0KICAgICAgICAgIH0gZWxzZSBpZiAoY3VyLmxpbmUgPiBjbS5kb2MuZmlyc3QpIHsNCiAgICAgICAgICAgIHZhciBwcmV2ID0gZ2V0TGluZShjbS5kb2MsIGN1ci5saW5lIC0gMSkudGV4dDsNCiAgICAgICAgICAgIGlmIChwcmV2KSB7DQogICAgICAgICAgICAgIGN1ciA9IG5ldyBQb3MoY3VyLmxpbmUsIDEpOw0KICAgICAgICAgICAgICBjbS5yZXBsYWNlUmFuZ2UobGluZS5jaGFyQXQoMCkgKyBjbS5kb2MubGluZVNlcGFyYXRvcigpICsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByZXYuY2hhckF0KHByZXYubGVuZ3RoIC0gMSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBQb3MoY3VyLmxpbmUgLSAxLCBwcmV2Lmxlbmd0aCAtIDEpLCBjdXIsICIrdHJhbnNwb3NlIik7DQogICAgICAgICAgICB9DQogICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIG5ld1NlbC5wdXNoKG5ldyBSYW5nZShjdXIsIGN1cikpOw0KICAgICAgfQ0KICAgICAgY20uc2V0U2VsZWN0aW9ucyhuZXdTZWwpOw0KICAgIH0pOyB9LA0KICAgIG5ld2xpbmVBbmRJbmRlbnQ6IGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHNlbHMgPSBjbS5saXN0U2VsZWN0aW9ucygpOw0KICAgICAgZm9yICh2YXIgaSA9IHNlbHMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pDQogICAgICAgIHsgY20ucmVwbGFjZVJhbmdlKGNtLmRvYy5saW5lU2VwYXJhdG9yKCksIHNlbHNbaV0uYW5jaG9yLCBzZWxzW2ldLmhlYWQsICIraW5wdXQiKTsgfQ0KICAgICAgc2VscyA9IGNtLmxpc3RTZWxlY3Rpb25zKCk7DQogICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBzZWxzLmxlbmd0aDsgaSQxKyspDQogICAgICAgIHsgY20uaW5kZW50TGluZShzZWxzW2kkMV0uZnJvbSgpLmxpbmUsIG51bGwsIHRydWUpOyB9DQogICAgICBlbnN1cmVDdXJzb3JWaXNpYmxlKGNtKTsNCiAgICB9KTsgfSwNCiAgICBvcGVuTGluZTogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS5yZXBsYWNlU2VsZWN0aW9uKCJcbiIsICJzdGFydCIpOyB9LA0KICAgIHRvZ2dsZU92ZXJ3cml0ZTogZnVuY3Rpb24gKGNtKSB7IHJldHVybiBjbS50b2dnbGVPdmVyd3JpdGUoKTsgfQ0KICB9Ow0KDQoNCiAgZnVuY3Rpb24gbGluZVN0YXJ0KGNtLCBsaW5lTikgew0KICAgIHZhciBsaW5lID0gZ2V0TGluZShjbS5kb2MsIGxpbmVOKTsNCiAgICB2YXIgdmlzdWFsID0gdmlzdWFsTGluZShsaW5lKTsNCiAgICBpZiAodmlzdWFsICE9IGxpbmUpIHsgbGluZU4gPSBsaW5lTm8odmlzdWFsKTsgfQ0KICAgIHJldHVybiBlbmRPZkxpbmUodHJ1ZSwgY20sIHZpc3VhbCwgbGluZU4sIDEpDQogIH0NCiAgZnVuY3Rpb24gbGluZUVuZChjbSwgbGluZU4pIHsNCiAgICB2YXIgbGluZSA9IGdldExpbmUoY20uZG9jLCBsaW5lTik7DQogICAgdmFyIHZpc3VhbCA9IHZpc3VhbExpbmVFbmQobGluZSk7DQogICAgaWYgKHZpc3VhbCAhPSBsaW5lKSB7IGxpbmVOID0gbGluZU5vKHZpc3VhbCk7IH0NCiAgICByZXR1cm4gZW5kT2ZMaW5lKHRydWUsIGNtLCBsaW5lLCBsaW5lTiwgLTEpDQogIH0NCiAgZnVuY3Rpb24gbGluZVN0YXJ0U21hcnQoY20sIHBvcykgew0KICAgIHZhciBzdGFydCA9IGxpbmVTdGFydChjbSwgcG9zLmxpbmUpOw0KICAgIHZhciBsaW5lID0gZ2V0TGluZShjbS5kb2MsIHN0YXJ0LmxpbmUpOw0KICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGxpbmUsIGNtLmRvYy5kaXJlY3Rpb24pOw0KICAgIGlmICghb3JkZXIgfHwgb3JkZXJbMF0ubGV2ZWwgPT0gMCkgew0KICAgICAgdmFyIGZpcnN0Tm9uV1MgPSBNYXRoLm1heChzdGFydC5jaCwgbGluZS50ZXh0LnNlYXJjaCgvXFMvKSk7DQogICAgICB2YXIgaW5XUyA9IHBvcy5saW5lID09IHN0YXJ0LmxpbmUgJiYgcG9zLmNoIDw9IGZpcnN0Tm9uV1MgJiYgcG9zLmNoOw0KICAgICAgcmV0dXJuIFBvcyhzdGFydC5saW5lLCBpbldTID8gMCA6IGZpcnN0Tm9uV1MsIHN0YXJ0LnN0aWNreSkNCiAgICB9DQogICAgcmV0dXJuIHN0YXJ0DQogIH0NCg0KICAvLyBSdW4gYSBoYW5kbGVyIHRoYXQgd2FzIGJvdW5kIHRvIGEga2V5Lg0KICBmdW5jdGlvbiBkb0hhbmRsZUJpbmRpbmcoY20sIGJvdW5kLCBkcm9wU2hpZnQpIHsNCiAgICBpZiAodHlwZW9mIGJvdW5kID09ICJzdHJpbmciKSB7DQogICAgICBib3VuZCA9IGNvbW1hbmRzW2JvdW5kXTsNCiAgICAgIGlmICghYm91bmQpIHsgcmV0dXJuIGZhbHNlIH0NCiAgICB9DQogICAgLy8gRW5zdXJlIHByZXZpb3VzIGlucHV0IGhhcyBiZWVuIHJlYWQsIHNvIHRoYXQgdGhlIGhhbmRsZXIgc2VlcyBhDQogICAgLy8gY29uc2lzdGVudCB2aWV3IG9mIHRoZSBkb2N1bWVudA0KICAgIGNtLmRpc3BsYXkuaW5wdXQuZW5zdXJlUG9sbGVkKCk7DQogICAgdmFyIHByZXZTaGlmdCA9IGNtLmRpc3BsYXkuc2hpZnQsIGRvbmUgPSBmYWxzZTsNCiAgICB0cnkgew0KICAgICAgaWYgKGNtLmlzUmVhZE9ubHkoKSkgeyBjbS5zdGF0ZS5zdXBwcmVzc0VkaXRzID0gdHJ1ZTsgfQ0KICAgICAgaWYgKGRyb3BTaGlmdCkgeyBjbS5kaXNwbGF5LnNoaWZ0ID0gZmFsc2U7IH0NCiAgICAgIGRvbmUgPSBib3VuZChjbSkgIT0gUGFzczsNCiAgICB9IGZpbmFsbHkgew0KICAgICAgY20uZGlzcGxheS5zaGlmdCA9IHByZXZTaGlmdDsNCiAgICAgIGNtLnN0YXRlLnN1cHByZXNzRWRpdHMgPSBmYWxzZTsNCiAgICB9DQogICAgcmV0dXJuIGRvbmUNCiAgfQ0KDQogIGZ1bmN0aW9uIGxvb2t1cEtleUZvckVkaXRvcihjbSwgbmFtZSwgaGFuZGxlKSB7DQogICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjbS5zdGF0ZS5rZXlNYXBzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgcmVzdWx0ID0gbG9va3VwS2V5KG5hbWUsIGNtLnN0YXRlLmtleU1hcHNbaV0sIGhhbmRsZSwgY20pOw0KICAgICAgaWYgKHJlc3VsdCkgeyByZXR1cm4gcmVzdWx0IH0NCiAgICB9DQogICAgcmV0dXJuIChjbS5vcHRpb25zLmV4dHJhS2V5cyAmJiBsb29rdXBLZXkobmFtZSwgY20ub3B0aW9ucy5leHRyYUtleXMsIGhhbmRsZSwgY20pKQ0KICAgICAgfHwgbG9va3VwS2V5KG5hbWUsIGNtLm9wdGlvbnMua2V5TWFwLCBoYW5kbGUsIGNtKQ0KICB9DQoNCiAgLy8gTm90ZSB0aGF0LCBkZXNwaXRlIHRoZSBuYW1lLCB0aGlzIGZ1bmN0aW9uIGlzIGFsc28gdXNlZCB0byBjaGVjaw0KICAvLyBmb3IgYm91bmQgbW91c2UgY2xpY2tzLg0KDQogIHZhciBzdG9wU2VxID0gbmV3IERlbGF5ZWQ7DQoNCiAgZnVuY3Rpb24gZGlzcGF0Y2hLZXkoY20sIG5hbWUsIGUsIGhhbmRsZSkgew0KICAgIHZhciBzZXEgPSBjbS5zdGF0ZS5rZXlTZXE7DQogICAgaWYgKHNlcSkgew0KICAgICAgaWYgKGlzTW9kaWZpZXJLZXkobmFtZSkpIHsgcmV0dXJuICJoYW5kbGVkIiB9DQogICAgICBpZiAoL1wnJC8udGVzdChuYW1lKSkNCiAgICAgICAgeyBjbS5zdGF0ZS5rZXlTZXEgPSBudWxsOyB9DQogICAgICBlbHNlDQogICAgICAgIHsgc3RvcFNlcS5zZXQoNTAsIGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICBpZiAoY20uc3RhdGUua2V5U2VxID09IHNlcSkgew0KICAgICAgICAgICAgY20uc3RhdGUua2V5U2VxID0gbnVsbDsNCiAgICAgICAgICAgIGNtLmRpc3BsYXkuaW5wdXQucmVzZXQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH0pOyB9DQogICAgICBpZiAoZGlzcGF0Y2hLZXlJbm5lcihjbSwgc2VxICsgIiAiICsgbmFtZSwgZSwgaGFuZGxlKSkgeyByZXR1cm4gdHJ1ZSB9DQogICAgfQ0KICAgIHJldHVybiBkaXNwYXRjaEtleUlubmVyKGNtLCBuYW1lLCBlLCBoYW5kbGUpDQogIH0NCg0KICBmdW5jdGlvbiBkaXNwYXRjaEtleUlubmVyKGNtLCBuYW1lLCBlLCBoYW5kbGUpIHsNCiAgICB2YXIgcmVzdWx0ID0gbG9va3VwS2V5Rm9yRWRpdG9yKGNtLCBuYW1lLCBoYW5kbGUpOw0KDQogICAgaWYgKHJlc3VsdCA9PSAibXVsdGkiKQ0KICAgICAgeyBjbS5zdGF0ZS5rZXlTZXEgPSBuYW1lOyB9DQogICAgaWYgKHJlc3VsdCA9PSAiaGFuZGxlZCIpDQogICAgICB7IHNpZ25hbExhdGVyKGNtLCAia2V5SGFuZGxlZCIsIGNtLCBuYW1lLCBlKTsgfQ0KDQogICAgaWYgKHJlc3VsdCA9PSAiaGFuZGxlZCIgfHwgcmVzdWx0ID09ICJtdWx0aSIpIHsNCiAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7DQogICAgICByZXN0YXJ0QmxpbmsoY20pOw0KICAgIH0NCg0KICAgIHJldHVybiAhIXJlc3VsdA0KICB9DQoNCiAgLy8gSGFuZGxlIGEga2V5IGZyb20gdGhlIGtleWRvd24gZXZlbnQuDQogIGZ1bmN0aW9uIGhhbmRsZUtleUJpbmRpbmcoY20sIGUpIHsNCiAgICB2YXIgbmFtZSA9IGtleU5hbWUoZSwgdHJ1ZSk7DQogICAgaWYgKCFuYW1lKSB7IHJldHVybiBmYWxzZSB9DQoNCiAgICBpZiAoZS5zaGlmdEtleSAmJiAhY20uc3RhdGUua2V5U2VxKSB7DQogICAgICAvLyBGaXJzdCB0cnkgdG8gcmVzb2x2ZSBmdWxsIG5hbWUgKGluY2x1ZGluZyAnU2hpZnQtJykuIEZhaWxpbmcNCiAgICAgIC8vIHRoYXQsIHNlZSBpZiB0aGVyZSBpcyBhIGN1cnNvci1tb3Rpb24gY29tbWFuZCAoc3RhcnRpbmcgd2l0aA0KICAgICAgLy8gJ2dvJykgYm91bmQgdG8gdGhlIGtleW5hbWUgd2l0aG91dCAnU2hpZnQtJy4NCiAgICAgIHJldHVybiBkaXNwYXRjaEtleShjbSwgIlNoaWZ0LSIgKyBuYW1lLCBlLCBmdW5jdGlvbiAoYikgeyByZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiLCB0cnVlKTsgfSkNCiAgICAgICAgICB8fCBkaXNwYXRjaEtleShjbSwgbmFtZSwgZSwgZnVuY3Rpb24gKGIpIHsNCiAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYiA9PSAic3RyaW5nIiA/IC9eZ29bQS1aXS8udGVzdChiKSA6IGIubW90aW9uKQ0KICAgICAgICAgICAgICAgICB7IHJldHVybiBkb0hhbmRsZUJpbmRpbmcoY20sIGIpIH0NCiAgICAgICAgICAgICB9KQ0KICAgIH0gZWxzZSB7DQogICAgICByZXR1cm4gZGlzcGF0Y2hLZXkoY20sIG5hbWUsIGUsIGZ1bmN0aW9uIChiKSB7IHJldHVybiBkb0hhbmRsZUJpbmRpbmcoY20sIGIpOyB9KQ0KICAgIH0NCiAgfQ0KDQogIC8vIEhhbmRsZSBhIGtleSBmcm9tIHRoZSBrZXlwcmVzcyBldmVudA0KICBmdW5jdGlvbiBoYW5kbGVDaGFyQmluZGluZyhjbSwgZSwgY2gpIHsNCiAgICByZXR1cm4gZGlzcGF0Y2hLZXkoY20sICInIiArIGNoICsgIiciLCBlLCBmdW5jdGlvbiAoYikgeyByZXR1cm4gZG9IYW5kbGVCaW5kaW5nKGNtLCBiLCB0cnVlKTsgfSkNCiAgfQ0KDQogIHZhciBsYXN0U3RvcHBlZEtleSA9IG51bGw7DQogIGZ1bmN0aW9uIG9uS2V5RG93bihlKSB7DQogICAgdmFyIGNtID0gdGhpczsNCiAgICBjbS5jdXJPcC5mb2N1cyA9IGFjdGl2ZUVsdCgpOw0KICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkpIHsgcmV0dXJuIH0NCiAgICAvLyBJRSBkb2VzIHN0cmFuZ2UgdGhpbmdzIHdpdGggZXNjYXBlLg0KICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uIDwgMTEgJiYgZS5rZXlDb2RlID09IDI3KSB7IGUucmV0dXJuVmFsdWUgPSBmYWxzZTsgfQ0KICAgIHZhciBjb2RlID0gZS5rZXlDb2RlOw0KICAgIGNtLmRpc3BsYXkuc2hpZnQgPSBjb2RlID09IDE2IHx8IGUuc2hpZnRLZXk7DQogICAgdmFyIGhhbmRsZWQgPSBoYW5kbGVLZXlCaW5kaW5nKGNtLCBlKTsNCiAgICBpZiAocHJlc3RvKSB7DQogICAgICBsYXN0U3RvcHBlZEtleSA9IGhhbmRsZWQgPyBjb2RlIDogbnVsbDsNCiAgICAgIC8vIE9wZXJhIGhhcyBubyBjdXQgZXZlbnQuLi4gd2UgdHJ5IHRvIGF0IGxlYXN0IGNhdGNoIHRoZSBrZXkgY29tYm8NCiAgICAgIGlmICghaGFuZGxlZCAmJiBjb2RlID09IDg4ICYmICFoYXNDb3B5RXZlbnQgJiYgKG1hYyA/IGUubWV0YUtleSA6IGUuY3RybEtleSkpDQogICAgICAgIHsgY20ucmVwbGFjZVNlbGVjdGlvbigiIiwgbnVsbCwgImN1dCIpOyB9DQogICAgfQ0KICAgIGlmIChnZWNrbyAmJiAhbWFjICYmICFoYW5kbGVkICYmIGNvZGUgPT0gNDYgJiYgZS5zaGlmdEtleSAmJiAhZS5jdHJsS2V5ICYmIGRvY3VtZW50LmV4ZWNDb21tYW5kKQ0KICAgICAgeyBkb2N1bWVudC5leGVjQ29tbWFuZCgiY3V0Iik7IH0NCg0KICAgIC8vIFR1cm4gbW91c2UgaW50byBjcm9zc2hhaXIgd2hlbiBBbHQgaXMgaGVsZCBvbiBNYWMuDQogICAgaWYgKGNvZGUgPT0gMTggJiYgIS9cYkNvZGVNaXJyb3ItY3Jvc3NoYWlyXGIvLnRlc3QoY20uZGlzcGxheS5saW5lRGl2LmNsYXNzTmFtZSkpDQogICAgICB7IHNob3dDcm9zc0hhaXIoY20pOyB9DQogIH0NCg0KICBmdW5jdGlvbiBzaG93Q3Jvc3NIYWlyKGNtKSB7DQogICAgdmFyIGxpbmVEaXYgPSBjbS5kaXNwbGF5LmxpbmVEaXY7DQogICAgYWRkQ2xhc3MobGluZURpdiwgIkNvZGVNaXJyb3ItY3Jvc3NoYWlyIik7DQoNCiAgICBmdW5jdGlvbiB1cChlKSB7DQogICAgICBpZiAoZS5rZXlDb2RlID09IDE4IHx8ICFlLmFsdEtleSkgew0KICAgICAgICBybUNsYXNzKGxpbmVEaXYsICJDb2RlTWlycm9yLWNyb3NzaGFpciIpOw0KICAgICAgICBvZmYoZG9jdW1lbnQsICJrZXl1cCIsIHVwKTsNCiAgICAgICAgb2ZmKGRvY3VtZW50LCAibW91c2VvdmVyIiwgdXApOw0KICAgICAgfQ0KICAgIH0NCiAgICBvbihkb2N1bWVudCwgImtleXVwIiwgdXApOw0KICAgIG9uKGRvY3VtZW50LCAibW91c2VvdmVyIiwgdXApOw0KICB9DQoNCiAgZnVuY3Rpb24gb25LZXlVcChlKSB7DQogICAgaWYgKGUua2V5Q29kZSA9PSAxNikgeyB0aGlzLmRvYy5zZWwuc2hpZnQgPSBmYWxzZTsgfQ0KICAgIHNpZ25hbERPTUV2ZW50KHRoaXMsIGUpOw0KICB9DQoNCiAgZnVuY3Rpb24gb25LZXlQcmVzcyhlKSB7DQogICAgdmFyIGNtID0gdGhpczsNCiAgICBpZiAoZXZlbnRJbldpZGdldChjbS5kaXNwbGF5LCBlKSB8fCBzaWduYWxET01FdmVudChjbSwgZSkgfHwgZS5jdHJsS2V5ICYmICFlLmFsdEtleSB8fCBtYWMgJiYgZS5tZXRhS2V5KSB7IHJldHVybiB9DQogICAgdmFyIGtleUNvZGUgPSBlLmtleUNvZGUsIGNoYXJDb2RlID0gZS5jaGFyQ29kZTsNCiAgICBpZiAocHJlc3RvICYmIGtleUNvZGUgPT0gbGFzdFN0b3BwZWRLZXkpIHtsYXN0U3RvcHBlZEtleSA9IG51bGw7IGVfcHJldmVudERlZmF1bHQoZSk7IHJldHVybn0NCiAgICBpZiAoKHByZXN0byAmJiAoIWUud2hpY2ggfHwgZS53aGljaCA8IDEwKSkgJiYgaGFuZGxlS2V5QmluZGluZyhjbSwgZSkpIHsgcmV0dXJuIH0NCiAgICB2YXIgY2ggPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGNoYXJDb2RlID09IG51bGwgPyBrZXlDb2RlIDogY2hhckNvZGUpOw0KICAgIC8vIFNvbWUgYnJvd3NlcnMgZmlyZSBrZXlwcmVzcyBldmVudHMgZm9yIGJhY2tzcGFjZQ0KICAgIGlmIChjaCA9PSAiXHgwOCIpIHsgcmV0dXJuIH0NCiAgICBpZiAoaGFuZGxlQ2hhckJpbmRpbmcoY20sIGUsIGNoKSkgeyByZXR1cm4gfQ0KICAgIGNtLmRpc3BsYXkuaW5wdXQub25LZXlQcmVzcyhlKTsNCiAgfQ0KDQogIHZhciBET1VCTEVDTElDS19ERUxBWSA9IDQwMDsNCg0KICB2YXIgUGFzdENsaWNrID0gZnVuY3Rpb24odGltZSwgcG9zLCBidXR0b24pIHsNCiAgICB0aGlzLnRpbWUgPSB0aW1lOw0KICAgIHRoaXMucG9zID0gcG9zOw0KICAgIHRoaXMuYnV0dG9uID0gYnV0dG9uOw0KICB9Ow0KDQogIFBhc3RDbGljay5wcm90b3R5cGUuY29tcGFyZSA9IGZ1bmN0aW9uICh0aW1lLCBwb3MsIGJ1dHRvbikgew0KICAgIHJldHVybiB0aGlzLnRpbWUgKyBET1VCTEVDTElDS19ERUxBWSA+IHRpbWUgJiYNCiAgICAgIGNtcChwb3MsIHRoaXMucG9zKSA9PSAwICYmIGJ1dHRvbiA9PSB0aGlzLmJ1dHRvbg0KICB9Ow0KDQogIHZhciBsYXN0Q2xpY2ssIGxhc3REb3VibGVDbGljazsNCiAgZnVuY3Rpb24gY2xpY2tSZXBlYXQocG9zLCBidXR0b24pIHsNCiAgICB2YXIgbm93ID0gK25ldyBEYXRlOw0KICAgIGlmIChsYXN0RG91YmxlQ2xpY2sgJiYgbGFzdERvdWJsZUNsaWNrLmNvbXBhcmUobm93LCBwb3MsIGJ1dHRvbikpIHsNCiAgICAgIGxhc3RDbGljayA9IGxhc3REb3VibGVDbGljayA9IG51bGw7DQogICAgICByZXR1cm4gInRyaXBsZSINCiAgICB9IGVsc2UgaWYgKGxhc3RDbGljayAmJiBsYXN0Q2xpY2suY29tcGFyZShub3csIHBvcywgYnV0dG9uKSkgew0KICAgICAgbGFzdERvdWJsZUNsaWNrID0gbmV3IFBhc3RDbGljayhub3csIHBvcywgYnV0dG9uKTsNCiAgICAgIGxhc3RDbGljayA9IG51bGw7DQogICAgICByZXR1cm4gImRvdWJsZSINCiAgICB9IGVsc2Ugew0KICAgICAgbGFzdENsaWNrID0gbmV3IFBhc3RDbGljayhub3csIHBvcywgYnV0dG9uKTsNCiAgICAgIGxhc3REb3VibGVDbGljayA9IG51bGw7DQogICAgICByZXR1cm4gInNpbmdsZSINCiAgICB9DQogIH0NCg0KICAvLyBBIG1vdXNlIGRvd24gY2FuIGJlIGEgc2luZ2xlIGNsaWNrLCBkb3VibGUgY2xpY2ssIHRyaXBsZSBjbGljaywNCiAgLy8gc3RhcnQgb2Ygc2VsZWN0aW9uIGRyYWcsIHN0YXJ0IG9mIHRleHQgZHJhZywgbmV3IGN1cnNvcg0KICAvLyAoY3RybC1jbGljayksIHJlY3RhbmdsZSBkcmFnIChhbHQtZHJhZyksIG9yIHh3aW4NCiAgLy8gbWlkZGxlLWNsaWNrLXBhc3RlLiBPciBpdCBtaWdodCBiZSBhIGNsaWNrIG9uIHNvbWV0aGluZyB3ZSBzaG91bGQNCiAgLy8gbm90IGludGVyZmVyZSB3aXRoLCBzdWNoIGFzIGEgc2Nyb2xsYmFyIG9yIHdpZGdldC4NCiAgZnVuY3Rpb24gb25Nb3VzZURvd24oZSkgew0KICAgIHZhciBjbSA9IHRoaXMsIGRpc3BsYXkgPSBjbS5kaXNwbGF5Ow0KICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkgfHwgZGlzcGxheS5hY3RpdmVUb3VjaCAmJiBkaXNwbGF5LmlucHV0LnN1cHBvcnRzVG91Y2goKSkgeyByZXR1cm4gfQ0KICAgIGRpc3BsYXkuaW5wdXQuZW5zdXJlUG9sbGVkKCk7DQogICAgZGlzcGxheS5zaGlmdCA9IGUuc2hpZnRLZXk7DQoNCiAgICBpZiAoZXZlbnRJbldpZGdldChkaXNwbGF5LCBlKSkgew0KICAgICAgaWYgKCF3ZWJraXQpIHsNCiAgICAgICAgLy8gQnJpZWZseSB0dXJuIG9mZiBkcmFnZ2FiaWxpdHksIHRvIGFsbG93IHdpZGdldHMgdG8gZG8NCiAgICAgICAgLy8gbm9ybWFsIGRyYWdnaW5nIHRoaW5ncy4NCiAgICAgICAgZGlzcGxheS5zY3JvbGxlci5kcmFnZ2FibGUgPSBmYWxzZTsNCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IHJldHVybiBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IHRydWU7IH0sIDEwMCk7DQogICAgICB9DQogICAgICByZXR1cm4NCiAgICB9DQogICAgaWYgKGNsaWNrSW5HdXR0ZXIoY20sIGUpKSB7IHJldHVybiB9DQogICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSksIGJ1dHRvbiA9IGVfYnV0dG9uKGUpLCByZXBlYXQgPSBwb3MgPyBjbGlja1JlcGVhdChwb3MsIGJ1dHRvbikgOiAic2luZ2xlIjsNCiAgICB3aW5kb3cuZm9jdXMoKTsNCg0KICAgIC8vICMzMjYxOiBtYWtlIHN1cmUsIHRoYXQgd2UncmUgbm90IHN0YXJ0aW5nIGEgc2Vjb25kIHNlbGVjdGlvbg0KICAgIGlmIChidXR0b24gPT0gMSAmJiBjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0KQ0KICAgICAgeyBjbS5zdGF0ZS5zZWxlY3RpbmdUZXh0KGUpOyB9DQoNCiAgICBpZiAocG9zICYmIGhhbmRsZU1hcHBlZEJ1dHRvbihjbSwgYnV0dG9uLCBwb3MsIHJlcGVhdCwgZSkpIHsgcmV0dXJuIH0NCg0KICAgIGlmIChidXR0b24gPT0gMSkgew0KICAgICAgaWYgKHBvcykgeyBsZWZ0QnV0dG9uRG93bihjbSwgcG9zLCByZXBlYXQsIGUpOyB9DQogICAgICBlbHNlIGlmIChlX3RhcmdldChlKSA9PSBkaXNwbGF5LnNjcm9sbGVyKSB7IGVfcHJldmVudERlZmF1bHQoZSk7IH0NCiAgICB9IGVsc2UgaWYgKGJ1dHRvbiA9PSAyKSB7DQogICAgICBpZiAocG9zKSB7IGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHBvcyk7IH0NCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gZGlzcGxheS5pbnB1dC5mb2N1cygpOyB9LCAyMCk7DQogICAgfSBlbHNlIGlmIChidXR0b24gPT0gMykgew0KICAgICAgaWYgKGNhcHR1cmVSaWdodENsaWNrKSB7IGNtLmRpc3BsYXkuaW5wdXQub25Db250ZXh0TWVudShlKTsgfQ0KICAgICAgZWxzZSB7IGRlbGF5Qmx1ckV2ZW50KGNtKTsgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGhhbmRsZU1hcHBlZEJ1dHRvbihjbSwgYnV0dG9uLCBwb3MsIHJlcGVhdCwgZXZlbnQpIHsNCiAgICB2YXIgbmFtZSA9ICJDbGljayI7DQogICAgaWYgKHJlcGVhdCA9PSAiZG91YmxlIikgeyBuYW1lID0gIkRvdWJsZSIgKyBuYW1lOyB9DQogICAgZWxzZSBpZiAocmVwZWF0ID09ICJ0cmlwbGUiKSB7IG5hbWUgPSAiVHJpcGxlIiArIG5hbWU7IH0NCiAgICBuYW1lID0gKGJ1dHRvbiA9PSAxID8gIkxlZnQiIDogYnV0dG9uID09IDIgPyAiTWlkZGxlIiA6ICJSaWdodCIpICsgbmFtZTsNCg0KICAgIHJldHVybiBkaXNwYXRjaEtleShjbSwgIGFkZE1vZGlmaWVyTmFtZXMobmFtZSwgZXZlbnQpLCBldmVudCwgZnVuY3Rpb24gKGJvdW5kKSB7DQogICAgICBpZiAodHlwZW9mIGJvdW5kID09ICJzdHJpbmciKSB7IGJvdW5kID0gY29tbWFuZHNbYm91bmRdOyB9DQogICAgICBpZiAoIWJvdW5kKSB7IHJldHVybiBmYWxzZSB9DQogICAgICB2YXIgZG9uZSA9IGZhbHNlOw0KICAgICAgdHJ5IHsNCiAgICAgICAgaWYgKGNtLmlzUmVhZE9ubHkoKSkgeyBjbS5zdGF0ZS5zdXBwcmVzc0VkaXRzID0gdHJ1ZTsgfQ0KICAgICAgICBkb25lID0gYm91bmQoY20sIHBvcykgIT0gUGFzczsNCiAgICAgIH0gZmluYWxseSB7DQogICAgICAgIGNtLnN0YXRlLnN1cHByZXNzRWRpdHMgPSBmYWxzZTsNCiAgICAgIH0NCiAgICAgIHJldHVybiBkb25lDQogICAgfSkNCiAgfQ0KDQogIGZ1bmN0aW9uIGNvbmZpZ3VyZU1vdXNlKGNtLCByZXBlYXQsIGV2ZW50KSB7DQogICAgdmFyIG9wdGlvbiA9IGNtLmdldE9wdGlvbigiY29uZmlndXJlTW91c2UiKTsNCiAgICB2YXIgdmFsdWUgPSBvcHRpb24gPyBvcHRpb24oY20sIHJlcGVhdCwgZXZlbnQpIDoge307DQogICAgaWYgKHZhbHVlLnVuaXQgPT0gbnVsbCkgew0KICAgICAgdmFyIHJlY3QgPSBjaHJvbWVPUyA/IGV2ZW50LnNoaWZ0S2V5ICYmIGV2ZW50Lm1ldGFLZXkgOiBldmVudC5hbHRLZXk7DQogICAgICB2YWx1ZS51bml0ID0gcmVjdCA/ICJyZWN0YW5nbGUiIDogcmVwZWF0ID09ICJzaW5nbGUiID8gImNoYXIiIDogcmVwZWF0ID09ICJkb3VibGUiID8gIndvcmQiIDogImxpbmUiOw0KICAgIH0NCiAgICBpZiAodmFsdWUuZXh0ZW5kID09IG51bGwgfHwgY20uZG9jLmV4dGVuZCkgeyB2YWx1ZS5leHRlbmQgPSBjbS5kb2MuZXh0ZW5kIHx8IGV2ZW50LnNoaWZ0S2V5OyB9DQogICAgaWYgKHZhbHVlLmFkZE5ldyA9PSBudWxsKSB7IHZhbHVlLmFkZE5ldyA9IG1hYyA/IGV2ZW50Lm1ldGFLZXkgOiBldmVudC5jdHJsS2V5OyB9DQogICAgaWYgKHZhbHVlLm1vdmVPbkRyYWcgPT0gbnVsbCkgeyB2YWx1ZS5tb3ZlT25EcmFnID0gIShtYWMgPyBldmVudC5hbHRLZXkgOiBldmVudC5jdHJsS2V5KTsgfQ0KICAgIHJldHVybiB2YWx1ZQ0KICB9DQoNCiAgZnVuY3Rpb24gbGVmdEJ1dHRvbkRvd24oY20sIHBvcywgcmVwZWF0LCBldmVudCkgew0KICAgIGlmIChpZSkgeyBzZXRUaW1lb3V0KGJpbmQoZW5zdXJlRm9jdXMsIGNtKSwgMCk7IH0NCiAgICBlbHNlIHsgY20uY3VyT3AuZm9jdXMgPSBhY3RpdmVFbHQoKTsgfQ0KDQogICAgdmFyIGJlaGF2aW9yID0gY29uZmlndXJlTW91c2UoY20sIHJlcGVhdCwgZXZlbnQpOw0KDQogICAgdmFyIHNlbCA9IGNtLmRvYy5zZWwsIGNvbnRhaW5lZDsNCiAgICBpZiAoY20ub3B0aW9ucy5kcmFnRHJvcCAmJiBkcmFnQW5kRHJvcCAmJiAhY20uaXNSZWFkT25seSgpICYmDQogICAgICAgIHJlcGVhdCA9PSAic2luZ2xlIiAmJiAoY29udGFpbmVkID0gc2VsLmNvbnRhaW5zKHBvcykpID4gLTEgJiYNCiAgICAgICAgKGNtcCgoY29udGFpbmVkID0gc2VsLnJhbmdlc1tjb250YWluZWRdKS5mcm9tKCksIHBvcykgPCAwIHx8IHBvcy54UmVsID4gMCkgJiYNCiAgICAgICAgKGNtcChjb250YWluZWQudG8oKSwgcG9zKSA+IDAgfHwgcG9zLnhSZWwgPCAwKSkNCiAgICAgIHsgbGVmdEJ1dHRvblN0YXJ0RHJhZyhjbSwgZXZlbnQsIHBvcywgYmVoYXZpb3IpOyB9DQogICAgZWxzZQ0KICAgICAgeyBsZWZ0QnV0dG9uU2VsZWN0KGNtLCBldmVudCwgcG9zLCBiZWhhdmlvcik7IH0NCiAgfQ0KDQogIC8vIFN0YXJ0IGEgdGV4dCBkcmFnLiBXaGVuIGl0IGVuZHMsIHNlZSBpZiBhbnkgZHJhZ2dpbmcgYWN0dWFsbHkNCiAgLy8gaGFwcGVuLCBhbmQgdHJlYXQgYXMgYSBjbGljayBpZiBpdCBkaWRuJ3QuDQogIGZ1bmN0aW9uIGxlZnRCdXR0b25TdGFydERyYWcoY20sIGV2ZW50LCBwb3MsIGJlaGF2aW9yKSB7DQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBtb3ZlZCA9IGZhbHNlOw0KICAgIHZhciBkcmFnRW5kID0gb3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoZSkgew0KICAgICAgaWYgKHdlYmtpdCkgeyBkaXNwbGF5LnNjcm9sbGVyLmRyYWdnYWJsZSA9IGZhbHNlOyB9DQogICAgICBjbS5zdGF0ZS5kcmFnZ2luZ1RleHQgPSBmYWxzZTsNCiAgICAgIG9mZihkaXNwbGF5LndyYXBwZXIub3duZXJEb2N1bWVudCwgIm1vdXNldXAiLCBkcmFnRW5kKTsNCiAgICAgIG9mZihkaXNwbGF5LndyYXBwZXIub3duZXJEb2N1bWVudCwgIm1vdXNlbW92ZSIsIG1vdXNlTW92ZSk7DQogICAgICBvZmYoZGlzcGxheS5zY3JvbGxlciwgImRyYWdzdGFydCIsIGRyYWdTdGFydCk7DQogICAgICBvZmYoZGlzcGxheS5zY3JvbGxlciwgImRyb3AiLCBkcmFnRW5kKTsNCiAgICAgIGlmICghbW92ZWQpIHsNCiAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTsNCiAgICAgICAgaWYgKCFiZWhhdmlvci5hZGROZXcpDQogICAgICAgICAgeyBleHRlbmRTZWxlY3Rpb24oY20uZG9jLCBwb3MsIG51bGwsIG51bGwsIGJlaGF2aW9yLmV4dGVuZCk7IH0NCiAgICAgICAgLy8gV29yayBhcm91bmQgdW5leHBsYWluYWJsZSBmb2N1cyBwcm9ibGVtIGluIElFOSAoIzIxMjcpIGFuZCBDaHJvbWUgKCMzMDgxKQ0KICAgICAgICBpZiAod2Via2l0IHx8IGllICYmIGllX3ZlcnNpb24gPT0gOSkNCiAgICAgICAgICB7IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge2Rpc3BsYXkud3JhcHBlci5vd25lckRvY3VtZW50LmJvZHkuZm9jdXMoKTsgZGlzcGxheS5pbnB1dC5mb2N1cygpO30sIDIwKTsgfQ0KICAgICAgICBlbHNlDQogICAgICAgICAgeyBkaXNwbGF5LmlucHV0LmZvY3VzKCk7IH0NCiAgICAgIH0NCiAgICB9KTsNCiAgICB2YXIgbW91c2VNb3ZlID0gZnVuY3Rpb24oZTIpIHsNCiAgICAgIG1vdmVkID0gbW92ZWQgfHwgTWF0aC5hYnMoZXZlbnQuY2xpZW50WCAtIGUyLmNsaWVudFgpICsgTWF0aC5hYnMoZXZlbnQuY2xpZW50WSAtIGUyLmNsaWVudFkpID49IDEwOw0KICAgIH07DQogICAgdmFyIGRyYWdTdGFydCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIG1vdmVkID0gdHJ1ZTsgfTsNCiAgICAvLyBMZXQgdGhlIGRyYWcgaGFuZGxlciBoYW5kbGUgdGhpcy4NCiAgICBpZiAod2Via2l0KSB7IGRpc3BsYXkuc2Nyb2xsZXIuZHJhZ2dhYmxlID0gdHJ1ZTsgfQ0KICAgIGNtLnN0YXRlLmRyYWdnaW5nVGV4dCA9IGRyYWdFbmQ7DQogICAgZHJhZ0VuZC5jb3B5ID0gIWJlaGF2aW9yLm1vdmVPbkRyYWc7DQogICAgLy8gSUUncyBhcHByb2FjaCB0byBkcmFnZ2FibGUNCiAgICBpZiAoZGlzcGxheS5zY3JvbGxlci5kcmFnRHJvcCkgeyBkaXNwbGF5LnNjcm9sbGVyLmRyYWdEcm9wKCk7IH0NCiAgICBvbihkaXNwbGF5LndyYXBwZXIub3duZXJEb2N1bWVudCwgIm1vdXNldXAiLCBkcmFnRW5kKTsNCiAgICBvbihkaXNwbGF5LndyYXBwZXIub3duZXJEb2N1bWVudCwgIm1vdXNlbW92ZSIsIG1vdXNlTW92ZSk7DQogICAgb24oZGlzcGxheS5zY3JvbGxlciwgImRyYWdzdGFydCIsIGRyYWdTdGFydCk7DQogICAgb24oZGlzcGxheS5zY3JvbGxlciwgImRyb3AiLCBkcmFnRW5kKTsNCg0KICAgIGRlbGF5Qmx1ckV2ZW50KGNtKTsNCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTsgfSwgMjApOw0KICB9DQoNCiAgZnVuY3Rpb24gcmFuZ2VGb3JVbml0KGNtLCBwb3MsIHVuaXQpIHsNCiAgICBpZiAodW5pdCA9PSAiY2hhciIpIHsgcmV0dXJuIG5ldyBSYW5nZShwb3MsIHBvcykgfQ0KICAgIGlmICh1bml0ID09ICJ3b3JkIikgeyByZXR1cm4gY20uZmluZFdvcmRBdChwb3MpIH0NCiAgICBpZiAodW5pdCA9PSAibGluZSIpIHsgcmV0dXJuIG5ldyBSYW5nZShQb3MocG9zLmxpbmUsIDApLCBjbGlwUG9zKGNtLmRvYywgUG9zKHBvcy5saW5lICsgMSwgMCkpKSB9DQogICAgdmFyIHJlc3VsdCA9IHVuaXQoY20sIHBvcyk7DQogICAgcmV0dXJuIG5ldyBSYW5nZShyZXN1bHQuZnJvbSwgcmVzdWx0LnRvKQ0KICB9DQoNCiAgLy8gTm9ybWFsIHNlbGVjdGlvbiwgYXMgb3Bwb3NlZCB0byB0ZXh0IGRyYWdnaW5nLg0KICBmdW5jdGlvbiBsZWZ0QnV0dG9uU2VsZWN0KGNtLCBldmVudCwgc3RhcnQsIGJlaGF2aW9yKSB7DQogICAgdmFyIGRpc3BsYXkgPSBjbS5kaXNwbGF5LCBkb2MgPSBjbS5kb2M7DQogICAgZV9wcmV2ZW50RGVmYXVsdChldmVudCk7DQoNCiAgICB2YXIgb3VyUmFuZ2UsIG91ckluZGV4LCBzdGFydFNlbCA9IGRvYy5zZWwsIHJhbmdlcyA9IHN0YXJ0U2VsLnJhbmdlczsNCiAgICBpZiAoYmVoYXZpb3IuYWRkTmV3ICYmICFiZWhhdmlvci5leHRlbmQpIHsNCiAgICAgIG91ckluZGV4ID0gZG9jLnNlbC5jb250YWlucyhzdGFydCk7DQogICAgICBpZiAob3VySW5kZXggPiAtMSkNCiAgICAgICAgeyBvdXJSYW5nZSA9IHJhbmdlc1tvdXJJbmRleF07IH0NCiAgICAgIGVsc2UNCiAgICAgICAgeyBvdXJSYW5nZSA9IG5ldyBSYW5nZShzdGFydCwgc3RhcnQpOyB9DQogICAgfSBlbHNlIHsNCiAgICAgIG91clJhbmdlID0gZG9jLnNlbC5wcmltYXJ5KCk7DQogICAgICBvdXJJbmRleCA9IGRvYy5zZWwucHJpbUluZGV4Ow0KICAgIH0NCg0KICAgIGlmIChiZWhhdmlvci51bml0ID09ICJyZWN0YW5nbGUiKSB7DQogICAgICBpZiAoIWJlaGF2aW9yLmFkZE5ldykgeyBvdXJSYW5nZSA9IG5ldyBSYW5nZShzdGFydCwgc3RhcnQpOyB9DQogICAgICBzdGFydCA9IHBvc0Zyb21Nb3VzZShjbSwgZXZlbnQsIHRydWUsIHRydWUpOw0KICAgICAgb3VySW5kZXggPSAtMTsNCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIHJhbmdlJCQxID0gcmFuZ2VGb3JVbml0KGNtLCBzdGFydCwgYmVoYXZpb3IudW5pdCk7DQogICAgICBpZiAoYmVoYXZpb3IuZXh0ZW5kKQ0KICAgICAgICB7IG91clJhbmdlID0gZXh0ZW5kUmFuZ2Uob3VyUmFuZ2UsIHJhbmdlJCQxLmFuY2hvciwgcmFuZ2UkJDEuaGVhZCwgYmVoYXZpb3IuZXh0ZW5kKTsgfQ0KICAgICAgZWxzZQ0KICAgICAgICB7IG91clJhbmdlID0gcmFuZ2UkJDE7IH0NCiAgICB9DQoNCiAgICBpZiAoIWJlaGF2aW9yLmFkZE5ldykgew0KICAgICAgb3VySW5kZXggPSAwOw0KICAgICAgc2V0U2VsZWN0aW9uKGRvYywgbmV3IFNlbGVjdGlvbihbb3VyUmFuZ2VdLCAwKSwgc2VsX21vdXNlKTsNCiAgICAgIHN0YXJ0U2VsID0gZG9jLnNlbDsNCiAgICB9IGVsc2UgaWYgKG91ckluZGV4ID09IC0xKSB7DQogICAgICBvdXJJbmRleCA9IHJhbmdlcy5sZW5ndGg7DQogICAgICBzZXRTZWxlY3Rpb24oZG9jLCBub3JtYWxpemVTZWxlY3Rpb24oY20sIHJhbmdlcy5jb25jYXQoW291clJhbmdlXSksIG91ckluZGV4KSwNCiAgICAgICAgICAgICAgICAgICB7c2Nyb2xsOiBmYWxzZSwgb3JpZ2luOiAiKm1vdXNlIn0pOw0KICAgIH0gZWxzZSBpZiAocmFuZ2VzLmxlbmd0aCA+IDEgJiYgcmFuZ2VzW291ckluZGV4XS5lbXB0eSgpICYmIGJlaGF2aW9yLnVuaXQgPT0gImNoYXIiICYmICFiZWhhdmlvci5leHRlbmQpIHsNCiAgICAgIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihjbSwgcmFuZ2VzLnNsaWNlKDAsIG91ckluZGV4KS5jb25jYXQocmFuZ2VzLnNsaWNlKG91ckluZGV4ICsgMSkpLCAwKSwNCiAgICAgICAgICAgICAgICAgICB7c2Nyb2xsOiBmYWxzZSwgb3JpZ2luOiAiKm1vdXNlIn0pOw0KICAgICAgc3RhcnRTZWwgPSBkb2Muc2VsOw0KICAgIH0gZWxzZSB7DQogICAgICByZXBsYWNlT25lU2VsZWN0aW9uKGRvYywgb3VySW5kZXgsIG91clJhbmdlLCBzZWxfbW91c2UpOw0KICAgIH0NCg0KICAgIHZhciBsYXN0UG9zID0gc3RhcnQ7DQogICAgZnVuY3Rpb24gZXh0ZW5kVG8ocG9zKSB7DQogICAgICBpZiAoY21wKGxhc3RQb3MsIHBvcykgPT0gMCkgeyByZXR1cm4gfQ0KICAgICAgbGFzdFBvcyA9IHBvczsNCg0KICAgICAgaWYgKGJlaGF2aW9yLnVuaXQgPT0gInJlY3RhbmdsZSIpIHsNCiAgICAgICAgdmFyIHJhbmdlcyA9IFtdLCB0YWJTaXplID0gY20ub3B0aW9ucy50YWJTaXplOw0KICAgICAgICB2YXIgc3RhcnRDb2wgPSBjb3VudENvbHVtbihnZXRMaW5lKGRvYywgc3RhcnQubGluZSkudGV4dCwgc3RhcnQuY2gsIHRhYlNpemUpOw0KICAgICAgICB2YXIgcG9zQ29sID0gY291bnRDb2x1bW4oZ2V0TGluZShkb2MsIHBvcy5saW5lKS50ZXh0LCBwb3MuY2gsIHRhYlNpemUpOw0KICAgICAgICB2YXIgbGVmdCA9IE1hdGgubWluKHN0YXJ0Q29sLCBwb3NDb2wpLCByaWdodCA9IE1hdGgubWF4KHN0YXJ0Q29sLCBwb3NDb2wpOw0KICAgICAgICBmb3IgKHZhciBsaW5lID0gTWF0aC5taW4oc3RhcnQubGluZSwgcG9zLmxpbmUpLCBlbmQgPSBNYXRoLm1pbihjbS5sYXN0TGluZSgpLCBNYXRoLm1heChzdGFydC5saW5lLCBwb3MubGluZSkpOw0KICAgICAgICAgICAgIGxpbmUgPD0gZW5kOyBsaW5lKyspIHsNCiAgICAgICAgICB2YXIgdGV4dCA9IGdldExpbmUoZG9jLCBsaW5lKS50ZXh0LCBsZWZ0UG9zID0gZmluZENvbHVtbih0ZXh0LCBsZWZ0LCB0YWJTaXplKTsNCiAgICAgICAgICBpZiAobGVmdCA9PSByaWdodCkNCiAgICAgICAgICAgIHsgcmFuZ2VzLnB1c2gobmV3IFJhbmdlKFBvcyhsaW5lLCBsZWZ0UG9zKSwgUG9zKGxpbmUsIGxlZnRQb3MpKSk7IH0NCiAgICAgICAgICBlbHNlIGlmICh0ZXh0Lmxlbmd0aCA+IGxlZnRQb3MpDQogICAgICAgICAgICB7IHJhbmdlcy5wdXNoKG5ldyBSYW5nZShQb3MobGluZSwgbGVmdFBvcyksIFBvcyhsaW5lLCBmaW5kQ29sdW1uKHRleHQsIHJpZ2h0LCB0YWJTaXplKSkpKTsgfQ0KICAgICAgICB9DQogICAgICAgIGlmICghcmFuZ2VzLmxlbmd0aCkgeyByYW5nZXMucHVzaChuZXcgUmFuZ2Uoc3RhcnQsIHN0YXJ0KSk7IH0NCiAgICAgICAgc2V0U2VsZWN0aW9uKGRvYywgbm9ybWFsaXplU2VsZWN0aW9uKGNtLCBzdGFydFNlbC5yYW5nZXMuc2xpY2UoMCwgb3VySW5kZXgpLmNvbmNhdChyYW5nZXMpLCBvdXJJbmRleCksDQogICAgICAgICAgICAgICAgICAgICB7b3JpZ2luOiAiKm1vdXNlIiwgc2Nyb2xsOiBmYWxzZX0pOw0KICAgICAgICBjbS5zY3JvbGxJbnRvVmlldyhwb3MpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIG9sZFJhbmdlID0gb3VyUmFuZ2U7DQogICAgICAgIHZhciByYW5nZSQkMSA9IHJhbmdlRm9yVW5pdChjbSwgcG9zLCBiZWhhdmlvci51bml0KTsNCiAgICAgICAgdmFyIGFuY2hvciA9IG9sZFJhbmdlLmFuY2hvciwgaGVhZDsNCiAgICAgICAgaWYgKGNtcChyYW5nZSQkMS5hbmNob3IsIGFuY2hvcikgPiAwKSB7DQogICAgICAgICAgaGVhZCA9IHJhbmdlJCQxLmhlYWQ7DQogICAgICAgICAgYW5jaG9yID0gbWluUG9zKG9sZFJhbmdlLmZyb20oKSwgcmFuZ2UkJDEuYW5jaG9yKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICBoZWFkID0gcmFuZ2UkJDEuYW5jaG9yOw0KICAgICAgICAgIGFuY2hvciA9IG1heFBvcyhvbGRSYW5nZS50bygpLCByYW5nZSQkMS5oZWFkKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgcmFuZ2VzJDEgPSBzdGFydFNlbC5yYW5nZXMuc2xpY2UoMCk7DQogICAgICAgIHJhbmdlcyQxW291ckluZGV4XSA9IGJpZGlTaW1wbGlmeShjbSwgbmV3IFJhbmdlKGNsaXBQb3MoZG9jLCBhbmNob3IpLCBoZWFkKSk7DQogICAgICAgIHNldFNlbGVjdGlvbihkb2MsIG5vcm1hbGl6ZVNlbGVjdGlvbihjbSwgcmFuZ2VzJDEsIG91ckluZGV4KSwgc2VsX21vdXNlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgZWRpdG9yU2l6ZSA9IGRpc3BsYXkud3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAvLyBVc2VkIHRvIGVuc3VyZSB0aW1lb3V0IHJlLXRyaWVzIGRvbid0IGZpcmUgd2hlbiBhbm90aGVyIGV4dGVuZA0KICAgIC8vIGhhcHBlbmVkIGluIHRoZSBtZWFudGltZSAoY2xlYXJUaW1lb3V0IGlzbid0IHJlbGlhYmxlIC0tIGF0DQogICAgLy8gbGVhc3Qgb24gQ2hyb21lLCB0aGUgdGltZW91dHMgc3RpbGwgaGFwcGVuIGV2ZW4gd2hlbiBjbGVhcmVkLA0KICAgIC8vIGlmIHRoZSBjbGVhciBoYXBwZW5zIGFmdGVyIHRoZWlyIHNjaGVkdWxlZCBmaXJpbmcgdGltZSkuDQogICAgdmFyIGNvdW50ZXIgPSAwOw0KDQogICAgZnVuY3Rpb24gZXh0ZW5kKGUpIHsNCiAgICAgIHZhciBjdXJDb3VudCA9ICsrY291bnRlcjsNCiAgICAgIHZhciBjdXIgPSBwb3NGcm9tTW91c2UoY20sIGUsIHRydWUsIGJlaGF2aW9yLnVuaXQgPT0gInJlY3RhbmdsZSIpOw0KICAgICAgaWYgKCFjdXIpIHsgcmV0dXJuIH0NCiAgICAgIGlmIChjbXAoY3VyLCBsYXN0UG9zKSAhPSAwKSB7DQogICAgICAgIGNtLmN1ck9wLmZvY3VzID0gYWN0aXZlRWx0KCk7DQogICAgICAgIGV4dGVuZFRvKGN1cik7DQogICAgICAgIHZhciB2aXNpYmxlID0gdmlzaWJsZUxpbmVzKGRpc3BsYXksIGRvYyk7DQogICAgICAgIGlmIChjdXIubGluZSA+PSB2aXNpYmxlLnRvIHx8IGN1ci5saW5lIDwgdmlzaWJsZS5mcm9tKQ0KICAgICAgICAgIHsgc2V0VGltZW91dChvcGVyYXRpb24oY20sIGZ1bmN0aW9uICgpIHtpZiAoY291bnRlciA9PSBjdXJDb3VudCkgeyBleHRlbmQoZSk7IH19KSwgMTUwKTsgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIG91dHNpZGUgPSBlLmNsaWVudFkgPCBlZGl0b3JTaXplLnRvcCA/IC0yMCA6IGUuY2xpZW50WSA+IGVkaXRvclNpemUuYm90dG9tID8gMjAgOiAwOw0KICAgICAgICBpZiAob3V0c2lkZSkgeyBzZXRUaW1lb3V0KG9wZXJhdGlvbihjbSwgZnVuY3Rpb24gKCkgew0KICAgICAgICAgIGlmIChjb3VudGVyICE9IGN1ckNvdW50KSB7IHJldHVybiB9DQogICAgICAgICAgZGlzcGxheS5zY3JvbGxlci5zY3JvbGxUb3AgKz0gb3V0c2lkZTsNCiAgICAgICAgICBleHRlbmQoZSk7DQogICAgICAgIH0pLCA1MCk7IH0NCiAgICAgIH0NCiAgICB9DQoNCiAgICBmdW5jdGlvbiBkb25lKGUpIHsNCiAgICAgIGNtLnN0YXRlLnNlbGVjdGluZ1RleHQgPSBmYWxzZTsNCiAgICAgIGNvdW50ZXIgPSBJbmZpbml0eTsNCiAgICAgIC8vIElmIGUgaXMgbnVsbCBvciB1bmRlZmluZWQgd2UgaW50ZXJwcmV0IHRoaXMgYXMgc29tZW9uZSB0cnlpbmcNCiAgICAgIC8vIHRvIGV4cGxpY2l0bHkgY2FuY2VsIHRoZSBzZWxlY3Rpb24gcmF0aGVyIHRoYW4gdGhlIHVzZXINCiAgICAgIC8vIGxldHRpbmcgZ28gb2YgdGhlIG1vdXNlIGJ1dHRvbi4NCiAgICAgIGlmIChlKSB7DQogICAgICAgIGVfcHJldmVudERlZmF1bHQoZSk7DQogICAgICAgIGRpc3BsYXkuaW5wdXQuZm9jdXMoKTsNCiAgICAgIH0NCiAgICAgIG9mZihkaXNwbGF5LndyYXBwZXIub3duZXJEb2N1bWVudCwgIm1vdXNlbW92ZSIsIG1vdmUpOw0KICAgICAgb2ZmKGRpc3BsYXkud3JhcHBlci5vd25lckRvY3VtZW50LCAibW91c2V1cCIsIHVwKTsNCiAgICAgIGRvYy5oaXN0b3J5Lmxhc3RTZWxPcmlnaW4gPSBudWxsOw0KICAgIH0NCg0KICAgIHZhciBtb3ZlID0gb3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoZSkgew0KICAgICAgaWYgKGUuYnV0dG9ucyA9PT0gMCB8fCAhZV9idXR0b24oZSkpIHsgZG9uZShlKTsgfQ0KICAgICAgZWxzZSB7IGV4dGVuZChlKTsgfQ0KICAgIH0pOw0KICAgIHZhciB1cCA9IG9wZXJhdGlvbihjbSwgZG9uZSk7DQogICAgY20uc3RhdGUuc2VsZWN0aW5nVGV4dCA9IHVwOw0KICAgIG9uKGRpc3BsYXkud3JhcHBlci5vd25lckRvY3VtZW50LCAibW91c2Vtb3ZlIiwgbW92ZSk7DQogICAgb24oZGlzcGxheS53cmFwcGVyLm93bmVyRG9jdW1lbnQsICJtb3VzZXVwIiwgdXApOw0KICB9DQoNCiAgLy8gVXNlZCB3aGVuIG1vdXNlLXNlbGVjdGluZyB0byBhZGp1c3QgdGhlIGFuY2hvciB0byB0aGUgcHJvcGVyIHNpZGUNCiAgLy8gb2YgYSBiaWRpIGp1bXAgZGVwZW5kaW5nIG9uIHRoZSB2aXN1YWwgcG9zaXRpb24gb2YgdGhlIGhlYWQuDQogIGZ1bmN0aW9uIGJpZGlTaW1wbGlmeShjbSwgcmFuZ2UkJDEpIHsNCiAgICB2YXIgYW5jaG9yID0gcmFuZ2UkJDEuYW5jaG9yOw0KICAgIHZhciBoZWFkID0gcmFuZ2UkJDEuaGVhZDsNCiAgICB2YXIgYW5jaG9yTGluZSA9IGdldExpbmUoY20uZG9jLCBhbmNob3IubGluZSk7DQogICAgaWYgKGNtcChhbmNob3IsIGhlYWQpID09IDAgJiYgYW5jaG9yLnN0aWNreSA9PSBoZWFkLnN0aWNreSkgeyByZXR1cm4gcmFuZ2UkJDEgfQ0KICAgIHZhciBvcmRlciA9IGdldE9yZGVyKGFuY2hvckxpbmUpOw0KICAgIGlmICghb3JkZXIpIHsgcmV0dXJuIHJhbmdlJCQxIH0NCiAgICB2YXIgaW5kZXggPSBnZXRCaWRpUGFydEF0KG9yZGVyLCBhbmNob3IuY2gsIGFuY2hvci5zdGlja3kpLCBwYXJ0ID0gb3JkZXJbaW5kZXhdOw0KICAgIGlmIChwYXJ0LmZyb20gIT0gYW5jaG9yLmNoICYmIHBhcnQudG8gIT0gYW5jaG9yLmNoKSB7IHJldHVybiByYW5nZSQkMSB9DQogICAgdmFyIGJvdW5kYXJ5ID0gaW5kZXggKyAoKHBhcnQuZnJvbSA9PSBhbmNob3IuY2gpID09IChwYXJ0LmxldmVsICE9IDEpID8gMCA6IDEpOw0KICAgIGlmIChib3VuZGFyeSA9PSAwIHx8IGJvdW5kYXJ5ID09IG9yZGVyLmxlbmd0aCkgeyByZXR1cm4gcmFuZ2UkJDEgfQ0KDQogICAgLy8gQ29tcHV0ZSB0aGUgcmVsYXRpdmUgdmlzdWFsIHBvc2l0aW9uIG9mIHRoZSBoZWFkIGNvbXBhcmVkIHRvIHRoZQ0KICAgIC8vIGFuY2hvciAoPDAgaXMgdG8gdGhlIGxlZnQsID4wIHRvIHRoZSByaWdodCkNCiAgICB2YXIgbGVmdFNpZGU7DQogICAgaWYgKGhlYWQubGluZSAhPSBhbmNob3IubGluZSkgew0KICAgICAgbGVmdFNpZGUgPSAoaGVhZC5saW5lIC0gYW5jaG9yLmxpbmUpICogKGNtLmRvYy5kaXJlY3Rpb24gPT0gImx0ciIgPyAxIDogLTEpID4gMDsNCiAgICB9IGVsc2Ugew0KICAgICAgdmFyIGhlYWRJbmRleCA9IGdldEJpZGlQYXJ0QXQob3JkZXIsIGhlYWQuY2gsIGhlYWQuc3RpY2t5KTsNCiAgICAgIHZhciBkaXIgPSBoZWFkSW5kZXggLSBpbmRleCB8fCAoaGVhZC5jaCAtIGFuY2hvci5jaCkgKiAocGFydC5sZXZlbCA9PSAxID8gLTEgOiAxKTsNCiAgICAgIGlmIChoZWFkSW5kZXggPT0gYm91bmRhcnkgLSAxIHx8IGhlYWRJbmRleCA9PSBib3VuZGFyeSkNCiAgICAgICAgeyBsZWZ0U2lkZSA9IGRpciA8IDA7IH0NCiAgICAgIGVsc2UNCiAgICAgICAgeyBsZWZ0U2lkZSA9IGRpciA+IDA7IH0NCiAgICB9DQoNCiAgICB2YXIgdXNlUGFydCA9IG9yZGVyW2JvdW5kYXJ5ICsgKGxlZnRTaWRlID8gLTEgOiAwKV07DQogICAgdmFyIGZyb20gPSBsZWZ0U2lkZSA9PSAodXNlUGFydC5sZXZlbCA9PSAxKTsNCiAgICB2YXIgY2ggPSBmcm9tID8gdXNlUGFydC5mcm9tIDogdXNlUGFydC50bywgc3RpY2t5ID0gZnJvbSA/ICJhZnRlciIgOiAiYmVmb3JlIjsNCiAgICByZXR1cm4gYW5jaG9yLmNoID09IGNoICYmIGFuY2hvci5zdGlja3kgPT0gc3RpY2t5ID8gcmFuZ2UkJDEgOiBuZXcgUmFuZ2UobmV3IFBvcyhhbmNob3IubGluZSwgY2gsIHN0aWNreSksIGhlYWQpDQogIH0NCg0KDQogIC8vIERldGVybWluZXMgd2hldGhlciBhbiBldmVudCBoYXBwZW5lZCBpbiB0aGUgZ3V0dGVyLCBhbmQgZmlyZXMgdGhlDQogIC8vIGhhbmRsZXJzIGZvciB0aGUgY29ycmVzcG9uZGluZyBldmVudC4NCiAgZnVuY3Rpb24gZ3V0dGVyRXZlbnQoY20sIGUsIHR5cGUsIHByZXZlbnQpIHsNCiAgICB2YXIgbVgsIG1ZOw0KICAgIGlmIChlLnRvdWNoZXMpIHsNCiAgICAgIG1YID0gZS50b3VjaGVzWzBdLmNsaWVudFg7DQogICAgICBtWSA9IGUudG91Y2hlc1swXS5jbGllbnRZOw0KICAgIH0gZWxzZSB7DQogICAgICB0cnkgeyBtWCA9IGUuY2xpZW50WDsgbVkgPSBlLmNsaWVudFk7IH0NCiAgICAgIGNhdGNoKGUpIHsgcmV0dXJuIGZhbHNlIH0NCiAgICB9DQogICAgaWYgKG1YID49IE1hdGguZmxvb3IoY20uZGlzcGxheS5ndXR0ZXJzLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnJpZ2h0KSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIGlmIChwcmV2ZW50KSB7IGVfcHJldmVudERlZmF1bHQoZSk7IH0NCg0KICAgIHZhciBkaXNwbGF5ID0gY20uZGlzcGxheTsNCiAgICB2YXIgbGluZUJveCA9IGRpc3BsYXkubGluZURpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCg0KICAgIGlmIChtWSA+IGxpbmVCb3guYm90dG9tIHx8ICFoYXNIYW5kbGVyKGNtLCB0eXBlKSkgeyByZXR1cm4gZV9kZWZhdWx0UHJldmVudGVkKGUpIH0NCiAgICBtWSAtPSBsaW5lQm94LnRvcCAtIGRpc3BsYXkudmlld09mZnNldDsNCg0KICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY20uZGlzcGxheS5ndXR0ZXJTcGVjcy5sZW5ndGg7ICsraSkgew0KICAgICAgdmFyIGcgPSBkaXNwbGF5Lmd1dHRlcnMuY2hpbGROb2Rlc1tpXTsNCiAgICAgIGlmIChnICYmIGcuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkucmlnaHQgPj0gbVgpIHsNCiAgICAgICAgdmFyIGxpbmUgPSBsaW5lQXRIZWlnaHQoY20uZG9jLCBtWSk7DQogICAgICAgIHZhciBndXR0ZXIgPSBjbS5kaXNwbGF5Lmd1dHRlclNwZWNzW2ldOw0KICAgICAgICBzaWduYWwoY20sIHR5cGUsIGNtLCBsaW5lLCBndXR0ZXIuY2xhc3NOYW1lLCBlKTsNCiAgICAgICAgcmV0dXJuIGVfZGVmYXVsdFByZXZlbnRlZChlKQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGNsaWNrSW5HdXR0ZXIoY20sIGUpIHsNCiAgICByZXR1cm4gZ3V0dGVyRXZlbnQoY20sIGUsICJndXR0ZXJDbGljayIsIHRydWUpDQogIH0NCg0KICAvLyBDT05URVhUIE1FTlUgSEFORExJTkcNCg0KICAvLyBUbyBtYWtlIHRoZSBjb250ZXh0IG1lbnUgd29yaywgd2UgbmVlZCB0byBicmllZmx5IHVuaGlkZSB0aGUNCiAgLy8gdGV4dGFyZWEgKG1ha2luZyBpdCBhcyB1bm9idHJ1c2l2ZSBhcyBwb3NzaWJsZSkgdG8gbGV0IHRoZQ0KICAvLyByaWdodC1jbGljayB0YWtlIGVmZmVjdCBvbiBpdC4NCiAgZnVuY3Rpb24gb25Db250ZXh0TWVudShjbSwgZSkgew0KICAgIGlmIChldmVudEluV2lkZ2V0KGNtLmRpc3BsYXksIGUpIHx8IGNvbnRleHRNZW51SW5HdXR0ZXIoY20sIGUpKSB7IHJldHVybiB9DQogICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlLCAiY29udGV4dG1lbnUiKSkgeyByZXR1cm4gfQ0KICAgIGlmICghY2FwdHVyZVJpZ2h0Q2xpY2spIHsgY20uZGlzcGxheS5pbnB1dC5vbkNvbnRleHRNZW51KGUpOyB9DQogIH0NCg0KICBmdW5jdGlvbiBjb250ZXh0TWVudUluR3V0dGVyKGNtLCBlKSB7DQogICAgaWYgKCFoYXNIYW5kbGVyKGNtLCAiZ3V0dGVyQ29udGV4dE1lbnUiKSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIHJldHVybiBndXR0ZXJFdmVudChjbSwgZSwgImd1dHRlckNvbnRleHRNZW51IiwgZmFsc2UpDQogIH0NCg0KICBmdW5jdGlvbiB0aGVtZUNoYW5nZWQoY20pIHsNCiAgICBjbS5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lID0gY20uZGlzcGxheS53cmFwcGVyLmNsYXNzTmFtZS5yZXBsYWNlKC9ccypjbS1zLVxTKy9nLCAiIikgKw0KICAgICAgY20ub3B0aW9ucy50aGVtZS5yZXBsYWNlKC8oXnxccylccyovZywgIiBjbS1zLSIpOw0KICAgIGNsZWFyQ2FjaGVzKGNtKTsNCiAgfQ0KDQogIHZhciBJbml0ID0ge3RvU3RyaW5nOiBmdW5jdGlvbigpe3JldHVybiAiQ29kZU1pcnJvci5Jbml0In19Ow0KDQogIHZhciBkZWZhdWx0cyA9IHt9Ow0KICB2YXIgb3B0aW9uSGFuZGxlcnMgPSB7fTsNCg0KICBmdW5jdGlvbiBkZWZpbmVPcHRpb25zKENvZGVNaXJyb3IpIHsNCiAgICB2YXIgb3B0aW9uSGFuZGxlcnMgPSBDb2RlTWlycm9yLm9wdGlvbkhhbmRsZXJzOw0KDQogICAgZnVuY3Rpb24gb3B0aW9uKG5hbWUsIGRlZmx0LCBoYW5kbGUsIG5vdE9uSW5pdCkgew0KICAgICAgQ29kZU1pcnJvci5kZWZhdWx0c1tuYW1lXSA9IGRlZmx0Ow0KICAgICAgaWYgKGhhbmRsZSkgeyBvcHRpb25IYW5kbGVyc1tuYW1lXSA9DQogICAgICAgIG5vdE9uSW5pdCA/IGZ1bmN0aW9uIChjbSwgdmFsLCBvbGQpIHtpZiAob2xkICE9IEluaXQpIHsgaGFuZGxlKGNtLCB2YWwsIG9sZCk7IH19IDogaGFuZGxlOyB9DQogICAgfQ0KDQogICAgQ29kZU1pcnJvci5kZWZpbmVPcHRpb24gPSBvcHRpb247DQoNCiAgICAvLyBQYXNzZWQgdG8gb3B0aW9uIGhhbmRsZXJzIHdoZW4gdGhlcmUgaXMgbm8gb2xkIHZhbHVlLg0KICAgIENvZGVNaXJyb3IuSW5pdCA9IEluaXQ7DQoNCiAgICAvLyBUaGVzZSB0d28gYXJlLCBvbiBpbml0LCBjYWxsZWQgZnJvbSB0aGUgY29uc3RydWN0b3IgYmVjYXVzZSB0aGV5DQogICAgLy8gaGF2ZSB0byBiZSBpbml0aWFsaXplZCBiZWZvcmUgdGhlIGVkaXRvciBjYW4gc3RhcnQgYXQgYWxsLg0KICAgIG9wdGlvbigidmFsdWUiLCAiIiwgZnVuY3Rpb24gKGNtLCB2YWwpIHsgcmV0dXJuIGNtLnNldFZhbHVlKHZhbCk7IH0sIHRydWUpOw0KICAgIG9wdGlvbigibW9kZSIsIG51bGwsIGZ1bmN0aW9uIChjbSwgdmFsKSB7DQogICAgICBjbS5kb2MubW9kZU9wdGlvbiA9IHZhbDsNCiAgICAgIGxvYWRNb2RlKGNtKTsNCiAgICB9LCB0cnVlKTsNCg0KICAgIG9wdGlvbigiaW5kZW50VW5pdCIsIDIsIGxvYWRNb2RlLCB0cnVlKTsNCiAgICBvcHRpb24oImluZGVudFdpdGhUYWJzIiwgZmFsc2UpOw0KICAgIG9wdGlvbigic21hcnRJbmRlbnQiLCB0cnVlKTsNCiAgICBvcHRpb24oInRhYlNpemUiLCA0LCBmdW5jdGlvbiAoY20pIHsNCiAgICAgIHJlc2V0TW9kZVN0YXRlKGNtKTsNCiAgICAgIGNsZWFyQ2FjaGVzKGNtKTsNCiAgICAgIHJlZ0NoYW5nZShjbSk7DQogICAgfSwgdHJ1ZSk7DQoNCiAgICBvcHRpb24oImxpbmVTZXBhcmF0b3IiLCBudWxsLCBmdW5jdGlvbiAoY20sIHZhbCkgew0KICAgICAgY20uZG9jLmxpbmVTZXAgPSB2YWw7DQogICAgICBpZiAoIXZhbCkgeyByZXR1cm4gfQ0KICAgICAgdmFyIG5ld0JyZWFrcyA9IFtdLCBsaW5lTm8gPSBjbS5kb2MuZmlyc3Q7DQogICAgICBjbS5kb2MuaXRlcihmdW5jdGlvbiAobGluZSkgew0KICAgICAgICBmb3IgKHZhciBwb3MgPSAwOzspIHsNCiAgICAgICAgICB2YXIgZm91bmQgPSBsaW5lLnRleHQuaW5kZXhPZih2YWwsIHBvcyk7DQogICAgICAgICAgaWYgKGZvdW5kID09IC0xKSB7IGJyZWFrIH0NCiAgICAgICAgICBwb3MgPSBmb3VuZCArIHZhbC5sZW5ndGg7DQogICAgICAgICAgbmV3QnJlYWtzLnB1c2goUG9zKGxpbmVObywgZm91bmQpKTsNCiAgICAgICAgfQ0KICAgICAgICBsaW5lTm8rKzsNCiAgICAgIH0pOw0KICAgICAgZm9yICh2YXIgaSA9IG5ld0JyZWFrcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkNCiAgICAgICAgeyByZXBsYWNlUmFuZ2UoY20uZG9jLCB2YWwsIG5ld0JyZWFrc1tpXSwgUG9zKG5ld0JyZWFrc1tpXS5saW5lLCBuZXdCcmVha3NbaV0uY2ggKyB2YWwubGVuZ3RoKSk7IH0NCiAgICB9KTsNCiAgICBvcHRpb24oInNwZWNpYWxDaGFycyIsIC9bXHUwMDAwLVx1MDAxZlx1MDA3Zi1cdTAwOWZcdTAwYWRcdTA2MWNcdTIwMGItXHUyMDBmXHUyMDI4XHUyMDI5XHVmZWZmXHVmZmY5LVx1ZmZmY10vZywgZnVuY3Rpb24gKGNtLCB2YWwsIG9sZCkgew0KICAgICAgY20uc3RhdGUuc3BlY2lhbENoYXJzID0gbmV3IFJlZ0V4cCh2YWwuc291cmNlICsgKHZhbC50ZXN0KCJcdCIpID8gIiIgOiAifFx0IiksICJnIik7DQogICAgICBpZiAob2xkICE9IEluaXQpIHsgY20ucmVmcmVzaCgpOyB9DQogICAgfSk7DQogICAgb3B0aW9uKCJzcGVjaWFsQ2hhclBsYWNlaG9sZGVyIiwgZGVmYXVsdFNwZWNpYWxDaGFyUGxhY2Vob2xkZXIsIGZ1bmN0aW9uIChjbSkgeyByZXR1cm4gY20ucmVmcmVzaCgpOyB9LCB0cnVlKTsNCiAgICBvcHRpb24oImVsZWN0cmljQ2hhcnMiLCB0cnVlKTsNCiAgICBvcHRpb24oImlucHV0U3R5bGUiLCBtb2JpbGUgPyAiY29udGVudGVkaXRhYmxlIiA6ICJ0ZXh0YXJlYSIsIGZ1bmN0aW9uICgpIHsNCiAgICAgIHRocm93IG5ldyBFcnJvcigiaW5wdXRTdHlsZSBjYW4gbm90ICh5ZXQpIGJlIGNoYW5nZWQgaW4gYSBydW5uaW5nIGVkaXRvciIpIC8vIEZJWE1FDQogICAgfSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJzcGVsbGNoZWNrIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7IHJldHVybiBjbS5nZXRJbnB1dEZpZWxkKCkuc3BlbGxjaGVjayA9IHZhbDsgfSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJhdXRvY29ycmVjdCIsIGZhbHNlLCBmdW5jdGlvbiAoY20sIHZhbCkgeyByZXR1cm4gY20uZ2V0SW5wdXRGaWVsZCgpLmF1dG9jb3JyZWN0ID0gdmFsOyB9LCB0cnVlKTsNCiAgICBvcHRpb24oImF1dG9jYXBpdGFsaXplIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7IHJldHVybiBjbS5nZXRJbnB1dEZpZWxkKCkuYXV0b2NhcGl0YWxpemUgPSB2YWw7IH0sIHRydWUpOw0KICAgIG9wdGlvbigicnRsTW92ZVZpc3VhbGx5IiwgIXdpbmRvd3MpOw0KICAgIG9wdGlvbigid2hvbGVMaW5lVXBkYXRlQmVmb3JlIiwgdHJ1ZSk7DQoNCiAgICBvcHRpb24oInRoZW1lIiwgImRlZmF1bHQiLCBmdW5jdGlvbiAoY20pIHsNCiAgICAgIHRoZW1lQ2hhbmdlZChjbSk7DQogICAgICB1cGRhdGVHdXR0ZXJzKGNtKTsNCiAgICB9LCB0cnVlKTsNCiAgICBvcHRpb24oImtleU1hcCIsICJkZWZhdWx0IiwgZnVuY3Rpb24gKGNtLCB2YWwsIG9sZCkgew0KICAgICAgdmFyIG5leHQgPSBnZXRLZXlNYXAodmFsKTsNCiAgICAgIHZhciBwcmV2ID0gb2xkICE9IEluaXQgJiYgZ2V0S2V5TWFwKG9sZCk7DQogICAgICBpZiAocHJldiAmJiBwcmV2LmRldGFjaCkgeyBwcmV2LmRldGFjaChjbSwgbmV4dCk7IH0NCiAgICAgIGlmIChuZXh0LmF0dGFjaCkgeyBuZXh0LmF0dGFjaChjbSwgcHJldiB8fCBudWxsKTsgfQ0KICAgIH0pOw0KICAgIG9wdGlvbigiZXh0cmFLZXlzIiwgbnVsbCk7DQogICAgb3B0aW9uKCJjb25maWd1cmVNb3VzZSIsIG51bGwpOw0KDQogICAgb3B0aW9uKCJsaW5lV3JhcHBpbmciLCBmYWxzZSwgd3JhcHBpbmdDaGFuZ2VkLCB0cnVlKTsNCiAgICBvcHRpb24oImd1dHRlcnMiLCBbXSwgZnVuY3Rpb24gKGNtLCB2YWwpIHsNCiAgICAgIGNtLmRpc3BsYXkuZ3V0dGVyU3BlY3MgPSBnZXRHdXR0ZXJzKHZhbCwgY20ub3B0aW9ucy5saW5lTnVtYmVycyk7DQogICAgICB1cGRhdGVHdXR0ZXJzKGNtKTsNCiAgICB9LCB0cnVlKTsNCiAgICBvcHRpb24oImZpeGVkR3V0dGVyIiwgdHJ1ZSwgZnVuY3Rpb24gKGNtLCB2YWwpIHsNCiAgICAgIGNtLmRpc3BsYXkuZ3V0dGVycy5zdHlsZS5sZWZ0ID0gdmFsID8gY29tcGVuc2F0ZUZvckhTY3JvbGwoY20uZGlzcGxheSkgKyAicHgiIDogIjAiOw0KICAgICAgY20ucmVmcmVzaCgpOw0KICAgIH0sIHRydWUpOw0KICAgIG9wdGlvbigiY292ZXJHdXR0ZXJOZXh0VG9TY3JvbGxiYXIiLCBmYWxzZSwgZnVuY3Rpb24gKGNtKSB7IHJldHVybiB1cGRhdGVTY3JvbGxiYXJzKGNtKTsgfSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJzY3JvbGxiYXJTdHlsZSIsICJuYXRpdmUiLCBmdW5jdGlvbiAoY20pIHsNCiAgICAgIGluaXRTY3JvbGxiYXJzKGNtKTsNCiAgICAgIHVwZGF0ZVNjcm9sbGJhcnMoY20pOw0KICAgICAgY20uZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcChjbS5kb2Muc2Nyb2xsVG9wKTsNCiAgICAgIGNtLmRpc3BsYXkuc2Nyb2xsYmFycy5zZXRTY3JvbGxMZWZ0KGNtLmRvYy5zY3JvbGxMZWZ0KTsNCiAgICB9LCB0cnVlKTsNCiAgICBvcHRpb24oImxpbmVOdW1iZXJzIiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7DQogICAgICBjbS5kaXNwbGF5Lmd1dHRlclNwZWNzID0gZ2V0R3V0dGVycyhjbS5vcHRpb25zLmd1dHRlcnMsIHZhbCk7DQogICAgICB1cGRhdGVHdXR0ZXJzKGNtKTsNCiAgICB9LCB0cnVlKTsNCiAgICBvcHRpb24oImZpcnN0TGluZU51bWJlciIsIDEsIHVwZGF0ZUd1dHRlcnMsIHRydWUpOw0KICAgIG9wdGlvbigibGluZU51bWJlckZvcm1hdHRlciIsIGZ1bmN0aW9uIChpbnRlZ2VyKSB7IHJldHVybiBpbnRlZ2VyOyB9LCB1cGRhdGVHdXR0ZXJzLCB0cnVlKTsNCiAgICBvcHRpb24oInNob3dDdXJzb3JXaGVuU2VsZWN0aW5nIiwgZmFsc2UsIHVwZGF0ZVNlbGVjdGlvbiwgdHJ1ZSk7DQoNCiAgICBvcHRpb24oInJlc2V0U2VsZWN0aW9uT25Db250ZXh0TWVudSIsIHRydWUpOw0KICAgIG9wdGlvbigibGluZVdpc2VDb3B5Q3V0IiwgdHJ1ZSk7DQogICAgb3B0aW9uKCJwYXN0ZUxpbmVzUGVyU2VsZWN0aW9uIiwgdHJ1ZSk7DQogICAgb3B0aW9uKCJzZWxlY3Rpb25zTWF5VG91Y2giLCBmYWxzZSk7DQoNCiAgICBvcHRpb24oInJlYWRPbmx5IiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7DQogICAgICBpZiAodmFsID09ICJub2N1cnNvciIpIHsNCiAgICAgICAgb25CbHVyKGNtKTsNCiAgICAgICAgY20uZGlzcGxheS5pbnB1dC5ibHVyKCk7DQogICAgICB9DQogICAgICBjbS5kaXNwbGF5LmlucHV0LnJlYWRPbmx5Q2hhbmdlZCh2YWwpOw0KICAgIH0pOw0KDQogICAgb3B0aW9uKCJzY3JlZW5SZWFkZXJMYWJlbCIsIG51bGwsIGZ1bmN0aW9uIChjbSwgdmFsKSB7DQogICAgICB2YWwgPSAodmFsID09PSAnJykgPyBudWxsIDogdmFsOw0KICAgICAgY20uZGlzcGxheS5pbnB1dC5zY3JlZW5SZWFkZXJMYWJlbENoYW5nZWQodmFsKTsNCiAgICB9KTsNCg0KICAgIG9wdGlvbigiZGlzYWJsZUlucHV0IiwgZmFsc2UsIGZ1bmN0aW9uIChjbSwgdmFsKSB7aWYgKCF2YWwpIHsgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpOyB9fSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJkcmFnRHJvcCIsIHRydWUsIGRyYWdEcm9wQ2hhbmdlZCk7DQogICAgb3B0aW9uKCJhbGxvd0Ryb3BGaWxlVHlwZXMiLCBudWxsKTsNCg0KICAgIG9wdGlvbigiY3Vyc29yQmxpbmtSYXRlIiwgNTMwKTsNCiAgICBvcHRpb24oImN1cnNvclNjcm9sbE1hcmdpbiIsIDApOw0KICAgIG9wdGlvbigiY3Vyc29ySGVpZ2h0IiwgMSwgdXBkYXRlU2VsZWN0aW9uLCB0cnVlKTsNCiAgICBvcHRpb24oInNpbmdsZUN1cnNvckhlaWdodFBlckxpbmUiLCB0cnVlLCB1cGRhdGVTZWxlY3Rpb24sIHRydWUpOw0KICAgIG9wdGlvbigid29ya1RpbWUiLCAxMDApOw0KICAgIG9wdGlvbigid29ya0RlbGF5IiwgMTAwKTsNCiAgICBvcHRpb24oImZsYXR0ZW5TcGFucyIsIHRydWUsIHJlc2V0TW9kZVN0YXRlLCB0cnVlKTsNCiAgICBvcHRpb24oImFkZE1vZGVDbGFzcyIsIGZhbHNlLCByZXNldE1vZGVTdGF0ZSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJwb2xsSW50ZXJ2YWwiLCAxMDApOw0KICAgIG9wdGlvbigidW5kb0RlcHRoIiwgMjAwLCBmdW5jdGlvbiAoY20sIHZhbCkgeyByZXR1cm4gY20uZG9jLmhpc3RvcnkudW5kb0RlcHRoID0gdmFsOyB9KTsNCiAgICBvcHRpb24oImhpc3RvcnlFdmVudERlbGF5IiwgMTI1MCk7DQogICAgb3B0aW9uKCJ2aWV3cG9ydE1hcmdpbiIsIDEwLCBmdW5jdGlvbiAoY20pIHsgcmV0dXJuIGNtLnJlZnJlc2goKTsgfSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJtYXhIaWdobGlnaHRMZW5ndGgiLCAxMDAwMCwgcmVzZXRNb2RlU3RhdGUsIHRydWUpOw0KICAgIG9wdGlvbigibW92ZUlucHV0V2l0aEN1cnNvciIsIHRydWUsIGZ1bmN0aW9uIChjbSwgdmFsKSB7DQogICAgICBpZiAoIXZhbCkgeyBjbS5kaXNwbGF5LmlucHV0LnJlc2V0UG9zaXRpb24oKTsgfQ0KICAgIH0pOw0KDQogICAgb3B0aW9uKCJ0YWJpbmRleCIsIG51bGwsIGZ1bmN0aW9uIChjbSwgdmFsKSB7IHJldHVybiBjbS5kaXNwbGF5LmlucHV0LmdldEZpZWxkKCkudGFiSW5kZXggPSB2YWwgfHwgIiI7IH0pOw0KICAgIG9wdGlvbigiYXV0b2ZvY3VzIiwgbnVsbCk7DQogICAgb3B0aW9uKCJkaXJlY3Rpb24iLCAibHRyIiwgZnVuY3Rpb24gKGNtLCB2YWwpIHsgcmV0dXJuIGNtLmRvYy5zZXREaXJlY3Rpb24odmFsKTsgfSwgdHJ1ZSk7DQogICAgb3B0aW9uKCJwaHJhc2VzIiwgbnVsbCk7DQogIH0NCg0KICBmdW5jdGlvbiBkcmFnRHJvcENoYW5nZWQoY20sIHZhbHVlLCBvbGQpIHsNCiAgICB2YXIgd2FzT24gPSBvbGQgJiYgb2xkICE9IEluaXQ7DQogICAgaWYgKCF2YWx1ZSAhPSAhd2FzT24pIHsNCiAgICAgIHZhciBmdW5jcyA9IGNtLmRpc3BsYXkuZHJhZ0Z1bmN0aW9uczsNCiAgICAgIHZhciB0b2dnbGUgPSB2YWx1ZSA/IG9uIDogb2ZmOw0KICAgICAgdG9nZ2xlKGNtLmRpc3BsYXkuc2Nyb2xsZXIsICJkcmFnc3RhcnQiLCBmdW5jcy5zdGFydCk7DQogICAgICB0b2dnbGUoY20uZGlzcGxheS5zY3JvbGxlciwgImRyYWdlbnRlciIsIGZ1bmNzLmVudGVyKTsNCiAgICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCAiZHJhZ292ZXIiLCBmdW5jcy5vdmVyKTsNCiAgICAgIHRvZ2dsZShjbS5kaXNwbGF5LnNjcm9sbGVyLCAiZHJhZ2xlYXZlIiwgZnVuY3MubGVhdmUpOw0KICAgICAgdG9nZ2xlKGNtLmRpc3BsYXkuc2Nyb2xsZXIsICJkcm9wIiwgZnVuY3MuZHJvcCk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gd3JhcHBpbmdDaGFuZ2VkKGNtKSB7DQogICAgaWYgKGNtLm9wdGlvbnMubGluZVdyYXBwaW5nKSB7DQogICAgICBhZGRDbGFzcyhjbS5kaXNwbGF5LndyYXBwZXIsICJDb2RlTWlycm9yLXdyYXAiKTsNCiAgICAgIGNtLmRpc3BsYXkuc2l6ZXIuc3R5bGUubWluV2lkdGggPSAiIjsNCiAgICAgIGNtLmRpc3BsYXkuc2l6ZXJXaWR0aCA9IG51bGw7DQogICAgfSBlbHNlIHsNCiAgICAgIHJtQ2xhc3MoY20uZGlzcGxheS53cmFwcGVyLCAiQ29kZU1pcnJvci13cmFwIik7DQogICAgICBmaW5kTWF4TGluZShjbSk7DQogICAgfQ0KICAgIGVzdGltYXRlTGluZUhlaWdodHMoY20pOw0KICAgIHJlZ0NoYW5nZShjbSk7DQogICAgY2xlYXJDYWNoZXMoY20pOw0KICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gdXBkYXRlU2Nyb2xsYmFycyhjbSk7IH0sIDEwMCk7DQogIH0NCg0KICAvLyBBIENvZGVNaXJyb3IgaW5zdGFuY2UgcmVwcmVzZW50cyBhbiBlZGl0b3IuIFRoaXMgaXMgdGhlIG9iamVjdA0KICAvLyB0aGF0IHVzZXIgY29kZSBpcyB1c3VhbGx5IGRlYWxpbmcgd2l0aC4NCg0KICBmdW5jdGlvbiBDb2RlTWlycm9yKHBsYWNlLCBvcHRpb25zKSB7DQogICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICBpZiAoISh0aGlzIGluc3RhbmNlb2YgQ29kZU1pcnJvcikpIHsgcmV0dXJuIG5ldyBDb2RlTWlycm9yKHBsYWNlLCBvcHRpb25zKSB9DQoNCiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zID0gb3B0aW9ucyA/IGNvcHlPYmoob3B0aW9ucykgOiB7fTsNCiAgICAvLyBEZXRlcm1pbmUgZWZmZWN0aXZlIG9wdGlvbnMgYmFzZWQgb24gZ2l2ZW4gdmFsdWVzIGFuZCBkZWZhdWx0cy4NCiAgICBjb3B5T2JqKGRlZmF1bHRzLCBvcHRpb25zLCBmYWxzZSk7DQoNCiAgICB2YXIgZG9jID0gb3B0aW9ucy52YWx1ZTsNCiAgICBpZiAodHlwZW9mIGRvYyA9PSAic3RyaW5nIikgeyBkb2MgPSBuZXcgRG9jKGRvYywgb3B0aW9ucy5tb2RlLCBudWxsLCBvcHRpb25zLmxpbmVTZXBhcmF0b3IsIG9wdGlvbnMuZGlyZWN0aW9uKTsgfQ0KICAgIGVsc2UgaWYgKG9wdGlvbnMubW9kZSkgeyBkb2MubW9kZU9wdGlvbiA9IG9wdGlvbnMubW9kZTsgfQ0KICAgIHRoaXMuZG9jID0gZG9jOw0KDQogICAgdmFyIGlucHV0ID0gbmV3IENvZGVNaXJyb3IuaW5wdXRTdHlsZXNbb3B0aW9ucy5pbnB1dFN0eWxlXSh0aGlzKTsNCiAgICB2YXIgZGlzcGxheSA9IHRoaXMuZGlzcGxheSA9IG5ldyBEaXNwbGF5KHBsYWNlLCBkb2MsIGlucHV0LCBvcHRpb25zKTsNCiAgICBkaXNwbGF5LndyYXBwZXIuQ29kZU1pcnJvciA9IHRoaXM7DQogICAgdGhlbWVDaGFuZ2VkKHRoaXMpOw0KICAgIGlmIChvcHRpb25zLmxpbmVXcmFwcGluZykNCiAgICAgIHsgdGhpcy5kaXNwbGF5LndyYXBwZXIuY2xhc3NOYW1lICs9ICIgQ29kZU1pcnJvci13cmFwIjsgfQ0KICAgIGluaXRTY3JvbGxiYXJzKHRoaXMpOw0KDQogICAgdGhpcy5zdGF0ZSA9IHsNCiAgICAgIGtleU1hcHM6IFtdLCAgLy8gc3RvcmVzIG1hcHMgYWRkZWQgYnkgYWRkS2V5TWFwDQogICAgICBvdmVybGF5czogW10sIC8vIGhpZ2hsaWdodGluZyBvdmVybGF5cywgYXMgYWRkZWQgYnkgYWRkT3ZlcmxheQ0KICAgICAgbW9kZUdlbjogMCwgICAvLyBidW1wZWQgd2hlbiBtb2RlL292ZXJsYXkgY2hhbmdlcywgdXNlZCB0byBpbnZhbGlkYXRlIGhpZ2hsaWdodGluZyBpbmZvDQogICAgICBvdmVyd3JpdGU6IGZhbHNlLA0KICAgICAgZGVsYXlpbmdCbHVyRXZlbnQ6IGZhbHNlLA0KICAgICAgZm9jdXNlZDogZmFsc2UsDQogICAgICBzdXBwcmVzc0VkaXRzOiBmYWxzZSwgLy8gdXNlZCB0byBkaXNhYmxlIGVkaXRpbmcgZHVyaW5nIGtleSBoYW5kbGVycyB3aGVuIGluIHJlYWRPbmx5IG1vZGUNCiAgICAgIHBhc3RlSW5jb21pbmc6IC0xLCBjdXRJbmNvbWluZzogLTEsIC8vIGhlbHAgcmVjb2duaXplIHBhc3RlL2N1dCBlZGl0cyBpbiBpbnB1dC5wb2xsDQogICAgICBzZWxlY3RpbmdUZXh0OiBmYWxzZSwNCiAgICAgIGRyYWdnaW5nVGV4dDogZmFsc2UsDQogICAgICBoaWdobGlnaHQ6IG5ldyBEZWxheWVkKCksIC8vIHN0b3JlcyBoaWdobGlnaHQgd29ya2VyIHRpbWVvdXQNCiAgICAgIGtleVNlcTogbnVsbCwgIC8vIFVuZmluaXNoZWQga2V5IHNlcXVlbmNlDQogICAgICBzcGVjaWFsQ2hhcnM6IG51bGwNCiAgICB9Ow0KDQogICAgaWYgKG9wdGlvbnMuYXV0b2ZvY3VzICYmICFtb2JpbGUpIHsgZGlzcGxheS5pbnB1dC5mb2N1cygpOyB9DQoNCiAgICAvLyBPdmVycmlkZSBtYWdpYyB0ZXh0YXJlYSBjb250ZW50IHJlc3RvcmUgdGhhdCBJRSBzb21ldGltZXMgZG9lcw0KICAgIC8vIG9uIG91ciBoaWRkZW4gdGV4dGFyZWEgb24gcmVsb2FkDQogICAgaWYgKGllICYmIGllX3ZlcnNpb24gPCAxMSkgeyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMkMS5kaXNwbGF5LmlucHV0LnJlc2V0KHRydWUpOyB9LCAyMCk7IH0NCg0KICAgIHJlZ2lzdGVyRXZlbnRIYW5kbGVycyh0aGlzKTsNCiAgICBlbnN1cmVHbG9iYWxIYW5kbGVycygpOw0KDQogICAgc3RhcnRPcGVyYXRpb24odGhpcyk7DQogICAgdGhpcy5jdXJPcC5mb3JjZVVwZGF0ZSA9IHRydWU7DQogICAgYXR0YWNoRG9jKHRoaXMsIGRvYyk7DQoNCiAgICBpZiAoKG9wdGlvbnMuYXV0b2ZvY3VzICYmICFtb2JpbGUpIHx8IHRoaXMuaGFzRm9jdXMoKSkNCiAgICAgIHsgc2V0VGltZW91dChiaW5kKG9uRm9jdXMsIHRoaXMpLCAyMCk7IH0NCiAgICBlbHNlDQogICAgICB7IG9uQmx1cih0aGlzKTsgfQ0KDQogICAgZm9yICh2YXIgb3B0IGluIG9wdGlvbkhhbmRsZXJzKSB7IGlmIChvcHRpb25IYW5kbGVycy5oYXNPd25Qcm9wZXJ0eShvcHQpKQ0KICAgICAgeyBvcHRpb25IYW5kbGVyc1tvcHRdKHRoaXMkMSwgb3B0aW9uc1tvcHRdLCBJbml0KTsgfSB9DQogICAgbWF5YmVVcGRhdGVMaW5lTnVtYmVyV2lkdGgodGhpcyk7DQogICAgaWYgKG9wdGlvbnMuZmluaXNoSW5pdCkgeyBvcHRpb25zLmZpbmlzaEluaXQodGhpcyk7IH0NCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGluaXRIb29rcy5sZW5ndGg7ICsraSkgeyBpbml0SG9va3NbaV0odGhpcyQxKTsgfQ0KICAgIGVuZE9wZXJhdGlvbih0aGlzKTsNCiAgICAvLyBTdXBwcmVzcyBvcHRpbWl6ZWxlZ2liaWxpdHkgaW4gV2Via2l0LCBzaW5jZSBpdCBicmVha3MgdGV4dA0KICAgIC8vIG1lYXN1cmluZyBvbiBsaW5lIHdyYXBwaW5nIGJvdW5kYXJpZXMuDQogICAgaWYgKHdlYmtpdCAmJiBvcHRpb25zLmxpbmVXcmFwcGluZyAmJg0KICAgICAgICBnZXRDb21wdXRlZFN0eWxlKGRpc3BsYXkubGluZURpdikudGV4dFJlbmRlcmluZyA9PSAib3B0aW1pemVsZWdpYmlsaXR5IikNCiAgICAgIHsgZGlzcGxheS5saW5lRGl2LnN0eWxlLnRleHRSZW5kZXJpbmcgPSAiYXV0byI7IH0NCiAgfQ0KDQogIC8vIFRoZSBkZWZhdWx0IGNvbmZpZ3VyYXRpb24gb3B0aW9ucy4NCiAgQ29kZU1pcnJvci5kZWZhdWx0cyA9IGRlZmF1bHRzOw0KICAvLyBGdW5jdGlvbnMgdG8gcnVuIHdoZW4gb3B0aW9ucyBhcmUgY2hhbmdlZC4NCiAgQ29kZU1pcnJvci5vcHRpb25IYW5kbGVycyA9IG9wdGlvbkhhbmRsZXJzOw0KDQogIC8vIEF0dGFjaCB0aGUgbmVjZXNzYXJ5IGV2ZW50IGhhbmRsZXJzIHdoZW4gaW5pdGlhbGl6aW5nIHRoZSBlZGl0b3INCiAgZnVuY3Rpb24gcmVnaXN0ZXJFdmVudEhhbmRsZXJzKGNtKSB7DQogICAgdmFyIGQgPSBjbS5kaXNwbGF5Ow0KICAgIG9uKGQuc2Nyb2xsZXIsICJtb3VzZWRvd24iLCBvcGVyYXRpb24oY20sIG9uTW91c2VEb3duKSk7DQogICAgLy8gT2xkZXIgSUUncyB3aWxsIG5vdCBmaXJlIGEgc2Vjb25kIG1vdXNlZG93biBmb3IgYSBkb3VibGUgY2xpY2sNCiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDExKQ0KICAgICAgeyBvbihkLnNjcm9sbGVyLCAiZGJsY2xpY2siLCBvcGVyYXRpb24oY20sIGZ1bmN0aW9uIChlKSB7DQogICAgICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkpIHsgcmV0dXJuIH0NCiAgICAgICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSk7DQogICAgICAgIGlmICghcG9zIHx8IGNsaWNrSW5HdXR0ZXIoY20sIGUpIHx8IGV2ZW50SW5XaWRnZXQoY20uZGlzcGxheSwgZSkpIHsgcmV0dXJuIH0NCiAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlKTsNCiAgICAgICAgdmFyIHdvcmQgPSBjbS5maW5kV29yZEF0KHBvcyk7DQogICAgICAgIGV4dGVuZFNlbGVjdGlvbihjbS5kb2MsIHdvcmQuYW5jaG9yLCB3b3JkLmhlYWQpOw0KICAgICAgfSkpOyB9DQogICAgZWxzZQ0KICAgICAgeyBvbihkLnNjcm9sbGVyLCAiZGJsY2xpY2siLCBmdW5jdGlvbiAoZSkgeyByZXR1cm4gc2lnbmFsRE9NRXZlbnQoY20sIGUpIHx8IGVfcHJldmVudERlZmF1bHQoZSk7IH0pOyB9DQogICAgLy8gU29tZSBicm93c2VycyBmaXJlIGNvbnRleHRtZW51ICphZnRlciogb3BlbmluZyB0aGUgbWVudSwgYXQNCiAgICAvLyB3aGljaCBwb2ludCB3ZSBjYW4ndCBtZXNzIHdpdGggaXQgYW55bW9yZS4gQ29udGV4dCBtZW51IGlzDQogICAgLy8gaGFuZGxlZCBpbiBvbk1vdXNlRG93biBmb3IgdGhlc2UgYnJvd3NlcnMuDQogICAgb24oZC5zY3JvbGxlciwgImNvbnRleHRtZW51IiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uQ29udGV4dE1lbnUoY20sIGUpOyB9KTsNCiAgICBvbihkLmlucHV0LmdldEZpZWxkKCksICJjb250ZXh0bWVudSIsIGZ1bmN0aW9uIChlKSB7DQogICAgICBpZiAoIWQuc2Nyb2xsZXIuY29udGFpbnMoZS50YXJnZXQpKSB7IG9uQ29udGV4dE1lbnUoY20sIGUpOyB9DQogICAgfSk7DQoNCiAgICAvLyBVc2VkIHRvIHN1cHByZXNzIG1vdXNlIGV2ZW50IGhhbmRsaW5nIHdoZW4gYSB0b3VjaCBoYXBwZW5zDQogICAgdmFyIHRvdWNoRmluaXNoZWQsIHByZXZUb3VjaCA9IHtlbmQ6IDB9Ow0KICAgIGZ1bmN0aW9uIGZpbmlzaFRvdWNoKCkgew0KICAgICAgaWYgKGQuYWN0aXZlVG91Y2gpIHsNCiAgICAgICAgdG91Y2hGaW5pc2hlZCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgeyByZXR1cm4gZC5hY3RpdmVUb3VjaCA9IG51bGw7IH0sIDEwMDApOw0KICAgICAgICBwcmV2VG91Y2ggPSBkLmFjdGl2ZVRvdWNoOw0KICAgICAgICBwcmV2VG91Y2guZW5kID0gK25ldyBEYXRlOw0KICAgICAgfQ0KICAgIH0NCiAgICBmdW5jdGlvbiBpc01vdXNlTGlrZVRvdWNoRXZlbnQoZSkgew0KICAgICAgaWYgKGUudG91Y2hlcy5sZW5ndGggIT0gMSkgeyByZXR1cm4gZmFsc2UgfQ0KICAgICAgdmFyIHRvdWNoID0gZS50b3VjaGVzWzBdOw0KICAgICAgcmV0dXJuIHRvdWNoLnJhZGl1c1ggPD0gMSAmJiB0b3VjaC5yYWRpdXNZIDw9IDENCiAgICB9DQogICAgZnVuY3Rpb24gZmFyQXdheSh0b3VjaCwgb3RoZXIpIHsNCiAgICAgIGlmIChvdGhlci5sZWZ0ID09IG51bGwpIHsgcmV0dXJuIHRydWUgfQ0KICAgICAgdmFyIGR4ID0gb3RoZXIubGVmdCAtIHRvdWNoLmxlZnQsIGR5ID0gb3RoZXIudG9wIC0gdG91Y2gudG9wOw0KICAgICAgcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5ID4gMjAgKiAyMA0KICAgIH0NCiAgICBvbihkLnNjcm9sbGVyLCAidG91Y2hzdGFydCIsIGZ1bmN0aW9uIChlKSB7DQogICAgICBpZiAoIXNpZ25hbERPTUV2ZW50KGNtLCBlKSAmJiAhaXNNb3VzZUxpa2VUb3VjaEV2ZW50KGUpICYmICFjbGlja0luR3V0dGVyKGNtLCBlKSkgew0KICAgICAgICBkLmlucHV0LmVuc3VyZVBvbGxlZCgpOw0KICAgICAgICBjbGVhclRpbWVvdXQodG91Y2hGaW5pc2hlZCk7DQogICAgICAgIHZhciBub3cgPSArbmV3IERhdGU7DQogICAgICAgIGQuYWN0aXZlVG91Y2ggPSB7c3RhcnQ6IG5vdywgbW92ZWQ6IGZhbHNlLA0KICAgICAgICAgICAgICAgICAgICAgICAgIHByZXY6IG5vdyAtIHByZXZUb3VjaC5lbmQgPD0gMzAwID8gcHJldlRvdWNoIDogbnVsbH07DQogICAgICAgIGlmIChlLnRvdWNoZXMubGVuZ3RoID09IDEpIHsNCiAgICAgICAgICBkLmFjdGl2ZVRvdWNoLmxlZnQgPSBlLnRvdWNoZXNbMF0ucGFnZVg7DQogICAgICAgICAgZC5hY3RpdmVUb3VjaC50b3AgPSBlLnRvdWNoZXNbMF0ucGFnZVk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9KTsNCiAgICBvbihkLnNjcm9sbGVyLCAidG91Y2htb3ZlIiwgZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKGQuYWN0aXZlVG91Y2gpIHsgZC5hY3RpdmVUb3VjaC5tb3ZlZCA9IHRydWU7IH0NCiAgICB9KTsNCiAgICBvbihkLnNjcm9sbGVyLCAidG91Y2hlbmQiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgdmFyIHRvdWNoID0gZC5hY3RpdmVUb3VjaDsNCiAgICAgIGlmICh0b3VjaCAmJiAhZXZlbnRJbldpZGdldChkLCBlKSAmJiB0b3VjaC5sZWZ0ICE9IG51bGwgJiYNCiAgICAgICAgICAhdG91Y2gubW92ZWQgJiYgbmV3IERhdGUgLSB0b3VjaC5zdGFydCA8IDMwMCkgew0KICAgICAgICB2YXIgcG9zID0gY20uY29vcmRzQ2hhcihkLmFjdGl2ZVRvdWNoLCAicGFnZSIpLCByYW5nZTsNCiAgICAgICAgaWYgKCF0b3VjaC5wcmV2IHx8IGZhckF3YXkodG91Y2gsIHRvdWNoLnByZXYpKSAvLyBTaW5nbGUgdGFwDQogICAgICAgICAgeyByYW5nZSA9IG5ldyBSYW5nZShwb3MsIHBvcyk7IH0NCiAgICAgICAgZWxzZSBpZiAoIXRvdWNoLnByZXYucHJldiB8fCBmYXJBd2F5KHRvdWNoLCB0b3VjaC5wcmV2LnByZXYpKSAvLyBEb3VibGUgdGFwDQogICAgICAgICAgeyByYW5nZSA9IGNtLmZpbmRXb3JkQXQocG9zKTsgfQ0KICAgICAgICBlbHNlIC8vIFRyaXBsZSB0YXANCiAgICAgICAgICB7IHJhbmdlID0gbmV3IFJhbmdlKFBvcyhwb3MubGluZSwgMCksIGNsaXBQb3MoY20uZG9jLCBQb3MocG9zLmxpbmUgKyAxLCAwKSkpOyB9DQogICAgICAgIGNtLnNldFNlbGVjdGlvbihyYW5nZS5hbmNob3IsIHJhbmdlLmhlYWQpOw0KICAgICAgICBjbS5mb2N1cygpOw0KICAgICAgICBlX3ByZXZlbnREZWZhdWx0KGUpOw0KICAgICAgfQ0KICAgICAgZmluaXNoVG91Y2goKTsNCiAgICB9KTsNCiAgICBvbihkLnNjcm9sbGVyLCAidG91Y2hjYW5jZWwiLCBmaW5pc2hUb3VjaCk7DQoNCiAgICAvLyBTeW5jIHNjcm9sbGluZyBiZXR3ZWVuIGZha2Ugc2Nyb2xsYmFycyBhbmQgcmVhbCBzY3JvbGxhYmxlDQogICAgLy8gYXJlYSwgZW5zdXJlIHZpZXdwb3J0IGlzIHVwZGF0ZWQgd2hlbiBzY3JvbGxpbmcuDQogICAgb24oZC5zY3JvbGxlciwgInNjcm9sbCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmIChkLnNjcm9sbGVyLmNsaWVudEhlaWdodCkgew0KICAgICAgICB1cGRhdGVTY3JvbGxUb3AoY20sIGQuc2Nyb2xsZXIuc2Nyb2xsVG9wKTsNCiAgICAgICAgc2V0U2Nyb2xsTGVmdChjbSwgZC5zY3JvbGxlci5zY3JvbGxMZWZ0LCB0cnVlKTsNCiAgICAgICAgc2lnbmFsKGNtLCAic2Nyb2xsIiwgY20pOw0KICAgICAgfQ0KICAgIH0pOw0KDQogICAgLy8gTGlzdGVuIHRvIHdoZWVsIGV2ZW50cyBpbiBvcmRlciB0byB0cnkgYW5kIHVwZGF0ZSB0aGUgdmlld3BvcnQgb24gdGltZS4NCiAgICBvbihkLnNjcm9sbGVyLCAibW91c2V3aGVlbCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvblNjcm9sbFdoZWVsKGNtLCBlKTsgfSk7DQogICAgb24oZC5zY3JvbGxlciwgIkRPTU1vdXNlU2Nyb2xsIiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uU2Nyb2xsV2hlZWwoY20sIGUpOyB9KTsNCg0KICAgIC8vIFByZXZlbnQgd3JhcHBlciBmcm9tIGV2ZXIgc2Nyb2xsaW5nDQogICAgb24oZC53cmFwcGVyLCAic2Nyb2xsIiwgZnVuY3Rpb24gKCkgeyByZXR1cm4gZC53cmFwcGVyLnNjcm9sbFRvcCA9IGQud3JhcHBlci5zY3JvbGxMZWZ0ID0gMDsgfSk7DQoNCiAgICBkLmRyYWdGdW5jdGlvbnMgPSB7DQogICAgICBlbnRlcjogZnVuY3Rpb24gKGUpIHtpZiAoIXNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyBlX3N0b3AoZSk7IH19LA0KICAgICAgb3ZlcjogZnVuY3Rpb24gKGUpIHtpZiAoIXNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyBvbkRyYWdPdmVyKGNtLCBlKTsgZV9zdG9wKGUpOyB9fSwNCiAgICAgIHN0YXJ0OiBmdW5jdGlvbiAoZSkgeyByZXR1cm4gb25EcmFnU3RhcnQoY20sIGUpOyB9LA0KICAgICAgZHJvcDogb3BlcmF0aW9uKGNtLCBvbkRyb3ApLA0KICAgICAgbGVhdmU6IGZ1bmN0aW9uIChlKSB7aWYgKCFzaWduYWxET01FdmVudChjbSwgZSkpIHsgY2xlYXJEcmFnQ3Vyc29yKGNtKTsgfX0NCiAgICB9Ow0KDQogICAgdmFyIGlucCA9IGQuaW5wdXQuZ2V0RmllbGQoKTsNCiAgICBvbihpbnAsICJrZXl1cCIsIGZ1bmN0aW9uIChlKSB7IHJldHVybiBvbktleVVwLmNhbGwoY20sIGUpOyB9KTsNCiAgICBvbihpbnAsICJrZXlkb3duIiwgb3BlcmF0aW9uKGNtLCBvbktleURvd24pKTsNCiAgICBvbihpbnAsICJrZXlwcmVzcyIsIG9wZXJhdGlvbihjbSwgb25LZXlQcmVzcykpOw0KICAgIG9uKGlucCwgImZvY3VzIiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uRm9jdXMoY20sIGUpOyB9KTsNCiAgICBvbihpbnAsICJibHVyIiwgZnVuY3Rpb24gKGUpIHsgcmV0dXJuIG9uQmx1cihjbSwgZSk7IH0pOw0KICB9DQoNCiAgdmFyIGluaXRIb29rcyA9IFtdOw0KICBDb2RlTWlycm9yLmRlZmluZUluaXRIb29rID0gZnVuY3Rpb24gKGYpIHsgcmV0dXJuIGluaXRIb29rcy5wdXNoKGYpOyB9Ow0KDQogIC8vIEluZGVudCB0aGUgZ2l2ZW4gbGluZS4gVGhlIGhvdyBwYXJhbWV0ZXIgY2FuIGJlICJzbWFydCIsDQogIC8vICJhZGQiL251bGwsICJzdWJ0cmFjdCIsIG9yICJwcmV2Ii4gV2hlbiBhZ2dyZXNzaXZlIGlzIGZhbHNlDQogIC8vICh0eXBpY2FsbHkgc2V0IHRvIHRydWUgZm9yIGZvcmNlZCBzaW5nbGUtbGluZSBpbmRlbnRzKSwgZW1wdHkNCiAgLy8gbGluZXMgYXJlIG5vdCBpbmRlbnRlZCwgYW5kIHBsYWNlcyB3aGVyZSB0aGUgbW9kZSByZXR1cm5zIFBhc3MNCiAgLy8gYXJlIGxlZnQgYWxvbmUuDQogIGZ1bmN0aW9uIGluZGVudExpbmUoY20sIG4sIGhvdywgYWdncmVzc2l2ZSkgew0KICAgIHZhciBkb2MgPSBjbS5kb2MsIHN0YXRlOw0KICAgIGlmIChob3cgPT0gbnVsbCkgeyBob3cgPSAiYWRkIjsgfQ0KICAgIGlmIChob3cgPT0gInNtYXJ0Iikgew0KICAgICAgLy8gRmFsbCBiYWNrIHRvICJwcmV2IiB3aGVuIHRoZSBtb2RlIGRvZXNuJ3QgaGF2ZSBhbiBpbmRlbnRhdGlvbg0KICAgICAgLy8gbWV0aG9kLg0KICAgICAgaWYgKCFkb2MubW9kZS5pbmRlbnQpIHsgaG93ID0gInByZXYiOyB9DQogICAgICBlbHNlIHsgc3RhdGUgPSBnZXRDb250ZXh0QmVmb3JlKGNtLCBuKS5zdGF0ZTsgfQ0KICAgIH0NCg0KICAgIHZhciB0YWJTaXplID0gY20ub3B0aW9ucy50YWJTaXplOw0KICAgIHZhciBsaW5lID0gZ2V0TGluZShkb2MsIG4pLCBjdXJTcGFjZSA9IGNvdW50Q29sdW1uKGxpbmUudGV4dCwgbnVsbCwgdGFiU2l6ZSk7DQogICAgaWYgKGxpbmUuc3RhdGVBZnRlcikgeyBsaW5lLnN0YXRlQWZ0ZXIgPSBudWxsOyB9DQogICAgdmFyIGN1clNwYWNlU3RyaW5nID0gbGluZS50ZXh0Lm1hdGNoKC9eXHMqLylbMF0sIGluZGVudGF0aW9uOw0KICAgIGlmICghYWdncmVzc2l2ZSAmJiAhL1xTLy50ZXN0KGxpbmUudGV4dCkpIHsNCiAgICAgIGluZGVudGF0aW9uID0gMDsNCiAgICAgIGhvdyA9ICJub3QiOw0KICAgIH0gZWxzZSBpZiAoaG93ID09ICJzbWFydCIpIHsNCiAgICAgIGluZGVudGF0aW9uID0gZG9jLm1vZGUuaW5kZW50KHN0YXRlLCBsaW5lLnRleHQuc2xpY2UoY3VyU3BhY2VTdHJpbmcubGVuZ3RoKSwgbGluZS50ZXh0KTsNCiAgICAgIGlmIChpbmRlbnRhdGlvbiA9PSBQYXNzIHx8IGluZGVudGF0aW9uID4gMTUwKSB7DQogICAgICAgIGlmICghYWdncmVzc2l2ZSkgeyByZXR1cm4gfQ0KICAgICAgICBob3cgPSAicHJldiI7DQogICAgICB9DQogICAgfQ0KICAgIGlmIChob3cgPT0gInByZXYiKSB7DQogICAgICBpZiAobiA+IGRvYy5maXJzdCkgeyBpbmRlbnRhdGlvbiA9IGNvdW50Q29sdW1uKGdldExpbmUoZG9jLCBuLTEpLnRleHQsIG51bGwsIHRhYlNpemUpOyB9DQogICAgICBlbHNlIHsgaW5kZW50YXRpb24gPSAwOyB9DQogICAgfSBlbHNlIGlmIChob3cgPT0gImFkZCIpIHsNCiAgICAgIGluZGVudGF0aW9uID0gY3VyU3BhY2UgKyBjbS5vcHRpb25zLmluZGVudFVuaXQ7DQogICAgfSBlbHNlIGlmIChob3cgPT0gInN1YnRyYWN0Iikgew0KICAgICAgaW5kZW50YXRpb24gPSBjdXJTcGFjZSAtIGNtLm9wdGlvbnMuaW5kZW50VW5pdDsNCiAgICB9IGVsc2UgaWYgKHR5cGVvZiBob3cgPT0gIm51bWJlciIpIHsNCiAgICAgIGluZGVudGF0aW9uID0gY3VyU3BhY2UgKyBob3c7DQogICAgfQ0KICAgIGluZGVudGF0aW9uID0gTWF0aC5tYXgoMCwgaW5kZW50YXRpb24pOw0KDQogICAgdmFyIGluZGVudFN0cmluZyA9ICIiLCBwb3MgPSAwOw0KICAgIGlmIChjbS5vcHRpb25zLmluZGVudFdpdGhUYWJzKQ0KICAgICAgeyBmb3IgKHZhciBpID0gTWF0aC5mbG9vcihpbmRlbnRhdGlvbiAvIHRhYlNpemUpOyBpOyAtLWkpIHtwb3MgKz0gdGFiU2l6ZTsgaW5kZW50U3RyaW5nICs9ICJcdCI7fSB9DQogICAgaWYgKHBvcyA8IGluZGVudGF0aW9uKSB7IGluZGVudFN0cmluZyArPSBzcGFjZVN0cihpbmRlbnRhdGlvbiAtIHBvcyk7IH0NCg0KICAgIGlmIChpbmRlbnRTdHJpbmcgIT0gY3VyU3BhY2VTdHJpbmcpIHsNCiAgICAgIHJlcGxhY2VSYW5nZShkb2MsIGluZGVudFN0cmluZywgUG9zKG4sIDApLCBQb3MobiwgY3VyU3BhY2VTdHJpbmcubGVuZ3RoKSwgIitpbnB1dCIpOw0KICAgICAgbGluZS5zdGF0ZUFmdGVyID0gbnVsbDsNCiAgICAgIHJldHVybiB0cnVlDQogICAgfSBlbHNlIHsNCiAgICAgIC8vIEVuc3VyZSB0aGF0LCBpZiB0aGUgY3Vyc29yIHdhcyBpbiB0aGUgd2hpdGVzcGFjZSBhdCB0aGUgc3RhcnQNCiAgICAgIC8vIG9mIHRoZSBsaW5lLCBpdCBpcyBtb3ZlZCB0byB0aGUgZW5kIG9mIHRoYXQgc3BhY2UuDQogICAgICBmb3IgKHZhciBpJDEgPSAwOyBpJDEgPCBkb2Muc2VsLnJhbmdlcy5sZW5ndGg7IGkkMSsrKSB7DQogICAgICAgIHZhciByYW5nZSA9IGRvYy5zZWwucmFuZ2VzW2kkMV07DQogICAgICAgIGlmIChyYW5nZS5oZWFkLmxpbmUgPT0gbiAmJiByYW5nZS5oZWFkLmNoIDwgY3VyU3BhY2VTdHJpbmcubGVuZ3RoKSB7DQogICAgICAgICAgdmFyIHBvcyQxID0gUG9zKG4sIGN1clNwYWNlU3RyaW5nLmxlbmd0aCk7DQogICAgICAgICAgcmVwbGFjZU9uZVNlbGVjdGlvbihkb2MsIGkkMSwgbmV3IFJhbmdlKHBvcyQxLCBwb3MkMSkpOw0KICAgICAgICAgIGJyZWFrDQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICAvLyBUaGlzIHdpbGwgYmUgc2V0IHRvIGEge2xpbmVXaXNlOiBib29sLCB0ZXh0OiBbc3RyaW5nXX0gb2JqZWN0LCBzbw0KICAvLyB0aGF0LCB3aGVuIHBhc3RpbmcsIHdlIGtub3cgd2hhdCBraW5kIG9mIHNlbGVjdGlvbnMgdGhlIGNvcGllZA0KICAvLyB0ZXh0IHdhcyBtYWRlIG91dCBvZi4NCiAgdmFyIGxhc3RDb3BpZWQgPSBudWxsOw0KDQogIGZ1bmN0aW9uIHNldExhc3RDb3BpZWQobmV3TGFzdENvcGllZCkgew0KICAgIGxhc3RDb3BpZWQgPSBuZXdMYXN0Q29waWVkOw0KICB9DQoNCiAgZnVuY3Rpb24gYXBwbHlUZXh0SW5wdXQoY20sIGluc2VydGVkLCBkZWxldGVkLCBzZWwsIG9yaWdpbikgew0KICAgIHZhciBkb2MgPSBjbS5kb2M7DQogICAgY20uZGlzcGxheS5zaGlmdCA9IGZhbHNlOw0KICAgIGlmICghc2VsKSB7IHNlbCA9IGRvYy5zZWw7IH0NCg0KICAgIHZhciByZWNlbnQgPSArbmV3IERhdGUgLSAyMDA7DQogICAgdmFyIHBhc3RlID0gb3JpZ2luID09ICJwYXN0ZSIgfHwgY20uc3RhdGUucGFzdGVJbmNvbWluZyA+IHJlY2VudDsNCiAgICB2YXIgdGV4dExpbmVzID0gc3BsaXRMaW5lc0F1dG8oaW5zZXJ0ZWQpLCBtdWx0aVBhc3RlID0gbnVsbDsNCiAgICAvLyBXaGVuIHBhc3RpbmcgTiBsaW5lcyBpbnRvIE4gc2VsZWN0aW9ucywgaW5zZXJ0IG9uZSBsaW5lIHBlciBzZWxlY3Rpb24NCiAgICBpZiAocGFzdGUgJiYgc2VsLnJhbmdlcy5sZW5ndGggPiAxKSB7DQogICAgICBpZiAobGFzdENvcGllZCAmJiBsYXN0Q29waWVkLnRleHQuam9pbigiXG4iKSA9PSBpbnNlcnRlZCkgew0KICAgICAgICBpZiAoc2VsLnJhbmdlcy5sZW5ndGggJSBsYXN0Q29waWVkLnRleHQubGVuZ3RoID09IDApIHsNCiAgICAgICAgICBtdWx0aVBhc3RlID0gW107DQogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsYXN0Q29waWVkLnRleHQubGVuZ3RoOyBpKyspDQogICAgICAgICAgICB7IG11bHRpUGFzdGUucHVzaChkb2Muc3BsaXRMaW5lcyhsYXN0Q29waWVkLnRleHRbaV0pKTsgfQ0KICAgICAgICB9DQogICAgICB9IGVsc2UgaWYgKHRleHRMaW5lcy5sZW5ndGggPT0gc2VsLnJhbmdlcy5sZW5ndGggJiYgY20ub3B0aW9ucy5wYXN0ZUxpbmVzUGVyU2VsZWN0aW9uKSB7DQogICAgICAgIG11bHRpUGFzdGUgPSBtYXAodGV4dExpbmVzLCBmdW5jdGlvbiAobCkgeyByZXR1cm4gW2xdOyB9KTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgdXBkYXRlSW5wdXQgPSBjbS5jdXJPcC51cGRhdGVJbnB1dDsNCiAgICAvLyBOb3JtYWwgYmVoYXZpb3IgaXMgdG8gaW5zZXJ0IHRoZSBuZXcgdGV4dCBpbnRvIGV2ZXJ5IHNlbGVjdGlvbg0KICAgIGZvciAodmFyIGkkMSA9IHNlbC5yYW5nZXMubGVuZ3RoIC0gMTsgaSQxID49IDA7IGkkMS0tKSB7DQogICAgICB2YXIgcmFuZ2UkJDEgPSBzZWwucmFuZ2VzW2kkMV07DQogICAgICB2YXIgZnJvbSA9IHJhbmdlJCQxLmZyb20oKSwgdG8gPSByYW5nZSQkMS50bygpOw0KICAgICAgaWYgKHJhbmdlJCQxLmVtcHR5KCkpIHsNCiAgICAgICAgaWYgKGRlbGV0ZWQgJiYgZGVsZXRlZCA+IDApIC8vIEhhbmRsZSBkZWxldGlvbg0KICAgICAgICAgIHsgZnJvbSA9IFBvcyhmcm9tLmxpbmUsIGZyb20uY2ggLSBkZWxldGVkKTsgfQ0KICAgICAgICBlbHNlIGlmIChjbS5zdGF0ZS5vdmVyd3JpdGUgJiYgIXBhc3RlKSAvLyBIYW5kbGUgb3ZlcndyaXRlDQogICAgICAgICAgeyB0byA9IFBvcyh0by5saW5lLCBNYXRoLm1pbihnZXRMaW5lKGRvYywgdG8ubGluZSkudGV4dC5sZW5ndGgsIHRvLmNoICsgbHN0KHRleHRMaW5lcykubGVuZ3RoKSk7IH0NCiAgICAgICAgZWxzZSBpZiAocGFzdGUgJiYgbGFzdENvcGllZCAmJiBsYXN0Q29waWVkLmxpbmVXaXNlICYmIGxhc3RDb3BpZWQudGV4dC5qb2luKCJcbiIpID09IGluc2VydGVkKQ0KICAgICAgICAgIHsgZnJvbSA9IHRvID0gUG9zKGZyb20ubGluZSwgMCk7IH0NCiAgICAgIH0NCiAgICAgIHZhciBjaGFuZ2VFdmVudCA9IHtmcm9tOiBmcm9tLCB0bzogdG8sIHRleHQ6IG11bHRpUGFzdGUgPyBtdWx0aVBhc3RlW2kkMSAlIG11bHRpUGFzdGUubGVuZ3RoXSA6IHRleHRMaW5lcywNCiAgICAgICAgICAgICAgICAgICAgICAgICBvcmlnaW46IG9yaWdpbiB8fCAocGFzdGUgPyAicGFzdGUiIDogY20uc3RhdGUuY3V0SW5jb21pbmcgPiByZWNlbnQgPyAiY3V0IiA6ICIraW5wdXQiKX07DQogICAgICBtYWtlQ2hhbmdlKGNtLmRvYywgY2hhbmdlRXZlbnQpOw0KICAgICAgc2lnbmFsTGF0ZXIoY20sICJpbnB1dFJlYWQiLCBjbSwgY2hhbmdlRXZlbnQpOw0KICAgIH0NCiAgICBpZiAoaW5zZXJ0ZWQgJiYgIXBhc3RlKQ0KICAgICAgeyB0cmlnZ2VyRWxlY3RyaWMoY20sIGluc2VydGVkKTsgfQ0KDQogICAgZW5zdXJlQ3Vyc29yVmlzaWJsZShjbSk7DQogICAgaWYgKGNtLmN1ck9wLnVwZGF0ZUlucHV0IDwgMikgeyBjbS5jdXJPcC51cGRhdGVJbnB1dCA9IHVwZGF0ZUlucHV0OyB9DQogICAgY20uY3VyT3AudHlwaW5nID0gdHJ1ZTsNCiAgICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gY20uc3RhdGUuY3V0SW5jb21pbmcgPSAtMTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhhbmRsZVBhc3RlKGUsIGNtKSB7DQogICAgdmFyIHBhc3RlZCA9IGUuY2xpcGJvYXJkRGF0YSAmJiBlLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgiVGV4dCIpOw0KICAgIGlmIChwYXN0ZWQpIHsNCiAgICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICAgIGlmICghY20uaXNSZWFkT25seSgpICYmICFjbS5vcHRpb25zLmRpc2FibGVJbnB1dCkNCiAgICAgICAgeyBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7IHJldHVybiBhcHBseVRleHRJbnB1dChjbSwgcGFzdGVkLCAwLCBudWxsLCAicGFzdGUiKTsgfSk7IH0NCiAgICAgIHJldHVybiB0cnVlDQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gdHJpZ2dlckVsZWN0cmljKGNtLCBpbnNlcnRlZCkgew0KICAgIC8vIFdoZW4gYW4gJ2VsZWN0cmljJyBjaGFyYWN0ZXIgaXMgaW5zZXJ0ZWQsIGltbWVkaWF0ZWx5IHRyaWdnZXIgYSByZWluZGVudA0KICAgIGlmICghY20ub3B0aW9ucy5lbGVjdHJpY0NoYXJzIHx8ICFjbS5vcHRpb25zLnNtYXJ0SW5kZW50KSB7IHJldHVybiB9DQogICAgdmFyIHNlbCA9IGNtLmRvYy5zZWw7DQoNCiAgICBmb3IgKHZhciBpID0gc2VsLnJhbmdlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgew0KICAgICAgdmFyIHJhbmdlJCQxID0gc2VsLnJhbmdlc1tpXTsNCiAgICAgIGlmIChyYW5nZSQkMS5oZWFkLmNoID4gMTAwIHx8IChpICYmIHNlbC5yYW5nZXNbaSAtIDFdLmhlYWQubGluZSA9PSByYW5nZSQkMS5oZWFkLmxpbmUpKSB7IGNvbnRpbnVlIH0NCiAgICAgIHZhciBtb2RlID0gY20uZ2V0TW9kZUF0KHJhbmdlJCQxLmhlYWQpOw0KICAgICAgdmFyIGluZGVudGVkID0gZmFsc2U7DQogICAgICBpZiAobW9kZS5lbGVjdHJpY0NoYXJzKSB7DQogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbW9kZS5lbGVjdHJpY0NoYXJzLmxlbmd0aDsgaisrKQ0KICAgICAgICAgIHsgaWYgKGluc2VydGVkLmluZGV4T2YobW9kZS5lbGVjdHJpY0NoYXJzLmNoYXJBdChqKSkgPiAtMSkgew0KICAgICAgICAgICAgaW5kZW50ZWQgPSBpbmRlbnRMaW5lKGNtLCByYW5nZSQkMS5oZWFkLmxpbmUsICJzbWFydCIpOw0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgICB9IH0NCiAgICAgIH0gZWxzZSBpZiAobW9kZS5lbGVjdHJpY0lucHV0KSB7DQogICAgICAgIGlmIChtb2RlLmVsZWN0cmljSW5wdXQudGVzdChnZXRMaW5lKGNtLmRvYywgcmFuZ2UkJDEuaGVhZC5saW5lKS50ZXh0LnNsaWNlKDAsIHJhbmdlJCQxLmhlYWQuY2gpKSkNCiAgICAgICAgICB7IGluZGVudGVkID0gaW5kZW50TGluZShjbSwgcmFuZ2UkJDEuaGVhZC5saW5lLCAic21hcnQiKTsgfQ0KICAgICAgfQ0KICAgICAgaWYgKGluZGVudGVkKSB7IHNpZ25hbExhdGVyKGNtLCAiZWxlY3RyaWNJbnB1dCIsIGNtLCByYW5nZSQkMS5oZWFkLmxpbmUpOyB9DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gY29weWFibGVSYW5nZXMoY20pIHsNCiAgICB2YXIgdGV4dCA9IFtdLCByYW5nZXMgPSBbXTsNCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKSB7DQogICAgICB2YXIgbGluZSA9IGNtLmRvYy5zZWwucmFuZ2VzW2ldLmhlYWQubGluZTsNCiAgICAgIHZhciBsaW5lUmFuZ2UgPSB7YW5jaG9yOiBQb3MobGluZSwgMCksIGhlYWQ6IFBvcyhsaW5lICsgMSwgMCl9Ow0KICAgICAgcmFuZ2VzLnB1c2gobGluZVJhbmdlKTsNCiAgICAgIHRleHQucHVzaChjbS5nZXRSYW5nZShsaW5lUmFuZ2UuYW5jaG9yLCBsaW5lUmFuZ2UuaGVhZCkpOw0KICAgIH0NCiAgICByZXR1cm4ge3RleHQ6IHRleHQsIHJhbmdlczogcmFuZ2VzfQ0KICB9DQoNCiAgZnVuY3Rpb24gZGlzYWJsZUJyb3dzZXJNYWdpYyhmaWVsZCwgc3BlbGxjaGVjaywgYXV0b2NvcnJlY3QsIGF1dG9jYXBpdGFsaXplKSB7DQogICAgZmllbGQuc2V0QXR0cmlidXRlKCJhdXRvY29ycmVjdCIsIGF1dG9jb3JyZWN0ID8gIiIgOiAib2ZmIik7DQogICAgZmllbGQuc2V0QXR0cmlidXRlKCJhdXRvY2FwaXRhbGl6ZSIsIGF1dG9jYXBpdGFsaXplID8gIiIgOiAib2ZmIik7DQogICAgZmllbGQuc2V0QXR0cmlidXRlKCJzcGVsbGNoZWNrIiwgISFzcGVsbGNoZWNrKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGhpZGRlblRleHRhcmVhKCkgew0KICAgIHZhciB0ZSA9IGVsdCgidGV4dGFyZWEiLCBudWxsLCBudWxsLCAicG9zaXRpb246IGFic29sdXRlOyBib3R0b206IC0xZW07IHBhZGRpbmc6IDA7IHdpZHRoOiAxcHg7IGhlaWdodDogMWVtOyBvdXRsaW5lOiBub25lIik7DQogICAgdmFyIGRpdiA9IGVsdCgiZGl2IiwgW3RlXSwgbnVsbCwgIm92ZXJmbG93OiBoaWRkZW47IHBvc2l0aW9uOiByZWxhdGl2ZTsgd2lkdGg6IDNweDsgaGVpZ2h0OiAwcHg7Iik7DQogICAgLy8gVGhlIHRleHRhcmVhIGlzIGtlcHQgcG9zaXRpb25lZCBuZWFyIHRoZSBjdXJzb3IgdG8gcHJldmVudCB0aGUNCiAgICAvLyBmYWN0IHRoYXQgaXQnbGwgYmUgc2Nyb2xsZWQgaW50byB2aWV3IG9uIGlucHV0IGZyb20gc2Nyb2xsaW5nDQogICAgLy8gb3VyIGZha2UgY3Vyc29yIG91dCBvZiB2aWV3LiBPbiB3ZWJraXQsIHdoZW4gd3JhcD1vZmYsIHBhc3RlIGlzDQogICAgLy8gdmVyeSBzbG93LiBTbyBtYWtlIHRoZSBhcmVhIHdpZGUgaW5zdGVhZC4NCiAgICBpZiAod2Via2l0KSB7IHRlLnN0eWxlLndpZHRoID0gIjEwMDBweCI7IH0NCiAgICBlbHNlIHsgdGUuc2V0QXR0cmlidXRlKCJ3cmFwIiwgIm9mZiIpOyB9DQogICAgLy8gSWYgYm9yZGVyOiAwOyAtLSBpT1MgZmFpbHMgdG8gb3BlbiBrZXlib2FyZCAoaXNzdWUgIzEyODcpDQogICAgaWYgKGlvcykgeyB0ZS5zdHlsZS5ib3JkZXIgPSAiMXB4IHNvbGlkIGJsYWNrIjsgfQ0KICAgIGRpc2FibGVCcm93c2VyTWFnaWModGUpOw0KICAgIHJldHVybiBkaXYNCiAgfQ0KDQogIC8vIFRoZSBwdWJsaWNseSB2aXNpYmxlIEFQSS4gTm90ZSB0aGF0IG1ldGhvZE9wKGYpIG1lYW5zDQogIC8vICd3cmFwIGYgaW4gYW4gb3BlcmF0aW9uLCBwZXJmb3JtZWQgb24gaXRzIGB0aGlzYCBwYXJhbWV0ZXInLg0KDQogIC8vIFRoaXMgaXMgbm90IHRoZSBjb21wbGV0ZSBzZXQgb2YgZWRpdG9yIG1ldGhvZHMuIE1vc3Qgb2YgdGhlDQogIC8vIG1ldGhvZHMgZGVmaW5lZCBvbiB0aGUgRG9jIHR5cGUgYXJlIGFsc28gaW5qZWN0ZWQgaW50bw0KICAvLyBDb2RlTWlycm9yLnByb3RvdHlwZSwgZm9yIGJhY2t3YXJkcyBjb21wYXRpYmlsaXR5IGFuZA0KICAvLyBjb252ZW5pZW5jZS4NCg0KICBmdW5jdGlvbiBhZGRFZGl0b3JNZXRob2RzKENvZGVNaXJyb3IpIHsNCiAgICB2YXIgb3B0aW9uSGFuZGxlcnMgPSBDb2RlTWlycm9yLm9wdGlvbkhhbmRsZXJzOw0KDQogICAgdmFyIGhlbHBlcnMgPSBDb2RlTWlycm9yLmhlbHBlcnMgPSB7fTsNCg0KICAgIENvZGVNaXJyb3IucHJvdG90eXBlID0gew0KICAgICAgY29uc3RydWN0b3I6IENvZGVNaXJyb3IsDQogICAgICBmb2N1czogZnVuY3Rpb24oKXt3aW5kb3cuZm9jdXMoKTsgdGhpcy5kaXNwbGF5LmlucHV0LmZvY3VzKCk7fSwNCg0KICAgICAgc2V0T3B0aW9uOiBmdW5jdGlvbihvcHRpb24sIHZhbHVlKSB7DQogICAgICAgIHZhciBvcHRpb25zID0gdGhpcy5vcHRpb25zLCBvbGQgPSBvcHRpb25zW29wdGlvbl07DQogICAgICAgIGlmIChvcHRpb25zW29wdGlvbl0gPT0gdmFsdWUgJiYgb3B0aW9uICE9ICJtb2RlIikgeyByZXR1cm4gfQ0KICAgICAgICBvcHRpb25zW29wdGlvbl0gPSB2YWx1ZTsNCiAgICAgICAgaWYgKG9wdGlvbkhhbmRsZXJzLmhhc093blByb3BlcnR5KG9wdGlvbikpDQogICAgICAgICAgeyBvcGVyYXRpb24odGhpcywgb3B0aW9uSGFuZGxlcnNbb3B0aW9uXSkodGhpcywgdmFsdWUsIG9sZCk7IH0NCiAgICAgICAgc2lnbmFsKHRoaXMsICJvcHRpb25DaGFuZ2UiLCB0aGlzLCBvcHRpb24pOw0KICAgICAgfSwNCg0KICAgICAgZ2V0T3B0aW9uOiBmdW5jdGlvbihvcHRpb24pIHtyZXR1cm4gdGhpcy5vcHRpb25zW29wdGlvbl19LA0KICAgICAgZ2V0RG9jOiBmdW5jdGlvbigpIHtyZXR1cm4gdGhpcy5kb2N9LA0KDQogICAgICBhZGRLZXlNYXA6IGZ1bmN0aW9uKG1hcCQkMSwgYm90dG9tKSB7DQogICAgICAgIHRoaXMuc3RhdGUua2V5TWFwc1tib3R0b20gPyAicHVzaCIgOiAidW5zaGlmdCJdKGdldEtleU1hcChtYXAkJDEpKTsNCiAgICAgIH0sDQogICAgICByZW1vdmVLZXlNYXA6IGZ1bmN0aW9uKG1hcCQkMSkgew0KICAgICAgICB2YXIgbWFwcyA9IHRoaXMuc3RhdGUua2V5TWFwczsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtYXBzLmxlbmd0aDsgKytpKQ0KICAgICAgICAgIHsgaWYgKG1hcHNbaV0gPT0gbWFwJCQxIHx8IG1hcHNbaV0ubmFtZSA9PSBtYXAkJDEpIHsNCiAgICAgICAgICAgIG1hcHMuc3BsaWNlKGksIDEpOw0KICAgICAgICAgICAgcmV0dXJuIHRydWUNCiAgICAgICAgICB9IH0NCiAgICAgIH0sDQoNCiAgICAgIGFkZE92ZXJsYXk6IG1ldGhvZE9wKGZ1bmN0aW9uKHNwZWMsIG9wdGlvbnMpIHsNCiAgICAgICAgdmFyIG1vZGUgPSBzcGVjLnRva2VuID8gc3BlYyA6IENvZGVNaXJyb3IuZ2V0TW9kZSh0aGlzLm9wdGlvbnMsIHNwZWMpOw0KICAgICAgICBpZiAobW9kZS5zdGFydFN0YXRlKSB7IHRocm93IG5ldyBFcnJvcigiT3ZlcmxheXMgbWF5IG5vdCBiZSBzdGF0ZWZ1bC4iKSB9DQogICAgICAgIGluc2VydFNvcnRlZCh0aGlzLnN0YXRlLm92ZXJsYXlzLA0KICAgICAgICAgICAgICAgICAgICAge21vZGU6IG1vZGUsIG1vZGVTcGVjOiBzcGVjLCBvcGFxdWU6IG9wdGlvbnMgJiYgb3B0aW9ucy5vcGFxdWUsDQogICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHk6IChvcHRpb25zICYmIG9wdGlvbnMucHJpb3JpdHkpIHx8IDB9LA0KICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKG92ZXJsYXkpIHsgcmV0dXJuIG92ZXJsYXkucHJpb3JpdHk7IH0pOw0KICAgICAgICB0aGlzLnN0YXRlLm1vZGVHZW4rKzsNCiAgICAgICAgcmVnQ2hhbmdlKHRoaXMpOw0KICAgICAgfSksDQogICAgICByZW1vdmVPdmVybGF5OiBtZXRob2RPcChmdW5jdGlvbihzcGVjKSB7DQogICAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgICAgIHZhciBvdmVybGF5cyA9IHRoaXMuc3RhdGUub3ZlcmxheXM7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3ZlcmxheXMubGVuZ3RoOyArK2kpIHsNCiAgICAgICAgICB2YXIgY3VyID0gb3ZlcmxheXNbaV0ubW9kZVNwZWM7DQogICAgICAgICAgaWYgKGN1ciA9PSBzcGVjIHx8IHR5cGVvZiBzcGVjID09ICJzdHJpbmciICYmIGN1ci5uYW1lID09IHNwZWMpIHsNCiAgICAgICAgICAgIG92ZXJsYXlzLnNwbGljZShpLCAxKTsNCiAgICAgICAgICAgIHRoaXMkMS5zdGF0ZS5tb2RlR2VuKys7DQogICAgICAgICAgICByZWdDaGFuZ2UodGhpcyQxKTsNCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfSksDQoNCiAgICAgIGluZGVudExpbmU6IG1ldGhvZE9wKGZ1bmN0aW9uKG4sIGRpciwgYWdncmVzc2l2ZSkgew0KICAgICAgICBpZiAodHlwZW9mIGRpciAhPSAic3RyaW5nIiAmJiB0eXBlb2YgZGlyICE9ICJudW1iZXIiKSB7DQogICAgICAgICAgaWYgKGRpciA9PSBudWxsKSB7IGRpciA9IHRoaXMub3B0aW9ucy5zbWFydEluZGVudCA/ICJzbWFydCIgOiAicHJldiI7IH0NCiAgICAgICAgICBlbHNlIHsgZGlyID0gZGlyID8gImFkZCIgOiAic3VidHJhY3QiOyB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKGlzTGluZSh0aGlzLmRvYywgbikpIHsgaW5kZW50TGluZSh0aGlzLCBuLCBkaXIsIGFnZ3Jlc3NpdmUpOyB9DQogICAgICB9KSwNCiAgICAgIGluZGVudFNlbGVjdGlvbjogbWV0aG9kT3AoZnVuY3Rpb24oaG93KSB7DQogICAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgICAgIHZhciByYW5nZXMgPSB0aGlzLmRvYy5zZWwucmFuZ2VzLCBlbmQgPSAtMTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICB2YXIgcmFuZ2UkJDEgPSByYW5nZXNbaV07DQogICAgICAgICAgaWYgKCFyYW5nZSQkMS5lbXB0eSgpKSB7DQogICAgICAgICAgICB2YXIgZnJvbSA9IHJhbmdlJCQxLmZyb20oKSwgdG8gPSByYW5nZSQkMS50bygpOw0KICAgICAgICAgICAgdmFyIHN0YXJ0ID0gTWF0aC5tYXgoZW5kLCBmcm9tLmxpbmUpOw0KICAgICAgICAgICAgZW5kID0gTWF0aC5taW4odGhpcyQxLmxhc3RMaW5lKCksIHRvLmxpbmUgLSAodG8uY2ggPyAwIDogMSkpICsgMTsNCiAgICAgICAgICAgIGZvciAodmFyIGogPSBzdGFydDsgaiA8IGVuZDsgKytqKQ0KICAgICAgICAgICAgICB7IGluZGVudExpbmUodGhpcyQxLCBqLCBob3cpOyB9DQogICAgICAgICAgICB2YXIgbmV3UmFuZ2VzID0gdGhpcyQxLmRvYy5zZWwucmFuZ2VzOw0KICAgICAgICAgICAgaWYgKGZyb20uY2ggPT0gMCAmJiByYW5nZXMubGVuZ3RoID09IG5ld1Jhbmdlcy5sZW5ndGggJiYgbmV3UmFuZ2VzW2ldLmZyb20oKS5jaCA+IDApDQogICAgICAgICAgICAgIHsgcmVwbGFjZU9uZVNlbGVjdGlvbih0aGlzJDEuZG9jLCBpLCBuZXcgUmFuZ2UoZnJvbSwgbmV3UmFuZ2VzW2ldLnRvKCkpLCBzZWxfZG9udFNjcm9sbCk7IH0NCiAgICAgICAgICB9IGVsc2UgaWYgKHJhbmdlJCQxLmhlYWQubGluZSA+IGVuZCkgew0KICAgICAgICAgICAgaW5kZW50TGluZSh0aGlzJDEsIHJhbmdlJCQxLmhlYWQubGluZSwgaG93LCB0cnVlKTsNCiAgICAgICAgICAgIGVuZCA9IHJhbmdlJCQxLmhlYWQubGluZTsNCiAgICAgICAgICAgIGlmIChpID09IHRoaXMkMS5kb2Muc2VsLnByaW1JbmRleCkgeyBlbnN1cmVDdXJzb3JWaXNpYmxlKHRoaXMkMSk7IH0NCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0pLA0KDQogICAgICAvLyBGZXRjaCB0aGUgcGFyc2VyIHRva2VuIGZvciBhIGdpdmVuIGNoYXJhY3Rlci4gVXNlZnVsIGZvciBoYWNrcw0KICAgICAgLy8gdGhhdCB3YW50IHRvIGluc3BlY3QgdGhlIG1vZGUgc3RhdGUgKHNheSwgZm9yIGNvbXBsZXRpb24pLg0KICAgICAgZ2V0VG9rZW5BdDogZnVuY3Rpb24ocG9zLCBwcmVjaXNlKSB7DQogICAgICAgIHJldHVybiB0YWtlVG9rZW4odGhpcywgcG9zLCBwcmVjaXNlKQ0KICAgICAgfSwNCg0KICAgICAgZ2V0TGluZVRva2VuczogZnVuY3Rpb24obGluZSwgcHJlY2lzZSkgew0KICAgICAgICByZXR1cm4gdGFrZVRva2VuKHRoaXMsIFBvcyhsaW5lKSwgcHJlY2lzZSwgdHJ1ZSkNCiAgICAgIH0sDQoNCiAgICAgIGdldFRva2VuVHlwZUF0OiBmdW5jdGlvbihwb3MpIHsNCiAgICAgICAgcG9zID0gY2xpcFBvcyh0aGlzLmRvYywgcG9zKTsNCiAgICAgICAgdmFyIHN0eWxlcyA9IGdldExpbmVTdHlsZXModGhpcywgZ2V0TGluZSh0aGlzLmRvYywgcG9zLmxpbmUpKTsNCiAgICAgICAgdmFyIGJlZm9yZSA9IDAsIGFmdGVyID0gKHN0eWxlcy5sZW5ndGggLSAxKSAvIDIsIGNoID0gcG9zLmNoOw0KICAgICAgICB2YXIgdHlwZTsNCiAgICAgICAgaWYgKGNoID09IDApIHsgdHlwZSA9IHN0eWxlc1syXTsgfQ0KICAgICAgICBlbHNlIHsgZm9yICg7Oykgew0KICAgICAgICAgIHZhciBtaWQgPSAoYmVmb3JlICsgYWZ0ZXIpID4+IDE7DQogICAgICAgICAgaWYgKChtaWQgPyBzdHlsZXNbbWlkICogMiAtIDFdIDogMCkgPj0gY2gpIHsgYWZ0ZXIgPSBtaWQ7IH0NCiAgICAgICAgICBlbHNlIGlmIChzdHlsZXNbbWlkICogMiArIDFdIDwgY2gpIHsgYmVmb3JlID0gbWlkICsgMTsgfQ0KICAgICAgICAgIGVsc2UgeyB0eXBlID0gc3R5bGVzW21pZCAqIDIgKyAyXTsgYnJlYWsgfQ0KICAgICAgICB9IH0NCiAgICAgICAgdmFyIGN1dCA9IHR5cGUgPyB0eXBlLmluZGV4T2YoIm92ZXJsYXkgIikgOiAtMTsNCiAgICAgICAgcmV0dXJuIGN1dCA8IDAgPyB0eXBlIDogY3V0ID09IDAgPyBudWxsIDogdHlwZS5zbGljZSgwLCBjdXQgLSAxKQ0KICAgICAgfSwNCg0KICAgICAgZ2V0TW9kZUF0OiBmdW5jdGlvbihwb3MpIHsNCiAgICAgICAgdmFyIG1vZGUgPSB0aGlzLmRvYy5tb2RlOw0KICAgICAgICBpZiAoIW1vZGUuaW5uZXJNb2RlKSB7IHJldHVybiBtb2RlIH0NCiAgICAgICAgcmV0dXJuIENvZGVNaXJyb3IuaW5uZXJNb2RlKG1vZGUsIHRoaXMuZ2V0VG9rZW5BdChwb3MpLnN0YXRlKS5tb2RlDQogICAgICB9LA0KDQogICAgICBnZXRIZWxwZXI6IGZ1bmN0aW9uKHBvcywgdHlwZSkgew0KICAgICAgICByZXR1cm4gdGhpcy5nZXRIZWxwZXJzKHBvcywgdHlwZSlbMF0NCiAgICAgIH0sDQoNCiAgICAgIGdldEhlbHBlcnM6IGZ1bmN0aW9uKHBvcywgdHlwZSkgew0KICAgICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgICB2YXIgZm91bmQgPSBbXTsNCiAgICAgICAgaWYgKCFoZWxwZXJzLmhhc093blByb3BlcnR5KHR5cGUpKSB7IHJldHVybiBmb3VuZCB9DQogICAgICAgIHZhciBoZWxwID0gaGVscGVyc1t0eXBlXSwgbW9kZSA9IHRoaXMuZ2V0TW9kZUF0KHBvcyk7DQogICAgICAgIGlmICh0eXBlb2YgbW9kZVt0eXBlXSA9PSAic3RyaW5nIikgew0KICAgICAgICAgIGlmIChoZWxwW21vZGVbdHlwZV1dKSB7IGZvdW5kLnB1c2goaGVscFttb2RlW3R5cGVdXSk7IH0NCiAgICAgICAgfSBlbHNlIGlmIChtb2RlW3R5cGVdKSB7DQogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtb2RlW3R5cGVdLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgdmFsID0gaGVscFttb2RlW3R5cGVdW2ldXTsNCiAgICAgICAgICAgIGlmICh2YWwpIHsgZm91bmQucHVzaCh2YWwpOyB9DQogICAgICAgICAgfQ0KICAgICAgICB9IGVsc2UgaWYgKG1vZGUuaGVscGVyVHlwZSAmJiBoZWxwW21vZGUuaGVscGVyVHlwZV0pIHsNCiAgICAgICAgICBmb3VuZC5wdXNoKGhlbHBbbW9kZS5oZWxwZXJUeXBlXSk7DQogICAgICAgIH0gZWxzZSBpZiAoaGVscFttb2RlLm5hbWVdKSB7DQogICAgICAgICAgZm91bmQucHVzaChoZWxwW21vZGUubmFtZV0pOw0KICAgICAgICB9DQogICAgICAgIGZvciAodmFyIGkkMSA9IDA7IGkkMSA8IGhlbHAuX2dsb2JhbC5sZW5ndGg7IGkkMSsrKSB7DQogICAgICAgICAgdmFyIGN1ciA9IGhlbHAuX2dsb2JhbFtpJDFdOw0KICAgICAgICAgIGlmIChjdXIucHJlZChtb2RlLCB0aGlzJDEpICYmIGluZGV4T2YoZm91bmQsIGN1ci52YWwpID09IC0xKQ0KICAgICAgICAgICAgeyBmb3VuZC5wdXNoKGN1ci52YWwpOyB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGZvdW5kDQogICAgICB9LA0KDQogICAgICBnZXRTdGF0ZUFmdGVyOiBmdW5jdGlvbihsaW5lLCBwcmVjaXNlKSB7DQogICAgICAgIHZhciBkb2MgPSB0aGlzLmRvYzsNCiAgICAgICAgbGluZSA9IGNsaXBMaW5lKGRvYywgbGluZSA9PSBudWxsID8gZG9jLmZpcnN0ICsgZG9jLnNpemUgLSAxOiBsaW5lKTsNCiAgICAgICAgcmV0dXJuIGdldENvbnRleHRCZWZvcmUodGhpcywgbGluZSArIDEsIHByZWNpc2UpLnN0YXRlDQogICAgICB9LA0KDQogICAgICBjdXJzb3JDb29yZHM6IGZ1bmN0aW9uKHN0YXJ0LCBtb2RlKSB7DQogICAgICAgIHZhciBwb3MsIHJhbmdlJCQxID0gdGhpcy5kb2Muc2VsLnByaW1hcnkoKTsNCiAgICAgICAgaWYgKHN0YXJ0ID09IG51bGwpIHsgcG9zID0gcmFuZ2UkJDEuaGVhZDsgfQ0KICAgICAgICBlbHNlIGlmICh0eXBlb2Ygc3RhcnQgPT0gIm9iamVjdCIpIHsgcG9zID0gY2xpcFBvcyh0aGlzLmRvYywgc3RhcnQpOyB9DQogICAgICAgIGVsc2UgeyBwb3MgPSBzdGFydCA/IHJhbmdlJCQxLmZyb20oKSA6IHJhbmdlJCQxLnRvKCk7IH0NCiAgICAgICAgcmV0dXJuIGN1cnNvckNvb3Jkcyh0aGlzLCBwb3MsIG1vZGUgfHwgInBhZ2UiKQ0KICAgICAgfSwNCg0KICAgICAgY2hhckNvb3JkczogZnVuY3Rpb24ocG9zLCBtb2RlKSB7DQogICAgICAgIHJldHVybiBjaGFyQ29vcmRzKHRoaXMsIGNsaXBQb3ModGhpcy5kb2MsIHBvcyksIG1vZGUgfHwgInBhZ2UiKQ0KICAgICAgfSwNCg0KICAgICAgY29vcmRzQ2hhcjogZnVuY3Rpb24oY29vcmRzLCBtb2RlKSB7DQogICAgICAgIGNvb3JkcyA9IGZyb21Db29yZFN5c3RlbSh0aGlzLCBjb29yZHMsIG1vZGUgfHwgInBhZ2UiKTsNCiAgICAgICAgcmV0dXJuIGNvb3Jkc0NoYXIodGhpcywgY29vcmRzLmxlZnQsIGNvb3Jkcy50b3ApDQogICAgICB9LA0KDQogICAgICBsaW5lQXRIZWlnaHQ6IGZ1bmN0aW9uKGhlaWdodCwgbW9kZSkgew0KICAgICAgICBoZWlnaHQgPSBmcm9tQ29vcmRTeXN0ZW0odGhpcywge3RvcDogaGVpZ2h0LCBsZWZ0OiAwfSwgbW9kZSB8fCAicGFnZSIpLnRvcDsNCiAgICAgICAgcmV0dXJuIGxpbmVBdEhlaWdodCh0aGlzLmRvYywgaGVpZ2h0ICsgdGhpcy5kaXNwbGF5LnZpZXdPZmZzZXQpDQogICAgICB9LA0KICAgICAgaGVpZ2h0QXRMaW5lOiBmdW5jdGlvbihsaW5lLCBtb2RlLCBpbmNsdWRlV2lkZ2V0cykgew0KICAgICAgICB2YXIgZW5kID0gZmFsc2UsIGxpbmVPYmo7DQogICAgICAgIGlmICh0eXBlb2YgbGluZSA9PSAibnVtYmVyIikgew0KICAgICAgICAgIHZhciBsYXN0ID0gdGhpcy5kb2MuZmlyc3QgKyB0aGlzLmRvYy5zaXplIC0gMTsNCiAgICAgICAgICBpZiAobGluZSA8IHRoaXMuZG9jLmZpcnN0KSB7IGxpbmUgPSB0aGlzLmRvYy5maXJzdDsgfQ0KICAgICAgICAgIGVsc2UgaWYgKGxpbmUgPiBsYXN0KSB7IGxpbmUgPSBsYXN0OyBlbmQgPSB0cnVlOyB9DQogICAgICAgICAgbGluZU9iaiA9IGdldExpbmUodGhpcy5kb2MsIGxpbmUpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGxpbmVPYmogPSBsaW5lOw0KICAgICAgICB9DQogICAgICAgIHJldHVybiBpbnRvQ29vcmRTeXN0ZW0odGhpcywgbGluZU9iaiwge3RvcDogMCwgbGVmdDogMH0sIG1vZGUgfHwgInBhZ2UiLCBpbmNsdWRlV2lkZ2V0cyB8fCBlbmQpLnRvcCArDQogICAgICAgICAgKGVuZCA/IHRoaXMuZG9jLmhlaWdodCAtIGhlaWdodEF0TGluZShsaW5lT2JqKSA6IDApDQogICAgICB9LA0KDQogICAgICBkZWZhdWx0VGV4dEhlaWdodDogZnVuY3Rpb24oKSB7IHJldHVybiB0ZXh0SGVpZ2h0KHRoaXMuZGlzcGxheSkgfSwNCiAgICAgIGRlZmF1bHRDaGFyV2lkdGg6IGZ1bmN0aW9uKCkgeyByZXR1cm4gY2hhcldpZHRoKHRoaXMuZGlzcGxheSkgfSwNCg0KICAgICAgZ2V0Vmlld3BvcnQ6IGZ1bmN0aW9uKCkgeyByZXR1cm4ge2Zyb206IHRoaXMuZGlzcGxheS52aWV3RnJvbSwgdG86IHRoaXMuZGlzcGxheS52aWV3VG99fSwNCg0KICAgICAgYWRkV2lkZ2V0OiBmdW5jdGlvbihwb3MsIG5vZGUsIHNjcm9sbCwgdmVydCwgaG9yaXopIHsNCiAgICAgICAgdmFyIGRpc3BsYXkgPSB0aGlzLmRpc3BsYXk7DQogICAgICAgIHBvcyA9IGN1cnNvckNvb3Jkcyh0aGlzLCBjbGlwUG9zKHRoaXMuZG9jLCBwb3MpKTsNCiAgICAgICAgdmFyIHRvcCA9IHBvcy5ib3R0b20sIGxlZnQgPSBwb3MubGVmdDsNCiAgICAgICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9ICJhYnNvbHV0ZSI7DQogICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKCJjbS1pZ25vcmUtZXZlbnRzIiwgInRydWUiKTsNCiAgICAgICAgdGhpcy5kaXNwbGF5LmlucHV0LnNldFVuZWRpdGFibGUobm9kZSk7DQogICAgICAgIGRpc3BsYXkuc2l6ZXIuYXBwZW5kQ2hpbGQobm9kZSk7DQogICAgICAgIGlmICh2ZXJ0ID09ICJvdmVyIikgew0KICAgICAgICAgIHRvcCA9IHBvcy50b3A7DQogICAgICAgIH0gZWxzZSBpZiAodmVydCA9PSAiYWJvdmUiIHx8IHZlcnQgPT0gIm5lYXIiKSB7DQogICAgICAgICAgdmFyIHZzcGFjZSA9IE1hdGgubWF4KGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQsIHRoaXMuZG9jLmhlaWdodCksDQogICAgICAgICAgaHNwYWNlID0gTWF0aC5tYXgoZGlzcGxheS5zaXplci5jbGllbnRXaWR0aCwgZGlzcGxheS5saW5lU3BhY2UuY2xpZW50V2lkdGgpOw0KICAgICAgICAgIC8vIERlZmF1bHQgdG8gcG9zaXRpb25pbmcgYWJvdmUgKGlmIHNwZWNpZmllZCBhbmQgcG9zc2libGUpOyBvdGhlcndpc2UgZGVmYXVsdCB0byBwb3NpdGlvbmluZyBiZWxvdw0KICAgICAgICAgIGlmICgodmVydCA9PSAnYWJvdmUnIHx8IHBvcy5ib3R0b20gKyBub2RlLm9mZnNldEhlaWdodCA+IHZzcGFjZSkgJiYgcG9zLnRvcCA+IG5vZGUub2Zmc2V0SGVpZ2h0KQ0KICAgICAgICAgICAgeyB0b3AgPSBwb3MudG9wIC0gbm9kZS5vZmZzZXRIZWlnaHQ7IH0NCiAgICAgICAgICBlbHNlIGlmIChwb3MuYm90dG9tICsgbm9kZS5vZmZzZXRIZWlnaHQgPD0gdnNwYWNlKQ0KICAgICAgICAgICAgeyB0b3AgPSBwb3MuYm90dG9tOyB9DQogICAgICAgICAgaWYgKGxlZnQgKyBub2RlLm9mZnNldFdpZHRoID4gaHNwYWNlKQ0KICAgICAgICAgICAgeyBsZWZ0ID0gaHNwYWNlIC0gbm9kZS5vZmZzZXRXaWR0aDsgfQ0KICAgICAgICB9DQogICAgICAgIG5vZGUuc3R5bGUudG9wID0gdG9wICsgInB4IjsNCiAgICAgICAgbm9kZS5zdHlsZS5sZWZ0ID0gbm9kZS5zdHlsZS5yaWdodCA9ICIiOw0KICAgICAgICBpZiAoaG9yaXogPT0gInJpZ2h0Iikgew0KICAgICAgICAgIGxlZnQgPSBkaXNwbGF5LnNpemVyLmNsaWVudFdpZHRoIC0gbm9kZS5vZmZzZXRXaWR0aDsNCiAgICAgICAgICBub2RlLnN0eWxlLnJpZ2h0ID0gIjBweCI7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaWYgKGhvcml6ID09ICJsZWZ0IikgeyBsZWZ0ID0gMDsgfQ0KICAgICAgICAgIGVsc2UgaWYgKGhvcml6ID09ICJtaWRkbGUiKSB7IGxlZnQgPSAoZGlzcGxheS5zaXplci5jbGllbnRXaWR0aCAtIG5vZGUub2Zmc2V0V2lkdGgpIC8gMjsgfQ0KICAgICAgICAgIG5vZGUuc3R5bGUubGVmdCA9IGxlZnQgKyAicHgiOw0KICAgICAgICB9DQogICAgICAgIGlmIChzY3JvbGwpDQogICAgICAgICAgeyBzY3JvbGxJbnRvVmlldyh0aGlzLCB7bGVmdDogbGVmdCwgdG9wOiB0b3AsIHJpZ2h0OiBsZWZ0ICsgbm9kZS5vZmZzZXRXaWR0aCwgYm90dG9tOiB0b3AgKyBub2RlLm9mZnNldEhlaWdodH0pOyB9DQogICAgICB9LA0KDQogICAgICB0cmlnZ2VyT25LZXlEb3duOiBtZXRob2RPcChvbktleURvd24pLA0KICAgICAgdHJpZ2dlck9uS2V5UHJlc3M6IG1ldGhvZE9wKG9uS2V5UHJlc3MpLA0KICAgICAgdHJpZ2dlck9uS2V5VXA6IG9uS2V5VXAsDQogICAgICB0cmlnZ2VyT25Nb3VzZURvd246IG1ldGhvZE9wKG9uTW91c2VEb3duKSwNCg0KICAgICAgZXhlY0NvbW1hbmQ6IGZ1bmN0aW9uKGNtZCkgew0KICAgICAgICBpZiAoY29tbWFuZHMuaGFzT3duUHJvcGVydHkoY21kKSkNCiAgICAgICAgICB7IHJldHVybiBjb21tYW5kc1tjbWRdLmNhbGwobnVsbCwgdGhpcykgfQ0KICAgICAgfSwNCg0KICAgICAgdHJpZ2dlckVsZWN0cmljOiBtZXRob2RPcChmdW5jdGlvbih0ZXh0KSB7IHRyaWdnZXJFbGVjdHJpYyh0aGlzLCB0ZXh0KTsgfSksDQoNCiAgICAgIGZpbmRQb3NIOiBmdW5jdGlvbihmcm9tLCBhbW91bnQsIHVuaXQsIHZpc3VhbGx5KSB7DQogICAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgICAgIHZhciBkaXIgPSAxOw0KICAgICAgICBpZiAoYW1vdW50IDwgMCkgeyBkaXIgPSAtMTsgYW1vdW50ID0gLWFtb3VudDsgfQ0KICAgICAgICB2YXIgY3VyID0gY2xpcFBvcyh0aGlzLmRvYywgZnJvbSk7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYW1vdW50OyArK2kpIHsNCiAgICAgICAgICBjdXIgPSBmaW5kUG9zSCh0aGlzJDEuZG9jLCBjdXIsIGRpciwgdW5pdCwgdmlzdWFsbHkpOw0KICAgICAgICAgIGlmIChjdXIuaGl0U2lkZSkgeyBicmVhayB9DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIGN1cg0KICAgICAgfSwNCg0KICAgICAgbW92ZUg6IG1ldGhvZE9wKGZ1bmN0aW9uKGRpciwgdW5pdCkgew0KICAgICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgICB0aGlzLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UkJDEpIHsNCiAgICAgICAgICBpZiAodGhpcyQxLmRpc3BsYXkuc2hpZnQgfHwgdGhpcyQxLmRvYy5leHRlbmQgfHwgcmFuZ2UkJDEuZW1wdHkoKSkNCiAgICAgICAgICAgIHsgcmV0dXJuIGZpbmRQb3NIKHRoaXMkMS5kb2MsIHJhbmdlJCQxLmhlYWQsIGRpciwgdW5pdCwgdGhpcyQxLm9wdGlvbnMucnRsTW92ZVZpc3VhbGx5KSB9DQogICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgeyByZXR1cm4gZGlyIDwgMCA/IHJhbmdlJCQxLmZyb20oKSA6IHJhbmdlJCQxLnRvKCkgfQ0KICAgICAgICB9LCBzZWxfbW92ZSk7DQogICAgICB9KSwNCg0KICAgICAgZGVsZXRlSDogbWV0aG9kT3AoZnVuY3Rpb24oZGlyLCB1bml0KSB7DQogICAgICAgIHZhciBzZWwgPSB0aGlzLmRvYy5zZWwsIGRvYyA9IHRoaXMuZG9jOw0KICAgICAgICBpZiAoc2VsLnNvbWV0aGluZ1NlbGVjdGVkKCkpDQogICAgICAgICAgeyBkb2MucmVwbGFjZVNlbGVjdGlvbigiIiwgbnVsbCwgIitkZWxldGUiKTsgfQ0KICAgICAgICBlbHNlDQogICAgICAgICAgeyBkZWxldGVOZWFyU2VsZWN0aW9uKHRoaXMsIGZ1bmN0aW9uIChyYW5nZSQkMSkgew0KICAgICAgICAgICAgdmFyIG90aGVyID0gZmluZFBvc0goZG9jLCByYW5nZSQkMS5oZWFkLCBkaXIsIHVuaXQsIGZhbHNlKTsNCiAgICAgICAgICAgIHJldHVybiBkaXIgPCAwID8ge2Zyb206IG90aGVyLCB0bzogcmFuZ2UkJDEuaGVhZH0gOiB7ZnJvbTogcmFuZ2UkJDEuaGVhZCwgdG86IG90aGVyfQ0KICAgICAgICAgIH0pOyB9DQogICAgICB9KSwNCg0KICAgICAgZmluZFBvc1Y6IGZ1bmN0aW9uKGZyb20sIGFtb3VudCwgdW5pdCwgZ29hbENvbHVtbikgew0KICAgICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgICAgICB2YXIgZGlyID0gMSwgeCA9IGdvYWxDb2x1bW47DQogICAgICAgIGlmIChhbW91bnQgPCAwKSB7IGRpciA9IC0xOyBhbW91bnQgPSAtYW1vdW50OyB9DQogICAgICAgIHZhciBjdXIgPSBjbGlwUG9zKHRoaXMuZG9jLCBmcm9tKTsNCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhbW91bnQ7ICsraSkgew0KICAgICAgICAgIHZhciBjb29yZHMgPSBjdXJzb3JDb29yZHModGhpcyQxLCBjdXIsICJkaXYiKTsNCiAgICAgICAgICBpZiAoeCA9PSBudWxsKSB7IHggPSBjb29yZHMubGVmdDsgfQ0KICAgICAgICAgIGVsc2UgeyBjb29yZHMubGVmdCA9IHg7IH0NCiAgICAgICAgICBjdXIgPSBmaW5kUG9zVih0aGlzJDEsIGNvb3JkcywgZGlyLCB1bml0KTsNCiAgICAgICAgICBpZiAoY3VyLmhpdFNpZGUpIHsgYnJlYWsgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBjdXINCiAgICAgIH0sDQoNCiAgICAgIG1vdmVWOiBtZXRob2RPcChmdW5jdGlvbihkaXIsIHVuaXQpIHsNCiAgICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgICAgdmFyIGRvYyA9IHRoaXMuZG9jLCBnb2FscyA9IFtdOw0KICAgICAgICB2YXIgY29sbGFwc2UgPSAhdGhpcy5kaXNwbGF5LnNoaWZ0ICYmICFkb2MuZXh0ZW5kICYmIGRvYy5zZWwuc29tZXRoaW5nU2VsZWN0ZWQoKTsNCiAgICAgICAgZG9jLmV4dGVuZFNlbGVjdGlvbnNCeShmdW5jdGlvbiAocmFuZ2UkJDEpIHsNCiAgICAgICAgICBpZiAoY29sbGFwc2UpDQogICAgICAgICAgICB7IHJldHVybiBkaXIgPCAwID8gcmFuZ2UkJDEuZnJvbSgpIDogcmFuZ2UkJDEudG8oKSB9DQogICAgICAgICAgdmFyIGhlYWRQb3MgPSBjdXJzb3JDb29yZHModGhpcyQxLCByYW5nZSQkMS5oZWFkLCAiZGl2Iik7DQogICAgICAgICAgaWYgKHJhbmdlJCQxLmdvYWxDb2x1bW4gIT0gbnVsbCkgeyBoZWFkUG9zLmxlZnQgPSByYW5nZSQkMS5nb2FsQ29sdW1uOyB9DQogICAgICAgICAgZ29hbHMucHVzaChoZWFkUG9zLmxlZnQpOw0KICAgICAgICAgIHZhciBwb3MgPSBmaW5kUG9zVih0aGlzJDEsIGhlYWRQb3MsIGRpciwgdW5pdCk7DQogICAgICAgICAgaWYgKHVuaXQgPT0gInBhZ2UiICYmIHJhbmdlJCQxID09IGRvYy5zZWwucHJpbWFyeSgpKQ0KICAgICAgICAgICAgeyBhZGRUb1Njcm9sbFRvcCh0aGlzJDEsIGNoYXJDb29yZHModGhpcyQxLCBwb3MsICJkaXYiKS50b3AgLSBoZWFkUG9zLnRvcCk7IH0NCiAgICAgICAgICByZXR1cm4gcG9zDQogICAgICAgIH0sIHNlbF9tb3ZlKTsNCiAgICAgICAgaWYgKGdvYWxzLmxlbmd0aCkgeyBmb3IgKHZhciBpID0gMDsgaSA8IGRvYy5zZWwucmFuZ2VzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgIHsgZG9jLnNlbC5yYW5nZXNbaV0uZ29hbENvbHVtbiA9IGdvYWxzW2ldOyB9IH0NCiAgICAgIH0pLA0KDQogICAgICAvLyBGaW5kIHRoZSB3b3JkIGF0IHRoZSBnaXZlbiBwb3NpdGlvbiAoYXMgcmV0dXJuZWQgYnkgY29vcmRzQ2hhcikuDQogICAgICBmaW5kV29yZEF0OiBmdW5jdGlvbihwb3MpIHsNCiAgICAgICAgdmFyIGRvYyA9IHRoaXMuZG9jLCBsaW5lID0gZ2V0TGluZShkb2MsIHBvcy5saW5lKS50ZXh0Ow0KICAgICAgICB2YXIgc3RhcnQgPSBwb3MuY2gsIGVuZCA9IHBvcy5jaDsNCiAgICAgICAgaWYgKGxpbmUpIHsNCiAgICAgICAgICB2YXIgaGVscGVyID0gdGhpcy5nZXRIZWxwZXIocG9zLCAid29yZENoYXJzIik7DQogICAgICAgICAgaWYgKChwb3Muc3RpY2t5ID09ICJiZWZvcmUiIHx8IGVuZCA9PSBsaW5lLmxlbmd0aCkgJiYgc3RhcnQpIHsgLS1zdGFydDsgfSBlbHNlIHsgKytlbmQ7IH0NCiAgICAgICAgICB2YXIgc3RhcnRDaGFyID0gbGluZS5jaGFyQXQoc3RhcnQpOw0KICAgICAgICAgIHZhciBjaGVjayA9IGlzV29yZENoYXIoc3RhcnRDaGFyLCBoZWxwZXIpDQogICAgICAgICAgICA/IGZ1bmN0aW9uIChjaCkgeyByZXR1cm4gaXNXb3JkQ2hhcihjaCwgaGVscGVyKTsgfQ0KICAgICAgICAgICAgOiAvXHMvLnRlc3Qoc3RhcnRDaGFyKSA/IGZ1bmN0aW9uIChjaCkgeyByZXR1cm4gL1xzLy50ZXN0KGNoKTsgfQ0KICAgICAgICAgICAgOiBmdW5jdGlvbiAoY2gpIHsgcmV0dXJuICghL1xzLy50ZXN0KGNoKSAmJiAhaXNXb3JkQ2hhcihjaCkpOyB9Ow0KICAgICAgICAgIHdoaWxlIChzdGFydCA+IDAgJiYgY2hlY2sobGluZS5jaGFyQXQoc3RhcnQgLSAxKSkpIHsgLS1zdGFydDsgfQ0KICAgICAgICAgIHdoaWxlIChlbmQgPCBsaW5lLmxlbmd0aCAmJiBjaGVjayhsaW5lLmNoYXJBdChlbmQpKSkgeyArK2VuZDsgfQ0KICAgICAgICB9DQogICAgICAgIHJldHVybiBuZXcgUmFuZ2UoUG9zKHBvcy5saW5lLCBzdGFydCksIFBvcyhwb3MubGluZSwgZW5kKSkNCiAgICAgIH0sDQoNCiAgICAgIHRvZ2dsZU92ZXJ3cml0ZTogZnVuY3Rpb24odmFsdWUpIHsNCiAgICAgICAgaWYgKHZhbHVlICE9IG51bGwgJiYgdmFsdWUgPT0gdGhpcy5zdGF0ZS5vdmVyd3JpdGUpIHsgcmV0dXJuIH0NCiAgICAgICAgaWYgKHRoaXMuc3RhdGUub3ZlcndyaXRlID0gIXRoaXMuc3RhdGUub3ZlcndyaXRlKQ0KICAgICAgICAgIHsgYWRkQ2xhc3ModGhpcy5kaXNwbGF5LmN1cnNvckRpdiwgIkNvZGVNaXJyb3Itb3ZlcndyaXRlIik7IH0NCiAgICAgICAgZWxzZQ0KICAgICAgICAgIHsgcm1DbGFzcyh0aGlzLmRpc3BsYXkuY3Vyc29yRGl2LCAiQ29kZU1pcnJvci1vdmVyd3JpdGUiKTsgfQ0KDQogICAgICAgIHNpZ25hbCh0aGlzLCAib3ZlcndyaXRlVG9nZ2xlIiwgdGhpcywgdGhpcy5zdGF0ZS5vdmVyd3JpdGUpOw0KICAgICAgfSwNCiAgICAgIGhhc0ZvY3VzOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuZGlzcGxheS5pbnB1dC5nZXRGaWVsZCgpID09IGFjdGl2ZUVsdCgpIH0sDQogICAgICBpc1JlYWRPbmx5OiBmdW5jdGlvbigpIHsgcmV0dXJuICEhKHRoaXMub3B0aW9ucy5yZWFkT25seSB8fCB0aGlzLmRvYy5jYW50RWRpdCkgfSwNCg0KICAgICAgc2Nyb2xsVG86IG1ldGhvZE9wKGZ1bmN0aW9uICh4LCB5KSB7IHNjcm9sbFRvQ29vcmRzKHRoaXMsIHgsIHkpOyB9KSwNCiAgICAgIGdldFNjcm9sbEluZm86IGZ1bmN0aW9uKCkgew0KICAgICAgICB2YXIgc2Nyb2xsZXIgPSB0aGlzLmRpc3BsYXkuc2Nyb2xsZXI7DQogICAgICAgIHJldHVybiB7bGVmdDogc2Nyb2xsZXIuc2Nyb2xsTGVmdCwgdG9wOiBzY3JvbGxlci5zY3JvbGxUb3AsDQogICAgICAgICAgICAgICAgaGVpZ2h0OiBzY3JvbGxlci5zY3JvbGxIZWlnaHQgLSBzY3JvbGxHYXAodGhpcykgLSB0aGlzLmRpc3BsYXkuYmFySGVpZ2h0LA0KICAgICAgICAgICAgICAgIHdpZHRoOiBzY3JvbGxlci5zY3JvbGxXaWR0aCAtIHNjcm9sbEdhcCh0aGlzKSAtIHRoaXMuZGlzcGxheS5iYXJXaWR0aCwNCiAgICAgICAgICAgICAgICBjbGllbnRIZWlnaHQ6IGRpc3BsYXlIZWlnaHQodGhpcyksIGNsaWVudFdpZHRoOiBkaXNwbGF5V2lkdGgodGhpcyl9DQogICAgICB9LA0KDQogICAgICBzY3JvbGxJbnRvVmlldzogbWV0aG9kT3AoZnVuY3Rpb24ocmFuZ2UkJDEsIG1hcmdpbikgew0KICAgICAgICBpZiAocmFuZ2UkJDEgPT0gbnVsbCkgew0KICAgICAgICAgIHJhbmdlJCQxID0ge2Zyb206IHRoaXMuZG9jLnNlbC5wcmltYXJ5KCkuaGVhZCwgdG86IG51bGx9Ow0KICAgICAgICAgIGlmIChtYXJnaW4gPT0gbnVsbCkgeyBtYXJnaW4gPSB0aGlzLm9wdGlvbnMuY3Vyc29yU2Nyb2xsTWFyZ2luOyB9DQogICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIHJhbmdlJCQxID09ICJudW1iZXIiKSB7DQogICAgICAgICAgcmFuZ2UkJDEgPSB7ZnJvbTogUG9zKHJhbmdlJCQxLCAwKSwgdG86IG51bGx9Ow0KICAgICAgICB9IGVsc2UgaWYgKHJhbmdlJCQxLmZyb20gPT0gbnVsbCkgew0KICAgICAgICAgIHJhbmdlJCQxID0ge2Zyb206IHJhbmdlJCQxLCB0bzogbnVsbH07DQogICAgICAgIH0NCiAgICAgICAgaWYgKCFyYW5nZSQkMS50bykgeyByYW5nZSQkMS50byA9IHJhbmdlJCQxLmZyb207IH0NCiAgICAgICAgcmFuZ2UkJDEubWFyZ2luID0gbWFyZ2luIHx8IDA7DQoNCiAgICAgICAgaWYgKHJhbmdlJCQxLmZyb20ubGluZSAhPSBudWxsKSB7DQogICAgICAgICAgc2Nyb2xsVG9SYW5nZSh0aGlzLCByYW5nZSQkMSk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgc2Nyb2xsVG9Db29yZHNSYW5nZSh0aGlzLCByYW5nZSQkMS5mcm9tLCByYW5nZSQkMS50bywgcmFuZ2UkJDEubWFyZ2luKTsNCiAgICAgICAgfQ0KICAgICAgfSksDQoNCiAgICAgIHNldFNpemU6IG1ldGhvZE9wKGZ1bmN0aW9uKHdpZHRoLCBoZWlnaHQpIHsNCiAgICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICAgICAgdmFyIGludGVycHJldCA9IGZ1bmN0aW9uICh2YWwpIHsgcmV0dXJuIHR5cGVvZiB2YWwgPT0gIm51bWJlciIgfHwgL15cZCskLy50ZXN0KFN0cmluZyh2YWwpKSA/IHZhbCArICJweCIgOiB2YWw7IH07DQogICAgICAgIGlmICh3aWR0aCAhPSBudWxsKSB7IHRoaXMuZGlzcGxheS53cmFwcGVyLnN0eWxlLndpZHRoID0gaW50ZXJwcmV0KHdpZHRoKTsgfQ0KICAgICAgICBpZiAoaGVpZ2h0ICE9IG51bGwpIHsgdGhpcy5kaXNwbGF5LndyYXBwZXIuc3R5bGUuaGVpZ2h0ID0gaW50ZXJwcmV0KGhlaWdodCk7IH0NCiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5saW5lV3JhcHBpbmcpIHsgY2xlYXJMaW5lTWVhc3VyZW1lbnRDYWNoZSh0aGlzKTsgfQ0KICAgICAgICB2YXIgbGluZU5vJCQxID0gdGhpcy5kaXNwbGF5LnZpZXdGcm9tOw0KICAgICAgICB0aGlzLmRvYy5pdGVyKGxpbmVObyQkMSwgdGhpcy5kaXNwbGF5LnZpZXdUbywgZnVuY3Rpb24gKGxpbmUpIHsNCiAgICAgICAgICBpZiAobGluZS53aWRnZXRzKSB7IGZvciAodmFyIGkgPSAwOyBpIDwgbGluZS53aWRnZXRzLmxlbmd0aDsgaSsrKQ0KICAgICAgICAgICAgeyBpZiAobGluZS53aWRnZXRzW2ldLm5vSFNjcm9sbCkgeyByZWdMaW5lQ2hhbmdlKHRoaXMkMSwgbGluZU5vJCQxLCAid2lkZ2V0Iik7IGJyZWFrIH0gfSB9DQogICAgICAgICAgKytsaW5lTm8kJDE7DQogICAgICAgIH0pOw0KICAgICAgICB0aGlzLmN1ck9wLmZvcmNlVXBkYXRlID0gdHJ1ZTsNCiAgICAgICAgc2lnbmFsKHRoaXMsICJyZWZyZXNoIiwgdGhpcyk7DQogICAgICB9KSwNCg0KICAgICAgb3BlcmF0aW9uOiBmdW5jdGlvbihmKXtyZXR1cm4gcnVuSW5PcCh0aGlzLCBmKX0sDQogICAgICBzdGFydE9wZXJhdGlvbjogZnVuY3Rpb24oKXtyZXR1cm4gc3RhcnRPcGVyYXRpb24odGhpcyl9LA0KICAgICAgZW5kT3BlcmF0aW9uOiBmdW5jdGlvbigpe3JldHVybiBlbmRPcGVyYXRpb24odGhpcyl9LA0KDQogICAgICByZWZyZXNoOiBtZXRob2RPcChmdW5jdGlvbigpIHsNCiAgICAgICAgdmFyIG9sZEhlaWdodCA9IHRoaXMuZGlzcGxheS5jYWNoZWRUZXh0SGVpZ2h0Ow0KICAgICAgICByZWdDaGFuZ2UodGhpcyk7DQogICAgICAgIHRoaXMuY3VyT3AuZm9yY2VVcGRhdGUgPSB0cnVlOw0KICAgICAgICBjbGVhckNhY2hlcyh0aGlzKTsNCiAgICAgICAgc2Nyb2xsVG9Db29yZHModGhpcywgdGhpcy5kb2Muc2Nyb2xsTGVmdCwgdGhpcy5kb2Muc2Nyb2xsVG9wKTsNCiAgICAgICAgdXBkYXRlR3V0dGVyU3BhY2UodGhpcy5kaXNwbGF5KTsNCiAgICAgICAgaWYgKG9sZEhlaWdodCA9PSBudWxsIHx8IE1hdGguYWJzKG9sZEhlaWdodCAtIHRleHRIZWlnaHQodGhpcy5kaXNwbGF5KSkgPiAuNSB8fCB0aGlzLm9wdGlvbnMubGluZVdyYXBwaW5nKQ0KICAgICAgICAgIHsgZXN0aW1hdGVMaW5lSGVpZ2h0cyh0aGlzKTsgfQ0KICAgICAgICBzaWduYWwodGhpcywgInJlZnJlc2giLCB0aGlzKTsNCiAgICAgIH0pLA0KDQogICAgICBzd2FwRG9jOiBtZXRob2RPcChmdW5jdGlvbihkb2MpIHsNCiAgICAgICAgdmFyIG9sZCA9IHRoaXMuZG9jOw0KICAgICAgICBvbGQuY20gPSBudWxsOw0KICAgICAgICAvLyBDYW5jZWwgdGhlIGN1cnJlbnQgdGV4dCBzZWxlY3Rpb24gaWYgYW55ICgjNTgyMSkNCiAgICAgICAgaWYgKHRoaXMuc3RhdGUuc2VsZWN0aW5nVGV4dCkgeyB0aGlzLnN0YXRlLnNlbGVjdGluZ1RleHQoKTsgfQ0KICAgICAgICBhdHRhY2hEb2ModGhpcywgZG9jKTsNCiAgICAgICAgY2xlYXJDYWNoZXModGhpcyk7DQogICAgICAgIHRoaXMuZGlzcGxheS5pbnB1dC5yZXNldCgpOw0KICAgICAgICBzY3JvbGxUb0Nvb3Jkcyh0aGlzLCBkb2Muc2Nyb2xsTGVmdCwgZG9jLnNjcm9sbFRvcCk7DQogICAgICAgIHRoaXMuY3VyT3AuZm9yY2VTY3JvbGwgPSB0cnVlOw0KICAgICAgICBzaWduYWxMYXRlcih0aGlzLCAic3dhcERvYyIsIHRoaXMsIG9sZCk7DQogICAgICAgIHJldHVybiBvbGQNCiAgICAgIH0pLA0KDQogICAgICBwaHJhc2U6IGZ1bmN0aW9uKHBocmFzZVRleHQpIHsNCiAgICAgICAgdmFyIHBocmFzZXMgPSB0aGlzLm9wdGlvbnMucGhyYXNlczsNCiAgICAgICAgcmV0dXJuIHBocmFzZXMgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHBocmFzZXMsIHBocmFzZVRleHQpID8gcGhyYXNlc1twaHJhc2VUZXh0XSA6IHBocmFzZVRleHQNCiAgICAgIH0sDQoNCiAgICAgIGdldElucHV0RmllbGQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS5pbnB1dC5nZXRGaWVsZCgpfSwNCiAgICAgIGdldFdyYXBwZXJFbGVtZW50OiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpc3BsYXkud3JhcHBlcn0sDQogICAgICBnZXRTY3JvbGxlckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZGlzcGxheS5zY3JvbGxlcn0sDQogICAgICBnZXRHdXR0ZXJFbGVtZW50OiBmdW5jdGlvbigpe3JldHVybiB0aGlzLmRpc3BsYXkuZ3V0dGVyc30NCiAgICB9Ow0KICAgIGV2ZW50TWl4aW4oQ29kZU1pcnJvcik7DQoNCiAgICBDb2RlTWlycm9yLnJlZ2lzdGVySGVscGVyID0gZnVuY3Rpb24odHlwZSwgbmFtZSwgdmFsdWUpIHsNCiAgICAgIGlmICghaGVscGVycy5oYXNPd25Qcm9wZXJ0eSh0eXBlKSkgeyBoZWxwZXJzW3R5cGVdID0gQ29kZU1pcnJvclt0eXBlXSA9IHtfZ2xvYmFsOiBbXX07IH0NCiAgICAgIGhlbHBlcnNbdHlwZV1bbmFtZV0gPSB2YWx1ZTsNCiAgICB9Ow0KICAgIENvZGVNaXJyb3IucmVnaXN0ZXJHbG9iYWxIZWxwZXIgPSBmdW5jdGlvbih0eXBlLCBuYW1lLCBwcmVkaWNhdGUsIHZhbHVlKSB7DQogICAgICBDb2RlTWlycm9yLnJlZ2lzdGVySGVscGVyKHR5cGUsIG5hbWUsIHZhbHVlKTsNCiAgICAgIGhlbHBlcnNbdHlwZV0uX2dsb2JhbC5wdXNoKHtwcmVkOiBwcmVkaWNhdGUsIHZhbDogdmFsdWV9KTsNCiAgICB9Ow0KICB9DQoNCiAgLy8gVXNlZCBmb3IgaG9yaXpvbnRhbCByZWxhdGl2ZSBtb3Rpb24uIERpciBpcyAtMSBvciAxIChsZWZ0IG9yDQogIC8vIHJpZ2h0KSwgdW5pdCBjYW4gYmUgImNoYXIiLCAiY29sdW1uIiAobGlrZSBjaGFyLCBidXQgZG9lc24ndA0KICAvLyBjcm9zcyBsaW5lIGJvdW5kYXJpZXMpLCAid29yZCIgKGFjcm9zcyBuZXh0IHdvcmQpLCBvciAiZ3JvdXAiICh0bw0KICAvLyB0aGUgc3RhcnQgb2YgbmV4dCBncm91cCBvZiB3b3JkIG9yIG5vbi13b3JkLW5vbi13aGl0ZXNwYWNlDQogIC8vIGNoYXJzKS4gVGhlIHZpc3VhbGx5IHBhcmFtIGNvbnRyb2xzIHdoZXRoZXIsIGluIHJpZ2h0LXRvLWxlZnQNCiAgLy8gdGV4dCwgZGlyZWN0aW9uIDEgbWVhbnMgdG8gbW92ZSB0b3dhcmRzIHRoZSBuZXh0IGluZGV4IGluIHRoZQ0KICAvLyBzdHJpbmcsIG9yIHRvd2FyZHMgdGhlIGNoYXJhY3RlciB0byB0aGUgcmlnaHQgb2YgdGhlIGN1cnJlbnQNCiAgLy8gcG9zaXRpb24uIFRoZSByZXN1bHRpbmcgcG9zaXRpb24gd2lsbCBoYXZlIGEgaGl0U2lkZT10cnVlDQogIC8vIHByb3BlcnR5IGlmIGl0IHJlYWNoZWQgdGhlIGVuZCBvZiB0aGUgZG9jdW1lbnQuDQogIGZ1bmN0aW9uIGZpbmRQb3NIKGRvYywgcG9zLCBkaXIsIHVuaXQsIHZpc3VhbGx5KSB7DQogICAgdmFyIG9sZFBvcyA9IHBvczsNCiAgICB2YXIgb3JpZ0RpciA9IGRpcjsNCiAgICB2YXIgbGluZU9iaiA9IGdldExpbmUoZG9jLCBwb3MubGluZSk7DQogICAgdmFyIGxpbmVEaXIgPSB2aXN1YWxseSAmJiBkb2MuZGlyZWN0aW9uID09ICJydGwiID8gLWRpciA6IGRpcjsNCiAgICBmdW5jdGlvbiBmaW5kTmV4dExpbmUoKSB7DQogICAgICB2YXIgbCA9IHBvcy5saW5lICsgbGluZURpcjsNCiAgICAgIGlmIChsIDwgZG9jLmZpcnN0IHx8IGwgPj0gZG9jLmZpcnN0ICsgZG9jLnNpemUpIHsgcmV0dXJuIGZhbHNlIH0NCiAgICAgIHBvcyA9IG5ldyBQb3MobCwgcG9zLmNoLCBwb3Muc3RpY2t5KTsNCiAgICAgIHJldHVybiBsaW5lT2JqID0gZ2V0TGluZShkb2MsIGwpDQogICAgfQ0KICAgIGZ1bmN0aW9uIG1vdmVPbmNlKGJvdW5kVG9MaW5lKSB7DQogICAgICB2YXIgbmV4dDsNCiAgICAgIGlmICh2aXN1YWxseSkgew0KICAgICAgICBuZXh0ID0gbW92ZVZpc3VhbGx5KGRvYy5jbSwgbGluZU9iaiwgcG9zLCBkaXIpOw0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgbmV4dCA9IG1vdmVMb2dpY2FsbHkobGluZU9iaiwgcG9zLCBkaXIpOw0KICAgICAgfQ0KICAgICAgaWYgKG5leHQgPT0gbnVsbCkgew0KICAgICAgICBpZiAoIWJvdW5kVG9MaW5lICYmIGZpbmROZXh0TGluZSgpKQ0KICAgICAgICAgIHsgcG9zID0gZW5kT2ZMaW5lKHZpc3VhbGx5LCBkb2MuY20sIGxpbmVPYmosIHBvcy5saW5lLCBsaW5lRGlyKTsgfQ0KICAgICAgICBlbHNlDQogICAgICAgICAgeyByZXR1cm4gZmFsc2UgfQ0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgcG9zID0gbmV4dDsNCiAgICAgIH0NCiAgICAgIHJldHVybiB0cnVlDQogICAgfQ0KDQogICAgaWYgKHVuaXQgPT0gImNoYXIiKSB7DQogICAgICBtb3ZlT25jZSgpOw0KICAgIH0gZWxzZSBpZiAodW5pdCA9PSAiY29sdW1uIikgew0KICAgICAgbW92ZU9uY2UodHJ1ZSk7DQogICAgfSBlbHNlIGlmICh1bml0ID09ICJ3b3JkIiB8fCB1bml0ID09ICJncm91cCIpIHsNCiAgICAgIHZhciBzYXdUeXBlID0gbnVsbCwgZ3JvdXAgPSB1bml0ID09ICJncm91cCI7DQogICAgICB2YXIgaGVscGVyID0gZG9jLmNtICYmIGRvYy5jbS5nZXRIZWxwZXIocG9zLCAid29yZENoYXJzIik7DQogICAgICBmb3IgKHZhciBmaXJzdCA9IHRydWU7OyBmaXJzdCA9IGZhbHNlKSB7DQogICAgICAgIGlmIChkaXIgPCAwICYmICFtb3ZlT25jZSghZmlyc3QpKSB7IGJyZWFrIH0NCiAgICAgICAgdmFyIGN1ciA9IGxpbmVPYmoudGV4dC5jaGFyQXQocG9zLmNoKSB8fCAiXG4iOw0KICAgICAgICB2YXIgdHlwZSA9IGlzV29yZENoYXIoY3VyLCBoZWxwZXIpID8gInciDQogICAgICAgICAgOiBncm91cCAmJiBjdXIgPT0gIlxuIiA/ICJuIg0KICAgICAgICAgIDogIWdyb3VwIHx8IC9ccy8udGVzdChjdXIpID8gbnVsbA0KICAgICAgICAgIDogInAiOw0KICAgICAgICBpZiAoZ3JvdXAgJiYgIWZpcnN0ICYmICF0eXBlKSB7IHR5cGUgPSAicyI7IH0NCiAgICAgICAgaWYgKHNhd1R5cGUgJiYgc2F3VHlwZSAhPSB0eXBlKSB7DQogICAgICAgICAgaWYgKGRpciA8IDApIHtkaXIgPSAxOyBtb3ZlT25jZSgpOyBwb3Muc3RpY2t5ID0gImFmdGVyIjt9DQogICAgICAgICAgYnJlYWsNCiAgICAgICAgfQ0KDQogICAgICAgIGlmICh0eXBlKSB7IHNhd1R5cGUgPSB0eXBlOyB9DQogICAgICAgIGlmIChkaXIgPiAwICYmICFtb3ZlT25jZSghZmlyc3QpKSB7IGJyZWFrIH0NCiAgICAgIH0NCiAgICB9DQogICAgdmFyIHJlc3VsdCA9IHNraXBBdG9taWMoZG9jLCBwb3MsIG9sZFBvcywgb3JpZ0RpciwgdHJ1ZSk7DQogICAgaWYgKGVxdWFsQ3Vyc29yUG9zKG9sZFBvcywgcmVzdWx0KSkgeyByZXN1bHQuaGl0U2lkZSA9IHRydWU7IH0NCiAgICByZXR1cm4gcmVzdWx0DQogIH0NCg0KICAvLyBGb3IgcmVsYXRpdmUgdmVydGljYWwgbW92ZW1lbnQuIERpciBtYXkgYmUgLTEgb3IgMS4gVW5pdCBjYW4gYmUNCiAgLy8gInBhZ2UiIG9yICJsaW5lIi4gVGhlIHJlc3VsdGluZyBwb3NpdGlvbiB3aWxsIGhhdmUgYSBoaXRTaWRlPXRydWUNCiAgLy8gcHJvcGVydHkgaWYgaXQgcmVhY2hlZCB0aGUgZW5kIG9mIHRoZSBkb2N1bWVudC4NCiAgZnVuY3Rpb24gZmluZFBvc1YoY20sIHBvcywgZGlyLCB1bml0KSB7DQogICAgdmFyIGRvYyA9IGNtLmRvYywgeCA9IHBvcy5sZWZ0LCB5Ow0KICAgIGlmICh1bml0ID09ICJwYWdlIikgew0KICAgICAgdmFyIHBhZ2VTaXplID0gTWF0aC5taW4oY20uZGlzcGxheS53cmFwcGVyLmNsaWVudEhlaWdodCwgd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQpOw0KICAgICAgdmFyIG1vdmVBbW91bnQgPSBNYXRoLm1heChwYWdlU2l6ZSAtIC41ICogdGV4dEhlaWdodChjbS5kaXNwbGF5KSwgMyk7DQogICAgICB5ID0gKGRpciA+IDAgPyBwb3MuYm90dG9tIDogcG9zLnRvcCkgKyBkaXIgKiBtb3ZlQW1vdW50Ow0KDQogICAgfSBlbHNlIGlmICh1bml0ID09ICJsaW5lIikgew0KICAgICAgeSA9IGRpciA+IDAgPyBwb3MuYm90dG9tICsgMyA6IHBvcy50b3AgLSAzOw0KICAgIH0NCiAgICB2YXIgdGFyZ2V0Ow0KICAgIGZvciAoOzspIHsNCiAgICAgIHRhcmdldCA9IGNvb3Jkc0NoYXIoY20sIHgsIHkpOw0KICAgICAgaWYgKCF0YXJnZXQub3V0c2lkZSkgeyBicmVhayB9DQogICAgICBpZiAoZGlyIDwgMCA/IHkgPD0gMCA6IHkgPj0gZG9jLmhlaWdodCkgeyB0YXJnZXQuaGl0U2lkZSA9IHRydWU7IGJyZWFrIH0NCiAgICAgIHkgKz0gZGlyICogNTsNCiAgICB9DQogICAgcmV0dXJuIHRhcmdldA0KICB9DQoNCiAgLy8gQ09OVEVOVEVESVRBQkxFIElOUFVUIFNUWUxFDQoNCiAgdmFyIENvbnRlbnRFZGl0YWJsZUlucHV0ID0gZnVuY3Rpb24oY20pIHsNCiAgICB0aGlzLmNtID0gY207DQogICAgdGhpcy5sYXN0QW5jaG9yTm9kZSA9IHRoaXMubGFzdEFuY2hvck9mZnNldCA9IHRoaXMubGFzdEZvY3VzTm9kZSA9IHRoaXMubGFzdEZvY3VzT2Zmc2V0ID0gbnVsbDsNCiAgICB0aGlzLnBvbGxpbmcgPSBuZXcgRGVsYXllZCgpOw0KICAgIHRoaXMuY29tcG9zaW5nID0gbnVsbDsNCiAgICB0aGlzLmdyYWNlUGVyaW9kID0gZmFsc2U7DQogICAgdGhpcy5yZWFkRE9NVGltZW91dCA9IG51bGw7DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZGlzcGxheSkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtOw0KICAgIHZhciBkaXYgPSBpbnB1dC5kaXYgPSBkaXNwbGF5LmxpbmVEaXY7DQogICAgZGlzYWJsZUJyb3dzZXJNYWdpYyhkaXYsIGNtLm9wdGlvbnMuc3BlbGxjaGVjaywgY20ub3B0aW9ucy5hdXRvY29ycmVjdCwgY20ub3B0aW9ucy5hdXRvY2FwaXRhbGl6ZSk7DQoNCiAgICBvbihkaXYsICJwYXN0ZSIsIGZ1bmN0aW9uIChlKSB7DQogICAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpIHx8IGhhbmRsZVBhc3RlKGUsIGNtKSkgeyByZXR1cm4gfQ0KICAgICAgLy8gSUUgZG9lc24ndCBmaXJlIGlucHV0IGV2ZW50cywgc28gd2Ugc2NoZWR1bGUgYSByZWFkIGZvciB0aGUgcGFzdGVkIGNvbnRlbnQgaW4gdGhpcyB3YXkNCiAgICAgIGlmIChpZV92ZXJzaW9uIDw9IDExKSB7IHNldFRpbWVvdXQob3BlcmF0aW9uKGNtLCBmdW5jdGlvbiAoKSB7IHJldHVybiB0aGlzJDEudXBkYXRlRnJvbURPTSgpOyB9KSwgMjApOyB9DQogICAgfSk7DQoNCiAgICBvbihkaXYsICJjb21wb3NpdGlvbnN0YXJ0IiwgZnVuY3Rpb24gKGUpIHsNCiAgICAgIHRoaXMkMS5jb21wb3NpbmcgPSB7ZGF0YTogZS5kYXRhLCBkb25lOiBmYWxzZX07DQogICAgfSk7DQogICAgb24oZGl2LCAiY29tcG9zaXRpb251cGRhdGUiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgaWYgKCF0aGlzJDEuY29tcG9zaW5nKSB7IHRoaXMkMS5jb21wb3NpbmcgPSB7ZGF0YTogZS5kYXRhLCBkb25lOiBmYWxzZX07IH0NCiAgICB9KTsNCiAgICBvbihkaXYsICJjb21wb3NpdGlvbmVuZCIsIGZ1bmN0aW9uIChlKSB7DQogICAgICBpZiAodGhpcyQxLmNvbXBvc2luZykgew0KICAgICAgICBpZiAoZS5kYXRhICE9IHRoaXMkMS5jb21wb3NpbmcuZGF0YSkgeyB0aGlzJDEucmVhZEZyb21ET01Tb29uKCk7IH0NCiAgICAgICAgdGhpcyQxLmNvbXBvc2luZy5kb25lID0gdHJ1ZTsNCiAgICAgIH0NCiAgICB9KTsNCg0KICAgIG9uKGRpdiwgInRvdWNoc3RhcnQiLCBmdW5jdGlvbiAoKSB7IHJldHVybiBpbnB1dC5mb3JjZUNvbXBvc2l0aW9uRW5kKCk7IH0pOw0KDQogICAgb24oZGl2LCAiaW5wdXQiLCBmdW5jdGlvbiAoKSB7DQogICAgICBpZiAoIXRoaXMkMS5jb21wb3NpbmcpIHsgdGhpcyQxLnJlYWRGcm9tRE9NU29vbigpOyB9DQogICAgfSk7DQoNCiAgICBmdW5jdGlvbiBvbkNvcHlDdXQoZSkgew0KICAgICAgaWYgKHNpZ25hbERPTUV2ZW50KGNtLCBlKSkgeyByZXR1cm4gfQ0KICAgICAgaWYgKGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkpIHsNCiAgICAgICAgc2V0TGFzdENvcGllZCh7bGluZVdpc2U6IGZhbHNlLCB0ZXh0OiBjbS5nZXRTZWxlY3Rpb25zKCl9KTsNCiAgICAgICAgaWYgKGUudHlwZSA9PSAiY3V0IikgeyBjbS5yZXBsYWNlU2VsZWN0aW9uKCIiLCBudWxsLCAiY3V0Iik7IH0NCiAgICAgIH0gZWxzZSBpZiAoIWNtLm9wdGlvbnMubGluZVdpc2VDb3B5Q3V0KSB7DQogICAgICAgIHJldHVybg0KICAgICAgfSBlbHNlIHsNCiAgICAgICAgdmFyIHJhbmdlcyA9IGNvcHlhYmxlUmFuZ2VzKGNtKTsNCiAgICAgICAgc2V0TGFzdENvcGllZCh7bGluZVdpc2U6IHRydWUsIHRleHQ6IHJhbmdlcy50ZXh0fSk7DQogICAgICAgIGlmIChlLnR5cGUgPT0gImN1dCIpIHsNCiAgICAgICAgICBjbS5vcGVyYXRpb24oZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY20uc2V0U2VsZWN0aW9ucyhyYW5nZXMucmFuZ2VzLCAwLCBzZWxfZG9udFNjcm9sbCk7DQogICAgICAgICAgICBjbS5yZXBsYWNlU2VsZWN0aW9uKCIiLCBudWxsLCAiY3V0Iik7DQogICAgICAgICAgfSk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIGlmIChlLmNsaXBib2FyZERhdGEpIHsNCiAgICAgICAgZS5jbGlwYm9hcmREYXRhLmNsZWFyRGF0YSgpOw0KICAgICAgICB2YXIgY29udGVudCA9IGxhc3RDb3BpZWQudGV4dC5qb2luKCJcbiIpOw0KICAgICAgICAvLyBpT1MgZXhwb3NlcyB0aGUgY2xpcGJvYXJkIEFQSSwgYnV0IHNlZW1zIHRvIGRpc2NhcmQgY29udGVudCBpbnNlcnRlZCBpbnRvIGl0DQogICAgICAgIGUuY2xpcGJvYXJkRGF0YS5zZXREYXRhKCJUZXh0IiwgY29udGVudCk7DQogICAgICAgIGlmIChlLmNsaXBib2FyZERhdGEuZ2V0RGF0YSgiVGV4dCIpID09IGNvbnRlbnQpIHsNCiAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7DQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vIE9sZC1mYXNoaW9uZWQgYnJpZWZseS1mb2N1cy1hLXRleHRhcmVhIGhhY2sNCiAgICAgIHZhciBrbHVkZ2UgPSBoaWRkZW5UZXh0YXJlYSgpLCB0ZSA9IGtsdWRnZS5maXJzdENoaWxkOw0KICAgICAgY20uZGlzcGxheS5saW5lU3BhY2UuaW5zZXJ0QmVmb3JlKGtsdWRnZSwgY20uZGlzcGxheS5saW5lU3BhY2UuZmlyc3RDaGlsZCk7DQogICAgICB0ZS52YWx1ZSA9IGxhc3RDb3BpZWQudGV4dC5qb2luKCJcbiIpOw0KICAgICAgdmFyIGhhZEZvY3VzID0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudDsNCiAgICAgIHNlbGVjdElucHV0KHRlKTsNCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgICBjbS5kaXNwbGF5LmxpbmVTcGFjZS5yZW1vdmVDaGlsZChrbHVkZ2UpOw0KICAgICAgICBoYWRGb2N1cy5mb2N1cygpOw0KICAgICAgICBpZiAoaGFkRm9jdXMgPT0gZGl2KSB7IGlucHV0LnNob3dQcmltYXJ5U2VsZWN0aW9uKCk7IH0NCiAgICAgIH0sIDUwKTsNCiAgICB9DQogICAgb24oZGl2LCAiY29weSIsIG9uQ29weUN1dCk7DQogICAgb24oZGl2LCAiY3V0Iiwgb25Db3B5Q3V0KTsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuc2NyZWVuUmVhZGVyTGFiZWxDaGFuZ2VkID0gZnVuY3Rpb24gKGxhYmVsKSB7DQogICAgLy8gTGFiZWwgZm9yIHNjcmVlbnJlYWRlcnMsIGFjY2Vzc2liaWxpdHkNCiAgICBpZihsYWJlbCkgew0KICAgICAgdGhpcy5kaXYuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbGFiZWwpOw0KICAgIH0gZWxzZSB7DQogICAgICB0aGlzLmRpdi5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsNCiAgICB9DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnByZXBhcmVTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIHJlc3VsdCA9IHByZXBhcmVTZWxlY3Rpb24odGhpcy5jbSwgZmFsc2UpOw0KICAgIHJlc3VsdC5mb2N1cyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgPT0gdGhpcy5kaXY7DQogICAgcmV0dXJuIHJlc3VsdA0KICB9Ow0KDQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5zaG93U2VsZWN0aW9uID0gZnVuY3Rpb24gKGluZm8sIHRha2VGb2N1cykgew0KICAgIGlmICghaW5mbyB8fCAhdGhpcy5jbS5kaXNwbGF5LnZpZXcubGVuZ3RoKSB7IHJldHVybiB9DQogICAgaWYgKGluZm8uZm9jdXMgfHwgdGFrZUZvY3VzKSB7IHRoaXMuc2hvd1ByaW1hcnlTZWxlY3Rpb24oKTsgfQ0KICAgIHRoaXMuc2hvd011bHRpcGxlU2VsZWN0aW9ucyhpbmZvKTsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuZ2V0U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgIHJldHVybiB0aGlzLmNtLmRpc3BsYXkud3JhcHBlci5vd25lckRvY3VtZW50LmdldFNlbGVjdGlvbigpDQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnNob3dQcmltYXJ5U2VsZWN0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgIHZhciBzZWwgPSB0aGlzLmdldFNlbGVjdGlvbigpLCBjbSA9IHRoaXMuY20sIHByaW0gPSBjbS5kb2Muc2VsLnByaW1hcnkoKTsNCiAgICB2YXIgZnJvbSA9IHByaW0uZnJvbSgpLCB0byA9IHByaW0udG8oKTsNCg0KICAgIGlmIChjbS5kaXNwbGF5LnZpZXdUbyA9PSBjbS5kaXNwbGF5LnZpZXdGcm9tIHx8IGZyb20ubGluZSA+PSBjbS5kaXNwbGF5LnZpZXdUbyB8fCB0by5saW5lIDwgY20uZGlzcGxheS52aWV3RnJvbSkgew0KICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpOw0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgdmFyIGN1ckFuY2hvciA9IGRvbVRvUG9zKGNtLCBzZWwuYW5jaG9yTm9kZSwgc2VsLmFuY2hvck9mZnNldCk7DQogICAgdmFyIGN1ckZvY3VzID0gZG9tVG9Qb3MoY20sIHNlbC5mb2N1c05vZGUsIHNlbC5mb2N1c09mZnNldCk7DQogICAgaWYgKGN1ckFuY2hvciAmJiAhY3VyQW5jaG9yLmJhZCAmJiBjdXJGb2N1cyAmJiAhY3VyRm9jdXMuYmFkICYmDQogICAgICAgIGNtcChtaW5Qb3MoY3VyQW5jaG9yLCBjdXJGb2N1cyksIGZyb20pID09IDAgJiYNCiAgICAgICAgY21wKG1heFBvcyhjdXJBbmNob3IsIGN1ckZvY3VzKSwgdG8pID09IDApDQogICAgICB7IHJldHVybiB9DQoNCiAgICB2YXIgdmlldyA9IGNtLmRpc3BsYXkudmlldzsNCiAgICB2YXIgc3RhcnQgPSAoZnJvbS5saW5lID49IGNtLmRpc3BsYXkudmlld0Zyb20gJiYgcG9zVG9ET00oY20sIGZyb20pKSB8fA0KICAgICAgICB7bm9kZTogdmlld1swXS5tZWFzdXJlLm1hcFsyXSwgb2Zmc2V0OiAwfTsNCiAgICB2YXIgZW5kID0gdG8ubGluZSA8IGNtLmRpc3BsYXkudmlld1RvICYmIHBvc1RvRE9NKGNtLCB0byk7DQogICAgaWYgKCFlbmQpIHsNCiAgICAgIHZhciBtZWFzdXJlID0gdmlld1t2aWV3Lmxlbmd0aCAtIDFdLm1lYXN1cmU7DQogICAgICB2YXIgbWFwJCQxID0gbWVhc3VyZS5tYXBzID8gbWVhc3VyZS5tYXBzW21lYXN1cmUubWFwcy5sZW5ndGggLSAxXSA6IG1lYXN1cmUubWFwOw0KICAgICAgZW5kID0ge25vZGU6IG1hcCQkMVttYXAkJDEubGVuZ3RoIC0gMV0sIG9mZnNldDogbWFwJCQxW21hcCQkMS5sZW5ndGggLSAyXSAtIG1hcCQkMVttYXAkJDEubGVuZ3RoIC0gM119Ow0KICAgIH0NCg0KICAgIGlmICghc3RhcnQgfHwgIWVuZCkgew0KICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpOw0KICAgICAgcmV0dXJuDQogICAgfQ0KDQogICAgdmFyIG9sZCA9IHNlbC5yYW5nZUNvdW50ICYmIHNlbC5nZXRSYW5nZUF0KDApLCBybmc7DQogICAgdHJ5IHsgcm5nID0gcmFuZ2Uoc3RhcnQubm9kZSwgc3RhcnQub2Zmc2V0LCBlbmQub2Zmc2V0LCBlbmQubm9kZSk7IH0NCiAgICBjYXRjaChlKSB7fSAvLyBPdXIgbW9kZWwgb2YgdGhlIERPTSBtaWdodCBiZSBvdXRkYXRlZCwgaW4gd2hpY2ggY2FzZSB0aGUgcmFuZ2Ugd2UgdHJ5IHRvIHNldCBjYW4gYmUgaW1wb3NzaWJsZQ0KICAgIGlmIChybmcpIHsNCiAgICAgIGlmICghZ2Vja28gJiYgY20uc3RhdGUuZm9jdXNlZCkgew0KICAgICAgICBzZWwuY29sbGFwc2Uoc3RhcnQubm9kZSwgc3RhcnQub2Zmc2V0KTsNCiAgICAgICAgaWYgKCFybmcuY29sbGFwc2VkKSB7DQogICAgICAgICAgc2VsLnJlbW92ZUFsbFJhbmdlcygpOw0KICAgICAgICAgIHNlbC5hZGRSYW5nZShybmcpOw0KICAgICAgICB9DQogICAgICB9IGVsc2Ugew0KICAgICAgICBzZWwucmVtb3ZlQWxsUmFuZ2VzKCk7DQogICAgICAgIHNlbC5hZGRSYW5nZShybmcpOw0KICAgICAgfQ0KICAgICAgaWYgKG9sZCAmJiBzZWwuYW5jaG9yTm9kZSA9PSBudWxsKSB7IHNlbC5hZGRSYW5nZShvbGQpOyB9DQogICAgICBlbHNlIGlmIChnZWNrbykgeyB0aGlzLnN0YXJ0R3JhY2VQZXJpb2QoKTsgfQ0KICAgIH0NCiAgICB0aGlzLnJlbWVtYmVyU2VsZWN0aW9uKCk7DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnN0YXJ0R3JhY2VQZXJpb2QgPSBmdW5jdGlvbiAoKSB7DQogICAgICB2YXIgdGhpcyQxID0gdGhpczsNCg0KICAgIGNsZWFyVGltZW91dCh0aGlzLmdyYWNlUGVyaW9kKTsNCiAgICB0aGlzLmdyYWNlUGVyaW9kID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICB0aGlzJDEuZ3JhY2VQZXJpb2QgPSBmYWxzZTsNCiAgICAgIGlmICh0aGlzJDEuc2VsZWN0aW9uQ2hhbmdlZCgpKQ0KICAgICAgICB7IHRoaXMkMS5jbS5vcGVyYXRpb24oZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcyQxLmNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlOyB9KTsgfQ0KICAgIH0sIDIwKTsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuc2hvd011bHRpcGxlU2VsZWN0aW9ucyA9IGZ1bmN0aW9uIChpbmZvKSB7DQogICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQodGhpcy5jbS5kaXNwbGF5LmN1cnNvckRpdiwgaW5mby5jdXJzb3JzKTsNCiAgICByZW1vdmVDaGlsZHJlbkFuZEFkZCh0aGlzLmNtLmRpc3BsYXkuc2VsZWN0aW9uRGl2LCBpbmZvLnNlbGVjdGlvbik7DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnJlbWVtYmVyU2VsZWN0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgIHZhciBzZWwgPSB0aGlzLmdldFNlbGVjdGlvbigpOw0KICAgIHRoaXMubGFzdEFuY2hvck5vZGUgPSBzZWwuYW5jaG9yTm9kZTsgdGhpcy5sYXN0QW5jaG9yT2Zmc2V0ID0gc2VsLmFuY2hvck9mZnNldDsNCiAgICB0aGlzLmxhc3RGb2N1c05vZGUgPSBzZWwuZm9jdXNOb2RlOyB0aGlzLmxhc3RGb2N1c09mZnNldCA9IHNlbC5mb2N1c09mZnNldDsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuc2VsZWN0aW9uSW5FZGl0b3IgPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIHNlbCA9IHRoaXMuZ2V0U2VsZWN0aW9uKCk7DQogICAgaWYgKCFzZWwucmFuZ2VDb3VudCkgeyByZXR1cm4gZmFsc2UgfQ0KICAgIHZhciBub2RlID0gc2VsLmdldFJhbmdlQXQoMCkuY29tbW9uQW5jZXN0b3JDb250YWluZXI7DQogICAgcmV0dXJuIGNvbnRhaW5zKHRoaXMuZGl2LCBub2RlKQ0KICB9Ow0KDQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5mb2N1cyA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAodGhpcy5jbS5vcHRpb25zLnJlYWRPbmx5ICE9ICJub2N1cnNvciIpIHsNCiAgICAgIGlmICghdGhpcy5zZWxlY3Rpb25JbkVkaXRvcigpIHx8IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQgIT0gdGhpcy5kaXYpDQogICAgICAgIHsgdGhpcy5zaG93U2VsZWN0aW9uKHRoaXMucHJlcGFyZVNlbGVjdGlvbigpLCB0cnVlKTsgfQ0KICAgICAgdGhpcy5kaXYuZm9jdXMoKTsNCiAgICB9DQogIH07DQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5ibHVyID0gZnVuY3Rpb24gKCkgeyB0aGlzLmRpdi5ibHVyKCk7IH07DQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5nZXRGaWVsZCA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXMuZGl2IH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnN1cHBvcnRzVG91Y2ggPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0cnVlIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnJlY2VpdmVkRm9jdXMgPSBmdW5jdGlvbiAoKSB7DQogICAgdmFyIGlucHV0ID0gdGhpczsNCiAgICBpZiAodGhpcy5zZWxlY3Rpb25JbkVkaXRvcigpKQ0KICAgICAgeyB0aGlzLnBvbGxTZWxlY3Rpb24oKTsgfQ0KICAgIGVsc2UNCiAgICAgIHsgcnVuSW5PcCh0aGlzLmNtLCBmdW5jdGlvbiAoKSB7IHJldHVybiBpbnB1dC5jbS5jdXJPcC5zZWxlY3Rpb25DaGFuZ2VkID0gdHJ1ZTsgfSk7IH0NCg0KICAgIGZ1bmN0aW9uIHBvbGwoKSB7DQogICAgICBpZiAoaW5wdXQuY20uc3RhdGUuZm9jdXNlZCkgew0KICAgICAgICBpbnB1dC5wb2xsU2VsZWN0aW9uKCk7DQogICAgICAgIGlucHV0LnBvbGxpbmcuc2V0KGlucHV0LmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBwb2xsKTsNCiAgICAgIH0NCiAgICB9DQogICAgdGhpcy5wb2xsaW5nLnNldCh0aGlzLmNtLm9wdGlvbnMucG9sbEludGVydmFsLCBwb2xsKTsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuc2VsZWN0aW9uQ2hhbmdlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgc2VsID0gdGhpcy5nZXRTZWxlY3Rpb24oKTsNCiAgICByZXR1cm4gc2VsLmFuY2hvck5vZGUgIT0gdGhpcy5sYXN0QW5jaG9yTm9kZSB8fCBzZWwuYW5jaG9yT2Zmc2V0ICE9IHRoaXMubGFzdEFuY2hvck9mZnNldCB8fA0KICAgICAgc2VsLmZvY3VzTm9kZSAhPSB0aGlzLmxhc3RGb2N1c05vZGUgfHwgc2VsLmZvY3VzT2Zmc2V0ICE9IHRoaXMubGFzdEZvY3VzT2Zmc2V0DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnBvbGxTZWxlY3Rpb24gPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKHRoaXMucmVhZERPTVRpbWVvdXQgIT0gbnVsbCB8fCB0aGlzLmdyYWNlUGVyaW9kIHx8ICF0aGlzLnNlbGVjdGlvbkNoYW5nZWQoKSkgeyByZXR1cm4gfQ0KICAgIHZhciBzZWwgPSB0aGlzLmdldFNlbGVjdGlvbigpLCBjbSA9IHRoaXMuY207DQogICAgLy8gT24gQW5kcm9pZCBDaHJvbWUgKHZlcnNpb24gNTYsIGF0IGxlYXN0KSwgYmFja3NwYWNpbmcgaW50byBhbg0KICAgIC8vIHVuZWRpdGFibGUgYmxvY2sgZWxlbWVudCB3aWxsIHB1dCB0aGUgY3Vyc29yIGluIHRoYXQgZWxlbWVudCwNCiAgICAvLyBhbmQgdGhlbiwgYmVjYXVzZSBpdCdzIG5vdCBlZGl0YWJsZSwgaGlkZSB0aGUgdmlydHVhbCBrZXlib2FyZC4NCiAgICAvLyBCZWNhdXNlIEFuZHJvaWQgZG9lc24ndCBhbGxvdyB1cyB0byBhY3R1YWxseSBkZXRlY3QgYmFja3NwYWNlDQogICAgLy8gcHJlc3NlcyBpbiBhIHNhbmUgd2F5LCB0aGlzIGNvZGUgY2hlY2tzIGZvciB3aGVuIHRoYXQgaGFwcGVucw0KICAgIC8vIGFuZCBzaW11bGF0ZXMgYSBiYWNrc3BhY2UgcHJlc3MgaW4gdGhpcyBjYXNlLg0KICAgIGlmIChhbmRyb2lkICYmIGNocm9tZSAmJiB0aGlzLmNtLmRpc3BsYXkuZ3V0dGVyU3BlY3MubGVuZ3RoICYmIGlzSW5HdXR0ZXIoc2VsLmFuY2hvck5vZGUpKSB7DQogICAgICB0aGlzLmNtLnRyaWdnZXJPbktleURvd24oe3R5cGU6ICJrZXlkb3duIiwga2V5Q29kZTogOCwgcHJldmVudERlZmF1bHQ6IE1hdGguYWJzfSk7DQogICAgICB0aGlzLmJsdXIoKTsNCiAgICAgIHRoaXMuZm9jdXMoKTsNCiAgICAgIHJldHVybg0KICAgIH0NCiAgICBpZiAodGhpcy5jb21wb3NpbmcpIHsgcmV0dXJuIH0NCiAgICB0aGlzLnJlbWVtYmVyU2VsZWN0aW9uKCk7DQogICAgdmFyIGFuY2hvciA9IGRvbVRvUG9zKGNtLCBzZWwuYW5jaG9yTm9kZSwgc2VsLmFuY2hvck9mZnNldCk7DQogICAgdmFyIGhlYWQgPSBkb21Ub1BvcyhjbSwgc2VsLmZvY3VzTm9kZSwgc2VsLmZvY3VzT2Zmc2V0KTsNCiAgICBpZiAoYW5jaG9yICYmIGhlYWQpIHsgcnVuSW5PcChjbSwgZnVuY3Rpb24gKCkgew0KICAgICAgc2V0U2VsZWN0aW9uKGNtLmRvYywgc2ltcGxlU2VsZWN0aW9uKGFuY2hvciwgaGVhZCksIHNlbF9kb250U2Nyb2xsKTsNCiAgICAgIGlmIChhbmNob3IuYmFkIHx8IGhlYWQuYmFkKSB7IGNtLmN1ck9wLnNlbGVjdGlvbkNoYW5nZWQgPSB0cnVlOyB9DQogICAgfSk7IH0NCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucG9sbENvbnRlbnQgPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKHRoaXMucmVhZERPTVRpbWVvdXQgIT0gbnVsbCkgew0KICAgICAgY2xlYXJUaW1lb3V0KHRoaXMucmVhZERPTVRpbWVvdXQpOw0KICAgICAgdGhpcy5yZWFkRE9NVGltZW91dCA9IG51bGw7DQogICAgfQ0KDQogICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXksIHNlbCA9IGNtLmRvYy5zZWwucHJpbWFyeSgpOw0KICAgIHZhciBmcm9tID0gc2VsLmZyb20oKSwgdG8gPSBzZWwudG8oKTsNCiAgICBpZiAoZnJvbS5jaCA9PSAwICYmIGZyb20ubGluZSA+IGNtLmZpcnN0TGluZSgpKQ0KICAgICAgeyBmcm9tID0gUG9zKGZyb20ubGluZSAtIDEsIGdldExpbmUoY20uZG9jLCBmcm9tLmxpbmUgLSAxKS5sZW5ndGgpOyB9DQogICAgaWYgKHRvLmNoID09IGdldExpbmUoY20uZG9jLCB0by5saW5lKS50ZXh0Lmxlbmd0aCAmJiB0by5saW5lIDwgY20ubGFzdExpbmUoKSkNCiAgICAgIHsgdG8gPSBQb3ModG8ubGluZSArIDEsIDApOyB9DQogICAgaWYgKGZyb20ubGluZSA8IGRpc3BsYXkudmlld0Zyb20gfHwgdG8ubGluZSA+IGRpc3BsYXkudmlld1RvIC0gMSkgeyByZXR1cm4gZmFsc2UgfQ0KDQogICAgdmFyIGZyb21JbmRleCwgZnJvbUxpbmUsIGZyb21Ob2RlOw0KICAgIGlmIChmcm9tLmxpbmUgPT0gZGlzcGxheS52aWV3RnJvbSB8fCAoZnJvbUluZGV4ID0gZmluZFZpZXdJbmRleChjbSwgZnJvbS5saW5lKSkgPT0gMCkgew0KICAgICAgZnJvbUxpbmUgPSBsaW5lTm8oZGlzcGxheS52aWV3WzBdLmxpbmUpOw0KICAgICAgZnJvbU5vZGUgPSBkaXNwbGF5LnZpZXdbMF0ubm9kZTsNCiAgICB9IGVsc2Ugew0KICAgICAgZnJvbUxpbmUgPSBsaW5lTm8oZGlzcGxheS52aWV3W2Zyb21JbmRleF0ubGluZSk7DQogICAgICBmcm9tTm9kZSA9IGRpc3BsYXkudmlld1tmcm9tSW5kZXggLSAxXS5ub2RlLm5leHRTaWJsaW5nOw0KICAgIH0NCiAgICB2YXIgdG9JbmRleCA9IGZpbmRWaWV3SW5kZXgoY20sIHRvLmxpbmUpOw0KICAgIHZhciB0b0xpbmUsIHRvTm9kZTsNCiAgICBpZiAodG9JbmRleCA9PSBkaXNwbGF5LnZpZXcubGVuZ3RoIC0gMSkgew0KICAgICAgdG9MaW5lID0gZGlzcGxheS52aWV3VG8gLSAxOw0KICAgICAgdG9Ob2RlID0gZGlzcGxheS5saW5lRGl2Lmxhc3RDaGlsZDsNCiAgICB9IGVsc2Ugew0KICAgICAgdG9MaW5lID0gbGluZU5vKGRpc3BsYXkudmlld1t0b0luZGV4ICsgMV0ubGluZSkgLSAxOw0KICAgICAgdG9Ob2RlID0gZGlzcGxheS52aWV3W3RvSW5kZXggKyAxXS5ub2RlLnByZXZpb3VzU2libGluZzsNCiAgICB9DQoNCiAgICBpZiAoIWZyb21Ob2RlKSB7IHJldHVybiBmYWxzZSB9DQogICAgdmFyIG5ld1RleHQgPSBjbS5kb2Muc3BsaXRMaW5lcyhkb21UZXh0QmV0d2VlbihjbSwgZnJvbU5vZGUsIHRvTm9kZSwgZnJvbUxpbmUsIHRvTGluZSkpOw0KICAgIHZhciBvbGRUZXh0ID0gZ2V0QmV0d2VlbihjbS5kb2MsIFBvcyhmcm9tTGluZSwgMCksIFBvcyh0b0xpbmUsIGdldExpbmUoY20uZG9jLCB0b0xpbmUpLnRleHQubGVuZ3RoKSk7DQogICAgd2hpbGUgKG5ld1RleHQubGVuZ3RoID4gMSAmJiBvbGRUZXh0Lmxlbmd0aCA+IDEpIHsNCiAgICAgIGlmIChsc3QobmV3VGV4dCkgPT0gbHN0KG9sZFRleHQpKSB7IG5ld1RleHQucG9wKCk7IG9sZFRleHQucG9wKCk7IHRvTGluZS0tOyB9DQogICAgICBlbHNlIGlmIChuZXdUZXh0WzBdID09IG9sZFRleHRbMF0pIHsgbmV3VGV4dC5zaGlmdCgpOyBvbGRUZXh0LnNoaWZ0KCk7IGZyb21MaW5lKys7IH0NCiAgICAgIGVsc2UgeyBicmVhayB9DQogICAgfQ0KDQogICAgdmFyIGN1dEZyb250ID0gMCwgY3V0RW5kID0gMDsNCiAgICB2YXIgbmV3VG9wID0gbmV3VGV4dFswXSwgb2xkVG9wID0gb2xkVGV4dFswXSwgbWF4Q3V0RnJvbnQgPSBNYXRoLm1pbihuZXdUb3AubGVuZ3RoLCBvbGRUb3AubGVuZ3RoKTsNCiAgICB3aGlsZSAoY3V0RnJvbnQgPCBtYXhDdXRGcm9udCAmJiBuZXdUb3AuY2hhckNvZGVBdChjdXRGcm9udCkgPT0gb2xkVG9wLmNoYXJDb2RlQXQoY3V0RnJvbnQpKQ0KICAgICAgeyArK2N1dEZyb250OyB9DQogICAgdmFyIG5ld0JvdCA9IGxzdChuZXdUZXh0KSwgb2xkQm90ID0gbHN0KG9sZFRleHQpOw0KICAgIHZhciBtYXhDdXRFbmQgPSBNYXRoLm1pbihuZXdCb3QubGVuZ3RoIC0gKG5ld1RleHQubGVuZ3RoID09IDEgPyBjdXRGcm9udCA6IDApLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbGRCb3QubGVuZ3RoIC0gKG9sZFRleHQubGVuZ3RoID09IDEgPyBjdXRGcm9udCA6IDApKTsNCiAgICB3aGlsZSAoY3V0RW5kIDwgbWF4Q3V0RW5kICYmDQogICAgICAgICAgIG5ld0JvdC5jaGFyQ29kZUF0KG5ld0JvdC5sZW5ndGggLSBjdXRFbmQgLSAxKSA9PSBvbGRCb3QuY2hhckNvZGVBdChvbGRCb3QubGVuZ3RoIC0gY3V0RW5kIC0gMSkpDQogICAgICB7ICsrY3V0RW5kOyB9DQogICAgLy8gVHJ5IHRvIG1vdmUgc3RhcnQgb2YgY2hhbmdlIHRvIHN0YXJ0IG9mIHNlbGVjdGlvbiBpZiBhbWJpZ3VvdXMNCiAgICBpZiAobmV3VGV4dC5sZW5ndGggPT0gMSAmJiBvbGRUZXh0Lmxlbmd0aCA9PSAxICYmIGZyb21MaW5lID09IGZyb20ubGluZSkgew0KICAgICAgd2hpbGUgKGN1dEZyb250ICYmIGN1dEZyb250ID4gZnJvbS5jaCAmJg0KICAgICAgICAgICAgIG5ld0JvdC5jaGFyQ29kZUF0KG5ld0JvdC5sZW5ndGggLSBjdXRFbmQgLSAxKSA9PSBvbGRCb3QuY2hhckNvZGVBdChvbGRCb3QubGVuZ3RoIC0gY3V0RW5kIC0gMSkpIHsNCiAgICAgICAgY3V0RnJvbnQtLTsNCiAgICAgICAgY3V0RW5kKys7DQogICAgICB9DQogICAgfQ0KDQogICAgbmV3VGV4dFtuZXdUZXh0Lmxlbmd0aCAtIDFdID0gbmV3Qm90LnNsaWNlKDAsIG5ld0JvdC5sZW5ndGggLSBjdXRFbmQpLnJlcGxhY2UoL15cdTIwMGIrLywgIiIpOw0KICAgIG5ld1RleHRbMF0gPSBuZXdUZXh0WzBdLnNsaWNlKGN1dEZyb250KS5yZXBsYWNlKC9cdTIwMGIrJC8sICIiKTsNCg0KICAgIHZhciBjaEZyb20gPSBQb3MoZnJvbUxpbmUsIGN1dEZyb250KTsNCiAgICB2YXIgY2hUbyA9IFBvcyh0b0xpbmUsIG9sZFRleHQubGVuZ3RoID8gbHN0KG9sZFRleHQpLmxlbmd0aCAtIGN1dEVuZCA6IDApOw0KICAgIGlmIChuZXdUZXh0Lmxlbmd0aCA+IDEgfHwgbmV3VGV4dFswXSB8fCBjbXAoY2hGcm9tLCBjaFRvKSkgew0KICAgICAgcmVwbGFjZVJhbmdlKGNtLmRvYywgbmV3VGV4dCwgY2hGcm9tLCBjaFRvLCAiK2lucHV0Iik7DQogICAgICByZXR1cm4gdHJ1ZQ0KICAgIH0NCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUuZW5zdXJlUG9sbGVkID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMuZm9yY2VDb21wb3NpdGlvbkVuZCgpOw0KICB9Ow0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgdGhpcy5mb3JjZUNvbXBvc2l0aW9uRW5kKCk7DQogIH07DQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5mb3JjZUNvbXBvc2l0aW9uRW5kID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICghdGhpcy5jb21wb3NpbmcpIHsgcmV0dXJuIH0NCiAgICBjbGVhclRpbWVvdXQodGhpcy5yZWFkRE9NVGltZW91dCk7DQogICAgdGhpcy5jb21wb3NpbmcgPSBudWxsOw0KICAgIHRoaXMudXBkYXRlRnJvbURPTSgpOw0KICAgIHRoaXMuZGl2LmJsdXIoKTsNCiAgICB0aGlzLmRpdi5mb2N1cygpOw0KICB9Ow0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUucmVhZEZyb21ET01Tb29uID0gZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICBpZiAodGhpcy5yZWFkRE9NVGltZW91dCAhPSBudWxsKSB7IHJldHVybiB9DQogICAgdGhpcy5yZWFkRE9NVGltZW91dCA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgdGhpcyQxLnJlYWRET01UaW1lb3V0ID0gbnVsbDsNCiAgICAgIGlmICh0aGlzJDEuY29tcG9zaW5nKSB7DQogICAgICAgIGlmICh0aGlzJDEuY29tcG9zaW5nLmRvbmUpIHsgdGhpcyQxLmNvbXBvc2luZyA9IG51bGw7IH0NCiAgICAgICAgZWxzZSB7IHJldHVybiB9DQogICAgICB9DQogICAgICB0aGlzJDEudXBkYXRlRnJvbURPTSgpOw0KICAgIH0sIDgwKTsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUudXBkYXRlRnJvbURPTSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgaWYgKHRoaXMuY20uaXNSZWFkT25seSgpIHx8ICF0aGlzLnBvbGxDb250ZW50KCkpDQogICAgICB7IHJ1bkluT3AodGhpcy5jbSwgZnVuY3Rpb24gKCkgeyByZXR1cm4gcmVnQ2hhbmdlKHRoaXMkMS5jbSk7IH0pOyB9DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnNldFVuZWRpdGFibGUgPSBmdW5jdGlvbiAobm9kZSkgew0KICAgIG5vZGUuY29udGVudEVkaXRhYmxlID0gImZhbHNlIjsNCiAgfTsNCg0KICBDb250ZW50RWRpdGFibGVJbnB1dC5wcm90b3R5cGUub25LZXlQcmVzcyA9IGZ1bmN0aW9uIChlKSB7DQogICAgaWYgKGUuY2hhckNvZGUgPT0gMCB8fCB0aGlzLmNvbXBvc2luZykgeyByZXR1cm4gfQ0KICAgIGUucHJldmVudERlZmF1bHQoKTsNCiAgICBpZiAoIXRoaXMuY20uaXNSZWFkT25seSgpKQ0KICAgICAgeyBvcGVyYXRpb24odGhpcy5jbSwgYXBwbHlUZXh0SW5wdXQpKHRoaXMuY20sIFN0cmluZy5mcm9tQ2hhckNvZGUoZS5jaGFyQ29kZSA9PSBudWxsID8gZS5rZXlDb2RlIDogZS5jaGFyQ29kZSksIDApOyB9DQogIH07DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLnJlYWRPbmx5Q2hhbmdlZCA9IGZ1bmN0aW9uICh2YWwpIHsNCiAgICB0aGlzLmRpdi5jb250ZW50RWRpdGFibGUgPSBTdHJpbmcodmFsICE9ICJub2N1cnNvciIpOw0KICB9Ow0KDQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5vbkNvbnRleHRNZW51ID0gZnVuY3Rpb24gKCkge307DQogIENvbnRlbnRFZGl0YWJsZUlucHV0LnByb3RvdHlwZS5yZXNldFBvc2l0aW9uID0gZnVuY3Rpb24gKCkge307DQoNCiAgQ29udGVudEVkaXRhYmxlSW5wdXQucHJvdG90eXBlLm5lZWRzQ29udGVudEF0dHJpYnV0ZSA9IHRydWU7DQoNCiAgZnVuY3Rpb24gcG9zVG9ET00oY20sIHBvcykgew0KICAgIHZhciB2aWV3ID0gZmluZFZpZXdGb3JMaW5lKGNtLCBwb3MubGluZSk7DQogICAgaWYgKCF2aWV3IHx8IHZpZXcuaGlkZGVuKSB7IHJldHVybiBudWxsIH0NCiAgICB2YXIgbGluZSA9IGdldExpbmUoY20uZG9jLCBwb3MubGluZSk7DQogICAgdmFyIGluZm8gPSBtYXBGcm9tTGluZVZpZXcodmlldywgbGluZSwgcG9zLmxpbmUpOw0KDQogICAgdmFyIG9yZGVyID0gZ2V0T3JkZXIobGluZSwgY20uZG9jLmRpcmVjdGlvbiksIHNpZGUgPSAibGVmdCI7DQogICAgaWYgKG9yZGVyKSB7DQogICAgICB2YXIgcGFydFBvcyA9IGdldEJpZGlQYXJ0QXQob3JkZXIsIHBvcy5jaCk7DQogICAgICBzaWRlID0gcGFydFBvcyAlIDIgPyAicmlnaHQiIDogImxlZnQiOw0KICAgIH0NCiAgICB2YXIgcmVzdWx0ID0gbm9kZUFuZE9mZnNldEluTGluZU1hcChpbmZvLm1hcCwgcG9zLmNoLCBzaWRlKTsNCiAgICByZXN1bHQub2Zmc2V0ID0gcmVzdWx0LmNvbGxhcHNlID09ICJyaWdodCIgPyByZXN1bHQuZW5kIDogcmVzdWx0LnN0YXJ0Ow0KICAgIHJldHVybiByZXN1bHQNCiAgfQ0KDQogIGZ1bmN0aW9uIGlzSW5HdXR0ZXIobm9kZSkgew0KICAgIGZvciAodmFyIHNjYW4gPSBub2RlOyBzY2FuOyBzY2FuID0gc2Nhbi5wYXJlbnROb2RlKQ0KICAgICAgeyBpZiAoL0NvZGVNaXJyb3ItZ3V0dGVyLXdyYXBwZXIvLnRlc3Qoc2Nhbi5jbGFzc05hbWUpKSB7IHJldHVybiB0cnVlIH0gfQ0KICAgIHJldHVybiBmYWxzZQ0KICB9DQoNCiAgZnVuY3Rpb24gYmFkUG9zKHBvcywgYmFkKSB7IGlmIChiYWQpIHsgcG9zLmJhZCA9IHRydWU7IH0gcmV0dXJuIHBvcyB9DQoNCiAgZnVuY3Rpb24gZG9tVGV4dEJldHdlZW4oY20sIGZyb20sIHRvLCBmcm9tTGluZSwgdG9MaW5lKSB7DQogICAgdmFyIHRleHQgPSAiIiwgY2xvc2luZyA9IGZhbHNlLCBsaW5lU2VwID0gY20uZG9jLmxpbmVTZXBhcmF0b3IoKSwgZXh0cmFMaW5lYnJlYWsgPSBmYWxzZTsNCiAgICBmdW5jdGlvbiByZWNvZ25pemVNYXJrZXIoaWQpIHsgcmV0dXJuIGZ1bmN0aW9uIChtYXJrZXIpIHsgcmV0dXJuIG1hcmtlci5pZCA9PSBpZDsgfSB9DQogICAgZnVuY3Rpb24gY2xvc2UoKSB7DQogICAgICBpZiAoY2xvc2luZykgew0KICAgICAgICB0ZXh0ICs9IGxpbmVTZXA7DQogICAgICAgIGlmIChleHRyYUxpbmVicmVhaykgeyB0ZXh0ICs9IGxpbmVTZXA7IH0NCiAgICAgICAgY2xvc2luZyA9IGV4dHJhTGluZWJyZWFrID0gZmFsc2U7DQogICAgICB9DQogICAgfQ0KICAgIGZ1bmN0aW9uIGFkZFRleHQoc3RyKSB7DQogICAgICBpZiAoc3RyKSB7DQogICAgICAgIGNsb3NlKCk7DQogICAgICAgIHRleHQgKz0gc3RyOw0KICAgICAgfQ0KICAgIH0NCiAgICBmdW5jdGlvbiB3YWxrKG5vZGUpIHsNCiAgICAgIGlmIChub2RlLm5vZGVUeXBlID09IDEpIHsNCiAgICAgICAgdmFyIGNtVGV4dCA9IG5vZGUuZ2V0QXR0cmlidXRlKCJjbS10ZXh0Iik7DQogICAgICAgIGlmIChjbVRleHQpIHsNCiAgICAgICAgICBhZGRUZXh0KGNtVGV4dCk7DQogICAgICAgICAgcmV0dXJuDQogICAgICAgIH0NCiAgICAgICAgdmFyIG1hcmtlcklEID0gbm9kZS5nZXRBdHRyaWJ1dGUoImNtLW1hcmtlciIpLCByYW5nZSQkMTsNCiAgICAgICAgaWYgKG1hcmtlcklEKSB7DQogICAgICAgICAgdmFyIGZvdW5kID0gY20uZmluZE1hcmtzKFBvcyhmcm9tTGluZSwgMCksIFBvcyh0b0xpbmUgKyAxLCAwKSwgcmVjb2duaXplTWFya2VyKCttYXJrZXJJRCkpOw0KICAgICAgICAgIGlmIChmb3VuZC5sZW5ndGggJiYgKHJhbmdlJCQxID0gZm91bmRbMF0uZmluZCgwKSkpDQogICAgICAgICAgICB7IGFkZFRleHQoZ2V0QmV0d2VlbihjbS5kb2MsIHJhbmdlJCQxLmZyb20sIHJhbmdlJCQxLnRvKS5qb2luKGxpbmVTZXApKTsgfQ0KICAgICAgICAgIHJldHVybg0KICAgICAgICB9DQogICAgICAgIGlmIChub2RlLmdldEF0dHJpYnV0ZSgiY29udGVudGVkaXRhYmxlIikgPT0gImZhbHNlIikgeyByZXR1cm4gfQ0KICAgICAgICB2YXIgaXNCbG9jayA9IC9eKHByZXxkaXZ8cHxsaXx0YWJsZXxicikkL2kudGVzdChub2RlLm5vZGVOYW1lKTsNCiAgICAgICAgaWYgKCEvXmJyJC9pLnRlc3Qobm9kZS5ub2RlTmFtZSkgJiYgbm9kZS50ZXh0Q29udGVudC5sZW5ndGggPT0gMCkgeyByZXR1cm4gfQ0KDQogICAgICAgIGlmIChpc0Jsb2NrKSB7IGNsb3NlKCk7IH0NCiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBub2RlLmNoaWxkTm9kZXMubGVuZ3RoOyBpKyspDQogICAgICAgICAgeyB3YWxrKG5vZGUuY2hpbGROb2Rlc1tpXSk7IH0NCg0KICAgICAgICBpZiAoL14ocHJlfHApJC9pLnRlc3Qobm9kZS5ub2RlTmFtZSkpIHsgZXh0cmFMaW5lYnJlYWsgPSB0cnVlOyB9DQogICAgICAgIGlmIChpc0Jsb2NrKSB7IGNsb3NpbmcgPSB0cnVlOyB9DQogICAgICB9IGVsc2UgaWYgKG5vZGUubm9kZVR5cGUgPT0gMykgew0KICAgICAgICBhZGRUZXh0KG5vZGUubm9kZVZhbHVlLnJlcGxhY2UoL1x1MjAwYi9nLCAiIikucmVwbGFjZSgvXHUwMGEwL2csICIgIikpOw0KICAgICAgfQ0KICAgIH0NCiAgICBmb3IgKDs7KSB7DQogICAgICB3YWxrKGZyb20pOw0KICAgICAgaWYgKGZyb20gPT0gdG8pIHsgYnJlYWsgfQ0KICAgICAgZnJvbSA9IGZyb20ubmV4dFNpYmxpbmc7DQogICAgICBleHRyYUxpbmVicmVhayA9IGZhbHNlOw0KICAgIH0NCiAgICByZXR1cm4gdGV4dA0KICB9DQoNCiAgZnVuY3Rpb24gZG9tVG9Qb3MoY20sIG5vZGUsIG9mZnNldCkgew0KICAgIHZhciBsaW5lTm9kZTsNCiAgICBpZiAobm9kZSA9PSBjbS5kaXNwbGF5LmxpbmVEaXYpIHsNCiAgICAgIGxpbmVOb2RlID0gY20uZGlzcGxheS5saW5lRGl2LmNoaWxkTm9kZXNbb2Zmc2V0XTsNCiAgICAgIGlmICghbGluZU5vZGUpIHsgcmV0dXJuIGJhZFBvcyhjbS5jbGlwUG9zKFBvcyhjbS5kaXNwbGF5LnZpZXdUbyAtIDEpKSwgdHJ1ZSkgfQ0KICAgICAgbm9kZSA9IG51bGw7IG9mZnNldCA9IDA7DQogICAgfSBlbHNlIHsNCiAgICAgIGZvciAobGluZU5vZGUgPSBub2RlOzsgbGluZU5vZGUgPSBsaW5lTm9kZS5wYXJlbnROb2RlKSB7DQogICAgICAgIGlmICghbGluZU5vZGUgfHwgbGluZU5vZGUgPT0gY20uZGlzcGxheS5saW5lRGl2KSB7IHJldHVybiBudWxsIH0NCiAgICAgICAgaWYgKGxpbmVOb2RlLnBhcmVudE5vZGUgJiYgbGluZU5vZGUucGFyZW50Tm9kZSA9PSBjbS5kaXNwbGF5LmxpbmVEaXYpIHsgYnJlYWsgfQ0KICAgICAgfQ0KICAgIH0NCiAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNtLmRpc3BsYXkudmlldy5sZW5ndGg7IGkrKykgew0KICAgICAgdmFyIGxpbmVWaWV3ID0gY20uZGlzcGxheS52aWV3W2ldOw0KICAgICAgaWYgKGxpbmVWaWV3Lm5vZGUgPT0gbGluZU5vZGUpDQogICAgICAgIHsgcmV0dXJuIGxvY2F0ZU5vZGVJbkxpbmVWaWV3KGxpbmVWaWV3LCBub2RlLCBvZmZzZXQpIH0NCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBsb2NhdGVOb2RlSW5MaW5lVmlldyhsaW5lVmlldywgbm9kZSwgb2Zmc2V0KSB7DQogICAgdmFyIHdyYXBwZXIgPSBsaW5lVmlldy50ZXh0LmZpcnN0Q2hpbGQsIGJhZCA9IGZhbHNlOw0KICAgIGlmICghbm9kZSB8fCAhY29udGFpbnMod3JhcHBlciwgbm9kZSkpIHsgcmV0dXJuIGJhZFBvcyhQb3MobGluZU5vKGxpbmVWaWV3LmxpbmUpLCAwKSwgdHJ1ZSkgfQ0KICAgIGlmIChub2RlID09IHdyYXBwZXIpIHsNCiAgICAgIGJhZCA9IHRydWU7DQogICAgICBub2RlID0gd3JhcHBlci5jaGlsZE5vZGVzW29mZnNldF07DQogICAgICBvZmZzZXQgPSAwOw0KICAgICAgaWYgKCFub2RlKSB7DQogICAgICAgIHZhciBsaW5lID0gbGluZVZpZXcucmVzdCA/IGxzdChsaW5lVmlldy5yZXN0KSA6IGxpbmVWaWV3LmxpbmU7DQogICAgICAgIHJldHVybiBiYWRQb3MoUG9zKGxpbmVObyhsaW5lKSwgbGluZS50ZXh0Lmxlbmd0aCksIGJhZCkNCiAgICAgIH0NCiAgICB9DQoNCiAgICB2YXIgdGV4dE5vZGUgPSBub2RlLm5vZGVUeXBlID09IDMgPyBub2RlIDogbnVsbCwgdG9wTm9kZSA9IG5vZGU7DQogICAgaWYgKCF0ZXh0Tm9kZSAmJiBub2RlLmNoaWxkTm9kZXMubGVuZ3RoID09IDEgJiYgbm9kZS5maXJzdENoaWxkLm5vZGVUeXBlID09IDMpIHsNCiAgICAgIHRleHROb2RlID0gbm9kZS5maXJzdENoaWxkOw0KICAgICAgaWYgKG9mZnNldCkgeyBvZmZzZXQgPSB0ZXh0Tm9kZS5ub2RlVmFsdWUubGVuZ3RoOyB9DQogICAgfQ0KICAgIHdoaWxlICh0b3BOb2RlLnBhcmVudE5vZGUgIT0gd3JhcHBlcikgeyB0b3BOb2RlID0gdG9wTm9kZS5wYXJlbnROb2RlOyB9DQogICAgdmFyIG1lYXN1cmUgPSBsaW5lVmlldy5tZWFzdXJlLCBtYXBzID0gbWVhc3VyZS5tYXBzOw0KDQogICAgZnVuY3Rpb24gZmluZCh0ZXh0Tm9kZSwgdG9wTm9kZSwgb2Zmc2V0KSB7DQogICAgICBmb3IgKHZhciBpID0gLTE7IGkgPCAobWFwcyA/IG1hcHMubGVuZ3RoIDogMCk7IGkrKykgew0KICAgICAgICB2YXIgbWFwJCQxID0gaSA8IDAgPyBtZWFzdXJlLm1hcCA6IG1hcHNbaV07DQogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWFwJCQxLmxlbmd0aDsgaiArPSAzKSB7DQogICAgICAgICAgdmFyIGN1ck5vZGUgPSBtYXAkJDFbaiArIDJdOw0KICAgICAgICAgIGlmIChjdXJOb2RlID09IHRleHROb2RlIHx8IGN1ck5vZGUgPT0gdG9wTm9kZSkgew0KICAgICAgICAgICAgdmFyIGxpbmUgPSBsaW5lTm8oaSA8IDAgPyBsaW5lVmlldy5saW5lIDogbGluZVZpZXcucmVzdFtpXSk7DQogICAgICAgICAgICB2YXIgY2ggPSBtYXAkJDFbal0gKyBvZmZzZXQ7DQogICAgICAgICAgICBpZiAob2Zmc2V0IDwgMCB8fCBjdXJOb2RlICE9IHRleHROb2RlKSB7IGNoID0gbWFwJCQxW2ogKyAob2Zmc2V0ID8gMSA6IDApXTsgfQ0KICAgICAgICAgICAgcmV0dXJuIFBvcyhsaW5lLCBjaCkNCiAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgdmFyIGZvdW5kID0gZmluZCh0ZXh0Tm9kZSwgdG9wTm9kZSwgb2Zmc2V0KTsNCiAgICBpZiAoZm91bmQpIHsgcmV0dXJuIGJhZFBvcyhmb3VuZCwgYmFkKSB9DQoNCiAgICAvLyBGSVhNRSB0aGlzIGlzIGFsbCByZWFsbHkgc2hha3kuIG1pZ2h0IGhhbmRsZSB0aGUgZmV3IGNhc2VzIGl0IG5lZWRzIHRvIGhhbmRsZSwgYnV0IGxpa2VseSB0byBjYXVzZSBwcm9ibGVtcw0KICAgIGZvciAodmFyIGFmdGVyID0gdG9wTm9kZS5uZXh0U2libGluZywgZGlzdCA9IHRleHROb2RlID8gdGV4dE5vZGUubm9kZVZhbHVlLmxlbmd0aCAtIG9mZnNldCA6IDA7IGFmdGVyOyBhZnRlciA9IGFmdGVyLm5leHRTaWJsaW5nKSB7DQogICAgICBmb3VuZCA9IGZpbmQoYWZ0ZXIsIGFmdGVyLmZpcnN0Q2hpbGQsIDApOw0KICAgICAgaWYgKGZvdW5kKQ0KICAgICAgICB7IHJldHVybiBiYWRQb3MoUG9zKGZvdW5kLmxpbmUsIGZvdW5kLmNoIC0gZGlzdCksIGJhZCkgfQ0KICAgICAgZWxzZQ0KICAgICAgICB7IGRpc3QgKz0gYWZ0ZXIudGV4dENvbnRlbnQubGVuZ3RoOyB9DQogICAgfQ0KICAgIGZvciAodmFyIGJlZm9yZSA9IHRvcE5vZGUucHJldmlvdXNTaWJsaW5nLCBkaXN0JDEgPSBvZmZzZXQ7IGJlZm9yZTsgYmVmb3JlID0gYmVmb3JlLnByZXZpb3VzU2libGluZykgew0KICAgICAgZm91bmQgPSBmaW5kKGJlZm9yZSwgYmVmb3JlLmZpcnN0Q2hpbGQsIC0xKTsNCiAgICAgIGlmIChmb3VuZCkNCiAgICAgICAgeyByZXR1cm4gYmFkUG9zKFBvcyhmb3VuZC5saW5lLCBmb3VuZC5jaCArIGRpc3QkMSksIGJhZCkgfQ0KICAgICAgZWxzZQ0KICAgICAgICB7IGRpc3QkMSArPSBiZWZvcmUudGV4dENvbnRlbnQubGVuZ3RoOyB9DQogICAgfQ0KICB9DQoNCiAgLy8gVEVYVEFSRUEgSU5QVVQgU1RZTEUNCg0KICB2YXIgVGV4dGFyZWFJbnB1dCA9IGZ1bmN0aW9uKGNtKSB7DQogICAgdGhpcy5jbSA9IGNtOw0KICAgIC8vIFNlZSBpbnB1dC5wb2xsIGFuZCBpbnB1dC5yZXNldA0KICAgIHRoaXMucHJldklucHV0ID0gIiI7DQoNCiAgICAvLyBGbGFnIHRoYXQgaW5kaWNhdGVzIHdoZXRoZXIgd2UgZXhwZWN0IGlucHV0IHRvIGFwcGVhciByZWFsIHNvb24NCiAgICAvLyBub3cgKGFmdGVyIHNvbWUgZXZlbnQgbGlrZSAna2V5cHJlc3MnIG9yICdpbnB1dCcpIGFuZCBhcmUNCiAgICAvLyBwb2xsaW5nIGludGVuc2l2ZWx5Lg0KICAgIHRoaXMucG9sbGluZ0Zhc3QgPSBmYWxzZTsNCiAgICAvLyBTZWxmLXJlc2V0dGluZyB0aW1lb3V0IGZvciB0aGUgcG9sbGVyDQogICAgdGhpcy5wb2xsaW5nID0gbmV3IERlbGF5ZWQoKTsNCiAgICAvLyBVc2VkIHRvIHdvcmsgYXJvdW5kIElFIGlzc3VlIHdpdGggc2VsZWN0aW9uIGJlaW5nIGZvcmdvdHRlbiB3aGVuIGZvY3VzIG1vdmVzIGF3YXkgZnJvbSB0ZXh0YXJlYQ0KICAgIHRoaXMuaGFzU2VsZWN0aW9uID0gZmFsc2U7DQogICAgdGhpcy5jb21wb3NpbmcgPSBudWxsOw0KICB9Ow0KDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZGlzcGxheSkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IHRoaXMuY207DQogICAgdGhpcy5jcmVhdGVGaWVsZChkaXNwbGF5KTsNCiAgICB2YXIgdGUgPSB0aGlzLnRleHRhcmVhOw0KDQogICAgZGlzcGxheS53cmFwcGVyLmluc2VydEJlZm9yZSh0aGlzLndyYXBwZXIsIGRpc3BsYXkud3JhcHBlci5maXJzdENoaWxkKTsNCg0KICAgIC8vIE5lZWRlZCB0byBoaWRlIGJpZyBibHVlIGJsaW5raW5nIGN1cnNvciBvbiBNb2JpbGUgU2FmYXJpIChkb2Vzbid0IHNlZW0gdG8gd29yayBpbiBpT1MgOCBhbnltb3JlKQ0KICAgIGlmIChpb3MpIHsgdGUuc3R5bGUud2lkdGggPSAiMHB4IjsgfQ0KDQogICAgb24odGUsICJpbnB1dCIsIGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkgJiYgdGhpcyQxLmhhc1NlbGVjdGlvbikgeyB0aGlzJDEuaGFzU2VsZWN0aW9uID0gbnVsbDsgfQ0KICAgICAgaW5wdXQucG9sbCgpOw0KICAgIH0pOw0KDQogICAgb24odGUsICJwYXN0ZSIsIGZ1bmN0aW9uIChlKSB7DQogICAgICBpZiAoc2lnbmFsRE9NRXZlbnQoY20sIGUpIHx8IGhhbmRsZVBhc3RlKGUsIGNtKSkgeyByZXR1cm4gfQ0KDQogICAgICBjbS5zdGF0ZS5wYXN0ZUluY29taW5nID0gK25ldyBEYXRlOw0KICAgICAgaW5wdXQuZmFzdFBvbGwoKTsNCiAgICB9KTsNCg0KICAgIGZ1bmN0aW9uIHByZXBhcmVDb3B5Q3V0KGUpIHsNCiAgICAgIGlmIChzaWduYWxET01FdmVudChjbSwgZSkpIHsgcmV0dXJuIH0NCiAgICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7DQogICAgICAgIHNldExhc3RDb3BpZWQoe2xpbmVXaXNlOiBmYWxzZSwgdGV4dDogY20uZ2V0U2VsZWN0aW9ucygpfSk7DQogICAgICB9IGVsc2UgaWYgKCFjbS5vcHRpb25zLmxpbmVXaXNlQ29weUN1dCkgew0KICAgICAgICByZXR1cm4NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIHZhciByYW5nZXMgPSBjb3B5YWJsZVJhbmdlcyhjbSk7DQogICAgICAgIHNldExhc3RDb3BpZWQoe2xpbmVXaXNlOiB0cnVlLCB0ZXh0OiByYW5nZXMudGV4dH0pOw0KICAgICAgICBpZiAoZS50eXBlID09ICJjdXQiKSB7DQogICAgICAgICAgY20uc2V0U2VsZWN0aW9ucyhyYW5nZXMucmFuZ2VzLCBudWxsLCBzZWxfZG9udFNjcm9sbCk7DQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgaW5wdXQucHJldklucHV0ID0gIiI7DQogICAgICAgICAgdGUudmFsdWUgPSByYW5nZXMudGV4dC5qb2luKCJcbiIpOw0KICAgICAgICAgIHNlbGVjdElucHV0KHRlKTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgaWYgKGUudHlwZSA9PSAiY3V0IikgeyBjbS5zdGF0ZS5jdXRJbmNvbWluZyA9ICtuZXcgRGF0ZTsgfQ0KICAgIH0NCiAgICBvbih0ZSwgImN1dCIsIHByZXBhcmVDb3B5Q3V0KTsNCiAgICBvbih0ZSwgImNvcHkiLCBwcmVwYXJlQ29weUN1dCk7DQoNCiAgICBvbihkaXNwbGF5LnNjcm9sbGVyLCAicGFzdGUiLCBmdW5jdGlvbiAoZSkgew0KICAgICAgaWYgKGV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkgfHwgc2lnbmFsRE9NRXZlbnQoY20sIGUpKSB7IHJldHVybiB9DQogICAgICBpZiAoIXRlLmRpc3BhdGNoRXZlbnQpIHsNCiAgICAgICAgY20uc3RhdGUucGFzdGVJbmNvbWluZyA9ICtuZXcgRGF0ZTsNCiAgICAgICAgaW5wdXQuZm9jdXMoKTsNCiAgICAgICAgcmV0dXJuDQogICAgICB9DQoNCiAgICAgIC8vIFBhc3MgdGhlIGBwYXN0ZWAgZXZlbnQgdG8gdGhlIHRleHRhcmVhIHNvIGl0J3MgaGFuZGxlZCBieSBpdHMgZXZlbnQgbGlzdGVuZXIuDQogICAgICB2YXIgZXZlbnQgPSBuZXcgRXZlbnQoInBhc3RlIik7DQogICAgICBldmVudC5jbGlwYm9hcmREYXRhID0gZS5jbGlwYm9hcmREYXRhOw0KICAgICAgdGUuZGlzcGF0Y2hFdmVudChldmVudCk7DQogICAgfSk7DQoNCiAgICAvLyBQcmV2ZW50IG5vcm1hbCBzZWxlY3Rpb24gaW4gdGhlIGVkaXRvciAod2UgaGFuZGxlIG91ciBvd24pDQogICAgb24oZGlzcGxheS5saW5lU3BhY2UsICJzZWxlY3RzdGFydCIsIGZ1bmN0aW9uIChlKSB7DQogICAgICBpZiAoIWV2ZW50SW5XaWRnZXQoZGlzcGxheSwgZSkpIHsgZV9wcmV2ZW50RGVmYXVsdChlKTsgfQ0KICAgIH0pOw0KDQogICAgb24odGUsICJjb21wb3NpdGlvbnN0YXJ0IiwgZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHN0YXJ0ID0gY20uZ2V0Q3Vyc29yKCJmcm9tIik7DQogICAgICBpZiAoaW5wdXQuY29tcG9zaW5nKSB7IGlucHV0LmNvbXBvc2luZy5yYW5nZS5jbGVhcigpOyB9DQogICAgICBpbnB1dC5jb21wb3NpbmcgPSB7DQogICAgICAgIHN0YXJ0OiBzdGFydCwNCiAgICAgICAgcmFuZ2U6IGNtLm1hcmtUZXh0KHN0YXJ0LCBjbS5nZXRDdXJzb3IoInRvIiksIHtjbGFzc05hbWU6ICJDb2RlTWlycm9yLWNvbXBvc2luZyJ9KQ0KICAgICAgfTsNCiAgICB9KTsNCiAgICBvbih0ZSwgImNvbXBvc2l0aW9uZW5kIiwgZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKGlucHV0LmNvbXBvc2luZykgew0KICAgICAgICBpbnB1dC5wb2xsKCk7DQogICAgICAgIGlucHV0LmNvbXBvc2luZy5yYW5nZS5jbGVhcigpOw0KICAgICAgICBpbnB1dC5jb21wb3NpbmcgPSBudWxsOw0KICAgICAgfQ0KICAgIH0pOw0KICB9Ow0KDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLmNyZWF0ZUZpZWxkID0gZnVuY3Rpb24gKF9kaXNwbGF5KSB7DQogICAgLy8gV3JhcHMgYW5kIGhpZGVzIGlucHV0IHRleHRhcmVhDQogICAgdGhpcy53cmFwcGVyID0gaGlkZGVuVGV4dGFyZWEoKTsNCiAgICAvLyBUaGUgc2VtaWhpZGRlbiB0ZXh0YXJlYSB0aGF0IGlzIGZvY3VzZWQgd2hlbiB0aGUgZWRpdG9yIGlzDQogICAgLy8gZm9jdXNlZCwgYW5kIHJlY2VpdmVzIGlucHV0Lg0KICAgIHRoaXMudGV4dGFyZWEgPSB0aGlzLndyYXBwZXIuZmlyc3RDaGlsZDsNCiAgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5zY3JlZW5SZWFkZXJMYWJlbENoYW5nZWQgPSBmdW5jdGlvbiAobGFiZWwpIHsNCiAgICAvLyBMYWJlbCBmb3Igc2NyZWVucmVhZGVycywgYWNjZXNzaWJpbGl0eQ0KICAgIGlmKGxhYmVsKSB7DQogICAgICB0aGlzLnRleHRhcmVhLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGxhYmVsKTsNCiAgICB9IGVsc2Ugew0KICAgICAgdGhpcy50ZXh0YXJlYS5yZW1vdmVBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnKTsNCiAgICB9DQogIH07DQoNCiAgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUucHJlcGFyZVNlbGVjdGlvbiA9IGZ1bmN0aW9uICgpIHsNCiAgICAvLyBSZWRyYXcgdGhlIHNlbGVjdGlvbiBhbmQvb3IgY3Vyc29yDQogICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXksIGRvYyA9IGNtLmRvYzsNCiAgICB2YXIgcmVzdWx0ID0gcHJlcGFyZVNlbGVjdGlvbihjbSk7DQoNCiAgICAvLyBNb3ZlIHRoZSBoaWRkZW4gdGV4dGFyZWEgbmVhciB0aGUgY3Vyc29yIHRvIHByZXZlbnQgc2Nyb2xsaW5nIGFydGlmYWN0cw0KICAgIGlmIChjbS5vcHRpb25zLm1vdmVJbnB1dFdpdGhDdXJzb3IpIHsNCiAgICAgIHZhciBoZWFkUG9zID0gY3Vyc29yQ29vcmRzKGNtLCBkb2Muc2VsLnByaW1hcnkoKS5oZWFkLCAiZGl2Iik7DQogICAgICB2YXIgd3JhcE9mZiA9IGRpc3BsYXkud3JhcHBlci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSwgbGluZU9mZiA9IGRpc3BsYXkubGluZURpdi5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsNCiAgICAgIHJlc3VsdC50ZVRvcCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkud3JhcHBlci5jbGllbnRIZWlnaHQgLSAxMCwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRQb3MudG9wICsgbGluZU9mZi50b3AgLSB3cmFwT2ZmLnRvcCkpOw0KICAgICAgcmVzdWx0LnRlTGVmdCA9IE1hdGgubWF4KDAsIE1hdGgubWluKGRpc3BsYXkud3JhcHBlci5jbGllbnRXaWR0aCAtIDEwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRQb3MubGVmdCArIGxpbmVPZmYubGVmdCAtIHdyYXBPZmYubGVmdCkpOw0KICAgIH0NCg0KICAgIHJldHVybiByZXN1bHQNCiAgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5zaG93U2VsZWN0aW9uID0gZnVuY3Rpb24gKGRyYXduKSB7DQogICAgdmFyIGNtID0gdGhpcy5jbSwgZGlzcGxheSA9IGNtLmRpc3BsYXk7DQogICAgcmVtb3ZlQ2hpbGRyZW5BbmRBZGQoZGlzcGxheS5jdXJzb3JEaXYsIGRyYXduLmN1cnNvcnMpOw0KICAgIHJlbW92ZUNoaWxkcmVuQW5kQWRkKGRpc3BsYXkuc2VsZWN0aW9uRGl2LCBkcmF3bi5zZWxlY3Rpb24pOw0KICAgIGlmIChkcmF3bi50ZVRvcCAhPSBudWxsKSB7DQogICAgICB0aGlzLndyYXBwZXIuc3R5bGUudG9wID0gZHJhd24udGVUb3AgKyAicHgiOw0KICAgICAgdGhpcy53cmFwcGVyLnN0eWxlLmxlZnQgPSBkcmF3bi50ZUxlZnQgKyAicHgiOw0KICAgIH0NCiAgfTsNCg0KICAvLyBSZXNldCB0aGUgaW5wdXQgdG8gY29ycmVzcG9uZCB0byB0aGUgc2VsZWN0aW9uIChvciB0byBiZSBlbXB0eSwNCiAgLy8gd2hlbiBub3QgdHlwaW5nIGFuZCBub3RoaW5nIGlzIHNlbGVjdGVkKQ0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICh0eXBpbmcpIHsNCiAgICBpZiAodGhpcy5jb250ZXh0TWVudVBlbmRpbmcgfHwgdGhpcy5jb21wb3NpbmcpIHsgcmV0dXJuIH0NCiAgICB2YXIgY20gPSB0aGlzLmNtOw0KICAgIGlmIChjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7DQogICAgICB0aGlzLnByZXZJbnB1dCA9ICIiOw0KICAgICAgdmFyIGNvbnRlbnQgPSBjbS5nZXRTZWxlY3Rpb24oKTsNCiAgICAgIHRoaXMudGV4dGFyZWEudmFsdWUgPSBjb250ZW50Ow0KICAgICAgaWYgKGNtLnN0YXRlLmZvY3VzZWQpIHsgc2VsZWN0SW5wdXQodGhpcy50ZXh0YXJlYSk7IH0NCiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkpIHsgdGhpcy5oYXNTZWxlY3Rpb24gPSBjb250ZW50OyB9DQogICAgfSBlbHNlIGlmICghdHlwaW5nKSB7DQogICAgICB0aGlzLnByZXZJbnB1dCA9IHRoaXMudGV4dGFyZWEudmFsdWUgPSAiIjsNCiAgICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkpIHsgdGhpcy5oYXNTZWxlY3Rpb24gPSBudWxsOyB9DQogICAgfQ0KICB9Ow0KDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLmdldEZpZWxkID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpcy50ZXh0YXJlYSB9Ow0KDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLnN1cHBvcnRzVG91Y2ggPSBmdW5jdGlvbiAoKSB7IHJldHVybiBmYWxzZSB9Ow0KDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLmZvY3VzID0gZnVuY3Rpb24gKCkgew0KICAgIGlmICh0aGlzLmNtLm9wdGlvbnMucmVhZE9ubHkgIT0gIm5vY3Vyc29yIiAmJiAoIW1vYmlsZSB8fCBhY3RpdmVFbHQoKSAhPSB0aGlzLnRleHRhcmVhKSkgew0KICAgICAgdHJ5IHsgdGhpcy50ZXh0YXJlYS5mb2N1cygpOyB9DQogICAgICBjYXRjaCAoZSkge30gLy8gSUU4IHdpbGwgdGhyb3cgaWYgdGhlIHRleHRhcmVhIGlzIGRpc3BsYXk6IG5vbmUgb3Igbm90IGluIERPTQ0KICAgIH0NCiAgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5ibHVyID0gZnVuY3Rpb24gKCkgeyB0aGlzLnRleHRhcmVhLmJsdXIoKTsgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5yZXNldFBvc2l0aW9uID0gZnVuY3Rpb24gKCkgew0KICAgIHRoaXMud3JhcHBlci5zdHlsZS50b3AgPSB0aGlzLndyYXBwZXIuc3R5bGUubGVmdCA9IDA7DQogIH07DQoNCiAgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUucmVjZWl2ZWRGb2N1cyA9IGZ1bmN0aW9uICgpIHsgdGhpcy5zbG93UG9sbCgpOyB9Ow0KDQogIC8vIFBvbGwgZm9yIGlucHV0IGNoYW5nZXMsIHVzaW5nIHRoZSBub3JtYWwgcmF0ZSBvZiBwb2xsaW5nLiBUaGlzDQogIC8vIHJ1bnMgYXMgbG9uZyBhcyB0aGUgZWRpdG9yIGlzIGZvY3VzZWQuDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLnNsb3dQb2xsID0gZnVuY3Rpb24gKCkgew0KICAgICAgdmFyIHRoaXMkMSA9IHRoaXM7DQoNCiAgICBpZiAodGhpcy5wb2xsaW5nRmFzdCkgeyByZXR1cm4gfQ0KICAgIHRoaXMucG9sbGluZy5zZXQodGhpcy5jbS5vcHRpb25zLnBvbGxJbnRlcnZhbCwgZnVuY3Rpb24gKCkgew0KICAgICAgdGhpcyQxLnBvbGwoKTsNCiAgICAgIGlmICh0aGlzJDEuY20uc3RhdGUuZm9jdXNlZCkgeyB0aGlzJDEuc2xvd1BvbGwoKTsgfQ0KICAgIH0pOw0KICB9Ow0KDQogIC8vIFdoZW4gYW4gZXZlbnQgaGFzIGp1c3QgY29tZSBpbiB0aGF0IGlzIGxpa2VseSB0byBhZGQgb3IgY2hhbmdlDQogIC8vIHNvbWV0aGluZyBpbiB0aGUgaW5wdXQgdGV4dGFyZWEsIHdlIHBvbGwgZmFzdGVyLCB0byBlbnN1cmUgdGhhdA0KICAvLyB0aGUgY2hhbmdlIGFwcGVhcnMgb24gdGhlIHNjcmVlbiBxdWlja2x5Lg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5mYXN0UG9sbCA9IGZ1bmN0aW9uICgpIHsNCiAgICB2YXIgbWlzc2VkID0gZmFsc2UsIGlucHV0ID0gdGhpczsNCiAgICBpbnB1dC5wb2xsaW5nRmFzdCA9IHRydWU7DQogICAgZnVuY3Rpb24gcCgpIHsNCiAgICAgIHZhciBjaGFuZ2VkID0gaW5wdXQucG9sbCgpOw0KICAgICAgaWYgKCFjaGFuZ2VkICYmICFtaXNzZWQpIHttaXNzZWQgPSB0cnVlOyBpbnB1dC5wb2xsaW5nLnNldCg2MCwgcCk7fQ0KICAgICAgZWxzZSB7aW5wdXQucG9sbGluZ0Zhc3QgPSBmYWxzZTsgaW5wdXQuc2xvd1BvbGwoKTt9DQogICAgfQ0KICAgIGlucHV0LnBvbGxpbmcuc2V0KDIwLCBwKTsNCiAgfTsNCg0KICAvLyBSZWFkIGlucHV0IGZyb20gdGhlIHRleHRhcmVhLCBhbmQgdXBkYXRlIHRoZSBkb2N1bWVudCB0byBtYXRjaC4NCiAgLy8gV2hlbiBzb21ldGhpbmcgaXMgc2VsZWN0ZWQsIGl0IGlzIHByZXNlbnQgaW4gdGhlIHRleHRhcmVhLCBhbmQNCiAgLy8gc2VsZWN0ZWQgKHVubGVzcyBpdCBpcyBodWdlLCBpbiB3aGljaCBjYXNlIGEgcGxhY2Vob2xkZXIgaXMNCiAgLy8gdXNlZCkuIFdoZW4gbm90aGluZyBpcyBzZWxlY3RlZCwgdGhlIGN1cnNvciBzaXRzIGFmdGVyIHByZXZpb3VzbHkNCiAgLy8gc2VlbiB0ZXh0IChjYW4gYmUgZW1wdHkpLCB3aGljaCBpcyBzdG9yZWQgaW4gcHJldklucHV0ICh3ZSBtdXN0DQogIC8vIG5vdCByZXNldCB0aGUgdGV4dGFyZWEgd2hlbiB0eXBpbmcsIGJlY2F1c2UgdGhhdCBicmVha3MgSU1FKS4NCiAgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUucG9sbCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIHZhciB0aGlzJDEgPSB0aGlzOw0KDQogICAgdmFyIGNtID0gdGhpcy5jbSwgaW5wdXQgPSB0aGlzLnRleHRhcmVhLCBwcmV2SW5wdXQgPSB0aGlzLnByZXZJbnB1dDsNCiAgICAvLyBTaW5jZSB0aGlzIGlzIGNhbGxlZCBhICpsb3QqLCB0cnkgdG8gYmFpbCBvdXQgYXMgY2hlYXBseSBhcw0KICAgIC8vIHBvc3NpYmxlIHdoZW4gaXQgaXMgY2xlYXIgdGhhdCBub3RoaW5nIGhhcHBlbmVkLiBoYXNTZWxlY3Rpb24NCiAgICAvLyB3aWxsIGJlIHRoZSBjYXNlIHdoZW4gdGhlcmUgaXMgYSBsb3Qgb2YgdGV4dCBpbiB0aGUgdGV4dGFyZWEsDQogICAgLy8gaW4gd2hpY2ggY2FzZSByZWFkaW5nIGl0cyB2YWx1ZSB3b3VsZCBiZSBleHBlbnNpdmUuDQogICAgaWYgKHRoaXMuY29udGV4dE1lbnVQZW5kaW5nIHx8ICFjbS5zdGF0ZS5mb2N1c2VkIHx8DQogICAgICAgIChoYXNTZWxlY3Rpb24oaW5wdXQpICYmICFwcmV2SW5wdXQgJiYgIXRoaXMuY29tcG9zaW5nKSB8fA0KICAgICAgICBjbS5pc1JlYWRPbmx5KCkgfHwgY20ub3B0aW9ucy5kaXNhYmxlSW5wdXQgfHwgY20uc3RhdGUua2V5U2VxKQ0KICAgICAgeyByZXR1cm4gZmFsc2UgfQ0KDQogICAgdmFyIHRleHQgPSBpbnB1dC52YWx1ZTsNCiAgICAvLyBJZiBub3RoaW5nIGNoYW5nZWQsIGJhaWwuDQogICAgaWYgKHRleHQgPT0gcHJldklucHV0ICYmICFjbS5zb21ldGhpbmdTZWxlY3RlZCgpKSB7IHJldHVybiBmYWxzZSB9DQogICAgLy8gV29yayBhcm91bmQgbm9uc2Vuc2ljYWwgc2VsZWN0aW9uIHJlc2V0dGluZyBpbiBJRTkvMTAsIGFuZA0KICAgIC8vIGluZXhwbGljYWJsZSBhcHBlYXJhbmNlIG9mIHByaXZhdGUgYXJlYSB1bmljb2RlIGNoYXJhY3RlcnMgb24NCiAgICAvLyBzb21lIGtleSBjb21ib3MgaW4gTWFjICgjMjY4OSkuDQogICAgaWYgKGllICYmIGllX3ZlcnNpb24gPj0gOSAmJiB0aGlzLmhhc1NlbGVjdGlvbiA9PT0gdGV4dCB8fA0KICAgICAgICBtYWMgJiYgL1tcdWY3MDAtXHVmN2ZmXS8udGVzdCh0ZXh0KSkgew0KICAgICAgY20uZGlzcGxheS5pbnB1dC5yZXNldCgpOw0KICAgICAgcmV0dXJuIGZhbHNlDQogICAgfQ0KDQogICAgaWYgKGNtLmRvYy5zZWwgPT0gY20uZGlzcGxheS5zZWxGb3JDb250ZXh0TWVudSkgew0KICAgICAgdmFyIGZpcnN0ID0gdGV4dC5jaGFyQ29kZUF0KDApOw0KICAgICAgaWYgKGZpcnN0ID09IDB4MjAwYiAmJiAhcHJldklucHV0KSB7IHByZXZJbnB1dCA9ICJcdTIwMGIiOyB9DQogICAgICBpZiAoZmlyc3QgPT0gMHgyMWRhKSB7IHRoaXMucmVzZXQoKTsgcmV0dXJuIHRoaXMuY20uZXhlY0NvbW1hbmQoInVuZG8iKSB9DQogICAgfQ0KICAgIC8vIEZpbmQgdGhlIHBhcnQgb2YgdGhlIGlucHV0IHRoYXQgaXMgYWN0dWFsbHkgbmV3DQogICAgdmFyIHNhbWUgPSAwLCBsID0gTWF0aC5taW4ocHJldklucHV0Lmxlbmd0aCwgdGV4dC5sZW5ndGgpOw0KICAgIHdoaWxlIChzYW1lIDwgbCAmJiBwcmV2SW5wdXQuY2hhckNvZGVBdChzYW1lKSA9PSB0ZXh0LmNoYXJDb2RlQXQoc2FtZSkpIHsgKytzYW1lOyB9DQoNCiAgICBydW5Jbk9wKGNtLCBmdW5jdGlvbiAoKSB7DQogICAgICBhcHBseVRleHRJbnB1dChjbSwgdGV4dC5zbGljZShzYW1lKSwgcHJldklucHV0Lmxlbmd0aCAtIHNhbWUsDQogICAgICAgICAgICAgICAgICAgICBudWxsLCB0aGlzJDEuY29tcG9zaW5nID8gIipjb21wb3NlIiA6IG51bGwpOw0KDQogICAgICAvLyBEb24ndCBsZWF2ZSBsb25nIHRleHQgaW4gdGhlIHRleHRhcmVhLCBzaW5jZSBpdCBtYWtlcyBmdXJ0aGVyIHBvbGxpbmcgc2xvdw0KICAgICAgaWYgKHRleHQubGVuZ3RoID4gMTAwMCB8fCB0ZXh0LmluZGV4T2YoIlxuIikgPiAtMSkgeyBpbnB1dC52YWx1ZSA9IHRoaXMkMS5wcmV2SW5wdXQgPSAiIjsgfQ0KICAgICAgZWxzZSB7IHRoaXMkMS5wcmV2SW5wdXQgPSB0ZXh0OyB9DQoNCiAgICAgIGlmICh0aGlzJDEuY29tcG9zaW5nKSB7DQogICAgICAgIHRoaXMkMS5jb21wb3NpbmcucmFuZ2UuY2xlYXIoKTsNCiAgICAgICAgdGhpcyQxLmNvbXBvc2luZy5yYW5nZSA9IGNtLm1hcmtUZXh0KHRoaXMkMS5jb21wb3Npbmcuc3RhcnQsIGNtLmdldEN1cnNvcigidG8iKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7Y2xhc3NOYW1lOiAiQ29kZU1pcnJvci1jb21wb3NpbmcifSk7DQogICAgICB9DQogICAgfSk7DQogICAgcmV0dXJuIHRydWUNCiAgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5lbnN1cmVQb2xsZWQgPSBmdW5jdGlvbiAoKSB7DQogICAgaWYgKHRoaXMucG9sbGluZ0Zhc3QgJiYgdGhpcy5wb2xsKCkpIHsgdGhpcy5wb2xsaW5nRmFzdCA9IGZhbHNlOyB9DQogIH07DQoNCiAgVGV4dGFyZWFJbnB1dC5wcm90b3R5cGUub25LZXlQcmVzcyA9IGZ1bmN0aW9uICgpIHsNCiAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA+PSA5KSB7IHRoaXMuaGFzU2VsZWN0aW9uID0gbnVsbDsgfQ0KICAgIHRoaXMuZmFzdFBvbGwoKTsNCiAgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5vbkNvbnRleHRNZW51ID0gZnVuY3Rpb24gKGUpIHsNCiAgICB2YXIgaW5wdXQgPSB0aGlzLCBjbSA9IGlucHV0LmNtLCBkaXNwbGF5ID0gY20uZGlzcGxheSwgdGUgPSBpbnB1dC50ZXh0YXJlYTsNCiAgICBpZiAoaW5wdXQuY29udGV4dE1lbnVQZW5kaW5nKSB7IGlucHV0LmNvbnRleHRNZW51UGVuZGluZygpOyB9DQogICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShjbSwgZSksIHNjcm9sbFBvcyA9IGRpc3BsYXkuc2Nyb2xsZXIuc2Nyb2xsVG9wOw0KICAgIGlmICghcG9zIHx8IHByZXN0bykgeyByZXR1cm4gfSAvLyBPcGVyYSBpcyBkaWZmaWN1bHQuDQoNCiAgICAvLyBSZXNldCB0aGUgY3VycmVudCB0ZXh0IHNlbGVjdGlvbiBvbmx5IGlmIHRoZSBjbGljayBpcyBkb25lIG91dHNpZGUgb2YgdGhlIHNlbGVjdGlvbg0KICAgIC8vIGFuZCAncmVzZXRTZWxlY3Rpb25PbkNvbnRleHRNZW51JyBvcHRpb24gaXMgdHJ1ZS4NCiAgICB2YXIgcmVzZXQgPSBjbS5vcHRpb25zLnJlc2V0U2VsZWN0aW9uT25Db250ZXh0TWVudTsNCiAgICBpZiAocmVzZXQgJiYgY20uZG9jLnNlbC5jb250YWlucyhwb3MpID09IC0xKQ0KICAgICAgeyBvcGVyYXRpb24oY20sIHNldFNlbGVjdGlvbikoY20uZG9jLCBzaW1wbGVTZWxlY3Rpb24ocG9zKSwgc2VsX2RvbnRTY3JvbGwpOyB9DQoNCiAgICB2YXIgb2xkQ1NTID0gdGUuc3R5bGUuY3NzVGV4dCwgb2xkV3JhcHBlckNTUyA9IGlucHV0LndyYXBwZXIuc3R5bGUuY3NzVGV4dDsNCiAgICB2YXIgd3JhcHBlckJveCA9IGlucHV0LndyYXBwZXIub2Zmc2V0UGFyZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOw0KICAgIGlucHV0LndyYXBwZXIuc3R5bGUuY3NzVGV4dCA9ICJwb3NpdGlvbjogc3RhdGljIjsNCiAgICB0ZS5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOiBhYnNvbHV0ZTsgd2lkdGg6IDMwcHg7IGhlaWdodDogMzBweDtcbiAgICAgIHRvcDogIiArIChlLmNsaWVudFkgLSB3cmFwcGVyQm94LnRvcCAtIDUpICsgInB4OyBsZWZ0OiAiICsgKGUuY2xpZW50WCAtIHdyYXBwZXJCb3gubGVmdCAtIDUpICsgInB4O1xuICAgICAgei1pbmRleDogMTAwMDsgYmFja2dyb3VuZDogIiArIChpZSA/ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIC4wNSkiIDogInRyYW5zcGFyZW50IikgKyAiO1xuICAgICAgb3V0bGluZTogbm9uZTsgYm9yZGVyLXdpZHRoOiAwOyBvdXRsaW5lOiBub25lOyBvdmVyZmxvdzogaGlkZGVuOyBvcGFjaXR5OiAuMDU7IGZpbHRlcjogYWxwaGEob3BhY2l0eT01KTsiOw0KICAgIHZhciBvbGRTY3JvbGxZOw0KICAgIGlmICh3ZWJraXQpIHsgb2xkU2Nyb2xsWSA9IHdpbmRvdy5zY3JvbGxZOyB9IC8vIFdvcmsgYXJvdW5kIENocm9tZSBpc3N1ZSAoIzI3MTIpDQogICAgZGlzcGxheS5pbnB1dC5mb2N1cygpOw0KICAgIGlmICh3ZWJraXQpIHsgd2luZG93LnNjcm9sbFRvKG51bGwsIG9sZFNjcm9sbFkpOyB9DQogICAgZGlzcGxheS5pbnB1dC5yZXNldCgpOw0KICAgIC8vIEFkZHMgIlNlbGVjdCBhbGwiIHRvIGNvbnRleHQgbWVudSBpbiBGRg0KICAgIGlmICghY20uc29tZXRoaW5nU2VsZWN0ZWQoKSkgeyB0ZS52YWx1ZSA9IGlucHV0LnByZXZJbnB1dCA9ICIgIjsgfQ0KICAgIGlucHV0LmNvbnRleHRNZW51UGVuZGluZyA9IHJlaGlkZTsNCiAgICBkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gY20uZG9jLnNlbDsNCiAgICBjbGVhclRpbWVvdXQoZGlzcGxheS5kZXRlY3RpbmdTZWxlY3RBbGwpOw0KDQogICAgLy8gU2VsZWN0LWFsbCB3aWxsIGJlIGdyZXllZCBvdXQgaWYgdGhlcmUncyBub3RoaW5nIHRvIHNlbGVjdCwgc28NCiAgICAvLyB0aGlzIGFkZHMgYSB6ZXJvLXdpZHRoIHNwYWNlIHNvIHRoYXQgd2UgY2FuIGxhdGVyIGNoZWNrIHdoZXRoZXINCiAgICAvLyBpdCBnb3Qgc2VsZWN0ZWQuDQogICAgZnVuY3Rpb24gcHJlcGFyZVNlbGVjdEFsbEhhY2soKSB7DQogICAgICBpZiAodGUuc2VsZWN0aW9uU3RhcnQgIT0gbnVsbCkgew0KICAgICAgICB2YXIgc2VsZWN0ZWQgPSBjbS5zb21ldGhpbmdTZWxlY3RlZCgpOw0KICAgICAgICB2YXIgZXh0dmFsID0gIlx1MjAwYiIgKyAoc2VsZWN0ZWQgPyB0ZS52YWx1ZSA6ICIiKTsNCiAgICAgICAgdGUudmFsdWUgPSAiXHUyMWRhIjsgLy8gVXNlZCB0byBjYXRjaCBjb250ZXh0LW1lbnUgdW5kbw0KICAgICAgICB0ZS52YWx1ZSA9IGV4dHZhbDsNCiAgICAgICAgaW5wdXQucHJldklucHV0ID0gc2VsZWN0ZWQgPyAiIiA6ICJcdTIwMGIiOw0KICAgICAgICB0ZS5zZWxlY3Rpb25TdGFydCA9IDE7IHRlLnNlbGVjdGlvbkVuZCA9IGV4dHZhbC5sZW5ndGg7DQogICAgICAgIC8vIFJlLXNldCB0aGlzLCBpbiBjYXNlIHNvbWUgb3RoZXIgaGFuZGxlciB0b3VjaGVkIHRoZQ0KICAgICAgICAvLyBzZWxlY3Rpb24gaW4gdGhlIG1lYW50aW1lLg0KICAgICAgICBkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gY20uZG9jLnNlbDsNCiAgICAgIH0NCiAgICB9DQogICAgZnVuY3Rpb24gcmVoaWRlKCkgew0KICAgICAgaWYgKGlucHV0LmNvbnRleHRNZW51UGVuZGluZyAhPSByZWhpZGUpIHsgcmV0dXJuIH0NCiAgICAgIGlucHV0LmNvbnRleHRNZW51UGVuZGluZyA9IGZhbHNlOw0KICAgICAgaW5wdXQud3JhcHBlci5zdHlsZS5jc3NUZXh0ID0gb2xkV3JhcHBlckNTUzsNCiAgICAgIHRlLnN0eWxlLmNzc1RleHQgPSBvbGRDU1M7DQogICAgICBpZiAoaWUgJiYgaWVfdmVyc2lvbiA8IDkpIHsgZGlzcGxheS5zY3JvbGxiYXJzLnNldFNjcm9sbFRvcChkaXNwbGF5LnNjcm9sbGVyLnNjcm9sbFRvcCA9IHNjcm9sbFBvcyk7IH0NCg0KICAgICAgLy8gVHJ5IHRvIGRldGVjdCB0aGUgdXNlciBjaG9vc2luZyBzZWxlY3QtYWxsDQogICAgICBpZiAodGUuc2VsZWN0aW9uU3RhcnQgIT0gbnVsbCkgew0KICAgICAgICBpZiAoIWllIHx8IChpZSAmJiBpZV92ZXJzaW9uIDwgOSkpIHsgcHJlcGFyZVNlbGVjdEFsbEhhY2soKTsgfQ0KICAgICAgICB2YXIgaSA9IDAsIHBvbGwgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgaWYgKGRpc3BsYXkuc2VsRm9yQ29udGV4dE1lbnUgPT0gY20uZG9jLnNlbCAmJiB0ZS5zZWxlY3Rpb25TdGFydCA9PSAwICYmDQogICAgICAgICAgICAgIHRlLnNlbGVjdGlvbkVuZCA+IDAgJiYgaW5wdXQucHJldklucHV0ID09ICJcdTIwMGIiKSB7DQogICAgICAgICAgICBvcGVyYXRpb24oY20sIHNlbGVjdEFsbCkoY20pOw0KICAgICAgICAgIH0gZWxzZSBpZiAoaSsrIDwgMTApIHsNCiAgICAgICAgICAgIGRpc3BsYXkuZGV0ZWN0aW5nU2VsZWN0QWxsID0gc2V0VGltZW91dChwb2xsLCA1MDApOw0KICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICBkaXNwbGF5LnNlbEZvckNvbnRleHRNZW51ID0gbnVsbDsNCiAgICAgICAgICAgIGRpc3BsYXkuaW5wdXQucmVzZXQoKTsNCiAgICAgICAgICB9DQogICAgICAgIH07DQogICAgICAgIGRpc3BsYXkuZGV0ZWN0aW5nU2VsZWN0QWxsID0gc2V0VGltZW91dChwb2xsLCAyMDApOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChpZSAmJiBpZV92ZXJzaW9uID49IDkpIHsgcHJlcGFyZVNlbGVjdEFsbEhhY2soKTsgfQ0KICAgIGlmIChjYXB0dXJlUmlnaHRDbGljaykgew0KICAgICAgZV9zdG9wKGUpOw0KICAgICAgdmFyIG1vdXNldXAgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIG9mZih3aW5kb3csICJtb3VzZXVwIiwgbW91c2V1cCk7DQogICAgICAgIHNldFRpbWVvdXQocmVoaWRlLCAyMCk7DQogICAgICB9Ow0KICAgICAgb24od2luZG93LCAibW91c2V1cCIsIG1vdXNldXApOw0KICAgIH0gZWxzZSB7DQogICAgICBzZXRUaW1lb3V0KHJlaGlkZSwgNTApOw0KICAgIH0NCiAgfTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5yZWFkT25seUNoYW5nZWQgPSBmdW5jdGlvbiAodmFsKSB7DQogICAgaWYgKCF2YWwpIHsgdGhpcy5yZXNldCgpOyB9DQogICAgdGhpcy50ZXh0YXJlYS5kaXNhYmxlZCA9IHZhbCA9PSAibm9jdXJzb3IiOw0KICB9Ow0KDQogIFRleHRhcmVhSW5wdXQucHJvdG90eXBlLnNldFVuZWRpdGFibGUgPSBmdW5jdGlvbiAoKSB7fTsNCg0KICBUZXh0YXJlYUlucHV0LnByb3RvdHlwZS5uZWVkc0NvbnRlbnRBdHRyaWJ1dGUgPSBmYWxzZTsNCg0KICBmdW5jdGlvbiBmcm9tVGV4dEFyZWEodGV4dGFyZWEsIG9wdGlvbnMpIHsNCiAgICBvcHRpb25zID0gb3B0aW9ucyA/IGNvcHlPYmoob3B0aW9ucykgOiB7fTsNCiAgICBvcHRpb25zLnZhbHVlID0gdGV4dGFyZWEudmFsdWU7DQogICAgaWYgKCFvcHRpb25zLnRhYmluZGV4ICYmIHRleHRhcmVhLnRhYkluZGV4KQ0KICAgICAgeyBvcHRpb25zLnRhYmluZGV4ID0gdGV4dGFyZWEudGFiSW5kZXg7IH0NCiAgICBpZiAoIW9wdGlvbnMucGxhY2Vob2xkZXIgJiYgdGV4dGFyZWEucGxhY2Vob2xkZXIpDQogICAgICB7IG9wdGlvbnMucGxhY2Vob2xkZXIgPSB0ZXh0YXJlYS5wbGFjZWhvbGRlcjsgfQ0KICAgIC8vIFNldCBhdXRvZm9jdXMgdG8gdHJ1ZSBpZiB0aGlzIHRleHRhcmVhIGlzIGZvY3VzZWQsIG9yIGlmIGl0IGhhcw0KICAgIC8vIGF1dG9mb2N1cyBhbmQgbm8gb3RoZXIgZWxlbWVudCBpcyBmb2N1c2VkLg0KICAgIGlmIChvcHRpb25zLmF1dG9mb2N1cyA9PSBudWxsKSB7DQogICAgICB2YXIgaGFzRm9jdXMgPSBhY3RpdmVFbHQoKTsNCiAgICAgIG9wdGlvbnMuYXV0b2ZvY3VzID0gaGFzRm9jdXMgPT0gdGV4dGFyZWEgfHwNCiAgICAgICAgdGV4dGFyZWEuZ2V0QXR0cmlidXRlKCJhdXRvZm9jdXMiKSAhPSBudWxsICYmIGhhc0ZvY3VzID09IGRvY3VtZW50LmJvZHk7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gc2F2ZSgpIHt0ZXh0YXJlYS52YWx1ZSA9IGNtLmdldFZhbHVlKCk7fQ0KDQogICAgdmFyIHJlYWxTdWJtaXQ7DQogICAgaWYgKHRleHRhcmVhLmZvcm0pIHsNCiAgICAgIG9uKHRleHRhcmVhLmZvcm0sICJzdWJtaXQiLCBzYXZlKTsNCiAgICAgIC8vIERlcGxvcmFibGUgaGFjayB0byBtYWtlIHRoZSBzdWJtaXQgbWV0aG9kIGRvIHRoZSByaWdodCB0aGluZy4NCiAgICAgIGlmICghb3B0aW9ucy5sZWF2ZVN1Ym1pdE1ldGhvZEFsb25lKSB7DQogICAgICAgIHZhciBmb3JtID0gdGV4dGFyZWEuZm9ybTsNCiAgICAgICAgcmVhbFN1Ym1pdCA9IGZvcm0uc3VibWl0Ow0KICAgICAgICB0cnkgew0KICAgICAgICAgIHZhciB3cmFwcGVkU3VibWl0ID0gZm9ybS5zdWJtaXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICBzYXZlKCk7DQogICAgICAgICAgICBmb3JtLnN1Ym1pdCA9IHJlYWxTdWJtaXQ7DQogICAgICAgICAgICBmb3JtLnN1Ym1pdCgpOw0KICAgICAgICAgICAgZm9ybS5zdWJtaXQgPSB3cmFwcGVkU3VibWl0Ow0KICAgICAgICAgIH07DQogICAgICAgIH0gY2F0Y2goZSkge30NCiAgICAgIH0NCiAgICB9DQoNCiAgICBvcHRpb25zLmZpbmlzaEluaXQgPSBmdW5jdGlvbiAoY20pIHsNCiAgICAgIGNtLnNhdmUgPSBzYXZlOw0KICAgICAgY20uZ2V0VGV4dEFyZWEgPSBmdW5jdGlvbiAoKSB7IHJldHVybiB0ZXh0YXJlYTsgfTsNCiAgICAgIGNtLnRvVGV4dEFyZWEgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGNtLnRvVGV4dEFyZWEgPSBpc05hTjsgLy8gUHJldmVudCB0aGlzIGZyb20gYmVpbmcgcmFuIHR3aWNlDQogICAgICAgIHNhdmUoKTsNCiAgICAgICAgdGV4dGFyZWEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChjbS5nZXRXcmFwcGVyRWxlbWVudCgpKTsNCiAgICAgICAgdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9ICIiOw0KICAgICAgICBpZiAodGV4dGFyZWEuZm9ybSkgew0KICAgICAgICAgIG9mZih0ZXh0YXJlYS5mb3JtLCAic3VibWl0Iiwgc2F2ZSk7DQogICAgICAgICAgaWYgKCFvcHRpb25zLmxlYXZlU3VibWl0TWV0aG9kQWxvbmUgJiYgdHlwZW9mIHRleHRhcmVhLmZvcm0uc3VibWl0ID09ICJmdW5jdGlvbiIpDQogICAgICAgICAgICB7IHRleHRhcmVhLmZvcm0uc3VibWl0ID0gcmVhbFN1Ym1pdDsgfQ0KICAgICAgICB9DQogICAgICB9Ow0KICAgIH07DQoNCiAgICB0ZXh0YXJlYS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOw0KICAgIHZhciBjbSA9IENvZGVNaXJyb3IoZnVuY3Rpb24gKG5vZGUpIHsgcmV0dXJuIHRleHRhcmVhLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5vZGUsIHRleHRhcmVhLm5leHRTaWJsaW5nKTsgfSwNCiAgICAgIG9wdGlvbnMpOw0KICAgIHJldHVybiBjbQ0KICB9DQoNCiAgZnVuY3Rpb24gYWRkTGVnYWN5UHJvcHMoQ29kZU1pcnJvcikgew0KICAgIENvZGVNaXJyb3Iub2ZmID0gb2ZmOw0KICAgIENvZGVNaXJyb3Iub24gPSBvbjsNCiAgICBDb2RlTWlycm9yLndoZWVsRXZlbnRQaXhlbHMgPSB3aGVlbEV2ZW50UGl4ZWxzOw0KICAgIENvZGVNaXJyb3IuRG9jID0gRG9jOw0KICAgIENvZGVNaXJyb3Iuc3BsaXRMaW5lcyA9IHNwbGl0TGluZXNBdXRvOw0KICAgIENvZGVNaXJyb3IuY291bnRDb2x1bW4gPSBjb3VudENvbHVtbjsNCiAgICBDb2RlTWlycm9yLmZpbmRDb2x1bW4gPSBmaW5kQ29sdW1uOw0KICAgIENvZGVNaXJyb3IuaXNXb3JkQ2hhciA9IGlzV29yZENoYXJCYXNpYzsNCiAgICBDb2RlTWlycm9yLlBhc3MgPSBQYXNzOw0KICAgIENvZGVNaXJyb3Iuc2lnbmFsID0gc2lnbmFsOw0KICAgIENvZGVNaXJyb3IuTGluZSA9IExpbmU7DQogICAgQ29kZU1pcnJvci5jaGFuZ2VFbmQgPSBjaGFuZ2VFbmQ7DQogICAgQ29kZU1pcnJvci5zY3JvbGxiYXJNb2RlbCA9IHNjcm9sbGJhck1vZGVsOw0KICAgIENvZGVNaXJyb3IuUG9zID0gUG9zOw0KICAgIENvZGVNaXJyb3IuY21wUG9zID0gY21wOw0KICAgIENvZGVNaXJyb3IubW9kZXMgPSBtb2RlczsNCiAgICBDb2RlTWlycm9yLm1pbWVNb2RlcyA9IG1pbWVNb2RlczsNCiAgICBDb2RlTWlycm9yLnJlc29sdmVNb2RlID0gcmVzb2x2ZU1vZGU7DQogICAgQ29kZU1pcnJvci5nZXRNb2RlID0gZ2V0TW9kZTsNCiAgICBDb2RlTWlycm9yLm1vZGVFeHRlbnNpb25zID0gbW9kZUV4dGVuc2lvbnM7DQogICAgQ29kZU1pcnJvci5leHRlbmRNb2RlID0gZXh0ZW5kTW9kZTsNCiAgICBDb2RlTWlycm9yLmNvcHlTdGF0ZSA9IGNvcHlTdGF0ZTsNCiAgICBDb2RlTWlycm9yLnN0YXJ0U3RhdGUgPSBzdGFydFN0YXRlOw0KICAgIENvZGVNaXJyb3IuaW5uZXJNb2RlID0gaW5uZXJNb2RlOw0KICAgIENvZGVNaXJyb3IuY29tbWFuZHMgPSBjb21tYW5kczsNCiAgICBDb2RlTWlycm9yLmtleU1hcCA9IGtleU1hcDsNCiAgICBDb2RlTWlycm9yLmtleU5hbWUgPSBrZXlOYW1lOw0KICAgIENvZGVNaXJyb3IuaXNNb2RpZmllcktleSA9IGlzTW9kaWZpZXJLZXk7DQogICAgQ29kZU1pcnJvci5sb29rdXBLZXkgPSBsb29rdXBLZXk7DQogICAgQ29kZU1pcnJvci5ub3JtYWxpemVLZXlNYXAgPSBub3JtYWxpemVLZXlNYXA7DQogICAgQ29kZU1pcnJvci5TdHJpbmdTdHJlYW0gPSBTdHJpbmdTdHJlYW07DQogICAgQ29kZU1pcnJvci5TaGFyZWRUZXh0TWFya2VyID0gU2hhcmVkVGV4dE1hcmtlcjsNCiAgICBDb2RlTWlycm9yLlRleHRNYXJrZXIgPSBUZXh0TWFya2VyOw0KICAgIENvZGVNaXJyb3IuTGluZVdpZGdldCA9IExpbmVXaWRnZXQ7DQogICAgQ29kZU1pcnJvci5lX3ByZXZlbnREZWZhdWx0ID0gZV9wcmV2ZW50RGVmYXVsdDsNCiAgICBDb2RlTWlycm9yLmVfc3RvcFByb3BhZ2F0aW9uID0gZV9zdG9wUHJvcGFnYXRpb247DQogICAgQ29kZU1pcnJvci5lX3N0b3AgPSBlX3N0b3A7DQogICAgQ29kZU1pcnJvci5hZGRDbGFzcyA9IGFkZENsYXNzOw0KICAgIENvZGVNaXJyb3IuY29udGFpbnMgPSBjb250YWluczsNCiAgICBDb2RlTWlycm9yLnJtQ2xhc3MgPSBybUNsYXNzOw0KICAgIENvZGVNaXJyb3Iua2V5TmFtZXMgPSBrZXlOYW1lczsNCiAgfQ0KDQogIC8vIEVESVRPUiBDT05TVFJVQ1RPUg0KDQogIGRlZmluZU9wdGlvbnMoQ29kZU1pcnJvcik7DQoNCiAgYWRkRWRpdG9yTWV0aG9kcyhDb2RlTWlycm9yKTsNCg0KICAvLyBTZXQgdXAgbWV0aG9kcyBvbiBDb2RlTWlycm9yJ3MgcHJvdG90eXBlIHRvIHJlZGlyZWN0IHRvIHRoZSBlZGl0b3IncyBkb2N1bWVudC4NCiAgdmFyIGRvbnREZWxlZ2F0ZSA9ICJpdGVyIGluc2VydCByZW1vdmUgY29weSBnZXRFZGl0b3IgY29uc3RydWN0b3IiLnNwbGl0KCIgIik7DQogIGZvciAodmFyIHByb3AgaW4gRG9jLnByb3RvdHlwZSkgeyBpZiAoRG9jLnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eShwcm9wKSAmJiBpbmRleE9mKGRvbnREZWxlZ2F0ZSwgcHJvcCkgPCAwKQ0KICAgIHsgQ29kZU1pcnJvci5wcm90b3R5cGVbcHJvcF0gPSAoZnVuY3Rpb24obWV0aG9kKSB7DQogICAgICByZXR1cm4gZnVuY3Rpb24oKSB7cmV0dXJuIG1ldGhvZC5hcHBseSh0aGlzLmRvYywgYXJndW1lbnRzKX0NCiAgICB9KShEb2MucHJvdG90eXBlW3Byb3BdKTsgfSB9DQoNCiAgZXZlbnRNaXhpbihEb2MpOw0KICBDb2RlTWlycm9yLmlucHV0U3R5bGVzID0geyJ0ZXh0YXJlYSI6IFRleHRhcmVhSW5wdXQsICJjb250ZW50ZWRpdGFibGUiOiBDb250ZW50RWRpdGFibGVJbnB1dH07DQoNCiAgLy8gRXh0cmEgYXJndW1lbnRzIGFyZSBzdG9yZWQgYXMgdGhlIG1vZGUncyBkZXBlbmRlbmNpZXMsIHdoaWNoIGlzDQogIC8vIHVzZWQgYnkgKGxlZ2FjeSkgbWVjaGFuaXNtcyBsaWtlIGxvYWRtb2RlLmpzIHRvIGF1dG9tYXRpY2FsbHkNCiAgLy8gbG9hZCBhIG1vZGUuIChQcmVmZXJyZWQgbWVjaGFuaXNtIGlzIHRoZSByZXF1aXJlL2RlZmluZSBjYWxscy4pDQogIENvZGVNaXJyb3IuZGVmaW5lTW9kZSA9IGZ1bmN0aW9uKG5hbWUvKiwgbW9kZSwgw6LigqzCpiovKSB7DQogICAgaWYgKCFDb2RlTWlycm9yLmRlZmF1bHRzLm1vZGUgJiYgbmFtZSAhPSAibnVsbCIpIHsgQ29kZU1pcnJvci5kZWZhdWx0cy5tb2RlID0gbmFtZTsgfQ0KICAgIGRlZmluZU1vZGUuYXBwbHkodGhpcywgYXJndW1lbnRzKTsNCiAgfTsNCg0KICBDb2RlTWlycm9yLmRlZmluZU1JTUUgPSBkZWZpbmVNSU1FOw0KDQogIC8vIE1pbmltYWwgZGVmYXVsdCBtb2RlLg0KICBDb2RlTWlycm9yLmRlZmluZU1vZGUoIm51bGwiLCBmdW5jdGlvbiAoKSB7IHJldHVybiAoe3Rva2VuOiBmdW5jdGlvbiAoc3RyZWFtKSB7IHJldHVybiBzdHJlYW0uc2tpcFRvRW5kKCk7IH19KTsgfSk7DQogIENvZGVNaXJyb3IuZGVmaW5lTUlNRSgidGV4dC9wbGFpbiIsICJudWxsIik7DQoNCiAgLy8gRVhURU5TSU9OUw0KDQogIENvZGVNaXJyb3IuZGVmaW5lRXh0ZW5zaW9uID0gZnVuY3Rpb24gKG5hbWUsIGZ1bmMpIHsNCiAgICBDb2RlTWlycm9yLnByb3RvdHlwZVtuYW1lXSA9IGZ1bmM7DQogIH07DQogIENvZGVNaXJyb3IuZGVmaW5lRG9jRXh0ZW5zaW9uID0gZnVuY3Rpb24gKG5hbWUsIGZ1bmMpIHsNCiAgICBEb2MucHJvdG90eXBlW25hbWVdID0gZnVuYzsNCiAgfTsNCg0KICBDb2RlTWlycm9yLmZyb21UZXh0QXJlYSA9IGZyb21UZXh0QXJlYTsNCg0KICBhZGRMZWdhY3lQcm9wcyhDb2RlTWlycm9yKTsNCg0KICBDb2RlTWlycm9yLnZlcnNpb24gPSAiNS41My4yIjsNCg0KICByZXR1cm4gQ29kZU1pcnJvcjsNCg0KfSkpKTs=]]></Resource>
    <Resource ID="2a2d2448-2e13-b0bb-8a81-17014fba35bd" Name="Icon" Type="png"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
			bWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
			bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
			eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0
			NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
			dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
			dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
			IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
			ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
			cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNl
			SUQ9InhtcC5paWQ6MkNGM0JEMURGRDhCMTFFMTgyOTJFMzAxM0NFMjgxMDciIHhtcE1NOkRvY3Vt
			ZW50SUQ9InhtcC5kaWQ6MkNGM0JEMUVGRDhCMTFFMTgyOTJFMzAxM0NFMjgxMDciPiA8eG1wTU06
			RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoyQ0YzQkQxQkZEOEIxMUUxODI5
			MkUzMDEzQ0UyODEwNyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoyQ0YzQkQxQ0ZEOEIxMUUx
			ODI5MkUzMDEzQ0UyODEwNyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1w
			bWV0YT4gPD94cGFja2V0IGVuZD0iciI/PvPxTuMAAAUKSURBVHja7JpPaCNVHMd/L50k/U+73Vqa
			GC91jeBS2LQ1qbWuhe0lJw8LHjwI4kWLh6Kr0ENLCxbWdU+yelFREGFhBS/1siK4PbSFUqSIYNZA
			yV9Lu9u60abpv/F9X/omMyGbpklIpksePCbzZubl95nf+/1+7zfvMdKViYmJ5xwOxzcul+tSR0dH
			vcViIVVVRa1mYYyJenR0RJubm8lwOLwcj8ffnp2dDWj3yB8zMzM3+vv7308kEmxra4t2dnbo4ODA
			VCCKolBTUxO1t7dTc3Ozury8fHNycvKaBjI1NXWjt7f3g0gkQqlUivb39wXE4eGheAtmAMHoqKur
			EzBWq5Xq6+vJ6XTS6urqp9PT09fY+Pj48x6P54/19XW2t7dHsgLCjCCodrtdwNhsNurq6lJXVlYu
			Kq2trV/qIXZ3d2lhYYGCwaA4N1OB4D09PTQ4OKi9XMje1tb2lcLp+jGcMJRQl5aWaG1tTaiuoaHB
			VCAQHrJBGz6fT2gKbXy4ebjGLHb98InFYoIcN5mtQCbIFgqFNDAMfz7cbAoMWw+CCzkhnnUTvXLF
			2Pbfv0S3vz1ZgtffJGpqNrbd+5norz+LAoK8EgQVDIpslAaVD0L1v0YUvJ9uO9dBlNwh9neM6Ne7
			j//Xy6OkDr1K1NBI9PBBuq3nQsbvFwGTLSsYFBDJBlzMWSQEOvno3XTbW2OiTX3vQ2J5QHBdPPfT
			j0Rf30q33bkrnmVFgmTLCgaLnjKnINc/1zTBro5mLnCh2Gef5NfEnTSguO8YQpyjH96feBG8/1Js
			RgMryfp+/y0/TAVLaSAPNvLbx5kBMVGpgTxZIB5vSV6noiBsZSkdBBEAeewwuNcrfhHccpZoKB07
			4MK9L4v7tYJ+0B9cOvovQ1FOvINPQeCtEZ1FEAsGMsL1XspE+uyCQIfqfkHcp+qyOBGXYpE0RCFT
			nLKASBg+FUGUlpFaFLxRGekfp1F+XQy/F18ilVet/Yfvy+q6lYLv5H/Kivzjk2BrXqsGUgM5ZUqL
			af7xzFn/uzzGXsmU9jhdAIAhdSgJJFeaeppUVx9Ei+2jHCAqn4aI6L2b5NE6krlQYKorM0vaephJ
			dfUlvEbl+MxR+NDiEIZ4UGCqqw2XhXuGLNE8xq5LdYUxXh6tql09Me63Yl5L5ZNHlm34mICWab5V
			OffLnQNgDHYDj3XWNGJeY69NUcwGglQXWSIdfw6Nhs6I18JaiS5WGFLdAsa+ev4pYrliTeIRURny
			9sJBHE8b09wCU12tZKW6hj7KDZLrQ3apaWqhs9dT95slq6K/YJZVKu0r/tVRw2+DcWftARALPWiU
			1Uz5SD6NQlbILqsFy1aSDBppbGw0vauFjHIhFBWLuZbt7W1Vrqej9PX1mR7E6/WKI2SG7IlEQrXE
			4/F/cCKXp4eGhmhkZERslTBbgUyQbWBgQJMXssdisUfM7XZ/5/f738BuAmyPwPKvy+Wizs5OoULs
			NJC2U2lnIA0Zbx5CJ5NJ2tjYoHA4LDYzoA3Dam5u7jZzOBzPcMHvDw8P2+TGFVklRDU9mrQDOYyk
			JuSGn/n5+T0OdkFI193d/Y7T6bzl8/kYNKP3YhKgmiDyqPdS0MTi4qIajUbHuHl8oUnHYcasVutN
			PtTs2HXT0tIiNFJNiGwYeFhu2GJ3RiAQSPHzcUAIGfUPcAAnV9/H/MERXp28qc5U37sYS/FDjB9/
			4S95imsjKq/9L8AAJ/6bZaasazgAAAAASUVORK5CYII=]]></Resource>
    <Resource ID="3b92e99a-bae2-fecd-a5fc-39bcf6e535bf" Name="codemirror.js" Type="js"><![CDATA[Ly8gQ29kZU1pcnJvciB2ZXJzaW9uIDIuMjIKLy8KLy8gQWxsIGZ1bmN0aW9ucyB0aGF0IG5lZWQg
			YWNjZXNzIHRvIHRoZSBlZGl0b3IncyBzdGF0ZSBsaXZlIGluc2lkZQovLyB0aGUgQ29kZU1pcnJv
			ciBmdW5jdGlvbi4gQmVsb3cgdGhhdCwgYXQgdGhlIGJvdHRvbSBvZiB0aGUgZmlsZSwKLy8gc29t
			ZSB1dGlsaXRpZXMgYXJlIGRlZmluZWQuCgovLyBDb2RlTWlycm9yIGlzIHRoZSBvbmx5IGdsb2Jh
			bCB2YXIgd2UgY2xhaW0KdmFyIENvZGVNaXJyb3IgPSAoZnVuY3Rpb24oKSB7CiAgLy8gVGhpcyBp
			cyB0aGUgZnVuY3Rpb24gdGhhdCBwcm9kdWNlcyBhbiBlZGl0b3IgaW5zdGFuY2UuIEl0cwogIC8v
			IGNsb3N1cmUgaXMgdXNlZCB0byBzdG9yZSB0aGUgZWRpdG9yIHN0YXRlLgogIGZ1bmN0aW9uIENv
			ZGVNaXJyb3IocGxhY2UsIGdpdmVuT3B0aW9ucykgewogICAgLy8gRGV0ZXJtaW5lIGVmZmVjdGl2
			ZSBvcHRpb25zIGJhc2VkIG9uIGdpdmVuIHZhbHVlcyBhbmQgZGVmYXVsdHMuCiAgICB2YXIgb3B0
			aW9ucyA9IHt9LCBkZWZhdWx0cyA9IENvZGVNaXJyb3IuZGVmYXVsdHM7CiAgICBmb3IgKHZhciBv
			cHQgaW4gZGVmYXVsdHMpCiAgICAgIGlmIChkZWZhdWx0cy5oYXNPd25Qcm9wZXJ0eShvcHQpKQog
			ICAgICAgIG9wdGlvbnNbb3B0XSA9IChnaXZlbk9wdGlvbnMgJiYgZ2l2ZW5PcHRpb25zLmhhc093
			blByb3BlcnR5KG9wdCkgPyBnaXZlbk9wdGlvbnMgOiBkZWZhdWx0cylbb3B0XTsKCiAgICB2YXIg
			dGFyZ2V0RG9jdW1lbnQgPSBvcHRpb25zWyJkb2N1bWVudCJdOwogICAgLy8gVGhlIGVsZW1lbnQg
			aW4gd2hpY2ggdGhlIGVkaXRvciBsaXZlcy4KICAgIHZhciB3cmFwcGVyID0gdGFyZ2V0RG9jdW1l
			bnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICB3cmFwcGVyLmNsYXNzTmFtZSA9ICJDb2RlTWly
			cm9yIiArIChvcHRpb25zLmxpbmVXcmFwcGluZyA/ICIgQ29kZU1pcnJvci13cmFwIiA6ICIiKTsK
			ICAgIC8vIFRoaXMgbWVzcyBjcmVhdGVzIHRoZSBiYXNlIERPTSBzdHJ1Y3R1cmUgZm9yIHRoZSBl
			ZGl0b3IuCiAgICB3cmFwcGVyLmlubmVySFRNTCA9CiAgICAgICc8ZGl2IHN0eWxlPSJvdmVyZmxv
			dzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRpdmU7IHdpZHRoOiAzcHg7IGhlaWdodDogMHB4OyI+
			JyArIC8vIFdyYXBzIGFuZCBoaWRlcyBpbnB1dCB0ZXh0YXJlYQogICAgICAgICc8dGV4dGFyZWEg
			c3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgcGFkZGluZzogMDsgd2lkdGg6IDFweDsgaGVpZ2h0
			OiAxZW0iIHdyYXA9Im9mZiIgJyArCiAgICAgICAgICAnYXV0b2NvcnJlY3Q9Im9mZiIgYXV0b2Nh
			cGl0YWxpemU9Im9mZiI+PC90ZXh0YXJlYT48L2Rpdj4nICsKICAgICAgJzxkaXYgY2xhc3M9IkNv
			ZGVNaXJyb3Itc2Nyb2xsIiB0YWJpbmRleD0iLTEiPicgKwogICAgICAgICc8ZGl2IHN0eWxlPSJw
			b3NpdGlvbjogcmVsYXRpdmUiPicgKyAvLyBTZXQgdG8gdGhlIGhlaWdodCBvZiB0aGUgdGV4dCwg
			Y2F1c2VzIHNjcm9sbGluZwogICAgICAgICAgJzxkaXYgc3R5bGU9InBvc2l0aW9uOiByZWxhdGl2
			ZSI+JyArIC8vIE1vdmVkIGFyb3VuZCBpdHMgcGFyZW50IHRvIGNvdmVyIHZpc2libGUgdmlldwog
			ICAgICAgICAgICAnPGRpdiBjbGFzcz0iQ29kZU1pcnJvci1ndXR0ZXIiPjxkaXYgY2xhc3M9IkNv
			ZGVNaXJyb3ItZ3V0dGVyLXRleHQiPjwvZGl2PjwvZGl2PicgKwogICAgICAgICAgICAvLyBQcm92
			aWRlcyBwb3NpdGlvbmluZyByZWxhdGl2ZSB0byAodmlzaWJsZSkgdGV4dCBvcmlnaW4KICAgICAg
			ICAgICAgJzxkaXYgY2xhc3M9IkNvZGVNaXJyb3ItbGluZXMiPjxkaXYgc3R5bGU9InBvc2l0aW9u
			OiByZWxhdGl2ZTsgei1pbmRleDogMCI+JyArCiAgICAgICAgICAgICAgJzxkaXYgc3R5bGU9InBv
			c2l0aW9uOiBhYnNvbHV0ZTsgd2lkdGg6IDEwMCU7IGhlaWdodDogMDsgb3ZlcmZsb3c6IGhpZGRl
			bjsgdmlzaWJpbGl0eTogaGlkZGVuOyI+PC9kaXY+JyArCiAgICAgICAgICAgICAgJzxwcmUgY2xh
			c3M9IkNvZGVNaXJyb3ItY3Vyc29yIj4mIzE2MDs8L3ByZT4nICsgLy8gQWJzb2x1dGVseSBwb3Np
			dGlvbmVkIGJsaW5reSBjdXJzb3IKICAgICAgICAgICAgICAnPGRpdiBzdHlsZT0icG9zaXRpb246
			IHJlbGF0aXZlOyB6LWluZGV4OiAtMSI+PC9kaXY+PGRpdj48L2Rpdj4nICsgLy8gRElWcyBjb250
			YWluaW5nIHRoZSBzZWxlY3Rpb24gYW5kIHRoZSBhY3R1YWwgY29kZQogICAgICAgICAgICAnPC9k
			aXY+PC9kaXY+PC9kaXY+PC9kaXY+PC9kaXY+JzsKICAgIGlmIChwbGFjZS5hcHBlbmRDaGlsZCkg
			cGxhY2UuYXBwZW5kQ2hpbGQod3JhcHBlcik7IGVsc2UgcGxhY2Uod3JhcHBlcik7CiAgICAvLyBJ
			J3ZlIG5ldmVyIHNlZW4gbW9yZSBlbGVnYW50IGNvZGUgaW4gbXkgbGlmZS4KICAgIHZhciBpbnB1
			dERpdiA9IHdyYXBwZXIuZmlyc3RDaGlsZCwgaW5wdXQgPSBpbnB1dERpdi5maXJzdENoaWxkLAog
			ICAgICAgIHNjcm9sbGVyID0gd3JhcHBlci5sYXN0Q2hpbGQsIGNvZGUgPSBzY3JvbGxlci5maXJz
			dENoaWxkLAogICAgICAgIG1vdmVyID0gY29kZS5maXJzdENoaWxkLCBndXR0ZXIgPSBtb3Zlci5m
			aXJzdENoaWxkLCBndXR0ZXJUZXh0ID0gZ3V0dGVyLmZpcnN0Q2hpbGQsCiAgICAgICAgbGluZVNw
			YWNlID0gZ3V0dGVyLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQsIG1lYXN1cmUgPSBsaW5lU3BhY2Uu
			Zmlyc3RDaGlsZCwKICAgICAgICBjdXJzb3IgPSBtZWFzdXJlLm5leHRTaWJsaW5nLCBzZWxlY3Rp
			b25EaXYgPSBjdXJzb3IubmV4dFNpYmxpbmcsCiAgICAgICAgbGluZURpdiA9IHNlbGVjdGlvbkRp
			di5uZXh0U2libGluZzsKICAgIHRoZW1lQ2hhbmdlZCgpOwogICAgLy8gTmVlZGVkIHRvIGhpZGUg
			YmlnIGJsdWUgYmxpbmtpbmcgY3Vyc29yIG9uIE1vYmlsZSBTYWZhcmkKICAgIGlmIChpb3MpIGlu
			cHV0LnN0eWxlLndpZHRoID0gIjBweCI7CiAgICBpZiAoIXdlYmtpdCkgbGluZVNwYWNlLmRyYWdn
			YWJsZSA9IHRydWU7CiAgICBsaW5lU3BhY2Uuc3R5bGUub3V0bGluZSA9ICJub25lIjsKICAgIGlm
			IChvcHRpb25zLnRhYmluZGV4ICE9IG51bGwpIGlucHV0LnRhYkluZGV4ID0gb3B0aW9ucy50YWJp
			bmRleDsKICAgIGlmICghb3B0aW9ucy5ndXR0ZXIgJiYgIW9wdGlvbnMubGluZU51bWJlcnMpIGd1
			dHRlci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwoKICAgIC8vIENoZWNrIGZvciBwcm9ibGVtIHdp
			dGggSUUgaW5uZXJIVE1MIG5vdCB3b3JraW5nIHdoZW4gd2UgaGF2ZSBhCiAgICAvLyBQIChvciBz
			aW1pbGFyKSBwYXJlbnQgbm9kZS4KICAgIHRyeSB7IHN0cmluZ1dpZHRoKCJ4Iik7IH0KICAgIGNh
			dGNoIChlKSB7CiAgICAgIGlmIChlLm1lc3NhZ2UubWF0Y2goL3J1bnRpbWUvaSkpCiAgICAgICAg
			ZSA9IG5ldyBFcnJvcigiQSBDb2RlTWlycm9yIGluc2lkZSBhIFAtc3R5bGUgZWxlbWVudCBkb2Vz
			IG5vdCB3b3JrIGluIEludGVybmV0IEV4cGxvcmVyLiAoaW5uZXJIVE1MIGJ1ZykiKTsKICAgICAg
			dGhyb3cgZTsKICAgIH0KCiAgICAvLyBEZWxheWVkIG9iamVjdCB3cmFwIHRpbWVvdXRzLCBtYWtp
			bmcgc3VyZSBvbmx5IG9uZSBpcyBhY3RpdmUuIGJsaW5rZXIgaG9sZHMgYW4gaW50ZXJ2YWwuCiAg
			ICB2YXIgcG9sbCA9IG5ldyBEZWxheWVkKCksIGhpZ2hsaWdodCA9IG5ldyBEZWxheWVkKCksIGJs
			aW5rZXI7CgogICAgLy8gbW9kZSBob2xkcyBhIG1vZGUgQVBJIG9iamVjdC4gZG9jIGlzIHRoZSB0
			cmVlIG9mIExpbmUgb2JqZWN0cywKICAgIC8vIHdvcmsgYW4gYXJyYXkgb2YgbGluZXMgdGhhdCBz
			aG91bGQgYmUgcGFyc2VkLCBhbmQgaGlzdG9yeSB0aGUKICAgIC8vIHVuZG8gaGlzdG9yeSAoaW5z
			dGFuY2Ugb2YgSGlzdG9yeSBjb25zdHJ1Y3RvcikuCiAgICB2YXIgbW9kZSwgZG9jID0gbmV3IEJy
			YW5jaENodW5rKFtuZXcgTGVhZkNodW5rKFtuZXcgTGluZSgiIildKV0pLCB3b3JrLCBmb2N1c2Vk
			OwogICAgbG9hZE1vZGUoKTsKICAgIC8vIFRoZSBzZWxlY3Rpb24uIFRoZXNlIGFyZSBhbHdheXMg
			bWFpbnRhaW5lZCB0byBwb2ludCBhdCB2YWxpZAogICAgLy8gcG9zaXRpb25zLiBJbnZlcnRlZCBp
			cyB1c2VkIHRvIHJlbWVtYmVyIHRoYXQgdGhlIHVzZXIgaXMKICAgIC8vIHNlbGVjdGluZyBib3R0
			b20tdG8tdG9wLgogICAgdmFyIHNlbCA9IHtmcm9tOiB7bGluZTogMCwgY2g6IDB9LCB0bzoge2xp
			bmU6IDAsIGNoOiAwfSwgaW52ZXJ0ZWQ6IGZhbHNlfTsKICAgIC8vIFNlbGVjdGlvbi1yZWxhdGVk
			IGZsYWdzLiBzaGlmdFNlbGVjdGluZyBvYnZpb3VzbHkgdHJhY2tzCiAgICAvLyB3aGV0aGVyIHRo
			ZSB1c2VyIGlzIGhvbGRpbmcgc2hpZnQuCiAgICB2YXIgc2hpZnRTZWxlY3RpbmcsIGxhc3RDbGlj
			aywgbGFzdERvdWJsZUNsaWNrLCBsYXN0U2Nyb2xsUG9zID0gMCwgZHJhZ2dpbmdUZXh0LAogICAg
			ICAgIG92ZXJ3cml0ZSA9IGZhbHNlLCBzdXBwcmVzc0VkaXRzID0gZmFsc2U7CiAgICAvLyBWYXJp
			YWJsZXMgdXNlZCBieSBzdGFydE9wZXJhdGlvbi9lbmRPcGVyYXRpb24gdG8gdHJhY2sgd2hhdAog
			ICAgLy8gaGFwcGVuZWQgZHVyaW5nIHRoZSBvcGVyYXRpb24uCiAgICB2YXIgdXBkYXRlSW5wdXQs
			IHVzZXJTZWxDaGFuZ2UsIGNoYW5nZXMsIHRleHRDaGFuZ2VkLCBzZWxlY3Rpb25DaGFuZ2VkLCBs
			ZWF2ZUlucHV0QWxvbmUsCiAgICAgICAgZ3V0dGVyRGlydHksIGNhbGxiYWNrczsKICAgIC8vIEN1
			cnJlbnQgdmlzaWJsZSByYW5nZSAobWF5IGJlIGJpZ2dlciB0aGFuIHRoZSB2aWV3IHdpbmRvdyku
			CiAgICB2YXIgZGlzcGxheU9mZnNldCA9IDAsIHNob3dpbmdGcm9tID0gMCwgc2hvd2luZ1RvID0g
			MCwgbGFzdFNpemVDID0gMDsKICAgIC8vIGJyYWNrZXRIaWdobGlnaHRlZCBpcyB1c2VkIHRvIHJl
			bWVtYmVyIHRoYXQgYSBiYWNrZXQgaGFzIGJlZW4KICAgIC8vIG1hcmtlZC4KICAgIHZhciBicmFj
			a2V0SGlnaGxpZ2h0ZWQ7CiAgICAvLyBUcmFja3MgdGhlIG1heGltdW0gbGluZSBsZW5ndGggc28g
			dGhhdCB0aGUgaG9yaXpvbnRhbCBzY3JvbGxiYXIKICAgIC8vIGNhbiBiZSBrZXB0IHN0YXRpYyB3
			aGVuIHNjcm9sbGluZy4KICAgIHZhciBtYXhMaW5lID0gIiIsIG1heFdpZHRoOwoKICAgIC8vIElu
			aXRpYWxpemUgdGhlIGNvbnRlbnQuCiAgICBvcGVyYXRpb24oZnVuY3Rpb24oKXtzZXRWYWx1ZShv
			cHRpb25zLnZhbHVlIHx8ICIiKTsgdXBkYXRlSW5wdXQgPSBmYWxzZTt9KSgpOwogICAgdmFyIGhp
			c3RvcnkgPSBuZXcgSGlzdG9yeSgpOwoKICAgIC8vIFJlZ2lzdGVyIG91ciBldmVudCBoYW5kbGVy
			cy4KICAgIGNvbm5lY3Qoc2Nyb2xsZXIsICJtb3VzZWRvd24iLCBvcGVyYXRpb24ob25Nb3VzZURv
			d24pKTsKICAgIGNvbm5lY3Qoc2Nyb2xsZXIsICJkYmxjbGljayIsIG9wZXJhdGlvbihvbkRvdWJs
			ZUNsaWNrKSk7CiAgICBjb25uZWN0KGxpbmVTcGFjZSwgImRyYWdzdGFydCIsIG9uRHJhZ1N0YXJ0
			KTsKICAgIGNvbm5lY3QobGluZVNwYWNlLCAic2VsZWN0c3RhcnQiLCBlX3ByZXZlbnREZWZhdWx0
			KTsKICAgIC8vIEdlY2tvIGJyb3dzZXJzIGZpcmUgY29udGV4dG1lbnUgKmFmdGVyKiBvcGVuaW5n
			IHRoZSBtZW51LCBhdAogICAgLy8gd2hpY2ggcG9pbnQgd2UgY2FuJ3QgbWVzcyB3aXRoIGl0IGFu
			eW1vcmUuIENvbnRleHQgbWVudSBpcwogICAgLy8gaGFuZGxlZCBpbiBvbk1vdXNlRG93biBmb3Ig
			R2Vja28uCiAgICBpZiAoIWdlY2tvKSBjb25uZWN0KHNjcm9sbGVyLCAiY29udGV4dG1lbnUiLCBv
			bkNvbnRleHRNZW51KTsKICAgIGNvbm5lY3Qoc2Nyb2xsZXIsICJzY3JvbGwiLCBmdW5jdGlvbigp
			IHsKICAgICAgbGFzdFNjcm9sbFBvcyA9IHNjcm9sbGVyLnNjcm9sbFRvcDsKICAgICAgdXBkYXRl
			RGlzcGxheShbXSk7CiAgICAgIGlmIChvcHRpb25zLmZpeGVkR3V0dGVyKSBndXR0ZXIuc3R5bGUu
			bGVmdCA9IHNjcm9sbGVyLnNjcm9sbExlZnQgKyAicHgiOwogICAgICBpZiAob3B0aW9ucy5vblNj
			cm9sbCkgb3B0aW9ucy5vblNjcm9sbChpbnN0YW5jZSk7CiAgICB9KTsKICAgIGNvbm5lY3Qod2lu
			ZG93LCAicmVzaXplIiwgZnVuY3Rpb24oKSB7dXBkYXRlRGlzcGxheSh0cnVlKTt9KTsKICAgIGNv
			bm5lY3QoaW5wdXQsICJrZXl1cCIsIG9wZXJhdGlvbihvbktleVVwKSk7CiAgICBjb25uZWN0KGlu
			cHV0LCAiaW5wdXQiLCBmYXN0UG9sbCk7CiAgICBjb25uZWN0KGlucHV0LCAia2V5ZG93biIsIG9w
			ZXJhdGlvbihvbktleURvd24pKTsKICAgIGNvbm5lY3QoaW5wdXQsICJrZXlwcmVzcyIsIG9wZXJh
			dGlvbihvbktleVByZXNzKSk7CiAgICBjb25uZWN0KGlucHV0LCAiZm9jdXMiLCBvbkZvY3VzKTsK
			ICAgIGNvbm5lY3QoaW5wdXQsICJibHVyIiwgb25CbHVyKTsKCiAgICBjb25uZWN0KHNjcm9sbGVy
			LCAiZHJhZ2VudGVyIiwgZV9zdG9wKTsKICAgIGNvbm5lY3Qoc2Nyb2xsZXIsICJkcmFnb3ZlciIs
			IGVfc3RvcCk7CiAgICBjb25uZWN0KHNjcm9sbGVyLCAiZHJvcCIsIG9wZXJhdGlvbihvbkRyb3Ap
			KTsKICAgIGNvbm5lY3Qoc2Nyb2xsZXIsICJwYXN0ZSIsIGZ1bmN0aW9uKCl7Zm9jdXNJbnB1dCgp
			OyBmYXN0UG9sbCgpO30pOwogICAgY29ubmVjdChpbnB1dCwgInBhc3RlIiwgZmFzdFBvbGwpOwog
			ICAgY29ubmVjdChpbnB1dCwgImN1dCIsIG9wZXJhdGlvbihmdW5jdGlvbigpewogICAgICBpZiAo
			IW9wdGlvbnMucmVhZE9ubHkpIHJlcGxhY2VTZWxlY3Rpb24oIiIpOwogICAgfSkpOwoKICAgIC8v
			IElFIHRocm93cyB1bnNwZWNpZmllZCBlcnJvciBpbiBjZXJ0YWluIGNhc2VzLCB3aGVuCiAgICAv
			LyB0cnlpbmcgdG8gYWNjZXNzIGFjdGl2ZUVsZW1lbnQgYmVmb3JlIG9ubG9hZAogICAgdmFyIGhh
			c0ZvY3VzOyB0cnkgeyBoYXNGb2N1cyA9ICh0YXJnZXREb2N1bWVudC5hY3RpdmVFbGVtZW50ID09
			IGlucHV0KTsgfSBjYXRjaChlKSB7IH0KICAgIGlmIChoYXNGb2N1cykgc2V0VGltZW91dChvbkZv
			Y3VzLCAyMCk7CiAgICBlbHNlIG9uQmx1cigpOwoKICAgIGZ1bmN0aW9uIGlzTGluZShsKSB7cmV0
			dXJuIGwgPj0gMCAmJiBsIDwgZG9jLnNpemU7fQogICAgLy8gVGhlIGluc3RhbmNlIG9iamVjdCB0
			aGF0IHdlJ2xsIHJldHVybi4gTW9zdGx5IGNhbGxzIG91dCB0bwogICAgLy8gbG9jYWwgZnVuY3Rp
			b25zIGluIHRoZSBDb2RlTWlycm9yIGZ1bmN0aW9uLiBTb21lIGRvIHNvbWUgZXh0cmEKICAgIC8v
			IHJhbmdlIGNoZWNraW5nIGFuZC9vciBjbGlwcGluZy4gb3BlcmF0aW9uIGlzIHVzZWQgdG8gd3Jh
			cCB0aGUKICAgIC8vIGNhbGwgc28gdGhhdCBjaGFuZ2VzIGl0IG1ha2VzIGFyZSB0cmFja2VkLCBh
			bmQgdGhlIGRpc3BsYXkgaXMKICAgIC8vIHVwZGF0ZWQgYWZ0ZXJ3YXJkcy4KICAgIHZhciBpbnN0
			YW5jZSA9IHdyYXBwZXIuQ29kZU1pcnJvciA9IHsKICAgICAgZ2V0VmFsdWU6IGdldFZhbHVlLAog
			ICAgICBzZXRWYWx1ZTogb3BlcmF0aW9uKHNldFZhbHVlKSwKICAgICAgZ2V0U2VsZWN0aW9uOiBn
			ZXRTZWxlY3Rpb24sCiAgICAgIHJlcGxhY2VTZWxlY3Rpb246IG9wZXJhdGlvbihyZXBsYWNlU2Vs
			ZWN0aW9uKSwKICAgICAgZm9jdXM6IGZ1bmN0aW9uKCl7d2luZG93LmZvY3VzKCk7IGZvY3VzSW5w
			dXQoKTsgb25Gb2N1cygpOyBmYXN0UG9sbCgpO30sCiAgICAgIHNldE9wdGlvbjogZnVuY3Rpb24o
			b3B0aW9uLCB2YWx1ZSkgewogICAgICAgIHZhciBvbGRWYWwgPSBvcHRpb25zW29wdGlvbl07CiAg
			ICAgICAgb3B0aW9uc1tvcHRpb25dID0gdmFsdWU7CiAgICAgICAgaWYgKG9wdGlvbiA9PSAibW9k
			ZSIgfHwgb3B0aW9uID09ICJpbmRlbnRVbml0IikgbG9hZE1vZGUoKTsKICAgICAgICBlbHNlIGlm
			IChvcHRpb24gPT0gInJlYWRPbmx5IiAmJiB2YWx1ZSA9PSAibm9jdXJzb3IiKSB7b25CbHVyKCk7
			IGlucHV0LmJsdXIoKTt9CiAgICAgICAgZWxzZSBpZiAob3B0aW9uID09ICJyZWFkT25seSIgJiYg
			IXZhbHVlKSB7cmVzZXRJbnB1dCh0cnVlKTt9CiAgICAgICAgZWxzZSBpZiAob3B0aW9uID09ICJ0
			aGVtZSIpIHRoZW1lQ2hhbmdlZCgpOwogICAgICAgIGVsc2UgaWYgKG9wdGlvbiA9PSAibGluZVdy
			YXBwaW5nIiAmJiBvbGRWYWwgIT0gdmFsdWUpIG9wZXJhdGlvbih3cmFwcGluZ0NoYW5nZWQpKCk7
			CiAgICAgICAgZWxzZSBpZiAob3B0aW9uID09ICJ0YWJTaXplIikgdXBkYXRlRGlzcGxheSh0cnVl
			KTsKICAgICAgICBpZiAob3B0aW9uID09ICJsaW5lTnVtYmVycyIgfHwgb3B0aW9uID09ICJndXR0
			ZXIiIHx8IG9wdGlvbiA9PSAiZmlyc3RMaW5lTnVtYmVyIiB8fCBvcHRpb24gPT0gInRoZW1lIikg
			ewogICAgICAgICAgZ3V0dGVyQ2hhbmdlZCgpOwogICAgICAgICAgdXBkYXRlRGlzcGxheSh0cnVl
			KTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgIGdldE9wdGlvbjogZnVuY3Rpb24ob3B0aW9uKSB7
			cmV0dXJuIG9wdGlvbnNbb3B0aW9uXTt9LAogICAgICB1bmRvOiBvcGVyYXRpb24odW5kbyksCiAg
			ICAgIHJlZG86IG9wZXJhdGlvbihyZWRvKSwKICAgICAgaW5kZW50TGluZTogb3BlcmF0aW9uKGZ1
			bmN0aW9uKG4sIGRpcikgewogICAgICAgIGlmICh0eXBlb2YgZGlyICE9ICJzdHJpbmciKSB7CiAg
			ICAgICAgICBpZiAoZGlyID09IG51bGwpIGRpciA9IG9wdGlvbnMuc21hcnRJbmRlbnQgPyAic21h
			cnQiIDogInByZXYiOwogICAgICAgICAgZWxzZSBkaXIgPSBkaXIgPyAiYWRkIiA6ICJzdWJ0cmFj
			dCI7CiAgICAgICAgfQogICAgICAgIGlmIChpc0xpbmUobikpIGluZGVudExpbmUobiwgZGlyKTsK
			ICAgICAgfSksCiAgICAgIGluZGVudFNlbGVjdGlvbjogb3BlcmF0aW9uKGluZGVudFNlbGVjdGVk
			KSwKICAgICAgaGlzdG9yeVNpemU6IGZ1bmN0aW9uKCkge3JldHVybiB7dW5kbzogaGlzdG9yeS5k
			b25lLmxlbmd0aCwgcmVkbzogaGlzdG9yeS51bmRvbmUubGVuZ3RofTt9LAogICAgICBjbGVhckhp
			c3Rvcnk6IGZ1bmN0aW9uKCkge2hpc3RvcnkgPSBuZXcgSGlzdG9yeSgpO30sCiAgICAgIG1hdGNo
			QnJhY2tldHM6IG9wZXJhdGlvbihmdW5jdGlvbigpe21hdGNoQnJhY2tldHModHJ1ZSk7fSksCiAg
			ICAgIGdldFRva2VuQXQ6IG9wZXJhdGlvbihmdW5jdGlvbihwb3MpIHsKICAgICAgICBwb3MgPSBj
			bGlwUG9zKHBvcyk7CiAgICAgICAgcmV0dXJuIGdldExpbmUocG9zLmxpbmUpLmdldFRva2VuQXQo
			bW9kZSwgZ2V0U3RhdGVCZWZvcmUocG9zLmxpbmUpLCBwb3MuY2gpOwogICAgICB9KSwKICAgICAg
			Z2V0U3RhdGVBZnRlcjogZnVuY3Rpb24obGluZSkgewogICAgICAgIGxpbmUgPSBjbGlwTGluZShs
			aW5lID09IG51bGwgPyBkb2Muc2l6ZSAtIDE6IGxpbmUpOwogICAgICAgIHJldHVybiBnZXRTdGF0
			ZUJlZm9yZShsaW5lICsgMSk7CiAgICAgIH0sCiAgICAgIGN1cnNvckNvb3JkczogZnVuY3Rpb24o
			c3RhcnQpewogICAgICAgIGlmIChzdGFydCA9PSBudWxsKSBzdGFydCA9IHNlbC5pbnZlcnRlZDsK
			ICAgICAgICByZXR1cm4gcGFnZUNvb3JkcyhzdGFydCA/IHNlbC5mcm9tIDogc2VsLnRvKTsKICAg
			ICAgfSwKICAgICAgY2hhckNvb3JkczogZnVuY3Rpb24ocG9zKXtyZXR1cm4gcGFnZUNvb3Jkcyhj
			bGlwUG9zKHBvcykpO30sCiAgICAgIGNvb3Jkc0NoYXI6IGZ1bmN0aW9uKGNvb3JkcykgewogICAg
			ICAgIHZhciBvZmYgPSBlbHRPZmZzZXQobGluZVNwYWNlKTsKICAgICAgICByZXR1cm4gY29vcmRz
			Q2hhcihjb29yZHMueCAtIG9mZi5sZWZ0LCBjb29yZHMueSAtIG9mZi50b3ApOwogICAgICB9LAog
			ICAgICBtYXJrVGV4dDogb3BlcmF0aW9uKG1hcmtUZXh0KSwKICAgICAgc2V0Qm9va21hcms6IHNl
			dEJvb2ttYXJrLAogICAgICBzZXRNYXJrZXI6IG9wZXJhdGlvbihhZGRHdXR0ZXJNYXJrZXIpLAog
			ICAgICBjbGVhck1hcmtlcjogb3BlcmF0aW9uKHJlbW92ZUd1dHRlck1hcmtlciksCiAgICAgIHNl
			dExpbmVDbGFzczogb3BlcmF0aW9uKHNldExpbmVDbGFzcyksCiAgICAgIGhpZGVMaW5lOiBvcGVy
			YXRpb24oZnVuY3Rpb24oaCkge3JldHVybiBzZXRMaW5lSGlkZGVuKGgsIHRydWUpO30pLAogICAg
			ICBzaG93TGluZTogb3BlcmF0aW9uKGZ1bmN0aW9uKGgpIHtyZXR1cm4gc2V0TGluZUhpZGRlbiho
			LCBmYWxzZSk7fSksCiAgICAgIG9uRGVsZXRlTGluZTogZnVuY3Rpb24obGluZSwgZikgewogICAg
			ICAgIGlmICh0eXBlb2YgbGluZSA9PSAibnVtYmVyIikgewogICAgICAgICAgaWYgKCFpc0xpbmUo
			bGluZSkpIHJldHVybiBudWxsOwogICAgICAgICAgbGluZSA9IGdldExpbmUobGluZSk7CiAgICAg
			ICAgfQogICAgICAgIChsaW5lLmhhbmRsZXJzIHx8IChsaW5lLmhhbmRsZXJzID0gW10pKS5wdXNo
			KGYpOwogICAgICAgIHJldHVybiBsaW5lOwogICAgICB9LAogICAgICBsaW5lSW5mbzogbGluZUlu
			Zm8sCiAgICAgIGFkZFdpZGdldDogZnVuY3Rpb24ocG9zLCBub2RlLCBzY3JvbGwsIHZlcnQsIGhv
			cml6KSB7CiAgICAgICAgcG9zID0gbG9jYWxDb29yZHMoY2xpcFBvcyhwb3MpKTsKICAgICAgICB2
			YXIgdG9wID0gcG9zLnlCb3QsIGxlZnQgPSBwb3MueDsKICAgICAgICBub2RlLnN0eWxlLnBvc2l0
			aW9uID0gImFic29sdXRlIjsKICAgICAgICBjb2RlLmFwcGVuZENoaWxkKG5vZGUpOwogICAgICAg
			IGlmICh2ZXJ0ID09ICJvdmVyIikgdG9wID0gcG9zLnk7CiAgICAgICAgZWxzZSBpZiAodmVydCA9
			PSAibmVhciIpIHsKICAgICAgICAgIHZhciB2c3BhY2UgPSBNYXRoLm1heChzY3JvbGxlci5vZmZz
			ZXRIZWlnaHQsIGRvYy5oZWlnaHQgKiB0ZXh0SGVpZ2h0KCkpLAogICAgICAgICAgICAgIGhzcGFj
			ZSA9IE1hdGgubWF4KGNvZGUuY2xpZW50V2lkdGgsIGxpbmVTcGFjZS5jbGllbnRXaWR0aCkgLSBw
			YWRkaW5nTGVmdCgpOwogICAgICAgICAgaWYgKHBvcy55Qm90ICsgbm9kZS5vZmZzZXRIZWlnaHQg
			PiB2c3BhY2UgJiYgcG9zLnkgPiBub2RlLm9mZnNldEhlaWdodCkKICAgICAgICAgICAgdG9wID0g
			cG9zLnkgLSBub2RlLm9mZnNldEhlaWdodDsKICAgICAgICAgIGlmIChsZWZ0ICsgbm9kZS5vZmZz
			ZXRXaWR0aCA+IGhzcGFjZSkKICAgICAgICAgICAgbGVmdCA9IGhzcGFjZSAtIG5vZGUub2Zmc2V0
			V2lkdGg7CiAgICAgICAgfQogICAgICAgIG5vZGUuc3R5bGUudG9wID0gKHRvcCArIHBhZGRpbmdU
			b3AoKSkgKyAicHgiOwogICAgICAgIG5vZGUuc3R5bGUubGVmdCA9IG5vZGUuc3R5bGUucmlnaHQg
			PSAiIjsKICAgICAgICBpZiAoaG9yaXogPT0gInJpZ2h0IikgewogICAgICAgICAgbGVmdCA9IGNv
			ZGUuY2xpZW50V2lkdGggLSBub2RlLm9mZnNldFdpZHRoOwogICAgICAgICAgbm9kZS5zdHlsZS5y
			aWdodCA9ICIwcHgiOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBpZiAoaG9yaXogPT0gImxl
			ZnQiKSBsZWZ0ID0gMDsKICAgICAgICAgIGVsc2UgaWYgKGhvcml6ID09ICJtaWRkbGUiKSBsZWZ0
			ID0gKGNvZGUuY2xpZW50V2lkdGggLSBub2RlLm9mZnNldFdpZHRoKSAvIDI7CiAgICAgICAgICBu
			b2RlLnN0eWxlLmxlZnQgPSAobGVmdCArIHBhZGRpbmdMZWZ0KCkpICsgInB4IjsKICAgICAgICB9
			CiAgICAgICAgaWYgKHNjcm9sbCkKICAgICAgICAgIHNjcm9sbEludG9WaWV3KGxlZnQsIHRvcCwg
			bGVmdCArIG5vZGUub2Zmc2V0V2lkdGgsIHRvcCArIG5vZGUub2Zmc2V0SGVpZ2h0KTsKICAgICAg
			fSwKCiAgICAgIGxpbmVDb3VudDogZnVuY3Rpb24oKSB7cmV0dXJuIGRvYy5zaXplO30sCiAgICAg
			IGNsaXBQb3M6IGNsaXBQb3MsCiAgICAgIGdldEN1cnNvcjogZnVuY3Rpb24oc3RhcnQpIHsKICAg
			ICAgICBpZiAoc3RhcnQgPT0gbnVsbCkgc3RhcnQgPSBzZWwuaW52ZXJ0ZWQ7CiAgICAgICAgcmV0
			dXJuIGNvcHlQb3Moc3RhcnQgPyBzZWwuZnJvbSA6IHNlbC50byk7CiAgICAgIH0sCiAgICAgIHNv
			bWV0aGluZ1NlbGVjdGVkOiBmdW5jdGlvbigpIHtyZXR1cm4gIXBvc0VxKHNlbC5mcm9tLCBzZWwu
			dG8pO30sCiAgICAgIHNldEN1cnNvcjogb3BlcmF0aW9uKGZ1bmN0aW9uKGxpbmUsIGNoLCB1c2Vy
			KSB7CiAgICAgICAgaWYgKGNoID09IG51bGwgJiYgdHlwZW9mIGxpbmUubGluZSA9PSAibnVtYmVy
			Iikgc2V0Q3Vyc29yKGxpbmUubGluZSwgbGluZS5jaCwgdXNlcik7CiAgICAgICAgZWxzZSBzZXRD
			dXJzb3IobGluZSwgY2gsIHVzZXIpOwogICAgICB9KSwKICAgICAgc2V0U2VsZWN0aW9uOiBvcGVy
			YXRpb24oZnVuY3Rpb24oZnJvbSwgdG8sIHVzZXIpIHsKICAgICAgICAodXNlciA/IHNldFNlbGVj
			dGlvblVzZXIgOiBzZXRTZWxlY3Rpb24pKGNsaXBQb3MoZnJvbSksIGNsaXBQb3ModG8gfHwgZnJv
			bSkpOwogICAgICB9KSwKICAgICAgZ2V0TGluZTogZnVuY3Rpb24obGluZSkge2lmIChpc0xpbmUo
			bGluZSkpIHJldHVybiBnZXRMaW5lKGxpbmUpLnRleHQ7fSwKICAgICAgZ2V0TGluZUhhbmRsZTog
			ZnVuY3Rpb24obGluZSkge2lmIChpc0xpbmUobGluZSkpIHJldHVybiBnZXRMaW5lKGxpbmUpO30s
			CiAgICAgIHNldExpbmU6IG9wZXJhdGlvbihmdW5jdGlvbihsaW5lLCB0ZXh0KSB7CiAgICAgICAg
			aWYgKGlzTGluZShsaW5lKSkgcmVwbGFjZVJhbmdlKHRleHQsIHtsaW5lOiBsaW5lLCBjaDogMH0s
			IHtsaW5lOiBsaW5lLCBjaDogZ2V0TGluZShsaW5lKS50ZXh0Lmxlbmd0aH0pOwogICAgICB9KSwK
			ICAgICAgcmVtb3ZlTGluZTogb3BlcmF0aW9uKGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICBpZiAo
			aXNMaW5lKGxpbmUpKSByZXBsYWNlUmFuZ2UoIiIsIHtsaW5lOiBsaW5lLCBjaDogMH0sIGNsaXBQ
			b3Moe2xpbmU6IGxpbmUrMSwgY2g6IDB9KSk7CiAgICAgIH0pLAogICAgICByZXBsYWNlUmFuZ2U6
			IG9wZXJhdGlvbihyZXBsYWNlUmFuZ2UpLAogICAgICBnZXRSYW5nZTogZnVuY3Rpb24oZnJvbSwg
			dG8pIHtyZXR1cm4gZ2V0UmFuZ2UoY2xpcFBvcyhmcm9tKSwgY2xpcFBvcyh0bykpO30sCgogICAg
			ICBleGVjQ29tbWFuZDogZnVuY3Rpb24oY21kKSB7cmV0dXJuIGNvbW1hbmRzW2NtZF0oaW5zdGFu
			Y2UpO30sCiAgICAgIC8vIFN0dWZmIHVzZWQgYnkgY29tbWFuZHMsIHByb2JhYmx5IG5vdCBtdWNo
			IHVzZSB0byBvdXRzaWRlIGNvZGUuCiAgICAgIG1vdmVIOiBvcGVyYXRpb24obW92ZUgpLAogICAg
			ICBkZWxldGVIOiBvcGVyYXRpb24oZGVsZXRlSCksCiAgICAgIG1vdmVWOiBvcGVyYXRpb24obW92
			ZVYpLAogICAgICB0b2dnbGVPdmVyd3JpdGU6IGZ1bmN0aW9uKCkgewogICAgICAgIGlmKG92ZXJ3
			cml0ZSl7CiAgICAgICAgICBvdmVyd3JpdGUgPSBmYWxzZTsKICAgICAgICAgIGN1cnNvci5jbGFz
			c05hbWUgPSBjdXJzb3IuY2xhc3NOYW1lLnJlcGxhY2UoIiBDb2RlTWlycm9yLW92ZXJ3cml0ZSIs
			ICIiKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgb3ZlcndyaXRlID0gdHJ1ZTsKICAgICAg
			ICAgIGN1cnNvci5jbGFzc05hbWUgKz0gIiBDb2RlTWlycm9yLW92ZXJ3cml0ZSI7CiAgICAgICAg
			fQogICAgICB9LAoKICAgICAgcG9zRnJvbUluZGV4OiBmdW5jdGlvbihvZmYpIHsKICAgICAgICB2
			YXIgbGluZU5vID0gMCwgY2g7CiAgICAgICAgZG9jLml0ZXIoMCwgZG9jLnNpemUsIGZ1bmN0aW9u
			KGxpbmUpIHsKICAgICAgICAgIHZhciBzeiA9IGxpbmUudGV4dC5sZW5ndGggKyAxOwogICAgICAg
			ICAgaWYgKHN6ID4gb2ZmKSB7IGNoID0gb2ZmOyByZXR1cm4gdHJ1ZTsgfQogICAgICAgICAgb2Zm
			IC09IHN6OwogICAgICAgICAgKytsaW5lTm87CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJuIGNs
			aXBQb3Moe2xpbmU6IGxpbmVObywgY2g6IGNofSk7CiAgICAgIH0sCiAgICAgIGluZGV4RnJvbVBv
			czogZnVuY3Rpb24gKGNvb3JkcykgewogICAgICAgIGlmIChjb29yZHMubGluZSA8IDAgfHwgY29v
			cmRzLmNoIDwgMCkgcmV0dXJuIDA7CiAgICAgICAgdmFyIGluZGV4ID0gY29vcmRzLmNoOwogICAg
			ICAgIGRvYy5pdGVyKDAsIGNvb3Jkcy5saW5lLCBmdW5jdGlvbiAobGluZSkgewogICAgICAgICAg
			aW5kZXggKz0gbGluZS50ZXh0Lmxlbmd0aCArIDE7CiAgICAgICAgfSk7CiAgICAgICAgcmV0dXJu
			IGluZGV4OwogICAgICB9LAogICAgICBzY3JvbGxUbzogZnVuY3Rpb24oeCwgeSkgewogICAgICAg
			IGlmICh4ICE9IG51bGwpIHNjcm9sbGVyLnNjcm9sbExlZnQgPSB4OwogICAgICAgIGlmICh5ICE9
			IG51bGwpIHNjcm9sbGVyLnNjcm9sbFRvcCA9IHk7CiAgICAgICAgdXBkYXRlRGlzcGxheShbXSk7
			CiAgICAgIH0sCgogICAgICBvcGVyYXRpb246IGZ1bmN0aW9uKGYpe3JldHVybiBvcGVyYXRpb24o
			ZikoKTt9LAogICAgICByZWZyZXNoOiBmdW5jdGlvbigpewogICAgICAgIHVwZGF0ZURpc3BsYXko
			dHJ1ZSk7CiAgICAgICAgaWYgKHNjcm9sbGVyLnNjcm9sbEhlaWdodCA+IGxhc3RTY3JvbGxQb3Mp
			CiAgICAgICAgICBzY3JvbGxlci5zY3JvbGxUb3AgPSBsYXN0U2Nyb2xsUG9zOwogICAgICB9LAog
			ICAgICBnZXRJbnB1dEZpZWxkOiBmdW5jdGlvbigpe3JldHVybiBpbnB1dDt9LAogICAgICBnZXRX
			cmFwcGVyRWxlbWVudDogZnVuY3Rpb24oKXtyZXR1cm4gd3JhcHBlcjt9LAogICAgICBnZXRTY3Jv
			bGxlckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIHNjcm9sbGVyO30sCiAgICAgIGdldEd1dHRl
			ckVsZW1lbnQ6IGZ1bmN0aW9uKCl7cmV0dXJuIGd1dHRlcjt9CiAgICB9OwoKICAgIGZ1bmN0aW9u
			IGdldExpbmUobikgeyByZXR1cm4gZ2V0TGluZUF0KGRvYywgbik7IH0KICAgIGZ1bmN0aW9uIHVw
			ZGF0ZUxpbmVIZWlnaHQobGluZSwgaGVpZ2h0KSB7CiAgICAgIGd1dHRlckRpcnR5ID0gdHJ1ZTsK
			ICAgICAgdmFyIGRpZmYgPSBoZWlnaHQgLSBsaW5lLmhlaWdodDsKICAgICAgZm9yICh2YXIgbiA9
			IGxpbmU7IG47IG4gPSBuLnBhcmVudCkgbi5oZWlnaHQgKz0gZGlmZjsKICAgIH0KCiAgICBmdW5j
			dGlvbiBzZXRWYWx1ZShjb2RlKSB7CiAgICAgIHZhciB0b3AgPSB7bGluZTogMCwgY2g6IDB9Owog
			ICAgICB1cGRhdGVMaW5lcyh0b3AsIHtsaW5lOiBkb2Muc2l6ZSAtIDEsIGNoOiBnZXRMaW5lKGRv
			Yy5zaXplLTEpLnRleHQubGVuZ3RofSwKICAgICAgICAgICAgICAgICAgc3BsaXRMaW5lcyhjb2Rl
			KSwgdG9wLCB0b3ApOwogICAgICB1cGRhdGVJbnB1dCA9IHRydWU7CiAgICB9CiAgICBmdW5jdGlv
			biBnZXRWYWx1ZShjb2RlKSB7CiAgICAgIHZhciB0ZXh0ID0gW107CiAgICAgIGRvYy5pdGVyKDAs
			IGRvYy5zaXplLCBmdW5jdGlvbihsaW5lKSB7IHRleHQucHVzaChsaW5lLnRleHQpOyB9KTsKICAg
			ICAgcmV0dXJuIHRleHQuam9pbigiXG4iKTsKICAgIH0KCiAgICBmdW5jdGlvbiBvbk1vdXNlRG93
			bihlKSB7CiAgICAgIHNldFNoaWZ0KGVfcHJvcChlLCAic2hpZnRLZXkiKSk7CiAgICAgIC8vIENo
			ZWNrIHdoZXRoZXIgdGhpcyBpcyBhIGNsaWNrIGluIGEgd2lkZ2V0CiAgICAgIGZvciAodmFyIG4g
			PSBlX3RhcmdldChlKTsgbiAhPSB3cmFwcGVyOyBuID0gbi5wYXJlbnROb2RlKQogICAgICAgIGlm
			IChuLnBhcmVudE5vZGUgPT0gY29kZSAmJiBuICE9IG1vdmVyKSByZXR1cm47CgogICAgICAvLyBT
			ZWUgaWYgdGhpcyBpcyBhIGNsaWNrIGluIHRoZSBndXR0ZXIKICAgICAgZm9yICh2YXIgbiA9IGVf
			dGFyZ2V0KGUpOyBuICE9IHdyYXBwZXI7IG4gPSBuLnBhcmVudE5vZGUpCiAgICAgICAgaWYgKG4u
			cGFyZW50Tm9kZSA9PSBndXR0ZXJUZXh0KSB7CiAgICAgICAgICBpZiAob3B0aW9ucy5vbkd1dHRl
			ckNsaWNrKQogICAgICAgICAgICBvcHRpb25zLm9uR3V0dGVyQ2xpY2soaW5zdGFuY2UsIGluZGV4
			T2YoZ3V0dGVyVGV4dC5jaGlsZE5vZGVzLCBuKSArIHNob3dpbmdGcm9tLCBlKTsKICAgICAgICAg
			IHJldHVybiBlX3ByZXZlbnREZWZhdWx0KGUpOwogICAgICAgIH0KCiAgICAgIHZhciBzdGFydCA9
			IHBvc0Zyb21Nb3VzZShlKTsKCiAgICAgIHN3aXRjaCAoZV9idXR0b24oZSkpIHsKICAgICAgY2Fz
			ZSAzOgogICAgICAgIGlmIChnZWNrbyAmJiAhbWFjKSBvbkNvbnRleHRNZW51KGUpOwogICAgICAg
			IHJldHVybjsKICAgICAgY2FzZSAyOgogICAgICAgIGlmIChzdGFydCkgc2V0Q3Vyc29yKHN0YXJ0
			LmxpbmUsIHN0YXJ0LmNoLCB0cnVlKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgLy8g
			Rm9yIGJ1dHRvbiAxLCBpZiBpdCB3YXMgY2xpY2tlZCBpbnNpZGUgdGhlIGVkaXRvcgogICAgICAv
			LyAocG9zRnJvbU1vdXNlIHJldHVybmluZyBub24tbnVsbCksIHdlIGhhdmUgdG8gYWRqdXN0IHRo
			ZQogICAgICAvLyBzZWxlY3Rpb24uCiAgICAgIGlmICghc3RhcnQpIHtpZiAoZV90YXJnZXQoZSkg
			PT0gc2Nyb2xsZXIpIGVfcHJldmVudERlZmF1bHQoZSk7IHJldHVybjt9CgogICAgICBpZiAoIWZv
			Y3VzZWQpIG9uRm9jdXMoKTsKCiAgICAgIHZhciBub3cgPSArbmV3IERhdGU7CiAgICAgIGlmIChs
			YXN0RG91YmxlQ2xpY2sgJiYgbGFzdERvdWJsZUNsaWNrLnRpbWUgPiBub3cgLSA0MDAgJiYgcG9z
			RXEobGFzdERvdWJsZUNsaWNrLnBvcywgc3RhcnQpKSB7CiAgICAgICAgZV9wcmV2ZW50RGVmYXVs
			dChlKTsKICAgICAgICBzZXRUaW1lb3V0KGZvY3VzSW5wdXQsIDIwKTsKICAgICAgICByZXR1cm4g
			c2VsZWN0TGluZShzdGFydC5saW5lKTsKICAgICAgfSBlbHNlIGlmIChsYXN0Q2xpY2sgJiYgbGFz
			dENsaWNrLnRpbWUgPiBub3cgLSA0MDAgJiYgcG9zRXEobGFzdENsaWNrLnBvcywgc3RhcnQpKSB7
			CiAgICAgICAgbGFzdERvdWJsZUNsaWNrID0ge3RpbWU6IG5vdywgcG9zOiBzdGFydH07CiAgICAg
			ICAgZV9wcmV2ZW50RGVmYXVsdChlKTsKICAgICAgICByZXR1cm4gc2VsZWN0V29yZEF0KHN0YXJ0
			KTsKICAgICAgfSBlbHNlIHsgbGFzdENsaWNrID0ge3RpbWU6IG5vdywgcG9zOiBzdGFydH07IH0K
			CiAgICAgIHZhciBsYXN0ID0gc3RhcnQsIGdvaW5nOwogICAgICBpZiAoZHJhZ0FuZERyb3AgJiYg
			IW9wdGlvbnMucmVhZE9ubHkgJiYgIXBvc0VxKHNlbC5mcm9tLCBzZWwudG8pICYmCiAgICAgICAg
			ICAhcG9zTGVzcyhzdGFydCwgc2VsLmZyb20pICYmICFwb3NMZXNzKHNlbC50bywgc3RhcnQpKSB7
			CiAgICAgICAgLy8gTGV0IHRoZSBkcmFnIGhhbmRsZXIgaGFuZGxlIHRoaXMuCiAgICAgICAgaWYg
			KHdlYmtpdCkgbGluZVNwYWNlLmRyYWdnYWJsZSA9IHRydWU7CiAgICAgICAgdmFyIHVwID0gY29u
			bmVjdCh0YXJnZXREb2N1bWVudCwgIm1vdXNldXAiLCBvcGVyYXRpb24oZnVuY3Rpb24oZTIpIHsK
			ICAgICAgICAgIGlmICh3ZWJraXQpIGxpbmVTcGFjZS5kcmFnZ2FibGUgPSBmYWxzZTsKICAgICAg
			ICAgIGRyYWdnaW5nVGV4dCA9IGZhbHNlOwogICAgICAgICAgdXAoKTsKICAgICAgICAgIGlmIChN
			YXRoLmFicyhlLmNsaWVudFggLSBlMi5jbGllbnRYKSArIE1hdGguYWJzKGUuY2xpZW50WSAtIGUy
			LmNsaWVudFkpIDwgMTApIHsKICAgICAgICAgICAgZV9wcmV2ZW50RGVmYXVsdChlMik7CiAgICAg
			ICAgICAgIHNldEN1cnNvcihzdGFydC5saW5lLCBzdGFydC5jaCwgdHJ1ZSk7CiAgICAgICAgICAg
			IGZvY3VzSW5wdXQoKTsKICAgICAgICAgIH0KICAgICAgICB9KSwgdHJ1ZSk7CiAgICAgICAgZHJh
			Z2dpbmdUZXh0ID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgZV9wcmV2ZW50
			RGVmYXVsdChlKTsKICAgICAgc2V0Q3Vyc29yKHN0YXJ0LmxpbmUsIHN0YXJ0LmNoLCB0cnVlKTsK
			CiAgICAgIGZ1bmN0aW9uIGV4dGVuZChlKSB7CiAgICAgICAgdmFyIGN1ciA9IHBvc0Zyb21Nb3Vz
			ZShlLCB0cnVlKTsKICAgICAgICBpZiAoY3VyICYmICFwb3NFcShjdXIsIGxhc3QpKSB7CiAgICAg
			ICAgICBpZiAoIWZvY3VzZWQpIG9uRm9jdXMoKTsKICAgICAgICAgIGxhc3QgPSBjdXI7CiAgICAg
			ICAgICBzZXRTZWxlY3Rpb25Vc2VyKHN0YXJ0LCBjdXIpOwogICAgICAgICAgdXBkYXRlSW5wdXQg
			PSBmYWxzZTsKICAgICAgICAgIHZhciB2aXNpYmxlID0gdmlzaWJsZUxpbmVzKCk7CiAgICAgICAg
			ICBpZiAoY3VyLmxpbmUgPj0gdmlzaWJsZS50byB8fCBjdXIubGluZSA8IHZpc2libGUuZnJvbSkK
			ICAgICAgICAgICAgZ29pbmcgPSBzZXRUaW1lb3V0KG9wZXJhdGlvbihmdW5jdGlvbigpe2V4dGVu
			ZChlKTt9KSwgMTUwKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHZhciBtb3ZlID0gY29ubmVj
			dCh0YXJnZXREb2N1bWVudCwgIm1vdXNlbW92ZSIsIG9wZXJhdGlvbihmdW5jdGlvbihlKSB7CiAg
			ICAgICAgY2xlYXJUaW1lb3V0KGdvaW5nKTsKICAgICAgICBlX3ByZXZlbnREZWZhdWx0KGUpOwog
			ICAgICAgIGV4dGVuZChlKTsKICAgICAgfSksIHRydWUpOwogICAgICB2YXIgdXAgPSBjb25uZWN0
			KHRhcmdldERvY3VtZW50LCAibW91c2V1cCIsIG9wZXJhdGlvbihmdW5jdGlvbihlKSB7CiAgICAg
			ICAgY2xlYXJUaW1lb3V0KGdvaW5nKTsKICAgICAgICB2YXIgY3VyID0gcG9zRnJvbU1vdXNlKGUp
			OwogICAgICAgIGlmIChjdXIpIHNldFNlbGVjdGlvblVzZXIoc3RhcnQsIGN1cik7CiAgICAgICAg
			ZV9wcmV2ZW50RGVmYXVsdChlKTsKICAgICAgICBmb2N1c0lucHV0KCk7CiAgICAgICAgdXBkYXRl
			SW5wdXQgPSB0cnVlOwogICAgICAgIG1vdmUoKTsgdXAoKTsKICAgICAgfSksIHRydWUpOwogICAg
			fQogICAgZnVuY3Rpb24gb25Eb3VibGVDbGljayhlKSB7CiAgICAgIGZvciAodmFyIG4gPSBlX3Rh
			cmdldChlKTsgbiAhPSB3cmFwcGVyOyBuID0gbi5wYXJlbnROb2RlKQogICAgICAgIGlmIChuLnBh
			cmVudE5vZGUgPT0gZ3V0dGVyVGV4dCkgcmV0dXJuIGVfcHJldmVudERlZmF1bHQoZSk7CiAgICAg
			IHZhciBzdGFydCA9IHBvc0Zyb21Nb3VzZShlKTsKICAgICAgaWYgKCFzdGFydCkgcmV0dXJuOwog
			ICAgICBsYXN0RG91YmxlQ2xpY2sgPSB7dGltZTogK25ldyBEYXRlLCBwb3M6IHN0YXJ0fTsKICAg
			ICAgZV9wcmV2ZW50RGVmYXVsdChlKTsKICAgICAgc2VsZWN0V29yZEF0KHN0YXJ0KTsKICAgIH0K
			ICAgIGZ1bmN0aW9uIG9uRHJvcChlKSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAg
			dmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShlLCB0cnVlKSwgZmlsZXMgPSBlLmRhdGFUcmFuc2Zlci5m
			aWxlczsKICAgICAgaWYgKCFwb3MgfHwgb3B0aW9ucy5yZWFkT25seSkgcmV0dXJuOwogICAgICBp
			ZiAoZmlsZXMgJiYgZmlsZXMubGVuZ3RoICYmIHdpbmRvdy5GaWxlUmVhZGVyICYmIHdpbmRvdy5G
			aWxlKSB7CiAgICAgICAgZnVuY3Rpb24gbG9hZEZpbGUoZmlsZSwgaSkgewogICAgICAgICAgdmFy
			IHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyOwogICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0
			aW9uKCkgewogICAgICAgICAgICB0ZXh0W2ldID0gcmVhZGVyLnJlc3VsdDsKICAgICAgICAgICAg
			aWYgKCsrcmVhZCA9PSBuKSB7CgkgICAgICBwb3MgPSBjbGlwUG9zKHBvcyk7CgkgICAgICBvcGVy
			YXRpb24oZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICB2YXIgZW5kID0gcmVwbGFjZVJhbmdl
			KHRleHQuam9pbigiIiksIHBvcywgcG9zKTsKICAgICAgICAgICAgICAgIHNldFNlbGVjdGlvblVz
			ZXIocG9zLCBlbmQpOwogICAgICAgICAgICAgIH0pKCk7CgkgICAgfQogICAgICAgICAgfTsKICAg
			ICAgICAgIHJlYWRlci5yZWFkQXNUZXh0KGZpbGUpOwogICAgICAgIH0KICAgICAgICB2YXIgbiA9
			IGZpbGVzLmxlbmd0aCwgdGV4dCA9IEFycmF5KG4pLCByZWFkID0gMDsKICAgICAgICBmb3IgKHZh
			ciBpID0gMDsgaSA8IG47ICsraSkgbG9hZEZpbGUoZmlsZXNbaV0sIGkpOwogICAgICB9CiAgICAg
			IGVsc2UgewogICAgICAgIHRyeSB7CiAgICAgICAgICB2YXIgdGV4dCA9IGUuZGF0YVRyYW5zZmVy
			LmdldERhdGEoIlRleHQiKTsKICAgICAgICAgIGlmICh0ZXh0KSB7CiAgICAgICAgICAgIHZhciBj
			dXJGcm9tID0gc2VsLmZyb20sIGN1clRvID0gc2VsLnRvOwogICAgICAgICAgICBzZXRTZWxlY3Rp
			b25Vc2VyKHBvcywgcG9zKTsKICAgICAgICAgICAgaWYgKGRyYWdnaW5nVGV4dCkgcmVwbGFjZVJh
			bmdlKCIiLCBjdXJGcm9tLCBjdXJUbyk7CiAgICAgICAgICAgIHJlcGxhY2VTZWxlY3Rpb24odGV4
			dCk7CgkgICAgZm9jdXNJbnB1dCgpOwoJICB9CiAgICAgICAgfQogICAgICAgIGNhdGNoKGUpe30K
			ICAgICAgfQogICAgfQogICAgZnVuY3Rpb24gb25EcmFnU3RhcnQoZSkgewogICAgICB2YXIgdHh0
			ID0gZ2V0U2VsZWN0aW9uKCk7CiAgICAgIC8vIERpc2FibGVkIHVudGlsIGZ1cnRoZXIgbm90aWNl
			LiBEb2Vzbid0IHdvcmsgb24gbW9zdCBicm93c2VycywKICAgICAgLy8gYW5kIGNyYXNoZXMgU2Fm
			YXJpIChpc3N1ZSAjMzMyKS4KICAgICAgLy9odG1sRXNjYXBlKHR4dCk7CiAgICAgIC8vZS5kYXRh
			VHJhbnNmZXIuc2V0RHJhZ0ltYWdlKGVzY2FwZUVsZW1lbnQsIDAsIDApOwogICAgICBlLmRhdGFU
			cmFuc2Zlci5zZXREYXRhKCJUZXh0IiwgdHh0KTsKICAgIH0KCiAgICBmdW5jdGlvbiBkb0hhbmRs
			ZUJpbmRpbmcoYm91bmQsIGRyb3BTaGlmdCkgewogICAgICBpZiAodHlwZW9mIGJvdW5kID09ICJz
			dHJpbmciKSB7CiAgICAgICAgYm91bmQgPSBjb21tYW5kc1tib3VuZF07CiAgICAgICAgaWYgKCFi
			b3VuZCkgcmV0dXJuIGZhbHNlOwogICAgICB9CiAgICAgIHZhciBwcmV2U2hpZnQgPSBzaGlmdFNl
			bGVjdGluZzsKICAgICAgdHJ5IHsKICAgICAgICBpZiAob3B0aW9ucy5yZWFkT25seSkgc3VwcHJl
			c3NFZGl0cyA9IHRydWU7CiAgICAgICAgaWYgKGRyb3BTaGlmdCkgc2hpZnRTZWxlY3RpbmcgPSBu
			dWxsOwogICAgICAgIGJvdW5kKGluc3RhbmNlKTsKICAgICAgfSBjYXRjaChlKSB7CiAgICAgICAg
			aWYgKGUgIT0gUGFzcykgdGhyb3cgZTsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gZmlu
			YWxseSB7CiAgICAgICAgc2hpZnRTZWxlY3RpbmcgPSBwcmV2U2hpZnQ7CiAgICAgICAgc3VwcHJl
			c3NFZGl0cyA9IGZhbHNlOwogICAgICB9CiAgICAgIHJldHVybiB0cnVlOwogICAgfQogICAgZnVu
			Y3Rpb24gaGFuZGxlS2V5QmluZGluZyhlKSB7CiAgICAgIC8vIEhhbmRsZSBhdXRvIGtleW1hcCB0
			cmFuc2l0aW9ucwogICAgICB2YXIgc3RhcnRNYXAgPSBnZXRLZXlNYXAob3B0aW9ucy5rZXlNYXAp
			LCBuZXh0ID0gc3RhcnRNYXAuYXV0bzsKICAgICAgY2xlYXJUaW1lb3V0KG1heWJlVHJhbnNpdGlv
			bik7CiAgICAgIGlmIChuZXh0ICYmICFpc01vZGlmaWVyS2V5KGUpKSBtYXliZVRyYW5zaXRpb24g
			PSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewogICAgICAgIGlmIChnZXRLZXlNYXAob3B0aW9ucy5r
			ZXlNYXApID09IHN0YXJ0TWFwKSB7CiAgICAgICAgICBvcHRpb25zLmtleU1hcCA9IChuZXh0LmNh
			bGwgPyBuZXh0LmNhbGwobnVsbCwgaW5zdGFuY2UpIDogbmV4dCk7CiAgICAgICAgfQogICAgICB9
			LCA1MCk7CgogICAgICB2YXIgbmFtZSA9IGtleU5hbWVzW2VfcHJvcChlLCAia2V5Q29kZSIpXSwg
			aGFuZGxlZCA9IGZhbHNlOwogICAgICBpZiAobmFtZSA9PSBudWxsIHx8IGUuYWx0R3JhcGhLZXkp
			IHJldHVybiBmYWxzZTsKICAgICAgaWYgKGVfcHJvcChlLCAiYWx0S2V5IikpIG5hbWUgPSAiQWx0
			LSIgKyBuYW1lOwogICAgICBpZiAoZV9wcm9wKGUsICJjdHJsS2V5IikpIG5hbWUgPSAiQ3RybC0i
			ICsgbmFtZTsKICAgICAgaWYgKGVfcHJvcChlLCAibWV0YUtleSIpKSBuYW1lID0gIkNtZC0iICsg
			bmFtZTsKCiAgICAgIGlmIChlX3Byb3AoZSwgInNoaWZ0S2V5IikpCiAgICAgICAgaGFuZGxlZCA9
			IGxvb2t1cEtleSgiU2hpZnQtIiArIG5hbWUsIG9wdGlvbnMuZXh0cmFLZXlzLCBvcHRpb25zLmtl
			eU1hcCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGIpIHtyZXR1cm4gZG9I
			YW5kbGVCaW5kaW5nKGIsIHRydWUpO30pOwogICAgICBpZiAoIWhhbmRsZWQpCiAgICAgICAgaGFu
			ZGxlZCA9IGxvb2t1cEtleShuYW1lLCBvcHRpb25zLmV4dHJhS2V5cywgb3B0aW9ucy5rZXlNYXAs
			IGRvSGFuZGxlQmluZGluZyk7CgogICAgICBpZiAoaGFuZGxlZCkgZV9wcmV2ZW50RGVmYXVsdChl
			KTsKICAgICAgcmV0dXJuIGhhbmRsZWQ7CiAgICB9CiAgICBmdW5jdGlvbiBoYW5kbGVDaGFyQmlu
			ZGluZyhlLCBjaCkgewogICAgICB2YXIgaGFuZGxlZCA9IGxvb2t1cEtleSgiJyIgKyBjaCArICIn
			Iiwgb3B0aW9ucy5leHRyYUtleXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlv
			bnMua2V5TWFwLCBkb0hhbmRsZUJpbmRpbmcpOwogICAgICBpZiAoaGFuZGxlZCkgZV9wcmV2ZW50
			RGVmYXVsdChlKTsKICAgICAgcmV0dXJuIGhhbmRsZWQ7CiAgICB9CgogICAgdmFyIGxhc3RTdG9w
			cGVkS2V5ID0gbnVsbCwgbWF5YmVUcmFuc2l0aW9uOwogICAgZnVuY3Rpb24gb25LZXlEb3duKGUp
			IHsKICAgICAgaWYgKCFmb2N1c2VkKSBvbkZvY3VzKCk7CiAgICAgIGlmIChpZSAmJiBlLmtleUNv
			ZGUgPT0gMjcpIHsgZS5yZXR1cm5WYWx1ZSA9IGZhbHNlOyB9CiAgICAgIGlmIChwb2xsaW5nRmFz
			dCkgeyBpZiAocmVhZElucHV0KCkpIHBvbGxpbmdGYXN0ID0gZmFsc2U7IH0KICAgICAgaWYgKG9w
			dGlvbnMub25LZXlFdmVudCAmJiBvcHRpb25zLm9uS2V5RXZlbnQoaW5zdGFuY2UsIGFkZFN0b3Ao
			ZSkpKSByZXR1cm47CiAgICAgIHZhciBjb2RlID0gZV9wcm9wKGUsICJrZXlDb2RlIik7CiAgICAg
			IC8vIElFIGRvZXMgc3RyYW5nZSB0aGluZ3Mgd2l0aCBlc2NhcGUuCiAgICAgIHNldFNoaWZ0KGNv
			ZGUgPT0gMTYgfHwgZV9wcm9wKGUsICJzaGlmdEtleSIpKTsKICAgICAgLy8gRmlyc3QgZ2l2ZSBv
			bktleUV2ZW50IG9wdGlvbiBhIGNoYW5jZSB0byBoYW5kbGUgdGhpcy4KICAgICAgdmFyIGhhbmRs
			ZWQgPSBoYW5kbGVLZXlCaW5kaW5nKGUpOwogICAgICBpZiAod2luZG93Lm9wZXJhKSB7CiAgICAg
			ICAgbGFzdFN0b3BwZWRLZXkgPSBoYW5kbGVkID8gY29kZSA6IG51bGw7CiAgICAgICAgLy8gT3Bl
			cmEgaGFzIG5vIGN1dCBldmVudC4uLiB3ZSB0cnkgdG8gYXQgbGVhc3QgY2F0Y2ggdGhlIGtleSBj
			b21ibwogICAgICAgIGlmICghaGFuZGxlZCAmJiBjb2RlID09IDg4ICYmIGVfcHJvcChlLCBtYWMg
			PyAibWV0YUtleSIgOiAiY3RybEtleSIpKQogICAgICAgICAgcmVwbGFjZVNlbGVjdGlvbigiIik7
			CiAgICAgIH0KICAgIH0KICAgIGZ1bmN0aW9uIG9uS2V5UHJlc3MoZSkgewogICAgICBpZiAocG9s
			bGluZ0Zhc3QpIHJlYWRJbnB1dCgpOwogICAgICBpZiAob3B0aW9ucy5vbktleUV2ZW50ICYmIG9w
			dGlvbnMub25LZXlFdmVudChpbnN0YW5jZSwgYWRkU3RvcChlKSkpIHJldHVybjsKICAgICAgdmFy
			IGtleUNvZGUgPSBlX3Byb3AoZSwgImtleUNvZGUiKSwgY2hhckNvZGUgPSBlX3Byb3AoZSwgImNo
			YXJDb2RlIik7CiAgICAgIGlmICh3aW5kb3cub3BlcmEgJiYga2V5Q29kZSA9PSBsYXN0U3RvcHBl
			ZEtleSkge2xhc3RTdG9wcGVkS2V5ID0gbnVsbDsgZV9wcmV2ZW50RGVmYXVsdChlKTsgcmV0dXJu
			O30KICAgICAgaWYgKHdpbmRvdy5vcGVyYSAmJiAhZS53aGljaCAmJiBoYW5kbGVLZXlCaW5kaW5n
			KGUpKSByZXR1cm47CiAgICAgIHZhciBjaCA9IFN0cmluZy5mcm9tQ2hhckNvZGUoY2hhckNvZGUg
			PT0gbnVsbCA/IGtleUNvZGUgOiBjaGFyQ29kZSk7CiAgICAgIGlmIChvcHRpb25zLmVsZWN0cmlj
			Q2hhcnMgJiYgbW9kZS5lbGVjdHJpY0NoYXJzICYmIG9wdGlvbnMuc21hcnRJbmRlbnQgJiYgIW9w
			dGlvbnMucmVhZE9ubHkpIHsKICAgICAgICBpZiAobW9kZS5lbGVjdHJpY0NoYXJzLmluZGV4T2Yo
			Y2gpID4gLTEpCiAgICAgICAgICBzZXRUaW1lb3V0KG9wZXJhdGlvbihmdW5jdGlvbigpIHtpbmRl
			bnRMaW5lKHNlbC50by5saW5lLCAic21hcnQiKTt9KSwgNzUpOwogICAgICB9CiAgICAgIGlmICho
			YW5kbGVDaGFyQmluZGluZyhlLCBjaCkpIHJldHVybjsKICAgICAgZmFzdFBvbGwoKTsKICAgIH0K
			ICAgIGZ1bmN0aW9uIG9uS2V5VXAoZSkgewogICAgICBpZiAob3B0aW9ucy5vbktleUV2ZW50ICYm
			IG9wdGlvbnMub25LZXlFdmVudChpbnN0YW5jZSwgYWRkU3RvcChlKSkpIHJldHVybjsKICAgICAg
			aWYgKGVfcHJvcChlLCAia2V5Q29kZSIpID09IDE2KSBzaGlmdFNlbGVjdGluZyA9IG51bGw7CiAg
			ICB9CgogICAgZnVuY3Rpb24gb25Gb2N1cygpIHsKICAgICAgaWYgKG9wdGlvbnMucmVhZE9ubHkg
			PT0gIm5vY3Vyc29yIikgcmV0dXJuOwogICAgICBpZiAoIWZvY3VzZWQpIHsKICAgICAgICBpZiAo
			b3B0aW9ucy5vbkZvY3VzKSBvcHRpb25zLm9uRm9jdXMoaW5zdGFuY2UpOwogICAgICAgIGZvY3Vz
			ZWQgPSB0cnVlOwogICAgICAgIGlmICh3cmFwcGVyLmNsYXNzTmFtZS5zZWFyY2goL1xiQ29kZU1p
			cnJvci1mb2N1c2VkXGIvKSA9PSAtMSkKICAgICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lICs9ICIg
			Q29kZU1pcnJvci1mb2N1c2VkIjsKICAgICAgICBpZiAoIWxlYXZlSW5wdXRBbG9uZSkgcmVzZXRJ
			bnB1dCh0cnVlKTsKICAgICAgfQogICAgICBzbG93UG9sbCgpOwogICAgICByZXN0YXJ0Qmxpbmso
			KTsKICAgIH0KICAgIGZ1bmN0aW9uIG9uQmx1cigpIHsKICAgICAgaWYgKGZvY3VzZWQpIHsKICAg
			ICAgICBpZiAob3B0aW9ucy5vbkJsdXIpIG9wdGlvbnMub25CbHVyKGluc3RhbmNlKTsKICAgICAg
			ICBmb2N1c2VkID0gZmFsc2U7CiAgICAgICAgaWYgKGJyYWNrZXRIaWdobGlnaHRlZCkKICAgICAg
			ICAgIG9wZXJhdGlvbihmdW5jdGlvbigpewogICAgICAgICAgICBpZiAoYnJhY2tldEhpZ2hsaWdo
			dGVkKSB7IGJyYWNrZXRIaWdobGlnaHRlZCgpOyBicmFja2V0SGlnaGxpZ2h0ZWQgPSBudWxsOyB9
			CiAgICAgICAgICB9KSgpOwogICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gd3JhcHBlci5jbGFz
			c05hbWUucmVwbGFjZSgiIENvZGVNaXJyb3ItZm9jdXNlZCIsICIiKTsKICAgICAgfQogICAgICBj
			bGVhckludGVydmFsKGJsaW5rZXIpOwogICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge2lmICgh
			Zm9jdXNlZCkgc2hpZnRTZWxlY3RpbmcgPSBudWxsO30sIDE1MCk7CiAgICB9CgogICAgLy8gUmVw
			bGFjZSB0aGUgcmFuZ2UgZnJvbSBmcm9tIHRvIHRvIGJ5IHRoZSBzdHJpbmdzIGluIG5ld1RleHQu
			CiAgICAvLyBBZnRlcndhcmRzLCBzZXQgdGhlIHNlbGVjdGlvbiB0byBzZWxGcm9tLCBzZWxUby4K
			ICAgIGZ1bmN0aW9uIHVwZGF0ZUxpbmVzKGZyb20sIHRvLCBuZXdUZXh0LCBzZWxGcm9tLCBzZWxU
			bykgewogICAgICBpZiAoc3VwcHJlc3NFZGl0cykgcmV0dXJuOwogICAgICBpZiAoaGlzdG9yeSkg
			ewogICAgICAgIHZhciBvbGQgPSBbXTsKICAgICAgICBkb2MuaXRlcihmcm9tLmxpbmUsIHRvLmxp
			bmUgKyAxLCBmdW5jdGlvbihsaW5lKSB7IG9sZC5wdXNoKGxpbmUudGV4dCk7IH0pOwogICAgICAg
			IGhpc3RvcnkuYWRkQ2hhbmdlKGZyb20ubGluZSwgbmV3VGV4dC5sZW5ndGgsIG9sZCk7CiAgICAg
			ICAgd2hpbGUgKGhpc3RvcnkuZG9uZS5sZW5ndGggPiBvcHRpb25zLnVuZG9EZXB0aCkgaGlzdG9y
			eS5kb25lLnNoaWZ0KCk7CiAgICAgIH0KICAgICAgdXBkYXRlTGluZXNOb1VuZG8oZnJvbSwgdG8s
			IG5ld1RleHQsIHNlbEZyb20sIHNlbFRvKTsKICAgIH0KICAgIGZ1bmN0aW9uIHVucmVkb0hlbHBl
			cihmcm9tLCB0bykgewogICAgICBpZiAoIWZyb20ubGVuZ3RoKSByZXR1cm47CiAgICAgIHZhciBz
			ZXQgPSBmcm9tLnBvcCgpLCBvdXQgPSBbXTsKICAgICAgZm9yICh2YXIgaSA9IHNldC5sZW5ndGgg
			LSAxOyBpID49IDA7IGkgLT0gMSkgewogICAgICAgIHZhciBjaGFuZ2UgPSBzZXRbaV07CiAgICAg
			ICAgdmFyIHJlcGxhY2VkID0gW10sIGVuZCA9IGNoYW5nZS5zdGFydCArIGNoYW5nZS5hZGRlZDsK
			ICAgICAgICBkb2MuaXRlcihjaGFuZ2Uuc3RhcnQsIGVuZCwgZnVuY3Rpb24obGluZSkgeyByZXBs
			YWNlZC5wdXNoKGxpbmUudGV4dCk7IH0pOwogICAgICAgIG91dC5wdXNoKHtzdGFydDogY2hhbmdl
			LnN0YXJ0LCBhZGRlZDogY2hhbmdlLm9sZC5sZW5ndGgsIG9sZDogcmVwbGFjZWR9KTsKICAgICAg
			ICB2YXIgcG9zID0gY2xpcFBvcyh7bGluZTogY2hhbmdlLnN0YXJ0ICsgY2hhbmdlLm9sZC5sZW5n
			dGggLSAxLAogICAgICAgICAgICAgICAgICAgICAgICAgICBjaDogZWRpdEVuZChyZXBsYWNlZFty
			ZXBsYWNlZC5sZW5ndGgtMV0sIGNoYW5nZS5vbGRbY2hhbmdlLm9sZC5sZW5ndGgtMV0pfSk7CiAg
			ICAgICAgdXBkYXRlTGluZXNOb1VuZG8oe2xpbmU6IGNoYW5nZS5zdGFydCwgY2g6IDB9LCB7bGlu
			ZTogZW5kIC0gMSwgY2g6IGdldExpbmUoZW5kLTEpLnRleHQubGVuZ3RofSwgY2hhbmdlLm9sZCwg
			cG9zLCBwb3MpOwogICAgICB9CiAgICAgIHVwZGF0ZUlucHV0ID0gdHJ1ZTsKICAgICAgdG8ucHVz
			aChvdXQpOwogICAgfQogICAgZnVuY3Rpb24gdW5kbygpIHt1bnJlZG9IZWxwZXIoaGlzdG9yeS5k
			b25lLCBoaXN0b3J5LnVuZG9uZSk7fQogICAgZnVuY3Rpb24gcmVkbygpIHt1bnJlZG9IZWxwZXIo
			aGlzdG9yeS51bmRvbmUsIGhpc3RvcnkuZG9uZSk7fQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUxpbmVz
			Tm9VbmRvKGZyb20sIHRvLCBuZXdUZXh0LCBzZWxGcm9tLCBzZWxUbykgewogICAgICBpZiAoc3Vw
			cHJlc3NFZGl0cykgcmV0dXJuOwogICAgICB2YXIgcmVjb21wdXRlTWF4TGVuZ3RoID0gZmFsc2Us
			IG1heExpbmVMZW5ndGggPSBtYXhMaW5lLmxlbmd0aDsKICAgICAgaWYgKCFvcHRpb25zLmxpbmVX
			cmFwcGluZykKICAgICAgICBkb2MuaXRlcihmcm9tLmxpbmUsIHRvLmxpbmUsIGZ1bmN0aW9uKGxp
			bmUpIHsKICAgICAgICAgIGlmIChsaW5lLnRleHQubGVuZ3RoID09IG1heExpbmVMZW5ndGgpIHty
			ZWNvbXB1dGVNYXhMZW5ndGggPSB0cnVlOyByZXR1cm4gdHJ1ZTt9CiAgICAgICAgfSk7CiAgICAg
			IGlmIChmcm9tLmxpbmUgIT0gdG8ubGluZSB8fCBuZXdUZXh0Lmxlbmd0aCA+IDEpIGd1dHRlckRp
			cnR5ID0gdHJ1ZTsKCiAgICAgIHZhciBubGluZXMgPSB0by5saW5lIC0gZnJvbS5saW5lLCBmaXJz
			dExpbmUgPSBnZXRMaW5lKGZyb20ubGluZSksIGxhc3RMaW5lID0gZ2V0TGluZSh0by5saW5lKTsK
			ICAgICAgLy8gRmlyc3QgYWRqdXN0IHRoZSBsaW5lIHN0cnVjdHVyZSwgdGFraW5nIHNvbWUgY2Fy
			ZSB0byBsZWF2ZSBoaWdobGlnaHRpbmcgaW50YWN0LgogICAgICBpZiAoZnJvbS5jaCA9PSAwICYm
			IHRvLmNoID09IDAgJiYgbmV3VGV4dFtuZXdUZXh0Lmxlbmd0aCAtIDFdID09ICIiKSB7CiAgICAg
			ICAgLy8gVGhpcyBpcyBhIHdob2xlLWxpbmUgcmVwbGFjZS4gVHJlYXRlZCBzcGVjaWFsbHkgdG8g
			bWFrZQogICAgICAgIC8vIHN1cmUgbGluZSBvYmplY3RzIG1vdmUgdGhlIHdheSB0aGV5IGFyZSBz
			dXBwb3NlZCB0by4KICAgICAgICB2YXIgYWRkZWQgPSBbXSwgcHJldkxpbmUgPSBudWxsOwogICAg
			ICAgIGlmIChmcm9tLmxpbmUpIHsKICAgICAgICAgIHByZXZMaW5lID0gZ2V0TGluZShmcm9tLmxp
			bmUgLSAxKTsKICAgICAgICAgIHByZXZMaW5lLmZpeE1hcmtFbmRzKGxhc3RMaW5lKTsKICAgICAg
			ICB9IGVsc2UgbGFzdExpbmUuZml4TWFya1N0YXJ0cygpOwogICAgICAgIGZvciAodmFyIGkgPSAw
			LCBlID0gbmV3VGV4dC5sZW5ndGggLSAxOyBpIDwgZTsgKytpKQogICAgICAgICAgYWRkZWQucHVz
			aChMaW5lLmluaGVyaXRNYXJrcyhuZXdUZXh0W2ldLCBwcmV2TGluZSkpOwogICAgICAgIGlmIChu
			bGluZXMpIGRvYy5yZW1vdmUoZnJvbS5saW5lLCBubGluZXMsIGNhbGxiYWNrcyk7CiAgICAgICAg
			aWYgKGFkZGVkLmxlbmd0aCkgZG9jLmluc2VydChmcm9tLmxpbmUsIGFkZGVkKTsKICAgICAgfSBl
			bHNlIGlmIChmaXJzdExpbmUgPT0gbGFzdExpbmUpIHsKICAgICAgICBpZiAobmV3VGV4dC5sZW5n
			dGggPT0gMSkKICAgICAgICAgIGZpcnN0TGluZS5yZXBsYWNlKGZyb20uY2gsIHRvLmNoLCBuZXdU
			ZXh0WzBdKTsKICAgICAgICBlbHNlIHsKICAgICAgICAgIGxhc3RMaW5lID0gZmlyc3RMaW5lLnNw
			bGl0KHRvLmNoLCBuZXdUZXh0W25ld1RleHQubGVuZ3RoLTFdKTsKICAgICAgICAgIGZpcnN0TGlu
			ZS5yZXBsYWNlKGZyb20uY2gsIG51bGwsIG5ld1RleHRbMF0pOwogICAgICAgICAgZmlyc3RMaW5l
			LmZpeE1hcmtFbmRzKGxhc3RMaW5lKTsKICAgICAgICAgIHZhciBhZGRlZCA9IFtdOwogICAgICAg
			ICAgZm9yICh2YXIgaSA9IDEsIGUgPSBuZXdUZXh0Lmxlbmd0aCAtIDE7IGkgPCBlOyArK2kpCiAg
			ICAgICAgICAgIGFkZGVkLnB1c2goTGluZS5pbmhlcml0TWFya3MobmV3VGV4dFtpXSwgZmlyc3RM
			aW5lKSk7CiAgICAgICAgICBhZGRlZC5wdXNoKGxhc3RMaW5lKTsKICAgICAgICAgIGRvYy5pbnNl
			cnQoZnJvbS5saW5lICsgMSwgYWRkZWQpOwogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChuZXdU
			ZXh0Lmxlbmd0aCA9PSAxKSB7CiAgICAgICAgZmlyc3RMaW5lLnJlcGxhY2UoZnJvbS5jaCwgbnVs
			bCwgbmV3VGV4dFswXSk7CiAgICAgICAgbGFzdExpbmUucmVwbGFjZShudWxsLCB0by5jaCwgIiIp
			OwogICAgICAgIGZpcnN0TGluZS5hcHBlbmQobGFzdExpbmUpOwogICAgICAgIGRvYy5yZW1vdmUo
			ZnJvbS5saW5lICsgMSwgbmxpbmVzLCBjYWxsYmFja3MpOwogICAgICB9IGVsc2UgewogICAgICAg
			IHZhciBhZGRlZCA9IFtdOwogICAgICAgIGZpcnN0TGluZS5yZXBsYWNlKGZyb20uY2gsIG51bGws
			IG5ld1RleHRbMF0pOwogICAgICAgIGxhc3RMaW5lLnJlcGxhY2UobnVsbCwgdG8uY2gsIG5ld1Rl
			eHRbbmV3VGV4dC5sZW5ndGgtMV0pOwogICAgICAgIGZpcnN0TGluZS5maXhNYXJrRW5kcyhsYXN0
			TGluZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDEsIGUgPSBuZXdUZXh0Lmxlbmd0aCAtIDE7IGkg
			PCBlOyArK2kpCiAgICAgICAgICBhZGRlZC5wdXNoKExpbmUuaW5oZXJpdE1hcmtzKG5ld1RleHRb
			aV0sIGZpcnN0TGluZSkpOwogICAgICAgIGlmIChubGluZXMgPiAxKSBkb2MucmVtb3ZlKGZyb20u
			bGluZSArIDEsIG5saW5lcyAtIDEsIGNhbGxiYWNrcyk7CiAgICAgICAgZG9jLmluc2VydChmcm9t
			LmxpbmUgKyAxLCBhZGRlZCk7CiAgICAgIH0KICAgICAgaWYgKG9wdGlvbnMubGluZVdyYXBwaW5n
			KSB7CiAgICAgICAgdmFyIHBlckxpbmUgPSBzY3JvbGxlci5jbGllbnRXaWR0aCAvIGNoYXJXaWR0
			aCgpIC0gMzsKICAgICAgICBkb2MuaXRlcihmcm9tLmxpbmUsIGZyb20ubGluZSArIG5ld1RleHQu
			bGVuZ3RoLCBmdW5jdGlvbihsaW5lKSB7CiAgICAgICAgICBpZiAobGluZS5oaWRkZW4pIHJldHVy
			bjsKICAgICAgICAgIHZhciBndWVzcyA9IE1hdGguY2VpbChsaW5lLnRleHQubGVuZ3RoIC8gcGVy
			TGluZSkgfHwgMTsKICAgICAgICAgIGlmIChndWVzcyAhPSBsaW5lLmhlaWdodCkgdXBkYXRlTGlu
			ZUhlaWdodChsaW5lLCBndWVzcyk7CiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAg
			ZG9jLml0ZXIoZnJvbS5saW5lLCBpICsgbmV3VGV4dC5sZW5ndGgsIGZ1bmN0aW9uKGxpbmUpIHsK
			ICAgICAgICAgIHZhciBsID0gbGluZS50ZXh0OwogICAgICAgICAgaWYgKGwubGVuZ3RoID4gbWF4
			TGluZUxlbmd0aCkgewogICAgICAgICAgICBtYXhMaW5lID0gbDsgbWF4TGluZUxlbmd0aCA9IGwu
			bGVuZ3RoOyBtYXhXaWR0aCA9IG51bGw7CiAgICAgICAgICAgIHJlY29tcHV0ZU1heExlbmd0aCA9
			IGZhbHNlOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICAgIGlmIChyZWNvbXB1dGVNYXhM
			ZW5ndGgpIHsKICAgICAgICAgIG1heExpbmVMZW5ndGggPSAwOyBtYXhMaW5lID0gIiI7IG1heFdp
			ZHRoID0gbnVsbDsKICAgICAgICAgIGRvYy5pdGVyKDAsIGRvYy5zaXplLCBmdW5jdGlvbihsaW5l
			KSB7CiAgICAgICAgICAgIHZhciBsID0gbGluZS50ZXh0OwogICAgICAgICAgICBpZiAobC5sZW5n
			dGggPiBtYXhMaW5lTGVuZ3RoKSB7CiAgICAgICAgICAgICAgbWF4TGluZUxlbmd0aCA9IGwubGVu
			Z3RoOyBtYXhMaW5lID0gbDsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgICAgfQog
			ICAgICB9CgogICAgICAvLyBBZGQgdGhlc2UgbGluZXMgdG8gdGhlIHdvcmsgYXJyYXksIHNvIHRo
			YXQgdGhleSB3aWxsIGJlCiAgICAgIC8vIGhpZ2hsaWdodGVkLiBBZGp1c3Qgd29yayBsaW5lcyBp
			ZiBsaW5lcyB3ZXJlIGFkZGVkL3JlbW92ZWQuCiAgICAgIHZhciBuZXdXb3JrID0gW10sIGxlbmRp
			ZmYgPSBuZXdUZXh0Lmxlbmd0aCAtIG5saW5lcyAtIDE7CiAgICAgIGZvciAodmFyIGkgPSAwLCBs
			ID0gd29yay5sZW5ndGg7IGkgPCBsOyArK2kpIHsKICAgICAgICB2YXIgdGFzayA9IHdvcmtbaV07
			CiAgICAgICAgaWYgKHRhc2sgPCBmcm9tLmxpbmUpIG5ld1dvcmsucHVzaCh0YXNrKTsKICAgICAg
			ICBlbHNlIGlmICh0YXNrID4gdG8ubGluZSkgbmV3V29yay5wdXNoKHRhc2sgKyBsZW5kaWZmKTsK
			ICAgICAgfQogICAgICB2YXIgaGxFbmQgPSBmcm9tLmxpbmUgKyBNYXRoLm1pbihuZXdUZXh0Lmxl
			bmd0aCwgNTAwKTsKICAgICAgaGlnaGxpZ2h0TGluZXMoZnJvbS5saW5lLCBobEVuZCk7CiAgICAg
			IG5ld1dvcmsucHVzaChobEVuZCk7CiAgICAgIHdvcmsgPSBuZXdXb3JrOwogICAgICBzdGFydFdv
			cmtlcigxMDApOwogICAgICAvLyBSZW1lbWJlciB0aGF0IHRoZXNlIGxpbmVzIGNoYW5nZWQsIGZv
			ciB1cGRhdGluZyB0aGUgZGlzcGxheQogICAgICBjaGFuZ2VzLnB1c2goe2Zyb206IGZyb20ubGlu
			ZSwgdG86IHRvLmxpbmUgKyAxLCBkaWZmOiBsZW5kaWZmfSk7CiAgICAgIHZhciBjaGFuZ2VPYmog
			PSB7ZnJvbTogZnJvbSwgdG86IHRvLCB0ZXh0OiBuZXdUZXh0fTsKICAgICAgaWYgKHRleHRDaGFu
			Z2VkKSB7CiAgICAgICAgZm9yICh2YXIgY3VyID0gdGV4dENoYW5nZWQ7IGN1ci5uZXh0OyBjdXIg
			PSBjdXIubmV4dCkge30KICAgICAgICBjdXIubmV4dCA9IGNoYW5nZU9iajsKICAgICAgfSBlbHNl
			IHRleHRDaGFuZ2VkID0gY2hhbmdlT2JqOwoKICAgICAgLy8gVXBkYXRlIHRoZSBzZWxlY3Rpb24K
			ICAgICAgZnVuY3Rpb24gdXBkYXRlTGluZShuKSB7cmV0dXJuIG4gPD0gTWF0aC5taW4odG8ubGlu
			ZSwgdG8ubGluZSArIGxlbmRpZmYpID8gbiA6IG4gKyBsZW5kaWZmO30KICAgICAgc2V0U2VsZWN0
			aW9uKHNlbEZyb20sIHNlbFRvLCB1cGRhdGVMaW5lKHNlbC5mcm9tLmxpbmUpLCB1cGRhdGVMaW5l
			KHNlbC50by5saW5lKSk7CgogICAgICAvLyBNYWtlIHN1cmUgdGhlIHNjcm9sbC1zaXplIGRpdiBo
			YXMgdGhlIGNvcnJlY3QgaGVpZ2h0LgogICAgICBpZiAoc2Nyb2xsZXIuY2xpZW50SGVpZ2h0KQog
			ICAgICAgIGNvZGUuc3R5bGUuaGVpZ2h0ID0gKGRvYy5oZWlnaHQgKiB0ZXh0SGVpZ2h0KCkgKyAy
			ICogcGFkZGluZ1RvcCgpKSArICJweCI7CiAgICB9CgogICAgZnVuY3Rpb24gcmVwbGFjZVJhbmdl
			KGNvZGUsIGZyb20sIHRvKSB7CiAgICAgIGZyb20gPSBjbGlwUG9zKGZyb20pOwogICAgICBpZiAo
			IXRvKSB0byA9IGZyb207IGVsc2UgdG8gPSBjbGlwUG9zKHRvKTsKICAgICAgY29kZSA9IHNwbGl0
			TGluZXMoY29kZSk7CiAgICAgIGZ1bmN0aW9uIGFkanVzdFBvcyhwb3MpIHsKICAgICAgICBpZiAo
			cG9zTGVzcyhwb3MsIGZyb20pKSByZXR1cm4gcG9zOwogICAgICAgIGlmICghcG9zTGVzcyh0bywg
			cG9zKSkgcmV0dXJuIGVuZDsKICAgICAgICB2YXIgbGluZSA9IHBvcy5saW5lICsgY29kZS5sZW5n
			dGggLSAodG8ubGluZSAtIGZyb20ubGluZSkgLSAxOwogICAgICAgIHZhciBjaCA9IHBvcy5jaDsK
			ICAgICAgICBpZiAocG9zLmxpbmUgPT0gdG8ubGluZSkKICAgICAgICAgIGNoICs9IGNvZGVbY29k
			ZS5sZW5ndGgtMV0ubGVuZ3RoIC0gKHRvLmNoIC0gKHRvLmxpbmUgPT0gZnJvbS5saW5lID8gZnJv
			bS5jaCA6IDApKTsKICAgICAgICByZXR1cm4ge2xpbmU6IGxpbmUsIGNoOiBjaH07CiAgICAgIH0K
			ICAgICAgdmFyIGVuZDsKICAgICAgcmVwbGFjZVJhbmdlMShjb2RlLCBmcm9tLCB0bywgZnVuY3Rp
			b24oZW5kMSkgewogICAgICAgIGVuZCA9IGVuZDE7CiAgICAgICAgcmV0dXJuIHtmcm9tOiBhZGp1
			c3RQb3Moc2VsLmZyb20pLCB0bzogYWRqdXN0UG9zKHNlbC50byl9OwogICAgICB9KTsKICAgICAg
			cmV0dXJuIGVuZDsKICAgIH0KICAgIGZ1bmN0aW9uIHJlcGxhY2VTZWxlY3Rpb24oY29kZSwgY29s
			bGFwc2UpIHsKICAgICAgcmVwbGFjZVJhbmdlMShzcGxpdExpbmVzKGNvZGUpLCBzZWwuZnJvbSwg
			c2VsLnRvLCBmdW5jdGlvbihlbmQpIHsKICAgICAgICBpZiAoY29sbGFwc2UgPT0gImVuZCIpIHJl
			dHVybiB7ZnJvbTogZW5kLCB0bzogZW5kfTsKICAgICAgICBlbHNlIGlmIChjb2xsYXBzZSA9PSAi
			c3RhcnQiKSByZXR1cm4ge2Zyb206IHNlbC5mcm9tLCB0bzogc2VsLmZyb219OwogICAgICAgIGVs
			c2UgcmV0dXJuIHtmcm9tOiBzZWwuZnJvbSwgdG86IGVuZH07CiAgICAgIH0pOwogICAgfQogICAg
			ZnVuY3Rpb24gcmVwbGFjZVJhbmdlMShjb2RlLCBmcm9tLCB0bywgY29tcHV0ZVNlbCkgewogICAg
			ICB2YXIgZW5kY2ggPSBjb2RlLmxlbmd0aCA9PSAxID8gY29kZVswXS5sZW5ndGggKyBmcm9tLmNo
			IDogY29kZVtjb2RlLmxlbmd0aC0xXS5sZW5ndGg7CiAgICAgIHZhciBuZXdTZWwgPSBjb21wdXRl
			U2VsKHtsaW5lOiBmcm9tLmxpbmUgKyBjb2RlLmxlbmd0aCAtIDEsIGNoOiBlbmRjaH0pOwogICAg
			ICB1cGRhdGVMaW5lcyhmcm9tLCB0bywgY29kZSwgbmV3U2VsLmZyb20sIG5ld1NlbC50byk7CiAg
			ICB9CgogICAgZnVuY3Rpb24gZ2V0UmFuZ2UoZnJvbSwgdG8pIHsKICAgICAgdmFyIGwxID0gZnJv
			bS5saW5lLCBsMiA9IHRvLmxpbmU7CiAgICAgIGlmIChsMSA9PSBsMikgcmV0dXJuIGdldExpbmUo
			bDEpLnRleHQuc2xpY2UoZnJvbS5jaCwgdG8uY2gpOwogICAgICB2YXIgY29kZSA9IFtnZXRMaW5l
			KGwxKS50ZXh0LnNsaWNlKGZyb20uY2gpXTsKICAgICAgZG9jLml0ZXIobDEgKyAxLCBsMiwgZnVu
			Y3Rpb24obGluZSkgeyBjb2RlLnB1c2gobGluZS50ZXh0KTsgfSk7CiAgICAgIGNvZGUucHVzaChn
			ZXRMaW5lKGwyKS50ZXh0LnNsaWNlKDAsIHRvLmNoKSk7CiAgICAgIHJldHVybiBjb2RlLmpvaW4o
			IlxuIik7CiAgICB9CiAgICBmdW5jdGlvbiBnZXRTZWxlY3Rpb24oKSB7CiAgICAgIHJldHVybiBn
			ZXRSYW5nZShzZWwuZnJvbSwgc2VsLnRvKTsKICAgIH0KCiAgICB2YXIgcG9sbGluZ0Zhc3QgPSBm
			YWxzZTsgLy8gRW5zdXJlcyBzbG93UG9sbCBkb2Vzbid0IGNhbmNlbCBmYXN0UG9sbAogICAgZnVu
			Y3Rpb24gc2xvd1BvbGwoKSB7CiAgICAgIGlmIChwb2xsaW5nRmFzdCkgcmV0dXJuOwogICAgICBw
			b2xsLnNldChvcHRpb25zLnBvbGxJbnRlcnZhbCwgZnVuY3Rpb24oKSB7CiAgICAgICAgc3RhcnRP
			cGVyYXRpb24oKTsKICAgICAgICByZWFkSW5wdXQoKTsKICAgICAgICBpZiAoZm9jdXNlZCkgc2xv
			d1BvbGwoKTsKICAgICAgICBlbmRPcGVyYXRpb24oKTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5j
			dGlvbiBmYXN0UG9sbCgpIHsKICAgICAgdmFyIG1pc3NlZCA9IGZhbHNlOwogICAgICBwb2xsaW5n
			RmFzdCA9IHRydWU7CiAgICAgIGZ1bmN0aW9uIHAoKSB7CiAgICAgICAgc3RhcnRPcGVyYXRpb24o
			KTsKICAgICAgICB2YXIgY2hhbmdlZCA9IHJlYWRJbnB1dCgpOwogICAgICAgIGlmICghY2hhbmdl
			ZCAmJiAhbWlzc2VkKSB7bWlzc2VkID0gdHJ1ZTsgcG9sbC5zZXQoNjAsIHApO30KICAgICAgICBl
			bHNlIHtwb2xsaW5nRmFzdCA9IGZhbHNlOyBzbG93UG9sbCgpO30KICAgICAgICBlbmRPcGVyYXRp
			b24oKTsKICAgICAgfQogICAgICBwb2xsLnNldCgyMCwgcCk7CiAgICB9CgogICAgLy8gUHJldmlu
			cHV0IGlzIGEgaGFjayB0byB3b3JrIHdpdGggSU1FLiBJZiB3ZSByZXNldCB0aGUgdGV4dGFyZWEK
			ICAgIC8vIG9uIGV2ZXJ5IGNoYW5nZSwgdGhhdCBicmVha3MgSU1FLiBTbyB3ZSBsb29rIGZvciBj
			aGFuZ2VzCiAgICAvLyBjb21wYXJlZCB0byB0aGUgcHJldmlvdXMgY29udGVudCBpbnN0ZWFkLiAo
			TW9kZXJuIGJyb3dzZXJzIGhhdmUKICAgIC8vIGV2ZW50cyB0aGF0IGluZGljYXRlIElNRSB0YWtp
			bmcgcGxhY2UsIGJ1dCB0aGVzZSBhcmUgbm90IHdpZGVseQogICAgLy8gc3VwcG9ydGVkIG9yIGNv
			bXBhdGlibGUgZW5vdWdoIHlldCB0byByZWx5IG9uLikKICAgIHZhciBwcmV2SW5wdXQgPSAiIjsK
			ICAgIGZ1bmN0aW9uIHJlYWRJbnB1dCgpIHsKICAgICAgaWYgKGxlYXZlSW5wdXRBbG9uZSB8fCAh
			Zm9jdXNlZCB8fCBoYXNTZWxlY3Rpb24oaW5wdXQpIHx8IG9wdGlvbnMucmVhZE9ubHkpIHJldHVy
			biBmYWxzZTsKICAgICAgdmFyIHRleHQgPSBpbnB1dC52YWx1ZTsKICAgICAgaWYgKHRleHQgPT0g
			cHJldklucHV0KSByZXR1cm4gZmFsc2U7CiAgICAgIHNoaWZ0U2VsZWN0aW5nID0gbnVsbDsKICAg
			ICAgdmFyIHNhbWUgPSAwLCBsID0gTWF0aC5taW4ocHJldklucHV0Lmxlbmd0aCwgdGV4dC5sZW5n
			dGgpOwogICAgICB3aGlsZSAoc2FtZSA8IGwgJiYgcHJldklucHV0W3NhbWVdID09IHRleHRbc2Ft
			ZV0pICsrc2FtZTsKICAgICAgaWYgKHNhbWUgPCBwcmV2SW5wdXQubGVuZ3RoKQogICAgICAgIHNl
			bC5mcm9tID0ge2xpbmU6IHNlbC5mcm9tLmxpbmUsIGNoOiBzZWwuZnJvbS5jaCAtIChwcmV2SW5w
			dXQubGVuZ3RoIC0gc2FtZSl9OwogICAgICBlbHNlIGlmIChvdmVyd3JpdGUgJiYgcG9zRXEoc2Vs
			LmZyb20sIHNlbC50bykpCiAgICAgICAgc2VsLnRvID0ge2xpbmU6IHNlbC50by5saW5lLCBjaDog
			TWF0aC5taW4oZ2V0TGluZShzZWwudG8ubGluZSkudGV4dC5sZW5ndGgsIHNlbC50by5jaCArICh0
			ZXh0Lmxlbmd0aCAtIHNhbWUpKX07CiAgICAgIHJlcGxhY2VTZWxlY3Rpb24odGV4dC5zbGljZShz
			YW1lKSwgImVuZCIpOwogICAgICBwcmV2SW5wdXQgPSB0ZXh0OwogICAgICByZXR1cm4gdHJ1ZTsK
			ICAgIH0KICAgIGZ1bmN0aW9uIHJlc2V0SW5wdXQodXNlcikgewogICAgICBpZiAoIXBvc0VxKHNl
			bC5mcm9tLCBzZWwudG8pKSB7CiAgICAgICAgcHJldklucHV0ID0gIiI7CiAgICAgICAgaW5wdXQu
			dmFsdWUgPSBnZXRTZWxlY3Rpb24oKTsKICAgICAgICBzZWxlY3RJbnB1dChpbnB1dCk7CiAgICAg
			IH0gZWxzZSBpZiAodXNlcikgcHJldklucHV0ID0gaW5wdXQudmFsdWUgPSAiIjsKICAgIH0KCiAg
			ICBmdW5jdGlvbiBmb2N1c0lucHV0KCkgewogICAgICBpZiAob3B0aW9ucy5yZWFkT25seSAhPSAi
			bm9jdXJzb3IiKSBpbnB1dC5mb2N1cygpOwogICAgfQoKICAgIGZ1bmN0aW9uIHNjcm9sbEVkaXRv
			ckludG9WaWV3KCkgewogICAgICBpZiAoIWN1cnNvci5nZXRCb3VuZGluZ0NsaWVudFJlY3QpIHJl
			dHVybjsKICAgICAgdmFyIHJlY3QgPSBjdXJzb3IuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CiAg
			ICAgIC8vIElFIHJldHVybnMgYm9ndXMgY29vcmRpbmF0ZXMgd2hlbiB0aGUgaW5zdGFuY2Ugc2l0
			cyBpbnNpZGUgb2YgYW4gaWZyYW1lIGFuZCB0aGUgY3Vyc29yIGlzIGhpZGRlbgogICAgICBpZiAo
			aWUgJiYgcmVjdC50b3AgPT0gcmVjdC5ib3R0b20pIHJldHVybjsKICAgICAgdmFyIHdpbkggPSB3
			aW5kb3cuaW5uZXJIZWlnaHQgfHwgTWF0aC5tYXgoZG9jdW1lbnQuYm9keS5vZmZzZXRIZWlnaHQs
			IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5vZmZzZXRIZWlnaHQpOwogICAgICBpZiAocmVjdC50
			b3AgPCAwIHx8IHJlY3QuYm90dG9tID4gd2luSCkgY3Vyc29yLnNjcm9sbEludG9WaWV3KCk7CiAg
			ICB9CiAgICBmdW5jdGlvbiBzY3JvbGxDdXJzb3JJbnRvVmlldygpIHsKICAgICAgdmFyIGN1cnNv
			ciA9IGxvY2FsQ29vcmRzKHNlbC5pbnZlcnRlZCA/IHNlbC5mcm9tIDogc2VsLnRvKTsKICAgICAg
			dmFyIHggPSBvcHRpb25zLmxpbmVXcmFwcGluZyA/IE1hdGgubWluKGN1cnNvci54LCBsaW5lU3Bh
			Y2Uub2Zmc2V0V2lkdGgpIDogY3Vyc29yLng7CiAgICAgIHJldHVybiBzY3JvbGxJbnRvVmlldyh4
			LCBjdXJzb3IueSwgeCwgY3Vyc29yLnlCb3QpOwogICAgfQogICAgZnVuY3Rpb24gc2Nyb2xsSW50
			b1ZpZXcoeDEsIHkxLCB4MiwgeTIpIHsKICAgICAgdmFyIHBsID0gcGFkZGluZ0xlZnQoKSwgcHQg
			PSBwYWRkaW5nVG9wKCksIGxoID0gdGV4dEhlaWdodCgpOwogICAgICB5MSArPSBwdDsgeTIgKz0g
			cHQ7IHgxICs9IHBsOyB4MiArPSBwbDsKICAgICAgdmFyIHNjcmVlbiA9IHNjcm9sbGVyLmNsaWVu
			dEhlaWdodCwgc2NyZWVudG9wID0gc2Nyb2xsZXIuc2Nyb2xsVG9wLCBzY3JvbGxlZCA9IGZhbHNl
			LCByZXN1bHQgPSB0cnVlOwogICAgICBpZiAoeTEgPCBzY3JlZW50b3ApIHtzY3JvbGxlci5zY3Jv
			bGxUb3AgPSBNYXRoLm1heCgwLCB5MSAtIDIqbGgpOyBzY3JvbGxlZCA9IHRydWU7fQogICAgICBl
			bHNlIGlmICh5MiA+IHNjcmVlbnRvcCArIHNjcmVlbikge3Njcm9sbGVyLnNjcm9sbFRvcCA9IHky
			ICsgbGggLSBzY3JlZW47IHNjcm9sbGVkID0gdHJ1ZTt9CgogICAgICB2YXIgc2NyZWVudyA9IHNj
			cm9sbGVyLmNsaWVudFdpZHRoLCBzY3JlZW5sZWZ0ID0gc2Nyb2xsZXIuc2Nyb2xsTGVmdDsKICAg
			ICAgdmFyIGd1dHRlcncgPSBvcHRpb25zLmZpeGVkR3V0dGVyID8gZ3V0dGVyLmNsaWVudFdpZHRo
			IDogMDsKICAgICAgaWYgKHgxIDwgc2NyZWVubGVmdCArIGd1dHRlcncpIHsKICAgICAgICBpZiAo
			eDEgPCA1MCkgeDEgPSAwOwogICAgICAgIHNjcm9sbGVyLnNjcm9sbExlZnQgPSBNYXRoLm1heCgw
			LCB4MSAtIDEwIC0gZ3V0dGVydyk7CiAgICAgICAgc2Nyb2xsZWQgPSB0cnVlOwogICAgICB9CiAg
			ICAgIGVsc2UgaWYgKHgyID4gc2NyZWVudyArIHNjcmVlbmxlZnQgLSAzKSB7CiAgICAgICAgc2Ny
			b2xsZXIuc2Nyb2xsTGVmdCA9IHgyICsgMTAgLSBzY3JlZW53OwogICAgICAgIHNjcm9sbGVkID0g
			dHJ1ZTsKICAgICAgICBpZiAoeDIgPiBjb2RlLmNsaWVudFdpZHRoKSByZXN1bHQgPSBmYWxzZTsK
			ICAgICAgfQogICAgICBpZiAoc2Nyb2xsZWQgJiYgb3B0aW9ucy5vblNjcm9sbCkgb3B0aW9ucy5v
			blNjcm9sbChpbnN0YW5jZSk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogICAgZnVuY3Rp
			b24gdmlzaWJsZUxpbmVzKCkgewogICAgICB2YXIgbGggPSB0ZXh0SGVpZ2h0KCksIHRvcCA9IHNj
			cm9sbGVyLnNjcm9sbFRvcCAtIHBhZGRpbmdUb3AoKTsKICAgICAgdmFyIGZyb21faGVpZ2h0ID0g
			TWF0aC5tYXgoMCwgTWF0aC5mbG9vcih0b3AgLyBsaCkpOwogICAgICB2YXIgdG9faGVpZ2h0ID0g
			TWF0aC5jZWlsKCh0b3AgKyBzY3JvbGxlci5jbGllbnRIZWlnaHQpIC8gbGgpOwogICAgICByZXR1
			cm4ge2Zyb206IGxpbmVBdEhlaWdodChkb2MsIGZyb21faGVpZ2h0KSwKICAgICAgICAgICAgICB0
			bzogbGluZUF0SGVpZ2h0KGRvYywgdG9faGVpZ2h0KX07CiAgICB9CiAgICAvLyBVc2VzIGEgc2V0
			IG9mIGNoYW5nZXMgcGx1cyB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24gdG8KICAgIC8vIGRl
			dGVybWluZSB3aGljaCBET00gdXBkYXRlcyBoYXZlIHRvIGJlIG1hZGUsIGFuZCBtYWtlcyB0aGUK
			ICAgIC8vIHVwZGF0ZXMuCiAgICBmdW5jdGlvbiB1cGRhdGVEaXNwbGF5KGNoYW5nZXMsIHN1cHBy
			ZXNzQ2FsbGJhY2spIHsKICAgICAgaWYgKCFzY3JvbGxlci5jbGllbnRXaWR0aCkgewogICAgICAg
			IHNob3dpbmdGcm9tID0gc2hvd2luZ1RvID0gZGlzcGxheU9mZnNldCA9IDA7CiAgICAgICAgcmV0
			dXJuOwogICAgICB9CiAgICAgIC8vIENvbXB1dGUgdGhlIG5ldyB2aXNpYmxlIHdpbmRvdwogICAg
			ICB2YXIgdmlzaWJsZSA9IHZpc2libGVMaW5lcygpOwogICAgICAvLyBCYWlsIG91dCBpZiB0aGUg
			dmlzaWJsZSBhcmVhIGlzIGFscmVhZHkgcmVuZGVyZWQgYW5kIG5vdGhpbmcgY2hhbmdlZC4KICAg
			ICAgaWYgKGNoYW5nZXMgIT09IHRydWUgJiYgY2hhbmdlcy5sZW5ndGggPT0gMCAmJiB2aXNpYmxl
			LmZyb20gPiBzaG93aW5nRnJvbSAmJiB2aXNpYmxlLnRvIDwgc2hvd2luZ1RvKSByZXR1cm47CiAg
			ICAgIHZhciBmcm9tID0gTWF0aC5tYXgodmlzaWJsZS5mcm9tIC0gMTAwLCAwKSwgdG8gPSBNYXRo
			Lm1pbihkb2Muc2l6ZSwgdmlzaWJsZS50byArIDEwMCk7CiAgICAgIGlmIChzaG93aW5nRnJvbSA8
			IGZyb20gJiYgZnJvbSAtIHNob3dpbmdGcm9tIDwgMjApIGZyb20gPSBzaG93aW5nRnJvbTsKICAg
			ICAgaWYgKHNob3dpbmdUbyA+IHRvICYmIHNob3dpbmdUbyAtIHRvIDwgMjApIHRvID0gTWF0aC5t
			aW4oZG9jLnNpemUsIHNob3dpbmdUbyk7CgogICAgICAvLyBDcmVhdGUgYSByYW5nZSBvZiB0aGVv
			cmV0aWNhbGx5IGludGFjdCBsaW5lcywgYW5kIHB1bmNoIGhvbGVzCiAgICAgIC8vIGluIHRoYXQg
			dXNpbmcgdGhlIGNoYW5nZSBpbmZvLgogICAgICB2YXIgaW50YWN0ID0gY2hhbmdlcyA9PT0gdHJ1
			ZSA/IFtdIDoKICAgICAgICBjb21wdXRlSW50YWN0KFt7ZnJvbTogc2hvd2luZ0Zyb20sIHRvOiBz
			aG93aW5nVG8sIGRvbVN0YXJ0OiAwfV0sIGNoYW5nZXMpOwogICAgICAvLyBDbGlwIG9mZiB0aGUg
			cGFydHMgdGhhdCB3b24ndCBiZSB2aXNpYmxlCiAgICAgIHZhciBpbnRhY3RMaW5lcyA9IDA7CiAg
			ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW50YWN0Lmxlbmd0aDsgKytpKSB7CiAgICAgICAgdmFy
			IHJhbmdlID0gaW50YWN0W2ldOwogICAgICAgIGlmIChyYW5nZS5mcm9tIDwgZnJvbSkge3Jhbmdl
			LmRvbVN0YXJ0ICs9IChmcm9tIC0gcmFuZ2UuZnJvbSk7IHJhbmdlLmZyb20gPSBmcm9tO30KICAg
			ICAgICBpZiAocmFuZ2UudG8gPiB0bykgcmFuZ2UudG8gPSB0bzsKICAgICAgICBpZiAocmFuZ2Uu
			ZnJvbSA+PSByYW5nZS50bykgaW50YWN0LnNwbGljZShpLS0sIDEpOwogICAgICAgIGVsc2UgaW50
			YWN0TGluZXMgKz0gcmFuZ2UudG8gLSByYW5nZS5mcm9tOwogICAgICB9CiAgICAgIGlmIChpbnRh
			Y3RMaW5lcyA9PSB0byAtIGZyb20pIHJldHVybjsKICAgICAgaW50YWN0LnNvcnQoZnVuY3Rpb24o
			YSwgYikge3JldHVybiBhLmRvbVN0YXJ0IC0gYi5kb21TdGFydDt9KTsKCiAgICAgIHZhciB0aCA9
			IHRleHRIZWlnaHQoKSwgZ3V0dGVyRGlzcGxheSA9IGd1dHRlci5zdHlsZS5kaXNwbGF5OwogICAg
			ICBsaW5lRGl2LnN0eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgIHBhdGNoRGlzcGxheShmcm9t
			LCB0bywgaW50YWN0KTsKICAgICAgbGluZURpdi5zdHlsZS5kaXNwbGF5ID0gZ3V0dGVyLnN0eWxl
			LmRpc3BsYXkgPSAiIjsKCiAgICAgIC8vIFBvc2l0aW9uIHRoZSBtb3ZlciBkaXYgdG8gYWxpZ24g
			d2l0aCB0aGUgbGluZXMgaXQncyBzdXBwb3NlZAogICAgICAvLyB0byBiZSBzaG93aW5nICh3aGlj
			aCB3aWxsIGNvdmVyIHRoZSB2aXNpYmxlIGRpc3BsYXkpCiAgICAgIHZhciBkaWZmZXJlbnQgPSBm
			cm9tICE9IHNob3dpbmdGcm9tIHx8IHRvICE9IHNob3dpbmdUbyB8fCBsYXN0U2l6ZUMgIT0gc2Ny
			b2xsZXIuY2xpZW50SGVpZ2h0ICsgdGg7CiAgICAgIC8vIFRoaXMgaXMganVzdCBhIGJvZ3VzIGZv
			cm11bGEgdGhhdCBkZXRlY3RzIHdoZW4gdGhlIGVkaXRvciBpcwogICAgICAvLyByZXNpemVkIG9y
			IHRoZSBmb250IHNpemUgY2hhbmdlcy4KICAgICAgaWYgKGRpZmZlcmVudCkgbGFzdFNpemVDID0g
			c2Nyb2xsZXIuY2xpZW50SGVpZ2h0ICsgdGg7CiAgICAgIHNob3dpbmdGcm9tID0gZnJvbTsgc2hv
			d2luZ1RvID0gdG87CiAgICAgIGRpc3BsYXlPZmZzZXQgPSBoZWlnaHRBdExpbmUoZG9jLCBmcm9t
			KTsKICAgICAgbW92ZXIuc3R5bGUudG9wID0gKGRpc3BsYXlPZmZzZXQgKiB0aCkgKyAicHgiOwog
			ICAgICBpZiAoc2Nyb2xsZXIuY2xpZW50SGVpZ2h0KQogICAgICAgIGNvZGUuc3R5bGUuaGVpZ2h0
			ID0gKGRvYy5oZWlnaHQgKiB0aCArIDIgKiBwYWRkaW5nVG9wKCkpICsgInB4IjsKCiAgICAgIC8v
			IFNpbmNlIHRoaXMgaXMgYWxsIHJhdGhlciBlcnJvciBwcm9uZSwgaXQgaXMgaG9ub3VyZWQgd2l0
			aCB0aGUKICAgICAgLy8gb25seSBhc3NlcnRpb24gaW4gdGhlIHdob2xlIGZpbGUuCiAgICAgIGlm
			IChsaW5lRGl2LmNoaWxkTm9kZXMubGVuZ3RoICE9IHNob3dpbmdUbyAtIHNob3dpbmdGcm9tKQog
			ICAgICAgIHRocm93IG5ldyBFcnJvcigiQkFEIFBBVENIISAiICsgSlNPTi5zdHJpbmdpZnkoaW50
			YWN0KSArICIgc2l6ZT0iICsgKHNob3dpbmdUbyAtIHNob3dpbmdGcm9tKSArCiAgICAgICAgICAg
			ICAgICAgICAgICAgICIgbm9kZXM9IiArIGxpbmVEaXYuY2hpbGROb2Rlcy5sZW5ndGgpOwoKICAg
			ICAgaWYgKG9wdGlvbnMubGluZVdyYXBwaW5nKSB7CiAgICAgICAgbWF4V2lkdGggPSBzY3JvbGxl
			ci5jbGllbnRXaWR0aDsKICAgICAgICB2YXIgY3VyTm9kZSA9IGxpbmVEaXYuZmlyc3RDaGlsZCwg
			aGVpZ2h0Q2hhbmdlZCA9IGZhbHNlOwogICAgICAgIGRvYy5pdGVyKHNob3dpbmdGcm9tLCBzaG93
			aW5nVG8sIGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICAgIGlmICghbGluZS5oaWRkZW4pIHsKICAg
			ICAgICAgICAgdmFyIGhlaWdodCA9IE1hdGgucm91bmQoY3VyTm9kZS5vZmZzZXRIZWlnaHQgLyB0
			aCkgfHwgMTsKICAgICAgICAgICAgaWYgKGxpbmUuaGVpZ2h0ICE9IGhlaWdodCkgewogICAgICAg
			ICAgICAgIHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgaGVpZ2h0KTsKICAgICAgICAgICAgICBndXR0
			ZXJEaXJ0eSA9IGhlaWdodENoYW5nZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICB9
			CiAgICAgICAgICBjdXJOb2RlID0gY3VyTm9kZS5uZXh0U2libGluZzsKICAgICAgICB9KTsKICAg
			ICAgICBpZiAoaGVpZ2h0Q2hhbmdlZCkKICAgICAgICAgIGNvZGUuc3R5bGUuaGVpZ2h0ID0gKGRv
			Yy5oZWlnaHQgKiB0aCArIDIgKiBwYWRkaW5nVG9wKCkpICsgInB4IjsKICAgICAgfSBlbHNlIHsK
			ICAgICAgICBpZiAobWF4V2lkdGggPT0gbnVsbCkgbWF4V2lkdGggPSBzdHJpbmdXaWR0aChtYXhM
			aW5lKTsKICAgICAgICBpZiAobWF4V2lkdGggPiBzY3JvbGxlci5jbGllbnRXaWR0aCkgewogICAg
			ICAgICAgbGluZVNwYWNlLnN0eWxlLndpZHRoID0gbWF4V2lkdGggKyAicHgiOwogICAgICAgICAg
			Ly8gTmVlZGVkIHRvIHByZXZlbnQgb2RkIHdyYXBwaW5nL2hpZGluZyBvZiB3aWRnZXRzIHBsYWNl
			ZCBpbiBoZXJlLgogICAgICAgICAgY29kZS5zdHlsZS53aWR0aCA9ICIiOwogICAgICAgICAgY29k
			ZS5zdHlsZS53aWR0aCA9IHNjcm9sbGVyLnNjcm9sbFdpZHRoICsgInB4IjsKICAgICAgICB9IGVs
			c2UgewogICAgICAgICAgbGluZVNwYWNlLnN0eWxlLndpZHRoID0gY29kZS5zdHlsZS53aWR0aCA9
			ICIiOwogICAgICAgIH0KICAgICAgfQogICAgICBndXR0ZXIuc3R5bGUuZGlzcGxheSA9IGd1dHRl
			ckRpc3BsYXk7CiAgICAgIGlmIChkaWZmZXJlbnQgfHwgZ3V0dGVyRGlydHkpIHVwZGF0ZUd1dHRl
			cigpOwogICAgICB1cGRhdGVTZWxlY3Rpb24oKTsKICAgICAgaWYgKCFzdXBwcmVzc0NhbGxiYWNr
			ICYmIG9wdGlvbnMub25VcGRhdGUpIG9wdGlvbnMub25VcGRhdGUoaW5zdGFuY2UpOwogICAgICBy
			ZXR1cm4gdHJ1ZTsKICAgIH0KCiAgICBmdW5jdGlvbiBjb21wdXRlSW50YWN0KGludGFjdCwgY2hh
			bmdlcykgewogICAgICBmb3IgKHZhciBpID0gMCwgbCA9IGNoYW5nZXMubGVuZ3RoIHx8IDA7IGkg
			PCBsOyArK2kpIHsKICAgICAgICB2YXIgY2hhbmdlID0gY2hhbmdlc1tpXSwgaW50YWN0MiA9IFtd
			LCBkaWZmID0gY2hhbmdlLmRpZmYgfHwgMDsKICAgICAgICBmb3IgKHZhciBqID0gMCwgbDIgPSBp
			bnRhY3QubGVuZ3RoOyBqIDwgbDI7ICsraikgewogICAgICAgICAgdmFyIHJhbmdlID0gaW50YWN0
			W2pdOwogICAgICAgICAgaWYgKGNoYW5nZS50byA8PSByYW5nZS5mcm9tICYmIGNoYW5nZS5kaWZm
			KQogICAgICAgICAgICBpbnRhY3QyLnB1c2goe2Zyb206IHJhbmdlLmZyb20gKyBkaWZmLCB0bzog
			cmFuZ2UudG8gKyBkaWZmLAogICAgICAgICAgICAgICAgICAgICAgICAgIGRvbVN0YXJ0OiByYW5n
			ZS5kb21TdGFydH0pOwogICAgICAgICAgZWxzZSBpZiAoY2hhbmdlLnRvIDw9IHJhbmdlLmZyb20g
			fHwgY2hhbmdlLmZyb20gPj0gcmFuZ2UudG8pCiAgICAgICAgICAgIGludGFjdDIucHVzaChyYW5n
			ZSk7CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICAgaWYgKGNoYW5nZS5mcm9tID4gcmFuZ2Uu
			ZnJvbSkKICAgICAgICAgICAgICBpbnRhY3QyLnB1c2goe2Zyb206IHJhbmdlLmZyb20sIHRvOiBj
			aGFuZ2UuZnJvbSwgZG9tU3RhcnQ6IHJhbmdlLmRvbVN0YXJ0fSk7CiAgICAgICAgICAgIGlmIChj
			aGFuZ2UudG8gPCByYW5nZS50bykKICAgICAgICAgICAgICBpbnRhY3QyLnB1c2goe2Zyb206IGNo
			YW5nZS50byArIGRpZmYsIHRvOiByYW5nZS50byArIGRpZmYsCiAgICAgICAgICAgICAgICAgICAg
			ICAgICAgICBkb21TdGFydDogcmFuZ2UuZG9tU3RhcnQgKyAoY2hhbmdlLnRvIC0gcmFuZ2UuZnJv
			bSl9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaW50YWN0ID0gaW50YWN0MjsKICAg
			ICAgfQogICAgICByZXR1cm4gaW50YWN0OwogICAgfQoKICAgIGZ1bmN0aW9uIHBhdGNoRGlzcGxh
			eShmcm9tLCB0bywgaW50YWN0KSB7CiAgICAgIC8vIFRoZSBmaXJzdCBwYXNzIHJlbW92ZXMgdGhl
			IERPTSBub2RlcyB0aGF0IGFyZW4ndCBpbnRhY3QuCiAgICAgIGlmICghaW50YWN0Lmxlbmd0aCkg
			bGluZURpdi5pbm5lckhUTUwgPSAiIjsKICAgICAgZWxzZSB7CiAgICAgICAgZnVuY3Rpb24ga2ls
			bE5vZGUobm9kZSkgewogICAgICAgICAgdmFyIHRtcCA9IG5vZGUubmV4dFNpYmxpbmc7CiAgICAg
			ICAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7CiAgICAgICAgICByZXR1cm4g
			dG1wOwogICAgICAgIH0KICAgICAgICB2YXIgZG9tUG9zID0gMCwgY3VyTm9kZSA9IGxpbmVEaXYu
			Zmlyc3RDaGlsZCwgbjsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGludGFjdC5sZW5ndGg7
			ICsraSkgewogICAgICAgICAgdmFyIGN1ciA9IGludGFjdFtpXTsKICAgICAgICAgIHdoaWxlIChj
			dXIuZG9tU3RhcnQgPiBkb21Qb3MpIHtjdXJOb2RlID0ga2lsbE5vZGUoY3VyTm9kZSk7IGRvbVBv
			cysrO30KICAgICAgICAgIGZvciAodmFyIGogPSAwLCBlID0gY3VyLnRvIC0gY3VyLmZyb207IGog
			PCBlOyArK2opIHtjdXJOb2RlID0gY3VyTm9kZS5uZXh0U2libGluZzsgZG9tUG9zKys7fQogICAg
			ICAgIH0KICAgICAgICB3aGlsZSAoY3VyTm9kZSkgY3VyTm9kZSA9IGtpbGxOb2RlKGN1ck5vZGUp
			OwogICAgICB9CiAgICAgIC8vIFRoaXMgcGFzcyBmaWxscyBpbiB0aGUgbGluZXMgdGhhdCBhY3R1
			YWxseSBjaGFuZ2VkLgogICAgICB2YXIgbmV4dEludGFjdCA9IGludGFjdC5zaGlmdCgpLCBjdXJO
			b2RlID0gbGluZURpdi5maXJzdENoaWxkLCBqID0gZnJvbTsKICAgICAgdmFyIHNjcmF0Y2ggPSB0
			YXJnZXREb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKSwgbmV3RWx0OwogICAgICBkb2MuaXRl
			cihmcm9tLCB0bywgZnVuY3Rpb24obGluZSkgewogICAgICAgIGlmIChuZXh0SW50YWN0ICYmIG5l
			eHRJbnRhY3QudG8gPT0gaikgbmV4dEludGFjdCA9IGludGFjdC5zaGlmdCgpOwogICAgICAgIGlm
			ICghbmV4dEludGFjdCB8fCBuZXh0SW50YWN0LmZyb20gPiBqKSB7CiAgICAgICAgICBpZiAobGlu
			ZS5oaWRkZW4pIHZhciBodG1sID0gc2NyYXRjaC5pbm5lckhUTUwgPSAiPHByZT48L3ByZT4iOwog
			ICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgIHZhciBodG1sID0gJzxwcmU+JyArIGxpbmUuZ2V0
			SFRNTChtYWtlVGFiKSArICc8L3ByZT4nOwogICAgICAgICAgICAvLyBLbHVkZ2UgdG8gbWFrZSBz
			dXJlIHRoZSBzdHlsZWQgZWxlbWVudCBsaWVzIGJlaGluZCB0aGUgc2VsZWN0aW9uIChieSB6LWlu
			ZGV4KQogICAgICAgICAgICBpZiAobGluZS5jbGFzc05hbWUpCiAgICAgICAgICAgICAgaHRtbCA9
			ICc8ZGl2IHN0eWxlPSJwb3NpdGlvbjogcmVsYXRpdmUiPjxwcmUgY2xhc3M9IicgKyBsaW5lLmNs
			YXNzTmFtZSArCiAgICAgICAgICAgICAgJyIgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVm
			dDogMDsgcmlnaHQ6IDA7IHRvcDogMDsgYm90dG9tOiAwOyB6LWluZGV4OiAtMiI+JiMxNjA7PC9w
			cmU+JyArIGh0bWwgKyAiPC9kaXY+IjsKICAgICAgICAgIH0KICAgICAgICAgIHNjcmF0Y2guaW5u
			ZXJIVE1MID0gaHRtbDsKICAgICAgICAgIGxpbmVEaXYuaW5zZXJ0QmVmb3JlKHNjcmF0Y2guZmly
			c3RDaGlsZCwgY3VyTm9kZSk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGN1ck5vZGUgPSBj
			dXJOb2RlLm5leHRTaWJsaW5nOwogICAgICAgIH0KICAgICAgICArK2o7CiAgICAgIH0pOwogICAg
			fQoKICAgIGZ1bmN0aW9uIHVwZGF0ZUd1dHRlcigpIHsKICAgICAgaWYgKCFvcHRpb25zLmd1dHRl
			ciAmJiAhb3B0aW9ucy5saW5lTnVtYmVycykgcmV0dXJuOwogICAgICB2YXIgaFRleHQgPSBtb3Zl
			ci5vZmZzZXRIZWlnaHQsIGhFZGl0b3IgPSBzY3JvbGxlci5jbGllbnRIZWlnaHQ7CiAgICAgIGd1
			dHRlci5zdHlsZS5oZWlnaHQgPSAoaFRleHQgLSBoRWRpdG9yIDwgMiA/IGhFZGl0b3IgOiBoVGV4
			dCkgKyAicHgiOwogICAgICB2YXIgaHRtbCA9IFtdLCBpID0gc2hvd2luZ0Zyb207CiAgICAgIGRv
			Yy5pdGVyKHNob3dpbmdGcm9tLCBNYXRoLm1heChzaG93aW5nVG8sIHNob3dpbmdGcm9tICsgMSks
			IGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICBpZiAobGluZS5oaWRkZW4pIHsKICAgICAgICAgIGh0
			bWwucHVzaCgiPHByZT48L3ByZT4iKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdmFyIG1h
			cmtlciA9IGxpbmUuZ3V0dGVyTWFya2VyOwogICAgICAgICAgdmFyIHRleHQgPSBvcHRpb25zLmxp
			bmVOdW1iZXJzID8gaSArIG9wdGlvbnMuZmlyc3RMaW5lTnVtYmVyIDogbnVsbDsKICAgICAgICAg
			IGlmIChtYXJrZXIgJiYgbWFya2VyLnRleHQpCiAgICAgICAgICAgIHRleHQgPSBtYXJrZXIudGV4
			dC5yZXBsYWNlKCIlTiUiLCB0ZXh0ICE9IG51bGwgPyB0ZXh0IDogIiIpOwogICAgICAgICAgZWxz
			ZSBpZiAodGV4dCA9PSBudWxsKQogICAgICAgICAgICB0ZXh0ID0gIlx1MDBhMCI7CiAgICAgICAg
			ICBodG1sLnB1c2goKG1hcmtlciAmJiBtYXJrZXIuc3R5bGUgPyAnPHByZSBjbGFzcz0iJyArIG1h
			cmtlci5zdHlsZSArICciPicgOiAiPHByZT4iKSwgdGV4dCk7CiAgICAgICAgICBmb3IgKHZhciBq
			ID0gMTsgaiA8IGxpbmUuaGVpZ2h0OyArK2opIGh0bWwucHVzaCgiPGJyLz4mIzE2MDsiKTsKICAg
			ICAgICAgIGh0bWwucHVzaCgiPC9wcmU+Iik7CiAgICAgICAgfQogICAgICAgICsraTsKICAgICAg
			fSk7CiAgICAgIGd1dHRlci5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICBndXR0ZXJUZXh0
			LmlubmVySFRNTCA9IGh0bWwuam9pbigiIik7CiAgICAgIHZhciBtaW53aWR0aCA9IFN0cmluZyhk
			b2Muc2l6ZSkubGVuZ3RoLCBmaXJzdE5vZGUgPSBndXR0ZXJUZXh0LmZpcnN0Q2hpbGQsIHZhbCA9
			IGVsdFRleHQoZmlyc3ROb2RlKSwgcGFkID0gIiI7CiAgICAgIHdoaWxlICh2YWwubGVuZ3RoICsg
			cGFkLmxlbmd0aCA8IG1pbndpZHRoKSBwYWQgKz0gIlx1MDBhMCI7CiAgICAgIGlmIChwYWQpIGZp
			cnN0Tm9kZS5pbnNlcnRCZWZvcmUodGFyZ2V0RG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUocGFkKSwg
			Zmlyc3ROb2RlLmZpcnN0Q2hpbGQpOwogICAgICBndXR0ZXIuc3R5bGUuZGlzcGxheSA9ICIiOwog
			ICAgICBsaW5lU3BhY2Uuc3R5bGUubWFyZ2luTGVmdCA9IGd1dHRlci5vZmZzZXRXaWR0aCArICJw
			eCI7CiAgICAgIGd1dHRlckRpcnR5ID0gZmFsc2U7CiAgICB9CiAgICBmdW5jdGlvbiB1cGRhdGVT
			ZWxlY3Rpb24oKSB7CiAgICAgIHZhciBjb2xsYXBzZWQgPSBwb3NFcShzZWwuZnJvbSwgc2VsLnRv
			KTsKICAgICAgdmFyIGZyb21Qb3MgPSBsb2NhbENvb3JkcyhzZWwuZnJvbSwgdHJ1ZSk7CiAgICAg
			IHZhciB0b1BvcyA9IGNvbGxhcHNlZCA/IGZyb21Qb3MgOiBsb2NhbENvb3JkcyhzZWwudG8sIHRy
			dWUpOwogICAgICB2YXIgaGVhZFBvcyA9IHNlbC5pbnZlcnRlZCA/IGZyb21Qb3MgOiB0b1Bvcywg
			dGggPSB0ZXh0SGVpZ2h0KCk7CiAgICAgIHZhciB3cmFwT2ZmID0gZWx0T2Zmc2V0KHdyYXBwZXIp
			LCBsaW5lT2ZmID0gZWx0T2Zmc2V0KGxpbmVEaXYpOwogICAgICBpbnB1dERpdi5zdHlsZS50b3Ag
			PSBNYXRoLm1heCgwLCBNYXRoLm1pbihzY3JvbGxlci5vZmZzZXRIZWlnaHQsIGhlYWRQb3MueSAr
			IGxpbmVPZmYudG9wIC0gd3JhcE9mZi50b3ApKSArICJweCI7CiAgICAgIGlucHV0RGl2LnN0eWxl
			LmxlZnQgPSBNYXRoLm1heCgwLCBNYXRoLm1pbihzY3JvbGxlci5vZmZzZXRXaWR0aCwgaGVhZFBv
			cy54ICsgbGluZU9mZi5sZWZ0IC0gd3JhcE9mZi5sZWZ0KSkgKyAicHgiOwogICAgICBpZiAoY29s
			bGFwc2VkKSB7CiAgICAgICAgY3Vyc29yLnN0eWxlLnRvcCA9IGhlYWRQb3MueSArICJweCI7CiAg
			ICAgICAgY3Vyc29yLnN0eWxlLmxlZnQgPSAob3B0aW9ucy5saW5lV3JhcHBpbmcgPyBNYXRoLm1p
			bihoZWFkUG9zLngsIGxpbmVTcGFjZS5vZmZzZXRXaWR0aCkgOiBoZWFkUG9zLngpICsgInB4IjsK
			ICAgICAgICBjdXJzb3Iuc3R5bGUuZGlzcGxheSA9ICIiOwogICAgICAgIHNlbGVjdGlvbkRpdi5z
			dHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgICB9IGVsc2UgewogICAgICAgIHZhciBzYW1lTGlu
			ZSA9IGZyb21Qb3MueSA9PSB0b1Bvcy55LCBodG1sID0gIiI7CiAgICAgICAgZnVuY3Rpb24gYWRk
			KGxlZnQsIHRvcCwgcmlnaHQsIGhlaWdodCkgewogICAgICAgICAgaHRtbCArPSAnPGRpdiBjbGFz
			cz0iQ29kZU1pcnJvci1zZWxlY3RlZCIgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDog
			JyArIGxlZnQgKwogICAgICAgICAgICAncHg7IHRvcDogJyArIHRvcCArICdweDsgcmlnaHQ6ICcg
			KyByaWdodCArICdweDsgaGVpZ2h0OiAnICsgaGVpZ2h0ICsgJ3B4Ij48L2Rpdj4nOwogICAgICAg
			IH0KICAgICAgICBpZiAoc2VsLmZyb20uY2ggJiYgZnJvbVBvcy55ID49IDApIHsKICAgICAgICAg
			IHZhciByaWdodCA9IHNhbWVMaW5lID8gbGluZVNwYWNlLmNsaWVudFdpZHRoIC0gdG9Qb3MueCA6
			IDA7CiAgICAgICAgICBhZGQoZnJvbVBvcy54LCBmcm9tUG9zLnksIHJpZ2h0LCB0aCk7CiAgICAg
			ICAgfQogICAgICAgIHZhciBtaWRkbGVTdGFydCA9IE1hdGgubWF4KDAsIGZyb21Qb3MueSArIChz
			ZWwuZnJvbS5jaCA/IHRoIDogMCkpOwogICAgICAgIHZhciBtaWRkbGVIZWlnaHQgPSBNYXRoLm1p
			bih0b1Bvcy55LCBsaW5lU3BhY2UuY2xpZW50SGVpZ2h0KSAtIG1pZGRsZVN0YXJ0OwogICAgICAg
			IGlmIChtaWRkbGVIZWlnaHQgPiAwLjIgKiB0aCkKICAgICAgICAgIGFkZCgwLCBtaWRkbGVTdGFy
			dCwgMCwgbWlkZGxlSGVpZ2h0KTsKICAgICAgICBpZiAoKCFzYW1lTGluZSB8fCAhc2VsLmZyb20u
			Y2gpICYmIHRvUG9zLnkgPCBsaW5lU3BhY2UuY2xpZW50SGVpZ2h0IC0gLjUgKiB0aCkKICAgICAg
			ICAgIGFkZCgwLCB0b1Bvcy55LCBsaW5lU3BhY2UuY2xpZW50V2lkdGggLSB0b1Bvcy54LCB0aCk7
			CiAgICAgICAgc2VsZWN0aW9uRGl2LmlubmVySFRNTCA9IGh0bWw7CiAgICAgICAgY3Vyc29yLnN0
			eWxlLmRpc3BsYXkgPSAibm9uZSI7CiAgICAgICAgc2VsZWN0aW9uRGl2LnN0eWxlLmRpc3BsYXkg
			PSAiIjsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIHNldFNoaWZ0KHZhbCkgewogICAgICBp
			ZiAodmFsKSBzaGlmdFNlbGVjdGluZyA9IHNoaWZ0U2VsZWN0aW5nIHx8IChzZWwuaW52ZXJ0ZWQg
			PyBzZWwudG8gOiBzZWwuZnJvbSk7CiAgICAgIGVsc2Ugc2hpZnRTZWxlY3RpbmcgPSBudWxsOwog
			ICAgfQogICAgZnVuY3Rpb24gc2V0U2VsZWN0aW9uVXNlcihmcm9tLCB0bykgewogICAgICB2YXIg
			c2ggPSBzaGlmdFNlbGVjdGluZyAmJiBjbGlwUG9zKHNoaWZ0U2VsZWN0aW5nKTsKICAgICAgaWYg
			KHNoKSB7CiAgICAgICAgaWYgKHBvc0xlc3Moc2gsIGZyb20pKSBmcm9tID0gc2g7CiAgICAgICAg
			ZWxzZSBpZiAocG9zTGVzcyh0bywgc2gpKSB0byA9IHNoOwogICAgICB9CiAgICAgIHNldFNlbGVj
			dGlvbihmcm9tLCB0byk7CiAgICAgIHVzZXJTZWxDaGFuZ2UgPSB0cnVlOwogICAgfQogICAgLy8g
			VXBkYXRlIHRoZSBzZWxlY3Rpb24uIExhc3QgdHdvIGFyZ3MgYXJlIG9ubHkgdXNlZCBieQogICAg
			Ly8gdXBkYXRlTGluZXMsIHNpbmNlIHRoZXkgaGF2ZSB0byBiZSBleHByZXNzZWQgaW4gdGhlIGxp
			bmUKICAgIC8vIG51bWJlcnMgYmVmb3JlIHRoZSB1cGRhdGUuCiAgICBmdW5jdGlvbiBzZXRTZWxl
			Y3Rpb24oZnJvbSwgdG8sIG9sZEZyb20sIG9sZFRvKSB7CiAgICAgIGdvYWxDb2x1bW4gPSBudWxs
			OwogICAgICBpZiAob2xkRnJvbSA9PSBudWxsKSB7b2xkRnJvbSA9IHNlbC5mcm9tLmxpbmU7IG9s
			ZFRvID0gc2VsLnRvLmxpbmU7fQogICAgICBpZiAocG9zRXEoc2VsLmZyb20sIGZyb20pICYmIHBv
			c0VxKHNlbC50bywgdG8pKSByZXR1cm47CiAgICAgIGlmIChwb3NMZXNzKHRvLCBmcm9tKSkge3Zh
			ciB0bXAgPSB0bzsgdG8gPSBmcm9tOyBmcm9tID0gdG1wO30KCiAgICAgIC8vIFNraXAgb3ZlciBo
			aWRkZW4gbGluZXMuCiAgICAgIGlmIChmcm9tLmxpbmUgIT0gb2xkRnJvbSkgZnJvbSA9IHNraXBI
			aWRkZW4oZnJvbSwgb2xkRnJvbSwgc2VsLmZyb20uY2gpOwogICAgICBpZiAodG8ubGluZSAhPSBv
			bGRUbykgdG8gPSBza2lwSGlkZGVuKHRvLCBvbGRUbywgc2VsLnRvLmNoKTsKCiAgICAgIGlmIChw
			b3NFcShmcm9tLCB0bykpIHNlbC5pbnZlcnRlZCA9IGZhbHNlOwogICAgICBlbHNlIGlmIChwb3NF
			cShmcm9tLCBzZWwudG8pKSBzZWwuaW52ZXJ0ZWQgPSBmYWxzZTsKICAgICAgZWxzZSBpZiAocG9z
			RXEodG8sIHNlbC5mcm9tKSkgc2VsLmludmVydGVkID0gdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25z
			LmF1dG9DbGVhckVtcHR5TGluZXMgJiYgcG9zRXEoc2VsLmZyb20sIHNlbC50bykpIHsKICAgICAg
			ICB2YXIgaGVhZCA9IHNlbC5pbnZlcnRlZCA/IGZyb20gOiB0bzsKICAgICAgICBpZiAoaGVhZC5s
			aW5lICE9IHNlbC5mcm9tLmxpbmUpIHsKICAgICAgICAgIHZhciBvbGRMaW5lID0gZ2V0TGluZShz
			ZWwuZnJvbS5saW5lKTsKICAgICAgICAgIGlmICgvXlxzKyQvLnRlc3Qob2xkTGluZS50ZXh0KSkK
			ICAgICAgICAgICAgc2V0VGltZW91dChvcGVyYXRpb24oZnVuY3Rpb24oKSB7CiAgICAgICAgICAg
			ICAgaWYgKG9sZExpbmUucGFyZW50ICYmIC9eXHMrJC8udGVzdChvbGRMaW5lLnRleHQpKSB7CiAg
			ICAgICAgICAgICAgICB2YXIgbm8gPSBsaW5lTm8ob2xkTGluZSk7CiAgICAgICAgICAgICAgICBy
			ZXBsYWNlUmFuZ2UoIiIsIHtsaW5lOiBubywgY2g6IDB9LCB7bGluZTogbm8sIGNoOiBvbGRMaW5l
			LnRleHQubGVuZ3RofSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9LCAxMCkpOwogICAg
			ICAgIH0KICAgICAgfQoKICAgICAgc2VsLmZyb20gPSBmcm9tOyBzZWwudG8gPSB0bzsKICAgICAg
			c2VsZWN0aW9uQ2hhbmdlZCA9IHRydWU7CiAgICB9CiAgICBmdW5jdGlvbiBza2lwSGlkZGVuKHBv
			cywgb2xkTGluZSwgb2xkQ2gpIHsKICAgICAgZnVuY3Rpb24gZ2V0Tm9uSGlkZGVuKGRpcikgewog
			ICAgICAgIHZhciBsTm8gPSBwb3MubGluZSArIGRpciwgZW5kID0gZGlyID09IDEgPyBkb2Muc2l6
			ZSA6IC0xOwogICAgICAgIHdoaWxlIChsTm8gIT0gZW5kKSB7CiAgICAgICAgICB2YXIgbGluZSA9
			IGdldExpbmUobE5vKTsKICAgICAgICAgIGlmICghbGluZS5oaWRkZW4pIHsKICAgICAgICAgICAg
			dmFyIGNoID0gcG9zLmNoOwogICAgICAgICAgICBpZiAoY2ggPiBvbGRDaCB8fCBjaCA+IGxpbmUu
			dGV4dC5sZW5ndGgpIGNoID0gbGluZS50ZXh0Lmxlbmd0aDsKICAgICAgICAgICAgcmV0dXJuIHts
			aW5lOiBsTm8sIGNoOiBjaH07CiAgICAgICAgICB9CiAgICAgICAgICBsTm8gKz0gZGlyOwogICAg
			ICAgIH0KICAgICAgfQogICAgICB2YXIgbGluZSA9IGdldExpbmUocG9zLmxpbmUpOwogICAgICBp
			ZiAoIWxpbmUuaGlkZGVuKSByZXR1cm4gcG9zOwogICAgICBpZiAocG9zLmxpbmUgPj0gb2xkTGlu
			ZSkgcmV0dXJuIGdldE5vbkhpZGRlbigxKSB8fCBnZXROb25IaWRkZW4oLTEpOwogICAgICBlbHNl
			IHJldHVybiBnZXROb25IaWRkZW4oLTEpIHx8IGdldE5vbkhpZGRlbigxKTsKICAgIH0KICAgIGZ1
			bmN0aW9uIHNldEN1cnNvcihsaW5lLCBjaCwgdXNlcikgewogICAgICB2YXIgcG9zID0gY2xpcFBv
			cyh7bGluZTogbGluZSwgY2g6IGNoIHx8IDB9KTsKICAgICAgKHVzZXIgPyBzZXRTZWxlY3Rpb25V
			c2VyIDogc2V0U2VsZWN0aW9uKShwb3MsIHBvcyk7CiAgICB9CgogICAgZnVuY3Rpb24gY2xpcExp
			bmUobikge3JldHVybiBNYXRoLm1heCgwLCBNYXRoLm1pbihuLCBkb2Muc2l6ZS0xKSk7fQogICAg
			ZnVuY3Rpb24gY2xpcFBvcyhwb3MpIHsKICAgICAgaWYgKHBvcy5saW5lIDwgMCkgcmV0dXJuIHts
			aW5lOiAwLCBjaDogMH07CiAgICAgIGlmIChwb3MubGluZSA+PSBkb2Muc2l6ZSkgcmV0dXJuIHts
			aW5lOiBkb2Muc2l6ZS0xLCBjaDogZ2V0TGluZShkb2Muc2l6ZS0xKS50ZXh0Lmxlbmd0aH07CiAg
			ICAgIHZhciBjaCA9IHBvcy5jaCwgbGluZWxlbiA9IGdldExpbmUocG9zLmxpbmUpLnRleHQubGVu
			Z3RoOwogICAgICBpZiAoY2ggPT0gbnVsbCB8fCBjaCA+IGxpbmVsZW4pIHJldHVybiB7bGluZTog
			cG9zLmxpbmUsIGNoOiBsaW5lbGVufTsKICAgICAgZWxzZSBpZiAoY2ggPCAwKSByZXR1cm4ge2xp
			bmU6IHBvcy5saW5lLCBjaDogMH07CiAgICAgIGVsc2UgcmV0dXJuIHBvczsKICAgIH0KCiAgICBm
			dW5jdGlvbiBmaW5kUG9zSChkaXIsIHVuaXQpIHsKICAgICAgdmFyIGVuZCA9IHNlbC5pbnZlcnRl
			ZCA/IHNlbC5mcm9tIDogc2VsLnRvLCBsaW5lID0gZW5kLmxpbmUsIGNoID0gZW5kLmNoOwogICAg
			ICB2YXIgbGluZU9iaiA9IGdldExpbmUobGluZSk7CiAgICAgIGZ1bmN0aW9uIGZpbmROZXh0TGlu
			ZSgpIHsKICAgICAgICBmb3IgKHZhciBsID0gbGluZSArIGRpciwgZSA9IGRpciA8IDAgPyAtMSA6
			IGRvYy5zaXplOyBsICE9IGU7IGwgKz0gZGlyKSB7CiAgICAgICAgICB2YXIgbG8gPSBnZXRMaW5l
			KGwpOwogICAgICAgICAgaWYgKCFsby5oaWRkZW4pIHsgbGluZSA9IGw7IGxpbmVPYmogPSBsbzsg
			cmV0dXJuIHRydWU7IH0KICAgICAgICB9CiAgICAgIH0KICAgICAgZnVuY3Rpb24gbW92ZU9uY2Uo
			Ym91bmRUb0xpbmUpIHsKICAgICAgICBpZiAoY2ggPT0gKGRpciA8IDAgPyAwIDogbGluZU9iai50
			ZXh0Lmxlbmd0aCkpIHsKICAgICAgICAgIGlmICghYm91bmRUb0xpbmUgJiYgZmluZE5leHRMaW5l
			KCkpIGNoID0gZGlyIDwgMCA/IGxpbmVPYmoudGV4dC5sZW5ndGggOiAwOwogICAgICAgICAgZWxz
			ZSByZXR1cm4gZmFsc2U7CiAgICAgICAgfSBlbHNlIGNoICs9IGRpcjsKICAgICAgICByZXR1cm4g
			dHJ1ZTsKICAgICAgfQogICAgICBpZiAodW5pdCA9PSAiY2hhciIpIG1vdmVPbmNlKCk7CiAgICAg
			IGVsc2UgaWYgKHVuaXQgPT0gImNvbHVtbiIpIG1vdmVPbmNlKHRydWUpOwogICAgICBlbHNlIGlm
			ICh1bml0ID09ICJ3b3JkIikgewogICAgICAgIHZhciBzYXdXb3JkID0gZmFsc2U7CiAgICAgICAg
			Zm9yICg7OykgewogICAgICAgICAgaWYgKGRpciA8IDApIGlmICghbW92ZU9uY2UoKSkgYnJlYWs7
			CiAgICAgICAgICBpZiAoaXNXb3JkQ2hhcihsaW5lT2JqLnRleHQuY2hhckF0KGNoKSkpIHNhd1dv
			cmQgPSB0cnVlOwogICAgICAgICAgZWxzZSBpZiAoc2F3V29yZCkge2lmIChkaXIgPCAwKSB7ZGly
			ID0gMTsgbW92ZU9uY2UoKTt9IGJyZWFrO30KICAgICAgICAgIGlmIChkaXIgPiAwKSBpZiAoIW1v
			dmVPbmNlKCkpIGJyZWFrOwogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4ge2xpbmU6IGxp
			bmUsIGNoOiBjaH07CiAgICB9CiAgICBmdW5jdGlvbiBtb3ZlSChkaXIsIHVuaXQpIHsKICAgICAg
			dmFyIHBvcyA9IGRpciA8IDAgPyBzZWwuZnJvbSA6IHNlbC50bzsKICAgICAgaWYgKHNoaWZ0U2Vs
			ZWN0aW5nIHx8IHBvc0VxKHNlbC5mcm9tLCBzZWwudG8pKSBwb3MgPSBmaW5kUG9zSChkaXIsIHVu
			aXQpOwogICAgICBzZXRDdXJzb3IocG9zLmxpbmUsIHBvcy5jaCwgdHJ1ZSk7CiAgICB9CiAgICBm
			dW5jdGlvbiBkZWxldGVIKGRpciwgdW5pdCkgewogICAgICBpZiAoIXBvc0VxKHNlbC5mcm9tLCBz
			ZWwudG8pKSByZXBsYWNlUmFuZ2UoIiIsIHNlbC5mcm9tLCBzZWwudG8pOwogICAgICBlbHNlIGlm
			IChkaXIgPCAwKSByZXBsYWNlUmFuZ2UoIiIsIGZpbmRQb3NIKGRpciwgdW5pdCksIHNlbC50byk7
			CiAgICAgIGVsc2UgcmVwbGFjZVJhbmdlKCIiLCBzZWwuZnJvbSwgZmluZFBvc0goZGlyLCB1bml0
			KSk7CiAgICAgIHVzZXJTZWxDaGFuZ2UgPSB0cnVlOwogICAgfQogICAgdmFyIGdvYWxDb2x1bW4g
			PSBudWxsOwogICAgZnVuY3Rpb24gbW92ZVYoZGlyLCB1bml0KSB7CiAgICAgIHZhciBkaXN0ID0g
			MCwgcG9zID0gbG9jYWxDb29yZHMoc2VsLmludmVydGVkID8gc2VsLmZyb20gOiBzZWwudG8sIHRy
			dWUpOwogICAgICBpZiAoZ29hbENvbHVtbiAhPSBudWxsKSBwb3MueCA9IGdvYWxDb2x1bW47CiAg
			ICAgIGlmICh1bml0ID09ICJwYWdlIikgZGlzdCA9IE1hdGgubWluKHNjcm9sbGVyLmNsaWVudEhl
			aWdodCwgd2luZG93LmlubmVySGVpZ2h0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGll
			bnRIZWlnaHQpOwogICAgICBlbHNlIGlmICh1bml0ID09ICJsaW5lIikgZGlzdCA9IHRleHRIZWln
			aHQoKTsKICAgICAgdmFyIHRhcmdldCA9IGNvb3Jkc0NoYXIocG9zLngsIHBvcy55ICsgZGlzdCAq
			IGRpciArIDIpOwogICAgICBzZXRDdXJzb3IodGFyZ2V0LmxpbmUsIHRhcmdldC5jaCwgdHJ1ZSk7
			CiAgICAgIGdvYWxDb2x1bW4gPSBwb3MueDsKICAgIH0KCiAgICBmdW5jdGlvbiBzZWxlY3RXb3Jk
			QXQocG9zKSB7CiAgICAgIHZhciBsaW5lID0gZ2V0TGluZShwb3MubGluZSkudGV4dDsKICAgICAg
			dmFyIHN0YXJ0ID0gcG9zLmNoLCBlbmQgPSBwb3MuY2g7CiAgICAgIHdoaWxlIChzdGFydCA+IDAg
			JiYgaXNXb3JkQ2hhcihsaW5lLmNoYXJBdChzdGFydCAtIDEpKSkgLS1zdGFydDsKICAgICAgd2hp
			bGUgKGVuZCA8IGxpbmUubGVuZ3RoICYmIGlzV29yZENoYXIobGluZS5jaGFyQXQoZW5kKSkpICsr
			ZW5kOwogICAgICBzZXRTZWxlY3Rpb25Vc2VyKHtsaW5lOiBwb3MubGluZSwgY2g6IHN0YXJ0fSwg
			e2xpbmU6IHBvcy5saW5lLCBjaDogZW5kfSk7CiAgICB9CiAgICBmdW5jdGlvbiBzZWxlY3RMaW5l
			KGxpbmUpIHsKICAgICAgc2V0U2VsZWN0aW9uVXNlcih7bGluZTogbGluZSwgY2g6IDB9LCBjbGlw
			UG9zKHtsaW5lOiBsaW5lICsgMSwgY2g6IDB9KSk7CiAgICB9CiAgICBmdW5jdGlvbiBpbmRlbnRT
			ZWxlY3RlZChtb2RlKSB7CiAgICAgIGlmIChwb3NFcShzZWwuZnJvbSwgc2VsLnRvKSkgcmV0dXJu
			IGluZGVudExpbmUoc2VsLmZyb20ubGluZSwgbW9kZSk7CiAgICAgIHZhciBlID0gc2VsLnRvLmxp
			bmUgLSAoc2VsLnRvLmNoID8gMCA6IDEpOwogICAgICBmb3IgKHZhciBpID0gc2VsLmZyb20ubGlu
			ZTsgaSA8PSBlOyArK2kpIGluZGVudExpbmUoaSwgbW9kZSk7CiAgICB9CgogICAgZnVuY3Rpb24g
			aW5kZW50TGluZShuLCBob3cpIHsKICAgICAgaWYgKCFob3cpIGhvdyA9ICJhZGQiOwogICAgICBp
			ZiAoaG93ID09ICJzbWFydCIpIHsKICAgICAgICBpZiAoIW1vZGUuaW5kZW50KSBob3cgPSAicHJl
			diI7CiAgICAgICAgZWxzZSB2YXIgc3RhdGUgPSBnZXRTdGF0ZUJlZm9yZShuKTsKICAgICAgfQoK
			ICAgICAgdmFyIGxpbmUgPSBnZXRMaW5lKG4pLCBjdXJTcGFjZSA9IGxpbmUuaW5kZW50YXRpb24o
			b3B0aW9ucy50YWJTaXplKSwKICAgICAgICAgIGN1clNwYWNlU3RyaW5nID0gbGluZS50ZXh0Lm1h
			dGNoKC9eXHMqLylbMF0sIGluZGVudGF0aW9uOwogICAgICBpZiAoaG93ID09ICJwcmV2Iikgewog
			ICAgICAgIGlmIChuKSBpbmRlbnRhdGlvbiA9IGdldExpbmUobi0xKS5pbmRlbnRhdGlvbihvcHRp
			b25zLnRhYlNpemUpOwogICAgICAgIGVsc2UgaW5kZW50YXRpb24gPSAwOwogICAgICB9CiAgICAg
			IGVsc2UgaWYgKGhvdyA9PSAic21hcnQiKSBpbmRlbnRhdGlvbiA9IG1vZGUuaW5kZW50KHN0YXRl
			LCBsaW5lLnRleHQuc2xpY2UoY3VyU3BhY2VTdHJpbmcubGVuZ3RoKSwgbGluZS50ZXh0KTsKICAg
			ICAgZWxzZSBpZiAoaG93ID09ICJhZGQiKSBpbmRlbnRhdGlvbiA9IGN1clNwYWNlICsgb3B0aW9u
			cy5pbmRlbnRVbml0OwogICAgICBlbHNlIGlmIChob3cgPT0gInN1YnRyYWN0IikgaW5kZW50YXRp
			b24gPSBjdXJTcGFjZSAtIG9wdGlvbnMuaW5kZW50VW5pdDsKICAgICAgaW5kZW50YXRpb24gPSBN
			YXRoLm1heCgwLCBpbmRlbnRhdGlvbik7CiAgICAgIHZhciBkaWZmID0gaW5kZW50YXRpb24gLSBj
			dXJTcGFjZTsKCiAgICAgIGlmICghZGlmZikgewogICAgICAgIGlmIChzZWwuZnJvbS5saW5lICE9
			IG4gJiYgc2VsLnRvLmxpbmUgIT0gbikgcmV0dXJuOwogICAgICAgIHZhciBpbmRlbnRTdHJpbmcg
			PSBjdXJTcGFjZVN0cmluZzsKICAgICAgfQogICAgICBlbHNlIHsKICAgICAgICB2YXIgaW5kZW50
			U3RyaW5nID0gIiIsIHBvcyA9IDA7CiAgICAgICAgaWYgKG9wdGlvbnMuaW5kZW50V2l0aFRhYnMp
			CiAgICAgICAgICBmb3IgKHZhciBpID0gTWF0aC5mbG9vcihpbmRlbnRhdGlvbiAvIG9wdGlvbnMu
			dGFiU2l6ZSk7IGk7IC0taSkge3BvcyArPSBvcHRpb25zLnRhYlNpemU7IGluZGVudFN0cmluZyAr
			PSAiXHQiO30KICAgICAgICB3aGlsZSAocG9zIDwgaW5kZW50YXRpb24pIHsrK3BvczsgaW5kZW50
			U3RyaW5nICs9ICIgIjt9CiAgICAgIH0KCiAgICAgIHJlcGxhY2VSYW5nZShpbmRlbnRTdHJpbmcs
			IHtsaW5lOiBuLCBjaDogMH0sIHtsaW5lOiBuLCBjaDogY3VyU3BhY2VTdHJpbmcubGVuZ3RofSk7
			CiAgICB9CgogICAgZnVuY3Rpb24gbG9hZE1vZGUoKSB7CiAgICAgIG1vZGUgPSBDb2RlTWlycm9y
			LmdldE1vZGUob3B0aW9ucywgb3B0aW9ucy5tb2RlKTsKICAgICAgZG9jLml0ZXIoMCwgZG9jLnNp
			emUsIGZ1bmN0aW9uKGxpbmUpIHsgbGluZS5zdGF0ZUFmdGVyID0gbnVsbDsgfSk7CiAgICAgIHdv
			cmsgPSBbMF07CiAgICAgIHN0YXJ0V29ya2VyKCk7CiAgICB9CiAgICBmdW5jdGlvbiBndXR0ZXJD
			aGFuZ2VkKCkgewogICAgICB2YXIgdmlzaWJsZSA9IG9wdGlvbnMuZ3V0dGVyIHx8IG9wdGlvbnMu
			bGluZU51bWJlcnM7CiAgICAgIGd1dHRlci5zdHlsZS5kaXNwbGF5ID0gdmlzaWJsZSA/ICIiIDog
			Im5vbmUiOwogICAgICBpZiAodmlzaWJsZSkgZ3V0dGVyRGlydHkgPSB0cnVlOwogICAgICBlbHNl
			IGxpbmVEaXYucGFyZW50Tm9kZS5zdHlsZS5tYXJnaW5MZWZ0ID0gMDsKICAgIH0KICAgIGZ1bmN0
			aW9uIHdyYXBwaW5nQ2hhbmdlZChmcm9tLCB0bykgewogICAgICBpZiAob3B0aW9ucy5saW5lV3Jh
			cHBpbmcpIHsKICAgICAgICB3cmFwcGVyLmNsYXNzTmFtZSArPSAiIENvZGVNaXJyb3Itd3JhcCI7
			CiAgICAgICAgdmFyIHBlckxpbmUgPSBzY3JvbGxlci5jbGllbnRXaWR0aCAvIGNoYXJXaWR0aCgp
			IC0gMzsKICAgICAgICBkb2MuaXRlcigwLCBkb2Muc2l6ZSwgZnVuY3Rpb24obGluZSkgewogICAg
			ICAgICAgaWYgKGxpbmUuaGlkZGVuKSByZXR1cm47CiAgICAgICAgICB2YXIgZ3Vlc3MgPSBNYXRo
			LmNlaWwobGluZS50ZXh0Lmxlbmd0aCAvIHBlckxpbmUpIHx8IDE7CiAgICAgICAgICBpZiAoZ3Vl
			c3MgIT0gMSkgdXBkYXRlTGluZUhlaWdodChsaW5lLCBndWVzcyk7CiAgICAgICAgfSk7CiAgICAg
			ICAgbGluZVNwYWNlLnN0eWxlLndpZHRoID0gY29kZS5zdHlsZS53aWR0aCA9ICIiOwogICAgICB9
			IGVsc2UgewogICAgICAgIHdyYXBwZXIuY2xhc3NOYW1lID0gd3JhcHBlci5jbGFzc05hbWUucmVw
			bGFjZSgiIENvZGVNaXJyb3Itd3JhcCIsICIiKTsKICAgICAgICBtYXhXaWR0aCA9IG51bGw7IG1h
			eExpbmUgPSAiIjsKICAgICAgICBkb2MuaXRlcigwLCBkb2Muc2l6ZSwgZnVuY3Rpb24obGluZSkg
			ewogICAgICAgICAgaWYgKGxpbmUuaGVpZ2h0ICE9IDEgJiYgIWxpbmUuaGlkZGVuKSB1cGRhdGVM
			aW5lSGVpZ2h0KGxpbmUsIDEpOwogICAgICAgICAgaWYgKGxpbmUudGV4dC5sZW5ndGggPiBtYXhM
			aW5lLmxlbmd0aCkgbWF4TGluZSA9IGxpbmUudGV4dDsKICAgICAgICB9KTsKICAgICAgfQogICAg
			ICBjaGFuZ2VzLnB1c2goe2Zyb206IDAsIHRvOiBkb2Muc2l6ZX0pOwogICAgfQogICAgZnVuY3Rp
			b24gbWFrZVRhYihjb2wpIHsKICAgICAgdmFyIHcgPSBvcHRpb25zLnRhYlNpemUgLSBjb2wgJSBv
			cHRpb25zLnRhYlNpemU7CiAgICAgIGZvciAodmFyIHN0ciA9ICc8c3BhbiBjbGFzcz0iY20tdGFi
			Ij4nLCBpID0gMDsgaSA8IHc7ICsraSkgc3RyICs9ICIgIjsKICAgICAgcmV0dXJuIHtodG1sOiBz
			dHIgKyAiPC9zcGFuPiIsIHdpZHRoOiB3fTsKICAgIH0KICAgIGZ1bmN0aW9uIHRoZW1lQ2hhbmdl
			ZCgpIHsKICAgICAgc2Nyb2xsZXIuY2xhc3NOYW1lID0gc2Nyb2xsZXIuY2xhc3NOYW1lLnJlcGxh
			Y2UoL1xzKmNtLXMtXHcrL2csICIiKSArCiAgICAgICAgb3B0aW9ucy50aGVtZS5yZXBsYWNlKC8o
			XnxccylccyovZywgIiBjbS1zLSIpOwogICAgfQoKICAgIGZ1bmN0aW9uIFRleHRNYXJrZXIoKSB7
			IHRoaXMuc2V0ID0gW107IH0KICAgIFRleHRNYXJrZXIucHJvdG90eXBlLmNsZWFyID0gb3BlcmF0
			aW9uKGZ1bmN0aW9uKCkgewogICAgICB2YXIgbWluID0gSW5maW5pdHksIG1heCA9IC1JbmZpbml0
			eTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGUgPSB0aGlzLnNldC5sZW5ndGg7IGkgPCBlOyArK2kp
			IHsKICAgICAgICB2YXIgbGluZSA9IHRoaXMuc2V0W2ldLCBtayA9IGxpbmUubWFya2VkOwogICAg
			ICAgIGlmICghbWsgfHwgIWxpbmUucGFyZW50KSBjb250aW51ZTsKICAgICAgICB2YXIgbGluZU4g
			PSBsaW5lTm8obGluZSk7CiAgICAgICAgbWluID0gTWF0aC5taW4obWluLCBsaW5lTik7IG1heCA9
			IE1hdGgubWF4KG1heCwgbGluZU4pOwogICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbWsubGVu
			Z3RoOyArK2opCiAgICAgICAgICBpZiAobWtbal0uc2V0ID09IHRoaXMuc2V0KSBtay5zcGxpY2Uo
			ai0tLCAxKTsKICAgICAgfQogICAgICBpZiAobWluICE9IEluZmluaXR5KQogICAgICAgIGNoYW5n
			ZXMucHVzaCh7ZnJvbTogbWluLCB0bzogbWF4ICsgMX0pOwogICAgfSk7CiAgICBUZXh0TWFya2Vy
			LnByb3RvdHlwZS5maW5kID0gZnVuY3Rpb24oKSB7CiAgICAgIHZhciBmcm9tLCB0bzsKICAgICAg
			Zm9yICh2YXIgaSA9IDAsIGUgPSB0aGlzLnNldC5sZW5ndGg7IGkgPCBlOyArK2kpIHsKICAgICAg
			ICB2YXIgbGluZSA9IHRoaXMuc2V0W2ldLCBtayA9IGxpbmUubWFya2VkOwogICAgICAgIGZvciAo
			dmFyIGogPSAwOyBqIDwgbWsubGVuZ3RoOyArK2opIHsKICAgICAgICAgIHZhciBtYXJrID0gbWtb
			al07CiAgICAgICAgICBpZiAobWFyay5zZXQgPT0gdGhpcy5zZXQpIHsKICAgICAgICAgICAgaWYg
			KG1hcmsuZnJvbSAhPSBudWxsIHx8IG1hcmsudG8gIT0gbnVsbCkgewogICAgICAgICAgICAgIHZh
			ciBmb3VuZCA9IGxpbmVObyhsaW5lKTsKICAgICAgICAgICAgICBpZiAoZm91bmQgIT0gbnVsbCkg
			ewogICAgICAgICAgICAgICAgaWYgKG1hcmsuZnJvbSAhPSBudWxsKSBmcm9tID0ge2xpbmU6IGZv
			dW5kLCBjaDogbWFyay5mcm9tfTsKICAgICAgICAgICAgICAgIGlmIChtYXJrLnRvICE9IG51bGwp
			IHRvID0ge2xpbmU6IGZvdW5kLCBjaDogbWFyay50b307CiAgICAgICAgICAgICAgfQogICAgICAg
			ICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiB7ZnJvbTog
			ZnJvbSwgdG86IHRvfTsKICAgIH07CgogICAgZnVuY3Rpb24gbWFya1RleHQoZnJvbSwgdG8sIGNs
			YXNzTmFtZSkgewogICAgICBmcm9tID0gY2xpcFBvcyhmcm9tKTsgdG8gPSBjbGlwUG9zKHRvKTsK
			ICAgICAgdmFyIHRtID0gbmV3IFRleHRNYXJrZXIoKTsKICAgICAgZnVuY3Rpb24gYWRkKGxpbmUs
			IGZyb20sIHRvLCBjbGFzc05hbWUpIHsKICAgICAgICBnZXRMaW5lKGxpbmUpLmFkZE1hcmsobmV3
			IE1hcmtlZFRleHQoZnJvbSwgdG8sIGNsYXNzTmFtZSwgdG0uc2V0KSk7CiAgICAgIH0KICAgICAg
			aWYgKGZyb20ubGluZSA9PSB0by5saW5lKSBhZGQoZnJvbS5saW5lLCBmcm9tLmNoLCB0by5jaCwg
			Y2xhc3NOYW1lKTsKICAgICAgZWxzZSB7CiAgICAgICAgYWRkKGZyb20ubGluZSwgZnJvbS5jaCwg
			bnVsbCwgY2xhc3NOYW1lKTsKICAgICAgICBmb3IgKHZhciBpID0gZnJvbS5saW5lICsgMSwgZSA9
			IHRvLmxpbmU7IGkgPCBlOyArK2kpCiAgICAgICAgICBhZGQoaSwgbnVsbCwgbnVsbCwgY2xhc3NO
			YW1lKTsKICAgICAgICBhZGQodG8ubGluZSwgbnVsbCwgdG8uY2gsIGNsYXNzTmFtZSk7CiAgICAg
			IH0KICAgICAgY2hhbmdlcy5wdXNoKHtmcm9tOiBmcm9tLmxpbmUsIHRvOiB0by5saW5lICsgMX0p
			OwogICAgICByZXR1cm4gdG07CiAgICB9CgogICAgZnVuY3Rpb24gc2V0Qm9va21hcmsocG9zKSB7
			CiAgICAgIHBvcyA9IGNsaXBQb3MocG9zKTsKICAgICAgdmFyIGJtID0gbmV3IEJvb2ttYXJrKHBv
			cy5jaCk7CiAgICAgIGdldExpbmUocG9zLmxpbmUpLmFkZE1hcmsoYm0pOwogICAgICByZXR1cm4g
			Ym07CiAgICB9CgogICAgZnVuY3Rpb24gYWRkR3V0dGVyTWFya2VyKGxpbmUsIHRleHQsIGNsYXNz
			TmFtZSkgewogICAgICBpZiAodHlwZW9mIGxpbmUgPT0gIm51bWJlciIpIGxpbmUgPSBnZXRMaW5l
			KGNsaXBMaW5lKGxpbmUpKTsKICAgICAgbGluZS5ndXR0ZXJNYXJrZXIgPSB7dGV4dDogdGV4dCwg
			c3R5bGU6IGNsYXNzTmFtZX07CiAgICAgIGd1dHRlckRpcnR5ID0gdHJ1ZTsKICAgICAgcmV0dXJu
			IGxpbmU7CiAgICB9CiAgICBmdW5jdGlvbiByZW1vdmVHdXR0ZXJNYXJrZXIobGluZSkgewogICAg
			ICBpZiAodHlwZW9mIGxpbmUgPT0gIm51bWJlciIpIGxpbmUgPSBnZXRMaW5lKGNsaXBMaW5lKGxp
			bmUpKTsKICAgICAgbGluZS5ndXR0ZXJNYXJrZXIgPSBudWxsOwogICAgICBndXR0ZXJEaXJ0eSA9
			IHRydWU7CiAgICB9CgogICAgZnVuY3Rpb24gY2hhbmdlTGluZShoYW5kbGUsIG9wKSB7CiAgICAg
			IHZhciBubyA9IGhhbmRsZSwgbGluZSA9IGhhbmRsZTsKICAgICAgaWYgKHR5cGVvZiBoYW5kbGUg
			PT0gIm51bWJlciIpIGxpbmUgPSBnZXRMaW5lKGNsaXBMaW5lKGhhbmRsZSkpOwogICAgICBlbHNl
			IG5vID0gbGluZU5vKGhhbmRsZSk7CiAgICAgIGlmIChubyA9PSBudWxsKSByZXR1cm4gbnVsbDsK
			ICAgICAgaWYgKG9wKGxpbmUsIG5vKSkgY2hhbmdlcy5wdXNoKHtmcm9tOiBubywgdG86IG5vICsg
			MX0pOwogICAgICBlbHNlIHJldHVybiBudWxsOwogICAgICByZXR1cm4gbGluZTsKICAgIH0KICAg
			IGZ1bmN0aW9uIHNldExpbmVDbGFzcyhoYW5kbGUsIGNsYXNzTmFtZSkgewogICAgICByZXR1cm4g
			Y2hhbmdlTGluZShoYW5kbGUsIGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICBpZiAobGluZS5jbGFz
			c05hbWUgIT0gY2xhc3NOYW1lKSB7CiAgICAgICAgICBsaW5lLmNsYXNzTmFtZSA9IGNsYXNzTmFt
			ZTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CiAgICBm
			dW5jdGlvbiBzZXRMaW5lSGlkZGVuKGhhbmRsZSwgaGlkZGVuKSB7CiAgICAgIHJldHVybiBjaGFu
			Z2VMaW5lKGhhbmRsZSwgZnVuY3Rpb24obGluZSwgbm8pIHsKICAgICAgICBpZiAobGluZS5oaWRk
			ZW4gIT0gaGlkZGVuKSB7CiAgICAgICAgICBsaW5lLmhpZGRlbiA9IGhpZGRlbjsKICAgICAgICAg
			IHVwZGF0ZUxpbmVIZWlnaHQobGluZSwgaGlkZGVuID8gMCA6IDEpOwogICAgICAgICAgdmFyIGZs
			aW5lID0gc2VsLmZyb20ubGluZSwgdGxpbmUgPSBzZWwudG8ubGluZTsKICAgICAgICAgIGlmICho
			aWRkZW4gJiYgKGZsaW5lID09IG5vIHx8IHRsaW5lID09IG5vKSkgewogICAgICAgICAgICB2YXIg
			ZnJvbSA9IGZsaW5lID09IG5vID8gc2tpcEhpZGRlbih7bGluZTogZmxpbmUsIGNoOiAwfSwgZmxp
			bmUsIDApIDogc2VsLmZyb207CiAgICAgICAgICAgIHZhciB0byA9IHRsaW5lID09IG5vID8gc2tp
			cEhpZGRlbih7bGluZTogdGxpbmUsIGNoOiAwfSwgdGxpbmUsIDApIDogc2VsLnRvOwogICAgICAg
			ICAgICBzZXRTZWxlY3Rpb24oZnJvbSwgdG8pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJu
			IChndXR0ZXJEaXJ0eSA9IHRydWUpOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9CgogICAgZnVu
			Y3Rpb24gbGluZUluZm8obGluZSkgewogICAgICBpZiAodHlwZW9mIGxpbmUgPT0gIm51bWJlciIp
			IHsKICAgICAgICBpZiAoIWlzTGluZShsaW5lKSkgcmV0dXJuIG51bGw7CiAgICAgICAgdmFyIG4g
			PSBsaW5lOwogICAgICAgIGxpbmUgPSBnZXRMaW5lKGxpbmUpOwogICAgICAgIGlmICghbGluZSkg
			cmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAgZWxzZSB7CiAgICAgICAgdmFyIG4gPSBsaW5lTm8o
			bGluZSk7CiAgICAgICAgaWYgKG4gPT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgICAgIH0KICAgICAg
			dmFyIG1hcmtlciA9IGxpbmUuZ3V0dGVyTWFya2VyOwogICAgICByZXR1cm4ge2xpbmU6IG4sIGhh
			bmRsZTogbGluZSwgdGV4dDogbGluZS50ZXh0LCBtYXJrZXJUZXh0OiBtYXJrZXIgJiYgbWFya2Vy
			LnRleHQsCiAgICAgICAgICAgICAgbWFya2VyQ2xhc3M6IG1hcmtlciAmJiBtYXJrZXIuc3R5bGUs
			IGxpbmVDbGFzczogbGluZS5jbGFzc05hbWV9OwogICAgfQoKICAgIGZ1bmN0aW9uIHN0cmluZ1dp
			ZHRoKHN0cikgewogICAgICBtZWFzdXJlLmlubmVySFRNTCA9ICI8cHJlPjxzcGFuPng8L3NwYW4+
			PC9wcmU+IjsKICAgICAgbWVhc3VyZS5maXJzdENoaWxkLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5u
			b2RlVmFsdWUgPSBzdHI7CiAgICAgIHJldHVybiBtZWFzdXJlLmZpcnN0Q2hpbGQuZmlyc3RDaGls
			ZC5vZmZzZXRXaWR0aCB8fCAxMDsKICAgIH0KICAgIC8vIFRoZXNlIGFyZSB1c2VkIHRvIGdvIGZy
			b20gcGl4ZWwgcG9zaXRpb25zIHRvIGNoYXJhY3RlcgogICAgLy8gcG9zaXRpb25zLCB0YWtpbmcg
			dmFyeWluZyBjaGFyYWN0ZXIgd2lkdGhzIGludG8gYWNjb3VudC4KICAgIGZ1bmN0aW9uIGNoYXJG
			cm9tWChsaW5lLCB4KSB7CiAgICAgIGlmICh4IDw9IDApIHJldHVybiAwOwogICAgICB2YXIgbGlu
			ZU9iaiA9IGdldExpbmUobGluZSksIHRleHQgPSBsaW5lT2JqLnRleHQ7CiAgICAgIGZ1bmN0aW9u
			IGdldFgobGVuKSB7CiAgICAgICAgbWVhc3VyZS5pbm5lckhUTUwgPSAiPHByZT48c3Bhbj4iICsg
			bGluZU9iai5nZXRIVE1MKG1ha2VUYWIsIGxlbikgKyAiPC9zcGFuPjwvcHJlPiI7CiAgICAgICAg
			cmV0dXJuIG1lYXN1cmUuZmlyc3RDaGlsZC5maXJzdENoaWxkLm9mZnNldFdpZHRoOwogICAgICB9
			CiAgICAgIHZhciBmcm9tID0gMCwgZnJvbVggPSAwLCB0byA9IHRleHQubGVuZ3RoLCB0b1g7CiAg
			ICAgIC8vIEd1ZXNzIGEgc3VpdGFibGUgdXBwZXIgYm91bmQgZm9yIG91ciBzZWFyY2guCiAgICAg
			IHZhciBlc3RpbWF0ZWQgPSBNYXRoLm1pbih0bywgTWF0aC5jZWlsKHggLyBjaGFyV2lkdGgoKSkp
			OwogICAgICBmb3IgKDs7KSB7CiAgICAgICAgdmFyIGVzdFggPSBnZXRYKGVzdGltYXRlZCk7CiAg
			ICAgICAgaWYgKGVzdFggPD0geCAmJiBlc3RpbWF0ZWQgPCB0bykgZXN0aW1hdGVkID0gTWF0aC5t
			aW4odG8sIE1hdGguY2VpbChlc3RpbWF0ZWQgKiAxLjIpKTsKICAgICAgICBlbHNlIHt0b1ggPSBl
			c3RYOyB0byA9IGVzdGltYXRlZDsgYnJlYWs7fQogICAgICB9CiAgICAgIGlmICh4ID4gdG9YKSBy
			ZXR1cm4gdG87CiAgICAgIC8vIFRyeSB0byBndWVzcyBhIHN1aXRhYmxlIGxvd2VyIGJvdW5kIGFz
			IHdlbGwuCiAgICAgIGVzdGltYXRlZCA9IE1hdGguZmxvb3IodG8gKiAwLjgpOyBlc3RYID0gZ2V0
			WChlc3RpbWF0ZWQpOwogICAgICBpZiAoZXN0WCA8IHgpIHtmcm9tID0gZXN0aW1hdGVkOyBmcm9t
			WCA9IGVzdFg7fQogICAgICAvLyBEbyBhIGJpbmFyeSBzZWFyY2ggYmV0d2VlbiB0aGVzZSBib3Vu
			ZHMuCiAgICAgIGZvciAoOzspIHsKICAgICAgICBpZiAodG8gLSBmcm9tIDw9IDEpIHJldHVybiAo
			dG9YIC0geCA+IHggLSBmcm9tWCkgPyBmcm9tIDogdG87CiAgICAgICAgdmFyIG1pZGRsZSA9IE1h
			dGguY2VpbCgoZnJvbSArIHRvKSAvIDIpLCBtaWRkbGVYID0gZ2V0WChtaWRkbGUpOwogICAgICAg
			IGlmIChtaWRkbGVYID4geCkge3RvID0gbWlkZGxlOyB0b1ggPSBtaWRkbGVYO30KICAgICAgICBl
			bHNlIHtmcm9tID0gbWlkZGxlOyBmcm9tWCA9IG1pZGRsZVg7fQogICAgICB9CiAgICB9CgogICAg
			dmFyIHRlbXBJZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmKS50b1N0cmlu
			ZygxNik7CiAgICBmdW5jdGlvbiBtZWFzdXJlTGluZShsaW5lLCBjaCkgewogICAgICBpZiAoY2gg
			PT0gMCkgcmV0dXJuIHt0b3A6IDAsIGxlZnQ6IDB9OwogICAgICB2YXIgZXh0cmEgPSAiIjsKICAg
			ICAgLy8gSW5jbHVkZSBleHRyYSB0ZXh0IGF0IHRoZSBlbmQgdG8gbWFrZSBzdXJlIHRoZSBtZWFz
			dXJlZCBsaW5lIGlzIHdyYXBwZWQgaW4gdGhlIHJpZ2h0IHdheS4KICAgICAgaWYgKG9wdGlvbnMu
			bGluZVdyYXBwaW5nKSB7CiAgICAgICAgdmFyIGVuZCA9IGxpbmUudGV4dC5pbmRleE9mKCIgIiwg
			Y2ggKyAyKTsKICAgICAgICBleHRyYSA9IGh0bWxFc2NhcGUobGluZS50ZXh0LnNsaWNlKGNoICsg
			MSwgZW5kIDwgMCA/IGxpbmUudGV4dC5sZW5ndGggOiBlbmQgKyAoaWUgPyA1IDogMCkpKTsKICAg
			ICAgfQogICAgICBtZWFzdXJlLmlubmVySFRNTCA9ICI8cHJlPiIgKyBsaW5lLmdldEhUTUwobWFr
			ZVRhYiwgY2gpICsKICAgICAgICAnPHNwYW4gaWQ9IkNvZGVNaXJyb3ItdGVtcC0nICsgdGVtcElk
			ICsgJyI+JyArIGh0bWxFc2NhcGUobGluZS50ZXh0LmNoYXJBdChjaCkgfHwgIiAiKSArICI8L3Nw
			YW4+IiArCiAgICAgICAgZXh0cmEgKyAiPC9wcmU+IjsKICAgICAgdmFyIGVsdCA9IGRvY3VtZW50
			LmdldEVsZW1lbnRCeUlkKCJDb2RlTWlycm9yLXRlbXAtIiArIHRlbXBJZCk7CiAgICAgIHZhciB0
			b3AgPSBlbHQub2Zmc2V0VG9wLCBsZWZ0ID0gZWx0Lm9mZnNldExlZnQ7CiAgICAgIC8vIE9sZGVy
			IElFcyByZXBvcnQgemVybyBvZmZzZXRzIGZvciBzcGFucyBkaXJlY3RseSBhZnRlciBhIHdyYXAK
			ICAgICAgaWYgKGllICYmIHRvcCA9PSAwICYmIGxlZnQgPT0gMCkgewogICAgICAgIHZhciBiYWNr
			dXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzcGFuIik7CiAgICAgICAgYmFja3VwLmlubmVy
			SFRNTCA9ICJ4IjsKICAgICAgICBlbHQucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoYmFja3VwLCBl
			bHQubmV4dFNpYmxpbmcpOwogICAgICAgIHRvcCA9IGJhY2t1cC5vZmZzZXRUb3A7CiAgICAgIH0K
			ICAgICAgcmV0dXJuIHt0b3A6IHRvcCwgbGVmdDogbGVmdH07CiAgICB9CiAgICBmdW5jdGlvbiBs
			b2NhbENvb3Jkcyhwb3MsIGluTGluZVdyYXApIHsKICAgICAgdmFyIHgsIGxoID0gdGV4dEhlaWdo
			dCgpLCB5ID0gbGggKiAoaGVpZ2h0QXRMaW5lKGRvYywgcG9zLmxpbmUpIC0gKGluTGluZVdyYXAg
			PyBkaXNwbGF5T2Zmc2V0IDogMCkpOwogICAgICBpZiAocG9zLmNoID09IDApIHggPSAwOwogICAg
			ICBlbHNlIHsKICAgICAgICB2YXIgc3AgPSBtZWFzdXJlTGluZShnZXRMaW5lKHBvcy5saW5lKSwg
			cG9zLmNoKTsKICAgICAgICB4ID0gc3AubGVmdDsKICAgICAgICBpZiAob3B0aW9ucy5saW5lV3Jh
			cHBpbmcpIHkgKz0gTWF0aC5tYXgoMCwgc3AudG9wKTsKICAgICAgfQogICAgICByZXR1cm4ge3g6
			IHgsIHk6IHksIHlCb3Q6IHkgKyBsaH07CiAgICB9CiAgICAvLyBDb29yZHMgbXVzdCBiZSBsaW5l
			U3BhY2UtbG9jYWwKICAgIGZ1bmN0aW9uIGNvb3Jkc0NoYXIoeCwgeSkgewogICAgICBpZiAoeSA8
			IDApIHkgPSAwOwogICAgICB2YXIgdGggPSB0ZXh0SGVpZ2h0KCksIGN3ID0gY2hhcldpZHRoKCks
			IGhlaWdodFBvcyA9IGRpc3BsYXlPZmZzZXQgKyBNYXRoLmZsb29yKHkgLyB0aCk7CiAgICAgIHZh
			ciBsaW5lTm8gPSBsaW5lQXRIZWlnaHQoZG9jLCBoZWlnaHRQb3MpOwogICAgICBpZiAobGluZU5v
			ID49IGRvYy5zaXplKSByZXR1cm4ge2xpbmU6IGRvYy5zaXplIC0gMSwgY2g6IGdldExpbmUoZG9j
			LnNpemUgLSAxKS50ZXh0Lmxlbmd0aH07CiAgICAgIHZhciBsaW5lT2JqID0gZ2V0TGluZShsaW5l
			Tm8pLCB0ZXh0ID0gbGluZU9iai50ZXh0OwogICAgICB2YXIgdHcgPSBvcHRpb25zLmxpbmVXcmFw
			cGluZywgaW5uZXJPZmYgPSB0dyA/IGhlaWdodFBvcyAtIGhlaWdodEF0TGluZShkb2MsIGxpbmVO
			bykgOiAwOwogICAgICBpZiAoeCA8PSAwICYmIGlubmVyT2ZmID09IDApIHJldHVybiB7bGluZTog
			bGluZU5vLCBjaDogMH07CiAgICAgIGZ1bmN0aW9uIGdldFgobGVuKSB7CiAgICAgICAgdmFyIHNw
			ID0gbWVhc3VyZUxpbmUobGluZU9iaiwgbGVuKTsKICAgICAgICBpZiAodHcpIHsKICAgICAgICAg
			IHZhciBvZmYgPSBNYXRoLnJvdW5kKHNwLnRvcCAvIHRoKTsKICAgICAgICAgIHJldHVybiBNYXRo
			Lm1heCgwLCBzcC5sZWZ0ICsgKG9mZiAtIGlubmVyT2ZmKSAqIHNjcm9sbGVyLmNsaWVudFdpZHRo
			KTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHNwLmxlZnQ7CiAgICAgIH0KICAgICAgdmFyIGZy
			b20gPSAwLCBmcm9tWCA9IDAsIHRvID0gdGV4dC5sZW5ndGgsIHRvWDsKICAgICAgLy8gR3Vlc3Mg
			YSBzdWl0YWJsZSB1cHBlciBib3VuZCBmb3Igb3VyIHNlYXJjaC4KICAgICAgdmFyIGVzdGltYXRl
			ZCA9IE1hdGgubWluKHRvLCBNYXRoLmNlaWwoKHggKyBpbm5lck9mZiAqIHNjcm9sbGVyLmNsaWVu
			dFdpZHRoICogLjkpIC8gY3cpKTsKICAgICAgZm9yICg7OykgewogICAgICAgIHZhciBlc3RYID0g
			Z2V0WChlc3RpbWF0ZWQpOwogICAgICAgIGlmIChlc3RYIDw9IHggJiYgZXN0aW1hdGVkIDwgdG8p
			IGVzdGltYXRlZCA9IE1hdGgubWluKHRvLCBNYXRoLmNlaWwoZXN0aW1hdGVkICogMS4yKSk7CiAg
			ICAgICAgZWxzZSB7dG9YID0gZXN0WDsgdG8gPSBlc3RpbWF0ZWQ7IGJyZWFrO30KICAgICAgfQog
			ICAgICBpZiAoeCA+IHRvWCkgcmV0dXJuIHtsaW5lOiBsaW5lTm8sIGNoOiB0b307CiAgICAgIC8v
			IFRyeSB0byBndWVzcyBhIHN1aXRhYmxlIGxvd2VyIGJvdW5kIGFzIHdlbGwuCiAgICAgIGVzdGlt
			YXRlZCA9IE1hdGguZmxvb3IodG8gKiAwLjgpOyBlc3RYID0gZ2V0WChlc3RpbWF0ZWQpOwogICAg
			ICBpZiAoZXN0WCA8IHgpIHtmcm9tID0gZXN0aW1hdGVkOyBmcm9tWCA9IGVzdFg7fQogICAgICAv
			LyBEbyBhIGJpbmFyeSBzZWFyY2ggYmV0d2VlbiB0aGVzZSBib3VuZHMuCiAgICAgIGZvciAoOzsp
			IHsKICAgICAgICBpZiAodG8gLSBmcm9tIDw9IDEpIHJldHVybiB7bGluZTogbGluZU5vLCBjaDog
			KHRvWCAtIHggPiB4IC0gZnJvbVgpID8gZnJvbSA6IHRvfTsKICAgICAgICB2YXIgbWlkZGxlID0g
			TWF0aC5jZWlsKChmcm9tICsgdG8pIC8gMiksIG1pZGRsZVggPSBnZXRYKG1pZGRsZSk7CiAgICAg
			ICAgaWYgKG1pZGRsZVggPiB4KSB7dG8gPSBtaWRkbGU7IHRvWCA9IG1pZGRsZVg7fQogICAgICAg
			IGVsc2Uge2Zyb20gPSBtaWRkbGU7IGZyb21YID0gbWlkZGxlWDt9CiAgICAgIH0KICAgIH0KICAg
			IGZ1bmN0aW9uIHBhZ2VDb29yZHMocG9zKSB7CiAgICAgIHZhciBsb2NhbCA9IGxvY2FsQ29vcmRz
			KHBvcywgdHJ1ZSksIG9mZiA9IGVsdE9mZnNldChsaW5lU3BhY2UpOwogICAgICByZXR1cm4ge3g6
			IG9mZi5sZWZ0ICsgbG9jYWwueCwgeTogb2ZmLnRvcCArIGxvY2FsLnksIHlCb3Q6IG9mZi50b3Ag
			KyBsb2NhbC55Qm90fTsKICAgIH0KCiAgICB2YXIgY2FjaGVkSGVpZ2h0LCBjYWNoZWRIZWlnaHRG
			b3IsIG1lYXN1cmVUZXh0OwogICAgZnVuY3Rpb24gdGV4dEhlaWdodCgpIHsKICAgICAgaWYgKG1l
			YXN1cmVUZXh0ID09IG51bGwpIHsKICAgICAgICBtZWFzdXJlVGV4dCA9ICI8cHJlPiI7CiAgICAg
			ICAgZm9yICh2YXIgaSA9IDA7IGkgPCA0OTsgKytpKSBtZWFzdXJlVGV4dCArPSAieDxici8+IjsK
			ICAgICAgICBtZWFzdXJlVGV4dCArPSAieDwvcHJlPiI7CiAgICAgIH0KICAgICAgdmFyIG9mZnNl
			dEhlaWdodCA9IGxpbmVEaXYuY2xpZW50SGVpZ2h0OwogICAgICBpZiAob2Zmc2V0SGVpZ2h0ID09
			IGNhY2hlZEhlaWdodEZvcikgcmV0dXJuIGNhY2hlZEhlaWdodDsKICAgICAgY2FjaGVkSGVpZ2h0
			Rm9yID0gb2Zmc2V0SGVpZ2h0OwogICAgICBtZWFzdXJlLmlubmVySFRNTCA9IG1lYXN1cmVUZXh0
			OwogICAgICBjYWNoZWRIZWlnaHQgPSBtZWFzdXJlLmZpcnN0Q2hpbGQub2Zmc2V0SGVpZ2h0IC8g
			NTAgfHwgMTsKICAgICAgbWVhc3VyZS5pbm5lckhUTUwgPSAiIjsKICAgICAgcmV0dXJuIGNhY2hl
			ZEhlaWdodDsKICAgIH0KICAgIHZhciBjYWNoZWRXaWR0aCwgY2FjaGVkV2lkdGhGb3IgPSAwOwog
			ICAgZnVuY3Rpb24gY2hhcldpZHRoKCkgewogICAgICBpZiAoc2Nyb2xsZXIuY2xpZW50V2lkdGgg
			PT0gY2FjaGVkV2lkdGhGb3IpIHJldHVybiBjYWNoZWRXaWR0aDsKICAgICAgY2FjaGVkV2lkdGhG
			b3IgPSBzY3JvbGxlci5jbGllbnRXaWR0aDsKICAgICAgcmV0dXJuIChjYWNoZWRXaWR0aCA9IHN0
			cmluZ1dpZHRoKCJ4IikpOwogICAgfQogICAgZnVuY3Rpb24gcGFkZGluZ1RvcCgpIHtyZXR1cm4g
			bGluZVNwYWNlLm9mZnNldFRvcDt9CiAgICBmdW5jdGlvbiBwYWRkaW5nTGVmdCgpIHtyZXR1cm4g
			bGluZVNwYWNlLm9mZnNldExlZnQ7fQoKICAgIGZ1bmN0aW9uIHBvc0Zyb21Nb3VzZShlLCBsaWJl
			cmFsKSB7CiAgICAgIHZhciBvZmZXID0gZWx0T2Zmc2V0KHNjcm9sbGVyLCB0cnVlKSwgeCwgeTsK
			ICAgICAgLy8gRmFpbHMgdW5wcmVkaWN0YWJseSBvbiBJRVs2N10gd2hlbiBtb3VzZSBpcyBkcmFn
			Z2VkIGFyb3VuZCBxdWlja2x5LgogICAgICB0cnkgeyB4ID0gZS5jbGllbnRYOyB5ID0gZS5jbGll
			bnRZOyB9IGNhdGNoIChlKSB7IHJldHVybiBudWxsOyB9CiAgICAgIC8vIFRoaXMgaXMgYSBtZXNz
			IG9mIGEgaGV1cmlzdGljIHRvIHRyeSBhbmQgZGV0ZXJtaW5lIHdoZXRoZXIgYQogICAgICAvLyBz
			Y3JvbGwtYmFyIHdhcyBjbGlja2VkIG9yIG5vdCwgYW5kIHRvIHJldHVybiBudWxsIGlmIG9uZSB3
			YXMKICAgICAgLy8gKGFuZCAhbGliZXJhbCkuCiAgICAgIGlmICghbGliZXJhbCAmJiAoeCAtIG9m
			ZlcubGVmdCA+IHNjcm9sbGVyLmNsaWVudFdpZHRoIHx8IHkgLSBvZmZXLnRvcCA+IHNjcm9sbGVy
			LmNsaWVudEhlaWdodCkpCiAgICAgICAgcmV0dXJuIG51bGw7CiAgICAgIHZhciBvZmZMID0gZWx0
			T2Zmc2V0KGxpbmVTcGFjZSwgdHJ1ZSk7CiAgICAgIHJldHVybiBjb29yZHNDaGFyKHggLSBvZmZM
			LmxlZnQsIHkgLSBvZmZMLnRvcCk7CiAgICB9CiAgICBmdW5jdGlvbiBvbkNvbnRleHRNZW51KGUp
			IHsKICAgICAgdmFyIHBvcyA9IHBvc0Zyb21Nb3VzZShlKSwgc2Nyb2xsUG9zID0gc2Nyb2xsZXIu
			c2Nyb2xsVG9wOwogICAgICBpZiAoIXBvcyB8fCB3aW5kb3cub3BlcmEpIHJldHVybjsgLy8gT3Bl
			cmEgaXMgZGlmZmljdWx0LgogICAgICBpZiAocG9zRXEoc2VsLmZyb20sIHNlbC50bykgfHwgcG9z
			TGVzcyhwb3MsIHNlbC5mcm9tKSB8fCAhcG9zTGVzcyhwb3MsIHNlbC50bykpCiAgICAgICAgb3Bl
			cmF0aW9uKHNldEN1cnNvcikocG9zLmxpbmUsIHBvcy5jaCk7CgogICAgICB2YXIgb2xkQ1NTID0g
			aW5wdXQuc3R5bGUuY3NzVGV4dDsKICAgICAgaW5wdXREaXYuc3R5bGUucG9zaXRpb24gPSAiYWJz
			b2x1dGUiOwogICAgICBpbnB1dC5zdHlsZS5jc3NUZXh0ID0gInBvc2l0aW9uOiBmaXhlZDsgd2lk
			dGg6IDMwcHg7IGhlaWdodDogMzBweDsgdG9wOiAiICsgKGUuY2xpZW50WSAtIDUpICsKICAgICAg
			ICAicHg7IGxlZnQ6ICIgKyAoZS5jbGllbnRYIC0gNSkgKyAicHg7IHotaW5kZXg6IDEwMDA7IGJh
			Y2tncm91bmQ6IHdoaXRlOyAiICsKICAgICAgICAiYm9yZGVyLXdpZHRoOiAwOyBvdXRsaW5lOiBu
			b25lOyBvdmVyZmxvdzogaGlkZGVuOyBvcGFjaXR5OiAuMDU7IGZpbHRlcjogYWxwaGEob3BhY2l0
			eT01KTsiOwogICAgICBsZWF2ZUlucHV0QWxvbmUgPSB0cnVlOwogICAgICB2YXIgdmFsID0gaW5w
			dXQudmFsdWUgPSBnZXRTZWxlY3Rpb24oKTsKICAgICAgZm9jdXNJbnB1dCgpOwogICAgICBzZWxl
			Y3RJbnB1dChpbnB1dCk7CiAgICAgIGZ1bmN0aW9uIHJlaGlkZSgpIHsKICAgICAgICB2YXIgbmV3
			VmFsID0gc3BsaXRMaW5lcyhpbnB1dC52YWx1ZSkuam9pbigiXG4iKTsKICAgICAgICBpZiAobmV3
			VmFsICE9IHZhbCkgb3BlcmF0aW9uKHJlcGxhY2VTZWxlY3Rpb24pKG5ld1ZhbCwgImVuZCIpOwog
			ICAgICAgIGlucHV0RGl2LnN0eWxlLnBvc2l0aW9uID0gInJlbGF0aXZlIjsKICAgICAgICBpbnB1
			dC5zdHlsZS5jc3NUZXh0ID0gb2xkQ1NTOwogICAgICAgIGlmIChpZV9sdDkpIHNjcm9sbGVyLnNj
			cm9sbFRvcCA9IHNjcm9sbFBvczsKICAgICAgICBsZWF2ZUlucHV0QWxvbmUgPSBmYWxzZTsKICAg
			ICAgICByZXNldElucHV0KHRydWUpOwogICAgICAgIHNsb3dQb2xsKCk7CiAgICAgIH0KCiAgICAg
			IGlmIChnZWNrbykgewogICAgICAgIGVfc3RvcChlKTsKICAgICAgICB2YXIgbW91c2V1cCA9IGNv
			bm5lY3Qod2luZG93LCAibW91c2V1cCIsIGZ1bmN0aW9uKCkgewogICAgICAgICAgbW91c2V1cCgp
			OwogICAgICAgICAgc2V0VGltZW91dChyZWhpZGUsIDIwKTsKICAgICAgICB9LCB0cnVlKTsKICAg
			ICAgfSBlbHNlIHsKICAgICAgICBzZXRUaW1lb3V0KHJlaGlkZSwgNTApOwogICAgICB9CiAgICB9
			CgogICAgLy8gQ3Vyc29yLWJsaW5raW5nCiAgICBmdW5jdGlvbiByZXN0YXJ0QmxpbmsoKSB7CiAg
			ICAgIGNsZWFySW50ZXJ2YWwoYmxpbmtlcik7CiAgICAgIHZhciBvbiA9IHRydWU7CiAgICAgIGN1
			cnNvci5zdHlsZS52aXNpYmlsaXR5ID0gIiI7CiAgICAgIGJsaW5rZXIgPSBzZXRJbnRlcnZhbChm
			dW5jdGlvbigpIHsKICAgICAgICBjdXJzb3Iuc3R5bGUudmlzaWJpbGl0eSA9IChvbiA9ICFvbikg
			PyAiIiA6ICJoaWRkZW4iOwogICAgICB9LCA2NTApOwogICAgfQoKICAgIHZhciBtYXRjaGluZyA9
			IHsiKCI6ICIpPiIsICIpIjogIig8IiwgIlsiOiAiXT4iLCAiXSI6ICJbPCIsICJ7IjogIn0+Iiwg
			In0iOiAiezwifTsKICAgIGZ1bmN0aW9uIG1hdGNoQnJhY2tldHMoYXV0b2NsZWFyKSB7CiAgICAg
			IHZhciBoZWFkID0gc2VsLmludmVydGVkID8gc2VsLmZyb20gOiBzZWwudG8sIGxpbmUgPSBnZXRM
			aW5lKGhlYWQubGluZSksIHBvcyA9IGhlYWQuY2ggLSAxOwogICAgICB2YXIgbWF0Y2ggPSAocG9z
			ID49IDAgJiYgbWF0Y2hpbmdbbGluZS50ZXh0LmNoYXJBdChwb3MpXSkgfHwgbWF0Y2hpbmdbbGlu
			ZS50ZXh0LmNoYXJBdCgrK3BvcyldOwogICAgICBpZiAoIW1hdGNoKSByZXR1cm47CiAgICAgIHZh
			ciBjaCA9IG1hdGNoLmNoYXJBdCgwKSwgZm9yd2FyZCA9IG1hdGNoLmNoYXJBdCgxKSA9PSAiPiIs
			IGQgPSBmb3J3YXJkID8gMSA6IC0xLCBzdCA9IGxpbmUuc3R5bGVzOwogICAgICBmb3IgKHZhciBv
			ZmYgPSBwb3MgKyAxLCBpID0gMCwgZSA9IHN0Lmxlbmd0aDsgaSA8IGU7IGkrPTIpCiAgICAgICAg
			aWYgKChvZmYgLT0gc3RbaV0ubGVuZ3RoKSA8PSAwKSB7dmFyIHN0eWxlID0gc3RbaSsxXTsgYnJl
			YWs7fQoKICAgICAgdmFyIHN0YWNrID0gW2xpbmUudGV4dC5jaGFyQXQocG9zKV0sIHJlID0gL1so
			KXt9W1xdXS87CiAgICAgIGZ1bmN0aW9uIHNjYW4obGluZSwgZnJvbSwgdG8pIHsKICAgICAgICBp
			ZiAoIWxpbmUudGV4dCkgcmV0dXJuOwogICAgICAgIHZhciBzdCA9IGxpbmUuc3R5bGVzLCBwb3Mg
			PSBmb3J3YXJkID8gMCA6IGxpbmUudGV4dC5sZW5ndGggLSAxLCBjdXI7CiAgICAgICAgZm9yICh2
			YXIgaSA9IGZvcndhcmQgPyAwIDogc3QubGVuZ3RoIC0gMiwgZSA9IGZvcndhcmQgPyBzdC5sZW5n
			dGggOiAtMjsgaSAhPSBlOyBpICs9IDIqZCkgewogICAgICAgICAgdmFyIHRleHQgPSBzdFtpXTsK
			ICAgICAgICAgIGlmIChzdFtpKzFdICE9IG51bGwgJiYgc3RbaSsxXSAhPSBzdHlsZSkge3BvcyAr
			PSBkICogdGV4dC5sZW5ndGg7IGNvbnRpbnVlO30KICAgICAgICAgIGZvciAodmFyIGogPSBmb3J3
			YXJkID8gMCA6IHRleHQubGVuZ3RoIC0gMSwgdGUgPSBmb3J3YXJkID8gdGV4dC5sZW5ndGggOiAt
			MTsgaiAhPSB0ZTsgaiArPSBkLCBwb3MrPWQpIHsKICAgICAgICAgICAgaWYgKHBvcyA+PSBmcm9t
			ICYmIHBvcyA8IHRvICYmIHJlLnRlc3QoY3VyID0gdGV4dC5jaGFyQXQoaikpKSB7CiAgICAgICAg
			ICAgICAgdmFyIG1hdGNoID0gbWF0Y2hpbmdbY3VyXTsKICAgICAgICAgICAgICBpZiAobWF0Y2gu
			Y2hhckF0KDEpID09ICI+IiA9PSBmb3J3YXJkKSBzdGFjay5wdXNoKGN1cik7CiAgICAgICAgICAg
			ICAgZWxzZSBpZiAoc3RhY2sucG9wKCkgIT0gbWF0Y2guY2hhckF0KDApKSByZXR1cm4ge3Bvczog
			cG9zLCBtYXRjaDogZmFsc2V9OwogICAgICAgICAgICAgIGVsc2UgaWYgKCFzdGFjay5sZW5ndGgp
			IHJldHVybiB7cG9zOiBwb3MsIG1hdGNoOiB0cnVlfTsKICAgICAgICAgICAgfQogICAgICAgICAg
			fQogICAgICAgIH0KICAgICAgfQogICAgICBmb3IgKHZhciBpID0gaGVhZC5saW5lLCBlID0gZm9y
			d2FyZCA/IE1hdGgubWluKGkgKyAxMDAsIGRvYy5zaXplKSA6IE1hdGgubWF4KC0xLCBpIC0gMTAw
			KTsgaSAhPSBlOyBpKz1kKSB7CiAgICAgICAgdmFyIGxpbmUgPSBnZXRMaW5lKGkpLCBmaXJzdCA9
			IGkgPT0gaGVhZC5saW5lOwogICAgICAgIHZhciBmb3VuZCA9IHNjYW4obGluZSwgZmlyc3QgJiYg
			Zm9yd2FyZCA/IHBvcyArIDEgOiAwLCBmaXJzdCAmJiAhZm9yd2FyZCA/IHBvcyA6IGxpbmUudGV4
			dC5sZW5ndGgpOwogICAgICAgIGlmIChmb3VuZCkgYnJlYWs7CiAgICAgIH0KICAgICAgaWYgKCFm
			b3VuZCkgZm91bmQgPSB7cG9zOiBudWxsLCBtYXRjaDogZmFsc2V9OwogICAgICB2YXIgc3R5bGUg
			PSBmb3VuZC5tYXRjaCA/ICJDb2RlTWlycm9yLW1hdGNoaW5nYnJhY2tldCIgOiAiQ29kZU1pcnJv
			ci1ub25tYXRjaGluZ2JyYWNrZXQiOwogICAgICB2YXIgb25lID0gbWFya1RleHQoe2xpbmU6IGhl
			YWQubGluZSwgY2g6IHBvc30sIHtsaW5lOiBoZWFkLmxpbmUsIGNoOiBwb3MrMX0sIHN0eWxlKSwK
			ICAgICAgICAgIHR3byA9IGZvdW5kLnBvcyAhPSBudWxsICYmIG1hcmtUZXh0KHtsaW5lOiBpLCBj
			aDogZm91bmQucG9zfSwge2xpbmU6IGksIGNoOiBmb3VuZC5wb3MgKyAxfSwgc3R5bGUpOwogICAg
			ICB2YXIgY2xlYXIgPSBvcGVyYXRpb24oZnVuY3Rpb24oKXtvbmUuY2xlYXIoKTsgdHdvICYmIHR3
			by5jbGVhcigpO30pOwogICAgICBpZiAoYXV0b2NsZWFyKSBzZXRUaW1lb3V0KGNsZWFyLCA4MDAp
			OwogICAgICBlbHNlIGJyYWNrZXRIaWdobGlnaHRlZCA9IGNsZWFyOwogICAgfQoKICAgIC8vIEZp
			bmRzIHRoZSBsaW5lIHRvIHN0YXJ0IHdpdGggd2hlbiBzdGFydGluZyBhIHBhcnNlLiBUcmllcyB0
			bwogICAgLy8gZmluZCBhIGxpbmUgd2l0aCBhIHN0YXRlQWZ0ZXIsIHNvIHRoYXQgaXQgY2FuIHN0
			YXJ0IHdpdGggYQogICAgLy8gdmFsaWQgc3RhdGUuIElmIHRoYXQgZmFpbHMsIGl0IHJldHVybnMg
			dGhlIGxpbmUgd2l0aCB0aGUKICAgIC8vIHNtYWxsZXN0IGluZGVudGF0aW9uLCB3aGljaCB0ZW5k
			cyB0byBuZWVkIHRoZSBsZWFzdCBjb250ZXh0IHRvCiAgICAvLyBwYXJzZSBjb3JyZWN0bHkuCiAg
			ICBmdW5jdGlvbiBmaW5kU3RhcnRMaW5lKG4pIHsKICAgICAgdmFyIG1pbmluZGVudCwgbWlubGlu
			ZTsKICAgICAgZm9yICh2YXIgc2VhcmNoID0gbiwgbGltID0gbiAtIDQwOyBzZWFyY2ggPiBsaW07
			IC0tc2VhcmNoKSB7CiAgICAgICAgaWYgKHNlYXJjaCA9PSAwKSByZXR1cm4gMDsKICAgICAgICB2
			YXIgbGluZSA9IGdldExpbmUoc2VhcmNoLTEpOwogICAgICAgIGlmIChsaW5lLnN0YXRlQWZ0ZXIp
			IHJldHVybiBzZWFyY2g7CiAgICAgICAgdmFyIGluZGVudGVkID0gbGluZS5pbmRlbnRhdGlvbihv
			cHRpb25zLnRhYlNpemUpOwogICAgICAgIGlmIChtaW5saW5lID09IG51bGwgfHwgbWluaW5kZW50
			ID4gaW5kZW50ZWQpIHsKICAgICAgICAgIG1pbmxpbmUgPSBzZWFyY2ggLSAxOwogICAgICAgICAg
			bWluaW5kZW50ID0gaW5kZW50ZWQ7CiAgICAgICAgfQogICAgICB9CiAgICAgIHJldHVybiBtaW5s
			aW5lOwogICAgfQogICAgZnVuY3Rpb24gZ2V0U3RhdGVCZWZvcmUobikgewogICAgICB2YXIgc3Rh
			cnQgPSBmaW5kU3RhcnRMaW5lKG4pLCBzdGF0ZSA9IHN0YXJ0ICYmIGdldExpbmUoc3RhcnQtMSku
			c3RhdGVBZnRlcjsKICAgICAgaWYgKCFzdGF0ZSkgc3RhdGUgPSBzdGFydFN0YXRlKG1vZGUpOwog
			ICAgICBlbHNlIHN0YXRlID0gY29weVN0YXRlKG1vZGUsIHN0YXRlKTsKICAgICAgZG9jLml0ZXIo
			c3RhcnQsIG4sIGZ1bmN0aW9uKGxpbmUpIHsKICAgICAgICBsaW5lLmhpZ2hsaWdodChtb2RlLCBz
			dGF0ZSwgb3B0aW9ucy50YWJTaXplKTsKICAgICAgICBsaW5lLnN0YXRlQWZ0ZXIgPSBjb3B5U3Rh
			dGUobW9kZSwgc3RhdGUpOwogICAgICB9KTsKICAgICAgaWYgKHN0YXJ0IDwgbikgY2hhbmdlcy5w
			dXNoKHtmcm9tOiBzdGFydCwgdG86IG59KTsKICAgICAgaWYgKG4gPCBkb2Muc2l6ZSAmJiAhZ2V0
			TGluZShuKS5zdGF0ZUFmdGVyKSB3b3JrLnB1c2gobik7CiAgICAgIHJldHVybiBzdGF0ZTsKICAg
			IH0KICAgIGZ1bmN0aW9uIGhpZ2hsaWdodExpbmVzKHN0YXJ0LCBlbmQpIHsKICAgICAgdmFyIHN0
			YXRlID0gZ2V0U3RhdGVCZWZvcmUoc3RhcnQpOwogICAgICBkb2MuaXRlcihzdGFydCwgZW5kLCBm
			dW5jdGlvbihsaW5lKSB7CiAgICAgICAgbGluZS5oaWdobGlnaHQobW9kZSwgc3RhdGUsIG9wdGlv
			bnMudGFiU2l6ZSk7CiAgICAgICAgbGluZS5zdGF0ZUFmdGVyID0gY29weVN0YXRlKG1vZGUsIHN0
			YXRlKTsKICAgICAgfSk7CiAgICB9CiAgICBmdW5jdGlvbiBoaWdobGlnaHRXb3JrZXIoKSB7CiAg
			ICAgIHZhciBlbmQgPSArbmV3IERhdGUgKyBvcHRpb25zLndvcmtUaW1lOwogICAgICB2YXIgZm91
			bmRXb3JrID0gd29yay5sZW5ndGg7CiAgICAgIHdoaWxlICh3b3JrLmxlbmd0aCkgewogICAgICAg
			IGlmICghZ2V0TGluZShzaG93aW5nRnJvbSkuc3RhdGVBZnRlcikgdmFyIHRhc2sgPSBzaG93aW5n
			RnJvbTsKICAgICAgICBlbHNlIHZhciB0YXNrID0gd29yay5wb3AoKTsKICAgICAgICBpZiAodGFz
			ayA+PSBkb2Muc2l6ZSkgY29udGludWU7CiAgICAgICAgdmFyIHN0YXJ0ID0gZmluZFN0YXJ0TGlu
			ZSh0YXNrKSwgc3RhdGUgPSBzdGFydCAmJiBnZXRMaW5lKHN0YXJ0LTEpLnN0YXRlQWZ0ZXI7CiAg
			ICAgICAgaWYgKHN0YXRlKSBzdGF0ZSA9IGNvcHlTdGF0ZShtb2RlLCBzdGF0ZSk7CiAgICAgICAg
			ZWxzZSBzdGF0ZSA9IHN0YXJ0U3RhdGUobW9kZSk7CgogICAgICAgIHZhciB1bmNoYW5nZWQgPSAw
			LCBjb21wYXJlID0gbW9kZS5jb21wYXJlU3RhdGVzLCByZWFsQ2hhbmdlID0gZmFsc2UsCiAgICAg
			ICAgICAgIGkgPSBzdGFydCwgYmFpbCA9IGZhbHNlOwogICAgICAgIGRvYy5pdGVyKGksIGRvYy5z
			aXplLCBmdW5jdGlvbihsaW5lKSB7CiAgICAgICAgICB2YXIgaGFkU3RhdGUgPSBsaW5lLnN0YXRl
			QWZ0ZXI7CiAgICAgICAgICBpZiAoK25ldyBEYXRlID4gZW5kKSB7CiAgICAgICAgICAgIHdvcmsu
			cHVzaChpKTsKICAgICAgICAgICAgc3RhcnRXb3JrZXIob3B0aW9ucy53b3JrRGVsYXkpOwogICAg
			ICAgICAgICBpZiAocmVhbENoYW5nZSkgY2hhbmdlcy5wdXNoKHtmcm9tOiB0YXNrLCB0bzogaSAr
			IDF9KTsKICAgICAgICAgICAgcmV0dXJuIChiYWlsID0gdHJ1ZSk7CiAgICAgICAgICB9CiAgICAg
			ICAgICB2YXIgY2hhbmdlZCA9IGxpbmUuaGlnaGxpZ2h0KG1vZGUsIHN0YXRlLCBvcHRpb25zLnRh
			YlNpemUpOwogICAgICAgICAgaWYgKGNoYW5nZWQpIHJlYWxDaGFuZ2UgPSB0cnVlOwogICAgICAg
			ICAgbGluZS5zdGF0ZUFmdGVyID0gY29weVN0YXRlKG1vZGUsIHN0YXRlKTsKICAgICAgICAgIGlm
			IChjb21wYXJlKSB7CiAgICAgICAgICAgIGlmIChoYWRTdGF0ZSAmJiBjb21wYXJlKGhhZFN0YXRl
			LCBzdGF0ZSkpIHJldHVybiB0cnVlOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgaWYg
			KGNoYW5nZWQgIT09IGZhbHNlIHx8ICFoYWRTdGF0ZSkgdW5jaGFuZ2VkID0gMDsKICAgICAgICAg
			ICAgZWxzZSBpZiAoKyt1bmNoYW5nZWQgPiAzICYmICghbW9kZS5pbmRlbnQgfHwgbW9kZS5pbmRl
			bnQoaGFkU3RhdGUsICIiKSA9PSBtb2RlLmluZGVudChzdGF0ZSwgIiIpKSkKICAgICAgICAgICAg
			ICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICAgICsraTsKICAgICAgICB9KTsKICAg
			ICAgICBpZiAoYmFpbCkgcmV0dXJuOwogICAgICAgIGlmIChyZWFsQ2hhbmdlKSBjaGFuZ2VzLnB1
			c2goe2Zyb206IHRhc2ssIHRvOiBpICsgMX0pOwogICAgICB9CiAgICAgIGlmIChmb3VuZFdvcmsg
			JiYgb3B0aW9ucy5vbkhpZ2hsaWdodENvbXBsZXRlKQogICAgICAgIG9wdGlvbnMub25IaWdobGln
			aHRDb21wbGV0ZShpbnN0YW5jZSk7CiAgICB9CiAgICBmdW5jdGlvbiBzdGFydFdvcmtlcih0aW1l
			KSB7CiAgICAgIGlmICghd29yay5sZW5ndGgpIHJldHVybjsKICAgICAgaGlnaGxpZ2h0LnNldCh0
			aW1lLCBvcGVyYXRpb24oaGlnaGxpZ2h0V29ya2VyKSk7CiAgICB9CgogICAgLy8gT3BlcmF0aW9u
			cyBhcmUgdXNlZCB0byB3cmFwIGNoYW5nZXMgaW4gc3VjaCBhIHdheSB0aGF0IGVhY2gKICAgIC8v
			IGNoYW5nZSB3b24ndCBoYXZlIHRvIHVwZGF0ZSB0aGUgY3Vyc29yIGFuZCBkaXNwbGF5ICh3aGlj
			aCB3b3VsZAogICAgLy8gYmUgYXdrd2FyZCwgc2xvdywgYW5kIGVycm9yLXByb25lKSwgYnV0IGlu
			c3RlYWQgdXBkYXRlcyBhcmUKICAgIC8vIGJhdGNoZWQgYW5kIHRoZW4gYWxsIGNvbWJpbmVkIGFu
			ZCBleGVjdXRlZCBhdCBvbmNlLgogICAgZnVuY3Rpb24gc3RhcnRPcGVyYXRpb24oKSB7CiAgICAg
			IHVwZGF0ZUlucHV0ID0gdXNlclNlbENoYW5nZSA9IHRleHRDaGFuZ2VkID0gbnVsbDsKICAgICAg
			Y2hhbmdlcyA9IFtdOyBzZWxlY3Rpb25DaGFuZ2VkID0gZmFsc2U7IGNhbGxiYWNrcyA9IFtdOwog
			ICAgfQogICAgZnVuY3Rpb24gZW5kT3BlcmF0aW9uKCkgewogICAgICB2YXIgcmVTY3JvbGwgPSBm
			YWxzZSwgdXBkYXRlZDsKICAgICAgaWYgKHNlbGVjdGlvbkNoYW5nZWQpIHJlU2Nyb2xsID0gIXNj
			cm9sbEN1cnNvckludG9WaWV3KCk7CiAgICAgIGlmIChjaGFuZ2VzLmxlbmd0aCkgdXBkYXRlZCA9
			IHVwZGF0ZURpc3BsYXkoY2hhbmdlcywgdHJ1ZSk7CiAgICAgIGVsc2UgewogICAgICAgIGlmIChz
			ZWxlY3Rpb25DaGFuZ2VkKSB1cGRhdGVTZWxlY3Rpb24oKTsKICAgICAgICBpZiAoZ3V0dGVyRGly
			dHkpIHVwZGF0ZUd1dHRlcigpOwogICAgICB9CiAgICAgIGlmIChyZVNjcm9sbCkgc2Nyb2xsQ3Vy
			c29ySW50b1ZpZXcoKTsKICAgICAgaWYgKHNlbGVjdGlvbkNoYW5nZWQpIHtzY3JvbGxFZGl0b3JJ
			bnRvVmlldygpOyByZXN0YXJ0QmxpbmsoKTt9CgogICAgICBpZiAoZm9jdXNlZCAmJiAhbGVhdmVJ
			bnB1dEFsb25lICYmCiAgICAgICAgICAodXBkYXRlSW5wdXQgPT09IHRydWUgfHwgKHVwZGF0ZUlu
			cHV0ICE9PSBmYWxzZSAmJiBzZWxlY3Rpb25DaGFuZ2VkKSkpCiAgICAgICAgcmVzZXRJbnB1dCh1
			c2VyU2VsQ2hhbmdlKTsKCiAgICAgIGlmIChzZWxlY3Rpb25DaGFuZ2VkICYmIG9wdGlvbnMubWF0
			Y2hCcmFja2V0cykKICAgICAgICBzZXRUaW1lb3V0KG9wZXJhdGlvbihmdW5jdGlvbigpIHsKICAg
			ICAgICAgIGlmIChicmFja2V0SGlnaGxpZ2h0ZWQpIHticmFja2V0SGlnaGxpZ2h0ZWQoKTsgYnJh
			Y2tldEhpZ2hsaWdodGVkID0gbnVsbDt9CiAgICAgICAgICBpZiAocG9zRXEoc2VsLmZyb20sIHNl
			bC50bykpIG1hdGNoQnJhY2tldHMoZmFsc2UpOwogICAgICAgIH0pLCAyMCk7CiAgICAgIHZhciB0
			YyA9IHRleHRDaGFuZ2VkLCBjYnMgPSBjYWxsYmFja3M7IC8vIHRoZXNlIGNhbiBiZSByZXNldCBi
			eSBjYWxsYmFja3MKICAgICAgaWYgKHNlbGVjdGlvbkNoYW5nZWQgJiYgb3B0aW9ucy5vbkN1cnNv
			ckFjdGl2aXR5KQogICAgICAgIG9wdGlvbnMub25DdXJzb3JBY3Rpdml0eShpbnN0YW5jZSk7CiAg
			ICAgIGlmICh0YyAmJiBvcHRpb25zLm9uQ2hhbmdlICYmIGluc3RhbmNlKQogICAgICAgIG9wdGlv
			bnMub25DaGFuZ2UoaW5zdGFuY2UsIHRjKTsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjYnMu
			bGVuZ3RoOyArK2kpIGNic1tpXShpbnN0YW5jZSk7CiAgICAgIGlmICh1cGRhdGVkICYmIG9wdGlv
			bnMub25VcGRhdGUpIG9wdGlvbnMub25VcGRhdGUoaW5zdGFuY2UpOwogICAgfQogICAgdmFyIG5l
			c3RlZE9wZXJhdGlvbiA9IDA7CiAgICBmdW5jdGlvbiBvcGVyYXRpb24oZikgewogICAgICByZXR1
			cm4gZnVuY3Rpb24oKSB7CiAgICAgICAgaWYgKCFuZXN0ZWRPcGVyYXRpb24rKykgc3RhcnRPcGVy
			YXRpb24oKTsKICAgICAgICB0cnkge3ZhciByZXN1bHQgPSBmLmFwcGx5KHRoaXMsIGFyZ3VtZW50
			cyk7fQogICAgICAgIGZpbmFsbHkge2lmICghLS1uZXN0ZWRPcGVyYXRpb24pIGVuZE9wZXJhdGlv
			bigpO30KICAgICAgICByZXR1cm4gcmVzdWx0OwogICAgICB9OwogICAgfQoKICAgIGZvciAodmFy
			IGV4dCBpbiBleHRlbnNpb25zKQogICAgICBpZiAoZXh0ZW5zaW9ucy5wcm9wZXJ0eUlzRW51bWVy
			YWJsZShleHQpICYmCiAgICAgICAgICAhaW5zdGFuY2UucHJvcGVydHlJc0VudW1lcmFibGUoZXh0
			KSkKICAgICAgICBpbnN0YW5jZVtleHRdID0gZXh0ZW5zaW9uc1tleHRdOwogICAgcmV0dXJuIGlu
			c3RhbmNlOwogIH0gLy8gKGVuZCBvZiBmdW5jdGlvbiBDb2RlTWlycm9yKQoKICAvLyBUaGUgZGVm
			YXVsdCBjb25maWd1cmF0aW9uIG9wdGlvbnMuCiAgQ29kZU1pcnJvci5kZWZhdWx0cyA9IHsKICAg
			IHZhbHVlOiAiIiwKICAgIG1vZGU6IG51bGwsCiAgICB0aGVtZTogImRlZmF1bHQiLAogICAgaW5k
			ZW50VW5pdDogMiwKICAgIGluZGVudFdpdGhUYWJzOiBmYWxzZSwKICAgIHNtYXJ0SW5kZW50OiB0
			cnVlLAogICAgdGFiU2l6ZTogNCwKICAgIGtleU1hcDogImRlZmF1bHQiLAogICAgZXh0cmFLZXlz
			OiBudWxsLAogICAgZWxlY3RyaWNDaGFyczogdHJ1ZSwKICAgIGF1dG9DbGVhckVtcHR5TGluZXM6
			IGZhbHNlLAogICAgb25LZXlFdmVudDogbnVsbCwKICAgIGxpbmVXcmFwcGluZzogZmFsc2UsCiAg
			ICBsaW5lTnVtYmVyczogZmFsc2UsCiAgICBndXR0ZXI6IGZhbHNlLAogICAgZml4ZWRHdXR0ZXI6
			IGZhbHNlLAogICAgZmlyc3RMaW5lTnVtYmVyOiAxLAogICAgcmVhZE9ubHk6IGZhbHNlLAogICAg
			b25DaGFuZ2U6IG51bGwsCiAgICBvbkN1cnNvckFjdGl2aXR5OiBudWxsLAogICAgb25HdXR0ZXJD
			bGljazogbnVsbCwKICAgIG9uSGlnaGxpZ2h0Q29tcGxldGU6IG51bGwsCiAgICBvblVwZGF0ZTog
			bnVsbCwKICAgIG9uRm9jdXM6IG51bGwsIG9uQmx1cjogbnVsbCwgb25TY3JvbGw6IG51bGwsCiAg
			ICBtYXRjaEJyYWNrZXRzOiBmYWxzZSwKICAgIHdvcmtUaW1lOiAxMDAsCiAgICB3b3JrRGVsYXk6
			IDIwMCwKICAgIHBvbGxJbnRlcnZhbDogMTAwLAogICAgdW5kb0RlcHRoOiA0MCwKICAgIHRhYmlu
			ZGV4OiBudWxsLAogICAgZG9jdW1lbnQ6IHdpbmRvdy5kb2N1bWVudAogIH07CgogIHZhciBpb3Mg
			PSAvQXBwbGVXZWJLaXQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgJiYgL01vYmlsZVwvXHcr
			Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOwogIHZhciBtYWMgPSBpb3MgfHwgL01hYy8udGVz
			dChuYXZpZ2F0b3IucGxhdGZvcm0pOwogIHZhciB3aW4gPSAvV2luLy50ZXN0KG5hdmlnYXRvci5w
			bGF0Zm9ybSk7CgogIC8vIEtub3duIG1vZGVzLCBieSBuYW1lIGFuZCBieSBNSU1FCiAgdmFyIG1v
			ZGVzID0ge30sIG1pbWVNb2RlcyA9IHt9OwogIENvZGVNaXJyb3IuZGVmaW5lTW9kZSA9IGZ1bmN0
			aW9uKG5hbWUsIG1vZGUpIHsKICAgIGlmICghQ29kZU1pcnJvci5kZWZhdWx0cy5tb2RlICYmIG5h
			bWUgIT0gIm51bGwiKSBDb2RlTWlycm9yLmRlZmF1bHRzLm1vZGUgPSBuYW1lOwogICAgbW9kZXNb
			bmFtZV0gPSBtb2RlOwogIH07CiAgQ29kZU1pcnJvci5kZWZpbmVNSU1FID0gZnVuY3Rpb24obWlt
			ZSwgc3BlYykgewogICAgbWltZU1vZGVzW21pbWVdID0gc3BlYzsKICB9OwogIENvZGVNaXJyb3Iu
			cmVzb2x2ZU1vZGUgPSBmdW5jdGlvbihzcGVjKSB7CiAgICBpZiAodHlwZW9mIHNwZWMgPT0gInN0
			cmluZyIgJiYgbWltZU1vZGVzLmhhc093blByb3BlcnR5KHNwZWMpKQogICAgICBzcGVjID0gbWlt
			ZU1vZGVzW3NwZWNdOwogICAgaWYgKHR5cGVvZiBzcGVjID09ICJzdHJpbmciKSByZXR1cm4ge25h
			bWU6IHNwZWN9OwogICAgZWxzZSByZXR1cm4gc3BlYyB8fCB7bmFtZTogIm51bGwifTsKICB9Owog
			IENvZGVNaXJyb3IuZ2V0TW9kZSA9IGZ1bmN0aW9uKG9wdGlvbnMsIHNwZWMpIHsKICAgIHZhciBz
			cGVjID0gQ29kZU1pcnJvci5yZXNvbHZlTW9kZShzcGVjKTsKICAgIHZhciBtZmFjdG9yeSA9IG1v
			ZGVzW3NwZWMubmFtZV07CiAgICBpZiAoIW1mYWN0b3J5KSB7CiAgICAgIGlmICh3aW5kb3cuY29u
			c29sZSkgY29uc29sZS53YXJuKCJObyBtb2RlICIgKyBzcGVjLm5hbWUgKyAiIGZvdW5kLCBmYWxs
			aW5nIGJhY2sgdG8gcGxhaW4gdGV4dC4iKTsKICAgICAgcmV0dXJuIENvZGVNaXJyb3IuZ2V0TW9k
			ZShvcHRpb25zLCAidGV4dC9wbGFpbiIpOwogICAgfQogICAgcmV0dXJuIG1mYWN0b3J5KG9wdGlv
			bnMsIHNwZWMpOwogIH07CiAgQ29kZU1pcnJvci5saXN0TW9kZXMgPSBmdW5jdGlvbigpIHsKICAg
			IHZhciBsaXN0ID0gW107CiAgICBmb3IgKHZhciBtIGluIG1vZGVzKQogICAgICBpZiAobW9kZXMu
			cHJvcGVydHlJc0VudW1lcmFibGUobSkpIGxpc3QucHVzaChtKTsKICAgIHJldHVybiBsaXN0Owog
			IH07CiAgQ29kZU1pcnJvci5saXN0TUlNRXMgPSBmdW5jdGlvbigpIHsKICAgIHZhciBsaXN0ID0g
			W107CiAgICBmb3IgKHZhciBtIGluIG1pbWVNb2RlcykKICAgICAgaWYgKG1pbWVNb2Rlcy5wcm9w
			ZXJ0eUlzRW51bWVyYWJsZShtKSkgbGlzdC5wdXNoKHttaW1lOiBtLCBtb2RlOiBtaW1lTW9kZXNb
			bV19KTsKICAgIHJldHVybiBsaXN0OwogIH07CgogIHZhciBleHRlbnNpb25zID0gQ29kZU1pcnJv
			ci5leHRlbnNpb25zID0ge307CiAgQ29kZU1pcnJvci5kZWZpbmVFeHRlbnNpb24gPSBmdW5jdGlv
			bihuYW1lLCBmdW5jKSB7CiAgICBleHRlbnNpb25zW25hbWVdID0gZnVuYzsKICB9OwoKICB2YXIg
			Y29tbWFuZHMgPSBDb2RlTWlycm9yLmNvbW1hbmRzID0gewogICAgc2VsZWN0QWxsOiBmdW5jdGlv
			bihjbSkge2NtLnNldFNlbGVjdGlvbih7bGluZTogMCwgY2g6IDB9LCB7bGluZTogY20ubGluZUNv
			dW50KCkgLSAxfSk7fSwKICAgIGtpbGxMaW5lOiBmdW5jdGlvbihjbSkgewogICAgICB2YXIgZnJv
			bSA9IGNtLmdldEN1cnNvcih0cnVlKSwgdG8gPSBjbS5nZXRDdXJzb3IoZmFsc2UpLCBzZWwgPSAh
			cG9zRXEoZnJvbSwgdG8pOwogICAgICBpZiAoIXNlbCAmJiBjbS5nZXRMaW5lKGZyb20ubGluZSku
			bGVuZ3RoID09IGZyb20uY2gpIGNtLnJlcGxhY2VSYW5nZSgiIiwgZnJvbSwge2xpbmU6IGZyb20u
			bGluZSArIDEsIGNoOiAwfSk7CiAgICAgIGVsc2UgY20ucmVwbGFjZVJhbmdlKCIiLCBmcm9tLCBz
			ZWwgPyB0byA6IHtsaW5lOiBmcm9tLmxpbmV9KTsKICAgIH0sCiAgICBkZWxldGVMaW5lOiBmdW5j
			dGlvbihjbSkge3ZhciBsID0gY20uZ2V0Q3Vyc29yKCkubGluZTsgY20ucmVwbGFjZVJhbmdlKCIi
			LCB7bGluZTogbCwgY2g6IDB9LCB7bGluZTogbH0pO30sCiAgICB1bmRvOiBmdW5jdGlvbihjbSkg
			e2NtLnVuZG8oKTt9LAogICAgcmVkbzogZnVuY3Rpb24oY20pIHtjbS5yZWRvKCk7fSwKICAgIGdv
			RG9jU3RhcnQ6IGZ1bmN0aW9uKGNtKSB7Y20uc2V0Q3Vyc29yKDAsIDAsIHRydWUpO30sCiAgICBn
			b0RvY0VuZDogZnVuY3Rpb24oY20pIHtjbS5zZXRTZWxlY3Rpb24oe2xpbmU6IGNtLmxpbmVDb3Vu
			dCgpIC0gMX0sIG51bGwsIHRydWUpO30sCiAgICBnb0xpbmVTdGFydDogZnVuY3Rpb24oY20pIHtj
			bS5zZXRDdXJzb3IoY20uZ2V0Q3Vyc29yKCkubGluZSwgMCwgdHJ1ZSk7fSwKICAgIGdvTGluZVN0
			YXJ0U21hcnQ6IGZ1bmN0aW9uKGNtKSB7CiAgICAgIHZhciBjdXIgPSBjbS5nZXRDdXJzb3IoKTsK
			ICAgICAgdmFyIHRleHQgPSBjbS5nZXRMaW5lKGN1ci5saW5lKSwgZmlyc3ROb25XUyA9IE1hdGgu
			bWF4KDAsIHRleHQuc2VhcmNoKC9cUy8pKTsKICAgICAgY20uc2V0Q3Vyc29yKGN1ci5saW5lLCBj
			dXIuY2ggPD0gZmlyc3ROb25XUyAmJiBjdXIuY2ggPyAwIDogZmlyc3ROb25XUywgdHJ1ZSk7CiAg
			ICB9LAogICAgZ29MaW5lRW5kOiBmdW5jdGlvbihjbSkge2NtLnNldFNlbGVjdGlvbih7bGluZTog
			Y20uZ2V0Q3Vyc29yKCkubGluZX0sIG51bGwsIHRydWUpO30sCiAgICBnb0xpbmVVcDogZnVuY3Rp
			b24oY20pIHtjbS5tb3ZlVigtMSwgImxpbmUiKTt9LAogICAgZ29MaW5lRG93bjogZnVuY3Rpb24o
			Y20pIHtjbS5tb3ZlVigxLCAibGluZSIpO30sCiAgICBnb1BhZ2VVcDogZnVuY3Rpb24oY20pIHtj
			bS5tb3ZlVigtMSwgInBhZ2UiKTt9LAogICAgZ29QYWdlRG93bjogZnVuY3Rpb24oY20pIHtjbS5t
			b3ZlVigxLCAicGFnZSIpO30sCiAgICBnb0NoYXJMZWZ0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVI
			KC0xLCAiY2hhciIpO30sCiAgICBnb0NoYXJSaWdodDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgx
			LCAiY2hhciIpO30sCiAgICBnb0NvbHVtbkxlZnQ6IGZ1bmN0aW9uKGNtKSB7Y20ubW92ZUgoLTEs
			ICJjb2x1bW4iKTt9LAogICAgZ29Db2x1bW5SaWdodDogZnVuY3Rpb24oY20pIHtjbS5tb3ZlSCgx
			LCAiY29sdW1uIik7fSwKICAgIGdvV29yZExlZnQ6IGZ1bmN0aW9uKGNtKSB7Y20ubW92ZUgoLTEs
			ICJ3b3JkIik7fSwKICAgIGdvV29yZFJpZ2h0OiBmdW5jdGlvbihjbSkge2NtLm1vdmVIKDEsICJ3
			b3JkIik7fSwKICAgIGRlbENoYXJMZWZ0OiBmdW5jdGlvbihjbSkge2NtLmRlbGV0ZUgoLTEsICJj
			aGFyIik7fSwKICAgIGRlbENoYXJSaWdodDogZnVuY3Rpb24oY20pIHtjbS5kZWxldGVIKDEsICJj
			aGFyIik7fSwKICAgIGRlbFdvcmRMZWZ0OiBmdW5jdGlvbihjbSkge2NtLmRlbGV0ZUgoLTEsICJ3
			b3JkIik7fSwKICAgIGRlbFdvcmRSaWdodDogZnVuY3Rpb24oY20pIHtjbS5kZWxldGVIKDEsICJ3
			b3JkIik7fSwKICAgIGluZGVudEF1dG86IGZ1bmN0aW9uKGNtKSB7Y20uaW5kZW50U2VsZWN0aW9u
			KCJzbWFydCIpO30sCiAgICBpbmRlbnRNb3JlOiBmdW5jdGlvbihjbSkge2NtLmluZGVudFNlbGVj
			dGlvbigiYWRkIik7fSwKICAgIGluZGVudExlc3M6IGZ1bmN0aW9uKGNtKSB7Y20uaW5kZW50U2Vs
			ZWN0aW9uKCJzdWJ0cmFjdCIpO30sCiAgICBpbnNlcnRUYWI6IGZ1bmN0aW9uKGNtKSB7Y20ucmVw
			bGFjZVNlbGVjdGlvbigiXHQiLCAiZW5kIik7fSwKICAgIHRyYW5zcG9zZUNoYXJzOiBmdW5jdGlv
			bihjbSkgewogICAgICB2YXIgY3VyID0gY20uZ2V0Q3Vyc29yKCksIGxpbmUgPSBjbS5nZXRMaW5l
			KGN1ci5saW5lKTsKICAgICAgaWYgKGN1ci5jaCA+IDAgJiYgY3VyLmNoIDwgbGluZS5sZW5ndGgg
			LSAxKQogICAgICAgIGNtLnJlcGxhY2VSYW5nZShsaW5lLmNoYXJBdChjdXIuY2gpICsgbGluZS5j
			aGFyQXQoY3VyLmNoIC0gMSksCiAgICAgICAgICAgICAgICAgICAgICAgIHtsaW5lOiBjdXIubGlu
			ZSwgY2g6IGN1ci5jaCAtIDF9LCB7bGluZTogY3VyLmxpbmUsIGNoOiBjdXIuY2ggKyAxfSk7CiAg
			ICB9LAogICAgbmV3bGluZUFuZEluZGVudDogZnVuY3Rpb24oY20pIHsKICAgICAgY20ucmVwbGFj
			ZVNlbGVjdGlvbigiXG4iLCAiZW5kIik7CiAgICAgIGNtLmluZGVudExpbmUoY20uZ2V0Q3Vyc29y
			KCkubGluZSk7CiAgICB9LAogICAgdG9nZ2xlT3ZlcndyaXRlOiBmdW5jdGlvbihjbSkge2NtLnRv
			Z2dsZU92ZXJ3cml0ZSgpO30KICB9OwoKICB2YXIga2V5TWFwID0gQ29kZU1pcnJvci5rZXlNYXAg
			PSB7fTsKICBrZXlNYXAuYmFzaWMgPSB7CiAgICAiTGVmdCI6ICJnb0NoYXJMZWZ0IiwgIlJpZ2h0
			IjogImdvQ2hhclJpZ2h0IiwgIlVwIjogImdvTGluZVVwIiwgIkRvd24iOiAiZ29MaW5lRG93biIs
			CiAgICAiRW5kIjogImdvTGluZUVuZCIsICJIb21lIjogImdvTGluZVN0YXJ0U21hcnQiLCAiUGFn
			ZVVwIjogImdvUGFnZVVwIiwgIlBhZ2VEb3duIjogImdvUGFnZURvd24iLAogICAgIkRlbGV0ZSI6
			ICJkZWxDaGFyUmlnaHQiLCAiQmFja3NwYWNlIjogImRlbENoYXJMZWZ0IiwgIlRhYiI6ICJpbmRl
			bnRNb3JlIiwgIlNoaWZ0LVRhYiI6ICJpbmRlbnRMZXNzIiwKICAgICJFbnRlciI6ICJuZXdsaW5l
			QW5kSW5kZW50IiwgIkluc2VydCI6ICJ0b2dnbGVPdmVyd3JpdGUiCiAgfTsKICAvLyBOb3RlIHRo
			YXQgdGhlIHNhdmUgYW5kIGZpbmQtcmVsYXRlZCBjb21tYW5kcyBhcmVuJ3QgZGVmaW5lZCBieQog
			IC8vIGRlZmF1bHQuIFVua25vd24gY29tbWFuZHMgYXJlIHNpbXBseSBpZ25vcmVkLgogIGtleU1h
			cC5wY0RlZmF1bHQgPSB7CiAgICAiQ3RybC1BIjogInNlbGVjdEFsbCIsICJDdHJsLUQiOiAiZGVs
			ZXRlTGluZSIsICJDdHJsLVoiOiAidW5kbyIsICJTaGlmdC1DdHJsLVoiOiAicmVkbyIsICJDdHJs
			LVkiOiAicmVkbyIsCiAgICAiQ3RybC1Ib21lIjogImdvRG9jU3RhcnQiLCAiQWx0LVVwIjogImdv
			RG9jU3RhcnQiLCAiQ3RybC1FbmQiOiAiZ29Eb2NFbmQiLCAiQ3RybC1Eb3duIjogImdvRG9jRW5k
			IiwKICAgICJDdHJsLUxlZnQiOiAiZ29Xb3JkTGVmdCIsICJDdHJsLVJpZ2h0IjogImdvV29yZFJp
			Z2h0IiwgIkFsdC1MZWZ0IjogImdvTGluZVN0YXJ0IiwgIkFsdC1SaWdodCI6ICJnb0xpbmVFbmQi
			LAogICAgIkN0cmwtQmFja3NwYWNlIjogImRlbFdvcmRMZWZ0IiwgIkN0cmwtRGVsZXRlIjogImRl
			bFdvcmRSaWdodCIsICJDdHJsLVMiOiAic2F2ZSIsICJDdHJsLUYiOiAiZmluZCIsCiAgICAiQ3Ry
			bC1HIjogImZpbmROZXh0IiwgIlNoaWZ0LUN0cmwtRyI6ICJmaW5kUHJldiIsICJTaGlmdC1DdHJs
			LUYiOiAicmVwbGFjZSIsICJTaGlmdC1DdHJsLVIiOiAicmVwbGFjZUFsbCIsCiAgICBmYWxsdGhy
			b3VnaDogImJhc2ljIgogIH07CiAga2V5TWFwLm1hY0RlZmF1bHQgPSB7CiAgICAiQ21kLUEiOiAi
			c2VsZWN0QWxsIiwgIkNtZC1EIjogImRlbGV0ZUxpbmUiLCAiQ21kLVoiOiAidW5kbyIsICJTaGlm
			dC1DbWQtWiI6ICJyZWRvIiwgIkNtZC1ZIjogInJlZG8iLAogICAgIkNtZC1VcCI6ICJnb0RvY1N0
			YXJ0IiwgIkNtZC1FbmQiOiAiZ29Eb2NFbmQiLCAiQ21kLURvd24iOiAiZ29Eb2NFbmQiLCAiQWx0
			LUxlZnQiOiAiZ29Xb3JkTGVmdCIsCiAgICAiQWx0LVJpZ2h0IjogImdvV29yZFJpZ2h0IiwgIkNt
			ZC1MZWZ0IjogImdvTGluZVN0YXJ0IiwgIkNtZC1SaWdodCI6ICJnb0xpbmVFbmQiLCAiQWx0LUJh
			Y2tzcGFjZSI6ICJkZWxXb3JkTGVmdCIsCiAgICAiQ3RybC1BbHQtQmFja3NwYWNlIjogImRlbFdv
			cmRSaWdodCIsICJBbHQtRGVsZXRlIjogImRlbFdvcmRSaWdodCIsICJDbWQtUyI6ICJzYXZlIiwg
			IkNtZC1GIjogImZpbmQiLAogICAgIkNtZC1HIjogImZpbmROZXh0IiwgIlNoaWZ0LUNtZC1HIjog
			ImZpbmRQcmV2IiwgIkNtZC1BbHQtRiI6ICJyZXBsYWNlIiwgIlNoaWZ0LUNtZC1BbHQtRiI6ICJy
			ZXBsYWNlQWxsIiwKICAgIGZhbGx0aHJvdWdoOiBbImJhc2ljIiwgImVtYWNzeSJdCiAgfTsKICBr
			ZXlNYXBbImRlZmF1bHQiXSA9IG1hYyA/IGtleU1hcC5tYWNEZWZhdWx0IDoga2V5TWFwLnBjRGVm
			YXVsdDsKICBrZXlNYXAuZW1hY3N5ID0gewogICAgIkN0cmwtRiI6ICJnb0NoYXJSaWdodCIsICJD
			dHJsLUIiOiAiZ29DaGFyTGVmdCIsICJDdHJsLVAiOiAiZ29MaW5lVXAiLCAiQ3RybC1OIjogImdv
			TGluZURvd24iLAogICAgIkFsdC1GIjogImdvV29yZFJpZ2h0IiwgIkFsdC1CIjogImdvV29yZExl
			ZnQiLCAiQ3RybC1BIjogImdvTGluZVN0YXJ0IiwgIkN0cmwtRSI6ICJnb0xpbmVFbmQiLAogICAg
			IkN0cmwtViI6ICJnb1BhZ2VVcCIsICJTaGlmdC1DdHJsLVYiOiAiZ29QYWdlRG93biIsICJDdHJs
			LUQiOiAiZGVsQ2hhclJpZ2h0IiwgIkN0cmwtSCI6ICJkZWxDaGFyTGVmdCIsCiAgICAiQWx0LUQi
			OiAiZGVsV29yZFJpZ2h0IiwgIkFsdC1CYWNrc3BhY2UiOiAiZGVsV29yZExlZnQiLCAiQ3RybC1L
			IjogImtpbGxMaW5lIiwgIkN0cmwtVCI6ICJ0cmFuc3Bvc2VDaGFycyIKICB9OwoKICBmdW5jdGlv
			biBnZXRLZXlNYXAodmFsKSB7CiAgICBpZiAodHlwZW9mIHZhbCA9PSAic3RyaW5nIikgcmV0dXJu
			IGtleU1hcFt2YWxdOwogICAgZWxzZSByZXR1cm4gdmFsOwogIH0KICBmdW5jdGlvbiBsb29rdXBL
			ZXkobmFtZSwgZXh0cmFNYXAsIG1hcCwgaGFuZGxlKSB7CiAgICBmdW5jdGlvbiBsb29rdXAobWFw
			KSB7CiAgICAgIG1hcCA9IGdldEtleU1hcChtYXApOwogICAgICB2YXIgZm91bmQgPSBtYXBbbmFt
			ZV07CiAgICAgIGlmIChmb3VuZCAhPSBudWxsICYmIGhhbmRsZShmb3VuZCkpIHJldHVybiB0cnVl
			OwogICAgICBpZiAobWFwLmNhdGNoYWxsKSByZXR1cm4gaGFuZGxlKG1hcC5jYXRjaGFsbCk7CiAg
			ICAgIHZhciBmYWxsdGhyb3VnaCA9IG1hcC5mYWxsdGhyb3VnaDsKICAgICAgaWYgKGZhbGx0aHJv
			dWdoID09IG51bGwpIHJldHVybiBmYWxzZTsKICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9T
			dHJpbmcuY2FsbChmYWxsdGhyb3VnaCkgIT0gIltvYmplY3QgQXJyYXldIikKICAgICAgICByZXR1
			cm4gbG9va3VwKGZhbGx0aHJvdWdoKTsKICAgICAgZm9yICh2YXIgaSA9IDAsIGUgPSBmYWxsdGhy
			b3VnaC5sZW5ndGg7IGkgPCBlOyArK2kpIHsKICAgICAgICBpZiAobG9va3VwKGZhbGx0aHJvdWdo
			W2ldKSkgcmV0dXJuIHRydWU7CiAgICAgIH0KICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAg
			aWYgKGV4dHJhTWFwICYmIGxvb2t1cChleHRyYU1hcCkpIHJldHVybiB0cnVlOwogICAgcmV0dXJu
			IGxvb2t1cChtYXApOwogIH0KICBmdW5jdGlvbiBpc01vZGlmaWVyS2V5KGV2ZW50KSB7CiAgICB2
			YXIgbmFtZSA9IGtleU5hbWVzW2VfcHJvcChldmVudCwgImtleUNvZGUiKV07CiAgICByZXR1cm4g
			bmFtZSA9PSAiQ3RybCIgfHwgbmFtZSA9PSAiQWx0IiB8fCBuYW1lID09ICJTaGlmdCIgfHwgbmFt
			ZSA9PSAiTW9kIjsKICB9CgogIENvZGVNaXJyb3IuZnJvbVRleHRBcmVhID0gZnVuY3Rpb24odGV4
			dGFyZWEsIG9wdGlvbnMpIHsKICAgIGlmICghb3B0aW9ucykgb3B0aW9ucyA9IHt9OwogICAgb3B0
			aW9ucy52YWx1ZSA9IHRleHRhcmVhLnZhbHVlOwogICAgaWYgKCFvcHRpb25zLnRhYmluZGV4ICYm
			IHRleHRhcmVhLnRhYmluZGV4KQogICAgICBvcHRpb25zLnRhYmluZGV4ID0gdGV4dGFyZWEudGFi
			aW5kZXg7CgogICAgZnVuY3Rpb24gc2F2ZSgpIHt0ZXh0YXJlYS52YWx1ZSA9IGluc3RhbmNlLmdl
			dFZhbHVlKCk7fQogICAgaWYgKHRleHRhcmVhLmZvcm0pIHsKICAgICAgLy8gRGVwbG9yYWJsZSBo
			YWNrIHRvIG1ha2UgdGhlIHN1Ym1pdCBtZXRob2QgZG8gdGhlIHJpZ2h0IHRoaW5nLgogICAgICB2
			YXIgcm1TdWJtaXQgPSBjb25uZWN0KHRleHRhcmVhLmZvcm0sICJzdWJtaXQiLCBzYXZlLCB0cnVl
			KTsKICAgICAgaWYgKHR5cGVvZiB0ZXh0YXJlYS5mb3JtLnN1Ym1pdCA9PSAiZnVuY3Rpb24iKSB7
			CiAgICAgICAgdmFyIHJlYWxTdWJtaXQgPSB0ZXh0YXJlYS5mb3JtLnN1Ym1pdDsKICAgICAgICBm
			dW5jdGlvbiB3cmFwcGVkU3VibWl0KCkgewogICAgICAgICAgc2F2ZSgpOwogICAgICAgICAgdGV4
			dGFyZWEuZm9ybS5zdWJtaXQgPSByZWFsU3VibWl0OwogICAgICAgICAgdGV4dGFyZWEuZm9ybS5z
			dWJtaXQoKTsKICAgICAgICAgIHRleHRhcmVhLmZvcm0uc3VibWl0ID0gd3JhcHBlZFN1Ym1pdDsK
			ICAgICAgICB9CiAgICAgICAgdGV4dGFyZWEuZm9ybS5zdWJtaXQgPSB3cmFwcGVkU3VibWl0Owog
			ICAgICB9CiAgICB9CgogICAgdGV4dGFyZWEuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgIHZh
			ciBpbnN0YW5jZSA9IENvZGVNaXJyb3IoZnVuY3Rpb24obm9kZSkgewogICAgICB0ZXh0YXJlYS5w
			YXJlbnROb2RlLmluc2VydEJlZm9yZShub2RlLCB0ZXh0YXJlYS5uZXh0U2libGluZyk7CiAgICB9
			LCBvcHRpb25zKTsKICAgIGluc3RhbmNlLnNhdmUgPSBzYXZlOwogICAgaW5zdGFuY2UuZ2V0VGV4
			dEFyZWEgPSBmdW5jdGlvbigpIHsgcmV0dXJuIHRleHRhcmVhOyB9OwogICAgaW5zdGFuY2UudG9U
			ZXh0QXJlYSA9IGZ1bmN0aW9uKCkgewogICAgICBzYXZlKCk7CiAgICAgIHRleHRhcmVhLnBhcmVu
			dE5vZGUucmVtb3ZlQ2hpbGQoaW5zdGFuY2UuZ2V0V3JhcHBlckVsZW1lbnQoKSk7CiAgICAgIHRl
			eHRhcmVhLnN0eWxlLmRpc3BsYXkgPSAiIjsKICAgICAgaWYgKHRleHRhcmVhLmZvcm0pIHsKICAg
			ICAgICBybVN1Ym1pdCgpOwogICAgICAgIGlmICh0eXBlb2YgdGV4dGFyZWEuZm9ybS5zdWJtaXQg
			PT0gImZ1bmN0aW9uIikKICAgICAgICAgIHRleHRhcmVhLmZvcm0uc3VibWl0ID0gcmVhbFN1Ym1p
			dDsKICAgICAgfQogICAgfTsKICAgIHJldHVybiBpbnN0YW5jZTsKICB9OwoKICAvLyBVdGlsaXR5
			IGZ1bmN0aW9ucyBmb3Igd29ya2luZyB3aXRoIHN0YXRlLiBFeHBvcnRlZCBiZWNhdXNlIG1vZGVz
			CiAgLy8gc29tZXRpbWVzIG5lZWQgdG8gZG8gdGhpcy4KICBmdW5jdGlvbiBjb3B5U3RhdGUobW9k
			ZSwgc3RhdGUpIHsKICAgIGlmIChzdGF0ZSA9PT0gdHJ1ZSkgcmV0dXJuIHN0YXRlOwogICAgaWYg
			KG1vZGUuY29weVN0YXRlKSByZXR1cm4gbW9kZS5jb3B5U3RhdGUoc3RhdGUpOwogICAgdmFyIG5z
			dGF0ZSA9IHt9OwogICAgZm9yICh2YXIgbiBpbiBzdGF0ZSkgewogICAgICB2YXIgdmFsID0gc3Rh
			dGVbbl07CiAgICAgIGlmICh2YWwgaW5zdGFuY2VvZiBBcnJheSkgdmFsID0gdmFsLmNvbmNhdChb
			XSk7CiAgICAgIG5zdGF0ZVtuXSA9IHZhbDsKICAgIH0KICAgIHJldHVybiBuc3RhdGU7CiAgfQog
			IENvZGVNaXJyb3IuY29weVN0YXRlID0gY29weVN0YXRlOwogIGZ1bmN0aW9uIHN0YXJ0U3RhdGUo
			bW9kZSwgYTEsIGEyKSB7CiAgICByZXR1cm4gbW9kZS5zdGFydFN0YXRlID8gbW9kZS5zdGFydFN0
			YXRlKGExLCBhMikgOiB0cnVlOwogIH0KICBDb2RlTWlycm9yLnN0YXJ0U3RhdGUgPSBzdGFydFN0
			YXRlOwoKICAvLyBUaGUgY2hhcmFjdGVyIHN0cmVhbSB1c2VkIGJ5IGEgbW9kZSdzIHBhcnNlci4K
			ICBmdW5jdGlvbiBTdHJpbmdTdHJlYW0oc3RyaW5nLCB0YWJTaXplKSB7CiAgICB0aGlzLnBvcyA9
			IHRoaXMuc3RhcnQgPSAwOwogICAgdGhpcy5zdHJpbmcgPSBzdHJpbmc7CiAgICB0aGlzLnRhYlNp
			emUgPSB0YWJTaXplIHx8IDg7CiAgfQogIFN0cmluZ1N0cmVhbS5wcm90b3R5cGUgPSB7CiAgICBl
			b2w6IGZ1bmN0aW9uKCkge3JldHVybiB0aGlzLnBvcyA+PSB0aGlzLnN0cmluZy5sZW5ndGg7fSwK
			ICAgIHNvbDogZnVuY3Rpb24oKSB7cmV0dXJuIHRoaXMucG9zID09IDA7fSwKICAgIHBlZWs6IGZ1
			bmN0aW9uKCkge3JldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpO30sCiAgICBuZXh0
			OiBmdW5jdGlvbigpIHsKICAgICAgaWYgKHRoaXMucG9zIDwgdGhpcy5zdHJpbmcubGVuZ3RoKQog
			ICAgICAgIHJldHVybiB0aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MrKyk7CiAgICB9LAogICAg
			ZWF0OiBmdW5jdGlvbihtYXRjaCkgewogICAgICB2YXIgY2ggPSB0aGlzLnN0cmluZy5jaGFyQXQo
			dGhpcy5wb3MpOwogICAgICBpZiAodHlwZW9mIG1hdGNoID09ICJzdHJpbmciKSB2YXIgb2sgPSBj
			aCA9PSBtYXRjaDsKICAgICAgZWxzZSB2YXIgb2sgPSBjaCAmJiAobWF0Y2gudGVzdCA/IG1hdGNo
			LnRlc3QoY2gpIDogbWF0Y2goY2gpKTsKICAgICAgaWYgKG9rKSB7Kyt0aGlzLnBvczsgcmV0dXJu
			IGNoO30KICAgIH0sCiAgICBlYXRXaGlsZTogZnVuY3Rpb24obWF0Y2gpIHsKICAgICAgdmFyIHN0
			YXJ0ID0gdGhpcy5wb3M7CiAgICAgIHdoaWxlICh0aGlzLmVhdChtYXRjaCkpe30KICAgICAgcmV0
			dXJuIHRoaXMucG9zID4gc3RhcnQ7CiAgICB9LAogICAgZWF0U3BhY2U6IGZ1bmN0aW9uKCkgewog
			ICAgICB2YXIgc3RhcnQgPSB0aGlzLnBvczsKICAgICAgd2hpbGUgKC9bXHNcdTAwYTBdLy50ZXN0
			KHRoaXMuc3RyaW5nLmNoYXJBdCh0aGlzLnBvcykpKSArK3RoaXMucG9zOwogICAgICByZXR1cm4g
			dGhpcy5wb3MgPiBzdGFydDsKICAgIH0sCiAgICBza2lwVG9FbmQ6IGZ1bmN0aW9uKCkge3RoaXMu
			cG9zID0gdGhpcy5zdHJpbmcubGVuZ3RoO30sCiAgICBza2lwVG86IGZ1bmN0aW9uKGNoKSB7CiAg
			ICAgIHZhciBmb3VuZCA9IHRoaXMuc3RyaW5nLmluZGV4T2YoY2gsIHRoaXMucG9zKTsKICAgICAg
			aWYgKGZvdW5kID4gLTEpIHt0aGlzLnBvcyA9IGZvdW5kOyByZXR1cm4gdHJ1ZTt9CiAgICB9LAog
			ICAgYmFja1VwOiBmdW5jdGlvbihuKSB7dGhpcy5wb3MgLT0gbjt9LAogICAgY29sdW1uOiBmdW5j
			dGlvbigpIHtyZXR1cm4gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsIHRoaXMuc3RhcnQsIHRoaXMu
			dGFiU2l6ZSk7fSwKICAgIGluZGVudGF0aW9uOiBmdW5jdGlvbigpIHtyZXR1cm4gY291bnRDb2x1
			bW4odGhpcy5zdHJpbmcsIG51bGwsIHRoaXMudGFiU2l6ZSk7fSwKICAgIG1hdGNoOiBmdW5jdGlv
			bihwYXR0ZXJuLCBjb25zdW1lLCBjYXNlSW5zZW5zaXRpdmUpIHsKICAgICAgaWYgKHR5cGVvZiBw
			YXR0ZXJuID09ICJzdHJpbmciKSB7CiAgICAgICAgZnVuY3Rpb24gY2FzZWQoc3RyKSB7cmV0dXJu
			IGNhc2VJbnNlbnNpdGl2ZSA/IHN0ci50b0xvd2VyQ2FzZSgpIDogc3RyO30KICAgICAgICBpZiAo
			Y2FzZWQodGhpcy5zdHJpbmcpLmluZGV4T2YoY2FzZWQocGF0dGVybiksIHRoaXMucG9zKSA9PSB0
			aGlzLnBvcykgewogICAgICAgICAgaWYgKGNvbnN1bWUgIT09IGZhbHNlKSB0aGlzLnBvcyArPSBw
			YXR0ZXJuLmxlbmd0aDsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQog
			ICAgICBlbHNlIHsKICAgICAgICB2YXIgbWF0Y2ggPSB0aGlzLnN0cmluZy5zbGljZSh0aGlzLnBv
			cykubWF0Y2gocGF0dGVybik7CiAgICAgICAgaWYgKG1hdGNoICYmIGNvbnN1bWUgIT09IGZhbHNl
			KSB0aGlzLnBvcyArPSBtYXRjaFswXS5sZW5ndGg7CiAgICAgICAgcmV0dXJuIG1hdGNoOwogICAg
			ICB9CiAgICB9LAogICAgY3VycmVudDogZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zdHJpbmcuc2xp
			Y2UodGhpcy5zdGFydCwgdGhpcy5wb3MpO30KICB9OwogIENvZGVNaXJyb3IuU3RyaW5nU3RyZWFt
			ID0gU3RyaW5nU3RyZWFtOwoKICBmdW5jdGlvbiBNYXJrZWRUZXh0KGZyb20sIHRvLCBjbGFzc05h
			bWUsIHNldCkgewogICAgdGhpcy5mcm9tID0gZnJvbTsgdGhpcy50byA9IHRvOyB0aGlzLnN0eWxl
			ID0gY2xhc3NOYW1lOyB0aGlzLnNldCA9IHNldDsKICB9CiAgTWFya2VkVGV4dC5wcm90b3R5cGUg
			PSB7CiAgICBhdHRhY2g6IGZ1bmN0aW9uKGxpbmUpIHsgdGhpcy5zZXQucHVzaChsaW5lKTsgfSwK
			ICAgIGRldGFjaDogZnVuY3Rpb24obGluZSkgewogICAgICB2YXIgaXggPSBpbmRleE9mKHRoaXMu
			c2V0LCBsaW5lKTsKICAgICAgaWYgKGl4ID4gLTEpIHRoaXMuc2V0LnNwbGljZShpeCwgMSk7CiAg
			ICB9LAogICAgc3BsaXQ6IGZ1bmN0aW9uKHBvcywgbGVuQmVmb3JlKSB7CiAgICAgIGlmICh0aGlz
			LnRvIDw9IHBvcyAmJiB0aGlzLnRvICE9IG51bGwpIHJldHVybiBudWxsOwogICAgICB2YXIgZnJv
			bSA9IHRoaXMuZnJvbSA8IHBvcyB8fCB0aGlzLmZyb20gPT0gbnVsbCA/IG51bGwgOiB0aGlzLmZy
			b20gLSBwb3MgKyBsZW5CZWZvcmU7CiAgICAgIHZhciB0byA9IHRoaXMudG8gPT0gbnVsbCA/IG51
			bGwgOiB0aGlzLnRvIC0gcG9zICsgbGVuQmVmb3JlOwogICAgICByZXR1cm4gbmV3IE1hcmtlZFRl
			eHQoZnJvbSwgdG8sIHRoaXMuc3R5bGUsIHRoaXMuc2V0KTsKICAgIH0sCiAgICBkdXA6IGZ1bmN0
			aW9uKCkgeyByZXR1cm4gbmV3IE1hcmtlZFRleHQobnVsbCwgbnVsbCwgdGhpcy5zdHlsZSwgdGhp
			cy5zZXQpOyB9LAogICAgY2xpcFRvOiBmdW5jdGlvbihmcm9tT3BlbiwgZnJvbSwgdG9PcGVuLCB0
			bywgZGlmZikgewogICAgICBpZiAodGhpcy5mcm9tICE9IG51bGwgJiYgdGhpcy5mcm9tID49IGZy
			b20pCiAgICAgICAgdGhpcy5mcm9tID0gTWF0aC5tYXgodG8sIHRoaXMuZnJvbSkgKyBkaWZmOwog
			ICAgICBpZiAodGhpcy50byAhPSBudWxsICYmIHRoaXMudG8gPiBmcm9tKQogICAgICAgIHRoaXMu
			dG8gPSB0byA8IHRoaXMudG8gPyB0aGlzLnRvICsgZGlmZiA6IGZyb207CiAgICAgIGlmIChmcm9t
			T3BlbiAmJiB0byA+IHRoaXMuZnJvbSAmJiAodG8gPCB0aGlzLnRvIHx8IHRoaXMudG8gPT0gbnVs
			bCkpCiAgICAgICAgdGhpcy5mcm9tID0gbnVsbDsKICAgICAgaWYgKHRvT3BlbiAmJiAoZnJvbSA8
			IHRoaXMudG8gfHwgdGhpcy50byA9PSBudWxsKSAmJiAoZnJvbSA+IHRoaXMuZnJvbSB8fCB0aGlz
			LmZyb20gPT0gbnVsbCkpCiAgICAgICAgdGhpcy50byA9IG51bGw7CiAgICB9LAogICAgaXNEZWFk
			OiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuZnJvbSAhPSBudWxsICYmIHRoaXMudG8gIT0gbnVs
			bCAmJiB0aGlzLmZyb20gPj0gdGhpcy50bzsgfSwKICAgIHNhbWVTZXQ6IGZ1bmN0aW9uKHgpIHsg
			cmV0dXJuIHRoaXMuc2V0ID09IHguc2V0OyB9CiAgfTsKCiAgZnVuY3Rpb24gQm9va21hcmsocG9z
			KSB7CiAgICB0aGlzLmZyb20gPSBwb3M7IHRoaXMudG8gPSBwb3M7IHRoaXMubGluZSA9IG51bGw7
			CiAgfQogIEJvb2ttYXJrLnByb3RvdHlwZSA9IHsKICAgIGF0dGFjaDogZnVuY3Rpb24obGluZSkg
			eyB0aGlzLmxpbmUgPSBsaW5lOyB9LAogICAgZGV0YWNoOiBmdW5jdGlvbihsaW5lKSB7IGlmICh0
			aGlzLmxpbmUgPT0gbGluZSkgdGhpcy5saW5lID0gbnVsbDsgfSwKICAgIHNwbGl0OiBmdW5jdGlv
			bihwb3MsIGxlbkJlZm9yZSkgewogICAgICBpZiAocG9zIDwgdGhpcy5mcm9tKSB7CiAgICAgICAg
			dGhpcy5mcm9tID0gdGhpcy50byA9ICh0aGlzLmZyb20gLSBwb3MpICsgbGVuQmVmb3JlOwogICAg
			ICAgIHJldHVybiB0aGlzOwogICAgICB9CiAgICB9LAogICAgaXNEZWFkOiBmdW5jdGlvbigpIHsg
			cmV0dXJuIHRoaXMuZnJvbSA+IHRoaXMudG87IH0sCiAgICBjbGlwVG86IGZ1bmN0aW9uKGZyb21P
			cGVuLCBmcm9tLCB0b09wZW4sIHRvLCBkaWZmKSB7CiAgICAgIGlmICgoZnJvbU9wZW4gfHwgZnJv
			bSA8IHRoaXMuZnJvbSkgJiYgKHRvT3BlbiB8fCB0byA+IHRoaXMudG8pKSB7CiAgICAgICAgdGhp
			cy5mcm9tID0gMDsgdGhpcy50byA9IC0xOwogICAgICB9IGVsc2UgaWYgKHRoaXMuZnJvbSA+IGZy
			b20pIHsKICAgICAgICB0aGlzLmZyb20gPSB0aGlzLnRvID0gTWF0aC5tYXgodG8sIHRoaXMuZnJv
			bSkgKyBkaWZmOwogICAgICB9CiAgICB9LAogICAgc2FtZVNldDogZnVuY3Rpb24oeCkgeyByZXR1
			cm4gZmFsc2U7IH0sCiAgICBmaW5kOiBmdW5jdGlvbigpIHsKICAgICAgaWYgKCF0aGlzLmxpbmUg
			fHwgIXRoaXMubGluZS5wYXJlbnQpIHJldHVybiBudWxsOwogICAgICByZXR1cm4ge2xpbmU6IGxp
			bmVObyh0aGlzLmxpbmUpLCBjaDogdGhpcy5mcm9tfTsKICAgIH0sCiAgICBjbGVhcjogZnVuY3Rp
			b24oKSB7CiAgICAgIGlmICh0aGlzLmxpbmUpIHsKICAgICAgICB2YXIgZm91bmQgPSBpbmRleE9m
			KHRoaXMubGluZS5tYXJrZWQsIHRoaXMpOwogICAgICAgIGlmIChmb3VuZCAhPSAtMSkgdGhpcy5s
			aW5lLm1hcmtlZC5zcGxpY2UoZm91bmQsIDEpOwogICAgICAgIHRoaXMubGluZSA9IG51bGw7CiAg
			ICAgIH0KICAgIH0KICB9OwoKICAvLyBMaW5lIG9iamVjdHMuIFRoZXNlIGhvbGQgc3RhdGUgcmVs
			YXRlZCB0byBhIGxpbmUsIGluY2x1ZGluZwogIC8vIGhpZ2hsaWdodGluZyBpbmZvICh0aGUgc3R5
			bGVzIGFycmF5KS4KICBmdW5jdGlvbiBMaW5lKHRleHQsIHN0eWxlcykgewogICAgdGhpcy5zdHls
			ZXMgPSBzdHlsZXMgfHwgW3RleHQsIG51bGxdOwogICAgdGhpcy50ZXh0ID0gdGV4dDsKICAgIHRo
			aXMuaGVpZ2h0ID0gMTsKICAgIHRoaXMubWFya2VkID0gdGhpcy5ndXR0ZXJNYXJrZXIgPSB0aGlz
			LmNsYXNzTmFtZSA9IHRoaXMuaGFuZGxlcnMgPSBudWxsOwogICAgdGhpcy5zdGF0ZUFmdGVyID0g
			dGhpcy5wYXJlbnQgPSB0aGlzLmhpZGRlbiA9IG51bGw7CiAgfQogIExpbmUuaW5oZXJpdE1hcmtz
			ID0gZnVuY3Rpb24odGV4dCwgb3JpZykgewogICAgdmFyIGxuID0gbmV3IExpbmUodGV4dCksIG1r
			ID0gb3JpZyAmJiBvcmlnLm1hcmtlZDsKICAgIGlmIChtaykgewogICAgICBmb3IgKHZhciBpID0g
			MDsgaSA8IG1rLmxlbmd0aDsgKytpKSB7CiAgICAgICAgaWYgKG1rW2ldLnRvID09IG51bGwgJiYg
			bWtbaV0uc3R5bGUpIHsKICAgICAgICAgIHZhciBuZXdtayA9IGxuLm1hcmtlZCB8fCAobG4ubWFy
			a2VkID0gW10pLCBtYXJrID0gbWtbaV07CiAgICAgICAgICB2YXIgbm1hcmsgPSBtYXJrLmR1cCgp
			OyBuZXdtay5wdXNoKG5tYXJrKTsgbm1hcmsuYXR0YWNoKGxuKTsKICAgICAgICB9CiAgICAgIH0K
			ICAgIH0KICAgIHJldHVybiBsbjsKICB9CiAgTGluZS5wcm90b3R5cGUgPSB7CiAgICAvLyBSZXBs
			YWNlIGEgcGllY2Ugb2YgYSBsaW5lLCBrZWVwaW5nIHRoZSBzdHlsZXMgYXJvdW5kIGl0IGludGFj
			dC4KICAgIHJlcGxhY2U6IGZ1bmN0aW9uKGZyb20sIHRvXywgdGV4dCkgewogICAgICB2YXIgc3Qg
			PSBbXSwgbWsgPSB0aGlzLm1hcmtlZCwgdG8gPSB0b18gPT0gbnVsbCA/IHRoaXMudGV4dC5sZW5n
			dGggOiB0b187CiAgICAgIGNvcHlTdHlsZXMoMCwgZnJvbSwgdGhpcy5zdHlsZXMsIHN0KTsKICAg
			ICAgaWYgKHRleHQpIHN0LnB1c2godGV4dCwgbnVsbCk7CiAgICAgIGNvcHlTdHlsZXModG8sIHRo
			aXMudGV4dC5sZW5ndGgsIHRoaXMuc3R5bGVzLCBzdCk7CiAgICAgIHRoaXMuc3R5bGVzID0gc3Q7
			CiAgICAgIHRoaXMudGV4dCA9IHRoaXMudGV4dC5zbGljZSgwLCBmcm9tKSArIHRleHQgKyB0aGlz
			LnRleHQuc2xpY2UodG8pOwogICAgICB0aGlzLnN0YXRlQWZ0ZXIgPSBudWxsOwogICAgICBpZiAo
			bWspIHsKICAgICAgICB2YXIgZGlmZiA9IHRleHQubGVuZ3RoIC0gKHRvIC0gZnJvbSk7CiAgICAg
			ICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtay5sZW5ndGg7ICsraSkgewogICAgICAgICAgdmFyIG1h
			cmsgPSBta1tpXTsKICAgICAgICAgIG1hcmsuY2xpcFRvKGZyb20gPT0gbnVsbCwgZnJvbSB8fCAw
			LCB0b18gPT0gbnVsbCwgdG8sIGRpZmYpOwogICAgICAgICAgaWYgKG1hcmsuaXNEZWFkKCkpIHtt
			YXJrLmRldGFjaCh0aGlzKTsgbWsuc3BsaWNlKGktLSwgMSk7fQogICAgICAgIH0KICAgICAgfQog
			ICAgfSwKICAgIC8vIFNwbGl0IGEgcGFydCBvZmYgYSBsaW5lLCBrZWVwaW5nIHN0eWxlcyBhbmQg
			bWFya2VycyBpbnRhY3QuCiAgICBzcGxpdDogZnVuY3Rpb24ocG9zLCB0ZXh0QmVmb3JlKSB7CiAg
			ICAgIHZhciBzdCA9IFt0ZXh0QmVmb3JlLCBudWxsXSwgbWsgPSB0aGlzLm1hcmtlZDsKICAgICAg
			Y29weVN0eWxlcyhwb3MsIHRoaXMudGV4dC5sZW5ndGgsIHRoaXMuc3R5bGVzLCBzdCk7CiAgICAg
			IHZhciB0YWtlbiA9IG5ldyBMaW5lKHRleHRCZWZvcmUgKyB0aGlzLnRleHQuc2xpY2UocG9zKSwg
			c3QpOwogICAgICBpZiAobWspIHsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1rLmxlbmd0
			aDsgKytpKSB7CiAgICAgICAgICB2YXIgbWFyayA9IG1rW2ldOwogICAgICAgICAgdmFyIG5ld21h
			cmsgPSBtYXJrLnNwbGl0KHBvcywgdGV4dEJlZm9yZS5sZW5ndGgpOwogICAgICAgICAgaWYgKG5l
			d21hcmspIHsKICAgICAgICAgICAgaWYgKCF0YWtlbi5tYXJrZWQpIHRha2VuLm1hcmtlZCA9IFtd
			OwogICAgICAgICAgICB0YWtlbi5tYXJrZWQucHVzaChuZXdtYXJrKTsgbmV3bWFyay5hdHRhY2go
			dGFrZW4pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gdGFrZW47
			CiAgICB9LAogICAgYXBwZW5kOiBmdW5jdGlvbihsaW5lKSB7CiAgICAgIHZhciBteWxlbiA9IHRo
			aXMudGV4dC5sZW5ndGgsIG1rID0gbGluZS5tYXJrZWQsIG15bWsgPSB0aGlzLm1hcmtlZDsKICAg
			ICAgdGhpcy50ZXh0ICs9IGxpbmUudGV4dDsKICAgICAgY29weVN0eWxlcygwLCBsaW5lLnRleHQu
			bGVuZ3RoLCBsaW5lLnN0eWxlcywgdGhpcy5zdHlsZXMpOwogICAgICBpZiAobXltaykgewogICAg
			ICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbXltay5sZW5ndGg7ICsraSkKICAgICAgICAgIGlmICht
			eW1rW2ldLnRvID09IG51bGwpIG15bWtbaV0udG8gPSBteWxlbjsKICAgICAgfQogICAgICBpZiAo
			bWsgJiYgbWsubGVuZ3RoKSB7CiAgICAgICAgaWYgKCFteW1rKSB0aGlzLm1hcmtlZCA9IG15bWsg
			PSBbXTsKICAgICAgICBvdXRlcjogZm9yICh2YXIgaSA9IDA7IGkgPCBtay5sZW5ndGg7ICsraSkg
			ewogICAgICAgICAgdmFyIG1hcmsgPSBta1tpXTsKICAgICAgICAgIGlmICghbWFyay5mcm9tKSB7
			CiAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbXltay5sZW5ndGg7ICsraikgewogICAg
			ICAgICAgICAgIHZhciBteW1hcmsgPSBteW1rW2pdOwogICAgICAgICAgICAgIGlmIChteW1hcmsu
			dG8gPT0gbXlsZW4gJiYgbXltYXJrLnNhbWVTZXQobWFyaykpIHsKICAgICAgICAgICAgICAgIG15
			bWFyay50byA9IG1hcmsudG8gPT0gbnVsbCA/IG51bGwgOiBtYXJrLnRvICsgbXlsZW47CiAgICAg
			ICAgICAgICAgICBpZiAobXltYXJrLmlzRGVhZCgpKSB7CiAgICAgICAgICAgICAgICAgIG15bWFy
			ay5kZXRhY2godGhpcyk7CiAgICAgICAgICAgICAgICAgIG1rLnNwbGljZShpLS0sIDEpOwogICAg
			ICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgY29udGludWUgb3V0ZXI7CiAgICAgICAgICAg
			ICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBteW1rLnB1c2gobWFyayk7
			CiAgICAgICAgICBtYXJrLmF0dGFjaCh0aGlzKTsKICAgICAgICAgIG1hcmsuZnJvbSArPSBteWxl
			bjsKICAgICAgICAgIGlmIChtYXJrLnRvICE9IG51bGwpIG1hcmsudG8gKz0gbXlsZW47CiAgICAg
			ICAgfQogICAgICB9CiAgICB9LAogICAgZml4TWFya0VuZHM6IGZ1bmN0aW9uKG90aGVyKSB7CiAg
			ICAgIHZhciBtayA9IHRoaXMubWFya2VkLCBvbWsgPSBvdGhlci5tYXJrZWQ7CiAgICAgIGlmICgh
			bWspIHJldHVybjsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtay5sZW5ndGg7ICsraSkgewog
			ICAgICAgIHZhciBtYXJrID0gbWtbaV0sIGNsb3NlID0gbWFyay50byA9PSBudWxsOwogICAgICAg
			IGlmIChjbG9zZSAmJiBvbWspIHsKICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgb21rLmxl
			bmd0aDsgKytqKQogICAgICAgICAgICBpZiAob21rW2pdLnNhbWVTZXQobWFyaykpIHtjbG9zZSA9
			IGZhbHNlOyBicmVhazt9CiAgICAgICAgfQogICAgICAgIGlmIChjbG9zZSkgbWFyay50byA9IHRo
			aXMudGV4dC5sZW5ndGg7CiAgICAgIH0KICAgIH0sCiAgICBmaXhNYXJrU3RhcnRzOiBmdW5jdGlv
			bigpIHsKICAgICAgdmFyIG1rID0gdGhpcy5tYXJrZWQ7CiAgICAgIGlmICghbWspIHJldHVybjsK
			ICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBtay5sZW5ndGg7ICsraSkKICAgICAgICBpZiAobWtb
			aV0uZnJvbSA9PSBudWxsKSBta1tpXS5mcm9tID0gMDsKICAgIH0sCiAgICBhZGRNYXJrOiBmdW5j
			dGlvbihtYXJrKSB7CiAgICAgIG1hcmsuYXR0YWNoKHRoaXMpOwogICAgICBpZiAodGhpcy5tYXJr
			ZWQgPT0gbnVsbCkgdGhpcy5tYXJrZWQgPSBbXTsKICAgICAgdGhpcy5tYXJrZWQucHVzaChtYXJr
			KTsKICAgICAgdGhpcy5tYXJrZWQuc29ydChmdW5jdGlvbihhLCBiKXtyZXR1cm4gKGEuZnJvbSB8
			fCAwKSAtIChiLmZyb20gfHwgMCk7fSk7CiAgICB9LAogICAgLy8gUnVuIHRoZSBnaXZlbiBtb2Rl
			J3MgcGFyc2VyIG92ZXIgYSBsaW5lLCB1cGRhdGUgdGhlIHN0eWxlcwogICAgLy8gYXJyYXksIHdo
			aWNoIGNvbnRhaW5zIGFsdGVybmF0aW5nIGZyYWdtZW50cyBvZiB0ZXh0IGFuZCBDU1MKICAgIC8v
			IGNsYXNzZXMuCiAgICBoaWdobGlnaHQ6IGZ1bmN0aW9uKG1vZGUsIHN0YXRlLCB0YWJTaXplKSB7
			CiAgICAgIHZhciBzdHJlYW0gPSBuZXcgU3RyaW5nU3RyZWFtKHRoaXMudGV4dCwgdGFiU2l6ZSks
			IHN0ID0gdGhpcy5zdHlsZXMsIHBvcyA9IDA7CiAgICAgIHZhciBjaGFuZ2VkID0gZmFsc2UsIGN1
			cldvcmQgPSBzdFswXSwgcHJldldvcmQ7CiAgICAgIGlmICh0aGlzLnRleHQgPT0gIiIgJiYgbW9k
			ZS5ibGFua0xpbmUpIG1vZGUuYmxhbmtMaW5lKHN0YXRlKTsKICAgICAgd2hpbGUgKCFzdHJlYW0u
			ZW9sKCkpIHsKICAgICAgICB2YXIgc3R5bGUgPSBtb2RlLnRva2VuKHN0cmVhbSwgc3RhdGUpOwog
			ICAgICAgIHZhciBzdWJzdHIgPSB0aGlzLnRleHQuc2xpY2Uoc3RyZWFtLnN0YXJ0LCBzdHJlYW0u
			cG9zKTsKICAgICAgICBzdHJlYW0uc3RhcnQgPSBzdHJlYW0ucG9zOwogICAgICAgIGlmIChwb3Mg
			JiYgc3RbcG9zLTFdID09IHN0eWxlKQogICAgICAgICAgc3RbcG9zLTJdICs9IHN1YnN0cjsKICAg
			ICAgICBlbHNlIGlmIChzdWJzdHIpIHsKICAgICAgICAgIGlmICghY2hhbmdlZCAmJiAoc3RbcG9z
			KzFdICE9IHN0eWxlIHx8IChwb3MgJiYgc3RbcG9zLTJdICE9IHByZXZXb3JkKSkpIGNoYW5nZWQg
			PSB0cnVlOwogICAgICAgICAgc3RbcG9zKytdID0gc3Vic3RyOyBzdFtwb3MrK10gPSBzdHlsZTsK
			ICAgICAgICAgIHByZXZXb3JkID0gY3VyV29yZDsgY3VyV29yZCA9IHN0W3Bvc107CiAgICAgICAg
			fQogICAgICAgIC8vIEdpdmUgdXAgd2hlbiBsaW5lIGlzIHJpZGljdWxvdXNseSBsb25nCiAgICAg
			ICAgaWYgKHN0cmVhbS5wb3MgPiA1MDAwKSB7CiAgICAgICAgICBzdFtwb3MrK10gPSB0aGlzLnRl
			eHQuc2xpY2Uoc3RyZWFtLnBvcyk7IHN0W3BvcysrXSA9IG51bGw7CiAgICAgICAgICBicmVhazsK
			ICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHN0Lmxlbmd0aCAhPSBwb3MpIHtzdC5sZW5ndGgg
			PSBwb3M7IGNoYW5nZWQgPSB0cnVlO30KICAgICAgaWYgKHBvcyAmJiBzdFtwb3MtMl0gIT0gcHJl
			dldvcmQpIGNoYW5nZWQgPSB0cnVlOwogICAgICAvLyBTaG9ydCBsaW5lcyB3aXRoIHNpbXBsZSBo
			aWdobGlnaHRzIHJldHVybiBudWxsLCBhbmQgYXJlCiAgICAgIC8vIGNvdW50ZWQgYXMgY2hhbmdl
			ZCBieSB0aGUgZHJpdmVyIGJlY2F1c2UgdGhleSBhcmUgbGlrZWx5IHRvCiAgICAgIC8vIGhpZ2hs
			aWdodCB0aGUgc2FtZSB3YXkgaW4gdmFyaW91cyBjb250ZXh0cy4KICAgICAgcmV0dXJuIGNoYW5n
			ZWQgfHwgKHN0Lmxlbmd0aCA8IDUgJiYgdGhpcy50ZXh0Lmxlbmd0aCA8IDEwID8gbnVsbCA6IGZh
			bHNlKTsKICAgIH0sCiAgICAvLyBGZXRjaCB0aGUgcGFyc2VyIHRva2VuIGZvciBhIGdpdmVuIGNo
			YXJhY3Rlci4gVXNlZnVsIGZvciBoYWNrcwogICAgLy8gdGhhdCB3YW50IHRvIGluc3BlY3QgdGhl
			IG1vZGUgc3RhdGUgKHNheSwgZm9yIGNvbXBsZXRpb24pLgogICAgZ2V0VG9rZW5BdDogZnVuY3Rp
			b24obW9kZSwgc3RhdGUsIGNoKSB7CiAgICAgIHZhciB0eHQgPSB0aGlzLnRleHQsIHN0cmVhbSA9
			IG5ldyBTdHJpbmdTdHJlYW0odHh0KTsKICAgICAgd2hpbGUgKHN0cmVhbS5wb3MgPCBjaCAmJiAh
			c3RyZWFtLmVvbCgpKSB7CiAgICAgICAgc3RyZWFtLnN0YXJ0ID0gc3RyZWFtLnBvczsKICAgICAg
			ICB2YXIgc3R5bGUgPSBtb2RlLnRva2VuKHN0cmVhbSwgc3RhdGUpOwogICAgICB9CiAgICAgIHJl
			dHVybiB7c3RhcnQ6IHN0cmVhbS5zdGFydCwKICAgICAgICAgICAgICBlbmQ6IHN0cmVhbS5wb3Ms
			CiAgICAgICAgICAgICAgc3RyaW5nOiBzdHJlYW0uY3VycmVudCgpLAogICAgICAgICAgICAgIGNs
			YXNzTmFtZTogc3R5bGUgfHwgbnVsbCwKICAgICAgICAgICAgICBzdGF0ZTogc3RhdGV9OwogICAg
			fSwKICAgIGluZGVudGF0aW9uOiBmdW5jdGlvbih0YWJTaXplKSB7cmV0dXJuIGNvdW50Q29sdW1u
			KHRoaXMudGV4dCwgbnVsbCwgdGFiU2l6ZSk7fSwKICAgIC8vIFByb2R1Y2VzIGFuIEhUTUwgZnJh
			Z21lbnQgZm9yIHRoZSBsaW5lLCB0YWtpbmcgc2VsZWN0aW9uLAogICAgLy8gbWFya2luZywgYW5k
			IGhpZ2hsaWdodGluZyBpbnRvIGFjY291bnQuCiAgICBnZXRIVE1MOiBmdW5jdGlvbihtYWtlVGFi
			LCBlbmRBdCkgewogICAgICB2YXIgaHRtbCA9IFtdLCBmaXJzdCA9IHRydWUsIGNvbCA9IDA7CiAg
			ICAgIGZ1bmN0aW9uIHNwYW4odGV4dCwgc3R5bGUpIHsKICAgICAgICBpZiAoIXRleHQpIHJldHVy
			bjsKICAgICAgICAvLyBXb3JrIGFyb3VuZCBhIGJ1ZyB3aGVyZSwgaW4gc29tZSBjb21wYXQgbW9k
			ZXMsIElFIGlnbm9yZXMgbGVhZGluZyBzcGFjZXMKICAgICAgICBpZiAoZmlyc3QgJiYgaWUgJiYg
			dGV4dC5jaGFyQXQoMCkgPT0gIiAiKSB0ZXh0ID0gIlx1MDBhMCIgKyB0ZXh0LnNsaWNlKDEpOwog
			ICAgICAgIGZpcnN0ID0gZmFsc2U7CiAgICAgICAgaWYgKHRleHQuaW5kZXhPZigiXHQiKSA9PSAt
			MSkgewogICAgICAgICAgY29sICs9IHRleHQubGVuZ3RoOwogICAgICAgICAgdmFyIGVzY2FwZWQg
			PSBodG1sRXNjYXBlKHRleHQpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB2YXIgZXNjYXBl
			ZCA9ICIiOwogICAgICAgICAgZm9yICh2YXIgcG9zID0gMDs7KSB7CiAgICAgICAgICAgIHZhciBp
			ZHggPSB0ZXh0LmluZGV4T2YoIlx0IiwgcG9zKTsKICAgICAgICAgICAgaWYgKGlkeCA9PSAtMSkg
			ewogICAgICAgICAgICAgIGVzY2FwZWQgKz0gaHRtbEVzY2FwZSh0ZXh0LnNsaWNlKHBvcykpOwog
			ICAgICAgICAgICAgIGNvbCArPSB0ZXh0Lmxlbmd0aCAtIHBvczsKICAgICAgICAgICAgICBicmVh
			azsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBjb2wgKz0gaWR4IC0gcG9zOwog
			ICAgICAgICAgICAgIHZhciB0YWIgPSBtYWtlVGFiKGNvbCk7CiAgICAgICAgICAgICAgZXNjYXBl
			ZCArPSBodG1sRXNjYXBlKHRleHQuc2xpY2UocG9zLCBpZHgpKSArIHRhYi5odG1sOwogICAgICAg
			ICAgICAgIGNvbCArPSB0YWIud2lkdGg7CiAgICAgICAgICAgICAgcG9zID0gaWR4ICsgMTsKICAg
			ICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoc3R5bGUpIGh0bWwu
			cHVzaCgnPHNwYW4gY2xhc3M9IicsIHN0eWxlLCAnIj4nLCBlc2NhcGVkLCAiPC9zcGFuPiIpOwog
			ICAgICAgIGVsc2UgaHRtbC5wdXNoKGVzY2FwZWQpOwogICAgICB9CiAgICAgIHZhciBzdCA9IHRo
			aXMuc3R5bGVzLCBhbGxUZXh0ID0gdGhpcy50ZXh0LCBtYXJrZWQgPSB0aGlzLm1hcmtlZDsKICAg
			ICAgdmFyIGxlbiA9IGFsbFRleHQubGVuZ3RoOwogICAgICBpZiAoZW5kQXQgIT0gbnVsbCkgbGVu
			ID0gTWF0aC5taW4oZW5kQXQsIGxlbik7CiAgICAgIGZ1bmN0aW9uIHN0eWxlVG9DbGFzcyhzdHls
			ZSkgewogICAgICAgIGlmICghc3R5bGUpIHJldHVybiBudWxsOwogICAgICAgIHJldHVybiAiY20t
			IiArIHN0eWxlLnJlcGxhY2UoLyArL2csICIgY20tIik7CiAgICAgIH0KCiAgICAgIGlmICghYWxs
			VGV4dCAmJiBlbmRBdCA9PSBudWxsKQogICAgICAgIHNwYW4oIiAiKTsKICAgICAgZWxzZSBpZiAo
			IW1hcmtlZCB8fCAhbWFya2VkLmxlbmd0aCkKICAgICAgICBmb3IgKHZhciBpID0gMCwgY2ggPSAw
			OyBjaCA8IGxlbjsgaSs9MikgewogICAgICAgICAgdmFyIHN0ciA9IHN0W2ldLCBzdHlsZSA9IHN0
			W2krMV0sIGwgPSBzdHIubGVuZ3RoOwogICAgICAgICAgaWYgKGNoICsgbCA+IGxlbikgc3RyID0g
			c3RyLnNsaWNlKDAsIGxlbiAtIGNoKTsKICAgICAgICAgIGNoICs9IGw7CiAgICAgICAgICBzcGFu
			KHN0ciwgc3R5bGVUb0NsYXNzKHN0eWxlKSk7CiAgICAgICAgfQogICAgICBlbHNlIHsKICAgICAg
			ICB2YXIgcG9zID0gMCwgaSA9IDAsIHRleHQgPSAiIiwgc3R5bGUsIHNnID0gMDsKICAgICAgICB2
			YXIgbmV4dENoYW5nZSA9IG1hcmtlZFswXS5mcm9tIHx8IDAsIG1hcmtzID0gW10sIG1hcmtwb3Mg
			PSAwOwogICAgICAgIGZ1bmN0aW9uIGFkdmFuY2VNYXJrcygpIHsKICAgICAgICAgIHZhciBtOwog
			ICAgICAgICAgd2hpbGUgKG1hcmtwb3MgPCBtYXJrZWQubGVuZ3RoICYmCiAgICAgICAgICAgICAg
			ICAgKChtID0gbWFya2VkW21hcmtwb3NdKS5mcm9tID09IHBvcyB8fCBtLmZyb20gPT0gbnVsbCkp
			IHsKICAgICAgICAgICAgaWYgKG0uc3R5bGUgIT0gbnVsbCkgbWFya3MucHVzaChtKTsKICAgICAg
			ICAgICAgKyttYXJrcG9zOwogICAgICAgICAgfQogICAgICAgICAgbmV4dENoYW5nZSA9IG1hcmtw
			b3MgPCBtYXJrZWQubGVuZ3RoID8gbWFya2VkW21hcmtwb3NdLmZyb20gOiBJbmZpbml0eTsKICAg
			ICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWFya3MubGVuZ3RoOyArK2kpIHsKICAgICAgICAg
			ICAgdmFyIHRvID0gbWFya3NbaV0udG8gfHwgSW5maW5pdHk7CiAgICAgICAgICAgIGlmICh0byA9
			PSBwb3MpIG1hcmtzLnNwbGljZShpLS0sIDEpOwogICAgICAgICAgICBlbHNlIG5leHRDaGFuZ2Ug
			PSBNYXRoLm1pbih0bywgbmV4dENoYW5nZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAg
			IHZhciBtID0gMDsKICAgICAgICB3aGlsZSAocG9zIDwgbGVuKSB7CiAgICAgICAgICBpZiAobmV4
			dENoYW5nZSA9PSBwb3MpIGFkdmFuY2VNYXJrcygpOwogICAgICAgICAgdmFyIHVwdG8gPSBNYXRo
			Lm1pbihsZW4sIG5leHRDaGFuZ2UpOwogICAgICAgICAgd2hpbGUgKHRydWUpIHsKICAgICAgICAg
			ICAgaWYgKHRleHQpIHsKICAgICAgICAgICAgICB2YXIgZW5kID0gcG9zICsgdGV4dC5sZW5ndGg7
			CiAgICAgICAgICAgICAgdmFyIGFwcGxpZWRTdHlsZSA9IHN0eWxlOwogICAgICAgICAgICAgIGZv
			ciAodmFyIGogPSAwOyBqIDwgbWFya3MubGVuZ3RoOyArK2opCiAgICAgICAgICAgICAgICBhcHBs
			aWVkU3R5bGUgPSAoYXBwbGllZFN0eWxlID8gYXBwbGllZFN0eWxlICsgIiAiIDogIiIpICsgbWFy
			a3Nbal0uc3R5bGU7CiAgICAgICAgICAgICAgc3BhbihlbmQgPiB1cHRvID8gdGV4dC5zbGljZSgw
			LCB1cHRvIC0gcG9zKSA6IHRleHQsIGFwcGxpZWRTdHlsZSk7CiAgICAgICAgICAgICAgaWYgKGVu
			ZCA+PSB1cHRvKSB7dGV4dCA9IHRleHQuc2xpY2UodXB0byAtIHBvcyk7IHBvcyA9IHVwdG87IGJy
			ZWFrO30KICAgICAgICAgICAgICBwb3MgPSBlbmQ7CiAgICAgICAgICAgIH0KICAgICAgICAgICAg
			dGV4dCA9IHN0W2krK107IHN0eWxlID0gc3R5bGVUb0NsYXNzKHN0W2krK10pOwogICAgICAgICAg
			fQogICAgICAgIH0KICAgICAgfQogICAgICByZXR1cm4gaHRtbC5qb2luKCIiKTsKICAgIH0sCiAg
			ICBjbGVhblVwOiBmdW5jdGlvbigpIHsKICAgICAgdGhpcy5wYXJlbnQgPSBudWxsOwogICAgICBp
			ZiAodGhpcy5tYXJrZWQpCiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGUgPSB0aGlzLm1hcmtlZC5s
			ZW5ndGg7IGkgPCBlOyArK2kpIHRoaXMubWFya2VkW2ldLmRldGFjaCh0aGlzKTsKICAgIH0KICB9
			OwogIC8vIFV0aWxpdHkgdXNlZCBieSByZXBsYWNlIGFuZCBzcGxpdCBhYm92ZQogIGZ1bmN0aW9u
			IGNvcHlTdHlsZXMoZnJvbSwgdG8sIHNvdXJjZSwgZGVzdCkgewogICAgZm9yICh2YXIgaSA9IDAs
			IHBvcyA9IDAsIHN0YXRlID0gMDsgcG9zIDwgdG87IGkrPTIpIHsKICAgICAgdmFyIHBhcnQgPSBz
			b3VyY2VbaV0sIGVuZCA9IHBvcyArIHBhcnQubGVuZ3RoOwogICAgICBpZiAoc3RhdGUgPT0gMCkg
			ewogICAgICAgIGlmIChlbmQgPiBmcm9tKSBkZXN0LnB1c2gocGFydC5zbGljZShmcm9tIC0gcG9z
			LCBNYXRoLm1pbihwYXJ0Lmxlbmd0aCwgdG8gLSBwb3MpKSwgc291cmNlW2krMV0pOwogICAgICAg
			IGlmIChlbmQgPj0gZnJvbSkgc3RhdGUgPSAxOwogICAgICB9CiAgICAgIGVsc2UgaWYgKHN0YXRl
			ID09IDEpIHsKICAgICAgICBpZiAoZW5kID4gdG8pIGRlc3QucHVzaChwYXJ0LnNsaWNlKDAsIHRv
			IC0gcG9zKSwgc291cmNlW2krMV0pOwogICAgICAgIGVsc2UgZGVzdC5wdXNoKHBhcnQsIHNvdXJj
			ZVtpKzFdKTsKICAgICAgfQogICAgICBwb3MgPSBlbmQ7CiAgICB9CiAgfQoKICAvLyBEYXRhIHN0
			cnVjdHVyZSB0aGF0IGhvbGRzIHRoZSBzZXF1ZW5jZSBvZiBsaW5lcy4KICBmdW5jdGlvbiBMZWFm
			Q2h1bmsobGluZXMpIHsKICAgIHRoaXMubGluZXMgPSBsaW5lczsKICAgIHRoaXMucGFyZW50ID0g
			bnVsbDsKICAgIGZvciAodmFyIGkgPSAwLCBlID0gbGluZXMubGVuZ3RoLCBoZWlnaHQgPSAwOyBp
			IDwgZTsgKytpKSB7CiAgICAgIGxpbmVzW2ldLnBhcmVudCA9IHRoaXM7CiAgICAgIGhlaWdodCAr
			PSBsaW5lc1tpXS5oZWlnaHQ7CiAgICB9CiAgICB0aGlzLmhlaWdodCA9IGhlaWdodDsKICB9CiAg
			TGVhZkNodW5rLnByb3RvdHlwZSA9IHsKICAgIGNodW5rU2l6ZTogZnVuY3Rpb24oKSB7IHJldHVy
			biB0aGlzLmxpbmVzLmxlbmd0aDsgfSwKICAgIHJlbW92ZTogZnVuY3Rpb24oYXQsIG4sIGNhbGxi
			YWNrcykgewogICAgICBmb3IgKHZhciBpID0gYXQsIGUgPSBhdCArIG47IGkgPCBlOyArK2kpIHsK
			ICAgICAgICB2YXIgbGluZSA9IHRoaXMubGluZXNbaV07CiAgICAgICAgdGhpcy5oZWlnaHQgLT0g
			bGluZS5oZWlnaHQ7CiAgICAgICAgbGluZS5jbGVhblVwKCk7CiAgICAgICAgaWYgKGxpbmUuaGFu
			ZGxlcnMpCiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IGxpbmUuaGFuZGxlcnMubGVuZ3Ro
			OyArK2opIGNhbGxiYWNrcy5wdXNoKGxpbmUuaGFuZGxlcnNbal0pOwogICAgICB9CiAgICAgIHRo
			aXMubGluZXMuc3BsaWNlKGF0LCBuKTsKICAgIH0sCiAgICBjb2xsYXBzZTogZnVuY3Rpb24obGlu
			ZXMpIHsKICAgICAgbGluZXMuc3BsaWNlLmFwcGx5KGxpbmVzLCBbbGluZXMubGVuZ3RoLCAwXS5j
			b25jYXQodGhpcy5saW5lcykpOwogICAgfSwKICAgIGluc2VydEhlaWdodDogZnVuY3Rpb24oYXQs
			IGxpbmVzLCBoZWlnaHQpIHsKICAgICAgdGhpcy5oZWlnaHQgKz0gaGVpZ2h0OwogICAgICB0aGlz
			LmxpbmVzLnNwbGljZS5hcHBseSh0aGlzLmxpbmVzLCBbYXQsIDBdLmNvbmNhdChsaW5lcykpOwog
			ICAgICBmb3IgKHZhciBpID0gMCwgZSA9IGxpbmVzLmxlbmd0aDsgaSA8IGU7ICsraSkgbGluZXNb
			aV0ucGFyZW50ID0gdGhpczsKICAgIH0sCiAgICBpdGVyTjogZnVuY3Rpb24oYXQsIG4sIG9wKSB7
			CiAgICAgIGZvciAodmFyIGUgPSBhdCArIG47IGF0IDwgZTsgKythdCkKICAgICAgICBpZiAob3Ao
			dGhpcy5saW5lc1thdF0pKSByZXR1cm4gdHJ1ZTsKICAgIH0KICB9OwogIGZ1bmN0aW9uIEJyYW5j
			aENodW5rKGNoaWxkcmVuKSB7CiAgICB0aGlzLmNoaWxkcmVuID0gY2hpbGRyZW47CiAgICB2YXIg
			c2l6ZSA9IDAsIGhlaWdodCA9IDA7CiAgICBmb3IgKHZhciBpID0gMCwgZSA9IGNoaWxkcmVuLmxl
			bmd0aDsgaSA8IGU7ICsraSkgewogICAgICB2YXIgY2ggPSBjaGlsZHJlbltpXTsKICAgICAgc2l6
			ZSArPSBjaC5jaHVua1NpemUoKTsgaGVpZ2h0ICs9IGNoLmhlaWdodDsKICAgICAgY2gucGFyZW50
			ID0gdGhpczsKICAgIH0KICAgIHRoaXMuc2l6ZSA9IHNpemU7CiAgICB0aGlzLmhlaWdodCA9IGhl
			aWdodDsKICAgIHRoaXMucGFyZW50ID0gbnVsbDsKICB9CiAgQnJhbmNoQ2h1bmsucHJvdG90eXBl
			ID0gewogICAgY2h1bmtTaXplOiBmdW5jdGlvbigpIHsgcmV0dXJuIHRoaXMuc2l6ZTsgfSwKICAg
			IHJlbW92ZTogZnVuY3Rpb24oYXQsIG4sIGNhbGxiYWNrcykgewogICAgICB0aGlzLnNpemUgLT0g
			bjsKICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgKytpKSB7
			CiAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1Np
			emUoKTsKICAgICAgICBpZiAoYXQgPCBzeikgewogICAgICAgICAgdmFyIHJtID0gTWF0aC5taW4o
			biwgc3ogLSBhdCksIG9sZEhlaWdodCA9IGNoaWxkLmhlaWdodDsKICAgICAgICAgIGNoaWxkLnJl
			bW92ZShhdCwgcm0sIGNhbGxiYWNrcyk7CiAgICAgICAgICB0aGlzLmhlaWdodCAtPSBvbGRIZWln
			aHQgLSBjaGlsZC5oZWlnaHQ7CiAgICAgICAgICBpZiAoc3ogPT0gcm0pIHsgdGhpcy5jaGlsZHJl
			bi5zcGxpY2UoaS0tLCAxKTsgY2hpbGQucGFyZW50ID0gbnVsbDsgfQogICAgICAgICAgaWYgKChu
			IC09IHJtKSA9PSAwKSBicmVhazsKICAgICAgICAgIGF0ID0gMDsKICAgICAgICB9IGVsc2UgYXQg
			LT0gc3o7CiAgICAgIH0KICAgICAgaWYgKHRoaXMuc2l6ZSAtIG4gPCAyNSkgewogICAgICAgIHZh
			ciBsaW5lcyA9IFtdOwogICAgICAgIHRoaXMuY29sbGFwc2UobGluZXMpOwogICAgICAgIHRoaXMu
			Y2hpbGRyZW4gPSBbbmV3IExlYWZDaHVuayhsaW5lcyldOwogICAgICAgIHRoaXMuY2hpbGRyZW5b
			MF0ucGFyZW50ID0gdGhpczsKICAgICAgfQogICAgfSwKICAgIGNvbGxhcHNlOiBmdW5jdGlvbihs
			aW5lcykgewogICAgICBmb3IgKHZhciBpID0gMCwgZSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBp
			IDwgZTsgKytpKSB0aGlzLmNoaWxkcmVuW2ldLmNvbGxhcHNlKGxpbmVzKTsKICAgIH0sCiAgICBp
			bnNlcnQ6IGZ1bmN0aW9uKGF0LCBsaW5lcykgewogICAgICB2YXIgaGVpZ2h0ID0gMDsKICAgICAg
			Zm9yICh2YXIgaSA9IDAsIGUgPSBsaW5lcy5sZW5ndGg7IGkgPCBlOyArK2kpIGhlaWdodCArPSBs
			aW5lc1tpXS5oZWlnaHQ7CiAgICAgIHRoaXMuaW5zZXJ0SGVpZ2h0KGF0LCBsaW5lcywgaGVpZ2h0
			KTsKICAgIH0sCiAgICBpbnNlcnRIZWlnaHQ6IGZ1bmN0aW9uKGF0LCBsaW5lcywgaGVpZ2h0KSB7
			CiAgICAgIHRoaXMuc2l6ZSArPSBsaW5lcy5sZW5ndGg7CiAgICAgIHRoaXMuaGVpZ2h0ICs9IGhl
			aWdodDsKICAgICAgZm9yICh2YXIgaSA9IDAsIGUgPSB0aGlzLmNoaWxkcmVuLmxlbmd0aDsgaSA8
			IGU7ICsraSkgewogICAgICAgIHZhciBjaGlsZCA9IHRoaXMuY2hpbGRyZW5baV0sIHN6ID0gY2hp
			bGQuY2h1bmtTaXplKCk7CiAgICAgICAgaWYgKGF0IDw9IHN6KSB7CiAgICAgICAgICBjaGlsZC5p
			bnNlcnRIZWlnaHQoYXQsIGxpbmVzLCBoZWlnaHQpOwogICAgICAgICAgaWYgKGNoaWxkLmxpbmVz
			ICYmIGNoaWxkLmxpbmVzLmxlbmd0aCA+IDUwKSB7CiAgICAgICAgICAgIHdoaWxlIChjaGlsZC5s
			aW5lcy5sZW5ndGggPiA1MCkgewogICAgICAgICAgICAgIHZhciBzcGlsbGVkID0gY2hpbGQubGlu
			ZXMuc3BsaWNlKGNoaWxkLmxpbmVzLmxlbmd0aCAtIDI1LCAyNSk7CiAgICAgICAgICAgICAgdmFy
			IG5ld2xlYWYgPSBuZXcgTGVhZkNodW5rKHNwaWxsZWQpOwogICAgICAgICAgICAgIGNoaWxkLmhl
			aWdodCAtPSBuZXdsZWFmLmhlaWdodDsKICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGlj
			ZShpICsgMSwgMCwgbmV3bGVhZik7CiAgICAgICAgICAgICAgbmV3bGVhZi5wYXJlbnQgPSB0aGlz
			OwogICAgICAgICAgICB9CiAgICAgICAgICAgIHRoaXMubWF5YmVTcGlsbCgpOwogICAgICAgICAg
			fQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICAgIGF0IC09IHN6OwogICAgICB9CiAg
			ICB9LAogICAgbWF5YmVTcGlsbDogZnVuY3Rpb24oKSB7CiAgICAgIGlmICh0aGlzLmNoaWxkcmVu
			Lmxlbmd0aCA8PSAxMCkgcmV0dXJuOwogICAgICB2YXIgbWUgPSB0aGlzOwogICAgICBkbyB7CiAg
			ICAgICAgdmFyIHNwaWxsZWQgPSBtZS5jaGlsZHJlbi5zcGxpY2UobWUuY2hpbGRyZW4ubGVuZ3Ro
			IC0gNSwgNSk7CiAgICAgICAgdmFyIHNpYmxpbmcgPSBuZXcgQnJhbmNoQ2h1bmsoc3BpbGxlZCk7
			CiAgICAgICAgaWYgKCFtZS5wYXJlbnQpIHsgLy8gQmVjb21lIHRoZSBwYXJlbnQgbm9kZQogICAg
			ICAgICAgdmFyIGNvcHkgPSBuZXcgQnJhbmNoQ2h1bmsobWUuY2hpbGRyZW4pOwogICAgICAgICAg
			Y29weS5wYXJlbnQgPSBtZTsKICAgICAgICAgIG1lLmNoaWxkcmVuID0gW2NvcHksIHNpYmxpbmdd
			OwogICAgICAgICAgbWUgPSBjb3B5OwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtZS5zaXpl
			IC09IHNpYmxpbmcuc2l6ZTsKICAgICAgICAgIG1lLmhlaWdodCAtPSBzaWJsaW5nLmhlaWdodDsK
			ICAgICAgICAgIHZhciBteUluZGV4ID0gaW5kZXhPZihtZS5wYXJlbnQuY2hpbGRyZW4sIG1lKTsK
			ICAgICAgICAgIG1lLnBhcmVudC5jaGlsZHJlbi5zcGxpY2UobXlJbmRleCArIDEsIDAsIHNpYmxp
			bmcpOwogICAgICAgIH0KICAgICAgICBzaWJsaW5nLnBhcmVudCA9IG1lLnBhcmVudDsKICAgICAg
			fSB3aGlsZSAobWUuY2hpbGRyZW4ubGVuZ3RoID4gMTApOwogICAgICBtZS5wYXJlbnQubWF5YmVT
			cGlsbCgpOwogICAgfSwKICAgIGl0ZXI6IGZ1bmN0aW9uKGZyb20sIHRvLCBvcCkgeyB0aGlzLml0
			ZXJOKGZyb20sIHRvIC0gZnJvbSwgb3ApOyB9LAogICAgaXRlck46IGZ1bmN0aW9uKGF0LCBuLCBv
			cCkgewogICAgICBmb3IgKHZhciBpID0gMCwgZSA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwg
			ZTsgKytpKSB7CiAgICAgICAgdmFyIGNoaWxkID0gdGhpcy5jaGlsZHJlbltpXSwgc3ogPSBjaGls
			ZC5jaHVua1NpemUoKTsKICAgICAgICBpZiAoYXQgPCBzeikgewogICAgICAgICAgdmFyIHVzZWQg
			PSBNYXRoLm1pbihuLCBzeiAtIGF0KTsKICAgICAgICAgIGlmIChjaGlsZC5pdGVyTihhdCwgdXNl
			ZCwgb3ApKSByZXR1cm4gdHJ1ZTsKICAgICAgICAgIGlmICgobiAtPSB1c2VkKSA9PSAwKSBicmVh
			azsKICAgICAgICAgIGF0ID0gMDsKICAgICAgICB9IGVsc2UgYXQgLT0gc3o7CiAgICAgIH0KICAg
			IH0KICB9OwoKICBmdW5jdGlvbiBnZXRMaW5lQXQoY2h1bmssIG4pIHsKICAgIHdoaWxlICghY2h1
			bmsubGluZXMpIHsKICAgICAgZm9yICh2YXIgaSA9IDA7OyArK2kpIHsKICAgICAgICB2YXIgY2hp
			bGQgPSBjaHVuay5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTsKICAgICAgICBp
			ZiAobiA8IHN6KSB7IGNodW5rID0gY2hpbGQ7IGJyZWFrOyB9CiAgICAgICAgbiAtPSBzejsKICAg
			ICAgfQogICAgfQogICAgcmV0dXJuIGNodW5rLmxpbmVzW25dOwogIH0KICBmdW5jdGlvbiBsaW5l
			Tm8obGluZSkgewogICAgaWYgKGxpbmUucGFyZW50ID09IG51bGwpIHJldHVybiBudWxsOwogICAg
			dmFyIGN1ciA9IGxpbmUucGFyZW50LCBubyA9IGluZGV4T2YoY3VyLmxpbmVzLCBsaW5lKTsKICAg
			IGZvciAodmFyIGNodW5rID0gY3VyLnBhcmVudDsgY2h1bms7IGN1ciA9IGNodW5rLCBjaHVuayA9
			IGNodW5rLnBhcmVudCkgewogICAgICBmb3IgKHZhciBpID0gMCwgZSA9IGNodW5rLmNoaWxkcmVu
			Lmxlbmd0aDsgOyArK2kpIHsKICAgICAgICBpZiAoY2h1bmsuY2hpbGRyZW5baV0gPT0gY3VyKSBi
			cmVhazsKICAgICAgICBubyArPSBjaHVuay5jaGlsZHJlbltpXS5jaHVua1NpemUoKTsKICAgICAg
			fQogICAgfQogICAgcmV0dXJuIG5vOwogIH0KICBmdW5jdGlvbiBsaW5lQXRIZWlnaHQoY2h1bmss
			IGgpIHsKICAgIHZhciBuID0gMDsKICAgIG91dGVyOiBkbyB7CiAgICAgIGZvciAodmFyIGkgPSAw
			LCBlID0gY2h1bmsuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgZTsgKytpKSB7CiAgICAgICAgdmFyIGNo
			aWxkID0gY2h1bmsuY2hpbGRyZW5baV0sIGNoID0gY2hpbGQuaGVpZ2h0OwogICAgICAgIGlmICho
			IDwgY2gpIHsgY2h1bmsgPSBjaGlsZDsgY29udGludWUgb3V0ZXI7IH0KICAgICAgICBoIC09IGNo
			OwogICAgICAgIG4gKz0gY2hpbGQuY2h1bmtTaXplKCk7CiAgICAgIH0KICAgICAgcmV0dXJuIG47
			CiAgICB9IHdoaWxlICghY2h1bmsubGluZXMpOwogICAgZm9yICh2YXIgaSA9IDAsIGUgPSBjaHVu
			ay5saW5lcy5sZW5ndGg7IGkgPCBlOyArK2kpIHsKICAgICAgdmFyIGxpbmUgPSBjaHVuay5saW5l
			c1tpXSwgbGggPSBsaW5lLmhlaWdodDsKICAgICAgaWYgKGggPCBsaCkgYnJlYWs7CiAgICAgIGgg
			LT0gbGg7CiAgICB9CiAgICByZXR1cm4gbiArIGk7CiAgfQogIGZ1bmN0aW9uIGhlaWdodEF0TGlu
			ZShjaHVuaywgbikgewogICAgdmFyIGggPSAwOwogICAgb3V0ZXI6IGRvIHsKICAgICAgZm9yICh2
			YXIgaSA9IDAsIGUgPSBjaHVuay5jaGlsZHJlbi5sZW5ndGg7IGkgPCBlOyArK2kpIHsKICAgICAg
			ICB2YXIgY2hpbGQgPSBjaHVuay5jaGlsZHJlbltpXSwgc3ogPSBjaGlsZC5jaHVua1NpemUoKTsK
			ICAgICAgICBpZiAobiA8IHN6KSB7IGNodW5rID0gY2hpbGQ7IGNvbnRpbnVlIG91dGVyOyB9CiAg
			ICAgICAgbiAtPSBzejsKICAgICAgICBoICs9IGNoaWxkLmhlaWdodDsKICAgICAgfQogICAgICBy
			ZXR1cm4gaDsKICAgIH0gd2hpbGUgKCFjaHVuay5saW5lcyk7CiAgICBmb3IgKHZhciBpID0gMDsg
			aSA8IG47ICsraSkgaCArPSBjaHVuay5saW5lc1tpXS5oZWlnaHQ7CiAgICByZXR1cm4gaDsKICB9
			CgogIC8vIFRoZSBoaXN0b3J5IG9iamVjdCAnY2h1bmtzJyBjaGFuZ2VzIHRoYXQgYXJlIG1hZGUg
			Y2xvc2UgdG9nZXRoZXIKICAvLyBhbmQgYXQgYWxtb3N0IHRoZSBzYW1lIHRpbWUgaW50byBiaWdn
			ZXIgdW5kb2FibGUgdW5pdHMuCiAgZnVuY3Rpb24gSGlzdG9yeSgpIHsKICAgIHRoaXMudGltZSA9
			IDA7CiAgICB0aGlzLmRvbmUgPSBbXTsgdGhpcy51bmRvbmUgPSBbXTsKICB9CiAgSGlzdG9yeS5w
			cm90b3R5cGUgPSB7CiAgICBhZGRDaGFuZ2U6IGZ1bmN0aW9uKHN0YXJ0LCBhZGRlZCwgb2xkKSB7
			CiAgICAgIHRoaXMudW5kb25lLmxlbmd0aCA9IDA7CiAgICAgIHZhciB0aW1lID0gK25ldyBEYXRl
			LCBjdXIgPSB0aGlzLmRvbmVbdGhpcy5kb25lLmxlbmd0aCAtIDFdLCBsYXN0ID0gY3VyICYmIGN1
			cltjdXIubGVuZ3RoIC0gMV07CiAgICAgIHZhciBkdGltZSA9IHRpbWUgLSB0aGlzLnRpbWU7CiAg
			ICAgIGlmIChkdGltZSA+IDQwMCB8fCAhbGFzdCkgewogICAgICAgIHRoaXMuZG9uZS5wdXNoKFt7
			c3RhcnQ6IHN0YXJ0LCBhZGRlZDogYWRkZWQsIG9sZDogb2xkfV0pOwogICAgICB9IGVsc2UgaWYg
			KGxhc3Quc3RhcnQgPiBzdGFydCArIG9sZC5sZW5ndGggfHwgbGFzdC5zdGFydCArIGxhc3QuYWRk
			ZWQgPCBzdGFydCAtIGxhc3QuYWRkZWQgKyBsYXN0Lm9sZC5sZW5ndGgpIHsKICAgICAgICBjdXIu
			cHVzaCh7c3RhcnQ6IHN0YXJ0LCBhZGRlZDogYWRkZWQsIG9sZDogb2xkfSk7CiAgICAgIH0gZWxz
			ZSB7CiAgICAgICAgdmFyIG9sZG9mZiA9IDA7CiAgICAgICAgaWYgKHN0YXJ0IDwgbGFzdC5zdGFy
			dCkgewogICAgICAgICAgZm9yICh2YXIgaSA9IGxhc3Quc3RhcnQgLSBzdGFydCAtIDE7IGkgPj0g
			MDsgLS1pKQogICAgICAgICAgICBsYXN0Lm9sZC51bnNoaWZ0KG9sZFtpXSk7CiAgICAgICAgICBs
			YXN0LmFkZGVkICs9IGxhc3Quc3RhcnQgLSBzdGFydDsKICAgICAgICAgIGxhc3Quc3RhcnQgPSBz
			dGFydDsKICAgICAgICB9CiAgICAgICAgZWxzZSBpZiAobGFzdC5zdGFydCA8IHN0YXJ0KSB7CiAg
			ICAgICAgICBvbGRvZmYgPSBzdGFydCAtIGxhc3Quc3RhcnQ7CiAgICAgICAgICBhZGRlZCArPSBv
			bGRvZmY7CiAgICAgICAgfQogICAgICAgIGZvciAodmFyIGkgPSBsYXN0LmFkZGVkIC0gb2xkb2Zm
			LCBlID0gb2xkLmxlbmd0aDsgaSA8IGU7ICsraSkKICAgICAgICAgIGxhc3Qub2xkLnB1c2gob2xk
			W2ldKTsKICAgICAgICBpZiAobGFzdC5hZGRlZCA8IGFkZGVkKSBsYXN0LmFkZGVkID0gYWRkZWQ7
			CiAgICAgIH0KICAgICAgdGhpcy50aW1lID0gdGltZTsKICAgIH0KICB9OwoKICBmdW5jdGlvbiBz
			dG9wTWV0aG9kKCkge2Vfc3RvcCh0aGlzKTt9CiAgLy8gRW5zdXJlIGFuIGV2ZW50IGhhcyBhIHN0
			b3AgbWV0aG9kLgogIGZ1bmN0aW9uIGFkZFN0b3AoZXZlbnQpIHsKICAgIGlmICghZXZlbnQuc3Rv
			cCkgZXZlbnQuc3RvcCA9IHN0b3BNZXRob2Q7CiAgICByZXR1cm4gZXZlbnQ7CiAgfQoKICBmdW5j
			dGlvbiBlX3ByZXZlbnREZWZhdWx0KGUpIHsKICAgIGlmIChlLnByZXZlbnREZWZhdWx0KSBlLnBy
			ZXZlbnREZWZhdWx0KCk7CiAgICBlbHNlIGUucmV0dXJuVmFsdWUgPSBmYWxzZTsKICB9CiAgZnVu
			Y3Rpb24gZV9zdG9wUHJvcGFnYXRpb24oZSkgewogICAgaWYgKGUuc3RvcFByb3BhZ2F0aW9uKSBl
			LnN0b3BQcm9wYWdhdGlvbigpOwogICAgZWxzZSBlLmNhbmNlbEJ1YmJsZSA9IHRydWU7CiAgfQog
			IGZ1bmN0aW9uIGVfc3RvcChlKSB7ZV9wcmV2ZW50RGVmYXVsdChlKTsgZV9zdG9wUHJvcGFnYXRp
			b24oZSk7fQogIENvZGVNaXJyb3IuZV9zdG9wID0gZV9zdG9wOwogIENvZGVNaXJyb3IuZV9wcmV2
			ZW50RGVmYXVsdCA9IGVfcHJldmVudERlZmF1bHQ7CiAgQ29kZU1pcnJvci5lX3N0b3BQcm9wYWdh
			dGlvbiA9IGVfc3RvcFByb3BhZ2F0aW9uOwoKICBmdW5jdGlvbiBlX3RhcmdldChlKSB7cmV0dXJu
			IGUudGFyZ2V0IHx8IGUuc3JjRWxlbWVudDt9CiAgZnVuY3Rpb24gZV9idXR0b24oZSkgewogICAg
			aWYgKGUud2hpY2gpIHJldHVybiBlLndoaWNoOwogICAgZWxzZSBpZiAoZS5idXR0b24gJiAxKSBy
			ZXR1cm4gMTsKICAgIGVsc2UgaWYgKGUuYnV0dG9uICYgMikgcmV0dXJuIDM7CiAgICBlbHNlIGlm
			IChlLmJ1dHRvbiAmIDQpIHJldHVybiAyOwogIH0KCiAgLy8gQWxsb3cgM3JkLXBhcnR5IGNvZGUg
			dG8gb3ZlcnJpZGUgZXZlbnQgcHJvcGVydGllcyBieSBhZGRpbmcgYW4gb3ZlcnJpZGUKICAvLyBv
			YmplY3QgdG8gYW4gZXZlbnQgb2JqZWN0LgogIGZ1bmN0aW9uIGVfcHJvcChlLCBwcm9wKSB7CiAg
			ICB2YXIgb3ZlcnJpZGRlbiA9IGUub3ZlcnJpZGUgJiYgZS5vdmVycmlkZS5oYXNPd25Qcm9wZXJ0
			eShwcm9wKTsKICAgIHJldHVybiBvdmVycmlkZGVuID8gZS5vdmVycmlkZVtwcm9wXSA6IGVbcHJv
			cF07CiAgfQoKICAvLyBFdmVudCBoYW5kbGVyIHJlZ2lzdHJhdGlvbi4gSWYgZGlzY29ubmVjdCBp
			cyB0cnVlLCBpdCdsbCByZXR1cm4gYQogIC8vIGZ1bmN0aW9uIHRoYXQgdW5yZWdpc3RlcnMgdGhl
			IGhhbmRsZXIuCiAgZnVuY3Rpb24gY29ubmVjdChub2RlLCB0eXBlLCBoYW5kbGVyLCBkaXNjb25u
			ZWN0KSB7CiAgICBpZiAodHlwZW9mIG5vZGUuYWRkRXZlbnRMaXN0ZW5lciA9PSAiZnVuY3Rpb24i
			KSB7CiAgICAgIG5vZGUuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBoYW5kbGVyLCBmYWxzZSk7CiAg
			ICAgIGlmIChkaXNjb25uZWN0KSByZXR1cm4gZnVuY3Rpb24oKSB7bm9kZS5yZW1vdmVFdmVudExp
			c3RlbmVyKHR5cGUsIGhhbmRsZXIsIGZhbHNlKTt9OwogICAgfQogICAgZWxzZSB7CiAgICAgIHZh
			ciB3cmFwSGFuZGxlciA9IGZ1bmN0aW9uKGV2ZW50KSB7aGFuZGxlcihldmVudCB8fCB3aW5kb3cu
			ZXZlbnQpO307CiAgICAgIG5vZGUuYXR0YWNoRXZlbnQoIm9uIiArIHR5cGUsIHdyYXBIYW5kbGVy
			KTsKICAgICAgaWYgKGRpc2Nvbm5lY3QpIHJldHVybiBmdW5jdGlvbigpIHtub2RlLmRldGFjaEV2
			ZW50KCJvbiIgKyB0eXBlLCB3cmFwSGFuZGxlcik7fTsKICAgIH0KICB9CiAgQ29kZU1pcnJvci5j
			b25uZWN0ID0gY29ubmVjdDsKCiAgZnVuY3Rpb24gRGVsYXllZCgpIHt0aGlzLmlkID0gbnVsbDt9
			CiAgRGVsYXllZC5wcm90b3R5cGUgPSB7c2V0OiBmdW5jdGlvbihtcywgZikge2NsZWFyVGltZW91
			dCh0aGlzLmlkKTsgdGhpcy5pZCA9IHNldFRpbWVvdXQoZiwgbXMpO319OwoKICB2YXIgUGFzcyA9
			IENvZGVNaXJyb3IuUGFzcyA9IHt0b1N0cmluZzogZnVuY3Rpb24oKXtyZXR1cm4gIkNvZGVNaXJy
			b3IuUGFzcyI7fX07CgogIC8vIERldGVjdCBkcmFnLWFuZC1kcm9wCiAgdmFyIGRyYWdBbmREcm9w
			ID0gZnVuY3Rpb24oKSB7CiAgICAvLyBJRTggaGFzIG9uZHJhZ3N0YXJ0IGFuZCBvbmRyb3AgcHJv
			cGVydGllcywgYnV0IGRvZXNuJ3Qgc2VlbSB0bwogICAgLy8gYWN0dWFsbHkgc3VwcG9ydCBvbmRy
			YWdzdGFydCB0aGUgd2F5IGl0J3Mgc3VwcG9zZWQgdG8gd29yay4KICAgIGlmICgvTVNJRSBbMS04
			XVxiLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSByZXR1cm4gZmFsc2U7CiAgICB2YXIgZGl2
			ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICByZXR1cm4gImRyYWdnYWJsZSIg
			aW4gZGl2OwogIH0oKTsKCiAgdmFyIGdlY2tvID0gL2dlY2tvXC9cZHs3fS9pLnRlc3QobmF2aWdh
			dG9yLnVzZXJBZ2VudCk7CiAgdmFyIGllID0gL01TSUUgXGQvLnRlc3QobmF2aWdhdG9yLnVzZXJB
			Z2VudCk7CiAgdmFyIGllX2x0OSA9IC9NU0lFIFsxLThdXGIvLnRlc3QobmF2aWdhdG9yLnVzZXJB
			Z2VudCk7CiAgdmFyIHdlYmtpdCA9IC9XZWJLaXRcLy8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50
			KTsKCiAgdmFyIGxpbmVTZXAgPSAiXG4iOwogIC8vIEZlYXR1cmUtZGV0ZWN0IHdoZXRoZXIgbmV3
			bGluZXMgaW4gdGV4dGFyZWFzIGFyZSBjb252ZXJ0ZWQgdG8gXHJcbgogIChmdW5jdGlvbiAoKSB7
			CiAgICB2YXIgdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpOwogICAgdGUu
			dmFsdWUgPSAiZm9vXG5iYXIiOwogICAgaWYgKHRlLnZhbHVlLmluZGV4T2YoIlxyIikgPiAtMSkg
			bGluZVNlcCA9ICJcclxuIjsKICB9KCkpOwoKICAvLyBDb3VudHMgdGhlIGNvbHVtbiBvZmZzZXQg
			aW4gYSBzdHJpbmcsIHRha2luZyB0YWJzIGludG8gYWNjb3VudC4KICAvLyBVc2VkIG1vc3RseSB0
			byBmaW5kIGluZGVudGF0aW9uLgogIGZ1bmN0aW9uIGNvdW50Q29sdW1uKHN0cmluZywgZW5kLCB0
			YWJTaXplKSB7CiAgICBpZiAoZW5kID09IG51bGwpIHsKICAgICAgZW5kID0gc3RyaW5nLnNlYXJj
			aCgvW15cc1x1MDBhMF0vKTsKICAgICAgaWYgKGVuZCA9PSAtMSkgZW5kID0gc3RyaW5nLmxlbmd0
			aDsKICAgIH0KICAgIGZvciAodmFyIGkgPSAwLCBuID0gMDsgaSA8IGVuZDsgKytpKSB7CiAgICAg
			IGlmIChzdHJpbmcuY2hhckF0KGkpID09ICJcdCIpIG4gKz0gdGFiU2l6ZSAtIChuICUgdGFiU2l6
			ZSk7CiAgICAgIGVsc2UgKytuOwogICAgfQogICAgcmV0dXJuIG47CiAgfQoKICBmdW5jdGlvbiBj
			b21wdXRlZFN0eWxlKGVsdCkgewogICAgaWYgKGVsdC5jdXJyZW50U3R5bGUpIHJldHVybiBlbHQu
			Y3VycmVudFN0eWxlOwogICAgcmV0dXJuIHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsdCwgbnVs
			bCk7CiAgfQoKICAvLyBGaW5kIHRoZSBwb3NpdGlvbiBvZiBhbiBlbGVtZW50IGJ5IGZvbGxvd2lu
			ZyB0aGUgb2Zmc2V0UGFyZW50IGNoYWluLgogIC8vIElmIHNjcmVlbj09dHJ1ZSwgaXQgcmV0dXJu
			cyBzY3JlZW4gKHJhdGhlciB0aGFuIHBhZ2UpIGNvb3JkaW5hdGVzLgogIGZ1bmN0aW9uIGVsdE9m
			ZnNldChub2RlLCBzY3JlZW4pIHsKICAgIHZhciBib2QgPSBub2RlLm93bmVyRG9jdW1lbnQuYm9k
			eTsKICAgIHZhciB4ID0gMCwgeSA9IDAsIHNraXBCb2R5ID0gZmFsc2U7CiAgICBmb3IgKHZhciBu
			ID0gbm9kZTsgbjsgbiA9IG4ub2Zmc2V0UGFyZW50KSB7CiAgICAgIHZhciBvbCA9IG4ub2Zmc2V0
			TGVmdCwgb3QgPSBuLm9mZnNldFRvcDsKICAgICAgLy8gRmlyZWZveCByZXBvcnRzIHdlaXJkIGlu
			dmVydGVkIG9mZnNldHMgd2hlbiB0aGUgYm9keSBoYXMgYSBib3JkZXIuCiAgICAgIGlmIChuID09
			IGJvZCkgeyB4ICs9IE1hdGguYWJzKG9sKTsgeSArPSBNYXRoLmFicyhvdCk7IH0KICAgICAgZWxz
			ZSB7IHggKz0gb2wsIHkgKz0gb3Q7IH0KICAgICAgaWYgKHNjcmVlbiAmJiBjb21wdXRlZFN0eWxl
			KG4pLnBvc2l0aW9uID09ICJmaXhlZCIpCiAgICAgICAgc2tpcEJvZHkgPSB0cnVlOwogICAgfQog
			ICAgdmFyIGUgPSBzY3JlZW4gJiYgIXNraXBCb2R5ID8gbnVsbCA6IGJvZDsKICAgIGZvciAodmFy
			IG4gPSBub2RlLnBhcmVudE5vZGU7IG4gIT0gZTsgbiA9IG4ucGFyZW50Tm9kZSkKICAgICAgaWYg
			KG4uc2Nyb2xsTGVmdCAhPSBudWxsKSB7IHggLT0gbi5zY3JvbGxMZWZ0OyB5IC09IG4uc2Nyb2xs
			VG9wO30KICAgIHJldHVybiB7bGVmdDogeCwgdG9wOiB5fTsKICB9CiAgLy8gVXNlIHRoZSBmYXN0
			ZXIgYW5kIHNhbmVyIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBtZXRob2Qgd2hlbiBwb3NzaWJsZS4K
			ICBpZiAoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCAhPSBu
			dWxsKSBlbHRPZmZzZXQgPSBmdW5jdGlvbihub2RlLCBzY3JlZW4pIHsKICAgIC8vIFRha2UgdGhl
			IHBhcnRzIG9mIGJvdW5kaW5nIGNsaWVudCByZWN0IHRoYXQgd2UgYXJlIGludGVyZXN0ZWQgaW4g
			c28gd2UgYXJlIGFibGUgdG8gZWRpdCBpZiBuZWVkIGJlLAogICAgLy8gc2luY2UgdGhlIHJldHVy
			bmVkIHZhbHVlIGNhbm5vdCBiZSBjaGFuZ2VkIGV4dGVybmFsbHkgKHRoZXkgYXJlIGtlcHQgaW4g
			c3luYyBhcyB0aGUgZWxlbWVudCBtb3ZlcyB3aXRoaW4gdGhlIHBhZ2UpCiAgICB0cnkgeyB2YXIg
			Ym94ID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgYm94ID0geyB0b3A6IGJveC50b3As
			IGxlZnQ6IGJveC5sZWZ0IH07IH0KICAgIGNhdGNoKGUpIHsgYm94ID0ge3RvcDogMCwgbGVmdDog
			MH07IH0KICAgIGlmICghc2NyZWVuKSB7CiAgICAgIC8vIEdldCB0aGUgdG9wbGV2ZWwgc2Nyb2xs
			LCB3b3JraW5nIGFyb3VuZCBicm93c2VyIGRpZmZlcmVuY2VzLgogICAgICBpZiAod2luZG93LnBh
			Z2VZT2Zmc2V0ID09IG51bGwpIHsKICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmRvY3VtZW50RWxl
			bWVudCB8fCBkb2N1bWVudC5ib2R5LnBhcmVudE5vZGU7CiAgICAgICAgaWYgKHQuc2Nyb2xsVG9w
			ID09IG51bGwpIHQgPSBkb2N1bWVudC5ib2R5OwogICAgICAgIGJveC50b3AgKz0gdC5zY3JvbGxU
			b3A7IGJveC5sZWZ0ICs9IHQuc2Nyb2xsTGVmdDsKICAgICAgfSBlbHNlIHsKICAgICAgICBib3gu
			dG9wICs9IHdpbmRvdy5wYWdlWU9mZnNldDsgYm94LmxlZnQgKz0gd2luZG93LnBhZ2VYT2Zmc2V0
			OwogICAgICB9CiAgICB9CiAgICByZXR1cm4gYm94OwogIH07CgogIC8vIEdldCBhIG5vZGUncyB0
			ZXh0IGNvbnRlbnQuCiAgZnVuY3Rpb24gZWx0VGV4dChub2RlKSB7CiAgICByZXR1cm4gbm9kZS50
			ZXh0Q29udGVudCB8fCBub2RlLmlubmVyVGV4dCB8fCBub2RlLm5vZGVWYWx1ZSB8fCAiIjsKICB9
			CiAgZnVuY3Rpb24gc2VsZWN0SW5wdXQobm9kZSkgewogICAgaWYgKGlvcykgeyAvLyBNb2JpbGUg
			U2FmYXJpIGFwcGFyZW50bHkgaGFzIGEgYnVnIHdoZXJlIHNlbGVjdCgpIGlzIGJyb2tlbi4KICAg
			ICAgbm9kZS5zZWxlY3Rpb25TdGFydCA9IDA7CiAgICAgIG5vZGUuc2VsZWN0aW9uRW5kID0gbm9k
			ZS52YWx1ZS5sZW5ndGg7CiAgICB9IGVsc2Ugbm9kZS5zZWxlY3QoKTsKICB9CgogIC8vIE9wZXJh
			dGlvbnMgb24ge2xpbmUsIGNofSBvYmplY3RzLgogIGZ1bmN0aW9uIHBvc0VxKGEsIGIpIHtyZXR1
			cm4gYS5saW5lID09IGIubGluZSAmJiBhLmNoID09IGIuY2g7fQogIGZ1bmN0aW9uIHBvc0xlc3Mo
			YSwgYikge3JldHVybiBhLmxpbmUgPCBiLmxpbmUgfHwgKGEubGluZSA9PSBiLmxpbmUgJiYgYS5j
			aCA8IGIuY2gpO30KICBmdW5jdGlvbiBjb3B5UG9zKHgpIHtyZXR1cm4ge2xpbmU6IHgubGluZSwg
			Y2g6IHguY2h9O30KCiAgdmFyIGVzY2FwZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50
			KCJwcmUiKTsKICBmdW5jdGlvbiBodG1sRXNjYXBlKHN0cikgewogICAgZXNjYXBlRWxlbWVudC50
			ZXh0Q29udGVudCA9IHN0cjsKICAgIHJldHVybiBlc2NhcGVFbGVtZW50LmlubmVySFRNTDsKICB9
			CiAgLy8gUmVjZW50IChsYXRlIDIwMTEpIE9wZXJhIGJldGFzIGluc2VydCBib2d1cyBuZXdsaW5l
			cyBhdCB0aGUgc3RhcnQKICAvLyBvZiB0aGUgdGV4dENvbnRlbnQsIHNvIHdlIHN0cmlwIHRob3Nl
			LgogIGlmIChodG1sRXNjYXBlKCJhIikgPT0gIlxuYSIpCiAgICBodG1sRXNjYXBlID0gZnVuY3Rp
			b24oc3RyKSB7CiAgICAgIGVzY2FwZUVsZW1lbnQudGV4dENvbnRlbnQgPSBzdHI7CiAgICAgIHJl
			dHVybiBlc2NhcGVFbGVtZW50LmlubmVySFRNTC5zbGljZSgxKTsKICAgIH07CiAgLy8gU29tZSBJ
			RXMgZG9uJ3QgcHJlc2VydmUgdGFicyB0aHJvdWdoIGlubmVySFRNTAogIGVsc2UgaWYgKGh0bWxF
			c2NhcGUoIlx0IikgIT0gIlx0IikKICAgIGh0bWxFc2NhcGUgPSBmdW5jdGlvbihzdHIpIHsKICAg
			ICAgZXNjYXBlRWxlbWVudC5pbm5lckhUTUwgPSAiIjsKICAgICAgZXNjYXBlRWxlbWVudC5hcHBl
			bmRDaGlsZChkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShzdHIpKTsKICAgICAgcmV0dXJuIGVzY2Fw
			ZUVsZW1lbnQuaW5uZXJIVE1MOwogICAgfTsKICBDb2RlTWlycm9yLmh0bWxFc2NhcGUgPSBodG1s
			RXNjYXBlOwoKICAvLyBVc2VkIHRvIHBvc2l0aW9uIHRoZSBjdXJzb3IgYWZ0ZXIgYW4gdW5kby9y
			ZWRvIGJ5IGZpbmRpbmcgdGhlCiAgLy8gbGFzdCBlZGl0ZWQgY2hhcmFjdGVyLgogIGZ1bmN0aW9u
			IGVkaXRFbmQoZnJvbSwgdG8pIHsKICAgIGlmICghdG8pIHJldHVybiAwOwogICAgaWYgKCFmcm9t
			KSByZXR1cm4gdG8ubGVuZ3RoOwogICAgZm9yICh2YXIgaSA9IGZyb20ubGVuZ3RoLCBqID0gdG8u
			bGVuZ3RoOyBpID49IDAgJiYgaiA+PSAwOyAtLWksIC0taikKICAgICAgaWYgKGZyb20uY2hhckF0
			KGkpICE9IHRvLmNoYXJBdChqKSkgYnJlYWs7CiAgICByZXR1cm4gaiArIDE7CiAgfQoKICBmdW5j
			dGlvbiBpbmRleE9mKGNvbGxlY3Rpb24sIGVsdCkgewogICAgaWYgKGNvbGxlY3Rpb24uaW5kZXhP
			ZikgcmV0dXJuIGNvbGxlY3Rpb24uaW5kZXhPZihlbHQpOwogICAgZm9yICh2YXIgaSA9IDAsIGUg
			PSBjb2xsZWN0aW9uLmxlbmd0aDsgaSA8IGU7ICsraSkKICAgICAgaWYgKGNvbGxlY3Rpb25baV0g
			PT0gZWx0KSByZXR1cm4gaTsKICAgIHJldHVybiAtMTsKICB9CiAgZnVuY3Rpb24gaXNXb3JkQ2hh
			cihjaCkgewogICAgcmV0dXJuIC9cdy8udGVzdChjaCkgfHwgY2gudG9VcHBlckNhc2UoKSAhPSBj
			aC50b0xvd2VyQ2FzZSgpOwogIH0KCiAgLy8gU2VlIGlmICIiLnNwbGl0IGlzIHRoZSBicm9rZW4g
			SUUgdmVyc2lvbiwgaWYgc28sIHByb3ZpZGUgYW4KICAvLyBhbHRlcm5hdGl2ZSB3YXkgdG8gc3Bs
			aXQgbGluZXMuCiAgdmFyIHNwbGl0TGluZXMgPSAiXG5cbmIiLnNwbGl0KC9cbi8pLmxlbmd0aCAh
			PSAzID8gZnVuY3Rpb24oc3RyaW5nKSB7CiAgICB2YXIgcG9zID0gMCwgbmwsIHJlc3VsdCA9IFtd
			OwogICAgd2hpbGUgKChubCA9IHN0cmluZy5pbmRleE9mKCJcbiIsIHBvcykpID4gLTEpIHsKICAg
			ICAgcmVzdWx0LnB1c2goc3RyaW5nLnNsaWNlKHBvcywgc3RyaW5nLmNoYXJBdChubC0xKSA9PSAi
			XHIiID8gbmwgLSAxIDogbmwpKTsKICAgICAgcG9zID0gbmwgKyAxOwogICAgfQogICAgcmVzdWx0
			LnB1c2goc3RyaW5nLnNsaWNlKHBvcykpOwogICAgcmV0dXJuIHJlc3VsdDsKICB9IDogZnVuY3Rp
			b24oc3RyaW5nKXtyZXR1cm4gc3RyaW5nLnNwbGl0KC9ccj9cbi8pO307CiAgQ29kZU1pcnJvci5z
			cGxpdExpbmVzID0gc3BsaXRMaW5lczsKCiAgdmFyIGhhc1NlbGVjdGlvbiA9IHdpbmRvdy5nZXRT
			ZWxlY3Rpb24gPyBmdW5jdGlvbih0ZSkgewogICAgdHJ5IHsgcmV0dXJuIHRlLnNlbGVjdGlvblN0
			YXJ0ICE9IHRlLnNlbGVjdGlvbkVuZDsgfQogICAgY2F0Y2goZSkgeyByZXR1cm4gZmFsc2U7IH0K
			ICB9IDogZnVuY3Rpb24odGUpIHsKICAgIHRyeSB7dmFyIHJhbmdlID0gdGUub3duZXJEb2N1bWVu
			dC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UoKTt9CiAgICBjYXRjaChlKSB7fQogICAgaWYgKCFyYW5n
			ZSB8fCByYW5nZS5wYXJlbnRFbGVtZW50KCkgIT0gdGUpIHJldHVybiBmYWxzZTsKICAgIHJldHVy
			biByYW5nZS5jb21wYXJlRW5kUG9pbnRzKCJTdGFydFRvRW5kIiwgcmFuZ2UpICE9IDA7CiAgfTsK
			CiAgQ29kZU1pcnJvci5kZWZpbmVNb2RlKCJudWxsIiwgZnVuY3Rpb24oKSB7CiAgICByZXR1cm4g
			e3Rva2VuOiBmdW5jdGlvbihzdHJlYW0pIHtzdHJlYW0uc2tpcFRvRW5kKCk7fX07CiAgfSk7CiAg
			Q29kZU1pcnJvci5kZWZpbmVNSU1FKCJ0ZXh0L3BsYWluIiwgIm51bGwiKTsKCiAgdmFyIGtleU5h
			bWVzID0gezM6ICJFbnRlciIsIDg6ICJCYWNrc3BhY2UiLCA5OiAiVGFiIiwgMTM6ICJFbnRlciIs
			IDE2OiAiU2hpZnQiLCAxNzogIkN0cmwiLCAxODogIkFsdCIsCiAgICAgICAgICAgICAgICAgIDE5
			OiAiUGF1c2UiLCAyMDogIkNhcHNMb2NrIiwgMjc6ICJFc2MiLCAzMjogIlNwYWNlIiwgMzM6ICJQ
			YWdlVXAiLCAzNDogIlBhZ2VEb3duIiwgMzU6ICJFbmQiLAogICAgICAgICAgICAgICAgICAzNjog
			IkhvbWUiLCAzNzogIkxlZnQiLCAzODogIlVwIiwgMzk6ICJSaWdodCIsIDQwOiAiRG93biIsIDQ0
			OiAiUHJpbnRTY3JuIiwgNDU6ICJJbnNlcnQiLAogICAgICAgICAgICAgICAgICA0NjogIkRlbGV0
			ZSIsIDU5OiAiOyIsIDkxOiAiTW9kIiwgOTI6ICJNb2QiLCA5MzogIk1vZCIsIDE4NjogIjsiLCAx
			ODc6ICI9IiwgMTg4OiAiLCIsCiAgICAgICAgICAgICAgICAgIDE4OTogIi0iLCAxOTA6ICIuIiwg
			MTkxOiAiLyIsIDE5MjogImAiLCAyMTk6ICJbIiwgMjIwOiAiXFwiLCAyMjE6ICJdIiwgMjIyOiAi
			JyIsIDYzMjc2OiAiUGFnZVVwIiwKICAgICAgICAgICAgICAgICAgNjMyNzc6ICJQYWdlRG93biIs
			IDYzMjc1OiAiRW5kIiwgNjMyNzM6ICJIb21lIiwgNjMyMzQ6ICJMZWZ0IiwgNjMyMzI6ICJVcCIs
			IDYzMjM1OiAiUmlnaHQiLAogICAgICAgICAgICAgICAgICA2MzIzMzogIkRvd24iLCA2MzMwMjog
			Ikluc2VydCIsIDYzMjcyOiAiRGVsZXRlIn07CiAgQ29kZU1pcnJvci5rZXlOYW1lcyA9IGtleU5h
			bWVzOwogIChmdW5jdGlvbigpIHsKICAgIC8vIE51bWJlciBrZXlzCiAgICBmb3IgKHZhciBpID0g
			MDsgaSA8IDEwOyBpKyspIGtleU5hbWVzW2kgKyA0OF0gPSBTdHJpbmcoaSk7CiAgICAvLyBBbHBo
			YWJldGljIGtleXMKICAgIGZvciAodmFyIGkgPSA2NTsgaSA8PSA5MDsgaSsrKSBrZXlOYW1lc1tp
			XSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoaSk7CiAgICAvLyBGdW5jdGlvbiBrZXlzCiAgICBmb3Ig
			KHZhciBpID0gMTsgaSA8PSAxMjsgaSsrKSBrZXlOYW1lc1tpICsgMTExXSA9IGtleU5hbWVzW2kg
			KyA2MzIzNV0gPSAiRiIgKyBpOwogIH0pKCk7CgogIHJldHVybiBDb2RlTWlycm9yOwp9KSgpOwo=]]></Resource>
    <Resource ID="5cd10fee-6e10-5253-24ea-3edb0a87f9ec" Name="utils.js" Type="js"><![CDATA[Lyogc2VhcmNoY3Vyc29yICovCihmdW5jdGlvbigpe2Z1bmN0aW9uIFNlYXJjaEN1cnNvcihjbSxx
			dWVyeSxwb3MsY2FzZUZvbGQpe3RoaXMuYXRPY2N1cnJlbmNlPWZhbHNlO3RoaXMuY209Y207aWYo
			Y2FzZUZvbGQ9PW51bGwpY2FzZUZvbGQ9dHlwZW9mIHF1ZXJ5PT0ic3RyaW5nIiYmcXVlcnk9PXF1
			ZXJ5LnRvTG93ZXJDYXNlKCk7cG9zPXBvcz9jbS5jbGlwUG9zKHBvcyk6e2xpbmU6MCxjaDowfTt0
			aGlzLnBvcz17ZnJvbTpwb3MsdG86cG9zfTtpZih0eXBlb2YgcXVlcnkhPSJzdHJpbmciKXRoaXMu
			bWF0Y2hlcz1mdW5jdGlvbihyZXZlcnNlLHBvcyl7aWYocmV2ZXJzZSl7dmFyIGxpbmU9Y20uZ2V0
			TGluZShwb3MubGluZSkuc2xpY2UoMCxwb3MuY2gpLG1hdGNoPWxpbmUubWF0Y2gocXVlcnkpLHN0
			YXJ0PTA7d2hpbGUobWF0Y2gpe3ZhciBpbmQ9bGluZS5pbmRleE9mKG1hdGNoWzBdKTtzdGFydCs9
			aW5kO2xpbmU9bGluZS5zbGljZShpbmQrMSk7dmFyIG5ld21hdGNoPWxpbmUubWF0Y2gocXVlcnkp
			O2lmKG5ld21hdGNoKW1hdGNoPSBuZXdtYXRjaDtlbHNlIGJyZWFrO3N0YXJ0Kyt9fWVsc2UgdmFy
			IGxpbmU9Y20uZ2V0TGluZShwb3MubGluZSkuc2xpY2UocG9zLmNoKSxtYXRjaD1saW5lLm1hdGNo
			KHF1ZXJ5KSxzdGFydD1tYXRjaCYmcG9zLmNoK2xpbmUuaW5kZXhPZihtYXRjaFswXSk7aWYobWF0
			Y2gpcmV0dXJue2Zyb206e2xpbmU6cG9zLmxpbmUsY2g6c3RhcnR9LHRvOntsaW5lOnBvcy5saW5l
			LGNoOnN0YXJ0K21hdGNoWzBdLmxlbmd0aH0sbWF0Y2g6bWF0Y2h9fTtlbHNle2lmKGNhc2VGb2xk
			KXF1ZXJ5PXF1ZXJ5LnRvTG93ZXJDYXNlKCk7dmFyIGZvbGQ9Y2FzZUZvbGQ/ZnVuY3Rpb24oc3Ry
			KXtyZXR1cm4gc3RyLnRvTG93ZXJDYXNlKCl9OmZ1bmN0aW9uKHN0cil7cmV0dXJuIHN0cn07dmFy
			IHRhcmdldD1xdWVyeS5zcGxpdCgiXG4iKTtpZih0YXJnZXQubGVuZ3RoPT0xKXRoaXMubWF0Y2hl
			cz1mdW5jdGlvbihyZXZlcnNlLHBvcyl7dmFyIGxpbmU9Zm9sZChjbS5nZXRMaW5lKHBvcy5saW5l
			KSksbGVuPXF1ZXJ5Lmxlbmd0aCwgbWF0Y2g7aWYocmV2ZXJzZT9wb3MuY2g+PWxlbiYmKG1hdGNo
			PWxpbmUubGFzdEluZGV4T2YocXVlcnkscG9zLmNoLWxlbikpIT0tMToobWF0Y2g9bGluZS5pbmRl
			eE9mKHF1ZXJ5LHBvcy5jaCkpIT0tMSlyZXR1cm57ZnJvbTp7bGluZTpwb3MubGluZSxjaDptYXRj
			aH0sdG86e2xpbmU6cG9zLmxpbmUsY2g6bWF0Y2grbGVufX19O2Vsc2UgdGhpcy5tYXRjaGVzPWZ1
			bmN0aW9uKHJldmVyc2UscG9zKXt2YXIgbG49cG9zLmxpbmUsaWR4PXJldmVyc2U/dGFyZ2V0Lmxl
			bmd0aC0xOjAsbWF0Y2g9dGFyZ2V0W2lkeF0sbGluZT1mb2xkKGNtLmdldExpbmUobG4pKTt2YXIg
			b2Zmc2V0QT1yZXZlcnNlP2xpbmUuaW5kZXhPZihtYXRjaCkrbWF0Y2gubGVuZ3RoOmxpbmUubGFz
			dEluZGV4T2YobWF0Y2gpO2lmKHJldmVyc2U/b2Zmc2V0QT49cG9zLmNofHxvZmZzZXRBIT1tYXRj
			aC5sZW5ndGg6b2Zmc2V0QTw9cG9zLmNofHxvZmZzZXRBIT1saW5lLmxlbmd0aC1tYXRjaC5sZW5n
			dGgpcmV0dXJuOyBmb3IoOzspe2lmKHJldmVyc2U/IWxuOmxuPT1jbS5saW5lQ291bnQoKS0xKXJl
			dHVybjtsaW5lPWZvbGQoY20uZ2V0TGluZShsbis9cmV2ZXJzZT8tMToxKSk7bWF0Y2g9dGFyZ2V0
			W3JldmVyc2U/LS1pZHg6KytpZHhdO2lmKGlkeD4wJiZpZHg8dGFyZ2V0Lmxlbmd0aC0xKWlmKGxp
			bmUhPW1hdGNoKXJldHVybjtlbHNlIGNvbnRpbnVlO3ZhciBvZmZzZXRCPXJldmVyc2U/bGluZS5s
			YXN0SW5kZXhPZihtYXRjaCk6bGluZS5pbmRleE9mKG1hdGNoKSttYXRjaC5sZW5ndGg7aWYocmV2
			ZXJzZT9vZmZzZXRCIT1saW5lLmxlbmd0aC1tYXRjaC5sZW5ndGg6b2Zmc2V0QiE9bWF0Y2gubGVu
			Z3RoKXJldHVybjt2YXIgc3RhcnQ9e2xpbmU6cG9zLmxpbmUsY2g6b2Zmc2V0QX0sZW5kPXtsaW5l
			OmxuLGNoOm9mZnNldEJ9O3JldHVybntmcm9tOnJldmVyc2U/ZW5kOnN0YXJ0LHRvOnJldmVyc2U/
			c3RhcnQ6ZW5kfX19fX1TZWFyY2hDdXJzb3IucHJvdG90eXBlPXtmaW5kTmV4dDpmdW5jdGlvbigp
			e3JldHVybiB0aGlzLmZpbmQoZmFsc2UpfSwgZmluZFByZXZpb3VzOmZ1bmN0aW9uKCl7cmV0dXJu
			IHRoaXMuZmluZCh0cnVlKX0sZmluZDpmdW5jdGlvbihyZXZlcnNlKXt2YXIgc2VsZj10aGlzLHBv
			cz10aGlzLmNtLmNsaXBQb3MocmV2ZXJzZT90aGlzLnBvcy5mcm9tOnRoaXMucG9zLnRvKTtmdW5j
			dGlvbiBzYXZlUG9zQW5kRmFpbChsaW5lKXt2YXIgcG9zPXtsaW5lOmxpbmUsY2g6MH07c2VsZi5w
			b3M9e2Zyb206cG9zLHRvOnBvc307c2VsZi5hdE9jY3VycmVuY2U9ZmFsc2U7cmV0dXJuIGZhbHNl
			fWZvcig7Oyl7aWYodGhpcy5wb3M9dGhpcy5tYXRjaGVzKHJldmVyc2UscG9zKSl7dGhpcy5hdE9j
			Y3VycmVuY2U9dHJ1ZTtyZXR1cm4gdGhpcy5wb3MubWF0Y2h8fHRydWV9aWYocmV2ZXJzZSl7aWYo
			IXBvcy5saW5lKXJldHVybiBzYXZlUG9zQW5kRmFpbCgwKTtwb3M9e2xpbmU6cG9zLmxpbmUtMSxj
			aDp0aGlzLmNtLmdldExpbmUocG9zLmxpbmUtMSkubGVuZ3RofX1lbHNle3ZhciBtYXhMaW5lPXRo
			aXMuY20ubGluZUNvdW50KCk7IGlmKHBvcy5saW5lPT1tYXhMaW5lLTEpcmV0dXJuIHNhdmVQb3NB
			bmRGYWlsKG1heExpbmUpO3Bvcz17bGluZTpwb3MubGluZSsxLGNoOjB9fX19LGZyb206ZnVuY3Rp
			b24oKXtpZih0aGlzLmF0T2NjdXJyZW5jZSlyZXR1cm4gdGhpcy5wb3MuZnJvbX0sdG86ZnVuY3Rp
			b24oKXtpZih0aGlzLmF0T2NjdXJyZW5jZSlyZXR1cm4gdGhpcy5wb3MudG99LHJlcGxhY2U6ZnVu
			Y3Rpb24obmV3VGV4dCl7dmFyIHNlbGY9dGhpcztpZih0aGlzLmF0T2NjdXJyZW5jZSlzZWxmLnBv
			cy50bz10aGlzLmNtLnJlcGxhY2VSYW5nZShuZXdUZXh0LHNlbGYucG9zLmZyb20sc2VsZi5wb3Mu
			dG8pfX07Q29kZU1pcnJvci5kZWZpbmVFeHRlbnNpb24oImdldFNlYXJjaEN1cnNvciIsZnVuY3Rp
			b24ocXVlcnkscG9zLGNhc2VGb2xkKXtyZXR1cm4gbmV3IFNlYXJjaEN1cnNvcih0aGlzLHF1ZXJ5
			LHBvcyxjYXNlRm9sZCl9KX0pKCk7Ci8qIG1hdGNoLWhpZ2hsaWdodGVyICovCihmdW5jdGlvbigp
			e3ZhciBERUZBVUxUX01JTl9DSEFSUz0yO2Z1bmN0aW9uIE1hdGNoSGlnaGxpZ2h0U3RhdGUoKXt0
			aGlzLm1hcmtlZD1bXX1mdW5jdGlvbiBnZXRNYXRjaEhpZ2hsaWdodFN0YXRlKGNtKXtyZXR1cm4g
			Y20uX21hdGNoSGlnaGxpZ2h0U3RhdGV8fChjbS5fbWF0Y2hIaWdobGlnaHRTdGF0ZT1uZXcgTWF0
			Y2hIaWdobGlnaHRTdGF0ZSl9ZnVuY3Rpb24gY2xlYXJNYXJrcyhjbSl7dmFyIHN0YXRlPWdldE1h
			dGNoSGlnaGxpZ2h0U3RhdGUoY20pO2Zvcih2YXIgaT0wO2k8c3RhdGUubWFya2VkLmxlbmd0aDsr
			K2kpc3RhdGUubWFya2VkW2ldLmNsZWFyKCk7c3RhdGUubWFya2VkPVtdfWZ1bmN0aW9uIG1hcmtE
			b2N1bWVudChjbSxjbGFzc05hbWUsbWluQ2hhcnMpe2NsZWFyTWFya3MoY20pO21pbkNoYXJzPXR5
			cGVvZiBtaW5DaGFycyE9PSJ1bmRlZmluZWQiP21pbkNoYXJzOkRFRkFVTFRfTUlOX0NIQVJTO2lm
			KGNtLnNvbWV0aGluZ1NlbGVjdGVkKCkmJmNtLmdldFNlbGVjdGlvbigpLmxlbmd0aD49IG1pbkNo
			YXJzKXt2YXIgc3RhdGU9Z2V0TWF0Y2hIaWdobGlnaHRTdGF0ZShjbSk7dmFyIHF1ZXJ5PWNtLmdl
			dFNlbGVjdGlvbigpO2NtLm9wZXJhdGlvbihmdW5jdGlvbigpe2lmKGNtLmxpbmVDb3VudCgpPDJF
			Mylmb3IodmFyIGN1cnNvcj1jbS5nZXRTZWFyY2hDdXJzb3IocXVlcnkpO2N1cnNvci5maW5kTmV4
			dCgpOylpZighKGN1cnNvci5mcm9tKCkubGluZT09PWNtLmdldEN1cnNvcih0cnVlKS5saW5lJiZj
			dXJzb3IuZnJvbSgpLmNoPT09Y20uZ2V0Q3Vyc29yKHRydWUpLmNoKSlzdGF0ZS5tYXJrZWQucHVz
			aChjbS5tYXJrVGV4dChjdXJzb3IuZnJvbSgpLGN1cnNvci50bygpLGNsYXNzTmFtZSkpfSl9fUNv
			ZGVNaXJyb3IuZGVmaW5lRXh0ZW5zaW9uKCJtYXRjaEhpZ2hsaWdodCIsZnVuY3Rpb24oY2xhc3NO
			YW1lLG1pbkNoYXJzKXttYXJrRG9jdW1lbnQodGhpcyxjbGFzc05hbWUsbWluQ2hhcnMpfSl9KSgp
			Owo=]]></Resource>
    <Resource ID="637e54fd-1431-0dee-2e82-f223db960509" Name="buttons" Type="gif"><![CDATA[R0lGODlhAAMYANU7AGOR1s/Tz/7+/vjumv8lJbTE5P37BoiGg6usr3t7esHR65aLW2CQPoqw6uGm
			DT9gp+3RaqWzzZaszc/h+AAAAEhGSC9TmP9oaP8A/2aBnE+C1OTq8ZCgsy8vMISUrbXOjN7d3om8
			YEFrwfDz+DFHYVJSULSoi6K96iF3EYu0jdKkXZ99KjY8Rnif4lBfdJmYlh8+h2JhYnVjSUA+PG1v
			c7++wCAcIBARED8vHwD//wAA/////wAAAAAAAAAAAAAAACH5BAEAADsALAAAAAAAAxgAAAb/wJ1w
			SCwaj8ikcslsOp/QqHRKrVqv2Kx2y+16v+CweEwum8/otHrNbrvf8Lh8Tq/b7/i8fs/v+/+AgYKD
			hIWGh4iJiouMjY6PkJGSURRXlZOYmZpPCi0aGgAAGg1OBaanpxERCputrmUKAAVVGxqvkhMnJwWs
			ThsKBScTG2cKERLIycoSvWICJxsjpBMNpFABCEMg2UunNaoBVybj4VPjJuVPGiPsIxsbDQACTAUC
			9vf3EiTNkyM1B3U+SVBCoaDBg5QOKhSjcCGUhgibSIBY0AUTDxpgCKG4RIOIIRQvJUEYkqDBHSWR
			hHSocuXJkS4Lmoz55EQDmzcLEFuyIVi1/2r8xESI1q4ouw0RlPg78OIAiBFMD9QYwalBLnjWoIDw
			ACJahBr08EXIEJRJgHMLBgyAIGPBgQXpkJwdl3Zt27dxk6ybwHfCCGoDu+EbLKHGviY3Eiu2gWBn
			lA6QIT9RfGMH5ScgSrCwo+ABQZAiRToJHZohaJCUDKguqNqAaCUZbAjhQEH2DhY06MEIPGXDg7K3
			ClndUSCeiOMadtE74fGBCAAtWE34ODNlEgnSJKT4wD2FB+gjeBsR8OLFBhA1yoNAX36eEwUNBFSj
			wmHoBhp5j9TLVyPDrCcmqDXACwMk8IEMMkDggAxLBKgWgQYiqCCDTOzVVzS1MBHBYPhwQP/Ch00E
			YEMJldVgQwfcRAHCDDOAcE0JJYQTAIz5JTFCDJXR0RlwqG1U2kOnbYREDBVUkMAOCczQQQlIzjBa
			kChB4VprrK1mQBM0nCCECxRYtAMHHpAhggUWWDHCCQD4CJFeGkwA2potcfTESg9Zd0RMMinRgE8A
			HJeBBg8kxwRzFvx5HHTBUAcGdg1IwF0IkIbgQQvhJVFDAiAcUEIMLyQQQwkHIJAAWEr909SRUDU1
			FRQRvBBAAS6QqsSGAQQwAQen4PSfEgiotcAHa0GgQgkrLLhErwP8GuywxVKohAAW8qWAAiNo4F4S
			G3J4DwgBkODEDTgKcUMJHUxRQwmyPlH/5BDrQpFAB45BQUMM3JyboxPz1kviDiI8UGYTeVryGhI2
			VDBEB5UcYMPATAQcRWurUQDxlVAszMEfZ4qyk51FTPBJA8RwHFwSLZTc5wMSTNDZKEw0ACgrEpAJ
			XQueVSfndWduFymkGVAqXhFNBTBCBTUEUAMCFYwQAFPPlndeeju8sF56L1yr4QsIZBBDE9ketZ89
			DYigpRIOLkADgmgX6yTZvp5Nw5+fCKTE0tFKW20M6RqRrT018G2P0t4iFq6JHbwwRQxbSwHjEIsv
			MSOoI9BgQwxOCREAkTUSgcAMRNcwAwWGP7F555+HXmedDjmcRMEHX1ICw0uo/sTEVbYG/8UJFNxb
			CgA8NiH3FHH7+y8UwZM5BZ6wq+mSzSITgfwSokCXwdj8sryEyzUTp0ELogz/BaM679zzBj9rjt8B
			RcJY5AEB0JDiEZdmumk484Iqat5KFJABDS7kxoQEAqiBCi5wgRPgowUFsAD1jkAgtSjIARB0gNqW
			0MC1OGAdRaGGPI4AAlftZQN98YsGaoAfbN2jBgSwBwH6BrhvxaADN7DBDWgQLydcDn9NaNwOdJiE
			GBgtRgmYXAkSEIAXlKACPEQC0sgFOiksEWGmO92cduCBS1gxeURgnRAQJoTXSUEmCQijGMWoBNpJ
			DGJFMhgTMkCBzUBBFBpBCZyU0Bnlsf/ECOTzl4vkGBElTMBfD5hFQ0ZGPBFsj3dDMOQCkcCc7MHH
			E2OK3c2WgJ0TaGdnIcgAyMqnDRpgDQEvoEECysOAUqZACUGjwT12YA8QEJFpT+CfC5Lyv7+B0IDV
			mAAALOAvVDpQQWDyQAb256UkNBACCqqbAADDwABsYIzQTMAGSGjCAK6QbyscAQgCx4QYligxUXSC
			DWwjhcQMwZw8uRy6aFCuAFTgBTFgzA72SEGE+U8KL7AnFRx2xyJUsQh56qdlEFaQG7iONC9pyQ5o
			QICGJiAHED1SEsyIRgFsoF1KYAEFMhCFAuymCjsyEwc4yseE6iUD9BykJCfZsObBhKX/AMVTR44z
			pn8pQJGDepkQaEqmOC7qTJeMVAY4sMkkCAAEMaCBUotGgxB8IAAhYMAplYifBKRvnkUiovve4wlP
			bG+RRuCAAAhIwPjYUgEx8yUyIShWW7qgmAwMFgTXgYO61tUdtjDCAewhNKOwo28CuKcRACiAa56Q
			AC1EjAzFdaIoIMAG4ZzMvdCphHFa9rKYHScTPGeQyG72cwXxbEtjisV/Og+hR7jB2nbAxR2KxqR3
			qkQCGkqAh0Z0CRCrXQUsig01KsGgJyDAEIQ7hn55j5CMiAAonCAK6rmpCbqIrnRxMh+c6UICCVgA
			AxbQgmqQLwoM4I4AIIWCJIDAkwgA/2VuRpneUNKTjqJ4gHM8EiYlcOAvIABGC+QTik9E4LhAWysE
			PSAAVSBgAi4oADeN8AIBOwAAI8DBBCSMA2rltQgJsAcCuFWrDm9jBAJI3BEIi0LAlngC3WpCDVRb
			iRVDVivjzBwTKnADsKx4tUmI0Q5mEMrKiAgBkssGk5RQA4SlN7Q7+B2RjYwAJCfECFik4mv4iYQb
			lEsIC+vilEcLzQMkwMtzogA7drsBbFh1CVW8AW13sOY9kASmp5WJS0tKp5cuz851jtOdo/AJsDLy
			E1I4wbQGbYrptkAJ2GFAVFegAhWsoJQM+C4UwnuPD5QXCUdN6lKRpNR5gcBqJPNIof80YAwAF8FD
			H/qQPATwF2BIwKdHOICDCewOlbmABBXAMRFk/cAL/mXCdrswEYhYRPTU4NjHXhq3dE2EtlqT1Svk
			S4pbepAbmOcJmZ0CUg0Sg/ciAYklGBGJOsApIbygAuRewsK40eRLFCB7q6MAu2U32iiYFkq/vfIO
			sryDCkSZtAU5QGsOgIKCS3SlBSGzmX377YPQtqG0TIL+diWFT8AbuYlQAHOEXaHk9O4I0f1JNUpG
			8kPjrMMB+IAKUC7pJ6AAUuMNwaWZUDIByKLiwLCAAjRQAH1EQR6iiNurlbCAXjsgAyNAgAQQwIEa
			cIADOEBC0SPo62FImC/VOsKo/mH/NGQnWypFToKz/WHRGuRXAdPG+BQ6Q3EwqLQJVQyoQIlArg7k
			RnKqjaeVqZCA1iSg4Cg4uBOKVGZRMbwJL6Dt+5CQARHEEc5F4Lkd+6hnOSZEzv+O8xwBNufYQn7y
			n0dCAfwLBV3e/AzYqdVTUV6rljshBYr+QFSnugTubaAFuvSzEkj9XxAA4AEk0LcTRDACVRh46Ek4
			ANWPDkJgFEAVUEeC8qluoatb+Ag0ONqpElC/XLvPRGLHB4hBGIBppV0PnS+DcdX+hC97+QBe/jIU
			KjAAClTA8MwrCG0JqJuLVSGt7JcIxfFcUaALaBABfmUUSCEFKQB4JtAE3OMmEHZ7/6AGPf7iLRHw
			If73BMbVUzDwgXOzADJQAXXlArfydCgYfUcQACJIgjiwF3aFdRwnBO6DAKHidceGACjyAuQUVuJn
			UShmfgsWgETYBQmgA0iYABiwhIK3BPSnFvZ3eE2geATAf2LQLx9HCZZQhJPgasugDKvQBxEAfBvI
			Bi5gV2hYV8xVFO8QDWnCYAlQAhDWDm04AgDQAe8UfgHALXy4h344hFwYiFZwAEioAwewhBjQhEnw
			hAIihU2AAASQFAhwAaIliJZ4iUUYCpq4iW+IBJzIiUyAaqk2iqOIiaYYBWEEf1+2ioPHObnmiE6Q
			Iot3irRYi7Z4i7iYi7q4i7zYixW++IvAGIzCOIzEWIzGeIzImIxZEAQAOw==]]></Resource>
    <Resource ID="94ed1ed3-118f-9ce1-8ad2-994ab5a03518" Name="toolbar" Type="gif"><![CDATA[R0lGODlhAQAaAKIAAOvr6/Ly8v///5mZme3t7QAAAAAAAAAAACH5BAAAAAAALAAAAAABABoAAAMJ
			KLHcQSDKCcRIADs=]]></Resource>
    <Resource ID="95be4415-7ccb-b87b-f50f-77c8485f6bd9" Name="_for_vdom.js" Type="js"><![CDATA[Q29kZU1pcnJvci5kZWZpbmVNb2RlKCJ2c2NyaXB0IiwgZnVuY3Rpb24oKSB7DQogIHZhciByZWdleFZCU2NyaXB0S2V5d29yZCA9IC9eKD86Q2FsbHxDYXNlfENEYXRlfENsZWFyfENJbnR8Q0xuZ3xDb25zdHxDU3RyfERlc2NyaXB0aW9ufERpbXxEb3xFYWNofEVsc2V8RWxzZUlmfEVuZHxFcnJ8RXJyb3J8RXhpdHxGYWxzZXxGb3J8RnVuY3Rpb258SWZ8TENhc2V8TG9vcHxMVHJpbXxOZXh0fE5vdGhpbmd8Tm93fE51bWJlcnxPbnxQcmVzZXJ2ZXxRdWl0fFJlRGltfFJlc3VtZXxSVHJpbXxTZWxlY3R8U2V0fFN1YnxUaGVufFRvfFRyaW18VHJ1ZXxVQm91bmR8VUNhc2V8VW50aWx8VmJDcnxWYkNyTGZ8VmJMZnxWYlRhYikkL2ltOw0KDQogIHJldHVybiB7DQogICAgdG9rZW46IGZ1bmN0aW9uKHN0cmVhbSkgew0KICAgICAgaWYgKHN0cmVhbS5lYXRTcGFjZSgpKSByZXR1cm4gbnVsbDsNCiAgICAgIHZhciBjaCA9IHN0cmVhbS5uZXh0KCk7DQogICAgICBpZiAoY2ggPT0gIiciKSB7DQogICAgICAJc3RyZWFtLnNraXBUb0VuZCgpOw0KICAgICAgCXJldHVybiAiY29tbWVudCI7DQogICAgICB9DQogICAgICBpZiAoY2ggPT0gJyInKSB7DQogICAgICAgIHZhciBzdGFydFBvc2l0aW9uID0gc3RyZWFtLnBvczsgICAgICAgIA0KICAgICAgICBzdHJlYW0uc2tpcFRvKCciJyk7ICAgICAgICANCiAgICAgIAlpZiAoc3RyZWFtLnBvcyA+IHN0YXJ0UG9zaXRpb24pIHsgICAgICAgICAgDQogICAgICAgICAgc3RyZWFtLm5leHQoKTsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gInN0cmluZyI7DQogICAgICB9DQoNCiAgICAgIGlmICgvXHcvLnRlc3QoY2gpKSB7DQogICAgICAgIHN0cmVhbS5lYXRXaGlsZSgvXHcvKTsNCiAgICAgICAgaWYgKHJlZ2V4VkJTY3JpcHRLZXl3b3JkLnRlc3Qoc3RyZWFtLmN1cnJlbnQoKSkpIHJldHVybiAia2V5d29yZCI7DQogICAgICB9DQogICAgICByZXR1cm4gbnVsbDsNCiAgICB9DQogIH07DQp9KTsNCg0KQ29kZU1pcnJvci5kZWZpbmVNSU1FKCJ0ZXh0L3ZzY3JpcHQiLCAidnNjcmlwdCIpOw0KDQpDb2RlTWlycm9yLmRlZmluZU1vZGUoInhtbCIsIGZ1bmN0aW9uKGNvbmZpZywgcGFyc2VyQ29uZmlnKSB7DQogIHZhciBpbmRlbnRVbml0ID0gY29uZmlnLmluZGVudFVuaXQ7DQogIHZhciBLbHVkZ2VzID0gcGFyc2VyQ29uZmlnLmh0bWxNb2RlID8gew0KICAgIGF1dG9TZWxmQ2xvc2VyczogeyJiciI6IHRydWUsICJpbWciOiB0cnVlLCAiaHIiOiB0cnVlLCAibGluayI6IHRydWUsICJpbnB1dCI6IHRydWUsDQogICAgICAgICAgICAgICAgICAgICAgIm1ldGEiOiB0cnVlLCAiY29sIjogdHJ1ZSwgImZyYW1lIjogdHJ1ZSwgImJhc2UiOiB0cnVlLCAiYXJlYSI6IHRydWV9LA0KICAgIGRvTm90SW5kZW50OiB7InByZSI6IHRydWV9LA0KICAgIGFsbG93VW5xdW90ZWQ6IHRydWUsDQogICAgYWxsb3dNaXNzaW5nOiBmYWxzZQ0KICB9IDoge2F1dG9TZWxmQ2xvc2Vyczoge30sIGRvTm90SW5kZW50OiB7fSwgYWxsb3dVbnF1b3RlZDogZmFsc2UsIGFsbG93TWlzc2luZzogZmFsc2V9Ow0KICB2YXIgYWxpZ25DREFUQSA9IHBhcnNlckNvbmZpZy5hbGlnbkNEQVRBOw0KDQogIC8vIFJldHVybiB2YXJpYWJsZXMgZm9yIHRva2VuaXplcnMNCiAgdmFyIHRhZ05hbWUsIHR5cGU7DQoNCiAgZnVuY3Rpb24gaW5UZXh0KHN0cmVhbSwgc3RhdGUpIHsNCiAgICBmdW5jdGlvbiBjaGFpbihwYXJzZXIpIHsNCiAgICAgIHN0YXRlLnRva2VuaXplID0gcGFyc2VyOw0KICAgICAgcmV0dXJuIHBhcnNlcihzdHJlYW0sIHN0YXRlKTsNCiAgICB9DQoNCiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpOw0KICAgIGlmIChjaCA9PSAiPCIpIHsNCiAgICAgIGlmIChzdHJlYW0uZWF0KCIhIikpIHsNCiAgICAgICAgaWYgKHN0cmVhbS5lYXQoIlsiKSkgew0KICAgICAgICAgIGlmIChzdHJlYW0ubWF0Y2goIkNEQVRBWyIpKSByZXR1cm4gY2hhaW4oaW5CbG9jaygiYXRvbSIsICJdXT4iKSk7DQogICAgICAgICAgZWxzZSByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIGlmIChzdHJlYW0ubWF0Y2goIi0tIikpIHJldHVybiBjaGFpbihpbkJsb2NrKCJjb21tZW50IiwgIi0tPiIpKTsNCiAgICAgICAgZWxzZSBpZiAoc3RyZWFtLm1hdGNoKCJET0NUWVBFIiwgdHJ1ZSwgdHJ1ZSkpIHsNCiAgICAgICAgICBzdHJlYW0uZWF0V2hpbGUoL1tcd1wuX1wtXS8pOw0KICAgICAgICAgIHJldHVybiBjaGFpbihkb2N0eXBlKDEpKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHJldHVybiBudWxsOw0KICAgICAgfQ0KICAgICAgZWxzZSBpZiAoc3RyZWFtLmVhdCgiPyIpKSB7DQogICAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW1x3XC5fXC1dLyk7DQogICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5CbG9jaygibWV0YSIsICI/PiIpOw0KICAgICAgICByZXR1cm4gIm1ldGEiOw0KICAgICAgfQ0KICAgICAgZWxzZSB7DQogICAgICAgIHR5cGUgPSBzdHJlYW0uZWF0KCIvIikgPyAiY2xvc2VUYWciIDogIm9wZW5UYWciOw0KICAgICAgICBzdHJlYW0uZWF0U3BhY2UoKTsNCiAgICAgICAgdGFnTmFtZSA9ICIiOw0KICAgICAgICB2YXIgYzsNCiAgICAgICAgd2hpbGUgKChjID0gc3RyZWFtLmVhdCgvW15cc1x1MDBhMD08PlwiXCdcLz9dLykpKSB0YWdOYW1lICs9IGM7DQogICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5UYWc7DQogICAgICAgIHJldHVybiAidGFnIjsNCiAgICAgIH0NCiAgICB9DQogICAgZWxzZSBpZiAoY2ggPT0gIiYiKSB7DQogICAgICB2YXIgb2s7DQogICAgICBpZiAoc3RyZWFtLmVhdCgiIyIpKSB7DQogICAgICAgIGlmIChzdHJlYW0uZWF0KCJ4IikpIHsNCiAgICAgICAgICBvayA9IHN0cmVhbS5lYXRXaGlsZSgvW2EtZkEtRlxkXS8pICYmIHN0cmVhbS5lYXQoIjsiKTsgICAgICAgICAgDQogICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgb2sgPSBzdHJlYW0uZWF0V2hpbGUoL1tcZF0vKSAmJiBzdHJlYW0uZWF0KCI7Iik7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIG9rID0gc3RyZWFtLmVhdFdoaWxlKC9bXHdcLlwtOl0vKSAmJiBzdHJlYW0uZWF0KCI7Iik7DQogICAgICB9DQogICAgICByZXR1cm4gb2sgPyAiYXRvbSIgOiAiZXJyb3IiOw0KICAgIH0NCiAgICBlbHNlIHsNCiAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW14mPF0vKTsNCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIGluVGFnKHN0cmVhbSwgc3RhdGUpIHsNCiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpOw0KICAgIGlmIChjaCA9PSAiPiIgfHwgKGNoID09ICIvIiAmJiBzdHJlYW0uZWF0KCI+IikpKSB7DQogICAgICBzdGF0ZS50b2tlbml6ZSA9IGluVGV4dDsNCiAgICAgIHR5cGUgPSBjaCA9PSAiPiIgPyAiZW5kVGFnIiA6ICJzZWxmY2xvc2VUYWciOw0KICAgICAgcmV0dXJuICJ0YWciOw0KICAgIH0NCiAgICBlbHNlIGlmIChjaCA9PSAiPSIpIHsNCiAgICAgIHR5cGUgPSAiZXF1YWxzIjsNCiAgICAgIHJldHVybiBudWxsOw0KICAgIH0NCiAgICBlbHNlIGlmICgvW1wnXCJdLy50ZXN0KGNoKSkgew0KICAgICAgc3RhdGUudG9rZW5pemUgPSBpbkF0dHJpYnV0ZShjaCk7DQogICAgICByZXR1cm4gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXlxzXHUwMGEwPTw+XCJcJ1wvP10vKTsNCiAgICAgIHJldHVybiAid29yZCI7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gaW5BdHRyaWJ1dGUocXVvdGUpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkgew0KICAgICAgd2hpbGUgKCFzdHJlYW0uZW9sKCkpIHsNCiAgICAgICAgaWYgKHN0cmVhbS5uZXh0KCkgPT0gcXVvdGUpIHsNCiAgICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IGluVGFnOw0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICB9DQogICAgICByZXR1cm4gInN0cmluZyI7DQogICAgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIGluQmxvY2soc3R5bGUsIHRlcm1pbmF0b3IpIHsNCiAgICByZXR1cm4gZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkgew0KICAgICAgd2hpbGUgKCFzdHJlYW0uZW9sKCkpIHsNCiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaCh0ZXJtaW5hdG9yKSkgew0KICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5UZXh0Ow0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICB9DQogICAgICAgIHN0cmVhbS5uZXh0KCk7DQogICAgICB9DQogICAgICByZXR1cm4gc3R5bGU7DQogICAgfTsNCiAgfQ0KICBmdW5jdGlvbiBkb2N0eXBlKGRlcHRoKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHsNCiAgICAgIHZhciBjaDsNCiAgICAgIHdoaWxlICgoY2ggPSBzdHJlYW0ubmV4dCgpKSAhPSBudWxsKSB7DQogICAgICAgIGlmIChjaCA9PSAiPCIpIHsNCiAgICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IGRvY3R5cGUoZGVwdGggKyAxKTsNCiAgICAgICAgICByZXR1cm4gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7DQogICAgICAgIH0gZWxzZSBpZiAoY2ggPT0gIj4iKSB7DQogICAgICAgICAgaWYgKGRlcHRoID09IDEpIHsNCiAgICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gaW5UZXh0Ow0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gZG9jdHlwZShkZXB0aCAtIDEpOw0KICAgICAgICAgICAgcmV0dXJuIHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpOw0KICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgfQ0KICAgICAgcmV0dXJuICJtZXRhIjsNCiAgICB9Ow0KICB9DQoNCiAgdmFyIGN1clN0YXRlLCBzZXRTdHlsZTsNCiAgZnVuY3Rpb24gcGFzcygpIHsNCiAgICBmb3IgKHZhciBpID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBjdXJTdGF0ZS5jYy5wdXNoKGFyZ3VtZW50c1tpXSk7DQogIH0NCiAgZnVuY3Rpb24gY29udCgpIHsNCiAgICBwYXNzLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCg0KICBmdW5jdGlvbiBwdXNoQ29udGV4dCh0YWdOYW1lLCBzdGFydE9mTGluZSkgew0KICAgIHZhciBub0luZGVudCA9IEtsdWRnZXMuZG9Ob3RJbmRlbnQuaGFzT3duUHJvcGVydHkodGFnTmFtZSkgfHwgKGN1clN0YXRlLmNvbnRleHQgJiYgY3VyU3RhdGUuY29udGV4dC5ub0luZGVudCk7DQogICAgY3VyU3RhdGUuY29udGV4dCA9IHsNCiAgICAgIHByZXY6IGN1clN0YXRlLmNvbnRleHQsDQogICAgICB0YWdOYW1lOiB0YWdOYW1lLA0KICAgICAgaW5kZW50OiBjdXJTdGF0ZS5pbmRlbnRlZCwNCiAgICAgIHN0YXJ0T2ZMaW5lOiBzdGFydE9mTGluZSwNCiAgICAgIG5vSW5kZW50OiBub0luZGVudA0KICAgIH07DQogIH0NCiAgZnVuY3Rpb24gcG9wQ29udGV4dCgpIHsNCiAgICBpZiAoY3VyU3RhdGUuY29udGV4dCkgY3VyU3RhdGUuY29udGV4dCA9IGN1clN0YXRlLmNvbnRleHQucHJldjsNCiAgfQ0KDQogIGZ1bmN0aW9uIGVsZW1lbnQodHlwZSkgew0KICAgIGlmICh0eXBlID09ICJvcGVuVGFnIikgew0KICAgICAgY3VyU3RhdGUudGFnTmFtZSA9IHRhZ05hbWU7DQogICAgICByZXR1cm4gY29udChhdHRyaWJ1dGVzLCBlbmR0YWcoY3VyU3RhdGUuc3RhcnRPZkxpbmUpKTsNCiAgICB9IGVsc2UgaWYgKHR5cGUgPT0gImNsb3NlVGFnIikgew0KICAgICAgdmFyIGVyciA9IGZhbHNlOw0KICAgICAgaWYgKGN1clN0YXRlLmNvbnRleHQpIHsNCiAgICAgICAgZXJyID0gY3VyU3RhdGUuY29udGV4dC50YWdOYW1lICE9IHRhZ05hbWU7DQogICAgICB9IGVsc2Ugew0KICAgICAgICBlcnIgPSB0cnVlOw0KICAgICAgfQ0KICAgICAgaWYgKGVycikgc2V0U3R5bGUgPSAiZXJyb3IiOw0KICAgICAgcmV0dXJuIGNvbnQoZW5kY2xvc2V0YWcoZXJyKSk7DQogICAgfQ0KICAgIHJldHVybiBjb250KCk7DQogIH0NCiAgZnVuY3Rpb24gZW5kdGFnKHN0YXJ0T2ZMaW5lKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKHR5cGUpIHsNCiAgICAgIGlmICh0eXBlID09ICJzZWxmY2xvc2VUYWciIHx8DQogICAgICAgICAgKHR5cGUgPT0gImVuZFRhZyIgJiYgS2x1ZGdlcy5hdXRvU2VsZkNsb3NlcnMuaGFzT3duUHJvcGVydHkoY3VyU3RhdGUudGFnTmFtZS50b0xvd2VyQ2FzZSgpKSkpDQogICAgICAgIHJldHVybiBjb250KCk7DQogICAgICBpZiAodHlwZSA9PSAiZW5kVGFnIikge3B1c2hDb250ZXh0KGN1clN0YXRlLnRhZ05hbWUsIHN0YXJ0T2ZMaW5lKTsgcmV0dXJuIGNvbnQoKTt9DQogICAgICByZXR1cm4gY29udCgpOw0KICAgIH07DQogIH0NCiAgZnVuY3Rpb24gZW5kY2xvc2V0YWcoZXJyKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKHR5cGUpIHsNCiAgICAgIGlmIChlcnIpIHNldFN0eWxlID0gImVycm9yIjsNCiAgICAgIGlmICh0eXBlID09ICJlbmRUYWciKSB7IHBvcENvbnRleHQoKTsgcmV0dXJuIGNvbnQoKTsgfQ0KICAgICAgc2V0U3R5bGUgPSAiZXJyb3IiOw0KICAgICAgcmV0dXJuIGNvbnQoYXJndW1lbnRzLmNhbGxlZSk7DQogICAgfQ0KICB9DQoNCiAgZnVuY3Rpb24gYXR0cmlidXRlcyh0eXBlKSB7DQogICAgaWYgKHR5cGUgPT0gIndvcmQiKSB7c2V0U3R5bGUgPSAiYXR0cmlidXRlIjsgcmV0dXJuIGNvbnQoYXR0cmlidXRlLCBhdHRyaWJ1dGVzKTt9DQogICAgaWYgKHR5cGUgPT0gImVuZFRhZyIgfHwgdHlwZSA9PSAic2VsZmNsb3NlVGFnIikgcmV0dXJuIHBhc3MoKTsNCiAgICBzZXRTdHlsZSA9ICJlcnJvciI7DQogICAgcmV0dXJuIGNvbnQoYXR0cmlidXRlcyk7DQogIH0NCiAgZnVuY3Rpb24gYXR0cmlidXRlKHR5cGUpIHsNCiAgICBpZiAodHlwZSA9PSAiZXF1YWxzIikgcmV0dXJuIGNvbnQoYXR0dmFsdWUsIGF0dHJpYnV0ZXMpOw0KICAgIGlmICghS2x1ZGdlcy5hbGxvd01pc3NpbmcpIHNldFN0eWxlID0gImVycm9yIjsNCiAgICByZXR1cm4gKHR5cGUgPT0gImVuZFRhZyIgfHwgdHlwZSA9PSAic2VsZmNsb3NlVGFnIikgPyBwYXNzKCkgOiBjb250KCk7DQogIH0NCiAgZnVuY3Rpb24gYXR0dmFsdWUodHlwZSkgew0KICAgIGlmICh0eXBlID09ICJzdHJpbmciKSByZXR1cm4gY29udChhdHR2YWx1ZW1heWJlKTsNCiAgICBpZiAodHlwZSA9PSAid29yZCIgJiYgS2x1ZGdlcy5hbGxvd1VucXVvdGVkKSB7c2V0U3R5bGUgPSAic3RyaW5nIjsgcmV0dXJuIGNvbnQoKTt9DQogICAgc2V0U3R5bGUgPSAiZXJyb3IiOw0KICAgIHJldHVybiAodHlwZSA9PSAiZW5kVGFnIiB8fCB0eXBlID09ICJzZWxmQ2xvc2VUYWciKSA/IHBhc3MoKSA6IGNvbnQoKTsNCiAgfQ0KICBmdW5jdGlvbiBhdHR2YWx1ZW1heWJlKHR5cGUpIHsNCiAgICBpZiAodHlwZSA9PSAic3RyaW5nIikgcmV0dXJuIGNvbnQoYXR0dmFsdWVtYXliZSk7DQogICAgZWxzZSByZXR1cm4gcGFzcygpOw0KICB9DQoNCiAgcmV0dXJuIHsNCiAgICBzdGFydFN0YXRlOiBmdW5jdGlvbigpIHsNCiAgICAgIHJldHVybiB7dG9rZW5pemU6IGluVGV4dCwgY2M6IFtdLCBpbmRlbnRlZDogMCwgc3RhcnRPZkxpbmU6IHRydWUsIHRhZ05hbWU6IG51bGwsIGNvbnRleHQ6IG51bGx9Ow0KICAgIH0sDQoNCiAgICB0b2tlbjogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkgew0KICAgICAgaWYgKHN0cmVhbS5zb2woKSkgew0KICAgICAgICBzdGF0ZS5zdGFydE9mTGluZSA9IHRydWU7DQogICAgICAgIHN0YXRlLmluZGVudGVkID0gc3RyZWFtLmluZGVudGF0aW9uKCk7DQogICAgICB9DQogICAgICBpZiAoc3RyZWFtLmVhdFNwYWNlKCkpIHJldHVybiBudWxsOw0KDQogICAgICBzZXRTdHlsZSA9IHR5cGUgPSB0YWdOYW1lID0gbnVsbDsNCiAgICAgIHZhciBzdHlsZSA9IHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpOw0KICAgICAgc3RhdGUudHlwZSA9IHR5cGU7DQogICAgICBpZiAoKHN0eWxlIHx8IHR5cGUpICYmIHN0eWxlICE9ICJjb21tZW50Iikgew0KICAgICAgICBjdXJTdGF0ZSA9IHN0YXRlOw0KICAgICAgICB3aGlsZSAodHJ1ZSkgew0KICAgICAgICAgIHZhciBjb21iID0gc3RhdGUuY2MucG9wKCkgfHwgZWxlbWVudDsNCiAgICAgICAgICBpZiAoY29tYih0eXBlIHx8IHN0eWxlKSkgYnJlYWs7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIHN0YXRlLnN0YXJ0T2ZMaW5lID0gZmFsc2U7DQogICAgICByZXR1cm4gc2V0U3R5bGUgfHwgc3R5bGU7DQogICAgfSwNCg0KICAgIGluZGVudDogZnVuY3Rpb24oc3RhdGUsIHRleHRBZnRlciwgZnVsbExpbmUpIHsNCiAgICAgIHZhciBjb250ZXh0ID0gc3RhdGUuY29udGV4dDsNCiAgICAgIGlmICgoc3RhdGUudG9rZW5pemUgIT0gaW5UYWcgJiYgc3RhdGUudG9rZW5pemUgIT0gaW5UZXh0KSB8fA0KICAgICAgICAgIGNvbnRleHQgJiYgY29udGV4dC5ub0luZGVudCkNCiAgICAgICAgcmV0dXJuIGZ1bGxMaW5lID8gZnVsbExpbmUubWF0Y2goL14oXHMqKS8pWzBdLmxlbmd0aCA6IDA7DQogICAgICBpZiAoYWxpZ25DREFUQSAmJiAvPCFcW0NEQVRBXFsvLnRlc3QodGV4dEFmdGVyKSkgcmV0dXJuIDA7DQogICAgICBpZiAoY29udGV4dCAmJiAvXjxcLy8udGVzdCh0ZXh0QWZ0ZXIpKQ0KICAgICAgICBjb250ZXh0ID0gY29udGV4dC5wcmV2Ow0KICAgICAgd2hpbGUgKGNvbnRleHQgJiYgIWNvbnRleHQuc3RhcnRPZkxpbmUpDQogICAgICAgIGNvbnRleHQgPSBjb250ZXh0LnByZXY7DQogICAgICBpZiAoY29udGV4dCkgcmV0dXJuIGNvbnRleHQuaW5kZW50ICsgaW5kZW50VW5pdDsNCiAgICAgIGVsc2UgcmV0dXJuIDA7DQogICAgfSwNCg0KICAgIGNvbXBhcmVTdGF0ZXM6IGZ1bmN0aW9uKGEsIGIpIHsNCiAgICAgIGlmIChhLmluZGVudGVkICE9IGIuaW5kZW50ZWQgfHwgYS50b2tlbml6ZSAhPSBiLnRva2VuaXplKSByZXR1cm4gZmFsc2U7DQogICAgICBmb3IgKHZhciBjYSA9IGEuY29udGV4dCwgY2IgPSBiLmNvbnRleHQ7IDsgY2EgPSBjYS5wcmV2LCBjYiA9IGNiLnByZXYpIHsNCiAgICAgICAgaWYgKCFjYSB8fCAhY2IpIHJldHVybiBjYSA9PSBjYjsNCiAgICAgICAgaWYgKGNhLnRhZ05hbWUgIT0gY2IudGFnTmFtZSkgcmV0dXJuIGZhbHNlOw0KICAgICAgfQ0KICAgIH0sDQoNCiAgICBlbGVjdHJpY0NoYXJzOiAiLyINCiAgfTsNCn0pOw0KDQpDb2RlTWlycm9yLmRlZmluZU1JTUUoImFwcGxpY2F0aW9uL3htbCIsICJ4bWwiKTsNCkNvZGVNaXJyb3IuZGVmaW5lTUlNRSgidGV4dC9odG1sIiwge25hbWU6ICJ4bWwiLCBodG1sTW9kZTogdHJ1ZX0pOw0KDQpDb2RlTWlycm9yLmRlZmluZU1vZGUoInB5dGhvbiIsIGZ1bmN0aW9uKGNvbmYsIHBhcnNlckNvbmYpIHsNCiAgICB2YXIgRVJST1JDTEFTUyA9ICdlcnJvcic7DQogICAgDQogICAgZnVuY3Rpb24gd29yZFJlZ2V4cCh3b3Jkcykgew0KICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cCgiXigoIiArIHdvcmRzLmpvaW4oIil8KCIpICsgIikpXFxiIik7DQogICAgfQ0KICAgIA0KICAgIHZhciBzaW5nbGVPcGVyYXRvcnMgPSBuZXcgUmVnRXhwKCJeW1xcK1xcLVxcKi8lJnxcXF5+PD4hXSIpOw0KICAgIHZhciBzaW5nbGVEZWxpbWl0ZXJzID0gbmV3IFJlZ0V4cCgnXltcXChcXClcXFtcXF1cXHtcXH1ALDpgPTtcXC5dJyk7DQogICAgdmFyIGRvdWJsZU9wZXJhdG9ycyA9IG5ldyBSZWdFeHAoIl4oKD09KXwoIT0pfCg8PSl8KD49KXwoPD4pfCg8PCl8KD4+KXwoLy8pfChcXCpcXCopKSIpOw0KICAgIHZhciBkb3VibGVEZWxpbWl0ZXJzID0gbmV3IFJlZ0V4cCgiXigoXFwrPSl8KFxcLT0pfChcXCo9KXwoJT0pfCgvPSl8KCY9KXwoXFx8PSl8KFxcXj0pKSIpOw0KICAgIHZhciB0cmlwbGVEZWxpbWl0ZXJzID0gbmV3IFJlZ0V4cCgiXigoLy89KXwoPj49KXwoPDw9KXwoXFwqXFwqPSkpIik7DQogICAgdmFyIGlkZW50aWZpZXJzID0gbmV3IFJlZ0V4cCgiXltfQS1aYS16XVtfQS1aYS16MC05XSoiKTsNCg0KICAgIHZhciB3b3JkT3BlcmF0b3JzID0gd29yZFJlZ2V4cChbJ2FuZCcsICdvcicsICdub3QnLCAnaXMnLCAnaW4nXSk7DQogICAgdmFyIGNvbW1vbmtleXdvcmRzID0gWydhcycsICdhc3NlcnQnLCAnYnJlYWsnLCAnY2xhc3MnLCAnY29udGludWUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnZGVmJywgJ2RlbCcsICdlbGlmJywgJ2Vsc2UnLCAnZXhjZXB0JywgJ2ZpbmFsbHknLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnZm9yJywgJ2Zyb20nLCAnZ2xvYmFsJywgJ2lmJywgJ2ltcG9ydCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICdsYW1iZGEnLCAncGFzcycsICdyYWlzZScsICdyZXR1cm4nLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAndHJ5JywgJ3doaWxlJywgJ3dpdGgnLCAneWllbGQnXTsNCiAgICB2YXIgY29tbW9uQnVpbHRpbnMgPSBbJ2FicycsICdhbGwnLCAnYW55JywgJ2JpbicsICdib29sJywgJ2J5dGVhcnJheScsICdjYWxsYWJsZScsICdjaHInLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnY2xhc3NtZXRob2QnLCAnY29tcGlsZScsICdjb21wbGV4JywgJ2RlbGF0dHInLCAnZGljdCcsICdkaXInLCAnZGl2bW9kJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VudW1lcmF0ZScsICdldmFsJywgJ2ZpbHRlcicsICdmbG9hdCcsICdmb3JtYXQnLCAnZnJvemVuc2V0JywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2dldGF0dHInLCAnZ2xvYmFscycsICdoYXNhdHRyJywgJ2hhc2gnLCAnaGVscCcsICdoZXgnLCAnaWQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnaW5wdXQnLCAnaW50JywgJ2lzaW5zdGFuY2UnLCAnaXNzdWJjbGFzcycsICdpdGVyJywgJ2xlbicsDQogICAgICAgICAgICAgICAgICAgICAgICAgICdsaXN0JywgJ2xvY2FscycsICdtYXAnLCAnbWF4JywgJ21lbW9yeXZpZXcnLCAnbWluJywgJ25leHQnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAnb2JqZWN0JywgJ29jdCcsICdvcGVuJywgJ29yZCcsICdwb3cnLCAncHJvcGVydHknLCAncmFuZ2UnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAncmVwcicsICdyZXZlcnNlZCcsICdyb3VuZCcsICdzZXQnLCAnc2V0YXR0cicsICdzbGljZScsDQogICAgICAgICAgICAgICAgICAgICAgICAgICdzb3J0ZWQnLCAnc3RhdGljbWV0aG9kJywgJ3N0cicsICdzdW0nLCAnc3VwZXInLCAndHVwbGUnLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAndHlwZScsICd2YXJzJywgJ3ppcCcsICdfX2ltcG9ydF9fJywgJ05vdEltcGxlbWVudGVkJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgJ0VsbGlwc2lzJywgJ19fZGVidWdfXyddOw0KICAgIHZhciBweTIgPSB7J2J1aWx0aW5zJzogWydhcHBseScsICdiYXNlc3RyaW5nJywgJ2J1ZmZlcicsICdjbXAnLCAnY29lcmNlJywgJ2V4ZWNmaWxlJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZmlsZScsICdpbnRlcm4nLCAnbG9uZycsICdyYXdfaW5wdXQnLCAncmVkdWNlJywgJ3JlbG9hZCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3VuaWNocicsICd1bmljb2RlJywgJ3hyYW5nZScsICdGYWxzZScsICdUcnVlJywgJ05vbmUnXSwNCiAgICAgICAgICAgICAgICdrZXl3b3Jkcyc6IFsnZXhlYycsICdwcmludCddfTsNCiAgICB2YXIgcHkzID0geydidWlsdGlucyc6IFsnYXNjaWknLCAnYnl0ZXMnLCAnZXhlYycsICdwcmludCddLA0KICAgICAgICAgICAgICAgJ2tleXdvcmRzJzogWydub25sb2NhbCcsICdGYWxzZScsICdUcnVlJywgJ05vbmUnXX07DQoNCiAgICBpZiAoISFwYXJzZXJDb25mLnZlcnNpb24gJiYgcGFyc2VJbnQocGFyc2VyQ29uZi52ZXJzaW9uLCAxMCkgPT09IDMpIHsNCiAgICAgICAgY29tbW9ua2V5d29yZHMgPSBjb21tb25rZXl3b3Jkcy5jb25jYXQocHkzLmtleXdvcmRzKTsNCiAgICAgICAgY29tbW9uQnVpbHRpbnMgPSBjb21tb25CdWlsdGlucy5jb25jYXQocHkzLmJ1aWx0aW5zKTsNCiAgICAgICAgdmFyIHN0cmluZ1ByZWZpeGVzID0gbmV3IFJlZ0V4cCgiXigoW3JiXXwoYnIpKT8oJ3szfXxcInszfXxbJ1wiXSkpIiwgImkiKTsNCiAgICB9IGVsc2Ugew0KICAgICAgICBjb21tb25rZXl3b3JkcyA9IGNvbW1vbmtleXdvcmRzLmNvbmNhdChweTIua2V5d29yZHMpOw0KICAgICAgICBjb21tb25CdWlsdGlucyA9IGNvbW1vbkJ1aWx0aW5zLmNvbmNhdChweTIuYnVpbHRpbnMpOw0KICAgICAgICB2YXIgc3RyaW5nUHJlZml4ZXMgPSBuZXcgUmVnRXhwKCJeKChbcnViXXwodXIpfChicikpPygnezN9fFwiezN9fFsnXCJdKSkiLCAiaSIpOw0KICAgIH0NCiAgICB2YXIga2V5d29yZHMgPSB3b3JkUmVnZXhwKGNvbW1vbmtleXdvcmRzKTsNCiAgICB2YXIgYnVpbHRpbnMgPSB3b3JkUmVnZXhwKGNvbW1vbkJ1aWx0aW5zKTsNCg0KICAgIHZhciBpbmRlbnRJbmZvID0gbnVsbDsNCg0KICAgIC8vIHRva2VuaXplcnMNCiAgICBmdW5jdGlvbiB0b2tlbkJhc2Uoc3RyZWFtLCBzdGF0ZSkgew0KICAgICAgICAvLyBIYW5kbGUgc2NvcGUgY2hhbmdlcw0KICAgICAgICBpZiAoc3RyZWFtLnNvbCgpKSB7DQogICAgICAgICAgICB2YXIgc2NvcGVPZmZzZXQgPSBzdGF0ZS5zY29wZXNbMF0ub2Zmc2V0Ow0KICAgICAgICAgICAgaWYgKHN0cmVhbS5lYXRTcGFjZSgpKSB7DQogICAgICAgICAgICAgICAgdmFyIGxpbmVPZmZzZXQgPSBzdHJlYW0uaW5kZW50YXRpb24oKTsNCiAgICAgICAgICAgICAgICBpZiAobGluZU9mZnNldCA+IHNjb3BlT2Zmc2V0KSB7DQogICAgICAgICAgICAgICAgICAgIGluZGVudEluZm8gPSAnaW5kZW50JzsNCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmVPZmZzZXQgPCBzY29wZU9mZnNldCkgew0KICAgICAgICAgICAgICAgICAgICBpbmRlbnRJbmZvID0gJ2RlZGVudCc7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoc2NvcGVPZmZzZXQgPiAwKSB7DQogICAgICAgICAgICAgICAgICAgIGRlZGVudChzdHJlYW0sIHN0YXRlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN0cmVhbS5lYXRTcGFjZSgpKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgdmFyIGNoID0gc3RyZWFtLnBlZWsoKTsNCiAgICAgICAgDQogICAgICAgIC8vIEhhbmRsZSBDb21tZW50cw0KICAgICAgICBpZiAoY2ggPT09ICcjJykgew0KICAgICAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpOw0KICAgICAgICAgICAgcmV0dXJuICdjb21tZW50JzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gSGFuZGxlIE51bWJlciBMaXRlcmFscw0KICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eWzAtOVwuXS8sIGZhbHNlKSkgew0KICAgICAgICAgICAgdmFyIGZsb2F0TGl0ZXJhbCA9IGZhbHNlOw0KICAgICAgICAgICAgLy8gRmxvYXRzDQogICAgICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eXGQqXC5cZCsoZVtcK1wtXT9cZCspPy9pKSkgeyBmbG9hdExpdGVyYWwgPSB0cnVlOyB9DQogICAgICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eXGQrXC5cZCovKSkgeyBmbG9hdExpdGVyYWwgPSB0cnVlOyB9DQogICAgICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eXC5cZCsvKSkgeyBmbG9hdExpdGVyYWwgPSB0cnVlOyB9DQogICAgICAgICAgICBpZiAoZmxvYXRMaXRlcmFsKSB7DQogICAgICAgICAgICAgICAgLy8gRmxvYXQgbGl0ZXJhbHMgbWF5IGJlICJpbWFnaW5hcnkiDQogICAgICAgICAgICAgICAgc3RyZWFtLmVhdCgvSi9pKTsNCiAgICAgICAgICAgICAgICByZXR1cm4gJ251bWJlcic7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvLyBJbnRlZ2Vycw0KICAgICAgICAgICAgdmFyIGludExpdGVyYWwgPSBmYWxzZTsNCiAgICAgICAgICAgIC8vIEhleA0KICAgICAgICAgICAgaWYgKHN0cmVhbS5tYXRjaCgvXjB4WzAtOWEtZl0rL2kpKSB7IGludExpdGVyYWwgPSB0cnVlOyB9DQogICAgICAgICAgICAvLyBCaW5hcnkNCiAgICAgICAgICAgIGlmIChzdHJlYW0ubWF0Y2goL14wYlswMV0rL2kpKSB7IGludExpdGVyYWwgPSB0cnVlOyB9DQogICAgICAgICAgICAvLyBPY3RhbA0KICAgICAgICAgICAgaWYgKHN0cmVhbS5tYXRjaCgvXjBvWzAtN10rL2kpKSB7IGludExpdGVyYWwgPSB0cnVlOyB9DQogICAgICAgICAgICAvLyBEZWNpbWFsDQogICAgICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eWzEtOV1cZCooZVtcK1wtXT9cZCspPy8pKSB7DQogICAgICAgICAgICAgICAgLy8gRGVjaW1hbCBsaXRlcmFscyBtYXkgYmUgImltYWdpbmFyeSINCiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0KC9KL2kpOw0KICAgICAgICAgICAgICAgIC8vIFRPRE8gLSBDYW4geW91IGhhdmUgaW1hZ2luYXJ5IGxvbmdzPw0KICAgICAgICAgICAgICAgIGludExpdGVyYWwgPSB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgLy8gWmVybyBieSBpdHNlbGYgd2l0aCBubyBvdGhlciBwaWVjZSBvZiBudW1iZXIuDQogICAgICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKC9eMCg/IVtcZHhdKS9pKSkgeyBpbnRMaXRlcmFsID0gdHJ1ZTsgfQ0KICAgICAgICAgICAgaWYgKGludExpdGVyYWwpIHsNCiAgICAgICAgICAgICAgICAvLyBJbnRlZ2VyIGxpdGVyYWxzIG1heSBiZSAibG9uZyINCiAgICAgICAgICAgICAgICBzdHJlYW0uZWF0KC9ML2kpOw0KICAgICAgICAgICAgICAgIHJldHVybiAnbnVtYmVyJzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gSGFuZGxlIFN0cmluZ3MNCiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaChzdHJpbmdQcmVmaXhlcykpIHsNCiAgICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gdG9rZW5TdHJpbmdGYWN0b3J5KHN0cmVhbS5jdXJyZW50KCkpOw0KICAgICAgICAgICAgcmV0dXJuIHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBIYW5kbGUgb3BlcmF0b3JzIGFuZCBEZWxpbWl0ZXJzDQogICAgICAgIGlmIChzdHJlYW0ubWF0Y2godHJpcGxlRGVsaW1pdGVycykgfHwgc3RyZWFtLm1hdGNoKGRvdWJsZURlbGltaXRlcnMpKSB7DQogICAgICAgICAgICByZXR1cm4gbnVsbDsNCiAgICAgICAgfQ0KICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKGRvdWJsZU9wZXJhdG9ycykNCiAgICAgICAgICAgIHx8IHN0cmVhbS5tYXRjaChzaW5nbGVPcGVyYXRvcnMpDQogICAgICAgICAgICB8fCBzdHJlYW0ubWF0Y2god29yZE9wZXJhdG9ycykpIHsNCiAgICAgICAgICAgIHJldHVybiAnb3BlcmF0b3InOw0KICAgICAgICB9DQogICAgICAgIGlmIChzdHJlYW0ubWF0Y2goc2luZ2xlRGVsaW1pdGVycykpIHsNCiAgICAgICAgICAgIHJldHVybiBudWxsOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICBpZiAoc3RyZWFtLm1hdGNoKGtleXdvcmRzKSkgew0KICAgICAgICAgICAgcmV0dXJuICdrZXl3b3JkJzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgaWYgKHN0cmVhbS5tYXRjaChidWlsdGlucykpIHsNCiAgICAgICAgICAgIHJldHVybiAnYnVpbHRpbic7DQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIChzdHJlYW0ubWF0Y2goaWRlbnRpZmllcnMpKSB7DQogICAgICAgICAgICByZXR1cm4gJ3ZhcmlhYmxlJzsNCiAgICAgICAgfQ0KICAgICAgICANCiAgICAgICAgLy8gSGFuZGxlIG5vbi1kZXRlY3RlZCBpdGVtcw0KICAgICAgICBzdHJlYW0ubmV4dCgpOw0KICAgICAgICByZXR1cm4gRVJST1JDTEFTUzsNCiAgICB9DQogICAgDQogICAgZnVuY3Rpb24gdG9rZW5TdHJpbmdGYWN0b3J5KGRlbGltaXRlcikgew0KICAgICAgICB3aGlsZSAoJ3J1YicuaW5kZXhPZihkZWxpbWl0ZXIuY2hhckF0KDApLnRvTG93ZXJDYXNlKCkpID49IDApIHsNCiAgICAgICAgICAgIGRlbGltaXRlciA9IGRlbGltaXRlci5zdWJzdHIoMSk7DQogICAgICAgIH0NCiAgICAgICAgdmFyIHNpbmdsZWxpbmUgPSBkZWxpbWl0ZXIubGVuZ3RoID09IDE7DQogICAgICAgIHZhciBPVVRDTEFTUyA9ICdzdHJpbmcnOw0KICAgICAgICANCiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIHRva2VuU3RyaW5nKHN0cmVhbSwgc3RhdGUpIHsNCiAgICAgICAgICAgIHdoaWxlICghc3RyZWFtLmVvbCgpKSB7DQogICAgICAgICAgICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXiciXFxdLyk7DQogICAgICAgICAgICAgICAgaWYgKHN0cmVhbS5lYXQoJ1xcJykpIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyZWFtLm5leHQoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNpbmdsZWxpbmUgJiYgc3RyZWFtLmVvbCgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT1VUQ0xBU1M7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHN0cmVhbS5tYXRjaChkZWxpbWl0ZXIpKSB7DQogICAgICAgICAgICAgICAgICAgIHN0YXRlLnRva2VuaXplID0gdG9rZW5CYXNlOw0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gT1VUQ0xBU1M7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgc3RyZWFtLmVhdCgvWyciXS8pOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChzaW5nbGVsaW5lKSB7DQogICAgICAgICAgICAgICAgaWYgKHBhcnNlckNvbmYuc2luZ2xlTGluZVN0cmluZ0Vycm9ycykgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gRVJST1JDTEFTUzsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IHRva2VuQmFzZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICByZXR1cm4gT1VUQ0xBU1M7DQogICAgICAgIH07DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGluZGVudChzdHJlYW0sIHN0YXRlLCB0eXBlKSB7DQogICAgICAgIHR5cGUgPSB0eXBlIHx8ICdweSc7DQogICAgICAgIHZhciBpbmRlbnRVbml0ID0gMDsNCiAgICAgICAgaWYgKHR5cGUgPT09ICdweScpIHsNCiAgICAgICAgICAgIGlmIChzdGF0ZS5zY29wZXNbMF0udHlwZSAhPT0gJ3B5Jykgew0KICAgICAgICAgICAgICAgIHN0YXRlLnNjb3Blc1swXS5vZmZzZXQgPSBzdHJlYW0uaW5kZW50YXRpb24oKTsNCiAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICB9DQogICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0YXRlLnNjb3Blcy5sZW5ndGg7ICsraSkgew0KICAgICAgICAgICAgICAgIGlmIChzdGF0ZS5zY29wZXNbaV0udHlwZSA9PT0gJ3B5Jykgew0KICAgICAgICAgICAgICAgICAgICBpbmRlbnRVbml0ID0gc3RhdGUuc2NvcGVzW2ldLm9mZnNldCArIGNvbmYuaW5kZW50VW5pdDsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaW5kZW50VW5pdCA9IHN0cmVhbS5jb2x1bW4oKSArIHN0cmVhbS5jdXJyZW50KCkubGVuZ3RoOw0KICAgICAgICB9DQogICAgICAgIHN0YXRlLnNjb3Blcy51bnNoaWZ0KHsNCiAgICAgICAgICAgIG9mZnNldDogaW5kZW50VW5pdCwNCiAgICAgICAgICAgIHR5cGU6IHR5cGUNCiAgICAgICAgfSk7DQogICAgfQ0KICAgIA0KICAgIGZ1bmN0aW9uIGRlZGVudChzdHJlYW0sIHN0YXRlLCB0eXBlKSB7DQogICAgICAgIHR5cGUgPSB0eXBlIHx8ICdweSc7DQogICAgICAgIGlmIChzdGF0ZS5zY29wZXMubGVuZ3RoID09IDEpIHJldHVybjsNCiAgICAgICAgaWYgKHN0YXRlLnNjb3Blc1swXS50eXBlID09PSAncHknKSB7DQogICAgICAgICAgICB2YXIgX2luZGVudCA9IHN0cmVhbS5pbmRlbnRhdGlvbigpOw0KICAgICAgICAgICAgdmFyIF9pbmRlbnRfaW5kZXggPSAtMTsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RhdGUuc2NvcGVzLmxlbmd0aDsgKytpKSB7DQogICAgICAgICAgICAgICAgaWYgKF9pbmRlbnQgPT09IHN0YXRlLnNjb3Blc1tpXS5vZmZzZXQpIHsNCiAgICAgICAgICAgICAgICAgICAgX2luZGVudF9pbmRleCA9IGk7DQogICAgICAgICAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGlmIChfaW5kZW50X2luZGV4ID09PSAtMSkgew0KICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOw0KICAgICAgICAgICAgfQ0KICAgICAgICAgICAgd2hpbGUgKHN0YXRlLnNjb3Blc1swXS5vZmZzZXQgIT09IF9pbmRlbnQpIHsNCiAgICAgICAgICAgICAgICBzdGF0ZS5zY29wZXMuc2hpZnQoKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgaWYgKHR5cGUgPT09ICdweScpIHsNCiAgICAgICAgICAgICAgICBzdGF0ZS5zY29wZXNbMF0ub2Zmc2V0ID0gc3RyZWFtLmluZGVudGF0aW9uKCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICBpZiAoc3RhdGUuc2NvcGVzWzBdLnR5cGUgIT0gdHlwZSkgew0KICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RhdGUuc2NvcGVzLnNoaWZ0KCk7DQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfQ0KDQogICAgZnVuY3Rpb24gdG9rZW5MZXhlcihzdHJlYW0sIHN0YXRlKSB7DQogICAgICAgIGluZGVudEluZm8gPSBudWxsOw0KICAgICAgICB2YXIgc3R5bGUgPSBzdGF0ZS50b2tlbml6ZShzdHJlYW0sIHN0YXRlKTsNCiAgICAgICAgdmFyIGN1cnJlbnQgPSBzdHJlYW0uY3VycmVudCgpOw0KDQogICAgICAgIC8vIEhhbmRsZSAnLicgY29ubmVjdGVkIGlkZW50aWZpZXJzDQogICAgICAgIGlmIChjdXJyZW50ID09PSAnLicpIHsNCiAgICAgICAgICAgIHN0eWxlID0gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7DQogICAgICAgICAgICBjdXJyZW50ID0gc3RyZWFtLmN1cnJlbnQoKTsNCiAgICAgICAgICAgIGlmIChzdHlsZSA9PT0gJ3ZhcmlhYmxlJyB8fCBzdHlsZSA9PT0gJ2J1aWx0aW4nKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuICd2YXJpYWJsZSc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBFUlJPUkNMQVNTOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBIYW5kbGUgZGVjb3JhdG9ycw0KICAgICAgICBpZiAoY3VycmVudCA9PT0gJ0AnKSB7DQogICAgICAgICAgICBzdHlsZSA9IHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpOw0KICAgICAgICAgICAgY3VycmVudCA9IHN0cmVhbS5jdXJyZW50KCk7DQogICAgICAgICAgICBpZiAoc3R5bGUgPT09ICd2YXJpYWJsZScNCiAgICAgICAgICAgICAgICB8fCBjdXJyZW50ID09PSAnQHN0YXRpY21ldGhvZCcNCiAgICAgICAgICAgICAgICB8fCBjdXJyZW50ID09PSAnQGNsYXNzbWV0aG9kJykgew0KICAgICAgICAgICAgICAgIHJldHVybiAnbWV0YSc7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIHJldHVybiBFUlJPUkNMQVNTOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICAvLyBIYW5kbGUgc2NvcGUgY2hhbmdlcy4NCiAgICAgICAgaWYgKGN1cnJlbnQgPT09ICdwYXNzJyB8fCBjdXJyZW50ID09PSAncmV0dXJuJykgew0KICAgICAgICAgICAgc3RhdGUuZGVkZW50ICs9IDE7DQogICAgICAgIH0NCiAgICAgICAgaWYgKChjdXJyZW50ID09PSAnOicgJiYgIXN0YXRlLmxhbWJkYSAmJiBzdGF0ZS5zY29wZXNbMF0udHlwZSA9PSAncHknKQ0KICAgICAgICAgICAgfHwgaW5kZW50SW5mbyA9PT0gJ2luZGVudCcpIHsNCiAgICAgICAgICAgIGluZGVudChzdHJlYW0sIHN0YXRlKTsNCiAgICAgICAgfQ0KICAgICAgICB2YXIgZGVsaW1pdGVyX2luZGV4ID0gJ1soeycuaW5kZXhPZihjdXJyZW50KTsNCiAgICAgICAgaWYgKGRlbGltaXRlcl9pbmRleCAhPT0gLTEpIHsNCiAgICAgICAgICAgIGluZGVudChzdHJlYW0sIHN0YXRlLCAnXSl9Jy5zbGljZShkZWxpbWl0ZXJfaW5kZXgsIGRlbGltaXRlcl9pbmRleCsxKSk7DQogICAgICAgIH0NCiAgICAgICAgaWYgKGluZGVudEluZm8gPT09ICdkZWRlbnQnKSB7DQogICAgICAgICAgICBpZiAoZGVkZW50KHN0cmVhbSwgc3RhdGUpKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIEVSUk9SQ0xBU1M7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICAgICAgZGVsaW1pdGVyX2luZGV4ID0gJ10pfScuaW5kZXhPZihjdXJyZW50KTsNCiAgICAgICAgaWYgKGRlbGltaXRlcl9pbmRleCAhPT0gLTEpIHsNCiAgICAgICAgICAgIGlmIChkZWRlbnQoc3RyZWFtLCBzdGF0ZSwgY3VycmVudCkpIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gRVJST1JDTEFTUzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICBpZiAoc3RhdGUuZGVkZW50ID4gMCAmJiBzdHJlYW0uZW9sKCkgJiYgc3RhdGUuc2NvcGVzWzBdLnR5cGUgPT0gJ3B5Jykgew0KICAgICAgICAgICAgaWYgKHN0YXRlLnNjb3Blcy5sZW5ndGggPiAxKSBzdGF0ZS5zY29wZXMuc2hpZnQoKTsNCiAgICAgICAgICAgIHN0YXRlLmRlZGVudCAtPSAxOw0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICByZXR1cm4gc3R5bGU7DQogICAgfQ0KDQogICAgdmFyIGV4dGVybmFsID0gew0KICAgICAgICBzdGFydFN0YXRlOiBmdW5jdGlvbihiYXNlY29sdW1uKSB7DQogICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICB0b2tlbml6ZTogdG9rZW5CYXNlLA0KICAgICAgICAgICAgICBzY29wZXM6IFt7b2Zmc2V0OmJhc2Vjb2x1bW4gfHwgMCwgdHlwZToncHknfV0sDQogICAgICAgICAgICAgIGxhc3RUb2tlbjogbnVsbCwNCiAgICAgICAgICAgICAgbGFtYmRhOiBmYWxzZSwNCiAgICAgICAgICAgICAgZGVkZW50OiAwDQogICAgICAgICAgfTsNCiAgICAgICAgfSwNCiAgICAgICAgDQogICAgICAgIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7DQogICAgICAgICAgICB2YXIgc3R5bGUgPSB0b2tlbkxleGVyKHN0cmVhbSwgc3RhdGUpOw0KICAgICAgICAgICAgDQogICAgICAgICAgICBzdGF0ZS5sYXN0VG9rZW4gPSB7c3R5bGU6c3R5bGUsIGNvbnRlbnQ6IHN0cmVhbS5jdXJyZW50KCl9Ow0KICAgICAgICAgICAgDQogICAgICAgICAgICBpZiAoc3RyZWFtLmVvbCgpICYmIHN0cmVhbS5sYW1iZGEpIHsNCiAgICAgICAgICAgICAgICBzdGF0ZS5sYW1iZGEgPSBmYWxzZTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIA0KICAgICAgICAgICAgcmV0dXJuIHN0eWxlOw0KICAgICAgICB9LA0KICAgICAgICANCiAgICAgICAgaW5kZW50OiBmdW5jdGlvbihzdGF0ZSwgdGV4dEFmdGVyKSB7DQogICAgICAgICAgICBpZiAoc3RhdGUudG9rZW5pemUgIT0gdG9rZW5CYXNlKSB7DQogICAgICAgICAgICAgICAgcmV0dXJuIDA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBzdGF0ZS5zY29wZXNbMF0ub2Zmc2V0Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgIH07DQogICAgcmV0dXJuIGV4dGVybmFsOw0KfSk7DQoNCkNvZGVNaXJyb3IuZGVmaW5lTUlNRSgidGV4dC94LXB5dGhvbiIsICJweXRob24iKTsNCg0KQ29kZU1pcnJvci5kZWZpbmVNb2RlKCJqYXZhc2NyaXB0IiwgZnVuY3Rpb24oY29uZmlnLCBwYXJzZXJDb25maWcpIHsNCiAgdmFyIGluZGVudFVuaXQgPSBjb25maWcuaW5kZW50VW5pdDsNCiAgdmFyIGpzb25Nb2RlID0gcGFyc2VyQ29uZmlnLmpzb247DQoNCiAgLy8gVG9rZW5pemVyDQoNCiAgdmFyIGtleXdvcmRzID0gZnVuY3Rpb24oKXsNCiAgICBmdW5jdGlvbiBrdyh0eXBlKSB7cmV0dXJuIHt0eXBlOiB0eXBlLCBzdHlsZTogImtleXdvcmQifTt9DQogICAgdmFyIEEgPSBrdygia2V5d29yZCBhIiksIEIgPSBrdygia2V5d29yZCBiIiksIEMgPSBrdygia2V5d29yZCBjIik7DQogICAgdmFyIG9wZXJhdG9yID0ga3coIm9wZXJhdG9yIiksIGF0b20gPSB7dHlwZTogImF0b20iLCBzdHlsZTogImF0b20ifTsNCiAgICByZXR1cm4gew0KICAgICAgImlmIjogQSwgIndoaWxlIjogQSwgIndpdGgiOiBBLCAiZWxzZSI6IEIsICJkbyI6IEIsICJ0cnkiOiBCLCAiZmluYWxseSI6IEIsDQogICAgICAicmV0dXJuIjogQywgImJyZWFrIjogQywgImNvbnRpbnVlIjogQywgIm5ldyI6IEMsICJkZWxldGUiOiBDLCAidGhyb3ciOiBDLA0KICAgICAgInZhciI6IGt3KCJ2YXIiKSwgImNvbnN0Ijoga3coInZhciIpLCAibGV0Ijoga3coInZhciIpLA0KICAgICAgImZ1bmN0aW9uIjoga3coImZ1bmN0aW9uIiksICJjYXRjaCI6IGt3KCJjYXRjaCIpLA0KICAgICAgImZvciI6IGt3KCJmb3IiKSwgInN3aXRjaCI6IGt3KCJzd2l0Y2giKSwgImNhc2UiOiBrdygiY2FzZSIpLCAiZGVmYXVsdCI6IGt3KCJkZWZhdWx0IiksDQogICAgICAiaW4iOiBvcGVyYXRvciwgInR5cGVvZiI6IG9wZXJhdG9yLCAiaW5zdGFuY2VvZiI6IG9wZXJhdG9yLA0KICAgICAgInRydWUiOiBhdG9tLCAiZmFsc2UiOiBhdG9tLCAibnVsbCI6IGF0b20sICJ1bmRlZmluZWQiOiBhdG9tLCAiTmFOIjogYXRvbSwgIkluZmluaXR5IjogYXRvbQ0KICAgIH07DQogIH0oKTsNCg0KICB2YXIgaXNPcGVyYXRvckNoYXIgPSAvWytcLSomJT08PiE/fF0vOw0KDQogIGZ1bmN0aW9uIGNoYWluKHN0cmVhbSwgc3RhdGUsIGYpIHsNCiAgICBzdGF0ZS50b2tlbml6ZSA9IGY7DQogICAgcmV0dXJuIGYoc3RyZWFtLCBzdGF0ZSk7DQogIH0NCg0KICBmdW5jdGlvbiBuZXh0VW50aWxVbmVzY2FwZWQoc3RyZWFtLCBlbmQpIHsNCiAgICB2YXIgZXNjYXBlZCA9IGZhbHNlLCBuZXh0Ow0KICAgIHdoaWxlICgobmV4dCA9IHN0cmVhbS5uZXh0KCkpICE9IG51bGwpIHsNCiAgICAgIGlmIChuZXh0ID09IGVuZCAmJiAhZXNjYXBlZCkNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgICAgZXNjYXBlZCA9ICFlc2NhcGVkICYmIG5leHQgPT0gIlxcIjsNCiAgICB9DQogICAgcmV0dXJuIGVzY2FwZWQ7DQogIH0NCg0KICAvLyBVc2VkIGFzIHNjcmF0Y2ggdmFyaWFibGVzIHRvIGNvbW11bmljYXRlIG11bHRpcGxlIHZhbHVlcyB3aXRob3V0DQogIC8vIGNvbnNpbmcgdXAgdG9ucyBvZiBvYmplY3RzLg0KICB2YXIgdHlwZSwgY29udGVudDsNCiAgZnVuY3Rpb24gcmV0KHRwLCBzdHlsZSwgY29udCkgew0KICAgIHR5cGUgPSB0cDsgY29udGVudCA9IGNvbnQ7DQogICAgcmV0dXJuIHN0eWxlOw0KICB9DQoNCiAgZnVuY3Rpb24ganNUb2tlbkJhc2Uoc3RyZWFtLCBzdGF0ZSkgew0KICAgIHZhciBjaCA9IHN0cmVhbS5uZXh0KCk7DQogICAgaWYgKGNoID09ICciJyB8fCBjaCA9PSAiJyIpDQogICAgICByZXR1cm4gY2hhaW4oc3RyZWFtLCBzdGF0ZSwganNUb2tlblN0cmluZyhjaCkpOw0KICAgIGVsc2UgaWYgKC9bXFtcXXt9XChcKSw7XDpcLl0vLnRlc3QoY2gpKQ0KICAgICAgcmV0dXJuIHJldChjaCk7DQogICAgZWxzZSBpZiAoY2ggPT0gIjAiICYmIHN0cmVhbS5lYXQoL3gvaSkpIHsNCiAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW1xkYS1mXS9pKTsNCiAgICAgIHJldHVybiByZXQoIm51bWJlciIsICJudW1iZXIiKTsNCiAgICB9ICAgICAgDQogICAgZWxzZSBpZiAoL1xkLy50ZXN0KGNoKSkgew0KICAgICAgc3RyZWFtLm1hdGNoKC9eXGQqKD86XC5cZCopPyg/OltlRV1bK1wtXT9cZCspPy8pOw0KICAgICAgcmV0dXJuIHJldCgibnVtYmVyIiwgIm51bWJlciIpOw0KICAgIH0NCiAgICBlbHNlIGlmIChjaCA9PSAiLyIpIHsNCiAgICAgIGlmIChzdHJlYW0uZWF0KCIqIikpIHsNCiAgICAgICAgcmV0dXJuIGNoYWluKHN0cmVhbSwgc3RhdGUsIGpzVG9rZW5Db21tZW50KTsNCiAgICAgIH0NCiAgICAgIGVsc2UgaWYgKHN0cmVhbS5lYXQoIi8iKSkgew0KICAgICAgICBzdHJlYW0uc2tpcFRvRW5kKCk7DQogICAgICAgIHJldHVybiByZXQoImNvbW1lbnQiLCAiY29tbWVudCIpOw0KICAgICAgfQ0KICAgICAgZWxzZSBpZiAoc3RhdGUucmVBbGxvd2VkKSB7DQogICAgICAgIG5leHRVbnRpbFVuZXNjYXBlZChzdHJlYW0sICIvIik7DQogICAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW2dpbXldLyk7IC8vICd5JyBpcyAic3RpY2t5IiBvcHRpb24gaW4gTW96aWxsYQ0KICAgICAgICByZXR1cm4gcmV0KCJyZWdleHAiLCAic3RyaW5nLTIiKTsNCiAgICAgIH0NCiAgICAgIGVsc2Ugew0KICAgICAgICBzdHJlYW0uZWF0V2hpbGUoaXNPcGVyYXRvckNoYXIpOw0KICAgICAgICByZXR1cm4gcmV0KCJvcGVyYXRvciIsIG51bGwsIHN0cmVhbS5jdXJyZW50KCkpOw0KICAgICAgfQ0KICAgIH0NCiAgICBlbHNlIGlmIChjaCA9PSAiIyIpIHsNCiAgICAgICAgc3RyZWFtLnNraXBUb0VuZCgpOw0KICAgICAgICByZXR1cm4gcmV0KCJlcnJvciIsICJlcnJvciIpOw0KICAgIH0NCiAgICBlbHNlIGlmIChpc09wZXJhdG9yQ2hhci50ZXN0KGNoKSkgew0KICAgICAgc3RyZWFtLmVhdFdoaWxlKGlzT3BlcmF0b3JDaGFyKTsNCiAgICAgIHJldHVybiByZXQoIm9wZXJhdG9yIiwgbnVsbCwgc3RyZWFtLmN1cnJlbnQoKSk7DQogICAgfQ0KICAgIGVsc2Ugew0KICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXHdcJF9dLyk7DQogICAgICB2YXIgd29yZCA9IHN0cmVhbS5jdXJyZW50KCksIGtub3duID0ga2V5d29yZHMucHJvcGVydHlJc0VudW1lcmFibGUod29yZCkgJiYga2V5d29yZHNbd29yZF07DQogICAgICByZXR1cm4gKGtub3duICYmIHN0YXRlLmt3QWxsb3dlZCkgPyByZXQoa25vd24udHlwZSwga25vd24uc3R5bGUsIHdvcmQpIDoNCiAgICAgICAgICAgICAgICAgICAgIHJldCgidmFyaWFibGUiLCAidmFyaWFibGUiLCB3b3JkKTsNCiAgICB9DQogIH0NCg0KICBmdW5jdGlvbiBqc1Rva2VuU3RyaW5nKHF1b3RlKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHsNCiAgICAgIGlmICghbmV4dFVudGlsVW5lc2NhcGVkKHN0cmVhbSwgcXVvdGUpKQ0KICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IGpzVG9rZW5CYXNlOw0KICAgICAgcmV0dXJuIHJldCgic3RyaW5nIiwgInN0cmluZyIpOw0KICAgIH07DQogIH0NCg0KICBmdW5jdGlvbiBqc1Rva2VuQ29tbWVudChzdHJlYW0sIHN0YXRlKSB7DQogICAgdmFyIG1heWJlRW5kID0gZmFsc2UsIGNoOw0KICAgIHdoaWxlIChjaCA9IHN0cmVhbS5uZXh0KCkpIHsNCiAgICAgIGlmIChjaCA9PSAiLyIgJiYgbWF5YmVFbmQpIHsNCiAgICAgICAgc3RhdGUudG9rZW5pemUgPSBqc1Rva2VuQmFzZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICBtYXliZUVuZCA9IChjaCA9PSAiKiIpOw0KICAgIH0NCiAgICByZXR1cm4gcmV0KCJjb21tZW50IiwgImNvbW1lbnQiKTsNCiAgfQ0KDQogIC8vIFBhcnNlcg0KDQogIHZhciBhdG9taWNUeXBlcyA9IHsiYXRvbSI6IHRydWUsICJudW1iZXIiOiB0cnVlLCAidmFyaWFibGUiOiB0cnVlLCAic3RyaW5nIjogdHJ1ZSwgInJlZ2V4cCI6IHRydWV9Ow0KDQogIGZ1bmN0aW9uIEpTTGV4aWNhbChpbmRlbnRlZCwgY29sdW1uLCB0eXBlLCBhbGlnbiwgcHJldiwgaW5mbykgew0KICAgIHRoaXMuaW5kZW50ZWQgPSBpbmRlbnRlZDsNCiAgICB0aGlzLmNvbHVtbiA9IGNvbHVtbjsNCiAgICB0aGlzLnR5cGUgPSB0eXBlOw0KICAgIHRoaXMucHJldiA9IHByZXY7DQogICAgdGhpcy5pbmZvID0gaW5mbzsNCiAgICBpZiAoYWxpZ24gIT0gbnVsbCkgdGhpcy5hbGlnbiA9IGFsaWduOw0KICB9DQoNCiAgZnVuY3Rpb24gaW5TY29wZShzdGF0ZSwgdmFybmFtZSkgew0KICAgIGZvciAodmFyIHYgPSBzdGF0ZS5sb2NhbFZhcnM7IHY7IHYgPSB2Lm5leHQpDQogICAgICBpZiAodi5uYW1lID09IHZhcm5hbWUpIHJldHVybiB0cnVlOw0KICB9DQoNCiAgZnVuY3Rpb24gcGFyc2VKUyhzdGF0ZSwgc3R5bGUsIHR5cGUsIGNvbnRlbnQsIHN0cmVhbSkgew0KICAgIHZhciBjYyA9IHN0YXRlLmNjOw0KICAgIC8vIENvbW11bmljYXRlIG91ciBjb250ZXh0IHRvIHRoZSBjb21iaW5hdG9ycy4NCiAgICAvLyAoTGVzcyB3YXN0ZWZ1bCB0aGFuIGNvbnNpbmcgdXAgYSBodW5kcmVkIGNsb3N1cmVzIG9uIGV2ZXJ5IGNhbGwuKQ0KICAgIGN4LnN0YXRlID0gc3RhdGU7IGN4LnN0cmVhbSA9IHN0cmVhbTsgY3gubWFya2VkID0gbnVsbCwgY3guY2MgPSBjYzsNCiAgDQogICAgaWYgKCFzdGF0ZS5sZXhpY2FsLmhhc093blByb3BlcnR5KCJhbGlnbiIpKQ0KICAgICAgc3RhdGUubGV4aWNhbC5hbGlnbiA9IHRydWU7DQoNCiAgICB3aGlsZSh0cnVlKSB7DQogICAgICB2YXIgY29tYmluYXRvciA9IGNjLmxlbmd0aCA/IGNjLnBvcCgpIDoganNvbk1vZGUgPyBleHByZXNzaW9uIDogc3RhdGVtZW50Ow0KICAgICAgaWYgKGNvbWJpbmF0b3IodHlwZSwgY29udGVudCkpIHsNCiAgICAgICAgd2hpbGUoY2MubGVuZ3RoICYmIGNjW2NjLmxlbmd0aCAtIDFdLmxleCkNCiAgICAgICAgICBjYy5wb3AoKSgpOw0KICAgICAgICBpZiAoY3gubWFya2VkKSByZXR1cm4gY3gubWFya2VkOw0KICAgICAgICBpZiAodHlwZSA9PSAidmFyaWFibGUiICYmIGluU2NvcGUoc3RhdGUsIGNvbnRlbnQpKSByZXR1cm4gInZhcmlhYmxlLTIiOw0KICAgICAgICByZXR1cm4gc3R5bGU7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgLy8gQ29tYmluYXRvciB1dGlscw0KDQogIHZhciBjeCA9IHtzdGF0ZTogbnVsbCwgY29sdW1uOiBudWxsLCBtYXJrZWQ6IG51bGwsIGNjOiBudWxsfTsNCiAgZnVuY3Rpb24gcGFzcygpIHsNCiAgICBmb3IgKHZhciBpID0gYXJndW1lbnRzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBjeC5jYy5wdXNoKGFyZ3VtZW50c1tpXSk7DQogIH0NCiAgZnVuY3Rpb24gY29udCgpIHsNCiAgICBwYXNzLmFwcGx5KG51bGwsIGFyZ3VtZW50cyk7DQogICAgcmV0dXJuIHRydWU7DQogIH0NCiAgZnVuY3Rpb24gcmVnaXN0ZXIodmFybmFtZSkgew0KICAgIHZhciBzdGF0ZSA9IGN4LnN0YXRlOw0KICAgIGlmIChzdGF0ZS5jb250ZXh0KSB7DQogICAgICBjeC5tYXJrZWQgPSAiZGVmIjsNCiAgICAgIGZvciAodmFyIHYgPSBzdGF0ZS5sb2NhbFZhcnM7IHY7IHYgPSB2Lm5leHQpDQogICAgICAgIGlmICh2Lm5hbWUgPT0gdmFybmFtZSkgcmV0dXJuOw0KICAgICAgc3RhdGUubG9jYWxWYXJzID0ge25hbWU6IHZhcm5hbWUsIG5leHQ6IHN0YXRlLmxvY2FsVmFyc307DQogICAgfQ0KICB9DQoNCiAgLy8gQ29tYmluYXRvcnMNCg0KICB2YXIgZGVmYXVsdFZhcnMgPSB7bmFtZTogInRoaXMiLCBuZXh0OiB7bmFtZTogImFyZ3VtZW50cyJ9fTsNCiAgZnVuY3Rpb24gcHVzaGNvbnRleHQoKSB7DQogICAgaWYgKCFjeC5zdGF0ZS5jb250ZXh0KSBjeC5zdGF0ZS5sb2NhbFZhcnMgPSBkZWZhdWx0VmFyczsNCiAgICBjeC5zdGF0ZS5jb250ZXh0ID0ge3ByZXY6IGN4LnN0YXRlLmNvbnRleHQsIHZhcnM6IGN4LnN0YXRlLmxvY2FsVmFyc307DQogIH0NCiAgZnVuY3Rpb24gcG9wY29udGV4dCgpIHsNCiAgICBjeC5zdGF0ZS5sb2NhbFZhcnMgPSBjeC5zdGF0ZS5jb250ZXh0LnZhcnM7DQogICAgY3guc3RhdGUuY29udGV4dCA9IGN4LnN0YXRlLmNvbnRleHQucHJldjsNCiAgfQ0KICBmdW5jdGlvbiBwdXNobGV4KHR5cGUsIGluZm8pIHsNCiAgICB2YXIgcmVzdWx0ID0gZnVuY3Rpb24oKSB7DQogICAgICB2YXIgc3RhdGUgPSBjeC5zdGF0ZTsNCiAgICAgIHN0YXRlLmxleGljYWwgPSBuZXcgSlNMZXhpY2FsKHN0YXRlLmluZGVudGVkLCBjeC5zdHJlYW0uY29sdW1uKCksIHR5cGUsIG51bGwsIHN0YXRlLmxleGljYWwsIGluZm8pDQogICAgfTsNCiAgICByZXN1bHQubGV4ID0gdHJ1ZTsNCiAgICByZXR1cm4gcmVzdWx0Ow0KICB9DQogIGZ1bmN0aW9uIHBvcGxleCgpIHsNCiAgICB2YXIgc3RhdGUgPSBjeC5zdGF0ZTsNCiAgICBpZiAoc3RhdGUubGV4aWNhbC5wcmV2KSB7DQogICAgICBpZiAoc3RhdGUubGV4aWNhbC50eXBlID09ICIpIikNCiAgICAgICAgc3RhdGUuaW5kZW50ZWQgPSBzdGF0ZS5sZXhpY2FsLmluZGVudGVkOw0KICAgICAgc3RhdGUubGV4aWNhbCA9IHN0YXRlLmxleGljYWwucHJldjsNCiAgICB9DQogIH0NCiAgcG9wbGV4LmxleCA9IHRydWU7DQoNCiAgZnVuY3Rpb24gZXhwZWN0KHdhbnRlZCkgew0KICAgIHJldHVybiBmdW5jdGlvbiBleHBlY3RpbmcodHlwZSkgew0KICAgICAgaWYgKHR5cGUgPT0gd2FudGVkKSByZXR1cm4gY29udCgpOw0KICAgICAgZWxzZSBpZiAod2FudGVkID09ICI7IikgcmV0dXJuIHBhc3MoKTsNCiAgICAgIGVsc2UgcmV0dXJuIGNvbnQoYXJndW1lbnRzLmNhbGxlZSk7DQogICAgfTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHN0YXRlbWVudCh0eXBlKSB7DQogICAgaWYgKHR5cGUgPT0gInZhciIpIHJldHVybiBjb250KHB1c2hsZXgoInZhcmRlZiIpLCB2YXJkZWYxLCBleHBlY3QoIjsiKSwgcG9wbGV4KTsNCiAgICBpZiAodHlwZSA9PSAia2V5d29yZCBhIikgcmV0dXJuIGNvbnQocHVzaGxleCgiZm9ybSIpLCBleHByZXNzaW9uLCBzdGF0ZW1lbnQsIHBvcGxleCk7DQogICAgaWYgKHR5cGUgPT0gImtleXdvcmQgYiIpIHJldHVybiBjb250KHB1c2hsZXgoImZvcm0iKSwgc3RhdGVtZW50LCBwb3BsZXgpOw0KICAgIGlmICh0eXBlID09ICJ7IikgcmV0dXJuIGNvbnQocHVzaGxleCgifSIpLCBibG9jaywgcG9wbGV4KTsNCiAgICBpZiAodHlwZSA9PSAiOyIpIHJldHVybiBjb250KCk7DQogICAgaWYgKHR5cGUgPT0gImZ1bmN0aW9uIikgcmV0dXJuIGNvbnQoZnVuY3Rpb25kZWYpOw0KICAgIGlmICh0eXBlID09ICJmb3IiKSByZXR1cm4gY29udChwdXNobGV4KCJmb3JtIiksIGV4cGVjdCgiKCIpLCBwdXNobGV4KCIpIiksIGZvcnNwZWMxLCBleHBlY3QoIikiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9wbGV4LCBzdGF0ZW1lbnQsIHBvcGxleCk7DQogICAgaWYgKHR5cGUgPT0gInZhcmlhYmxlIikgcmV0dXJuIGNvbnQocHVzaGxleCgic3RhdCIpLCBtYXliZWxhYmVsKTsNCiAgICBpZiAodHlwZSA9PSAic3dpdGNoIikgcmV0dXJuIGNvbnQocHVzaGxleCgiZm9ybSIpLCBleHByZXNzaW9uLCBwdXNobGV4KCJ9IiwgInN3aXRjaCIpLCBleHBlY3QoInsiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYmxvY2ssIHBvcGxleCwgcG9wbGV4KTsNCiAgICBpZiAodHlwZSA9PSAiY2FzZSIpIHJldHVybiBjb250KGV4cHJlc3Npb24sIGV4cGVjdCgiOiIpKTsNCiAgICBpZiAodHlwZSA9PSAiZGVmYXVsdCIpIHJldHVybiBjb250KGV4cGVjdCgiOiIpKTsNCiAgICBpZiAodHlwZSA9PSAiY2F0Y2giKSByZXR1cm4gY29udChwdXNobGV4KCJmb3JtIiksIHB1c2hjb250ZXh0LCBleHBlY3QoIigiKSwgZnVuYXJnLCBleHBlY3QoIikiKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZW1lbnQsIHBvcGxleCwgcG9wY29udGV4dCk7DQogICAgcmV0dXJuIHBhc3MocHVzaGxleCgic3RhdCIpLCBleHByZXNzaW9uLCBleHBlY3QoIjsiKSwgcG9wbGV4KTsNCiAgfQ0KICBmdW5jdGlvbiBleHByZXNzaW9uKHR5cGUpIHsNCiAgICBpZiAoYXRvbWljVHlwZXMuaGFzT3duUHJvcGVydHkodHlwZSkpIHJldHVybiBjb250KG1heWJlb3BlcmF0b3IpOw0KICAgIGlmICh0eXBlID09ICJmdW5jdGlvbiIpIHJldHVybiBjb250KGZ1bmN0aW9uZGVmKTsNCiAgICBpZiAodHlwZSA9PSAia2V5d29yZCBjIikgcmV0dXJuIGNvbnQobWF5YmVleHByZXNzaW9uKTsNCiAgICBpZiAodHlwZSA9PSAiKCIpIHJldHVybiBjb250KHB1c2hsZXgoIikiKSwgbWF5YmVleHByZXNzaW9uLCBleHBlY3QoIikiKSwgcG9wbGV4LCBtYXliZW9wZXJhdG9yKTsNCiAgICBpZiAodHlwZSA9PSAib3BlcmF0b3IiKSByZXR1cm4gY29udChleHByZXNzaW9uKTsNCiAgICBpZiAodHlwZSA9PSAiWyIpIHJldHVybiBjb250KHB1c2hsZXgoIl0iKSwgY29tbWFzZXAoZXhwcmVzc2lvbiwgIl0iKSwgcG9wbGV4LCBtYXliZW9wZXJhdG9yKTsNCiAgICBpZiAodHlwZSA9PSAieyIpIHJldHVybiBjb250KHB1c2hsZXgoIn0iKSwgY29tbWFzZXAob2JqcHJvcCwgIn0iKSwgcG9wbGV4LCBtYXliZW9wZXJhdG9yKTsNCiAgICByZXR1cm4gY29udCgpOw0KICB9DQogIGZ1bmN0aW9uIG1heWJlZXhwcmVzc2lvbih0eXBlKSB7DQogICAgaWYgKHR5cGUubWF0Y2goL1s7XH1cKVxdLF0vKSkgcmV0dXJuIHBhc3MoKTsNCiAgICByZXR1cm4gcGFzcyhleHByZXNzaW9uKTsNCiAgfQ0KICAgIA0KICBmdW5jdGlvbiBtYXliZW9wZXJhdG9yKHR5cGUsIHZhbHVlKSB7DQogICAgaWYgKHR5cGUgPT0gIm9wZXJhdG9yIiAmJiAvXCtcK3wtLS8udGVzdCh2YWx1ZSkpIHJldHVybiBjb250KG1heWJlb3BlcmF0b3IpOw0KICAgIGlmICh0eXBlID09ICJvcGVyYXRvciIpIHJldHVybiBjb250KGV4cHJlc3Npb24pOw0KICAgIGlmICh0eXBlID09ICI7IikgcmV0dXJuOw0KICAgIGlmICh0eXBlID09ICIoIikgcmV0dXJuIGNvbnQocHVzaGxleCgiKSIpLCBjb21tYXNlcChleHByZXNzaW9uLCAiKSIpLCBwb3BsZXgsIG1heWJlb3BlcmF0b3IpOw0KICAgIGlmICh0eXBlID09ICIuIikgcmV0dXJuIGNvbnQocHJvcGVydHksIG1heWJlb3BlcmF0b3IpOw0KICAgIGlmICh0eXBlID09ICJbIikgcmV0dXJuIGNvbnQocHVzaGxleCgiXSIpLCBleHByZXNzaW9uLCBleHBlY3QoIl0iKSwgcG9wbGV4LCBtYXliZW9wZXJhdG9yKTsNCiAgfQ0KICBmdW5jdGlvbiBtYXliZWxhYmVsKHR5cGUpIHsNCiAgICBpZiAodHlwZSA9PSAiOiIpIHJldHVybiBjb250KHBvcGxleCwgc3RhdGVtZW50KTsNCiAgICByZXR1cm4gcGFzcyhtYXliZW9wZXJhdG9yLCBleHBlY3QoIjsiKSwgcG9wbGV4KTsNCiAgfQ0KICBmdW5jdGlvbiBwcm9wZXJ0eSh0eXBlKSB7DQogICAgaWYgKHR5cGUgPT0gInZhcmlhYmxlIikge2N4Lm1hcmtlZCA9ICJwcm9wZXJ0eSI7IHJldHVybiBjb250KCk7fQ0KICB9DQogIGZ1bmN0aW9uIG9ianByb3AodHlwZSkgew0KICAgIGlmICh0eXBlID09ICJ2YXJpYWJsZSIpIGN4Lm1hcmtlZCA9ICJwcm9wZXJ0eSI7DQogICAgaWYgKGF0b21pY1R5cGVzLmhhc093blByb3BlcnR5KHR5cGUpKSByZXR1cm4gY29udChleHBlY3QoIjoiKSwgZXhwcmVzc2lvbik7DQogIH0NCiAgZnVuY3Rpb24gY29tbWFzZXAod2hhdCwgZW5kKSB7DQogICAgZnVuY3Rpb24gcHJvY2VlZCh0eXBlKSB7DQogICAgICBpZiAodHlwZSA9PSAiLCIpIHJldHVybiBjb250KHdoYXQsIHByb2NlZWQpOw0KICAgICAgaWYgKHR5cGUgPT0gZW5kKSByZXR1cm4gY29udCgpOw0KICAgICAgcmV0dXJuIGNvbnQoZXhwZWN0KGVuZCkpOw0KICAgIH0NCiAgICByZXR1cm4gZnVuY3Rpb24gY29tbWFTZXBhcmF0ZWQodHlwZSkgew0KICAgICAgaWYgKHR5cGUgPT0gZW5kKSByZXR1cm4gY29udCgpOw0KICAgICAgZWxzZSByZXR1cm4gcGFzcyh3aGF0LCBwcm9jZWVkKTsNCiAgICB9Ow0KICB9DQogIGZ1bmN0aW9uIGJsb2NrKHR5cGUpIHsNCiAgICBpZiAodHlwZSA9PSAifSIpIHJldHVybiBjb250KCk7DQogICAgcmV0dXJuIHBhc3Moc3RhdGVtZW50LCBibG9jayk7DQogIH0NCiAgZnVuY3Rpb24gdmFyZGVmMSh0eXBlLCB2YWx1ZSkgew0KICAgIGlmICh0eXBlID09ICJ2YXJpYWJsZSIpe3JlZ2lzdGVyKHZhbHVlKTsgcmV0dXJuIGNvbnQodmFyZGVmMik7fQ0KICAgIHJldHVybiBjb250KCk7DQogIH0NCiAgZnVuY3Rpb24gdmFyZGVmMih0eXBlLCB2YWx1ZSkgew0KICAgIGlmICh2YWx1ZSA9PSAiPSIpIHJldHVybiBjb250KGV4cHJlc3Npb24sIHZhcmRlZjIpOw0KICAgIGlmICh0eXBlID09ICIsIikgcmV0dXJuIGNvbnQodmFyZGVmMSk7DQogIH0NCiAgZnVuY3Rpb24gZm9yc3BlYzEodHlwZSkgew0KICAgIGlmICh0eXBlID09ICJ2YXIiKSByZXR1cm4gY29udCh2YXJkZWYxLCBmb3JzcGVjMik7DQogICAgaWYgKHR5cGUgPT0gIjsiKSByZXR1cm4gcGFzcyhmb3JzcGVjMik7DQogICAgaWYgKHR5cGUgPT0gInZhcmlhYmxlIikgcmV0dXJuIGNvbnQoZm9ybWF5YmVpbik7DQogICAgcmV0dXJuIHBhc3MoZm9yc3BlYzIpOw0KICB9DQogIGZ1bmN0aW9uIGZvcm1heWJlaW4odHlwZSwgdmFsdWUpIHsNCiAgICBpZiAodmFsdWUgPT0gImluIikgcmV0dXJuIGNvbnQoZXhwcmVzc2lvbik7DQogICAgcmV0dXJuIGNvbnQobWF5YmVvcGVyYXRvciwgZm9yc3BlYzIpOw0KICB9DQogIGZ1bmN0aW9uIGZvcnNwZWMyKHR5cGUsIHZhbHVlKSB7DQogICAgaWYgKHR5cGUgPT0gIjsiKSByZXR1cm4gY29udChmb3JzcGVjMyk7DQogICAgaWYgKHZhbHVlID09ICJpbiIpIHJldHVybiBjb250KGV4cHJlc3Npb24pOw0KICAgIHJldHVybiBjb250KGV4cHJlc3Npb24sIGV4cGVjdCgiOyIpLCBmb3JzcGVjMyk7DQogIH0NCiAgZnVuY3Rpb24gZm9yc3BlYzModHlwZSkgew0KICAgIGlmICh0eXBlICE9ICIpIikgY29udChleHByZXNzaW9uKTsNCiAgfQ0KICBmdW5jdGlvbiBmdW5jdGlvbmRlZih0eXBlLCB2YWx1ZSkgew0KICAgIGlmICh0eXBlID09ICJ2YXJpYWJsZSIpIHtyZWdpc3Rlcih2YWx1ZSk7IHJldHVybiBjb250KGZ1bmN0aW9uZGVmKTt9DQogICAgaWYgKHR5cGUgPT0gIigiKSByZXR1cm4gY29udChwdXNobGV4KCIpIiksIHB1c2hjb250ZXh0LCBjb21tYXNlcChmdW5hcmcsICIpIiksIHBvcGxleCwgc3RhdGVtZW50LCBwb3Bjb250ZXh0KTsNCiAgfQ0KICBmdW5jdGlvbiBmdW5hcmcodHlwZSwgdmFsdWUpIHsNCiAgICBpZiAodHlwZSA9PSAidmFyaWFibGUiKSB7cmVnaXN0ZXIodmFsdWUpOyByZXR1cm4gY29udCgpO30NCiAgfQ0KDQogIC8vIEludGVyZmFjZQ0KDQogIHJldHVybiB7DQogICAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oYmFzZWNvbHVtbikgew0KICAgICAgcmV0dXJuIHsNCiAgICAgICAgdG9rZW5pemU6IGpzVG9rZW5CYXNlLA0KICAgICAgICByZUFsbG93ZWQ6IHRydWUsDQogICAgICAgIGt3QWxsb3dlZDogdHJ1ZSwNCiAgICAgICAgY2M6IFtdLA0KICAgICAgICBsZXhpY2FsOiBuZXcgSlNMZXhpY2FsKChiYXNlY29sdW1uIHx8IDApIC0gaW5kZW50VW5pdCwgMCwgImJsb2NrIiwgZmFsc2UpLA0KICAgICAgICBsb2NhbFZhcnM6IG51bGwsDQogICAgICAgIGNvbnRleHQ6IG51bGwsDQogICAgICAgIGluZGVudGVkOiAwDQogICAgICB9Ow0KICAgIH0sDQoNCiAgICB0b2tlbjogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkgew0KICAgICAgaWYgKHN0cmVhbS5zb2woKSkgew0KICAgICAgICBpZiAoIXN0YXRlLmxleGljYWwuaGFzT3duUHJvcGVydHkoImFsaWduIikpDQogICAgICAgICAgc3RhdGUubGV4aWNhbC5hbGlnbiA9IGZhbHNlOw0KICAgICAgICBzdGF0ZS5pbmRlbnRlZCA9IHN0cmVhbS5pbmRlbnRhdGlvbigpOw0KICAgICAgfQ0KICAgICAgaWYgKHN0cmVhbS5lYXRTcGFjZSgpKSByZXR1cm4gbnVsbDsNCiAgICAgIHZhciBzdHlsZSA9IHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpOw0KICAgICAgaWYgKHR5cGUgPT0gImNvbW1lbnQiKSByZXR1cm4gc3R5bGU7DQogICAgICBzdGF0ZS5yZUFsbG93ZWQgPSB0eXBlID09ICJvcGVyYXRvciIgfHwgdHlwZSA9PSAia2V5d29yZCBjIiB8fCB0eXBlLm1hdGNoKC9eW1xbe31cKCw7Ol0kLyk7DQogICAgICBzdGF0ZS5rd0FsbG93ZWQgPSB0eXBlICE9ICcuJzsNCiAgICAgIHJldHVybiBwYXJzZUpTKHN0YXRlLCBzdHlsZSwgdHlwZSwgY29udGVudCwgc3RyZWFtKTsNCiAgICB9LA0KDQogICAgaW5kZW50OiBmdW5jdGlvbihzdGF0ZSwgdGV4dEFmdGVyKSB7DQogICAgICBpZiAoc3RhdGUudG9rZW5pemUgIT0ganNUb2tlbkJhc2UpIHJldHVybiAwOw0KICAgICAgdmFyIGZpcnN0Q2hhciA9IHRleHRBZnRlciAmJiB0ZXh0QWZ0ZXIuY2hhckF0KDApLCBsZXhpY2FsID0gc3RhdGUubGV4aWNhbCwNCiAgICAgICAgICB0eXBlID0gbGV4aWNhbC50eXBlLCBjbG9zaW5nID0gZmlyc3RDaGFyID09IHR5cGU7DQogICAgICBpZiAodHlwZSA9PSAidmFyZGVmIikgcmV0dXJuIGxleGljYWwuaW5kZW50ZWQgKyA0Ow0KICAgICAgZWxzZSBpZiAodHlwZSA9PSAiZm9ybSIgJiYgZmlyc3RDaGFyID09ICJ7IikgcmV0dXJuIGxleGljYWwuaW5kZW50ZWQ7DQogICAgICBlbHNlIGlmICh0eXBlID09ICJzdGF0IiB8fCB0eXBlID09ICJmb3JtIikgcmV0dXJuIGxleGljYWwuaW5kZW50ZWQgKyBpbmRlbnRVbml0Ow0KICAgICAgZWxzZSBpZiAobGV4aWNhbC5pbmZvID09ICJzd2l0Y2giICYmICFjbG9zaW5nKQ0KICAgICAgICByZXR1cm4gbGV4aWNhbC5pbmRlbnRlZCArICgvXig/OmNhc2V8ZGVmYXVsdClcYi8udGVzdCh0ZXh0QWZ0ZXIpID8gaW5kZW50VW5pdCA6IDIgKiBpbmRlbnRVbml0KTsNCiAgICAgIGVsc2UgaWYgKGxleGljYWwuYWxpZ24pIHJldHVybiBsZXhpY2FsLmNvbHVtbiArIChjbG9zaW5nID8gMCA6IDEpOw0KICAgICAgZWxzZSByZXR1cm4gbGV4aWNhbC5pbmRlbnRlZCArIChjbG9zaW5nID8gMCA6IGluZGVudFVuaXQpOw0KICAgIH0sDQoNCiAgICBlbGVjdHJpY0NoYXJzOiAiOnt9Ig0KICB9Ow0KfSk7DQoNCkNvZGVNaXJyb3IuZGVmaW5lTUlNRSgidGV4dC9qYXZhc2NyaXB0IiwgImphdmFzY3JpcHQiKTsNCkNvZGVNaXJyb3IuZGVmaW5lTUlNRSgiYXBwbGljYXRpb24vanNvbiIsIHtuYW1lOiAiamF2YXNjcmlwdCIsIGpzb246IHRydWV9KTsNCg0KQ29kZU1pcnJvci5kZWZpbmVNb2RlKCJodG1sIiwgZnVuY3Rpb24oY29uZmlnLCBwYXJzZXJDb25maWcpIHsNCiAgdmFyIGh0bWxNb2RlID0gQ29kZU1pcnJvci5nZXRNb2RlKGNvbmZpZywge25hbWU6ICJ4bWwiLCBodG1sTW9kZTogdHJ1ZX0pOw0KICB2YXIganNNb2RlID0gQ29kZU1pcnJvci5nZXRNb2RlKGNvbmZpZywgImphdmFzY3JpcHQiKTsNCiAgdmFyIGNzc01vZGUgPSBDb2RlTWlycm9yLmdldE1vZGUoY29uZmlnLCAiY3NzIik7DQoNCiAgZnVuY3Rpb24gaHRtbChzdHJlYW0sIHN0YXRlKSB7DQogICAgdmFyIHN0eWxlID0gaHRtbE1vZGUudG9rZW4oc3RyZWFtLCBzdGF0ZS5odG1sU3RhdGUpOw0KICAgIGlmIChzdHlsZSA9PSAidGFnIiAmJiBzdHJlYW0uY3VycmVudCgpID09ICI+IiAmJiBzdGF0ZS5odG1sU3RhdGUuY29udGV4dCkgew0KICAgICAgaWYgKC9ec2NyaXB0JC9pLnRlc3Qoc3RhdGUuaHRtbFN0YXRlLmNvbnRleHQudGFnTmFtZSkpIHsNCiAgICAgICAgc3RhdGUudG9rZW4gPSBqYXZhc2NyaXB0Ow0KICAgICAgICBzdGF0ZS5sb2NhbFN0YXRlID0ganNNb2RlLnN0YXJ0U3RhdGUoaHRtbE1vZGUuaW5kZW50KHN0YXRlLmh0bWxTdGF0ZSwgIiIpKTsNCiAgICAgICAgc3RhdGUubW9kZSA9ICJqYXZhc2NyaXB0IjsNCiAgICAgIH0NCiAgICAgIGVsc2UgaWYgKC9ec3R5bGUkL2kudGVzdChzdGF0ZS5odG1sU3RhdGUuY29udGV4dC50YWdOYW1lKSkgew0KICAgICAgICBzdGF0ZS50b2tlbiA9IGNzczsNCiAgICAgICAgc3RhdGUubG9jYWxTdGF0ZSA9IGNzc01vZGUuc3RhcnRTdGF0ZShodG1sTW9kZS5pbmRlbnQoc3RhdGUuaHRtbFN0YXRlLCAiIikpOw0KICAgICAgICBzdGF0ZS5tb2RlID0gImNzcyI7DQogICAgICB9DQogICAgfQ0KICAgIHJldHVybiBzdHlsZTsNCiAgfQ0KICBmdW5jdGlvbiBtYXliZUJhY2t1cChzdHJlYW0sIHBhdCwgc3R5bGUpIHsNCiAgICB2YXIgY3VyID0gc3RyZWFtLmN1cnJlbnQoKTsNCiAgICB2YXIgY2xvc2UgPSBjdXIuc2VhcmNoKHBhdCk7DQogICAgaWYgKGNsb3NlID4gLTEpIHN0cmVhbS5iYWNrVXAoY3VyLmxlbmd0aCAtIGNsb3NlKTsNCiAgICByZXR1cm4gc3R5bGU7DQogIH0NCiAgZnVuY3Rpb24gamF2YXNjcmlwdChzdHJlYW0sIHN0YXRlKSB7DQogICAgaWYgKHN0cmVhbS5tYXRjaCgvXjxcL1xzKnNjcmlwdFxzKj4vaSwgZmFsc2UpKSB7DQogICAgICBzdGF0ZS50b2tlbiA9IGh0bWw7DQogICAgICBzdGF0ZS5jdXJTdGF0ZSA9IG51bGw7DQogICAgICBzdGF0ZS5tb2RlID0gImh0bWwiOw0KICAgICAgcmV0dXJuIGh0bWwoc3RyZWFtLCBzdGF0ZSk7DQogICAgfQ0KICAgIHJldHVybiBtYXliZUJhY2t1cChzdHJlYW0sIC88XC9ccypzY3JpcHRccyo+LywNCiAgICAgICAgICAgICAgICAgICAgICAganNNb2RlLnRva2VuKHN0cmVhbSwgc3RhdGUubG9jYWxTdGF0ZSkpOw0KICB9DQogIGZ1bmN0aW9uIGNzcyhzdHJlYW0sIHN0YXRlKSB7DQogICAgaWYgKHN0cmVhbS5tYXRjaCgvXjxcL1xzKnN0eWxlXHMqPi9pLCBmYWxzZSkpIHsNCiAgICAgIHN0YXRlLnRva2VuID0gaHRtbDsNCiAgICAgIHN0YXRlLmxvY2FsU3RhdGUgPSBudWxsOw0KICAgICAgc3RhdGUubW9kZSA9ICJodG1sIjsNCiAgICAgIHJldHVybiBodG1sKHN0cmVhbSwgc3RhdGUpOw0KICAgIH0NCiAgICByZXR1cm4gbWF5YmVCYWNrdXAoc3RyZWFtLCAvPFwvXHMqc3R5bGVccyo+LywNCiAgICAgICAgICAgICAgICAgICAgICAgY3NzTW9kZS50b2tlbihzdHJlYW0sIHN0YXRlLmxvY2FsU3RhdGUpKTsNCiAgfQ0KDQogIHJldHVybiB7DQogICAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oKSB7DQogICAgICB2YXIgc3RhdGUgPSBodG1sTW9kZS5zdGFydFN0YXRlKCk7DQogICAgICByZXR1cm4ge3Rva2VuOiBodG1sLCBsb2NhbFN0YXRlOiBudWxsLCBtb2RlOiAiaHRtbCIsIGh0bWxTdGF0ZTogc3RhdGV9Ow0KICAgIH0sDQoNCiAgICBjb3B5U3RhdGU6IGZ1bmN0aW9uKHN0YXRlKSB7DQogICAgICBpZiAoc3RhdGUubG9jYWxTdGF0ZSkNCiAgICAgICAgdmFyIGxvY2FsID0gQ29kZU1pcnJvci5jb3B5U3RhdGUoc3RhdGUudG9rZW4gPT0gY3NzID8gY3NzTW9kZSA6IGpzTW9kZSwgc3RhdGUubG9jYWxTdGF0ZSk7DQogICAgICByZXR1cm4ge3Rva2VuOiBzdGF0ZS50b2tlbiwgbG9jYWxTdGF0ZTogbG9jYWwsIG1vZGU6IHN0YXRlLm1vZGUsDQogICAgICAgICAgICAgIGh0bWxTdGF0ZTogQ29kZU1pcnJvci5jb3B5U3RhdGUoaHRtbE1vZGUsIHN0YXRlLmh0bWxTdGF0ZSl9Ow0KICAgIH0sDQoNCiAgICB0b2tlbjogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkgew0KICAgICAgcmV0dXJuIHN0YXRlLnRva2VuKHN0cmVhbSwgc3RhdGUpOw0KICAgIH0sDQoNCiAgICBpbmRlbnQ6IGZ1bmN0aW9uKHN0YXRlLCB0ZXh0QWZ0ZXIpIHsNCiAgICAgIGlmIChzdGF0ZS50b2tlbiA9PSBodG1sIHx8IC9eXHMqPFwvLy50ZXN0KHRleHRBZnRlcikpDQogICAgICAgIHJldHVybiBodG1sTW9kZS5pbmRlbnQoc3RhdGUuaHRtbFN0YXRlLCB0ZXh0QWZ0ZXIpOw0KICAgICAgZWxzZSBpZiAoc3RhdGUudG9rZW4gPT0gamF2YXNjcmlwdCkNCiAgICAgICAgcmV0dXJuIGpzTW9kZS5pbmRlbnQoc3RhdGUubG9jYWxTdGF0ZSwgdGV4dEFmdGVyKTsNCiAgICAgIGVsc2UNCiAgICAgICAgcmV0dXJuIGNzc01vZGUuaW5kZW50KHN0YXRlLmxvY2FsU3RhdGUsIHRleHRBZnRlcik7DQogICAgfSwNCg0KICAgIGNvbXBhcmVTdGF0ZXM6IGZ1bmN0aW9uKGEsIGIpIHsNCiAgICAgIHJldHVybiBodG1sTW9kZS5jb21wYXJlU3RhdGVzKGEuaHRtbFN0YXRlLCBiLmh0bWxTdGF0ZSk7DQogICAgfSwNCg0KICAgIGVsZWN0cmljQ2hhcnM6ICIve306Ig0KICB9DQp9KTsNCg0KQ29kZU1pcnJvci5kZWZpbmVNSU1FKCJ0ZXh0L2h0bWwiLCAiaHRtbCIpOw0KDQpDb2RlTWlycm9yLmRlZmluZU1vZGUoImNzcyIsIGZ1bmN0aW9uKGNvbmZpZykgew0KICB2YXIgaW5kZW50VW5pdCA9IGNvbmZpZy5pbmRlbnRVbml0LCB0eXBlOw0KICBmdW5jdGlvbiByZXQoc3R5bGUsIHRwKSB7dHlwZSA9IHRwOyByZXR1cm4gc3R5bGU7fQ0KDQogIGZ1bmN0aW9uIHRva2VuQmFzZShzdHJlYW0sIHN0YXRlKSB7DQogICAgdmFyIGNoID0gc3RyZWFtLm5leHQoKTsNCiAgICBpZiAoY2ggPT0gIkAiKSB7c3RyZWFtLmVhdFdoaWxlKC9bXHdcXFwtXS8pOyByZXR1cm4gcmV0KCJtZXRhIiwgc3RyZWFtLmN1cnJlbnQoKSk7fQ0KICAgIGVsc2UgaWYgKGNoID09ICIvIiAmJiBzdHJlYW0uZWF0KCIqIikpIHsNCiAgICAgIHN0YXRlLnRva2VuaXplID0gdG9rZW5DQ29tbWVudDsNCiAgICAgIHJldHVybiB0b2tlbkNDb21tZW50KHN0cmVhbSwgc3RhdGUpOw0KICAgIH0NCiAgICBlbHNlIGlmIChjaCA9PSAiPCIgJiYgc3RyZWFtLmVhdCgiISIpKSB7DQogICAgICBzdGF0ZS50b2tlbml6ZSA9IHRva2VuU0dNTENvbW1lbnQ7DQogICAgICByZXR1cm4gdG9rZW5TR01MQ29tbWVudChzdHJlYW0sIHN0YXRlKTsNCiAgICB9DQogICAgZWxzZSBpZiAoY2ggPT0gIj0iKSByZXQobnVsbCwgImNvbXBhcmUiKTsNCiAgICBlbHNlIGlmICgoY2ggPT0gIn4iIHx8IGNoID09ICJ8IikgJiYgc3RyZWFtLmVhdCgiPSIpKSByZXR1cm4gcmV0KG51bGwsICJjb21wYXJlIik7DQogICAgZWxzZSBpZiAoY2ggPT0gIlwiIiB8fCBjaCA9PSAiJyIpIHsNCiAgICAgIHN0YXRlLnRva2VuaXplID0gdG9rZW5TdHJpbmcoY2gpOw0KICAgICAgcmV0dXJuIHN0YXRlLnRva2VuaXplKHN0cmVhbSwgc3RhdGUpOw0KICAgIH0NCiAgICBlbHNlIGlmIChjaCA9PSAiIyIpIHsNCiAgICAgIHN0cmVhbS5lYXRXaGlsZSgvW1x3XFxcLV0vKTsNCiAgICAgIHJldHVybiByZXQoImF0b20iLCAiaGFzaCIpOw0KICAgIH0NCiAgICBlbHNlIGlmIChjaCA9PSAiISIpIHsNCiAgICAgIHN0cmVhbS5tYXRjaCgvXlxzKlx3Ki8pOw0KICAgICAgcmV0dXJuIHJldCgia2V5d29yZCIsICJpbXBvcnRhbnQiKTsNCiAgICB9DQogICAgZWxzZSBpZiAoL1xkLy50ZXN0KGNoKSkgew0KICAgICAgc3RyZWFtLmVhdFdoaWxlKC9bXHcuJV0vKTsNCiAgICAgIHJldHVybiByZXQoIm51bWJlciIsICJ1bml0Iik7DQogICAgfQ0KICAgIGVsc2UgaWYgKC9bLC4rPipcL10vLnRlc3QoY2gpKSB7DQogICAgICByZXR1cm4gcmV0KG51bGwsICJzZWxlY3Qtb3AiKTsNCiAgICB9DQogICAgZWxzZSBpZiAoL1s7e306XFtcXV0vLnRlc3QoY2gpKSB7DQogICAgICByZXR1cm4gcmV0KG51bGwsIGNoKTsNCiAgICB9DQogICAgZWxzZSB7DQogICAgICBzdHJlYW0uZWF0V2hpbGUoL1tcd1xcXC1dLyk7DQogICAgICByZXR1cm4gcmV0KCJ2YXJpYWJsZSIsICJ2YXJpYWJsZSIpOw0KICAgIH0NCiAgfQ0KDQogIGZ1bmN0aW9uIHRva2VuQ0NvbW1lbnQoc3RyZWFtLCBzdGF0ZSkgew0KICAgIHZhciBtYXliZUVuZCA9IGZhbHNlLCBjaDsNCiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLm5leHQoKSkgIT0gbnVsbCkgew0KICAgICAgaWYgKG1heWJlRW5kICYmIGNoID09ICIvIikgew0KICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IHRva2VuQmFzZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICBtYXliZUVuZCA9IChjaCA9PSAiKiIpOw0KICAgIH0NCiAgICByZXR1cm4gcmV0KCJjb21tZW50IiwgImNvbW1lbnQiKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRva2VuU0dNTENvbW1lbnQoc3RyZWFtLCBzdGF0ZSkgew0KICAgIHZhciBkYXNoZXMgPSAwLCBjaDsNCiAgICB3aGlsZSAoKGNoID0gc3RyZWFtLm5leHQoKSkgIT0gbnVsbCkgew0KICAgICAgaWYgKGRhc2hlcyA+PSAyICYmIGNoID09ICI+Iikgew0KICAgICAgICBzdGF0ZS50b2tlbml6ZSA9IHRva2VuQmFzZTsNCiAgICAgICAgYnJlYWs7DQogICAgICB9DQogICAgICBkYXNoZXMgPSAoY2ggPT0gIi0iKSA/IGRhc2hlcyArIDEgOiAwOw0KICAgIH0NCiAgICByZXR1cm4gcmV0KCJjb21tZW50IiwgImNvbW1lbnQiKTsNCiAgfQ0KDQogIGZ1bmN0aW9uIHRva2VuU3RyaW5nKHF1b3RlKSB7DQogICAgcmV0dXJuIGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHsNCiAgICAgIHZhciBlc2NhcGVkID0gZmFsc2UsIGNoOw0KICAgICAgd2hpbGUgKChjaCA9IHN0cmVhbS5uZXh0KCkpICE9IG51bGwpIHsNCiAgICAgICAgaWYgKGNoID09IHF1b3RlICYmICFlc2NhcGVkKQ0KICAgICAgICAgIGJyZWFrOw0KICAgICAgICBlc2NhcGVkID0gIWVzY2FwZWQgJiYgY2ggPT0gIlxcIjsNCiAgICAgIH0NCiAgICAgIGlmICghZXNjYXBlZCkgc3RhdGUudG9rZW5pemUgPSB0b2tlbkJhc2U7DQogICAgICByZXR1cm4gcmV0KCJzdHJpbmciLCAic3RyaW5nIik7DQogICAgfTsNCiAgfQ0KDQogIHJldHVybiB7DQogICAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oYmFzZSkgew0KICAgICAgcmV0dXJuIHt0b2tlbml6ZTogdG9rZW5CYXNlLA0KICAgICAgICAgICAgICBiYXNlSW5kZW50OiBiYXNlIHx8IDAsDQogICAgICAgICAgICAgIHN0YWNrOiBbXX07DQogICAgfSwNCg0KICAgIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7DQogICAgICBpZiAoc3RyZWFtLmVhdFNwYWNlKCkpIHJldHVybiBudWxsOw0KICAgICAgdmFyIHN0eWxlID0gc3RhdGUudG9rZW5pemUoc3RyZWFtLCBzdGF0ZSk7DQoNCiAgICAgIHZhciBjb250ZXh0ID0gc3RhdGUuc3RhY2tbc3RhdGUuc3RhY2subGVuZ3RoLTFdOw0KICAgICAgaWYgKHR5cGUgPT0gImhhc2giICYmIGNvbnRleHQgPT0gInJ1bGUiKSBzdHlsZSA9ICJhdG9tIjsNCiAgICAgIGVsc2UgaWYgKHN0eWxlID09ICJ2YXJpYWJsZSIpIHsNCiAgICAgICAgaWYgKGNvbnRleHQgPT0gInJ1bGUiKSBzdHlsZSA9ICJudW1iZXIiOw0KICAgICAgICBlbHNlIGlmICghY29udGV4dCB8fCBjb250ZXh0ID09ICJAbWVkaWF7Iikgc3R5bGUgPSAidGFnIjsNCiAgICAgIH0NCg0KICAgICAgaWYgKGNvbnRleHQgPT0gInJ1bGUiICYmIC9eW1x7XH07XSQvLnRlc3QodHlwZSkpDQogICAgICAgIHN0YXRlLnN0YWNrLnBvcCgpOw0KICAgICAgaWYgKHR5cGUgPT0gInsiKSB7DQogICAgICAgIGlmIChjb250ZXh0ID09ICJAbWVkaWEiKSBzdGF0ZS5zdGFja1tzdGF0ZS5zdGFjay5sZW5ndGgtMV0gPSAiQG1lZGlheyI7DQogICAgICAgIGVsc2Ugc3RhdGUuc3RhY2sucHVzaCgieyIpOw0KICAgICAgfQ0KICAgICAgZWxzZSBpZiAodHlwZSA9PSAifSIpIHN0YXRlLnN0YWNrLnBvcCgpOw0KICAgICAgZWxzZSBpZiAodHlwZSA9PSAiQG1lZGlhIikgc3RhdGUuc3RhY2sucHVzaCgiQG1lZGlhIik7DQogICAgICBlbHNlIGlmIChjb250ZXh0ID09ICJ7IiAmJiB0eXBlICE9ICJjb21tZW50Iikgc3RhdGUuc3RhY2sucHVzaCgicnVsZSIpOw0KICAgICAgcmV0dXJuIHN0eWxlOw0KICAgIH0sDQoNCiAgICBpbmRlbnQ6IGZ1bmN0aW9uKHN0YXRlLCB0ZXh0QWZ0ZXIpIHsNCiAgICAgIHZhciBuID0gc3RhdGUuc3RhY2subGVuZ3RoOw0KICAgICAgaWYgKC9eXH0vLnRlc3QodGV4dEFmdGVyKSkNCiAgICAgICAgbiAtPSBzdGF0ZS5zdGFja1tzdGF0ZS5zdGFjay5sZW5ndGgtMV0gPT0gInJ1bGUiID8gMiA6IDE7DQogICAgICByZXR1cm4gc3RhdGUuYmFzZUluZGVudCArIG4gKiBpbmRlbnRVbml0Ow0KICAgIH0sDQoNCiAgICBlbGVjdHJpY0NoYXJzOiAifSINCiAgfTsNCn0pOw0KDQpDb2RlTWlycm9yLmRlZmluZU1JTUUoInRleHQvY3NzIiwgImNzcyIpOw0K]]></Resource>
    <Resource ID="966f39fb-3da2-95f2-c33a-398880aff765" Name="codemirror.min.js" Type="js"><![CDATA[LyogQ29kZU1pcnJvciB2ZXJzaW9uIDIuMjIgKi8KdmFyIENvZGVNaXJyb3I9ZnVuY3Rpb24oKXtm
			dW5jdGlvbiBDb2RlTWlycm9yKHBsYWNlLGdpdmVuT3B0aW9ucyl7dmFyIG9wdGlvbnM9e30sZGVm
			YXVsdHM9Q29kZU1pcnJvci5kZWZhdWx0cztmb3IodmFyIG9wdCBpbiBkZWZhdWx0cylpZihkZWZh
			dWx0cy5oYXNPd25Qcm9wZXJ0eShvcHQpKW9wdGlvbnNbb3B0XT0oZ2l2ZW5PcHRpb25zJiZnaXZl
			bk9wdGlvbnMuaGFzT3duUHJvcGVydHkob3B0KT9naXZlbk9wdGlvbnM6ZGVmYXVsdHMpW29wdF07
			dmFyIHRhcmdldERvY3VtZW50PW9wdGlvbnNbImRvY3VtZW50Il07dmFyIHdyYXBwZXI9dGFyZ2V0
			RG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7d3JhcHBlci5jbGFzc05hbWU9IkNvZGVNaXJy
			b3IiKyhvcHRpb25zLmxpbmVXcmFwcGluZz8iIENvZGVNaXJyb3Itd3JhcCI6IiIpO3dyYXBwZXIu
			aW5uZXJIVE1MPSc8ZGl2IHN0eWxlPSJvdmVyZmxvdzogaGlkZGVuOyBwb3NpdGlvbjogcmVsYXRp
			dmU7IHdpZHRoOiAzcHg7IGhlaWdodDogMHB4OyI+JysgJzx0ZXh0YXJlYSBzdHlsZT0icG9zaXRp
			b246IGFic29sdXRlOyBwYWRkaW5nOiAwOyB3aWR0aDogMXB4OyBoZWlnaHQ6IDFlbSIgd3JhcD0i
			b2ZmIiAnKydhdXRvY29ycmVjdD0ib2ZmIiBhdXRvY2FwaXRhbGl6ZT0ib2ZmIj48L3RleHRhcmVh
			PjwvZGl2PicrJzxkaXYgY2xhc3M9IkNvZGVNaXJyb3Itc2Nyb2xsIiB0YWJpbmRleD0iLTEiPicr
			JzxkaXYgc3R5bGU9InBvc2l0aW9uOiByZWxhdGl2ZSI+JysnPGRpdiBzdHlsZT0icG9zaXRpb246
			IHJlbGF0aXZlIj4nKyc8ZGl2IGNsYXNzPSJDb2RlTWlycm9yLWd1dHRlciI+PGRpdiBjbGFzcz0i
			Q29kZU1pcnJvci1ndXR0ZXItdGV4dCI+PC9kaXY+PC9kaXY+JysnPGRpdiBjbGFzcz0iQ29kZU1p
			cnJvci1saW5lcyI+PGRpdiBzdHlsZT0icG9zaXRpb246IHJlbGF0aXZlOyB6LWluZGV4OiAwIj4n
			Kyc8ZGl2IHN0eWxlPSJwb3NpdGlvbjogYWJzb2x1dGU7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDA7
			IG92ZXJmbG93OiBoaWRkZW47IHZpc2liaWxpdHk6IGhpZGRlbjsiPjwvZGl2PicrICc8cHJlIGNs
			YXNzPSJDb2RlTWlycm9yLWN1cnNvciI+JiMxNjA7PC9wcmU+JysnPGRpdiBzdHlsZT0icG9zaXRp
			b246IHJlbGF0aXZlOyB6LWluZGV4OiAtMSI+PC9kaXY+PGRpdj48L2Rpdj4nKyI8L2Rpdj48L2Rp
			dj48L2Rpdj48L2Rpdj48L2Rpdj4iO2lmKHBsYWNlLmFwcGVuZENoaWxkKXBsYWNlLmFwcGVuZENo
			aWxkKHdyYXBwZXIpO2Vsc2UgcGxhY2Uod3JhcHBlcik7dmFyIGlucHV0RGl2PXdyYXBwZXIuZmly
			c3RDaGlsZCxpbnB1dD1pbnB1dERpdi5maXJzdENoaWxkLHNjcm9sbGVyPXdyYXBwZXIubGFzdENo
			aWxkLGNvZGU9c2Nyb2xsZXIuZmlyc3RDaGlsZCxtb3Zlcj1jb2RlLmZpcnN0Q2hpbGQsZ3V0dGVy
			PW1vdmVyLmZpcnN0Q2hpbGQsZ3V0dGVyVGV4dD1ndXR0ZXIuZmlyc3RDaGlsZCxsaW5lU3BhY2U9
			Z3V0dGVyLm5leHRTaWJsaW5nLmZpcnN0Q2hpbGQsbWVhc3VyZT1saW5lU3BhY2UuZmlyc3RDaGls
			ZCxjdXJzb3I9bWVhc3VyZS5uZXh0U2libGluZyxzZWxlY3Rpb25EaXY9IGN1cnNvci5uZXh0U2li
			bGluZyxsaW5lRGl2PXNlbGVjdGlvbkRpdi5uZXh0U2libGluZzt0aGVtZUNoYW5nZWQoKTtpZihp
			b3MpaW5wdXQuc3R5bGUud2lkdGg9IjBweCI7aWYoIXdlYmtpdClsaW5lU3BhY2UuZHJhZ2dhYmxl
			PXRydWU7bGluZVNwYWNlLnN0eWxlLm91dGxpbmU9Im5vbmUiO2lmKG9wdGlvbnMudGFiaW5kZXgh
			PW51bGwpaW5wdXQudGFiSW5kZXg9b3B0aW9ucy50YWJpbmRleDtpZighb3B0aW9ucy5ndXR0ZXIm
			JiFvcHRpb25zLmxpbmVOdW1iZXJzKWd1dHRlci5zdHlsZS5kaXNwbGF5PSJub25lIjt0cnl7c3Ry
			aW5nV2lkdGgoIngiKX1jYXRjaChlKXtpZihlLm1lc3NhZ2UubWF0Y2goL3J1bnRpbWUvaSkpZT1u
			ZXcgRXJyb3IoIkEgQ29kZU1pcnJvciBpbnNpZGUgYSBQLXN0eWxlIGVsZW1lbnQgZG9lcyBub3Qg
			d29yayBpbiBJbnRlcm5ldCBFeHBsb3Jlci4gKGlubmVySFRNTCBidWcpIik7dGhyb3cgZTt9dmFy
			IHBvbGw9bmV3IERlbGF5ZWQsaGlnaGxpZ2h0PW5ldyBEZWxheWVkLCBibGlua2VyO3ZhciBtb2Rl
			LGRvYz1uZXcgQnJhbmNoQ2h1bmsoW25ldyBMZWFmQ2h1bmsoW25ldyBMaW5lKCIiKV0pXSksd29y
			ayxmb2N1c2VkO2xvYWRNb2RlKCk7dmFyIHNlbD17ZnJvbTp7bGluZTowLGNoOjB9LHRvOntsaW5l
			OjAsY2g6MH0saW52ZXJ0ZWQ6ZmFsc2V9O3ZhciBzaGlmdFNlbGVjdGluZyxsYXN0Q2xpY2ssbGFz
			dERvdWJsZUNsaWNrLGxhc3RTY3JvbGxQb3M9MCxkcmFnZ2luZ1RleHQsb3ZlcndyaXRlPWZhbHNl
			LHN1cHByZXNzRWRpdHM9ZmFsc2U7dmFyIHVwZGF0ZUlucHV0LHVzZXJTZWxDaGFuZ2UsY2hhbmdl
			cyx0ZXh0Q2hhbmdlZCxzZWxlY3Rpb25DaGFuZ2VkLGxlYXZlSW5wdXRBbG9uZSxndXR0ZXJEaXJ0
			eSxjYWxsYmFja3M7dmFyIGRpc3BsYXlPZmZzZXQ9MCxzaG93aW5nRnJvbT0wLHNob3dpbmdUbz0w
			LGxhc3RTaXplQz0wO3ZhciBicmFja2V0SGlnaGxpZ2h0ZWQ7dmFyIG1heExpbmU9IiIsbWF4V2lk
			dGg7b3BlcmF0aW9uKGZ1bmN0aW9uKCl7c2V0VmFsdWUob3B0aW9ucy52YWx1ZXx8ICIiKTt1cGRh
			dGVJbnB1dD1mYWxzZX0pKCk7dmFyIGhpc3Rvcnk9bmV3IEhpc3Rvcnk7Y29ubmVjdChzY3JvbGxl
			ciwibW91c2Vkb3duIixvcGVyYXRpb24ob25Nb3VzZURvd24pKTtjb25uZWN0KHNjcm9sbGVyLCJk
			YmxjbGljayIsb3BlcmF0aW9uKG9uRG91YmxlQ2xpY2spKTtjb25uZWN0KGxpbmVTcGFjZSwiZHJh
			Z3N0YXJ0IixvbkRyYWdTdGFydCk7Y29ubmVjdChsaW5lU3BhY2UsInNlbGVjdHN0YXJ0IixlX3By
			ZXZlbnREZWZhdWx0KTtpZighZ2Vja28pY29ubmVjdChzY3JvbGxlciwiY29udGV4dG1lbnUiLG9u
			Q29udGV4dE1lbnUpO2Nvbm5lY3Qoc2Nyb2xsZXIsInNjcm9sbCIsZnVuY3Rpb24oKXtsYXN0U2Ny
			b2xsUG9zPXNjcm9sbGVyLnNjcm9sbFRvcDt1cGRhdGVEaXNwbGF5KFtdKTtpZihvcHRpb25zLmZp
			eGVkR3V0dGVyKWd1dHRlci5zdHlsZS5sZWZ0PXNjcm9sbGVyLnNjcm9sbExlZnQrInB4IjtpZihv
			cHRpb25zLm9uU2Nyb2xsKW9wdGlvbnMub25TY3JvbGwoaW5zdGFuY2UpfSk7IGNvbm5lY3Qod2lu
			ZG93LCJyZXNpemUiLGZ1bmN0aW9uKCl7dXBkYXRlRGlzcGxheSh0cnVlKX0pO2Nvbm5lY3QoaW5w
			dXQsImtleXVwIixvcGVyYXRpb24ob25LZXlVcCkpO2Nvbm5lY3QoaW5wdXQsImlucHV0IixmYXN0
			UG9sbCk7Y29ubmVjdChpbnB1dCwia2V5ZG93biIsb3BlcmF0aW9uKG9uS2V5RG93bikpO2Nvbm5l
			Y3QoaW5wdXQsImtleXByZXNzIixvcGVyYXRpb24ob25LZXlQcmVzcykpO2Nvbm5lY3QoaW5wdXQs
			ImZvY3VzIixvbkZvY3VzKTtjb25uZWN0KGlucHV0LCJibHVyIixvbkJsdXIpO2Nvbm5lY3Qoc2Ny
			b2xsZXIsImRyYWdlbnRlciIsZV9zdG9wKTtjb25uZWN0KHNjcm9sbGVyLCJkcmFnb3ZlciIsZV9z
			dG9wKTtjb25uZWN0KHNjcm9sbGVyLCJkcm9wIixvcGVyYXRpb24ob25Ecm9wKSk7Y29ubmVjdChz
			Y3JvbGxlciwicGFzdGUiLGZ1bmN0aW9uKCl7Zm9jdXNJbnB1dCgpO2Zhc3RQb2xsKCl9KTtjb25u
			ZWN0KGlucHV0LCJwYXN0ZSIsZmFzdFBvbGwpO2Nvbm5lY3QoaW5wdXQsICJjdXQiLG9wZXJhdGlv
			bihmdW5jdGlvbigpe2lmKCFvcHRpb25zLnJlYWRPbmx5KXJlcGxhY2VTZWxlY3Rpb24oIiIpfSkp
			O3ZhciBoYXNGb2N1czt0cnl7aGFzRm9jdXM9dGFyZ2V0RG9jdW1lbnQuYWN0aXZlRWxlbWVudD09
			aW5wdXR9Y2F0Y2goZSl7fWlmKGhhc0ZvY3VzKXNldFRpbWVvdXQob25Gb2N1cywyMCk7ZWxzZSBv
			bkJsdXIoKTtmdW5jdGlvbiBpc0xpbmUobCl7cmV0dXJuIGw+PTAmJmw8ZG9jLnNpemV9dmFyIGlu
			c3RhbmNlPXdyYXBwZXIuQ29kZU1pcnJvcj17Z2V0VmFsdWU6Z2V0VmFsdWUsc2V0VmFsdWU6b3Bl
			cmF0aW9uKHNldFZhbHVlKSxnZXRTZWxlY3Rpb246Z2V0U2VsZWN0aW9uLHJlcGxhY2VTZWxlY3Rp
			b246b3BlcmF0aW9uKHJlcGxhY2VTZWxlY3Rpb24pLGZvY3VzOmZ1bmN0aW9uKCl7d2luZG93LmZv
			Y3VzKCk7Zm9jdXNJbnB1dCgpO29uRm9jdXMoKTtmYXN0UG9sbCgpfSxzZXRPcHRpb246ZnVuY3Rp
			b24ob3B0aW9uLHZhbHVlKXt2YXIgb2xkVmFsPW9wdGlvbnNbb3B0aW9uXTsgb3B0aW9uc1tvcHRp
			b25dPXZhbHVlO2lmKG9wdGlvbj09Im1vZGUifHxvcHRpb249PSJpbmRlbnRVbml0Iilsb2FkTW9k
			ZSgpO2Vsc2UgaWYob3B0aW9uPT0icmVhZE9ubHkiJiZ2YWx1ZT09Im5vY3Vyc29yIil7b25CbHVy
			KCk7aW5wdXQuYmx1cigpfWVsc2UgaWYob3B0aW9uPT0icmVhZE9ubHkiJiYhdmFsdWUpcmVzZXRJ
			bnB1dCh0cnVlKTtlbHNlIGlmKG9wdGlvbj09InRoZW1lIil0aGVtZUNoYW5nZWQoKTtlbHNlIGlm
			KG9wdGlvbj09ImxpbmVXcmFwcGluZyImJm9sZFZhbCE9dmFsdWUpb3BlcmF0aW9uKHdyYXBwaW5n
			Q2hhbmdlZCkoKTtlbHNlIGlmKG9wdGlvbj09InRhYlNpemUiKXVwZGF0ZURpc3BsYXkodHJ1ZSk7
			aWYob3B0aW9uPT0ibGluZU51bWJlcnMifHxvcHRpb249PSJndXR0ZXIifHxvcHRpb249PSJmaXJz
			dExpbmVOdW1iZXIifHxvcHRpb249PSJ0aGVtZSIpe2d1dHRlckNoYW5nZWQoKTt1cGRhdGVEaXNw
			bGF5KHRydWUpfX0sZ2V0T3B0aW9uOmZ1bmN0aW9uKG9wdGlvbil7cmV0dXJuIG9wdGlvbnNbb3B0
			aW9uXX0sIHVuZG86b3BlcmF0aW9uKHVuZG8pLHJlZG86b3BlcmF0aW9uKHJlZG8pLGluZGVudExp
			bmU6b3BlcmF0aW9uKGZ1bmN0aW9uKG4sZGlyKXtpZih0eXBlb2YgZGlyIT0ic3RyaW5nIilpZihk
			aXI9PW51bGwpZGlyPW9wdGlvbnMuc21hcnRJbmRlbnQ/InNtYXJ0IjoicHJldiI7ZWxzZSBkaXI9
			ZGlyPyJhZGQiOiJzdWJ0cmFjdCI7aWYoaXNMaW5lKG4pKWluZGVudExpbmUobixkaXIpfSksaW5k
			ZW50U2VsZWN0aW9uOm9wZXJhdGlvbihpbmRlbnRTZWxlY3RlZCksaGlzdG9yeVNpemU6ZnVuY3Rp
			b24oKXtyZXR1cm57dW5kbzpoaXN0b3J5LmRvbmUubGVuZ3RoLHJlZG86aGlzdG9yeS51bmRvbmUu
			bGVuZ3RofX0sY2xlYXJIaXN0b3J5OmZ1bmN0aW9uKCl7aGlzdG9yeT1uZXcgSGlzdG9yeX0sbWF0
			Y2hCcmFja2V0czpvcGVyYXRpb24oZnVuY3Rpb24oKXttYXRjaEJyYWNrZXRzKHRydWUpfSksZ2V0
			VG9rZW5BdDpvcGVyYXRpb24oZnVuY3Rpb24ocG9zKXtwb3M9Y2xpcFBvcyhwb3MpO3JldHVybiBn
			ZXRMaW5lKHBvcy5saW5lKS5nZXRUb2tlbkF0KG1vZGUsIGdldFN0YXRlQmVmb3JlKHBvcy5saW5l
			KSxwb3MuY2gpfSksZ2V0U3RhdGVBZnRlcjpmdW5jdGlvbihsaW5lKXtsaW5lPWNsaXBMaW5lKGxp
			bmU9PW51bGw/ZG9jLnNpemUtMTpsaW5lKTtyZXR1cm4gZ2V0U3RhdGVCZWZvcmUobGluZSsxKX0s
			Y3Vyc29yQ29vcmRzOmZ1bmN0aW9uKHN0YXJ0KXtpZihzdGFydD09bnVsbClzdGFydD1zZWwuaW52
			ZXJ0ZWQ7cmV0dXJuIHBhZ2VDb29yZHMoc3RhcnQ/c2VsLmZyb206c2VsLnRvKX0sY2hhckNvb3Jk
			czpmdW5jdGlvbihwb3Mpe3JldHVybiBwYWdlQ29vcmRzKGNsaXBQb3MocG9zKSl9LGNvb3Jkc0No
			YXI6ZnVuY3Rpb24oY29vcmRzKXt2YXIgb2ZmPWVsdE9mZnNldChsaW5lU3BhY2UpO3JldHVybiBj
			b29yZHNDaGFyKGNvb3Jkcy54LW9mZi5sZWZ0LGNvb3Jkcy55LW9mZi50b3ApfSxtYXJrVGV4dDpv
			cGVyYXRpb24obWFya1RleHQpLHNldEJvb2ttYXJrOnNldEJvb2ttYXJrLHNldE1hcmtlcjpvcGVy
			YXRpb24oYWRkR3V0dGVyTWFya2VyKSwgY2xlYXJNYXJrZXI6b3BlcmF0aW9uKHJlbW92ZUd1dHRl
			ck1hcmtlciksc2V0TGluZUNsYXNzOm9wZXJhdGlvbihzZXRMaW5lQ2xhc3MpLGhpZGVMaW5lOm9w
			ZXJhdGlvbihmdW5jdGlvbihoKXtyZXR1cm4gc2V0TGluZUhpZGRlbihoLHRydWUpfSksc2hvd0xp
			bmU6b3BlcmF0aW9uKGZ1bmN0aW9uKGgpe3JldHVybiBzZXRMaW5lSGlkZGVuKGgsZmFsc2UpfSks
			b25EZWxldGVMaW5lOmZ1bmN0aW9uKGxpbmUsZil7aWYodHlwZW9mIGxpbmU9PSJudW1iZXIiKXtp
			ZighaXNMaW5lKGxpbmUpKXJldHVybiBudWxsO2xpbmU9Z2V0TGluZShsaW5lKX0obGluZS5oYW5k
			bGVyc3x8KGxpbmUuaGFuZGxlcnM9W10pKS5wdXNoKGYpO3JldHVybiBsaW5lfSxsaW5lSW5mbzps
			aW5lSW5mbyxhZGRXaWRnZXQ6ZnVuY3Rpb24ocG9zLG5vZGUsc2Nyb2xsLHZlcnQsaG9yaXope3Bv
			cz1sb2NhbENvb3JkcyhjbGlwUG9zKHBvcykpO3ZhciB0b3A9cG9zLnlCb3QsbGVmdD1wb3MueDtu
			b2RlLnN0eWxlLnBvc2l0aW9uPSAiYWJzb2x1dGUiO2NvZGUuYXBwZW5kQ2hpbGQobm9kZSk7aWYo
			dmVydD09Im92ZXIiKXRvcD1wb3MueTtlbHNlIGlmKHZlcnQ9PSJuZWFyIil7dmFyIHZzcGFjZT1N
			YXRoLm1heChzY3JvbGxlci5vZmZzZXRIZWlnaHQsZG9jLmhlaWdodCp0ZXh0SGVpZ2h0KCkpLGhz
			cGFjZT1NYXRoLm1heChjb2RlLmNsaWVudFdpZHRoLGxpbmVTcGFjZS5jbGllbnRXaWR0aCktcGFk
			ZGluZ0xlZnQoKTtpZihwb3MueUJvdCtub2RlLm9mZnNldEhlaWdodD52c3BhY2UmJnBvcy55Pm5v
			ZGUub2Zmc2V0SGVpZ2h0KXRvcD1wb3MueS1ub2RlLm9mZnNldEhlaWdodDtpZihsZWZ0K25vZGUu
			b2Zmc2V0V2lkdGg+aHNwYWNlKWxlZnQ9aHNwYWNlLW5vZGUub2Zmc2V0V2lkdGh9bm9kZS5zdHls
			ZS50b3A9dG9wK3BhZGRpbmdUb3AoKSsicHgiO25vZGUuc3R5bGUubGVmdD1ub2RlLnN0eWxlLnJp
			Z2h0PSIiO2lmKGhvcml6PT0icmlnaHQiKXtsZWZ0PWNvZGUuY2xpZW50V2lkdGgtbm9kZS5vZmZz
			ZXRXaWR0aDsgbm9kZS5zdHlsZS5yaWdodD0iMHB4In1lbHNle2lmKGhvcml6PT0ibGVmdCIpbGVm
			dD0wO2Vsc2UgaWYoaG9yaXo9PSJtaWRkbGUiKWxlZnQ9KGNvZGUuY2xpZW50V2lkdGgtbm9kZS5v
			ZmZzZXRXaWR0aCkvMjtub2RlLnN0eWxlLmxlZnQ9bGVmdCtwYWRkaW5nTGVmdCgpKyJweCJ9aWYo
			c2Nyb2xsKXNjcm9sbEludG9WaWV3KGxlZnQsdG9wLGxlZnQrbm9kZS5vZmZzZXRXaWR0aCx0b3Ar
			bm9kZS5vZmZzZXRIZWlnaHQpfSxsaW5lQ291bnQ6ZnVuY3Rpb24oKXtyZXR1cm4gZG9jLnNpemV9
			LGNsaXBQb3M6Y2xpcFBvcyxnZXRDdXJzb3I6ZnVuY3Rpb24oc3RhcnQpe2lmKHN0YXJ0PT1udWxs
			KXN0YXJ0PXNlbC5pbnZlcnRlZDtyZXR1cm4gY29weVBvcyhzdGFydD9zZWwuZnJvbTpzZWwudG8p
			fSxzb21ldGhpbmdTZWxlY3RlZDpmdW5jdGlvbigpe3JldHVybiFwb3NFcShzZWwuZnJvbSxzZWwu
			dG8pfSxzZXRDdXJzb3I6b3BlcmF0aW9uKGZ1bmN0aW9uKGxpbmUsY2gsdXNlcil7aWYoY2g9PSBu
			dWxsJiZ0eXBlb2YgbGluZS5saW5lPT0ibnVtYmVyIilzZXRDdXJzb3IobGluZS5saW5lLGxpbmUu
			Y2gsdXNlcik7ZWxzZSBzZXRDdXJzb3IobGluZSxjaCx1c2VyKX0pLHNldFNlbGVjdGlvbjpvcGVy
			YXRpb24oZnVuY3Rpb24oZnJvbSx0byx1c2VyKXsodXNlcj9zZXRTZWxlY3Rpb25Vc2VyOnNldFNl
			bGVjdGlvbikoY2xpcFBvcyhmcm9tKSxjbGlwUG9zKHRvfHxmcm9tKSl9KSxnZXRMaW5lOmZ1bmN0
			aW9uKGxpbmUpe2lmKGlzTGluZShsaW5lKSlyZXR1cm4gZ2V0TGluZShsaW5lKS50ZXh0fSxnZXRM
			aW5lSGFuZGxlOmZ1bmN0aW9uKGxpbmUpe2lmKGlzTGluZShsaW5lKSlyZXR1cm4gZ2V0TGluZShs
			aW5lKX0sc2V0TGluZTpvcGVyYXRpb24oZnVuY3Rpb24obGluZSx0ZXh0KXtpZihpc0xpbmUobGlu
			ZSkpcmVwbGFjZVJhbmdlKHRleHQse2xpbmU6bGluZSxjaDowfSx7bGluZTpsaW5lLGNoOmdldExp
			bmUobGluZSkudGV4dC5sZW5ndGh9KX0pLHJlbW92ZUxpbmU6b3BlcmF0aW9uKGZ1bmN0aW9uKGxp
			bmUpe2lmKGlzTGluZShsaW5lKSlyZXBsYWNlUmFuZ2UoIiIsIHtsaW5lOmxpbmUsY2g6MH0sY2xp
			cFBvcyh7bGluZTpsaW5lKzEsY2g6MH0pKX0pLHJlcGxhY2VSYW5nZTpvcGVyYXRpb24ocmVwbGFj
			ZVJhbmdlKSxnZXRSYW5nZTpmdW5jdGlvbihmcm9tLHRvKXtyZXR1cm4gZ2V0UmFuZ2UoY2xpcFBv
			cyhmcm9tKSxjbGlwUG9zKHRvKSl9LGV4ZWNDb21tYW5kOmZ1bmN0aW9uKGNtZCl7cmV0dXJuIGNv
			bW1hbmRzW2NtZF0oaW5zdGFuY2UpfSxtb3ZlSDpvcGVyYXRpb24obW92ZUgpLGRlbGV0ZUg6b3Bl
			cmF0aW9uKGRlbGV0ZUgpLG1vdmVWOm9wZXJhdGlvbihtb3ZlViksdG9nZ2xlT3ZlcndyaXRlOmZ1
			bmN0aW9uKCl7aWYob3ZlcndyaXRlKXtvdmVyd3JpdGU9ZmFsc2U7Y3Vyc29yLmNsYXNzTmFtZT1j
			dXJzb3IuY2xhc3NOYW1lLnJlcGxhY2UoIiBDb2RlTWlycm9yLW92ZXJ3cml0ZSIsIiIpfWVsc2V7
			b3ZlcndyaXRlPXRydWU7Y3Vyc29yLmNsYXNzTmFtZSs9IiBDb2RlTWlycm9yLW92ZXJ3cml0ZSJ9
			fSxwb3NGcm9tSW5kZXg6ZnVuY3Rpb24ob2ZmKXt2YXIgbGluZU5vPSAwLGNoO2RvYy5pdGVyKDAs
			ZG9jLnNpemUsZnVuY3Rpb24obGluZSl7dmFyIHN6PWxpbmUudGV4dC5sZW5ndGgrMTtpZihzej5v
			ZmYpe2NoPW9mZjtyZXR1cm4gdHJ1ZX1vZmYtPXN6OysrbGluZU5vfSk7cmV0dXJuIGNsaXBQb3Mo
			e2xpbmU6bGluZU5vLGNoOmNofSl9LGluZGV4RnJvbVBvczpmdW5jdGlvbihjb29yZHMpe2lmKGNv
			b3Jkcy5saW5lPDB8fGNvb3Jkcy5jaDwwKXJldHVybiAwO3ZhciBpbmRleD1jb29yZHMuY2g7ZG9j
			Lml0ZXIoMCxjb29yZHMubGluZSxmdW5jdGlvbihsaW5lKXtpbmRleCs9bGluZS50ZXh0Lmxlbmd0
			aCsxfSk7cmV0dXJuIGluZGV4fSxzY3JvbGxUbzpmdW5jdGlvbih4LHkpe2lmKHghPW51bGwpc2Ny
			b2xsZXIuc2Nyb2xsTGVmdD14O2lmKHkhPW51bGwpc2Nyb2xsZXIuc2Nyb2xsVG9wPXk7dXBkYXRl
			RGlzcGxheShbXSl9LG9wZXJhdGlvbjpmdW5jdGlvbihmKXtyZXR1cm4gb3BlcmF0aW9uKGYpKCl9
			LHJlZnJlc2g6ZnVuY3Rpb24oKXt1cGRhdGVEaXNwbGF5KHRydWUpOyBpZihzY3JvbGxlci5zY3Jv
			bGxIZWlnaHQ+bGFzdFNjcm9sbFBvcylzY3JvbGxlci5zY3JvbGxUb3A9bGFzdFNjcm9sbFBvc30s
			Z2V0SW5wdXRGaWVsZDpmdW5jdGlvbigpe3JldHVybiBpbnB1dH0sZ2V0V3JhcHBlckVsZW1lbnQ6
			ZnVuY3Rpb24oKXtyZXR1cm4gd3JhcHBlcn0sZ2V0U2Nyb2xsZXJFbGVtZW50OmZ1bmN0aW9uKCl7
			cmV0dXJuIHNjcm9sbGVyfSxnZXRHdXR0ZXJFbGVtZW50OmZ1bmN0aW9uKCl7cmV0dXJuIGd1dHRl
			cn19O2Z1bmN0aW9uIGdldExpbmUobil7cmV0dXJuIGdldExpbmVBdChkb2Msbil9ZnVuY3Rpb24g
			dXBkYXRlTGluZUhlaWdodChsaW5lLGhlaWdodCl7Z3V0dGVyRGlydHk9dHJ1ZTt2YXIgZGlmZj1o
			ZWlnaHQtbGluZS5oZWlnaHQ7Zm9yKHZhciBuPWxpbmU7bjtuPW4ucGFyZW50KW4uaGVpZ2h0Kz1k
			aWZmfWZ1bmN0aW9uIHNldFZhbHVlKGNvZGUpe3ZhciB0b3A9e2xpbmU6MCxjaDowfTt1cGRhdGVM
			aW5lcyh0b3Ase2xpbmU6ZG9jLnNpemUtMSxjaDpnZXRMaW5lKGRvYy5zaXplLSAxKS50ZXh0Lmxl
			bmd0aH0sc3BsaXRMaW5lcyhjb2RlKSx0b3AsdG9wKTt1cGRhdGVJbnB1dD10cnVlfWZ1bmN0aW9u
			IGdldFZhbHVlKGNvZGUpe3ZhciB0ZXh0PVtdO2RvYy5pdGVyKDAsZG9jLnNpemUsZnVuY3Rpb24o
			bGluZSl7dGV4dC5wdXNoKGxpbmUudGV4dCl9KTtyZXR1cm4gdGV4dC5qb2luKCJcbiIpfWZ1bmN0
			aW9uIG9uTW91c2VEb3duKGUpe3NldFNoaWZ0KGVfcHJvcChlLCJzaGlmdEtleSIpKTtmb3IodmFy
			IG49ZV90YXJnZXQoZSk7biE9d3JhcHBlcjtuPW4ucGFyZW50Tm9kZSlpZihuLnBhcmVudE5vZGU9
			PWNvZGUmJm4hPW1vdmVyKXJldHVybjtmb3IodmFyIG49ZV90YXJnZXQoZSk7biE9d3JhcHBlcjtu
			PW4ucGFyZW50Tm9kZSlpZihuLnBhcmVudE5vZGU9PWd1dHRlclRleHQpe2lmKG9wdGlvbnMub25H
			dXR0ZXJDbGljaylvcHRpb25zLm9uR3V0dGVyQ2xpY2soaW5zdGFuY2UsaW5kZXhPZihndXR0ZXJU
			ZXh0LmNoaWxkTm9kZXMsbikrc2hvd2luZ0Zyb20sZSk7cmV0dXJuIGVfcHJldmVudERlZmF1bHQo
			ZSl9dmFyIHN0YXJ0PSBwb3NGcm9tTW91c2UoZSk7c3dpdGNoKGVfYnV0dG9uKGUpKXtjYXNlIDM6
			aWYoZ2Vja28mJiFtYWMpb25Db250ZXh0TWVudShlKTtyZXR1cm47Y2FzZSAyOmlmKHN0YXJ0KXNl
			dEN1cnNvcihzdGFydC5saW5lLHN0YXJ0LmNoLHRydWUpO3JldHVybn1pZighc3RhcnQpe2lmKGVf
			dGFyZ2V0KGUpPT1zY3JvbGxlcillX3ByZXZlbnREZWZhdWx0KGUpO3JldHVybn1pZighZm9jdXNl
			ZClvbkZvY3VzKCk7dmFyIG5vdz0rbmV3IERhdGU7aWYobGFzdERvdWJsZUNsaWNrJiZsYXN0RG91
			YmxlQ2xpY2sudGltZT5ub3ctNDAwJiZwb3NFcShsYXN0RG91YmxlQ2xpY2sucG9zLHN0YXJ0KSl7
			ZV9wcmV2ZW50RGVmYXVsdChlKTtzZXRUaW1lb3V0KGZvY3VzSW5wdXQsMjApO3JldHVybiBzZWxl
			Y3RMaW5lKHN0YXJ0LmxpbmUpfWVsc2UgaWYobGFzdENsaWNrJiZsYXN0Q2xpY2sudGltZT5ub3ct
			NDAwJiZwb3NFcShsYXN0Q2xpY2sucG9zLHN0YXJ0KSl7bGFzdERvdWJsZUNsaWNrPXt0aW1lOm5v
			dywgcG9zOnN0YXJ0fTtlX3ByZXZlbnREZWZhdWx0KGUpO3JldHVybiBzZWxlY3RXb3JkQXQoc3Rh
			cnQpfWVsc2UgbGFzdENsaWNrPXt0aW1lOm5vdyxwb3M6c3RhcnR9O3ZhciBsYXN0PXN0YXJ0LGdv
			aW5nO2lmKGRyYWdBbmREcm9wJiYhb3B0aW9ucy5yZWFkT25seSYmIXBvc0VxKHNlbC5mcm9tLHNl
			bC50bykmJiFwb3NMZXNzKHN0YXJ0LHNlbC5mcm9tKSYmIXBvc0xlc3Moc2VsLnRvLHN0YXJ0KSl7
			aWYod2Via2l0KWxpbmVTcGFjZS5kcmFnZ2FibGU9dHJ1ZTt2YXIgdXA9Y29ubmVjdCh0YXJnZXRE
			b2N1bWVudCwibW91c2V1cCIsb3BlcmF0aW9uKGZ1bmN0aW9uKGUyKXtpZih3ZWJraXQpbGluZVNw
			YWNlLmRyYWdnYWJsZT1mYWxzZTtkcmFnZ2luZ1RleHQ9ZmFsc2U7dXAoKTtpZihNYXRoLmFicyhl
			LmNsaWVudFgtZTIuY2xpZW50WCkrTWF0aC5hYnMoZS5jbGllbnRZLWUyLmNsaWVudFkpPDEwKXtl
			X3ByZXZlbnREZWZhdWx0KGUyKTtzZXRDdXJzb3Ioc3RhcnQubGluZSxzdGFydC5jaCwgdHJ1ZSk7
			Zm9jdXNJbnB1dCgpfX0pLHRydWUpO2RyYWdnaW5nVGV4dD10cnVlO3JldHVybn1lX3ByZXZlbnRE
			ZWZhdWx0KGUpO3NldEN1cnNvcihzdGFydC5saW5lLHN0YXJ0LmNoLHRydWUpO2Z1bmN0aW9uIGV4
			dGVuZChlKXt2YXIgY3VyPXBvc0Zyb21Nb3VzZShlLHRydWUpO2lmKGN1ciYmIXBvc0VxKGN1cixs
			YXN0KSl7aWYoIWZvY3VzZWQpb25Gb2N1cygpO2xhc3Q9Y3VyO3NldFNlbGVjdGlvblVzZXIoc3Rh
			cnQsY3VyKTt1cGRhdGVJbnB1dD1mYWxzZTt2YXIgdmlzaWJsZT12aXNpYmxlTGluZXMoKTtpZihj
			dXIubGluZT49dmlzaWJsZS50b3x8Y3VyLmxpbmU8dmlzaWJsZS5mcm9tKWdvaW5nPXNldFRpbWVv
			dXQob3BlcmF0aW9uKGZ1bmN0aW9uKCl7ZXh0ZW5kKGUpfSksMTUwKX19dmFyIG1vdmU9Y29ubmVj
			dCh0YXJnZXREb2N1bWVudCwibW91c2Vtb3ZlIixvcGVyYXRpb24oZnVuY3Rpb24oZSl7Y2xlYXJU
			aW1lb3V0KGdvaW5nKTtlX3ByZXZlbnREZWZhdWx0KGUpO2V4dGVuZChlKX0pLCB0cnVlKTt2YXIg
			dXA9Y29ubmVjdCh0YXJnZXREb2N1bWVudCwibW91c2V1cCIsb3BlcmF0aW9uKGZ1bmN0aW9uKGUp
			e2NsZWFyVGltZW91dChnb2luZyk7dmFyIGN1cj1wb3NGcm9tTW91c2UoZSk7aWYoY3VyKXNldFNl
			bGVjdGlvblVzZXIoc3RhcnQsY3VyKTtlX3ByZXZlbnREZWZhdWx0KGUpO2ZvY3VzSW5wdXQoKTt1
			cGRhdGVJbnB1dD10cnVlO21vdmUoKTt1cCgpfSksdHJ1ZSl9ZnVuY3Rpb24gb25Eb3VibGVDbGlj
			ayhlKXtmb3IodmFyIG49ZV90YXJnZXQoZSk7biE9d3JhcHBlcjtuPW4ucGFyZW50Tm9kZSlpZihu
			LnBhcmVudE5vZGU9PWd1dHRlclRleHQpcmV0dXJuIGVfcHJldmVudERlZmF1bHQoZSk7dmFyIHN0
			YXJ0PXBvc0Zyb21Nb3VzZShlKTtpZighc3RhcnQpcmV0dXJuO2xhc3REb3VibGVDbGljaz17dGlt
			ZTorbmV3IERhdGUscG9zOnN0YXJ0fTtlX3ByZXZlbnREZWZhdWx0KGUpO3NlbGVjdFdvcmRBdChz
			dGFydCl9ZnVuY3Rpb24gb25Ecm9wKGUpe2UucHJldmVudERlZmF1bHQoKTsgdmFyIHBvcz1wb3NG
			cm9tTW91c2UoZSx0cnVlKSxmaWxlcz1lLmRhdGFUcmFuc2Zlci5maWxlcztpZighcG9zfHxvcHRp
			b25zLnJlYWRPbmx5KXJldHVybjtpZihmaWxlcyYmZmlsZXMubGVuZ3RoJiZ3aW5kb3cuRmlsZVJl
			YWRlciYmd2luZG93LkZpbGUpe2Z1bmN0aW9uIGxvYWRGaWxlKGZpbGUsaSl7dmFyIHJlYWRlcj1u
			ZXcgRmlsZVJlYWRlcjtyZWFkZXIub25sb2FkPWZ1bmN0aW9uKCl7dGV4dFtpXT1yZWFkZXIucmVz
			dWx0O2lmKCsrcmVhZD09bil7cG9zPWNsaXBQb3MocG9zKTtvcGVyYXRpb24oZnVuY3Rpb24oKXt2
			YXIgZW5kPXJlcGxhY2VSYW5nZSh0ZXh0LmpvaW4oIiIpLHBvcyxwb3MpO3NldFNlbGVjdGlvblVz
			ZXIocG9zLGVuZCl9KSgpfX07cmVhZGVyLnJlYWRBc1RleHQoZmlsZSl9dmFyIG49ZmlsZXMubGVu
			Z3RoLHRleHQ9QXJyYXkobikscmVhZD0wO2Zvcih2YXIgaT0wO2k8bjsrK2kpbG9hZEZpbGUoZmls
			ZXNbaV0saSl9ZWxzZSB0cnl7dmFyIHRleHQ9ZS5kYXRhVHJhbnNmZXIuZ2V0RGF0YSgiVGV4dCIp
			OyBpZih0ZXh0KXt2YXIgY3VyRnJvbT1zZWwuZnJvbSxjdXJUbz1zZWwudG87c2V0U2VsZWN0aW9u
			VXNlcihwb3MscG9zKTtpZihkcmFnZ2luZ1RleHQpcmVwbGFjZVJhbmdlKCIiLGN1ckZyb20sY3Vy
			VG8pO3JlcGxhY2VTZWxlY3Rpb24odGV4dCk7Zm9jdXNJbnB1dCgpfX1jYXRjaChlKXt9fWZ1bmN0
			aW9uIG9uRHJhZ1N0YXJ0KGUpe3ZhciB0eHQ9Z2V0U2VsZWN0aW9uKCk7ZS5kYXRhVHJhbnNmZXIu
			c2V0RGF0YSgiVGV4dCIsdHh0KX1mdW5jdGlvbiBkb0hhbmRsZUJpbmRpbmcoYm91bmQsZHJvcFNo
			aWZ0KXtpZih0eXBlb2YgYm91bmQ9PSJzdHJpbmciKXtib3VuZD1jb21tYW5kc1tib3VuZF07aWYo
			IWJvdW5kKXJldHVybiBmYWxzZX12YXIgcHJldlNoaWZ0PXNoaWZ0U2VsZWN0aW5nO3RyeXtpZihv
			cHRpb25zLnJlYWRPbmx5KXN1cHByZXNzRWRpdHM9dHJ1ZTtpZihkcm9wU2hpZnQpc2hpZnRTZWxl
			Y3Rpbmc9bnVsbDtib3VuZChpbnN0YW5jZSl9Y2F0Y2goZSl7aWYoZSE9UGFzcyl0aHJvdyBlOyBy
			ZXR1cm4gZmFsc2V9ZmluYWxseXtzaGlmdFNlbGVjdGluZz1wcmV2U2hpZnQ7c3VwcHJlc3NFZGl0
			cz1mYWxzZX1yZXR1cm4gdHJ1ZX1mdW5jdGlvbiBoYW5kbGVLZXlCaW5kaW5nKGUpe3ZhciBzdGFy
			dE1hcD1nZXRLZXlNYXAob3B0aW9ucy5rZXlNYXApLG5leHQ9c3RhcnRNYXAuYXV0bztjbGVhclRp
			bWVvdXQobWF5YmVUcmFuc2l0aW9uKTtpZihuZXh0JiYhaXNNb2RpZmllcktleShlKSltYXliZVRy
			YW5zaXRpb249c2V0VGltZW91dChmdW5jdGlvbigpe2lmKGdldEtleU1hcChvcHRpb25zLmtleU1h
			cCk9PXN0YXJ0TWFwKW9wdGlvbnMua2V5TWFwPW5leHQuY2FsbD9uZXh0LmNhbGwobnVsbCxpbnN0
			YW5jZSk6bmV4dH0sNTApO3ZhciBuYW1lPWtleU5hbWVzW2VfcHJvcChlLCJrZXlDb2RlIildLGhh
			bmRsZWQ9ZmFsc2U7aWYobmFtZT09bnVsbHx8ZS5hbHRHcmFwaEtleSlyZXR1cm4gZmFsc2U7aWYo
			ZV9wcm9wKGUsImFsdEtleSIpKW5hbWU9IkFsdC0iK25hbWU7aWYoZV9wcm9wKGUsICJjdHJsS2V5
			IikpbmFtZT0iQ3RybC0iK25hbWU7aWYoZV9wcm9wKGUsIm1ldGFLZXkiKSluYW1lPSJDbWQtIitu
			YW1lO2lmKGVfcHJvcChlLCJzaGlmdEtleSIpKWhhbmRsZWQ9bG9va3VwS2V5KCJTaGlmdC0iK25h
			bWUsb3B0aW9ucy5leHRyYUtleXMsb3B0aW9ucy5rZXlNYXAsZnVuY3Rpb24oYil7cmV0dXJuIGRv
			SGFuZGxlQmluZGluZyhiLHRydWUpfSk7aWYoIWhhbmRsZWQpaGFuZGxlZD1sb29rdXBLZXkobmFt
			ZSxvcHRpb25zLmV4dHJhS2V5cyxvcHRpb25zLmtleU1hcCxkb0hhbmRsZUJpbmRpbmcpO2lmKGhh
			bmRsZWQpZV9wcmV2ZW50RGVmYXVsdChlKTtyZXR1cm4gaGFuZGxlZH1mdW5jdGlvbiBoYW5kbGVD
			aGFyQmluZGluZyhlLGNoKXt2YXIgaGFuZGxlZD1sb29rdXBLZXkoIiciK2NoKyInIixvcHRpb25z
			LmV4dHJhS2V5cyxvcHRpb25zLmtleU1hcCxkb0hhbmRsZUJpbmRpbmcpO2lmKGhhbmRsZWQpZV9w
			cmV2ZW50RGVmYXVsdChlKTtyZXR1cm4gaGFuZGxlZH12YXIgbGFzdFN0b3BwZWRLZXk9IG51bGws
			bWF5YmVUcmFuc2l0aW9uO2Z1bmN0aW9uIG9uS2V5RG93bihlKXtpZighZm9jdXNlZClvbkZvY3Vz
			KCk7aWYoaWUmJmUua2V5Q29kZT09MjcpZS5yZXR1cm5WYWx1ZT1mYWxzZTtpZihwb2xsaW5nRmFz
			dClpZihyZWFkSW5wdXQoKSlwb2xsaW5nRmFzdD1mYWxzZTtpZihvcHRpb25zLm9uS2V5RXZlbnQm
			Jm9wdGlvbnMub25LZXlFdmVudChpbnN0YW5jZSxhZGRTdG9wKGUpKSlyZXR1cm47dmFyIGNvZGU9
			ZV9wcm9wKGUsImtleUNvZGUiKTtzZXRTaGlmdChjb2RlPT0xNnx8ZV9wcm9wKGUsInNoaWZ0S2V5
			IikpO3ZhciBoYW5kbGVkPWhhbmRsZUtleUJpbmRpbmcoZSk7aWYod2luZG93Lm9wZXJhKXtsYXN0
			U3RvcHBlZEtleT1oYW5kbGVkP2NvZGU6bnVsbDtpZighaGFuZGxlZCYmY29kZT09ODgmJmVfcHJv
			cChlLG1hYz8ibWV0YUtleSI6ImN0cmxLZXkiKSlyZXBsYWNlU2VsZWN0aW9uKCIiKX19ZnVuY3Rp
			b24gb25LZXlQcmVzcyhlKXtpZihwb2xsaW5nRmFzdClyZWFkSW5wdXQoKTsgaWYob3B0aW9ucy5v
			bktleUV2ZW50JiZvcHRpb25zLm9uS2V5RXZlbnQoaW5zdGFuY2UsYWRkU3RvcChlKSkpcmV0dXJu
			O3ZhciBrZXlDb2RlPWVfcHJvcChlLCJrZXlDb2RlIiksY2hhckNvZGU9ZV9wcm9wKGUsImNoYXJD
			b2RlIik7aWYod2luZG93Lm9wZXJhJiZrZXlDb2RlPT1sYXN0U3RvcHBlZEtleSl7bGFzdFN0b3Bw
			ZWRLZXk9bnVsbDtlX3ByZXZlbnREZWZhdWx0KGUpO3JldHVybn1pZih3aW5kb3cub3BlcmEmJiFl
			LndoaWNoJiZoYW5kbGVLZXlCaW5kaW5nKGUpKXJldHVybjt2YXIgY2g9U3RyaW5nLmZyb21DaGFy
			Q29kZShjaGFyQ29kZT09bnVsbD9rZXlDb2RlOmNoYXJDb2RlKTtpZihvcHRpb25zLmVsZWN0cmlj
			Q2hhcnMmJm1vZGUuZWxlY3RyaWNDaGFycyYmb3B0aW9ucy5zbWFydEluZGVudCYmIW9wdGlvbnMu
			cmVhZE9ubHkpaWYobW9kZS5lbGVjdHJpY0NoYXJzLmluZGV4T2YoY2gpPi0xKXNldFRpbWVvdXQo
			b3BlcmF0aW9uKGZ1bmN0aW9uKCl7aW5kZW50TGluZShzZWwudG8ubGluZSwgInNtYXJ0Iil9KSw3
			NSk7aWYoaGFuZGxlQ2hhckJpbmRpbmcoZSxjaCkpcmV0dXJuO2Zhc3RQb2xsKCl9ZnVuY3Rpb24g
			b25LZXlVcChlKXtpZihvcHRpb25zLm9uS2V5RXZlbnQmJm9wdGlvbnMub25LZXlFdmVudChpbnN0
			YW5jZSxhZGRTdG9wKGUpKSlyZXR1cm47aWYoZV9wcm9wKGUsImtleUNvZGUiKT09MTYpc2hpZnRT
			ZWxlY3Rpbmc9bnVsbH1mdW5jdGlvbiBvbkZvY3VzKCl7aWYob3B0aW9ucy5yZWFkT25seT09Im5v
			Y3Vyc29yIilyZXR1cm47aWYoIWZvY3VzZWQpe2lmKG9wdGlvbnMub25Gb2N1cylvcHRpb25zLm9u
			Rm9jdXMoaW5zdGFuY2UpO2ZvY3VzZWQ9dHJ1ZTtpZih3cmFwcGVyLmNsYXNzTmFtZS5zZWFyY2go
			L1xiQ29kZU1pcnJvci1mb2N1c2VkXGIvKT09LTEpd3JhcHBlci5jbGFzc05hbWUrPSIgQ29kZU1p
			cnJvci1mb2N1c2VkIjtpZighbGVhdmVJbnB1dEFsb25lKXJlc2V0SW5wdXQodHJ1ZSl9c2xvd1Bv
			bGwoKTtyZXN0YXJ0QmxpbmsoKX1mdW5jdGlvbiBvbkJsdXIoKXtpZihmb2N1c2VkKXtpZihvcHRp
			b25zLm9uQmx1cilvcHRpb25zLm9uQmx1cihpbnN0YW5jZSk7IGZvY3VzZWQ9ZmFsc2U7aWYoYnJh
			Y2tldEhpZ2hsaWdodGVkKW9wZXJhdGlvbihmdW5jdGlvbigpe2lmKGJyYWNrZXRIaWdobGlnaHRl
			ZCl7YnJhY2tldEhpZ2hsaWdodGVkKCk7YnJhY2tldEhpZ2hsaWdodGVkPW51bGx9fSkoKTt3cmFw
			cGVyLmNsYXNzTmFtZT13cmFwcGVyLmNsYXNzTmFtZS5yZXBsYWNlKCIgQ29kZU1pcnJvci1mb2N1
			c2VkIiwiIil9Y2xlYXJJbnRlcnZhbChibGlua2VyKTtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7aWYo
			IWZvY3VzZWQpc2hpZnRTZWxlY3Rpbmc9bnVsbH0sMTUwKX1mdW5jdGlvbiB1cGRhdGVMaW5lcyhm
			cm9tLHRvLG5ld1RleHQsc2VsRnJvbSxzZWxUbyl7aWYoc3VwcHJlc3NFZGl0cylyZXR1cm47aWYo
			aGlzdG9yeSl7dmFyIG9sZD1bXTtkb2MuaXRlcihmcm9tLmxpbmUsdG8ubGluZSsxLGZ1bmN0aW9u
			KGxpbmUpe29sZC5wdXNoKGxpbmUudGV4dCl9KTtoaXN0b3J5LmFkZENoYW5nZShmcm9tLmxpbmUs
			bmV3VGV4dC5sZW5ndGgsb2xkKTt3aGlsZShoaXN0b3J5LmRvbmUubGVuZ3RoPiBvcHRpb25zLnVu
			ZG9EZXB0aCloaXN0b3J5LmRvbmUuc2hpZnQoKX11cGRhdGVMaW5lc05vVW5kbyhmcm9tLHRvLG5l
			d1RleHQsc2VsRnJvbSxzZWxUbyl9ZnVuY3Rpb24gdW5yZWRvSGVscGVyKGZyb20sdG8pe2lmKCFm
			cm9tLmxlbmd0aClyZXR1cm47dmFyIHNldD1mcm9tLnBvcCgpLG91dD1bXTtmb3IodmFyIGk9c2V0
			Lmxlbmd0aC0xO2k+PTA7aS09MSl7dmFyIGNoYW5nZT1zZXRbaV07dmFyIHJlcGxhY2VkPVtdLGVu
			ZD1jaGFuZ2Uuc3RhcnQrY2hhbmdlLmFkZGVkO2RvYy5pdGVyKGNoYW5nZS5zdGFydCxlbmQsZnVu
			Y3Rpb24obGluZSl7cmVwbGFjZWQucHVzaChsaW5lLnRleHQpfSk7b3V0LnB1c2goe3N0YXJ0OmNo
			YW5nZS5zdGFydCxhZGRlZDpjaGFuZ2Uub2xkLmxlbmd0aCxvbGQ6cmVwbGFjZWR9KTt2YXIgcG9z
			PWNsaXBQb3Moe2xpbmU6Y2hhbmdlLnN0YXJ0K2NoYW5nZS5vbGQubGVuZ3RoLTEsY2g6ZWRpdEVu
			ZChyZXBsYWNlZFtyZXBsYWNlZC5sZW5ndGgtMV0sY2hhbmdlLm9sZFtjaGFuZ2Uub2xkLmxlbmd0
			aC0gMV0pfSk7dXBkYXRlTGluZXNOb1VuZG8oe2xpbmU6Y2hhbmdlLnN0YXJ0LGNoOjB9LHtsaW5l
			OmVuZC0xLGNoOmdldExpbmUoZW5kLTEpLnRleHQubGVuZ3RofSxjaGFuZ2Uub2xkLHBvcyxwb3Mp
			fXVwZGF0ZUlucHV0PXRydWU7dG8ucHVzaChvdXQpfWZ1bmN0aW9uIHVuZG8oKXt1bnJlZG9IZWxw
			ZXIoaGlzdG9yeS5kb25lLGhpc3RvcnkudW5kb25lKX1mdW5jdGlvbiByZWRvKCl7dW5yZWRvSGVs
			cGVyKGhpc3RvcnkudW5kb25lLGhpc3RvcnkuZG9uZSl9ZnVuY3Rpb24gdXBkYXRlTGluZXNOb1Vu
			ZG8oZnJvbSx0byxuZXdUZXh0LHNlbEZyb20sc2VsVG8pe2lmKHN1cHByZXNzRWRpdHMpcmV0dXJu
			O3ZhciByZWNvbXB1dGVNYXhMZW5ndGg9ZmFsc2UsbWF4TGluZUxlbmd0aD1tYXhMaW5lLmxlbmd0
			aDtpZighb3B0aW9ucy5saW5lV3JhcHBpbmcpZG9jLml0ZXIoZnJvbS5saW5lLHRvLmxpbmUsZnVu
			Y3Rpb24obGluZSl7aWYobGluZS50ZXh0Lmxlbmd0aD09bWF4TGluZUxlbmd0aCl7cmVjb21wdXRl
			TWF4TGVuZ3RoPSB0cnVlO3JldHVybiB0cnVlfX0pO2lmKGZyb20ubGluZSE9dG8ubGluZXx8bmV3
			VGV4dC5sZW5ndGg+MSlndXR0ZXJEaXJ0eT10cnVlO3ZhciBubGluZXM9dG8ubGluZS1mcm9tLmxp
			bmUsZmlyc3RMaW5lPWdldExpbmUoZnJvbS5saW5lKSxsYXN0TGluZT1nZXRMaW5lKHRvLmxpbmUp
			O2lmKGZyb20uY2g9PTAmJnRvLmNoPT0wJiZuZXdUZXh0W25ld1RleHQubGVuZ3RoLTFdPT0iIil7
			dmFyIGFkZGVkPVtdLHByZXZMaW5lPW51bGw7aWYoZnJvbS5saW5lKXtwcmV2TGluZT1nZXRMaW5l
			KGZyb20ubGluZS0xKTtwcmV2TGluZS5maXhNYXJrRW5kcyhsYXN0TGluZSl9ZWxzZSBsYXN0TGlu
			ZS5maXhNYXJrU3RhcnRzKCk7Zm9yKHZhciBpPTAsZT1uZXdUZXh0Lmxlbmd0aC0xO2k8ZTsrK2kp
			YWRkZWQucHVzaChMaW5lLmluaGVyaXRNYXJrcyhuZXdUZXh0W2ldLHByZXZMaW5lKSk7aWYobmxp
			bmVzKWRvYy5yZW1vdmUoZnJvbS5saW5lLG5saW5lcyxjYWxsYmFja3MpO2lmKGFkZGVkLmxlbmd0
			aClkb2MuaW5zZXJ0KGZyb20ubGluZSwgYWRkZWQpfWVsc2UgaWYoZmlyc3RMaW5lPT1sYXN0TGlu
			ZSlpZihuZXdUZXh0Lmxlbmd0aD09MSlmaXJzdExpbmUucmVwbGFjZShmcm9tLmNoLHRvLmNoLG5l
			d1RleHRbMF0pO2Vsc2V7bGFzdExpbmU9Zmlyc3RMaW5lLnNwbGl0KHRvLmNoLG5ld1RleHRbbmV3
			VGV4dC5sZW5ndGgtMV0pO2ZpcnN0TGluZS5yZXBsYWNlKGZyb20uY2gsbnVsbCxuZXdUZXh0WzBd
			KTtmaXJzdExpbmUuZml4TWFya0VuZHMobGFzdExpbmUpO3ZhciBhZGRlZD1bXTtmb3IodmFyIGk9
			MSxlPW5ld1RleHQubGVuZ3RoLTE7aTxlOysraSlhZGRlZC5wdXNoKExpbmUuaW5oZXJpdE1hcmtz
			KG5ld1RleHRbaV0sZmlyc3RMaW5lKSk7YWRkZWQucHVzaChsYXN0TGluZSk7ZG9jLmluc2VydChm
			cm9tLmxpbmUrMSxhZGRlZCl9ZWxzZSBpZihuZXdUZXh0Lmxlbmd0aD09MSl7Zmlyc3RMaW5lLnJl
			cGxhY2UoZnJvbS5jaCxudWxsLG5ld1RleHRbMF0pO2xhc3RMaW5lLnJlcGxhY2UobnVsbCx0by5j
			aCwiIik7Zmlyc3RMaW5lLmFwcGVuZChsYXN0TGluZSk7IGRvYy5yZW1vdmUoZnJvbS5saW5lKzEs
			bmxpbmVzLGNhbGxiYWNrcyl9ZWxzZXt2YXIgYWRkZWQ9W107Zmlyc3RMaW5lLnJlcGxhY2UoZnJv
			bS5jaCxudWxsLG5ld1RleHRbMF0pO2xhc3RMaW5lLnJlcGxhY2UobnVsbCx0by5jaCxuZXdUZXh0
			W25ld1RleHQubGVuZ3RoLTFdKTtmaXJzdExpbmUuZml4TWFya0VuZHMobGFzdExpbmUpO2Zvcih2
			YXIgaT0xLGU9bmV3VGV4dC5sZW5ndGgtMTtpPGU7KytpKWFkZGVkLnB1c2goTGluZS5pbmhlcml0
			TWFya3MobmV3VGV4dFtpXSxmaXJzdExpbmUpKTtpZihubGluZXM+MSlkb2MucmVtb3ZlKGZyb20u
			bGluZSsxLG5saW5lcy0xLGNhbGxiYWNrcyk7ZG9jLmluc2VydChmcm9tLmxpbmUrMSxhZGRlZCl9
			aWYob3B0aW9ucy5saW5lV3JhcHBpbmcpe3ZhciBwZXJMaW5lPXNjcm9sbGVyLmNsaWVudFdpZHRo
			L2NoYXJXaWR0aCgpLTM7ZG9jLml0ZXIoZnJvbS5saW5lLGZyb20ubGluZStuZXdUZXh0Lmxlbmd0
			aCxmdW5jdGlvbihsaW5lKXtpZihsaW5lLmhpZGRlbilyZXR1cm47IHZhciBndWVzcz1NYXRoLmNl
			aWwobGluZS50ZXh0Lmxlbmd0aC9wZXJMaW5lKXx8MTtpZihndWVzcyE9bGluZS5oZWlnaHQpdXBk
			YXRlTGluZUhlaWdodChsaW5lLGd1ZXNzKX0pfWVsc2V7ZG9jLml0ZXIoZnJvbS5saW5lLGkrbmV3
			VGV4dC5sZW5ndGgsZnVuY3Rpb24obGluZSl7dmFyIGw9bGluZS50ZXh0O2lmKGwubGVuZ3RoPm1h
			eExpbmVMZW5ndGgpe21heExpbmU9bDttYXhMaW5lTGVuZ3RoPWwubGVuZ3RoO21heFdpZHRoPW51
			bGw7cmVjb21wdXRlTWF4TGVuZ3RoPWZhbHNlfX0pO2lmKHJlY29tcHV0ZU1heExlbmd0aCl7bWF4
			TGluZUxlbmd0aD0wO21heExpbmU9IiI7bWF4V2lkdGg9bnVsbDtkb2MuaXRlcigwLGRvYy5zaXpl
			LGZ1bmN0aW9uKGxpbmUpe3ZhciBsPWxpbmUudGV4dDtpZihsLmxlbmd0aD5tYXhMaW5lTGVuZ3Ro
			KXttYXhMaW5lTGVuZ3RoPWwubGVuZ3RoO21heExpbmU9bH19KX19dmFyIG5ld1dvcms9W10sbGVu
			ZGlmZj1uZXdUZXh0Lmxlbmd0aC1ubGluZXMtMTsgZm9yKHZhciBpPTAsbD13b3JrLmxlbmd0aDtp
			PGw7KytpKXt2YXIgdGFzaz13b3JrW2ldO2lmKHRhc2s8ZnJvbS5saW5lKW5ld1dvcmsucHVzaCh0
			YXNrKTtlbHNlIGlmKHRhc2s+dG8ubGluZSluZXdXb3JrLnB1c2godGFzaytsZW5kaWZmKX12YXIg
			aGxFbmQ9ZnJvbS5saW5lK01hdGgubWluKG5ld1RleHQubGVuZ3RoLDUwMCk7aGlnaGxpZ2h0TGlu
			ZXMoZnJvbS5saW5lLGhsRW5kKTtuZXdXb3JrLnB1c2goaGxFbmQpO3dvcms9bmV3V29yaztzdGFy
			dFdvcmtlcigxMDApO2NoYW5nZXMucHVzaCh7ZnJvbTpmcm9tLmxpbmUsdG86dG8ubGluZSsxLGRp
			ZmY6bGVuZGlmZn0pO3ZhciBjaGFuZ2VPYmo9e2Zyb206ZnJvbSx0bzp0byx0ZXh0Om5ld1RleHR9
			O2lmKHRleHRDaGFuZ2VkKXtmb3IodmFyIGN1cj10ZXh0Q2hhbmdlZDtjdXIubmV4dDtjdXI9Y3Vy
			Lm5leHQpO2N1ci5uZXh0PWNoYW5nZU9ian1lbHNlIHRleHRDaGFuZ2VkPWNoYW5nZU9iajtmdW5j
			dGlvbiB1cGRhdGVMaW5lKG4pe3JldHVybiBuPD0gTWF0aC5taW4odG8ubGluZSx0by5saW5lK2xl
			bmRpZmYpP246bitsZW5kaWZmfXNldFNlbGVjdGlvbihzZWxGcm9tLHNlbFRvLHVwZGF0ZUxpbmUo
			c2VsLmZyb20ubGluZSksdXBkYXRlTGluZShzZWwudG8ubGluZSkpO2lmKHNjcm9sbGVyLmNsaWVu
			dEhlaWdodCljb2RlLnN0eWxlLmhlaWdodD1kb2MuaGVpZ2h0KnRleHRIZWlnaHQoKSsyKnBhZGRp
			bmdUb3AoKSsicHgifWZ1bmN0aW9uIHJlcGxhY2VSYW5nZShjb2RlLGZyb20sdG8pe2Zyb209Y2xp
			cFBvcyhmcm9tKTtpZighdG8pdG89ZnJvbTtlbHNlIHRvPWNsaXBQb3ModG8pO2NvZGU9c3BsaXRM
			aW5lcyhjb2RlKTtmdW5jdGlvbiBhZGp1c3RQb3MocG9zKXtpZihwb3NMZXNzKHBvcyxmcm9tKSly
			ZXR1cm4gcG9zO2lmKCFwb3NMZXNzKHRvLHBvcykpcmV0dXJuIGVuZDt2YXIgbGluZT1wb3MubGlu
			ZStjb2RlLmxlbmd0aC0odG8ubGluZS1mcm9tLmxpbmUpLTE7dmFyIGNoPXBvcy5jaDtpZihwb3Mu
			bGluZT09dG8ubGluZSljaCs9IGNvZGVbY29kZS5sZW5ndGgtMV0ubGVuZ3RoLSh0by5jaC0odG8u
			bGluZT09ZnJvbS5saW5lP2Zyb20uY2g6MCkpO3JldHVybntsaW5lOmxpbmUsY2g6Y2h9fXZhciBl
			bmQ7cmVwbGFjZVJhbmdlMShjb2RlLGZyb20sdG8sZnVuY3Rpb24oZW5kMSl7ZW5kPWVuZDE7cmV0
			dXJue2Zyb206YWRqdXN0UG9zKHNlbC5mcm9tKSx0bzphZGp1c3RQb3Moc2VsLnRvKX19KTtyZXR1
			cm4gZW5kfWZ1bmN0aW9uIHJlcGxhY2VTZWxlY3Rpb24oY29kZSxjb2xsYXBzZSl7cmVwbGFjZVJh
			bmdlMShzcGxpdExpbmVzKGNvZGUpLHNlbC5mcm9tLHNlbC50byxmdW5jdGlvbihlbmQpe2lmKGNv
			bGxhcHNlPT0iZW5kIilyZXR1cm57ZnJvbTplbmQsdG86ZW5kfTtlbHNlIGlmKGNvbGxhcHNlPT0i
			c3RhcnQiKXJldHVybntmcm9tOnNlbC5mcm9tLHRvOnNlbC5mcm9tfTtlbHNlIHJldHVybntmcm9t
			OnNlbC5mcm9tLHRvOmVuZH19KX1mdW5jdGlvbiByZXBsYWNlUmFuZ2UxKGNvZGUsZnJvbSx0byxj
			b21wdXRlU2VsKXt2YXIgZW5kY2g9IGNvZGUubGVuZ3RoPT0xP2NvZGVbMF0ubGVuZ3RoK2Zyb20u
			Y2g6Y29kZVtjb2RlLmxlbmd0aC0xXS5sZW5ndGg7dmFyIG5ld1NlbD1jb21wdXRlU2VsKHtsaW5l
			OmZyb20ubGluZStjb2RlLmxlbmd0aC0xLGNoOmVuZGNofSk7dXBkYXRlTGluZXMoZnJvbSx0byxj
			b2RlLG5ld1NlbC5mcm9tLG5ld1NlbC50byl9ZnVuY3Rpb24gZ2V0UmFuZ2UoZnJvbSx0byl7dmFy
			IGwxPWZyb20ubGluZSxsMj10by5saW5lO2lmKGwxPT1sMilyZXR1cm4gZ2V0TGluZShsMSkudGV4
			dC5zbGljZShmcm9tLmNoLHRvLmNoKTt2YXIgY29kZT1bZ2V0TGluZShsMSkudGV4dC5zbGljZShm
			cm9tLmNoKV07ZG9jLml0ZXIobDErMSxsMixmdW5jdGlvbihsaW5lKXtjb2RlLnB1c2gobGluZS50
			ZXh0KX0pO2NvZGUucHVzaChnZXRMaW5lKGwyKS50ZXh0LnNsaWNlKDAsdG8uY2gpKTtyZXR1cm4g
			Y29kZS5qb2luKCJcbiIpfWZ1bmN0aW9uIGdldFNlbGVjdGlvbigpe3JldHVybiBnZXRSYW5nZShz
			ZWwuZnJvbSxzZWwudG8pfSB2YXIgcG9sbGluZ0Zhc3Q9ZmFsc2U7ZnVuY3Rpb24gc2xvd1BvbGwo
			KXtpZihwb2xsaW5nRmFzdClyZXR1cm47cG9sbC5zZXQob3B0aW9ucy5wb2xsSW50ZXJ2YWwsZnVu
			Y3Rpb24oKXtzdGFydE9wZXJhdGlvbigpO3JlYWRJbnB1dCgpO2lmKGZvY3VzZWQpc2xvd1BvbGwo
			KTtlbmRPcGVyYXRpb24oKX0pfWZ1bmN0aW9uIGZhc3RQb2xsKCl7dmFyIG1pc3NlZD1mYWxzZTtw
			b2xsaW5nRmFzdD10cnVlO2Z1bmN0aW9uIHAoKXtzdGFydE9wZXJhdGlvbigpO3ZhciBjaGFuZ2Vk
			PXJlYWRJbnB1dCgpO2lmKCFjaGFuZ2VkJiYhbWlzc2VkKXttaXNzZWQ9dHJ1ZTtwb2xsLnNldCg2
			MCxwKX1lbHNle3BvbGxpbmdGYXN0PWZhbHNlO3Nsb3dQb2xsKCl9ZW5kT3BlcmF0aW9uKCl9cG9s
			bC5zZXQoMjAscCl9dmFyIHByZXZJbnB1dD0iIjtmdW5jdGlvbiByZWFkSW5wdXQoKXtpZihsZWF2
			ZUlucHV0QWxvbmV8fCFmb2N1c2VkfHxoYXNTZWxlY3Rpb24oaW5wdXQpfHxvcHRpb25zLnJlYWRP
			bmx5KXJldHVybiBmYWxzZTsgdmFyIHRleHQ9aW5wdXQudmFsdWU7aWYodGV4dD09cHJldklucHV0
			KXJldHVybiBmYWxzZTtzaGlmdFNlbGVjdGluZz1udWxsO3ZhciBzYW1lPTAsbD1NYXRoLm1pbihw
			cmV2SW5wdXQubGVuZ3RoLHRleHQubGVuZ3RoKTt3aGlsZShzYW1lPGwmJnByZXZJbnB1dFtzYW1l
			XT09dGV4dFtzYW1lXSkrK3NhbWU7aWYoc2FtZTxwcmV2SW5wdXQubGVuZ3RoKXNlbC5mcm9tPXts
			aW5lOnNlbC5mcm9tLmxpbmUsY2g6c2VsLmZyb20uY2gtKHByZXZJbnB1dC5sZW5ndGgtc2FtZSl9
			O2Vsc2UgaWYob3ZlcndyaXRlJiZwb3NFcShzZWwuZnJvbSxzZWwudG8pKXNlbC50bz17bGluZTpz
			ZWwudG8ubGluZSxjaDpNYXRoLm1pbihnZXRMaW5lKHNlbC50by5saW5lKS50ZXh0Lmxlbmd0aCxz
			ZWwudG8uY2grKHRleHQubGVuZ3RoLXNhbWUpKX07cmVwbGFjZVNlbGVjdGlvbih0ZXh0LnNsaWNl
			KHNhbWUpLCJlbmQiKTtwcmV2SW5wdXQ9dGV4dDtyZXR1cm4gdHJ1ZX1mdW5jdGlvbiByZXNldElu
			cHV0KHVzZXIpe2lmKCFwb3NFcShzZWwuZnJvbSwgc2VsLnRvKSl7cHJldklucHV0PSIiO2lucHV0
			LnZhbHVlPWdldFNlbGVjdGlvbigpO3NlbGVjdElucHV0KGlucHV0KX1lbHNlIGlmKHVzZXIpcHJl
			dklucHV0PWlucHV0LnZhbHVlPSIifWZ1bmN0aW9uIGZvY3VzSW5wdXQoKXtpZihvcHRpb25zLnJl
			YWRPbmx5IT0ibm9jdXJzb3IiKWlucHV0LmZvY3VzKCl9ZnVuY3Rpb24gc2Nyb2xsRWRpdG9ySW50
			b1ZpZXcoKXtpZighY3Vyc29yLmdldEJvdW5kaW5nQ2xpZW50UmVjdClyZXR1cm47dmFyIHJlY3Q9
			Y3Vyc29yLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO2lmKGllJiZyZWN0LnRvcD09cmVjdC5ib3R0
			b20pcmV0dXJuO3ZhciB3aW5IPXdpbmRvdy5pbm5lckhlaWdodHx8TWF0aC5tYXgoZG9jdW1lbnQu
			Ym9keS5vZmZzZXRIZWlnaHQsZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Lm9mZnNldEhlaWdodCk7
			aWYocmVjdC50b3A8MHx8cmVjdC5ib3R0b20+d2luSCljdXJzb3Iuc2Nyb2xsSW50b1ZpZXcoKX1m
			dW5jdGlvbiBzY3JvbGxDdXJzb3JJbnRvVmlldygpe3ZhciBjdXJzb3I9IGxvY2FsQ29vcmRzKHNl
			bC5pbnZlcnRlZD9zZWwuZnJvbTpzZWwudG8pO3ZhciB4PW9wdGlvbnMubGluZVdyYXBwaW5nP01h
			dGgubWluKGN1cnNvci54LGxpbmVTcGFjZS5vZmZzZXRXaWR0aCk6Y3Vyc29yLng7cmV0dXJuIHNj
			cm9sbEludG9WaWV3KHgsY3Vyc29yLnkseCxjdXJzb3IueUJvdCl9ZnVuY3Rpb24gc2Nyb2xsSW50
			b1ZpZXcoeDEseTEseDIseTIpe3ZhciBwbD1wYWRkaW5nTGVmdCgpLHB0PXBhZGRpbmdUb3AoKSxs
			aD10ZXh0SGVpZ2h0KCk7eTErPXB0O3kyKz1wdDt4MSs9cGw7eDIrPXBsO3ZhciBzY3JlZW49c2Ny
			b2xsZXIuY2xpZW50SGVpZ2h0LHNjcmVlbnRvcD1zY3JvbGxlci5zY3JvbGxUb3Asc2Nyb2xsZWQ9
			ZmFsc2UscmVzdWx0PXRydWU7aWYoeTE8c2NyZWVudG9wKXtzY3JvbGxlci5zY3JvbGxUb3A9TWF0
			aC5tYXgoMCx5MS0yKmxoKTtzY3JvbGxlZD10cnVlfWVsc2UgaWYoeTI+c2NyZWVudG9wK3NjcmVl
			bil7c2Nyb2xsZXIuc2Nyb2xsVG9wPXkyK2xoLXNjcmVlbjsgc2Nyb2xsZWQ9dHJ1ZX12YXIgc2Ny
			ZWVudz1zY3JvbGxlci5jbGllbnRXaWR0aCxzY3JlZW5sZWZ0PXNjcm9sbGVyLnNjcm9sbExlZnQ7
			dmFyIGd1dHRlcnc9b3B0aW9ucy5maXhlZEd1dHRlcj9ndXR0ZXIuY2xpZW50V2lkdGg6MDtpZih4
			MTxzY3JlZW5sZWZ0K2d1dHRlcncpe2lmKHgxPDUwKXgxPTA7c2Nyb2xsZXIuc2Nyb2xsTGVmdD1N
			YXRoLm1heCgwLHgxLTEwLWd1dHRlcncpO3Njcm9sbGVkPXRydWV9ZWxzZSBpZih4Mj5zY3JlZW53
			K3NjcmVlbmxlZnQtMyl7c2Nyb2xsZXIuc2Nyb2xsTGVmdD14MisxMC1zY3JlZW53O3Njcm9sbGVk
			PXRydWU7aWYoeDI+Y29kZS5jbGllbnRXaWR0aClyZXN1bHQ9ZmFsc2V9aWYoc2Nyb2xsZWQmJm9w
			dGlvbnMub25TY3JvbGwpb3B0aW9ucy5vblNjcm9sbChpbnN0YW5jZSk7cmV0dXJuIHJlc3VsdH1m
			dW5jdGlvbiB2aXNpYmxlTGluZXMoKXt2YXIgbGg9dGV4dEhlaWdodCgpLHRvcD1zY3JvbGxlci5z
			Y3JvbGxUb3AtcGFkZGluZ1RvcCgpO3ZhciBmcm9tX2hlaWdodD0gTWF0aC5tYXgoMCxNYXRoLmZs
			b29yKHRvcC9saCkpO3ZhciB0b19oZWlnaHQ9TWF0aC5jZWlsKCh0b3Arc2Nyb2xsZXIuY2xpZW50
			SGVpZ2h0KS9saCk7cmV0dXJue2Zyb206bGluZUF0SGVpZ2h0KGRvYyxmcm9tX2hlaWdodCksdG86
			bGluZUF0SGVpZ2h0KGRvYyx0b19oZWlnaHQpfX1mdW5jdGlvbiB1cGRhdGVEaXNwbGF5KGNoYW5n
			ZXMsc3VwcHJlc3NDYWxsYmFjayl7aWYoIXNjcm9sbGVyLmNsaWVudFdpZHRoKXtzaG93aW5nRnJv
			bT1zaG93aW5nVG89ZGlzcGxheU9mZnNldD0wO3JldHVybn12YXIgdmlzaWJsZT12aXNpYmxlTGlu
			ZXMoKTtpZihjaGFuZ2VzIT09dHJ1ZSYmY2hhbmdlcy5sZW5ndGg9PTAmJnZpc2libGUuZnJvbT5z
			aG93aW5nRnJvbSYmdmlzaWJsZS50bzxzaG93aW5nVG8pcmV0dXJuO3ZhciBmcm9tPU1hdGgubWF4
			KHZpc2libGUuZnJvbS0xMDAsMCksdG89TWF0aC5taW4oZG9jLnNpemUsdmlzaWJsZS50bysxMDAp
			O2lmKHNob3dpbmdGcm9tPGZyb20mJmZyb20tIHNob3dpbmdGcm9tPDIwKWZyb209c2hvd2luZ0Zy
			b207aWYoc2hvd2luZ1RvPnRvJiZzaG93aW5nVG8tdG88MjApdG89TWF0aC5taW4oZG9jLnNpemUs
			c2hvd2luZ1RvKTt2YXIgaW50YWN0PWNoYW5nZXM9PT10cnVlP1tdOmNvbXB1dGVJbnRhY3QoW3tm
			cm9tOnNob3dpbmdGcm9tLHRvOnNob3dpbmdUbyxkb21TdGFydDowfV0sY2hhbmdlcyk7dmFyIGlu
			dGFjdExpbmVzPTA7Zm9yKHZhciBpPTA7aTxpbnRhY3QubGVuZ3RoOysraSl7dmFyIHJhbmdlPWlu
			dGFjdFtpXTtpZihyYW5nZS5mcm9tPGZyb20pe3JhbmdlLmRvbVN0YXJ0Kz1mcm9tLXJhbmdlLmZy
			b207cmFuZ2UuZnJvbT1mcm9tfWlmKHJhbmdlLnRvPnRvKXJhbmdlLnRvPXRvO2lmKHJhbmdlLmZy
			b20+PXJhbmdlLnRvKWludGFjdC5zcGxpY2UoaS0tLDEpO2Vsc2UgaW50YWN0TGluZXMrPXJhbmdl
			LnRvLXJhbmdlLmZyb219aWYoaW50YWN0TGluZXM9PXRvLWZyb20pcmV0dXJuO2ludGFjdC5zb3J0
			KGZ1bmN0aW9uKGEsYil7cmV0dXJuIGEuZG9tU3RhcnQtIGIuZG9tU3RhcnR9KTt2YXIgdGg9dGV4
			dEhlaWdodCgpLGd1dHRlckRpc3BsYXk9Z3V0dGVyLnN0eWxlLmRpc3BsYXk7bGluZURpdi5zdHls
			ZS5kaXNwbGF5PSJub25lIjtwYXRjaERpc3BsYXkoZnJvbSx0byxpbnRhY3QpO2xpbmVEaXYuc3R5
			bGUuZGlzcGxheT1ndXR0ZXIuc3R5bGUuZGlzcGxheT0iIjt2YXIgZGlmZmVyZW50PWZyb20hPXNo
			b3dpbmdGcm9tfHx0byE9c2hvd2luZ1RvfHxsYXN0U2l6ZUMhPXNjcm9sbGVyLmNsaWVudEhlaWdo
			dCt0aDtpZihkaWZmZXJlbnQpbGFzdFNpemVDPXNjcm9sbGVyLmNsaWVudEhlaWdodCt0aDtzaG93
			aW5nRnJvbT1mcm9tO3Nob3dpbmdUbz10bztkaXNwbGF5T2Zmc2V0PWhlaWdodEF0TGluZShkb2Ms
			ZnJvbSk7bW92ZXIuc3R5bGUudG9wPWRpc3BsYXlPZmZzZXQqdGgrInB4IjtpZihzY3JvbGxlci5j
			bGllbnRIZWlnaHQpY29kZS5zdHlsZS5oZWlnaHQ9ZG9jLmhlaWdodCp0aCsyKnBhZGRpbmdUb3Ao
			KSsicHgiO2lmKGxpbmVEaXYuY2hpbGROb2Rlcy5sZW5ndGghPSBzaG93aW5nVG8tc2hvd2luZ0Zy
			b20pdGhyb3cgbmV3IEVycm9yKCJCQUQgUEFUQ0ghICIrSlNPTi5zdHJpbmdpZnkoaW50YWN0KSsi
			IHNpemU9Iisoc2hvd2luZ1RvLXNob3dpbmdGcm9tKSsiIG5vZGVzPSIrbGluZURpdi5jaGlsZE5v
			ZGVzLmxlbmd0aCk7aWYob3B0aW9ucy5saW5lV3JhcHBpbmcpe21heFdpZHRoPXNjcm9sbGVyLmNs
			aWVudFdpZHRoO3ZhciBjdXJOb2RlPWxpbmVEaXYuZmlyc3RDaGlsZCxoZWlnaHRDaGFuZ2VkPWZh
			bHNlO2RvYy5pdGVyKHNob3dpbmdGcm9tLHNob3dpbmdUbyxmdW5jdGlvbihsaW5lKXtpZighbGlu
			ZS5oaWRkZW4pe3ZhciBoZWlnaHQ9TWF0aC5yb3VuZChjdXJOb2RlLm9mZnNldEhlaWdodC90aCl8
			fDE7aWYobGluZS5oZWlnaHQhPWhlaWdodCl7dXBkYXRlTGluZUhlaWdodChsaW5lLGhlaWdodCk7
			Z3V0dGVyRGlydHk9aGVpZ2h0Q2hhbmdlZD10cnVlfX1jdXJOb2RlPWN1ck5vZGUubmV4dFNpYmxp
			bmd9KTtpZihoZWlnaHRDaGFuZ2VkKWNvZGUuc3R5bGUuaGVpZ2h0PSBkb2MuaGVpZ2h0KnRoKzIq
			cGFkZGluZ1RvcCgpKyJweCJ9ZWxzZXtpZihtYXhXaWR0aD09bnVsbCltYXhXaWR0aD1zdHJpbmdX
			aWR0aChtYXhMaW5lKTtpZihtYXhXaWR0aD5zY3JvbGxlci5jbGllbnRXaWR0aCl7bGluZVNwYWNl
			LnN0eWxlLndpZHRoPW1heFdpZHRoKyJweCI7Y29kZS5zdHlsZS53aWR0aD0iIjtjb2RlLnN0eWxl
			LndpZHRoPXNjcm9sbGVyLnNjcm9sbFdpZHRoKyJweCJ9ZWxzZSBsaW5lU3BhY2Uuc3R5bGUud2lk
			dGg9Y29kZS5zdHlsZS53aWR0aD0iIn1ndXR0ZXIuc3R5bGUuZGlzcGxheT1ndXR0ZXJEaXNwbGF5
			O2lmKGRpZmZlcmVudHx8Z3V0dGVyRGlydHkpdXBkYXRlR3V0dGVyKCk7dXBkYXRlU2VsZWN0aW9u
			KCk7aWYoIXN1cHByZXNzQ2FsbGJhY2smJm9wdGlvbnMub25VcGRhdGUpb3B0aW9ucy5vblVwZGF0
			ZShpbnN0YW5jZSk7cmV0dXJuIHRydWV9ZnVuY3Rpb24gY29tcHV0ZUludGFjdChpbnRhY3QsY2hh
			bmdlcyl7Zm9yKHZhciBpPTAsbD1jaGFuZ2VzLmxlbmd0aHx8IDA7aTxsOysraSl7dmFyIGNoYW5n
			ZT1jaGFuZ2VzW2ldLGludGFjdDI9W10sZGlmZj1jaGFuZ2UuZGlmZnx8MDtmb3IodmFyIGo9MCxs
			Mj1pbnRhY3QubGVuZ3RoO2o8bDI7KytqKXt2YXIgcmFuZ2U9aW50YWN0W2pdO2lmKGNoYW5nZS50
			bzw9cmFuZ2UuZnJvbSYmY2hhbmdlLmRpZmYpaW50YWN0Mi5wdXNoKHtmcm9tOnJhbmdlLmZyb20r
			ZGlmZix0bzpyYW5nZS50bytkaWZmLGRvbVN0YXJ0OnJhbmdlLmRvbVN0YXJ0fSk7ZWxzZSBpZihj
			aGFuZ2UudG88PXJhbmdlLmZyb218fGNoYW5nZS5mcm9tPj1yYW5nZS50bylpbnRhY3QyLnB1c2go
			cmFuZ2UpO2Vsc2V7aWYoY2hhbmdlLmZyb20+cmFuZ2UuZnJvbSlpbnRhY3QyLnB1c2goe2Zyb206
			cmFuZ2UuZnJvbSx0bzpjaGFuZ2UuZnJvbSxkb21TdGFydDpyYW5nZS5kb21TdGFydH0pO2lmKGNo
			YW5nZS50bzxyYW5nZS50bylpbnRhY3QyLnB1c2goe2Zyb206Y2hhbmdlLnRvK2RpZmYsdG86cmFu
			Z2UudG8rZGlmZixkb21TdGFydDpyYW5nZS5kb21TdGFydCsgKGNoYW5nZS50by1yYW5nZS5mcm9t
			KX0pfX1pbnRhY3Q9aW50YWN0Mn1yZXR1cm4gaW50YWN0fWZ1bmN0aW9uIHBhdGNoRGlzcGxheShm
			cm9tLHRvLGludGFjdCl7aWYoIWludGFjdC5sZW5ndGgpbGluZURpdi5pbm5lckhUTUw9IiI7ZWxz
			ZXtmdW5jdGlvbiBraWxsTm9kZShub2RlKXt2YXIgdG1wPW5vZGUubmV4dFNpYmxpbmc7bm9kZS5w
			YXJlbnROb2RlLnJlbW92ZUNoaWxkKG5vZGUpO3JldHVybiB0bXB9dmFyIGRvbVBvcz0wLGN1ck5v
			ZGU9bGluZURpdi5maXJzdENoaWxkLG47Zm9yKHZhciBpPTA7aTxpbnRhY3QubGVuZ3RoOysraSl7
			dmFyIGN1cj1pbnRhY3RbaV07d2hpbGUoY3VyLmRvbVN0YXJ0PmRvbVBvcyl7Y3VyTm9kZT1raWxs
			Tm9kZShjdXJOb2RlKTtkb21Qb3MrK31mb3IodmFyIGo9MCxlPWN1ci50by1jdXIuZnJvbTtqPGU7
			KytqKXtjdXJOb2RlPWN1ck5vZGUubmV4dFNpYmxpbmc7ZG9tUG9zKyt9fXdoaWxlKGN1ck5vZGUp
			Y3VyTm9kZT1raWxsTm9kZShjdXJOb2RlKX12YXIgbmV4dEludGFjdD0gaW50YWN0LnNoaWZ0KCks
			Y3VyTm9kZT1saW5lRGl2LmZpcnN0Q2hpbGQsaj1mcm9tO3ZhciBzY3JhdGNoPXRhcmdldERvY3Vt
			ZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpLG5ld0VsdDtkb2MuaXRlcihmcm9tLHRvLGZ1bmN0aW9u
			KGxpbmUpe2lmKG5leHRJbnRhY3QmJm5leHRJbnRhY3QudG89PWopbmV4dEludGFjdD1pbnRhY3Qu
			c2hpZnQoKTtpZighbmV4dEludGFjdHx8bmV4dEludGFjdC5mcm9tPmope2lmKGxpbmUuaGlkZGVu
			KXZhciBodG1sPXNjcmF0Y2guaW5uZXJIVE1MPSI8cHJlPjwvcHJlPiI7ZWxzZXt2YXIgaHRtbD0i
			PHByZT4iK2xpbmUuZ2V0SFRNTChtYWtlVGFiKSsiPC9wcmU+IjtpZihsaW5lLmNsYXNzTmFtZSlo
			dG1sPSc8ZGl2IHN0eWxlPSJwb3NpdGlvbjogcmVsYXRpdmUiPjxwcmUgY2xhc3M9IicrbGluZS5j
			bGFzc05hbWUrJyIgc3R5bGU9InBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogMDsgcmlnaHQ6IDA7
			IHRvcDogMDsgYm90dG9tOiAwOyB6LWluZGV4OiAtMiI+JiMxNjA7PC9wcmU+JysgaHRtbCsiPC9k
			aXY+In1zY3JhdGNoLmlubmVySFRNTD1odG1sO2xpbmVEaXYuaW5zZXJ0QmVmb3JlKHNjcmF0Y2gu
			Zmlyc3RDaGlsZCxjdXJOb2RlKX1lbHNlIGN1ck5vZGU9Y3VyTm9kZS5uZXh0U2libGluZzsrK2p9
			KX1mdW5jdGlvbiB1cGRhdGVHdXR0ZXIoKXtpZighb3B0aW9ucy5ndXR0ZXImJiFvcHRpb25zLmxp
			bmVOdW1iZXJzKXJldHVybjt2YXIgaFRleHQ9bW92ZXIub2Zmc2V0SGVpZ2h0LGhFZGl0b3I9c2Ny
			b2xsZXIuY2xpZW50SGVpZ2h0O2d1dHRlci5zdHlsZS5oZWlnaHQ9KGhUZXh0LWhFZGl0b3I8Mj9o
			RWRpdG9yOmhUZXh0KSsicHgiO3ZhciBodG1sPVtdLGk9c2hvd2luZ0Zyb207ZG9jLml0ZXIoc2hv
			d2luZ0Zyb20sTWF0aC5tYXgoc2hvd2luZ1RvLHNob3dpbmdGcm9tKzEpLGZ1bmN0aW9uKGxpbmUp
			e2lmKGxpbmUuaGlkZGVuKWh0bWwucHVzaCgiPHByZT48L3ByZT4iKTtlbHNle3ZhciBtYXJrZXI9
			bGluZS5ndXR0ZXJNYXJrZXI7dmFyIHRleHQ9b3B0aW9ucy5saW5lTnVtYmVycz8gaStvcHRpb25z
			LmZpcnN0TGluZU51bWJlcjpudWxsO2lmKG1hcmtlciYmbWFya2VyLnRleHQpdGV4dD1tYXJrZXIu
			dGV4dC5yZXBsYWNlKCIlTiUiLHRleHQhPW51bGw/dGV4dDoiIik7ZWxzZSBpZih0ZXh0PT1udWxs
			KXRleHQ9Ilx1MDBhMCI7aHRtbC5wdXNoKG1hcmtlciYmbWFya2VyLnN0eWxlPyc8cHJlIGNsYXNz
			PSInK21hcmtlci5zdHlsZSsnIj4nOiI8cHJlPiIsdGV4dCk7Zm9yKHZhciBqPTE7ajxsaW5lLmhl
			aWdodDsrK2opaHRtbC5wdXNoKCI8YnIvPiYjMTYwOyIpO2h0bWwucHVzaCgiPC9wcmU+Iil9Kytp
			fSk7Z3V0dGVyLnN0eWxlLmRpc3BsYXk9Im5vbmUiO2d1dHRlclRleHQuaW5uZXJIVE1MPWh0bWwu
			am9pbigiIik7dmFyIG1pbndpZHRoPVN0cmluZyhkb2Muc2l6ZSkubGVuZ3RoLGZpcnN0Tm9kZT1n
			dXR0ZXJUZXh0LmZpcnN0Q2hpbGQsdmFsPWVsdFRleHQoZmlyc3ROb2RlKSxwYWQ9IiI7d2hpbGUo
			dmFsLmxlbmd0aCtwYWQubGVuZ3RoPG1pbndpZHRoKXBhZCs9ICJcdTAwYTAiO2lmKHBhZClmaXJz
			dE5vZGUuaW5zZXJ0QmVmb3JlKHRhcmdldERvY3VtZW50LmNyZWF0ZVRleHROb2RlKHBhZCksZmly
			c3ROb2RlLmZpcnN0Q2hpbGQpO2d1dHRlci5zdHlsZS5kaXNwbGF5PSIiO2xpbmVTcGFjZS5zdHls
			ZS5tYXJnaW5MZWZ0PWd1dHRlci5vZmZzZXRXaWR0aCsicHgiO2d1dHRlckRpcnR5PWZhbHNlfWZ1
			bmN0aW9uIHVwZGF0ZVNlbGVjdGlvbigpe3ZhciBjb2xsYXBzZWQ9cG9zRXEoc2VsLmZyb20sc2Vs
			LnRvKTt2YXIgZnJvbVBvcz1sb2NhbENvb3JkcyhzZWwuZnJvbSx0cnVlKTt2YXIgdG9Qb3M9Y29s
			bGFwc2VkP2Zyb21Qb3M6bG9jYWxDb29yZHMoc2VsLnRvLHRydWUpO3ZhciBoZWFkUG9zPXNlbC5p
			bnZlcnRlZD9mcm9tUG9zOnRvUG9zLHRoPXRleHRIZWlnaHQoKTt2YXIgd3JhcE9mZj1lbHRPZmZz
			ZXQod3JhcHBlciksbGluZU9mZj1lbHRPZmZzZXQobGluZURpdik7aW5wdXREaXYuc3R5bGUudG9w
			PU1hdGgubWF4KDAsTWF0aC5taW4oc2Nyb2xsZXIub2Zmc2V0SGVpZ2h0LCBoZWFkUG9zLnkrbGlu
			ZU9mZi50b3Atd3JhcE9mZi50b3ApKSsicHgiO2lucHV0RGl2LnN0eWxlLmxlZnQ9TWF0aC5tYXgo
			MCxNYXRoLm1pbihzY3JvbGxlci5vZmZzZXRXaWR0aCxoZWFkUG9zLngrbGluZU9mZi5sZWZ0LXdy
			YXBPZmYubGVmdCkpKyJweCI7aWYoY29sbGFwc2VkKXtjdXJzb3Iuc3R5bGUudG9wPWhlYWRQb3Mu
			eSsicHgiO2N1cnNvci5zdHlsZS5sZWZ0PShvcHRpb25zLmxpbmVXcmFwcGluZz9NYXRoLm1pbiho
			ZWFkUG9zLngsbGluZVNwYWNlLm9mZnNldFdpZHRoKTpoZWFkUG9zLngpKyJweCI7Y3Vyc29yLnN0
			eWxlLmRpc3BsYXk9IiI7c2VsZWN0aW9uRGl2LnN0eWxlLmRpc3BsYXk9Im5vbmUifWVsc2V7dmFy
			IHNhbWVMaW5lPWZyb21Qb3MueT09dG9Qb3MueSxodG1sPSIiO2Z1bmN0aW9uIGFkZChsZWZ0LHRv
			cCxyaWdodCxoZWlnaHQpe2h0bWwrPSc8ZGl2IGNsYXNzPSJDb2RlTWlycm9yLXNlbGVjdGVkIiBz
			dHlsZT0icG9zaXRpb246IGFic29sdXRlOyBsZWZ0OiAnKyBsZWZ0KyJweDsgdG9wOiAiK3RvcCsi
			cHg7IHJpZ2h0OiAiK3JpZ2h0KyJweDsgaGVpZ2h0OiAiK2hlaWdodCsncHgiPjwvZGl2Pid9aWYo
			c2VsLmZyb20uY2gmJmZyb21Qb3MueT49MCl7dmFyIHJpZ2h0PXNhbWVMaW5lP2xpbmVTcGFjZS5j
			bGllbnRXaWR0aC10b1Bvcy54OjA7YWRkKGZyb21Qb3MueCxmcm9tUG9zLnkscmlnaHQsdGgpfXZh
			ciBtaWRkbGVTdGFydD1NYXRoLm1heCgwLGZyb21Qb3MueSsoc2VsLmZyb20uY2g/dGg6MCkpO3Zh
			ciBtaWRkbGVIZWlnaHQ9TWF0aC5taW4odG9Qb3MueSxsaW5lU3BhY2UuY2xpZW50SGVpZ2h0KS1t
			aWRkbGVTdGFydDtpZihtaWRkbGVIZWlnaHQ+MC4yKnRoKWFkZCgwLG1pZGRsZVN0YXJ0LDAsbWlk
			ZGxlSGVpZ2h0KTtpZigoIXNhbWVMaW5lfHwhc2VsLmZyb20uY2gpJiZ0b1Bvcy55PGxpbmVTcGFj
			ZS5jbGllbnRIZWlnaHQtMC41KnRoKWFkZCgwLHRvUG9zLnksbGluZVNwYWNlLmNsaWVudFdpZHRo
			LXRvUG9zLngsdGgpO3NlbGVjdGlvbkRpdi5pbm5lckhUTUw9IGh0bWw7Y3Vyc29yLnN0eWxlLmRp
			c3BsYXk9Im5vbmUiO3NlbGVjdGlvbkRpdi5zdHlsZS5kaXNwbGF5PSIifX1mdW5jdGlvbiBzZXRT
			aGlmdCh2YWwpe2lmKHZhbClzaGlmdFNlbGVjdGluZz1zaGlmdFNlbGVjdGluZ3x8KHNlbC5pbnZl
			cnRlZD9zZWwudG86c2VsLmZyb20pO2Vsc2Ugc2hpZnRTZWxlY3Rpbmc9bnVsbH1mdW5jdGlvbiBz
			ZXRTZWxlY3Rpb25Vc2VyKGZyb20sdG8pe3ZhciBzaD1zaGlmdFNlbGVjdGluZyYmY2xpcFBvcyhz
			aGlmdFNlbGVjdGluZyk7aWYoc2gpaWYocG9zTGVzcyhzaCxmcm9tKSlmcm9tPXNoO2Vsc2UgaWYo
			cG9zTGVzcyh0byxzaCkpdG89c2g7c2V0U2VsZWN0aW9uKGZyb20sdG8pO3VzZXJTZWxDaGFuZ2U9
			dHJ1ZX1mdW5jdGlvbiBzZXRTZWxlY3Rpb24oZnJvbSx0byxvbGRGcm9tLG9sZFRvKXtnb2FsQ29s
			dW1uPW51bGw7aWYob2xkRnJvbT09bnVsbCl7b2xkRnJvbT1zZWwuZnJvbS5saW5lO29sZFRvPXNl
			bC50by5saW5lfWlmKHBvc0VxKHNlbC5mcm9tLCBmcm9tKSYmcG9zRXEoc2VsLnRvLHRvKSlyZXR1
			cm47aWYocG9zTGVzcyh0byxmcm9tKSl7dmFyIHRtcD10bzt0bz1mcm9tO2Zyb209dG1wfWlmKGZy
			b20ubGluZSE9b2xkRnJvbSlmcm9tPXNraXBIaWRkZW4oZnJvbSxvbGRGcm9tLHNlbC5mcm9tLmNo
			KTtpZih0by5saW5lIT1vbGRUbyl0bz1za2lwSGlkZGVuKHRvLG9sZFRvLHNlbC50by5jaCk7aWYo
			cG9zRXEoZnJvbSx0bykpc2VsLmludmVydGVkPWZhbHNlO2Vsc2UgaWYocG9zRXEoZnJvbSxzZWwu
			dG8pKXNlbC5pbnZlcnRlZD1mYWxzZTtlbHNlIGlmKHBvc0VxKHRvLHNlbC5mcm9tKSlzZWwuaW52
			ZXJ0ZWQ9dHJ1ZTtpZihvcHRpb25zLmF1dG9DbGVhckVtcHR5TGluZXMmJnBvc0VxKHNlbC5mcm9t
			LHNlbC50bykpe3ZhciBoZWFkPXNlbC5pbnZlcnRlZD9mcm9tOnRvO2lmKGhlYWQubGluZSE9c2Vs
			LmZyb20ubGluZSl7dmFyIG9sZExpbmU9Z2V0TGluZShzZWwuZnJvbS5saW5lKTtpZigvXlxzKyQv
			LnRlc3Qob2xkTGluZS50ZXh0KSlzZXRUaW1lb3V0KG9wZXJhdGlvbihmdW5jdGlvbigpe2lmKG9s
			ZExpbmUucGFyZW50JiYgL15ccyskLy50ZXN0KG9sZExpbmUudGV4dCkpe3ZhciBubz1saW5lTm8o
			b2xkTGluZSk7cmVwbGFjZVJhbmdlKCIiLHtsaW5lOm5vLGNoOjB9LHtsaW5lOm5vLGNoOm9sZExp
			bmUudGV4dC5sZW5ndGh9KX19LDEwKSl9fXNlbC5mcm9tPWZyb207c2VsLnRvPXRvO3NlbGVjdGlv
			bkNoYW5nZWQ9dHJ1ZX1mdW5jdGlvbiBza2lwSGlkZGVuKHBvcyxvbGRMaW5lLG9sZENoKXtmdW5j
			dGlvbiBnZXROb25IaWRkZW4oZGlyKXt2YXIgbE5vPXBvcy5saW5lK2RpcixlbmQ9ZGlyPT0xP2Rv
			Yy5zaXplOi0xO3doaWxlKGxObyE9ZW5kKXt2YXIgbGluZT1nZXRMaW5lKGxObyk7aWYoIWxpbmUu
			aGlkZGVuKXt2YXIgY2g9cG9zLmNoO2lmKGNoPm9sZENofHxjaD5saW5lLnRleHQubGVuZ3RoKWNo
			PWxpbmUudGV4dC5sZW5ndGg7cmV0dXJue2xpbmU6bE5vLGNoOmNofX1sTm8rPWRpcn19dmFyIGxp
			bmU9Z2V0TGluZShwb3MubGluZSk7aWYoIWxpbmUuaGlkZGVuKXJldHVybiBwb3M7aWYocG9zLmxp
			bmU+PSBvbGRMaW5lKXJldHVybiBnZXROb25IaWRkZW4oMSl8fGdldE5vbkhpZGRlbigtMSk7ZWxz
			ZSByZXR1cm4gZ2V0Tm9uSGlkZGVuKC0xKXx8Z2V0Tm9uSGlkZGVuKDEpfWZ1bmN0aW9uIHNldEN1
			cnNvcihsaW5lLGNoLHVzZXIpe3ZhciBwb3M9Y2xpcFBvcyh7bGluZTpsaW5lLGNoOmNofHwwfSk7
			KHVzZXI/c2V0U2VsZWN0aW9uVXNlcjpzZXRTZWxlY3Rpb24pKHBvcyxwb3MpfWZ1bmN0aW9uIGNs
			aXBMaW5lKG4pe3JldHVybiBNYXRoLm1heCgwLE1hdGgubWluKG4sZG9jLnNpemUtMSkpfWZ1bmN0
			aW9uIGNsaXBQb3MocG9zKXtpZihwb3MubGluZTwwKXJldHVybntsaW5lOjAsY2g6MH07aWYocG9z
			LmxpbmU+PWRvYy5zaXplKXJldHVybntsaW5lOmRvYy5zaXplLTEsY2g6Z2V0TGluZShkb2Muc2l6
			ZS0xKS50ZXh0Lmxlbmd0aH07dmFyIGNoPXBvcy5jaCxsaW5lbGVuPWdldExpbmUocG9zLmxpbmUp
			LnRleHQubGVuZ3RoO2lmKGNoPT1udWxsfHxjaD5saW5lbGVuKXJldHVybntsaW5lOnBvcy5saW5l
			LCBjaDpsaW5lbGVufTtlbHNlIGlmKGNoPDApcmV0dXJue2xpbmU6cG9zLmxpbmUsY2g6MH07ZWxz
			ZSByZXR1cm4gcG9zfWZ1bmN0aW9uIGZpbmRQb3NIKGRpcix1bml0KXt2YXIgZW5kPXNlbC5pbnZl
			cnRlZD9zZWwuZnJvbTpzZWwudG8sbGluZT1lbmQubGluZSxjaD1lbmQuY2g7dmFyIGxpbmVPYmo9
			Z2V0TGluZShsaW5lKTtmdW5jdGlvbiBmaW5kTmV4dExpbmUoKXtmb3IodmFyIGw9bGluZStkaXIs
			ZT1kaXI8MD8tMTpkb2Muc2l6ZTtsIT1lO2wrPWRpcil7dmFyIGxvPWdldExpbmUobCk7aWYoIWxv
			LmhpZGRlbil7bGluZT1sO2xpbmVPYmo9bG87cmV0dXJuIHRydWV9fX1mdW5jdGlvbiBtb3ZlT25j
			ZShib3VuZFRvTGluZSl7aWYoY2g9PShkaXI8MD8wOmxpbmVPYmoudGV4dC5sZW5ndGgpKWlmKCFi
			b3VuZFRvTGluZSYmZmluZE5leHRMaW5lKCkpY2g9ZGlyPDA/bGluZU9iai50ZXh0Lmxlbmd0aDow
			O2Vsc2UgcmV0dXJuIGZhbHNlO2Vsc2UgY2grPWRpcjtyZXR1cm4gdHJ1ZX1pZih1bml0PT0gImNo
			YXIiKW1vdmVPbmNlKCk7ZWxzZSBpZih1bml0PT0iY29sdW1uIiltb3ZlT25jZSh0cnVlKTtlbHNl
			IGlmKHVuaXQ9PSJ3b3JkIil7dmFyIHNhd1dvcmQ9ZmFsc2U7Zm9yKDs7KXtpZihkaXI8MClpZigh
			bW92ZU9uY2UoKSlicmVhaztpZihpc1dvcmRDaGFyKGxpbmVPYmoudGV4dC5jaGFyQXQoY2gpKSlz
			YXdXb3JkPXRydWU7ZWxzZSBpZihzYXdXb3JkKXtpZihkaXI8MCl7ZGlyPTE7bW92ZU9uY2UoKX1i
			cmVha31pZihkaXI+MClpZighbW92ZU9uY2UoKSlicmVha319cmV0dXJue2xpbmU6bGluZSxjaDpj
			aH19ZnVuY3Rpb24gbW92ZUgoZGlyLHVuaXQpe3ZhciBwb3M9ZGlyPDA/c2VsLmZyb206c2VsLnRv
			O2lmKHNoaWZ0U2VsZWN0aW5nfHxwb3NFcShzZWwuZnJvbSxzZWwudG8pKXBvcz1maW5kUG9zSChk
			aXIsdW5pdCk7c2V0Q3Vyc29yKHBvcy5saW5lLHBvcy5jaCx0cnVlKX1mdW5jdGlvbiBkZWxldGVI
			KGRpcix1bml0KXtpZighcG9zRXEoc2VsLmZyb20sc2VsLnRvKSlyZXBsYWNlUmFuZ2UoIiIsIHNl
			bC5mcm9tLHNlbC50byk7ZWxzZSBpZihkaXI8MClyZXBsYWNlUmFuZ2UoIiIsZmluZFBvc0goZGly
			LHVuaXQpLHNlbC50byk7ZWxzZSByZXBsYWNlUmFuZ2UoIiIsc2VsLmZyb20sZmluZFBvc0goZGly
			LHVuaXQpKTt1c2VyU2VsQ2hhbmdlPXRydWV9dmFyIGdvYWxDb2x1bW49bnVsbDtmdW5jdGlvbiBt
			b3ZlVihkaXIsdW5pdCl7dmFyIGRpc3Q9MCxwb3M9bG9jYWxDb29yZHMoc2VsLmludmVydGVkP3Nl
			bC5mcm9tOnNlbC50byx0cnVlKTtpZihnb2FsQ29sdW1uIT1udWxsKXBvcy54PWdvYWxDb2x1bW47
			aWYodW5pdD09InBhZ2UiKWRpc3Q9TWF0aC5taW4oc2Nyb2xsZXIuY2xpZW50SGVpZ2h0LHdpbmRv
			dy5pbm5lckhlaWdodHx8ZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCk7ZWxz
			ZSBpZih1bml0PT0ibGluZSIpZGlzdD10ZXh0SGVpZ2h0KCk7dmFyIHRhcmdldD1jb29yZHNDaGFy
			KHBvcy54LHBvcy55K2Rpc3QqZGlyKzIpO3NldEN1cnNvcih0YXJnZXQubGluZSwgdGFyZ2V0LmNo
			LHRydWUpO2dvYWxDb2x1bW49cG9zLnh9ZnVuY3Rpb24gc2VsZWN0V29yZEF0KHBvcyl7dmFyIGxp
			bmU9Z2V0TGluZShwb3MubGluZSkudGV4dDt2YXIgc3RhcnQ9cG9zLmNoLGVuZD1wb3MuY2g7d2hp
			bGUoc3RhcnQ+MCYmaXNXb3JkQ2hhcihsaW5lLmNoYXJBdChzdGFydC0xKSkpLS1zdGFydDt3aGls
			ZShlbmQ8bGluZS5sZW5ndGgmJmlzV29yZENoYXIobGluZS5jaGFyQXQoZW5kKSkpKytlbmQ7c2V0
			U2VsZWN0aW9uVXNlcih7bGluZTpwb3MubGluZSxjaDpzdGFydH0se2xpbmU6cG9zLmxpbmUsY2g6
			ZW5kfSl9ZnVuY3Rpb24gc2VsZWN0TGluZShsaW5lKXtzZXRTZWxlY3Rpb25Vc2VyKHtsaW5lOmxp
			bmUsY2g6MH0sY2xpcFBvcyh7bGluZTpsaW5lKzEsY2g6MH0pKX1mdW5jdGlvbiBpbmRlbnRTZWxl
			Y3RlZChtb2RlKXtpZihwb3NFcShzZWwuZnJvbSxzZWwudG8pKXJldHVybiBpbmRlbnRMaW5lKHNl
			bC5mcm9tLmxpbmUsbW9kZSk7dmFyIGU9c2VsLnRvLmxpbmUtIChzZWwudG8uY2g/MDoxKTtmb3Io
			dmFyIGk9c2VsLmZyb20ubGluZTtpPD1lOysraSlpbmRlbnRMaW5lKGksbW9kZSl9ZnVuY3Rpb24g
			aW5kZW50TGluZShuLGhvdyl7aWYoIWhvdylob3c9ImFkZCI7aWYoaG93PT0ic21hcnQiKWlmKCFt
			b2RlLmluZGVudClob3c9InByZXYiO2Vsc2UgdmFyIHN0YXRlPWdldFN0YXRlQmVmb3JlKG4pO3Zh
			ciBsaW5lPWdldExpbmUobiksY3VyU3BhY2U9bGluZS5pbmRlbnRhdGlvbihvcHRpb25zLnRhYlNp
			emUpLGN1clNwYWNlU3RyaW5nPWxpbmUudGV4dC5tYXRjaCgvXlxzKi8pWzBdLGluZGVudGF0aW9u
			O2lmKGhvdz09InByZXYiKWlmKG4paW5kZW50YXRpb249Z2V0TGluZShuLTEpLmluZGVudGF0aW9u
			KG9wdGlvbnMudGFiU2l6ZSk7ZWxzZSBpbmRlbnRhdGlvbj0wO2Vsc2UgaWYoaG93PT0ic21hcnQi
			KWluZGVudGF0aW9uPW1vZGUuaW5kZW50KHN0YXRlLGxpbmUudGV4dC5zbGljZShjdXJTcGFjZVN0
			cmluZy5sZW5ndGgpLGxpbmUudGV4dCk7ZWxzZSBpZihob3c9PSAiYWRkIilpbmRlbnRhdGlvbj1j
			dXJTcGFjZStvcHRpb25zLmluZGVudFVuaXQ7ZWxzZSBpZihob3c9PSJzdWJ0cmFjdCIpaW5kZW50
			YXRpb249Y3VyU3BhY2Utb3B0aW9ucy5pbmRlbnRVbml0O2luZGVudGF0aW9uPU1hdGgubWF4KDAs
			aW5kZW50YXRpb24pO3ZhciBkaWZmPWluZGVudGF0aW9uLWN1clNwYWNlO2lmKCFkaWZmKXtpZihz
			ZWwuZnJvbS5saW5lIT1uJiZzZWwudG8ubGluZSE9bilyZXR1cm47dmFyIGluZGVudFN0cmluZz1j
			dXJTcGFjZVN0cmluZ31lbHNle3ZhciBpbmRlbnRTdHJpbmc9IiIscG9zPTA7aWYob3B0aW9ucy5p
			bmRlbnRXaXRoVGFicylmb3IodmFyIGk9TWF0aC5mbG9vcihpbmRlbnRhdGlvbi9vcHRpb25zLnRh
			YlNpemUpO2k7LS1pKXtwb3MrPW9wdGlvbnMudGFiU2l6ZTtpbmRlbnRTdHJpbmcrPSJcdCJ9d2hp
			bGUocG9zPGluZGVudGF0aW9uKXsrK3BvcztpbmRlbnRTdHJpbmcrPSIgIn19cmVwbGFjZVJhbmdl
			KGluZGVudFN0cmluZyx7bGluZTpuLGNoOjB9LCB7bGluZTpuLGNoOmN1clNwYWNlU3RyaW5nLmxl
			bmd0aH0pfWZ1bmN0aW9uIGxvYWRNb2RlKCl7bW9kZT1Db2RlTWlycm9yLmdldE1vZGUob3B0aW9u
			cyxvcHRpb25zLm1vZGUpO2RvYy5pdGVyKDAsZG9jLnNpemUsZnVuY3Rpb24obGluZSl7bGluZS5z
			dGF0ZUFmdGVyPW51bGx9KTt3b3JrPVswXTtzdGFydFdvcmtlcigpfWZ1bmN0aW9uIGd1dHRlckNo
			YW5nZWQoKXt2YXIgdmlzaWJsZT1vcHRpb25zLmd1dHRlcnx8b3B0aW9ucy5saW5lTnVtYmVycztn
			dXR0ZXIuc3R5bGUuZGlzcGxheT12aXNpYmxlPyIiOiJub25lIjtpZih2aXNpYmxlKWd1dHRlckRp
			cnR5PXRydWU7ZWxzZSBsaW5lRGl2LnBhcmVudE5vZGUuc3R5bGUubWFyZ2luTGVmdD0wfWZ1bmN0
			aW9uIHdyYXBwaW5nQ2hhbmdlZChmcm9tLHRvKXtpZihvcHRpb25zLmxpbmVXcmFwcGluZyl7d3Jh
			cHBlci5jbGFzc05hbWUrPSIgQ29kZU1pcnJvci13cmFwIjt2YXIgcGVyTGluZT1zY3JvbGxlci5j
			bGllbnRXaWR0aC9jaGFyV2lkdGgoKS0gMztkb2MuaXRlcigwLGRvYy5zaXplLGZ1bmN0aW9uKGxp
			bmUpe2lmKGxpbmUuaGlkZGVuKXJldHVybjt2YXIgZ3Vlc3M9TWF0aC5jZWlsKGxpbmUudGV4dC5s
			ZW5ndGgvcGVyTGluZSl8fDE7aWYoZ3Vlc3MhPTEpdXBkYXRlTGluZUhlaWdodChsaW5lLGd1ZXNz
			KX0pO2xpbmVTcGFjZS5zdHlsZS53aWR0aD1jb2RlLnN0eWxlLndpZHRoPSIifWVsc2V7d3JhcHBl
			ci5jbGFzc05hbWU9d3JhcHBlci5jbGFzc05hbWUucmVwbGFjZSgiIENvZGVNaXJyb3Itd3JhcCIs
			IiIpO21heFdpZHRoPW51bGw7bWF4TGluZT0iIjtkb2MuaXRlcigwLGRvYy5zaXplLGZ1bmN0aW9u
			KGxpbmUpe2lmKGxpbmUuaGVpZ2h0IT0xJiYhbGluZS5oaWRkZW4pdXBkYXRlTGluZUhlaWdodChs
			aW5lLDEpO2lmKGxpbmUudGV4dC5sZW5ndGg+bWF4TGluZS5sZW5ndGgpbWF4TGluZT1saW5lLnRl
			eHR9KX1jaGFuZ2VzLnB1c2goe2Zyb206MCx0bzpkb2Muc2l6ZX0pfWZ1bmN0aW9uIG1ha2VUYWIo
			Y29sKXt2YXIgdz1vcHRpb25zLnRhYlNpemUtIGNvbCVvcHRpb25zLnRhYlNpemU7Zm9yKHZhciBz
			dHI9JzxzcGFuIGNsYXNzPSJjbS10YWIiPicsaT0wO2k8dzsrK2kpc3RyKz0iICI7cmV0dXJue2h0
			bWw6c3RyKyI8L3NwYW4+Iix3aWR0aDp3fX1mdW5jdGlvbiB0aGVtZUNoYW5nZWQoKXtzY3JvbGxl
			ci5jbGFzc05hbWU9c2Nyb2xsZXIuY2xhc3NOYW1lLnJlcGxhY2UoL1xzKmNtLXMtXHcrL2csIiIp
			K29wdGlvbnMudGhlbWUucmVwbGFjZSgvKF58XHMpXHMqL2csIiBjbS1zLSIpfWZ1bmN0aW9uIFRl
			eHRNYXJrZXIoKXt0aGlzLnNldD1bXX1UZXh0TWFya2VyLnByb3RvdHlwZS5jbGVhcj1vcGVyYXRp
			b24oZnVuY3Rpb24oKXt2YXIgbWluPUluZmluaXR5LG1heD0tSW5maW5pdHk7Zm9yKHZhciBpPTAs
			ZT10aGlzLnNldC5sZW5ndGg7aTxlOysraSl7dmFyIGxpbmU9dGhpcy5zZXRbaV0sbWs9bGluZS5t
			YXJrZWQ7aWYoIW1rfHwhbGluZS5wYXJlbnQpY29udGludWU7dmFyIGxpbmVOPWxpbmVObyhsaW5l
			KTttaW49TWF0aC5taW4obWluLCBsaW5lTik7bWF4PU1hdGgubWF4KG1heCxsaW5lTik7Zm9yKHZh
			ciBqPTA7ajxtay5sZW5ndGg7KytqKWlmKG1rW2pdLnNldD09dGhpcy5zZXQpbWsuc3BsaWNlKGot
			LSwxKX1pZihtaW4hPUluZmluaXR5KWNoYW5nZXMucHVzaCh7ZnJvbTptaW4sdG86bWF4KzF9KX0p
			O1RleHRNYXJrZXIucHJvdG90eXBlLmZpbmQ9ZnVuY3Rpb24oKXt2YXIgZnJvbSx0bztmb3IodmFy
			IGk9MCxlPXRoaXMuc2V0Lmxlbmd0aDtpPGU7KytpKXt2YXIgbGluZT10aGlzLnNldFtpXSxtaz1s
			aW5lLm1hcmtlZDtmb3IodmFyIGo9MDtqPG1rLmxlbmd0aDsrK2ope3ZhciBtYXJrPW1rW2pdO2lm
			KG1hcmsuc2V0PT10aGlzLnNldClpZihtYXJrLmZyb20hPW51bGx8fG1hcmsudG8hPW51bGwpe3Zh
			ciBmb3VuZD1saW5lTm8obGluZSk7aWYoZm91bmQhPW51bGwpe2lmKG1hcmsuZnJvbSE9bnVsbClm
			cm9tPXtsaW5lOmZvdW5kLGNoOm1hcmsuZnJvbX07aWYobWFyay50byE9bnVsbCl0bz17bGluZTpm
			b3VuZCxjaDptYXJrLnRvfX19fX1yZXR1cm57ZnJvbTpmcm9tLCB0bzp0b319O2Z1bmN0aW9uIG1h
			cmtUZXh0KGZyb20sdG8sY2xhc3NOYW1lKXtmcm9tPWNsaXBQb3MoZnJvbSk7dG89Y2xpcFBvcyh0
			byk7dmFyIHRtPW5ldyBUZXh0TWFya2VyO2Z1bmN0aW9uIGFkZChsaW5lLGZyb20sdG8sY2xhc3NO
			YW1lKXtnZXRMaW5lKGxpbmUpLmFkZE1hcmsobmV3IE1hcmtlZFRleHQoZnJvbSx0byxjbGFzc05h
			bWUsdG0uc2V0KSl9aWYoZnJvbS5saW5lPT10by5saW5lKWFkZChmcm9tLmxpbmUsZnJvbS5jaCx0
			by5jaCxjbGFzc05hbWUpO2Vsc2V7YWRkKGZyb20ubGluZSxmcm9tLmNoLG51bGwsY2xhc3NOYW1l
			KTtmb3IodmFyIGk9ZnJvbS5saW5lKzEsZT10by5saW5lO2k8ZTsrK2kpYWRkKGksbnVsbCxudWxs
			LGNsYXNzTmFtZSk7YWRkKHRvLmxpbmUsbnVsbCx0by5jaCxjbGFzc05hbWUpfWNoYW5nZXMucHVz
			aCh7ZnJvbTpmcm9tLmxpbmUsdG86dG8ubGluZSsxfSk7cmV0dXJuIHRtfWZ1bmN0aW9uIHNldEJv
			b2ttYXJrKHBvcyl7cG9zPWNsaXBQb3MocG9zKTsgdmFyIGJtPW5ldyBCb29rbWFyayhwb3MuY2gp
			O2dldExpbmUocG9zLmxpbmUpLmFkZE1hcmsoYm0pO3JldHVybiBibX1mdW5jdGlvbiBhZGRHdXR0
			ZXJNYXJrZXIobGluZSx0ZXh0LGNsYXNzTmFtZSl7aWYodHlwZW9mIGxpbmU9PSJudW1iZXIiKWxp
			bmU9Z2V0TGluZShjbGlwTGluZShsaW5lKSk7bGluZS5ndXR0ZXJNYXJrZXI9e3RleHQ6dGV4dCxz
			dHlsZTpjbGFzc05hbWV9O2d1dHRlckRpcnR5PXRydWU7cmV0dXJuIGxpbmV9ZnVuY3Rpb24gcmVt
			b3ZlR3V0dGVyTWFya2VyKGxpbmUpe2lmKHR5cGVvZiBsaW5lPT0ibnVtYmVyIilsaW5lPWdldExp
			bmUoY2xpcExpbmUobGluZSkpO2xpbmUuZ3V0dGVyTWFya2VyPW51bGw7Z3V0dGVyRGlydHk9dHJ1
			ZX1mdW5jdGlvbiBjaGFuZ2VMaW5lKGhhbmRsZSxvcCl7dmFyIG5vPWhhbmRsZSxsaW5lPWhhbmRs
			ZTtpZih0eXBlb2YgaGFuZGxlPT0ibnVtYmVyIilsaW5lPWdldExpbmUoY2xpcExpbmUoaGFuZGxl
			KSk7ZWxzZSBubz1saW5lTm8oaGFuZGxlKTsgaWYobm89PW51bGwpcmV0dXJuIG51bGw7aWYob3Ao
			bGluZSxubykpY2hhbmdlcy5wdXNoKHtmcm9tOm5vLHRvOm5vKzF9KTtlbHNlIHJldHVybiBudWxs
			O3JldHVybiBsaW5lfWZ1bmN0aW9uIHNldExpbmVDbGFzcyhoYW5kbGUsY2xhc3NOYW1lKXtyZXR1
			cm4gY2hhbmdlTGluZShoYW5kbGUsZnVuY3Rpb24obGluZSl7aWYobGluZS5jbGFzc05hbWUhPWNs
			YXNzTmFtZSl7bGluZS5jbGFzc05hbWU9Y2xhc3NOYW1lO3JldHVybiB0cnVlfX0pfWZ1bmN0aW9u
			IHNldExpbmVIaWRkZW4oaGFuZGxlLGhpZGRlbil7cmV0dXJuIGNoYW5nZUxpbmUoaGFuZGxlLGZ1
			bmN0aW9uKGxpbmUsbm8pe2lmKGxpbmUuaGlkZGVuIT1oaWRkZW4pe2xpbmUuaGlkZGVuPWhpZGRl
			bjt1cGRhdGVMaW5lSGVpZ2h0KGxpbmUsaGlkZGVuPzA6MSk7dmFyIGZsaW5lPXNlbC5mcm9tLmxp
			bmUsdGxpbmU9c2VsLnRvLmxpbmU7aWYoaGlkZGVuJiYoZmxpbmU9PW5vfHx0bGluZT09bm8pKXt2
			YXIgZnJvbT1mbGluZT09IG5vP3NraXBIaWRkZW4oe2xpbmU6ZmxpbmUsY2g6MH0sZmxpbmUsMCk6
			c2VsLmZyb207dmFyIHRvPXRsaW5lPT1ubz9za2lwSGlkZGVuKHtsaW5lOnRsaW5lLGNoOjB9LHRs
			aW5lLDApOnNlbC50bztzZXRTZWxlY3Rpb24oZnJvbSx0byl9cmV0dXJuIGd1dHRlckRpcnR5PXRy
			dWV9fSl9ZnVuY3Rpb24gbGluZUluZm8obGluZSl7aWYodHlwZW9mIGxpbmU9PSJudW1iZXIiKXtp
			ZighaXNMaW5lKGxpbmUpKXJldHVybiBudWxsO3ZhciBuPWxpbmU7bGluZT1nZXRMaW5lKGxpbmUp
			O2lmKCFsaW5lKXJldHVybiBudWxsfWVsc2V7dmFyIG49bGluZU5vKGxpbmUpO2lmKG49PW51bGwp
			cmV0dXJuIG51bGx9dmFyIG1hcmtlcj1saW5lLmd1dHRlck1hcmtlcjtyZXR1cm57bGluZTpuLGhh
			bmRsZTpsaW5lLHRleHQ6bGluZS50ZXh0LG1hcmtlclRleHQ6bWFya2VyJiZtYXJrZXIudGV4dCxt
			YXJrZXJDbGFzczptYXJrZXImJm1hcmtlci5zdHlsZSxsaW5lQ2xhc3M6bGluZS5jbGFzc05hbWV9
			fWZ1bmN0aW9uIHN0cmluZ1dpZHRoKHN0cil7bWVhc3VyZS5pbm5lckhUTUw9ICI8cHJlPjxzcGFu
			Png8L3NwYW4+PC9wcmU+IjttZWFzdXJlLmZpcnN0Q2hpbGQuZmlyc3RDaGlsZC5maXJzdENoaWxk
			Lm5vZGVWYWx1ZT1zdHI7cmV0dXJuIG1lYXN1cmUuZmlyc3RDaGlsZC5maXJzdENoaWxkLm9mZnNl
			dFdpZHRofHwxMH1mdW5jdGlvbiBjaGFyRnJvbVgobGluZSx4KXtpZih4PD0wKXJldHVybiAwO3Zh
			ciBsaW5lT2JqPWdldExpbmUobGluZSksdGV4dD1saW5lT2JqLnRleHQ7ZnVuY3Rpb24gZ2V0WChs
			ZW4pe21lYXN1cmUuaW5uZXJIVE1MPSI8cHJlPjxzcGFuPiIrbGluZU9iai5nZXRIVE1MKG1ha2VU
			YWIsbGVuKSsiPC9zcGFuPjwvcHJlPiI7cmV0dXJuIG1lYXN1cmUuZmlyc3RDaGlsZC5maXJzdENo
			aWxkLm9mZnNldFdpZHRofXZhciBmcm9tPTAsZnJvbVg9MCx0bz10ZXh0Lmxlbmd0aCx0b1g7dmFy
			IGVzdGltYXRlZD1NYXRoLm1pbih0byxNYXRoLmNlaWwoeC9jaGFyV2lkdGgoKSkpO2Zvcig7Oyl7
			dmFyIGVzdFg9Z2V0WChlc3RpbWF0ZWQpO2lmKGVzdFg8PSB4JiZlc3RpbWF0ZWQ8dG8pZXN0aW1h
			dGVkPU1hdGgubWluKHRvLE1hdGguY2VpbChlc3RpbWF0ZWQqMS4yKSk7ZWxzZXt0b1g9ZXN0WDt0
			bz1lc3RpbWF0ZWQ7YnJlYWt9fWlmKHg+dG9YKXJldHVybiB0bztlc3RpbWF0ZWQ9TWF0aC5mbG9v
			cih0byowLjgpO2VzdFg9Z2V0WChlc3RpbWF0ZWQpO2lmKGVzdFg8eCl7ZnJvbT1lc3RpbWF0ZWQ7
			ZnJvbVg9ZXN0WH1mb3IoOzspe2lmKHRvLWZyb208PTEpcmV0dXJuIHRvWC14PngtZnJvbVg/ZnJv
			bTp0bzt2YXIgbWlkZGxlPU1hdGguY2VpbCgoZnJvbSt0bykvMiksbWlkZGxlWD1nZXRYKG1pZGRs
			ZSk7aWYobWlkZGxlWD54KXt0bz1taWRkbGU7dG9YPW1pZGRsZVh9ZWxzZXtmcm9tPW1pZGRsZTtm
			cm9tWD1taWRkbGVYfX19dmFyIHRlbXBJZD1NYXRoLmZsb29yKE1hdGgucmFuZG9tKCkqMTY3Nzcy
			MTUpLnRvU3RyaW5nKDE2KTtmdW5jdGlvbiBtZWFzdXJlTGluZShsaW5lLGNoKXtpZihjaD09MCly
			ZXR1cm57dG9wOjAsbGVmdDowfTt2YXIgZXh0cmE9ICIiO2lmKG9wdGlvbnMubGluZVdyYXBwaW5n
			KXt2YXIgZW5kPWxpbmUudGV4dC5pbmRleE9mKCIgIixjaCsyKTtleHRyYT1odG1sRXNjYXBlKGxp
			bmUudGV4dC5zbGljZShjaCsxLGVuZDwwP2xpbmUudGV4dC5sZW5ndGg6ZW5kKyhpZT81OjApKSl9
			bWVhc3VyZS5pbm5lckhUTUw9IjxwcmU+IitsaW5lLmdldEhUTUwobWFrZVRhYixjaCkrJzxzcGFu
			IGlkPSJDb2RlTWlycm9yLXRlbXAtJyt0ZW1wSWQrJyI+JytodG1sRXNjYXBlKGxpbmUudGV4dC5j
			aGFyQXQoY2gpfHwiICIpKyI8L3NwYW4+IitleHRyYSsiPC9wcmU+Ijt2YXIgZWx0PWRvY3VtZW50
			LmdldEVsZW1lbnRCeUlkKCJDb2RlTWlycm9yLXRlbXAtIit0ZW1wSWQpO3ZhciB0b3A9ZWx0Lm9m
			ZnNldFRvcCxsZWZ0PWVsdC5vZmZzZXRMZWZ0O2lmKGllJiZ0b3A9PTAmJmxlZnQ9PTApe3ZhciBi
			YWNrdXA9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgic3BhbiIpO2JhY2t1cC5pbm5lckhUTUw9Ingi
			O2VsdC5wYXJlbnROb2RlLmluc2VydEJlZm9yZShiYWNrdXAsIGVsdC5uZXh0U2libGluZyk7dG9w
			PWJhY2t1cC5vZmZzZXRUb3B9cmV0dXJue3RvcDp0b3AsbGVmdDpsZWZ0fX1mdW5jdGlvbiBsb2Nh
			bENvb3Jkcyhwb3MsaW5MaW5lV3JhcCl7dmFyIHgsbGg9dGV4dEhlaWdodCgpLHk9bGgqKGhlaWdo
			dEF0TGluZShkb2MscG9zLmxpbmUpLShpbkxpbmVXcmFwP2Rpc3BsYXlPZmZzZXQ6MCkpO2lmKHBv
			cy5jaD09MCl4PTA7ZWxzZXt2YXIgc3A9bWVhc3VyZUxpbmUoZ2V0TGluZShwb3MubGluZSkscG9z
			LmNoKTt4PXNwLmxlZnQ7aWYob3B0aW9ucy5saW5lV3JhcHBpbmcpeSs9TWF0aC5tYXgoMCxzcC50
			b3ApfXJldHVybnt4OngseTp5LHlCb3Q6eStsaH19ZnVuY3Rpb24gY29vcmRzQ2hhcih4LHkpe2lm
			KHk8MCl5PTA7dmFyIHRoPXRleHRIZWlnaHQoKSxjdz1jaGFyV2lkdGgoKSxoZWlnaHRQb3M9ZGlz
			cGxheU9mZnNldCtNYXRoLmZsb29yKHkvdGgpO3ZhciBsaW5lTm89bGluZUF0SGVpZ2h0KGRvYyxo
			ZWlnaHRQb3MpO2lmKGxpbmVObz49ZG9jLnNpemUpcmV0dXJue2xpbmU6ZG9jLnNpemUtIDEsY2g6
			Z2V0TGluZShkb2Muc2l6ZS0xKS50ZXh0Lmxlbmd0aH07dmFyIGxpbmVPYmo9Z2V0TGluZShsaW5l
			Tm8pLHRleHQ9bGluZU9iai50ZXh0O3ZhciB0dz1vcHRpb25zLmxpbmVXcmFwcGluZyxpbm5lck9m
			Zj10dz9oZWlnaHRQb3MtaGVpZ2h0QXRMaW5lKGRvYyxsaW5lTm8pOjA7aWYoeDw9MCYmaW5uZXJP
			ZmY9PTApcmV0dXJue2xpbmU6bGluZU5vLGNoOjB9O2Z1bmN0aW9uIGdldFgobGVuKXt2YXIgc3A9
			bWVhc3VyZUxpbmUobGluZU9iaixsZW4pO2lmKHR3KXt2YXIgb2ZmPU1hdGgucm91bmQoc3AudG9w
			L3RoKTtyZXR1cm4gTWF0aC5tYXgoMCxzcC5sZWZ0KyhvZmYtaW5uZXJPZmYpKnNjcm9sbGVyLmNs
			aWVudFdpZHRoKX1yZXR1cm4gc3AubGVmdH12YXIgZnJvbT0wLGZyb21YPTAsdG89dGV4dC5sZW5n
			dGgsdG9YO3ZhciBlc3RpbWF0ZWQ9TWF0aC5taW4odG8sTWF0aC5jZWlsKCh4K2lubmVyT2ZmKnNj
			cm9sbGVyLmNsaWVudFdpZHRoKjAuOSkvY3cpKTtmb3IoOzspe3ZhciBlc3RYPSBnZXRYKGVzdGlt
			YXRlZCk7aWYoZXN0WDw9eCYmZXN0aW1hdGVkPHRvKWVzdGltYXRlZD1NYXRoLm1pbih0byxNYXRo
			LmNlaWwoZXN0aW1hdGVkKjEuMikpO2Vsc2V7dG9YPWVzdFg7dG89ZXN0aW1hdGVkO2JyZWFrfX1p
			Zih4PnRvWClyZXR1cm57bGluZTpsaW5lTm8sY2g6dG99O2VzdGltYXRlZD1NYXRoLmZsb29yKHRv
			KjAuOCk7ZXN0WD1nZXRYKGVzdGltYXRlZCk7aWYoZXN0WDx4KXtmcm9tPWVzdGltYXRlZDtmcm9t
			WD1lc3RYfWZvcig7Oyl7aWYodG8tZnJvbTw9MSlyZXR1cm57bGluZTpsaW5lTm8sY2g6dG9YLXg+
			eC1mcm9tWD9mcm9tOnRvfTt2YXIgbWlkZGxlPU1hdGguY2VpbCgoZnJvbSt0bykvMiksbWlkZGxl
			WD1nZXRYKG1pZGRsZSk7aWYobWlkZGxlWD54KXt0bz1taWRkbGU7dG9YPW1pZGRsZVh9ZWxzZXtm
			cm9tPW1pZGRsZTtmcm9tWD1taWRkbGVYfX19ZnVuY3Rpb24gcGFnZUNvb3Jkcyhwb3Mpe3ZhciBs
			b2NhbD1sb2NhbENvb3Jkcyhwb3MsdHJ1ZSksb2ZmPWVsdE9mZnNldChsaW5lU3BhY2UpOyByZXR1
			cm57eDpvZmYubGVmdCtsb2NhbC54LHk6b2ZmLnRvcCtsb2NhbC55LHlCb3Q6b2ZmLnRvcCtsb2Nh
			bC55Qm90fX12YXIgY2FjaGVkSGVpZ2h0LGNhY2hlZEhlaWdodEZvcixtZWFzdXJlVGV4dDtmdW5j
			dGlvbiB0ZXh0SGVpZ2h0KCl7aWYobWVhc3VyZVRleHQ9PW51bGwpe21lYXN1cmVUZXh0PSI8cHJl
			PiI7Zm9yKHZhciBpPTA7aTw0OTsrK2kpbWVhc3VyZVRleHQrPSJ4PGJyLz4iO21lYXN1cmVUZXh0
			Kz0ieDwvcHJlPiJ9dmFyIG9mZnNldEhlaWdodD1saW5lRGl2LmNsaWVudEhlaWdodDtpZihvZmZz
			ZXRIZWlnaHQ9PWNhY2hlZEhlaWdodEZvcilyZXR1cm4gY2FjaGVkSGVpZ2h0O2NhY2hlZEhlaWdo
			dEZvcj1vZmZzZXRIZWlnaHQ7bWVhc3VyZS5pbm5lckhUTUw9bWVhc3VyZVRleHQ7Y2FjaGVkSGVp
			Z2h0PW1lYXN1cmUuZmlyc3RDaGlsZC5vZmZzZXRIZWlnaHQvNTB8fDE7bWVhc3VyZS5pbm5lckhU
			TUw9IiI7cmV0dXJuIGNhY2hlZEhlaWdodH12YXIgY2FjaGVkV2lkdGgsIGNhY2hlZFdpZHRoRm9y
			PTA7ZnVuY3Rpb24gY2hhcldpZHRoKCl7aWYoc2Nyb2xsZXIuY2xpZW50V2lkdGg9PWNhY2hlZFdp
			ZHRoRm9yKXJldHVybiBjYWNoZWRXaWR0aDtjYWNoZWRXaWR0aEZvcj1zY3JvbGxlci5jbGllbnRX
			aWR0aDtyZXR1cm4gY2FjaGVkV2lkdGg9c3RyaW5nV2lkdGgoIngiKX1mdW5jdGlvbiBwYWRkaW5n
			VG9wKCl7cmV0dXJuIGxpbmVTcGFjZS5vZmZzZXRUb3B9ZnVuY3Rpb24gcGFkZGluZ0xlZnQoKXty
			ZXR1cm4gbGluZVNwYWNlLm9mZnNldExlZnR9ZnVuY3Rpb24gcG9zRnJvbU1vdXNlKGUsbGliZXJh
			bCl7dmFyIG9mZlc9ZWx0T2Zmc2V0KHNjcm9sbGVyLHRydWUpLHgseTt0cnl7eD1lLmNsaWVudFg7
			eT1lLmNsaWVudFl9Y2F0Y2goZSl7cmV0dXJuIG51bGx9aWYoIWxpYmVyYWwmJih4LW9mZlcubGVm
			dD5zY3JvbGxlci5jbGllbnRXaWR0aHx8eS1vZmZXLnRvcD5zY3JvbGxlci5jbGllbnRIZWlnaHQp
			KXJldHVybiBudWxsO3ZhciBvZmZMPWVsdE9mZnNldChsaW5lU3BhY2UsIHRydWUpO3JldHVybiBj
			b29yZHNDaGFyKHgtb2ZmTC5sZWZ0LHktb2ZmTC50b3ApfWZ1bmN0aW9uIG9uQ29udGV4dE1lbnUo
			ZSl7dmFyIHBvcz1wb3NGcm9tTW91c2UoZSksc2Nyb2xsUG9zPXNjcm9sbGVyLnNjcm9sbFRvcDtp
			ZighcG9zfHx3aW5kb3cub3BlcmEpcmV0dXJuO2lmKHBvc0VxKHNlbC5mcm9tLHNlbC50byl8fHBv
			c0xlc3MocG9zLHNlbC5mcm9tKXx8IXBvc0xlc3MocG9zLHNlbC50bykpb3BlcmF0aW9uKHNldEN1
			cnNvcikocG9zLmxpbmUscG9zLmNoKTt2YXIgb2xkQ1NTPWlucHV0LnN0eWxlLmNzc1RleHQ7aW5w
			dXREaXYuc3R5bGUucG9zaXRpb249ImFic29sdXRlIjtpbnB1dC5zdHlsZS5jc3NUZXh0PSJwb3Np
			dGlvbjogZml4ZWQ7IHdpZHRoOiAzMHB4OyBoZWlnaHQ6IDMwcHg7IHRvcDogIisoZS5jbGllbnRZ
			LTUpKyJweDsgbGVmdDogIisoZS5jbGllbnRYLTUpKyJweDsgei1pbmRleDogMTAwMDsgYmFja2dy
			b3VuZDogd2hpdGU7ICIrImJvcmRlci13aWR0aDogMDsgb3V0bGluZTogbm9uZTsgb3ZlcmZsb3c6
			IGhpZGRlbjsgb3BhY2l0eTogLjA1OyBmaWx0ZXI6IGFscGhhKG9wYWNpdHk9NSk7IjsgbGVhdmVJ
			bnB1dEFsb25lPXRydWU7dmFyIHZhbD1pbnB1dC52YWx1ZT1nZXRTZWxlY3Rpb24oKTtmb2N1c0lu
			cHV0KCk7c2VsZWN0SW5wdXQoaW5wdXQpO2Z1bmN0aW9uIHJlaGlkZSgpe3ZhciBuZXdWYWw9c3Bs
			aXRMaW5lcyhpbnB1dC52YWx1ZSkuam9pbigiXG4iKTtpZihuZXdWYWwhPXZhbClvcGVyYXRpb24o
			cmVwbGFjZVNlbGVjdGlvbikobmV3VmFsLCJlbmQiKTtpbnB1dERpdi5zdHlsZS5wb3NpdGlvbj0i
			cmVsYXRpdmUiO2lucHV0LnN0eWxlLmNzc1RleHQ9b2xkQ1NTO2lmKGllX2x0OSlzY3JvbGxlci5z
			Y3JvbGxUb3A9c2Nyb2xsUG9zO2xlYXZlSW5wdXRBbG9uZT1mYWxzZTtyZXNldElucHV0KHRydWUp
			O3Nsb3dQb2xsKCl9aWYoZ2Vja28pe2Vfc3RvcChlKTt2YXIgbW91c2V1cD1jb25uZWN0KHdpbmRv
			dywibW91c2V1cCIsZnVuY3Rpb24oKXttb3VzZXVwKCk7c2V0VGltZW91dChyZWhpZGUsMjApfSx0
			cnVlKX1lbHNlIHNldFRpbWVvdXQocmVoaWRlLDUwKX1mdW5jdGlvbiByZXN0YXJ0QmxpbmsoKXtj
			bGVhckludGVydmFsKGJsaW5rZXIpOyB2YXIgb249dHJ1ZTtjdXJzb3Iuc3R5bGUudmlzaWJpbGl0
			eT0iIjtibGlua2VyPXNldEludGVydmFsKGZ1bmN0aW9uKCl7Y3Vyc29yLnN0eWxlLnZpc2liaWxp
			dHk9KG9uPSFvbik/IiI6ImhpZGRlbiJ9LDY1MCl9dmFyIG1hdGNoaW5nPXsiKCI6Iik+IiwiKSI6
			Iig8IiwiWyI6Il0+IiwiXSI6Ils8IiwieyI6In0+IiwifSI6Ins8In07ZnVuY3Rpb24gbWF0Y2hC
			cmFja2V0cyhhdXRvY2xlYXIpe3ZhciBoZWFkPXNlbC5pbnZlcnRlZD9zZWwuZnJvbTpzZWwudG8s
			bGluZT1nZXRMaW5lKGhlYWQubGluZSkscG9zPWhlYWQuY2gtMTt2YXIgbWF0Y2g9cG9zPj0wJiZt
			YXRjaGluZ1tsaW5lLnRleHQuY2hhckF0KHBvcyldfHxtYXRjaGluZ1tsaW5lLnRleHQuY2hhckF0
			KCsrcG9zKV07aWYoIW1hdGNoKXJldHVybjt2YXIgY2g9bWF0Y2guY2hhckF0KDApLGZvcndhcmQ9
			bWF0Y2guY2hhckF0KDEpPT0iPiIsZD1mb3J3YXJkPzE6LTEsc3Q9bGluZS5zdHlsZXM7Zm9yKHZh
			ciBvZmY9cG9zKzEsIGk9MCxlPXN0Lmxlbmd0aDtpPGU7aSs9MilpZigob2ZmLT1zdFtpXS5sZW5n
			dGgpPD0wKXt2YXIgc3R5bGU9c3RbaSsxXTticmVha312YXIgc3RhY2s9W2xpbmUudGV4dC5jaGFy
			QXQocG9zKV0scmU9L1soKXt9W1xdXS87ZnVuY3Rpb24gc2NhbihsaW5lLGZyb20sdG8pe2lmKCFs
			aW5lLnRleHQpcmV0dXJuO3ZhciBzdD1saW5lLnN0eWxlcyxwb3M9Zm9yd2FyZD8wOmxpbmUudGV4
			dC5sZW5ndGgtMSxjdXI7Zm9yKHZhciBpPWZvcndhcmQ/MDpzdC5sZW5ndGgtMixlPWZvcndhcmQ/
			c3QubGVuZ3RoOi0yO2khPWU7aSs9MipkKXt2YXIgdGV4dD1zdFtpXTtpZihzdFtpKzFdIT1udWxs
			JiZzdFtpKzFdIT1zdHlsZSl7cG9zKz1kKnRleHQubGVuZ3RoO2NvbnRpbnVlfWZvcih2YXIgaj1m
			b3J3YXJkPzA6dGV4dC5sZW5ndGgtMSx0ZT1mb3J3YXJkP3RleHQubGVuZ3RoOi0xO2ohPXRlO2or
			PWQscG9zKz1kKWlmKHBvcz49ZnJvbSYmcG9zPHRvJiZyZS50ZXN0KGN1cj10ZXh0LmNoYXJBdChq
			KSkpe3ZhciBtYXRjaD0gbWF0Y2hpbmdbY3VyXTtpZihtYXRjaC5jaGFyQXQoMSk9PSI+Ij09Zm9y
			d2FyZClzdGFjay5wdXNoKGN1cik7ZWxzZSBpZihzdGFjay5wb3AoKSE9bWF0Y2guY2hhckF0KDAp
			KXJldHVybntwb3M6cG9zLG1hdGNoOmZhbHNlfTtlbHNlIGlmKCFzdGFjay5sZW5ndGgpcmV0dXJu
			e3Bvczpwb3MsbWF0Y2g6dHJ1ZX19fX1mb3IodmFyIGk9aGVhZC5saW5lLGU9Zm9yd2FyZD9NYXRo
			Lm1pbihpKzEwMCxkb2Muc2l6ZSk6TWF0aC5tYXgoLTEsaS0xMDApO2khPWU7aSs9ZCl7dmFyIGxp
			bmU9Z2V0TGluZShpKSxmaXJzdD1pPT1oZWFkLmxpbmU7dmFyIGZvdW5kPXNjYW4obGluZSxmaXJz
			dCYmZm9yd2FyZD9wb3MrMTowLGZpcnN0JiYhZm9yd2FyZD9wb3M6bGluZS50ZXh0Lmxlbmd0aCk7
			aWYoZm91bmQpYnJlYWt9aWYoIWZvdW5kKWZvdW5kPXtwb3M6bnVsbCxtYXRjaDpmYWxzZX07dmFy
			IHN0eWxlPWZvdW5kLm1hdGNoPyJDb2RlTWlycm9yLW1hdGNoaW5nYnJhY2tldCI6IkNvZGVNaXJy
			b3Itbm9ubWF0Y2hpbmdicmFja2V0IjsgdmFyIG9uZT1tYXJrVGV4dCh7bGluZTpoZWFkLmxpbmUs
			Y2g6cG9zfSx7bGluZTpoZWFkLmxpbmUsY2g6cG9zKzF9LHN0eWxlKSx0d289Zm91bmQucG9zIT1u
			dWxsJiZtYXJrVGV4dCh7bGluZTppLGNoOmZvdW5kLnBvc30se2xpbmU6aSxjaDpmb3VuZC5wb3Mr
			MX0sc3R5bGUpO3ZhciBjbGVhcj1vcGVyYXRpb24oZnVuY3Rpb24oKXtvbmUuY2xlYXIoKTt0d28m
			JnR3by5jbGVhcigpfSk7aWYoYXV0b2NsZWFyKXNldFRpbWVvdXQoY2xlYXIsODAwKTtlbHNlIGJy
			YWNrZXRIaWdobGlnaHRlZD1jbGVhcn1mdW5jdGlvbiBmaW5kU3RhcnRMaW5lKG4pe3ZhciBtaW5p
			bmRlbnQsbWlubGluZTtmb3IodmFyIHNlYXJjaD1uLGxpbT1uLTQwO3NlYXJjaD5saW07LS1zZWFy
			Y2gpe2lmKHNlYXJjaD09MClyZXR1cm4gMDt2YXIgbGluZT1nZXRMaW5lKHNlYXJjaC0xKTtpZihs
			aW5lLnN0YXRlQWZ0ZXIpcmV0dXJuIHNlYXJjaDt2YXIgaW5kZW50ZWQ9bGluZS5pbmRlbnRhdGlv
			bihvcHRpb25zLnRhYlNpemUpOyBpZihtaW5saW5lPT1udWxsfHxtaW5pbmRlbnQ+aW5kZW50ZWQp
			e21pbmxpbmU9c2VhcmNoLTE7bWluaW5kZW50PWluZGVudGVkfX1yZXR1cm4gbWlubGluZX1mdW5j
			dGlvbiBnZXRTdGF0ZUJlZm9yZShuKXt2YXIgc3RhcnQ9ZmluZFN0YXJ0TGluZShuKSxzdGF0ZT1z
			dGFydCYmZ2V0TGluZShzdGFydC0xKS5zdGF0ZUFmdGVyO2lmKCFzdGF0ZSlzdGF0ZT1zdGFydFN0
			YXRlKG1vZGUpO2Vsc2Ugc3RhdGU9Y29weVN0YXRlKG1vZGUsc3RhdGUpO2RvYy5pdGVyKHN0YXJ0
			LG4sZnVuY3Rpb24obGluZSl7bGluZS5oaWdobGlnaHQobW9kZSxzdGF0ZSxvcHRpb25zLnRhYlNp
			emUpO2xpbmUuc3RhdGVBZnRlcj1jb3B5U3RhdGUobW9kZSxzdGF0ZSl9KTtpZihzdGFydDxuKWNo
			YW5nZXMucHVzaCh7ZnJvbTpzdGFydCx0bzpufSk7aWYobjxkb2Muc2l6ZSYmIWdldExpbmUobiku
			c3RhdGVBZnRlcil3b3JrLnB1c2gobik7cmV0dXJuIHN0YXRlfWZ1bmN0aW9uIGhpZ2hsaWdodExp
			bmVzKHN0YXJ0LCBlbmQpe3ZhciBzdGF0ZT1nZXRTdGF0ZUJlZm9yZShzdGFydCk7ZG9jLml0ZXIo
			c3RhcnQsZW5kLGZ1bmN0aW9uKGxpbmUpe2xpbmUuaGlnaGxpZ2h0KG1vZGUsc3RhdGUsb3B0aW9u
			cy50YWJTaXplKTtsaW5lLnN0YXRlQWZ0ZXI9Y29weVN0YXRlKG1vZGUsc3RhdGUpfSl9ZnVuY3Rp
			b24gaGlnaGxpZ2h0V29ya2VyKCl7dmFyIGVuZD0rbmV3IERhdGUrb3B0aW9ucy53b3JrVGltZTt2
			YXIgZm91bmRXb3JrPXdvcmsubGVuZ3RoO3doaWxlKHdvcmsubGVuZ3RoKXtpZighZ2V0TGluZShz
			aG93aW5nRnJvbSkuc3RhdGVBZnRlcil2YXIgdGFzaz1zaG93aW5nRnJvbTtlbHNlIHZhciB0YXNr
			PXdvcmsucG9wKCk7aWYodGFzaz49ZG9jLnNpemUpY29udGludWU7dmFyIHN0YXJ0PWZpbmRTdGFy
			dExpbmUodGFzayksc3RhdGU9c3RhcnQmJmdldExpbmUoc3RhcnQtMSkuc3RhdGVBZnRlcjtpZihz
			dGF0ZSlzdGF0ZT1jb3B5U3RhdGUobW9kZSxzdGF0ZSk7ZWxzZSBzdGF0ZT1zdGFydFN0YXRlKG1v
			ZGUpOyB2YXIgdW5jaGFuZ2VkPTAsY29tcGFyZT1tb2RlLmNvbXBhcmVTdGF0ZXMscmVhbENoYW5n
			ZT1mYWxzZSxpPXN0YXJ0LGJhaWw9ZmFsc2U7ZG9jLml0ZXIoaSxkb2Muc2l6ZSxmdW5jdGlvbihs
			aW5lKXt2YXIgaGFkU3RhdGU9bGluZS5zdGF0ZUFmdGVyO2lmKCtuZXcgRGF0ZT5lbmQpe3dvcmsu
			cHVzaChpKTtzdGFydFdvcmtlcihvcHRpb25zLndvcmtEZWxheSk7aWYocmVhbENoYW5nZSljaGFu
			Z2VzLnB1c2goe2Zyb206dGFzayx0bzppKzF9KTtyZXR1cm4gYmFpbD10cnVlfXZhciBjaGFuZ2Vk
			PWxpbmUuaGlnaGxpZ2h0KG1vZGUsc3RhdGUsb3B0aW9ucy50YWJTaXplKTtpZihjaGFuZ2VkKXJl
			YWxDaGFuZ2U9dHJ1ZTtsaW5lLnN0YXRlQWZ0ZXI9Y29weVN0YXRlKG1vZGUsc3RhdGUpO2lmKGNv
			bXBhcmUpe2lmKGhhZFN0YXRlJiZjb21wYXJlKGhhZFN0YXRlLHN0YXRlKSlyZXR1cm4gdHJ1ZX1l
			bHNlIGlmKGNoYW5nZWQhPT1mYWxzZXx8IWhhZFN0YXRlKXVuY2hhbmdlZD0wO2Vsc2UgaWYoKyt1
			bmNoYW5nZWQ+IDMmJighbW9kZS5pbmRlbnR8fG1vZGUuaW5kZW50KGhhZFN0YXRlLCIiKT09bW9k
			ZS5pbmRlbnQoc3RhdGUsIiIpKSlyZXR1cm4gdHJ1ZTsrK2l9KTtpZihiYWlsKXJldHVybjtpZihy
			ZWFsQ2hhbmdlKWNoYW5nZXMucHVzaCh7ZnJvbTp0YXNrLHRvOmkrMX0pfWlmKGZvdW5kV29yayYm
			b3B0aW9ucy5vbkhpZ2hsaWdodENvbXBsZXRlKW9wdGlvbnMub25IaWdobGlnaHRDb21wbGV0ZShp
			bnN0YW5jZSl9ZnVuY3Rpb24gc3RhcnRXb3JrZXIodGltZSl7aWYoIXdvcmsubGVuZ3RoKXJldHVy
			bjtoaWdobGlnaHQuc2V0KHRpbWUsb3BlcmF0aW9uKGhpZ2hsaWdodFdvcmtlcikpfWZ1bmN0aW9u
			IHN0YXJ0T3BlcmF0aW9uKCl7dXBkYXRlSW5wdXQ9dXNlclNlbENoYW5nZT10ZXh0Q2hhbmdlZD1u
			dWxsO2NoYW5nZXM9W107c2VsZWN0aW9uQ2hhbmdlZD1mYWxzZTtjYWxsYmFja3M9W119ZnVuY3Rp
			b24gZW5kT3BlcmF0aW9uKCl7dmFyIHJlU2Nyb2xsPWZhbHNlLHVwZGF0ZWQ7aWYoc2VsZWN0aW9u
			Q2hhbmdlZClyZVNjcm9sbD0gIXNjcm9sbEN1cnNvckludG9WaWV3KCk7aWYoY2hhbmdlcy5sZW5n
			dGgpdXBkYXRlZD11cGRhdGVEaXNwbGF5KGNoYW5nZXMsdHJ1ZSk7ZWxzZXtpZihzZWxlY3Rpb25D
			aGFuZ2VkKXVwZGF0ZVNlbGVjdGlvbigpO2lmKGd1dHRlckRpcnR5KXVwZGF0ZUd1dHRlcigpfWlm
			KHJlU2Nyb2xsKXNjcm9sbEN1cnNvckludG9WaWV3KCk7aWYoc2VsZWN0aW9uQ2hhbmdlZCl7c2Ny
			b2xsRWRpdG9ySW50b1ZpZXcoKTtyZXN0YXJ0QmxpbmsoKX1pZihmb2N1c2VkJiYhbGVhdmVJbnB1
			dEFsb25lJiYodXBkYXRlSW5wdXQ9PT10cnVlfHx1cGRhdGVJbnB1dCE9PWZhbHNlJiZzZWxlY3Rp
			b25DaGFuZ2VkKSlyZXNldElucHV0KHVzZXJTZWxDaGFuZ2UpO2lmKHNlbGVjdGlvbkNoYW5nZWQm
			Jm9wdGlvbnMubWF0Y2hCcmFja2V0cylzZXRUaW1lb3V0KG9wZXJhdGlvbihmdW5jdGlvbigpe2lm
			KGJyYWNrZXRIaWdobGlnaHRlZCl7YnJhY2tldEhpZ2hsaWdodGVkKCk7YnJhY2tldEhpZ2hsaWdo
			dGVkPW51bGx9aWYocG9zRXEoc2VsLmZyb20sIHNlbC50bykpbWF0Y2hCcmFja2V0cyhmYWxzZSl9
			KSwyMCk7dmFyIHRjPXRleHRDaGFuZ2VkLGNicz1jYWxsYmFja3M7aWYoc2VsZWN0aW9uQ2hhbmdl
			ZCYmb3B0aW9ucy5vbkN1cnNvckFjdGl2aXR5KW9wdGlvbnMub25DdXJzb3JBY3Rpdml0eShpbnN0
			YW5jZSk7aWYodGMmJm9wdGlvbnMub25DaGFuZ2UmJmluc3RhbmNlKW9wdGlvbnMub25DaGFuZ2Uo
			aW5zdGFuY2UsdGMpO2Zvcih2YXIgaT0wO2k8Y2JzLmxlbmd0aDsrK2kpY2JzW2ldKGluc3RhbmNl
			KTtpZih1cGRhdGVkJiZvcHRpb25zLm9uVXBkYXRlKW9wdGlvbnMub25VcGRhdGUoaW5zdGFuY2Up
			fXZhciBuZXN0ZWRPcGVyYXRpb249MDtmdW5jdGlvbiBvcGVyYXRpb24oZil7cmV0dXJuIGZ1bmN0
			aW9uKCl7aWYoIW5lc3RlZE9wZXJhdGlvbisrKXN0YXJ0T3BlcmF0aW9uKCk7dHJ5e3ZhciByZXN1
			bHQ9Zi5hcHBseSh0aGlzLGFyZ3VtZW50cyl9ZmluYWxseXtpZighLS1uZXN0ZWRPcGVyYXRpb24p
			ZW5kT3BlcmF0aW9uKCl9cmV0dXJuIHJlc3VsdH19IGZvcih2YXIgZXh0IGluIGV4dGVuc2lvbnMp
			aWYoZXh0ZW5zaW9ucy5wcm9wZXJ0eUlzRW51bWVyYWJsZShleHQpJiYhaW5zdGFuY2UucHJvcGVy
			dHlJc0VudW1lcmFibGUoZXh0KSlpbnN0YW5jZVtleHRdPWV4dGVuc2lvbnNbZXh0XTtyZXR1cm4g
			aW5zdGFuY2V9Q29kZU1pcnJvci5kZWZhdWx0cz17dmFsdWU6IiIsbW9kZTpudWxsLHRoZW1lOiJk
			ZWZhdWx0IixpbmRlbnRVbml0OjIsaW5kZW50V2l0aFRhYnM6ZmFsc2Usc21hcnRJbmRlbnQ6dHJ1
			ZSx0YWJTaXplOjQsa2V5TWFwOiJkZWZhdWx0IixleHRyYUtleXM6bnVsbCxlbGVjdHJpY0NoYXJz
			OnRydWUsYXV0b0NsZWFyRW1wdHlMaW5lczpmYWxzZSxvbktleUV2ZW50Om51bGwsbGluZVdyYXBw
			aW5nOmZhbHNlLGxpbmVOdW1iZXJzOmZhbHNlLGd1dHRlcjpmYWxzZSxmaXhlZEd1dHRlcjpmYWxz
			ZSxmaXJzdExpbmVOdW1iZXI6MSxyZWFkT25seTpmYWxzZSxvbkNoYW5nZTpudWxsLG9uQ3Vyc29y
			QWN0aXZpdHk6bnVsbCxvbkd1dHRlckNsaWNrOm51bGwsIG9uSGlnaGxpZ2h0Q29tcGxldGU6bnVs
			bCxvblVwZGF0ZTpudWxsLG9uRm9jdXM6bnVsbCxvbkJsdXI6bnVsbCxvblNjcm9sbDpudWxsLG1h
			dGNoQnJhY2tldHM6ZmFsc2Usd29ya1RpbWU6MTAwLHdvcmtEZWxheToyMDAscG9sbEludGVydmFs
			OjEwMCx1bmRvRGVwdGg6NDAsdGFiaW5kZXg6bnVsbCxkb2N1bWVudDp3aW5kb3cuZG9jdW1lbnR9
			O3ZhciBpb3M9L0FwcGxlV2ViS2l0Ly50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpJiYvTW9iaWxl
			XC9cdysvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7dmFyIG1hYz1pb3N8fC9NYWMvLnRlc3Qo
			bmF2aWdhdG9yLnBsYXRmb3JtKTt2YXIgd2luPS9XaW4vLnRlc3QobmF2aWdhdG9yLnBsYXRmb3Jt
			KTt2YXIgbW9kZXM9e30sbWltZU1vZGVzPXt9O0NvZGVNaXJyb3IuZGVmaW5lTW9kZT1mdW5jdGlv
			bihuYW1lLG1vZGUpe2lmKCFDb2RlTWlycm9yLmRlZmF1bHRzLm1vZGUmJm5hbWUhPSJudWxsIilD
			b2RlTWlycm9yLmRlZmF1bHRzLm1vZGU9IG5hbWU7bW9kZXNbbmFtZV09bW9kZX07Q29kZU1pcnJv
			ci5kZWZpbmVNSU1FPWZ1bmN0aW9uKG1pbWUsc3BlYyl7bWltZU1vZGVzW21pbWVdPXNwZWN9O0Nv
			ZGVNaXJyb3IucmVzb2x2ZU1vZGU9ZnVuY3Rpb24oc3BlYyl7aWYodHlwZW9mIHNwZWM9PSJzdHJp
			bmciJiZtaW1lTW9kZXMuaGFzT3duUHJvcGVydHkoc3BlYykpc3BlYz1taW1lTW9kZXNbc3BlY107
			aWYodHlwZW9mIHNwZWM9PSJzdHJpbmciKXJldHVybntuYW1lOnNwZWN9O2Vsc2UgcmV0dXJuIHNw
			ZWN8fHtuYW1lOiJudWxsIn19O0NvZGVNaXJyb3IuZ2V0TW9kZT1mdW5jdGlvbihvcHRpb25zLHNw
			ZWMpe3ZhciBzcGVjPUNvZGVNaXJyb3IucmVzb2x2ZU1vZGUoc3BlYyk7dmFyIG1mYWN0b3J5PW1v
			ZGVzW3NwZWMubmFtZV07aWYoIW1mYWN0b3J5KXtpZih3aW5kb3cuY29uc29sZSljb25zb2xlLndh
			cm4oIk5vIG1vZGUgIitzcGVjLm5hbWUrIiBmb3VuZCwgZmFsbGluZyBiYWNrIHRvIHBsYWluIHRl
			eHQuIik7cmV0dXJuIENvZGVNaXJyb3IuZ2V0TW9kZShvcHRpb25zLCAidGV4dC9wbGFpbiIpfXJl
			dHVybiBtZmFjdG9yeShvcHRpb25zLHNwZWMpfTtDb2RlTWlycm9yLmxpc3RNb2Rlcz1mdW5jdGlv
			bigpe3ZhciBsaXN0PVtdO2Zvcih2YXIgbSBpbiBtb2RlcylpZihtb2Rlcy5wcm9wZXJ0eUlzRW51
			bWVyYWJsZShtKSlsaXN0LnB1c2gobSk7cmV0dXJuIGxpc3R9O0NvZGVNaXJyb3IubGlzdE1JTUVz
			PWZ1bmN0aW9uKCl7dmFyIGxpc3Q9W107Zm9yKHZhciBtIGluIG1pbWVNb2RlcylpZihtaW1lTW9k
			ZXMucHJvcGVydHlJc0VudW1lcmFibGUobSkpbGlzdC5wdXNoKHttaW1lOm0sbW9kZTptaW1lTW9k
			ZXNbbV19KTtyZXR1cm4gbGlzdH07dmFyIGV4dGVuc2lvbnM9Q29kZU1pcnJvci5leHRlbnNpb25z
			PXt9O0NvZGVNaXJyb3IuZGVmaW5lRXh0ZW5zaW9uPWZ1bmN0aW9uKG5hbWUsZnVuYyl7ZXh0ZW5z
			aW9uc1tuYW1lXT1mdW5jfTt2YXIgY29tbWFuZHM9Q29kZU1pcnJvci5jb21tYW5kcz17c2VsZWN0
			QWxsOmZ1bmN0aW9uKGNtKXtjbS5zZXRTZWxlY3Rpb24oe2xpbmU6MCwgY2g6MH0se2xpbmU6Y20u
			bGluZUNvdW50KCktMX0pfSxraWxsTGluZTpmdW5jdGlvbihjbSl7dmFyIGZyb209Y20uZ2V0Q3Vy
			c29yKHRydWUpLHRvPWNtLmdldEN1cnNvcihmYWxzZSksc2VsPSFwb3NFcShmcm9tLHRvKTtpZigh
			c2VsJiZjbS5nZXRMaW5lKGZyb20ubGluZSkubGVuZ3RoPT1mcm9tLmNoKWNtLnJlcGxhY2VSYW5n
			ZSgiIixmcm9tLHtsaW5lOmZyb20ubGluZSsxLGNoOjB9KTtlbHNlIGNtLnJlcGxhY2VSYW5nZSgi
			Iixmcm9tLHNlbD90bzp7bGluZTpmcm9tLmxpbmV9KX0sZGVsZXRlTGluZTpmdW5jdGlvbihjbSl7
			dmFyIGw9Y20uZ2V0Q3Vyc29yKCkubGluZTtjbS5yZXBsYWNlUmFuZ2UoIiIse2xpbmU6bCxjaDow
			fSx7bGluZTpsfSl9LHVuZG86ZnVuY3Rpb24oY20pe2NtLnVuZG8oKX0scmVkbzpmdW5jdGlvbihj
			bSl7Y20ucmVkbygpfSxnb0RvY1N0YXJ0OmZ1bmN0aW9uKGNtKXtjbS5zZXRDdXJzb3IoMCwwLHRy
			dWUpfSxnb0RvY0VuZDpmdW5jdGlvbihjbSl7Y20uc2V0U2VsZWN0aW9uKHtsaW5lOmNtLmxpbmVD
			b3VudCgpLSAxfSxudWxsLHRydWUpfSxnb0xpbmVTdGFydDpmdW5jdGlvbihjbSl7Y20uc2V0Q3Vy
			c29yKGNtLmdldEN1cnNvcigpLmxpbmUsMCx0cnVlKX0sZ29MaW5lU3RhcnRTbWFydDpmdW5jdGlv
			bihjbSl7dmFyIGN1cj1jbS5nZXRDdXJzb3IoKTt2YXIgdGV4dD1jbS5nZXRMaW5lKGN1ci5saW5l
			KSxmaXJzdE5vbldTPU1hdGgubWF4KDAsdGV4dC5zZWFyY2goL1xTLykpO2NtLnNldEN1cnNvcihj
			dXIubGluZSxjdXIuY2g8PWZpcnN0Tm9uV1MmJmN1ci5jaD8wOmZpcnN0Tm9uV1MsdHJ1ZSl9LGdv
			TGluZUVuZDpmdW5jdGlvbihjbSl7Y20uc2V0U2VsZWN0aW9uKHtsaW5lOmNtLmdldEN1cnNvcigp
			LmxpbmV9LG51bGwsdHJ1ZSl9LGdvTGluZVVwOmZ1bmN0aW9uKGNtKXtjbS5tb3ZlVigtMSwibGlu
			ZSIpfSxnb0xpbmVEb3duOmZ1bmN0aW9uKGNtKXtjbS5tb3ZlVigxLCJsaW5lIil9LGdvUGFnZVVw
			OmZ1bmN0aW9uKGNtKXtjbS5tb3ZlVigtMSwicGFnZSIpfSxnb1BhZ2VEb3duOmZ1bmN0aW9uKGNt
			KXtjbS5tb3ZlVigxLCAicGFnZSIpfSxnb0NoYXJMZWZ0OmZ1bmN0aW9uKGNtKXtjbS5tb3ZlSCgt
			MSwiY2hhciIpfSxnb0NoYXJSaWdodDpmdW5jdGlvbihjbSl7Y20ubW92ZUgoMSwiY2hhciIpfSxn
			b0NvbHVtbkxlZnQ6ZnVuY3Rpb24oY20pe2NtLm1vdmVIKC0xLCJjb2x1bW4iKX0sZ29Db2x1bW5S
			aWdodDpmdW5jdGlvbihjbSl7Y20ubW92ZUgoMSwiY29sdW1uIil9LGdvV29yZExlZnQ6ZnVuY3Rp
			b24oY20pe2NtLm1vdmVIKC0xLCJ3b3JkIil9LGdvV29yZFJpZ2h0OmZ1bmN0aW9uKGNtKXtjbS5t
			b3ZlSCgxLCJ3b3JkIil9LGRlbENoYXJMZWZ0OmZ1bmN0aW9uKGNtKXtjbS5kZWxldGVIKC0xLCJj
			aGFyIil9LGRlbENoYXJSaWdodDpmdW5jdGlvbihjbSl7Y20uZGVsZXRlSCgxLCJjaGFyIil9LGRl
			bFdvcmRMZWZ0OmZ1bmN0aW9uKGNtKXtjbS5kZWxldGVIKC0xLCJ3b3JkIil9LGRlbFdvcmRSaWdo
			dDpmdW5jdGlvbihjbSl7Y20uZGVsZXRlSCgxLCJ3b3JkIil9LGluZGVudEF1dG86ZnVuY3Rpb24o
			Y20pe2NtLmluZGVudFNlbGVjdGlvbigic21hcnQiKX0sIGluZGVudE1vcmU6ZnVuY3Rpb24oY20p
			e2NtLmluZGVudFNlbGVjdGlvbigiYWRkIil9LGluZGVudExlc3M6ZnVuY3Rpb24oY20pe2NtLmlu
			ZGVudFNlbGVjdGlvbigic3VidHJhY3QiKX0saW5zZXJ0VGFiOmZ1bmN0aW9uKGNtKXtjbS5yZXBs
			YWNlU2VsZWN0aW9uKCJcdCIsImVuZCIpfSx0cmFuc3Bvc2VDaGFyczpmdW5jdGlvbihjbSl7dmFy
			IGN1cj1jbS5nZXRDdXJzb3IoKSxsaW5lPWNtLmdldExpbmUoY3VyLmxpbmUpO2lmKGN1ci5jaD4w
			JiZjdXIuY2g8bGluZS5sZW5ndGgtMSljbS5yZXBsYWNlUmFuZ2UobGluZS5jaGFyQXQoY3VyLmNo
			KStsaW5lLmNoYXJBdChjdXIuY2gtMSkse2xpbmU6Y3VyLmxpbmUsY2g6Y3VyLmNoLTF9LHtsaW5l
			OmN1ci5saW5lLGNoOmN1ci5jaCsxfSl9LG5ld2xpbmVBbmRJbmRlbnQ6ZnVuY3Rpb24oY20pe2Nt
			LnJlcGxhY2VTZWxlY3Rpb24oIlxuIiwiZW5kIik7Y20uaW5kZW50TGluZShjbS5nZXRDdXJzb3Io
			KS5saW5lKX0sdG9nZ2xlT3ZlcndyaXRlOmZ1bmN0aW9uKGNtKXtjbS50b2dnbGVPdmVyd3JpdGUo
			KX19OyB2YXIga2V5TWFwPUNvZGVNaXJyb3Iua2V5TWFwPXt9O2tleU1hcC5iYXNpYz17IkxlZnQi
			OiJnb0NoYXJMZWZ0IiwiUmlnaHQiOiJnb0NoYXJSaWdodCIsIlVwIjoiZ29MaW5lVXAiLCJEb3du
			IjoiZ29MaW5lRG93biIsIkVuZCI6ImdvTGluZUVuZCIsIkhvbWUiOiJnb0xpbmVTdGFydFNtYXJ0
			IiwiUGFnZVVwIjoiZ29QYWdlVXAiLCJQYWdlRG93biI6ImdvUGFnZURvd24iLCJEZWxldGUiOiJk
			ZWxDaGFyUmlnaHQiLCJCYWNrc3BhY2UiOiJkZWxDaGFyTGVmdCIsIlRhYiI6ImluZGVudE1vcmUi
			LCJTaGlmdC1UYWIiOiJpbmRlbnRMZXNzIiwiRW50ZXIiOiJuZXdsaW5lQW5kSW5kZW50IiwiSW5z
			ZXJ0IjoidG9nZ2xlT3ZlcndyaXRlIn07a2V5TWFwLnBjRGVmYXVsdD17IkN0cmwtQSI6InNlbGVj
			dEFsbCIsIkN0cmwtRCI6ImRlbGV0ZUxpbmUiLCJDdHJsLVoiOiJ1bmRvIiwiU2hpZnQtQ3RybC1a
			IjoicmVkbyIsIkN0cmwtWSI6InJlZG8iLCJDdHJsLUhvbWUiOiJnb0RvY1N0YXJ0IiwgIkFsdC1V
			cCI6ImdvRG9jU3RhcnQiLCJDdHJsLUVuZCI6ImdvRG9jRW5kIiwiQ3RybC1Eb3duIjoiZ29Eb2NF
			bmQiLCJDdHJsLUxlZnQiOiJnb1dvcmRMZWZ0IiwiQ3RybC1SaWdodCI6ImdvV29yZFJpZ2h0Iiwi
			QWx0LUxlZnQiOiJnb0xpbmVTdGFydCIsIkFsdC1SaWdodCI6ImdvTGluZUVuZCIsIkN0cmwtQmFj
			a3NwYWNlIjoiZGVsV29yZExlZnQiLCJDdHJsLURlbGV0ZSI6ImRlbFdvcmRSaWdodCIsIkN0cmwt
			UyI6InNhdmUiLCJDdHJsLUYiOiJmaW5kIiwiQ3RybC1HIjoiZmluZE5leHQiLCJTaGlmdC1DdHJs
			LUciOiJmaW5kUHJldiIsIlNoaWZ0LUN0cmwtRiI6InJlcGxhY2UiLCJTaGlmdC1DdHJsLVIiOiJy
			ZXBsYWNlQWxsIixmYWxsdGhyb3VnaDoiYmFzaWMifTtrZXlNYXAubWFjRGVmYXVsdD17IkNtZC1B
			Ijoic2VsZWN0QWxsIiwiQ21kLUQiOiJkZWxldGVMaW5lIiwiQ21kLVoiOiJ1bmRvIiwiU2hpZnQt
			Q21kLVoiOiJyZWRvIiwiQ21kLVkiOiJyZWRvIiwiQ21kLVVwIjoiZ29Eb2NTdGFydCIsICJDbWQt
			RW5kIjoiZ29Eb2NFbmQiLCJDbWQtRG93biI6ImdvRG9jRW5kIiwiQWx0LUxlZnQiOiJnb1dvcmRM
			ZWZ0IiwiQWx0LVJpZ2h0IjoiZ29Xb3JkUmlnaHQiLCJDbWQtTGVmdCI6ImdvTGluZVN0YXJ0Iiwi
			Q21kLVJpZ2h0IjoiZ29MaW5lRW5kIiwiQWx0LUJhY2tzcGFjZSI6ImRlbFdvcmRMZWZ0IiwiQ3Ry
			bC1BbHQtQmFja3NwYWNlIjoiZGVsV29yZFJpZ2h0IiwiQWx0LURlbGV0ZSI6ImRlbFdvcmRSaWdo
			dCIsIkNtZC1TIjoic2F2ZSIsIkNtZC1GIjoiZmluZCIsIkNtZC1HIjoiZmluZE5leHQiLCJTaGlm
			dC1DbWQtRyI6ImZpbmRQcmV2IiwiQ21kLUFsdC1GIjoicmVwbGFjZSIsIlNoaWZ0LUNtZC1BbHQt
			RiI6InJlcGxhY2VBbGwiLGZhbGx0aHJvdWdoOlsiYmFzaWMiLCJlbWFjc3kiXX07a2V5TWFwWyJk
			ZWZhdWx0Il09bWFjP2tleU1hcC5tYWNEZWZhdWx0OmtleU1hcC5wY0RlZmF1bHQ7a2V5TWFwLmVt
			YWNzeT17IkN0cmwtRiI6ImdvQ2hhclJpZ2h0IiwiQ3RybC1CIjoiZ29DaGFyTGVmdCIsICJDdHJs
			LVAiOiJnb0xpbmVVcCIsIkN0cmwtTiI6ImdvTGluZURvd24iLCJBbHQtRiI6ImdvV29yZFJpZ2h0
			IiwiQWx0LUIiOiJnb1dvcmRMZWZ0IiwiQ3RybC1BIjoiZ29MaW5lU3RhcnQiLCJDdHJsLUUiOiJn
			b0xpbmVFbmQiLCJDdHJsLVYiOiJnb1BhZ2VVcCIsIlNoaWZ0LUN0cmwtViI6ImdvUGFnZURvd24i
			LCJDdHJsLUQiOiJkZWxDaGFyUmlnaHQiLCJDdHJsLUgiOiJkZWxDaGFyTGVmdCIsIkFsdC1EIjoi
			ZGVsV29yZFJpZ2h0IiwiQWx0LUJhY2tzcGFjZSI6ImRlbFdvcmRMZWZ0IiwiQ3RybC1LIjoia2ls
			bExpbmUiLCJDdHJsLVQiOiJ0cmFuc3Bvc2VDaGFycyJ9O2Z1bmN0aW9uIGdldEtleU1hcCh2YWwp
			e2lmKHR5cGVvZiB2YWw9PSJzdHJpbmciKXJldHVybiBrZXlNYXBbdmFsXTtlbHNlIHJldHVybiB2
			YWx9ZnVuY3Rpb24gbG9va3VwS2V5KG5hbWUsZXh0cmFNYXAsbWFwLGhhbmRsZSl7ZnVuY3Rpb24g
			bG9va3VwKG1hcCl7bWFwPWdldEtleU1hcChtYXApO3ZhciBmb3VuZD0gbWFwW25hbWVdO2lmKGZv
			dW5kIT1udWxsJiZoYW5kbGUoZm91bmQpKXJldHVybiB0cnVlO2lmKG1hcC5jYXRjaGFsbClyZXR1
			cm4gaGFuZGxlKG1hcC5jYXRjaGFsbCk7dmFyIGZhbGx0aHJvdWdoPW1hcC5mYWxsdGhyb3VnaDtp
			ZihmYWxsdGhyb3VnaD09bnVsbClyZXR1cm4gZmFsc2U7aWYoT2JqZWN0LnByb3RvdHlwZS50b1N0
			cmluZy5jYWxsKGZhbGx0aHJvdWdoKSE9IltvYmplY3QgQXJyYXldIilyZXR1cm4gbG9va3VwKGZh
			bGx0aHJvdWdoKTtmb3IodmFyIGk9MCxlPWZhbGx0aHJvdWdoLmxlbmd0aDtpPGU7KytpKWlmKGxv
			b2t1cChmYWxsdGhyb3VnaFtpXSkpcmV0dXJuIHRydWU7cmV0dXJuIGZhbHNlfWlmKGV4dHJhTWFw
			JiZsb29rdXAoZXh0cmFNYXApKXJldHVybiB0cnVlO3JldHVybiBsb29rdXAobWFwKX1mdW5jdGlv
			biBpc01vZGlmaWVyS2V5KGV2ZW50KXt2YXIgbmFtZT1rZXlOYW1lc1tlX3Byb3AoZXZlbnQsImtl
			eUNvZGUiKV07cmV0dXJuIG5hbWU9PSJDdHJsInx8IG5hbWU9PSJBbHQifHxuYW1lPT0iU2hpZnQi
			fHxuYW1lPT0iTW9kIn1Db2RlTWlycm9yLmZyb21UZXh0QXJlYT1mdW5jdGlvbih0ZXh0YXJlYSxv
			cHRpb25zKXtpZighb3B0aW9ucylvcHRpb25zPXt9O29wdGlvbnMudmFsdWU9dGV4dGFyZWEudmFs
			dWU7aWYoIW9wdGlvbnMudGFiaW5kZXgmJnRleHRhcmVhLnRhYmluZGV4KW9wdGlvbnMudGFiaW5k
			ZXg9dGV4dGFyZWEudGFiaW5kZXg7ZnVuY3Rpb24gc2F2ZSgpe3RleHRhcmVhLnZhbHVlPWluc3Rh
			bmNlLmdldFZhbHVlKCl9aWYodGV4dGFyZWEuZm9ybSl7dmFyIHJtU3VibWl0PWNvbm5lY3QodGV4
			dGFyZWEuZm9ybSwic3VibWl0IixzYXZlLHRydWUpO2lmKHR5cGVvZiB0ZXh0YXJlYS5mb3JtLnN1
			Ym1pdD09ImZ1bmN0aW9uIil7dmFyIHJlYWxTdWJtaXQ9dGV4dGFyZWEuZm9ybS5zdWJtaXQ7ZnVu
			Y3Rpb24gd3JhcHBlZFN1Ym1pdCgpe3NhdmUoKTt0ZXh0YXJlYS5mb3JtLnN1Ym1pdD1yZWFsU3Vi
			bWl0O3RleHRhcmVhLmZvcm0uc3VibWl0KCk7IHRleHRhcmVhLmZvcm0uc3VibWl0PXdyYXBwZWRT
			dWJtaXR9dGV4dGFyZWEuZm9ybS5zdWJtaXQ9d3JhcHBlZFN1Ym1pdH19dGV4dGFyZWEuc3R5bGUu
			ZGlzcGxheT0ibm9uZSI7dmFyIGluc3RhbmNlPUNvZGVNaXJyb3IoZnVuY3Rpb24obm9kZSl7dGV4
			dGFyZWEucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUobm9kZSx0ZXh0YXJlYS5uZXh0U2libGluZyl9
			LG9wdGlvbnMpO2luc3RhbmNlLnNhdmU9c2F2ZTtpbnN0YW5jZS5nZXRUZXh0QXJlYT1mdW5jdGlv
			bigpe3JldHVybiB0ZXh0YXJlYX07aW5zdGFuY2UudG9UZXh0QXJlYT1mdW5jdGlvbigpe3NhdmUo
			KTt0ZXh0YXJlYS5wYXJlbnROb2RlLnJlbW92ZUNoaWxkKGluc3RhbmNlLmdldFdyYXBwZXJFbGVt
			ZW50KCkpO3RleHRhcmVhLnN0eWxlLmRpc3BsYXk9IiI7aWYodGV4dGFyZWEuZm9ybSl7cm1TdWJt
			aXQoKTtpZih0eXBlb2YgdGV4dGFyZWEuZm9ybS5zdWJtaXQ9PSJmdW5jdGlvbiIpdGV4dGFyZWEu
			Zm9ybS5zdWJtaXQ9cmVhbFN1Ym1pdH19OyByZXR1cm4gaW5zdGFuY2V9O2Z1bmN0aW9uIGNvcHlT
			dGF0ZShtb2RlLHN0YXRlKXtpZihzdGF0ZT09PXRydWUpcmV0dXJuIHN0YXRlO2lmKG1vZGUuY29w
			eVN0YXRlKXJldHVybiBtb2RlLmNvcHlTdGF0ZShzdGF0ZSk7dmFyIG5zdGF0ZT17fTtmb3IodmFy
			IG4gaW4gc3RhdGUpe3ZhciB2YWw9c3RhdGVbbl07aWYodmFsIGluc3RhbmNlb2YgQXJyYXkpdmFs
			PXZhbC5jb25jYXQoW10pO25zdGF0ZVtuXT12YWx9cmV0dXJuIG5zdGF0ZX1Db2RlTWlycm9yLmNv
			cHlTdGF0ZT1jb3B5U3RhdGU7ZnVuY3Rpb24gc3RhcnRTdGF0ZShtb2RlLGExLGEyKXtyZXR1cm4g
			bW9kZS5zdGFydFN0YXRlP21vZGUuc3RhcnRTdGF0ZShhMSxhMik6dHJ1ZX1Db2RlTWlycm9yLnN0
			YXJ0U3RhdGU9c3RhcnRTdGF0ZTtmdW5jdGlvbiBTdHJpbmdTdHJlYW0oc3RyaW5nLHRhYlNpemUp
			e3RoaXMucG9zPXRoaXMuc3RhcnQ9MDt0aGlzLnN0cmluZz1zdHJpbmc7dGhpcy50YWJTaXplPXRh
			YlNpemV8fDh9U3RyaW5nU3RyZWFtLnByb3RvdHlwZT0ge2VvbDpmdW5jdGlvbigpe3JldHVybiB0
			aGlzLnBvcz49dGhpcy5zdHJpbmcubGVuZ3RofSxzb2w6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5w
			b3M9PTB9LHBlZWs6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5zdHJpbmcuY2hhckF0KHRoaXMucG9z
			KX0sbmV4dDpmdW5jdGlvbigpe2lmKHRoaXMucG9zPHRoaXMuc3RyaW5nLmxlbmd0aClyZXR1cm4g
			dGhpcy5zdHJpbmcuY2hhckF0KHRoaXMucG9zKyspfSxlYXQ6ZnVuY3Rpb24obWF0Y2gpe3ZhciBj
			aD10aGlzLnN0cmluZy5jaGFyQXQodGhpcy5wb3MpO2lmKHR5cGVvZiBtYXRjaD09InN0cmluZyIp
			dmFyIG9rPWNoPT1tYXRjaDtlbHNlIHZhciBvaz1jaCYmKG1hdGNoLnRlc3Q/bWF0Y2gudGVzdChj
			aCk6bWF0Y2goY2gpKTtpZihvayl7Kyt0aGlzLnBvcztyZXR1cm4gY2h9fSxlYXRXaGlsZTpmdW5j
			dGlvbihtYXRjaCl7dmFyIHN0YXJ0PXRoaXMucG9zO3doaWxlKHRoaXMuZWF0KG1hdGNoKSk7cmV0
			dXJuIHRoaXMucG9zPnN0YXJ0fSxlYXRTcGFjZTpmdW5jdGlvbigpe3ZhciBzdGFydD0gdGhpcy5w
			b3M7d2hpbGUoL1tcc1x1MDBhMF0vLnRlc3QodGhpcy5zdHJpbmcuY2hhckF0KHRoaXMucG9zKSkp
			Kyt0aGlzLnBvcztyZXR1cm4gdGhpcy5wb3M+c3RhcnR9LHNraXBUb0VuZDpmdW5jdGlvbigpe3Ro
			aXMucG9zPXRoaXMuc3RyaW5nLmxlbmd0aH0sc2tpcFRvOmZ1bmN0aW9uKGNoKXt2YXIgZm91bmQ9
			dGhpcy5zdHJpbmcuaW5kZXhPZihjaCx0aGlzLnBvcyk7aWYoZm91bmQ+LTEpe3RoaXMucG9zPWZv
			dW5kO3JldHVybiB0cnVlfX0sYmFja1VwOmZ1bmN0aW9uKG4pe3RoaXMucG9zLT1ufSxjb2x1bW46
			ZnVuY3Rpb24oKXtyZXR1cm4gY291bnRDb2x1bW4odGhpcy5zdHJpbmcsdGhpcy5zdGFydCx0aGlz
			LnRhYlNpemUpfSxpbmRlbnRhdGlvbjpmdW5jdGlvbigpe3JldHVybiBjb3VudENvbHVtbih0aGlz
			LnN0cmluZyxudWxsLHRoaXMudGFiU2l6ZSl9LG1hdGNoOmZ1bmN0aW9uKHBhdHRlcm4sY29uc3Vt
			ZSxjYXNlSW5zZW5zaXRpdmUpe2lmKHR5cGVvZiBwYXR0ZXJuPT0ic3RyaW5nIil7ZnVuY3Rpb24g
			Y2FzZWQoc3RyKXtyZXR1cm4gY2FzZUluc2Vuc2l0aXZlPyBzdHIudG9Mb3dlckNhc2UoKTpzdHJ9
			aWYoY2FzZWQodGhpcy5zdHJpbmcpLmluZGV4T2YoY2FzZWQocGF0dGVybiksdGhpcy5wb3MpPT10
			aGlzLnBvcyl7aWYoY29uc3VtZSE9PWZhbHNlKXRoaXMucG9zKz1wYXR0ZXJuLmxlbmd0aDtyZXR1
			cm4gdHJ1ZX19ZWxzZXt2YXIgbWF0Y2g9dGhpcy5zdHJpbmcuc2xpY2UodGhpcy5wb3MpLm1hdGNo
			KHBhdHRlcm4pO2lmKG1hdGNoJiZjb25zdW1lIT09ZmFsc2UpdGhpcy5wb3MrPW1hdGNoWzBdLmxl
			bmd0aDtyZXR1cm4gbWF0Y2h9fSxjdXJyZW50OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuc3RyaW5n
			LnNsaWNlKHRoaXMuc3RhcnQsdGhpcy5wb3MpfX07Q29kZU1pcnJvci5TdHJpbmdTdHJlYW09U3Ry
			aW5nU3RyZWFtO2Z1bmN0aW9uIE1hcmtlZFRleHQoZnJvbSx0byxjbGFzc05hbWUsc2V0KXt0aGlz
			LmZyb209ZnJvbTt0aGlzLnRvPXRvO3RoaXMuc3R5bGU9Y2xhc3NOYW1lO3RoaXMuc2V0PXNldH1N
			YXJrZWRUZXh0LnByb3RvdHlwZT17YXR0YWNoOmZ1bmN0aW9uKGxpbmUpe3RoaXMuc2V0LnB1c2go
			bGluZSl9LCBkZXRhY2g6ZnVuY3Rpb24obGluZSl7dmFyIGl4PWluZGV4T2YodGhpcy5zZXQsbGlu
			ZSk7aWYoaXg+LTEpdGhpcy5zZXQuc3BsaWNlKGl4LDEpfSxzcGxpdDpmdW5jdGlvbihwb3MsbGVu
			QmVmb3JlKXtpZih0aGlzLnRvPD1wb3MmJnRoaXMudG8hPW51bGwpcmV0dXJuIG51bGw7dmFyIGZy
			b209dGhpcy5mcm9tPHBvc3x8dGhpcy5mcm9tPT1udWxsP251bGw6dGhpcy5mcm9tLXBvcytsZW5C
			ZWZvcmU7dmFyIHRvPXRoaXMudG89PW51bGw/bnVsbDp0aGlzLnRvLXBvcytsZW5CZWZvcmU7cmV0
			dXJuIG5ldyBNYXJrZWRUZXh0KGZyb20sdG8sdGhpcy5zdHlsZSx0aGlzLnNldCl9LGR1cDpmdW5j
			dGlvbigpe3JldHVybiBuZXcgTWFya2VkVGV4dChudWxsLG51bGwsdGhpcy5zdHlsZSx0aGlzLnNl
			dCl9LGNsaXBUbzpmdW5jdGlvbihmcm9tT3Blbixmcm9tLHRvT3Blbix0byxkaWZmKXtpZih0aGlz
			LmZyb20hPW51bGwmJnRoaXMuZnJvbT49ZnJvbSl0aGlzLmZyb209TWF0aC5tYXgodG8sdGhpcy5m
			cm9tKSsgZGlmZjtpZih0aGlzLnRvIT1udWxsJiZ0aGlzLnRvPmZyb20pdGhpcy50bz10bzx0aGlz
			LnRvP3RoaXMudG8rZGlmZjpmcm9tO2lmKGZyb21PcGVuJiZ0bz50aGlzLmZyb20mJih0bzx0aGlz
			LnRvfHx0aGlzLnRvPT1udWxsKSl0aGlzLmZyb209bnVsbDtpZih0b09wZW4mJihmcm9tPHRoaXMu
			dG98fHRoaXMudG89PW51bGwpJiYoZnJvbT50aGlzLmZyb218fHRoaXMuZnJvbT09bnVsbCkpdGhp
			cy50bz1udWxsfSxpc0RlYWQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5mcm9tIT1udWxsJiZ0aGlz
			LnRvIT1udWxsJiZ0aGlzLmZyb20+PXRoaXMudG99LHNhbWVTZXQ6ZnVuY3Rpb24oeCl7cmV0dXJu
			IHRoaXMuc2V0PT14LnNldH19O2Z1bmN0aW9uIEJvb2ttYXJrKHBvcyl7dGhpcy5mcm9tPXBvczt0
			aGlzLnRvPXBvczt0aGlzLmxpbmU9bnVsbH1Cb29rbWFyay5wcm90b3R5cGU9e2F0dGFjaDpmdW5j
			dGlvbihsaW5lKXt0aGlzLmxpbmU9bGluZX0sZGV0YWNoOmZ1bmN0aW9uKGxpbmUpe2lmKHRoaXMu
			bGluZT09IGxpbmUpdGhpcy5saW5lPW51bGx9LHNwbGl0OmZ1bmN0aW9uKHBvcyxsZW5CZWZvcmUp
			e2lmKHBvczx0aGlzLmZyb20pe3RoaXMuZnJvbT10aGlzLnRvPXRoaXMuZnJvbS1wb3MrbGVuQmVm
			b3JlO3JldHVybiB0aGlzfX0saXNEZWFkOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZnJvbT50aGlz
			LnRvfSxjbGlwVG86ZnVuY3Rpb24oZnJvbU9wZW4sZnJvbSx0b09wZW4sdG8sZGlmZil7aWYoKGZy
			b21PcGVufHxmcm9tPHRoaXMuZnJvbSkmJih0b09wZW58fHRvPnRoaXMudG8pKXt0aGlzLmZyb209
			MDt0aGlzLnRvPS0xfWVsc2UgaWYodGhpcy5mcm9tPmZyb20pdGhpcy5mcm9tPXRoaXMudG89TWF0
			aC5tYXgodG8sdGhpcy5mcm9tKStkaWZmfSxzYW1lU2V0OmZ1bmN0aW9uKHgpe3JldHVybiBmYWxz
			ZX0sZmluZDpmdW5jdGlvbigpe2lmKCF0aGlzLmxpbmV8fCF0aGlzLmxpbmUucGFyZW50KXJldHVy
			biBudWxsO3JldHVybntsaW5lOmxpbmVObyh0aGlzLmxpbmUpLGNoOnRoaXMuZnJvbX19LCBjbGVh
			cjpmdW5jdGlvbigpe2lmKHRoaXMubGluZSl7dmFyIGZvdW5kPWluZGV4T2YodGhpcy5saW5lLm1h
			cmtlZCx0aGlzKTtpZihmb3VuZCE9LTEpdGhpcy5saW5lLm1hcmtlZC5zcGxpY2UoZm91bmQsMSk7
			dGhpcy5saW5lPW51bGx9fX07ZnVuY3Rpb24gTGluZSh0ZXh0LHN0eWxlcyl7dGhpcy5zdHlsZXM9
			c3R5bGVzfHxbdGV4dCxudWxsXTt0aGlzLnRleHQ9dGV4dDt0aGlzLmhlaWdodD0xO3RoaXMubWFy
			a2VkPXRoaXMuZ3V0dGVyTWFya2VyPXRoaXMuY2xhc3NOYW1lPXRoaXMuaGFuZGxlcnM9bnVsbDt0
			aGlzLnN0YXRlQWZ0ZXI9dGhpcy5wYXJlbnQ9dGhpcy5oaWRkZW49bnVsbH1MaW5lLmluaGVyaXRN
			YXJrcz1mdW5jdGlvbih0ZXh0LG9yaWcpe3ZhciBsbj1uZXcgTGluZSh0ZXh0KSxtaz1vcmlnJiZv
			cmlnLm1hcmtlZDtpZihtaylmb3IodmFyIGk9MDtpPG1rLmxlbmd0aDsrK2kpaWYobWtbaV0udG89
			PW51bGwmJm1rW2ldLnN0eWxlKXt2YXIgbmV3bWs9bG4ubWFya2VkfHwgKGxuLm1hcmtlZD1bXSks
			bWFyaz1ta1tpXTt2YXIgbm1hcms9bWFyay5kdXAoKTtuZXdtay5wdXNoKG5tYXJrKTtubWFyay5h
			dHRhY2gobG4pfXJldHVybiBsbn07TGluZS5wcm90b3R5cGU9e3JlcGxhY2U6ZnVuY3Rpb24oZnJv
			bSx0b18sdGV4dCl7dmFyIHN0PVtdLG1rPXRoaXMubWFya2VkLHRvPXRvXz09bnVsbD90aGlzLnRl
			eHQubGVuZ3RoOnRvXztjb3B5U3R5bGVzKDAsZnJvbSx0aGlzLnN0eWxlcyxzdCk7aWYodGV4dClz
			dC5wdXNoKHRleHQsbnVsbCk7Y29weVN0eWxlcyh0byx0aGlzLnRleHQubGVuZ3RoLHRoaXMuc3R5
			bGVzLHN0KTt0aGlzLnN0eWxlcz1zdDt0aGlzLnRleHQ9dGhpcy50ZXh0LnNsaWNlKDAsZnJvbSkr
			dGV4dCt0aGlzLnRleHQuc2xpY2UodG8pO3RoaXMuc3RhdGVBZnRlcj1udWxsO2lmKG1rKXt2YXIg
			ZGlmZj10ZXh0Lmxlbmd0aC0odG8tZnJvbSk7Zm9yKHZhciBpPTA7aTxtay5sZW5ndGg7KytpKXt2
			YXIgbWFyaz1ta1tpXTttYXJrLmNsaXBUbyhmcm9tPT0gbnVsbCxmcm9tfHwwLHRvXz09bnVsbCx0
			byxkaWZmKTtpZihtYXJrLmlzRGVhZCgpKXttYXJrLmRldGFjaCh0aGlzKTttay5zcGxpY2UoaS0t
			LDEpfX19fSxzcGxpdDpmdW5jdGlvbihwb3MsdGV4dEJlZm9yZSl7dmFyIHN0PVt0ZXh0QmVmb3Jl
			LG51bGxdLG1rPXRoaXMubWFya2VkO2NvcHlTdHlsZXMocG9zLHRoaXMudGV4dC5sZW5ndGgsdGhp
			cy5zdHlsZXMsc3QpO3ZhciB0YWtlbj1uZXcgTGluZSh0ZXh0QmVmb3JlK3RoaXMudGV4dC5zbGlj
			ZShwb3MpLHN0KTtpZihtaylmb3IodmFyIGk9MDtpPG1rLmxlbmd0aDsrK2kpe3ZhciBtYXJrPW1r
			W2ldO3ZhciBuZXdtYXJrPW1hcmsuc3BsaXQocG9zLHRleHRCZWZvcmUubGVuZ3RoKTtpZihuZXdt
			YXJrKXtpZighdGFrZW4ubWFya2VkKXRha2VuLm1hcmtlZD1bXTt0YWtlbi5tYXJrZWQucHVzaChu
			ZXdtYXJrKTtuZXdtYXJrLmF0dGFjaCh0YWtlbil9fXJldHVybiB0YWtlbn0sYXBwZW5kOmZ1bmN0
			aW9uKGxpbmUpe3ZhciBteWxlbj10aGlzLnRleHQubGVuZ3RoLCBtaz1saW5lLm1hcmtlZCxteW1r
			PXRoaXMubWFya2VkO3RoaXMudGV4dCs9bGluZS50ZXh0O2NvcHlTdHlsZXMoMCxsaW5lLnRleHQu
			bGVuZ3RoLGxpbmUuc3R5bGVzLHRoaXMuc3R5bGVzKTtpZihteW1rKWZvcih2YXIgaT0wO2k8bXlt
			ay5sZW5ndGg7KytpKWlmKG15bWtbaV0udG89PW51bGwpbXlta1tpXS50bz1teWxlbjtpZihtayYm
			bWsubGVuZ3RoKXtpZighbXltayl0aGlzLm1hcmtlZD1teW1rPVtdO291dGVyOmZvcih2YXIgaT0w
			O2k8bWsubGVuZ3RoOysraSl7dmFyIG1hcms9bWtbaV07aWYoIW1hcmsuZnJvbSlmb3IodmFyIGo9
			MDtqPG15bWsubGVuZ3RoOysrail7dmFyIG15bWFyaz1teW1rW2pdO2lmKG15bWFyay50bz09bXls
			ZW4mJm15bWFyay5zYW1lU2V0KG1hcmspKXtteW1hcmsudG89bWFyay50bz09bnVsbD9udWxsOm1h
			cmsudG8rbXlsZW47aWYobXltYXJrLmlzRGVhZCgpKXtteW1hcmsuZGV0YWNoKHRoaXMpO21rLnNw
			bGljZShpLS0sMSl9Y29udGludWUgb3V0ZXJ9fW15bWsucHVzaChtYXJrKTsgbWFyay5hdHRhY2go
			dGhpcyk7bWFyay5mcm9tKz1teWxlbjtpZihtYXJrLnRvIT1udWxsKW1hcmsudG8rPW15bGVufX19
			LGZpeE1hcmtFbmRzOmZ1bmN0aW9uKG90aGVyKXt2YXIgbWs9dGhpcy5tYXJrZWQsb21rPW90aGVy
			Lm1hcmtlZDtpZighbWspcmV0dXJuO2Zvcih2YXIgaT0wO2k8bWsubGVuZ3RoOysraSl7dmFyIG1h
			cms9bWtbaV0sY2xvc2U9bWFyay50bz09bnVsbDtpZihjbG9zZSYmb21rKWZvcih2YXIgaj0wO2o8
			b21rLmxlbmd0aDsrK2opaWYob21rW2pdLnNhbWVTZXQobWFyaykpe2Nsb3NlPWZhbHNlO2JyZWFr
			fWlmKGNsb3NlKW1hcmsudG89dGhpcy50ZXh0Lmxlbmd0aH19LGZpeE1hcmtTdGFydHM6ZnVuY3Rp
			b24oKXt2YXIgbWs9dGhpcy5tYXJrZWQ7aWYoIW1rKXJldHVybjtmb3IodmFyIGk9MDtpPG1rLmxl
			bmd0aDsrK2kpaWYobWtbaV0uZnJvbT09bnVsbClta1tpXS5mcm9tPTB9LGFkZE1hcms6ZnVuY3Rp
			b24obWFyayl7bWFyay5hdHRhY2godGhpcyk7aWYodGhpcy5tYXJrZWQ9PSBudWxsKXRoaXMubWFy
			a2VkPVtdO3RoaXMubWFya2VkLnB1c2gobWFyayk7dGhpcy5tYXJrZWQuc29ydChmdW5jdGlvbihh
			LGIpe3JldHVybihhLmZyb218fDApLShiLmZyb218fDApfSl9LGhpZ2hsaWdodDpmdW5jdGlvbiht
			b2RlLHN0YXRlLHRhYlNpemUpe3ZhciBzdHJlYW09bmV3IFN0cmluZ1N0cmVhbSh0aGlzLnRleHQs
			dGFiU2l6ZSksc3Q9dGhpcy5zdHlsZXMscG9zPTA7dmFyIGNoYW5nZWQ9ZmFsc2UsY3VyV29yZD1z
			dFswXSxwcmV2V29yZDtpZih0aGlzLnRleHQ9PSIiJiZtb2RlLmJsYW5rTGluZSltb2RlLmJsYW5r
			TGluZShzdGF0ZSk7d2hpbGUoIXN0cmVhbS5lb2woKSl7dmFyIHN0eWxlPW1vZGUudG9rZW4oc3Ry
			ZWFtLHN0YXRlKTt2YXIgc3Vic3RyPXRoaXMudGV4dC5zbGljZShzdHJlYW0uc3RhcnQsc3RyZWFt
			LnBvcyk7c3RyZWFtLnN0YXJ0PXN0cmVhbS5wb3M7aWYocG9zJiZzdFtwb3MtMV09PXN0eWxlKXN0
			W3Bvcy0yXSs9c3Vic3RyO2Vsc2UgaWYoc3Vic3RyKXtpZighY2hhbmdlZCYmIChzdFtwb3MrMV0h
			PXN0eWxlfHxwb3MmJnN0W3Bvcy0yXSE9cHJldldvcmQpKWNoYW5nZWQ9dHJ1ZTtzdFtwb3MrK109
			c3Vic3RyO3N0W3BvcysrXT1zdHlsZTtwcmV2V29yZD1jdXJXb3JkO2N1cldvcmQ9c3RbcG9zXX1p
			ZihzdHJlYW0ucG9zPjVFMyl7c3RbcG9zKytdPXRoaXMudGV4dC5zbGljZShzdHJlYW0ucG9zKTtz
			dFtwb3MrK109bnVsbDticmVha319aWYoc3QubGVuZ3RoIT1wb3Mpe3N0Lmxlbmd0aD1wb3M7Y2hh
			bmdlZD10cnVlfWlmKHBvcyYmc3RbcG9zLTJdIT1wcmV2V29yZCljaGFuZ2VkPXRydWU7cmV0dXJu
			IGNoYW5nZWR8fChzdC5sZW5ndGg8NSYmdGhpcy50ZXh0Lmxlbmd0aDwxMD9udWxsOmZhbHNlKX0s
			Z2V0VG9rZW5BdDpmdW5jdGlvbihtb2RlLHN0YXRlLGNoKXt2YXIgdHh0PXRoaXMudGV4dCxzdHJl
			YW09bmV3IFN0cmluZ1N0cmVhbSh0eHQpO3doaWxlKHN0cmVhbS5wb3M8Y2gmJiFzdHJlYW0uZW9s
			KCkpe3N0cmVhbS5zdGFydD1zdHJlYW0ucG9zO3ZhciBzdHlsZT0gbW9kZS50b2tlbihzdHJlYW0s
			c3RhdGUpfXJldHVybntzdGFydDpzdHJlYW0uc3RhcnQsZW5kOnN0cmVhbS5wb3Msc3RyaW5nOnN0
			cmVhbS5jdXJyZW50KCksY2xhc3NOYW1lOnN0eWxlfHxudWxsLHN0YXRlOnN0YXRlfX0saW5kZW50
			YXRpb246ZnVuY3Rpb24odGFiU2l6ZSl7cmV0dXJuIGNvdW50Q29sdW1uKHRoaXMudGV4dCxudWxs
			LHRhYlNpemUpfSxnZXRIVE1MOmZ1bmN0aW9uKG1ha2VUYWIsZW5kQXQpe3ZhciBodG1sPVtdLGZp
			cnN0PXRydWUsY29sPTA7ZnVuY3Rpb24gc3Bhbih0ZXh0LHN0eWxlKXtpZighdGV4dClyZXR1cm47
			aWYoZmlyc3QmJmllJiZ0ZXh0LmNoYXJBdCgwKT09IiAiKXRleHQ9Ilx1MDBhMCIrdGV4dC5zbGlj
			ZSgxKTtmaXJzdD1mYWxzZTtpZih0ZXh0LmluZGV4T2YoIlx0Iik9PS0xKXtjb2wrPXRleHQubGVu
			Z3RoO3ZhciBlc2NhcGVkPWh0bWxFc2NhcGUodGV4dCl9ZWxzZXt2YXIgZXNjYXBlZD0iIjtmb3Io
			dmFyIHBvcz0wOzspe3ZhciBpZHg9dGV4dC5pbmRleE9mKCJcdCIsIHBvcyk7aWYoaWR4PT0tMSl7
			ZXNjYXBlZCs9aHRtbEVzY2FwZSh0ZXh0LnNsaWNlKHBvcykpO2NvbCs9dGV4dC5sZW5ndGgtcG9z
			O2JyZWFrfWVsc2V7Y29sKz1pZHgtcG9zO3ZhciB0YWI9bWFrZVRhYihjb2wpO2VzY2FwZWQrPWh0
			bWxFc2NhcGUodGV4dC5zbGljZShwb3MsaWR4KSkrdGFiLmh0bWw7Y29sKz10YWIud2lkdGg7cG9z
			PWlkeCsxfX19aWYoc3R5bGUpaHRtbC5wdXNoKCc8c3BhbiBjbGFzcz0iJyxzdHlsZSwnIj4nLGVz
			Y2FwZWQsIjwvc3Bhbj4iKTtlbHNlIGh0bWwucHVzaChlc2NhcGVkKX12YXIgc3Q9dGhpcy5zdHls
			ZXMsYWxsVGV4dD10aGlzLnRleHQsbWFya2VkPXRoaXMubWFya2VkO3ZhciBsZW49YWxsVGV4dC5s
			ZW5ndGg7aWYoZW5kQXQhPW51bGwpbGVuPU1hdGgubWluKGVuZEF0LGxlbik7ZnVuY3Rpb24gc3R5
			bGVUb0NsYXNzKHN0eWxlKXtpZighc3R5bGUpcmV0dXJuIG51bGw7cmV0dXJuImNtLSIrc3R5bGUu
			cmVwbGFjZSgvICsvZywiIGNtLSIpfWlmKCFhbGxUZXh0JiYgZW5kQXQ9PW51bGwpc3BhbigiICIp
			O2Vsc2UgaWYoIW1hcmtlZHx8IW1hcmtlZC5sZW5ndGgpZm9yKHZhciBpPTAsY2g9MDtjaDxsZW47
			aSs9Mil7dmFyIHN0cj1zdFtpXSxzdHlsZT1zdFtpKzFdLGw9c3RyLmxlbmd0aDtpZihjaCtsPmxl
			bilzdHI9c3RyLnNsaWNlKDAsbGVuLWNoKTtjaCs9bDtzcGFuKHN0cixzdHlsZVRvQ2xhc3Moc3R5
			bGUpKX1lbHNle3ZhciBwb3M9MCxpPTAsdGV4dD0iIixzdHlsZSxzZz0wO3ZhciBuZXh0Q2hhbmdl
			PW1hcmtlZFswXS5mcm9tfHwwLG1hcmtzPVtdLG1hcmtwb3M9MDtmdW5jdGlvbiBhZHZhbmNlTWFy
			a3MoKXt2YXIgbTt3aGlsZShtYXJrcG9zPG1hcmtlZC5sZW5ndGgmJigobT1tYXJrZWRbbWFya3Bv
			c10pLmZyb209PXBvc3x8bS5mcm9tPT1udWxsKSl7aWYobS5zdHlsZSE9bnVsbCltYXJrcy5wdXNo
			KG0pOysrbWFya3Bvc31uZXh0Q2hhbmdlPW1hcmtwb3M8bWFya2VkLmxlbmd0aD9tYXJrZWRbbWFy
			a3Bvc10uZnJvbTpJbmZpbml0eTtmb3IodmFyIGk9IDA7aTxtYXJrcy5sZW5ndGg7KytpKXt2YXIg
			dG89bWFya3NbaV0udG98fEluZmluaXR5O2lmKHRvPT1wb3MpbWFya3Muc3BsaWNlKGktLSwxKTtl
			bHNlIG5leHRDaGFuZ2U9TWF0aC5taW4odG8sbmV4dENoYW5nZSl9fXZhciBtPTA7d2hpbGUocG9z
			PGxlbil7aWYobmV4dENoYW5nZT09cG9zKWFkdmFuY2VNYXJrcygpO3ZhciB1cHRvPU1hdGgubWlu
			KGxlbixuZXh0Q2hhbmdlKTt3aGlsZSh0cnVlKXtpZih0ZXh0KXt2YXIgZW5kPXBvcyt0ZXh0Lmxl
			bmd0aDt2YXIgYXBwbGllZFN0eWxlPXN0eWxlO2Zvcih2YXIgaj0wO2o8bWFya3MubGVuZ3RoOysr
			ailhcHBsaWVkU3R5bGU9KGFwcGxpZWRTdHlsZT9hcHBsaWVkU3R5bGUrIiAiOiIiKSttYXJrc1tq
			XS5zdHlsZTtzcGFuKGVuZD51cHRvP3RleHQuc2xpY2UoMCx1cHRvLXBvcyk6dGV4dCxhcHBsaWVk
			U3R5bGUpO2lmKGVuZD49dXB0byl7dGV4dD10ZXh0LnNsaWNlKHVwdG8tcG9zKTtwb3M9dXB0bzti
			cmVha31wb3M9ZW5kfXRleHQ9c3RbaSsrXTsgc3R5bGU9c3R5bGVUb0NsYXNzKHN0W2krK10pfX19
			cmV0dXJuIGh0bWwuam9pbigiIil9LGNsZWFuVXA6ZnVuY3Rpb24oKXt0aGlzLnBhcmVudD1udWxs
			O2lmKHRoaXMubWFya2VkKWZvcih2YXIgaT0wLGU9dGhpcy5tYXJrZWQubGVuZ3RoO2k8ZTsrK2kp
			dGhpcy5tYXJrZWRbaV0uZGV0YWNoKHRoaXMpfX07ZnVuY3Rpb24gY29weVN0eWxlcyhmcm9tLHRv
			LHNvdXJjZSxkZXN0KXtmb3IodmFyIGk9MCxwb3M9MCxzdGF0ZT0wO3Bvczx0bztpKz0yKXt2YXIg
			cGFydD1zb3VyY2VbaV0sZW5kPXBvcytwYXJ0Lmxlbmd0aDtpZihzdGF0ZT09MCl7aWYoZW5kPmZy
			b20pZGVzdC5wdXNoKHBhcnQuc2xpY2UoZnJvbS1wb3MsTWF0aC5taW4ocGFydC5sZW5ndGgsdG8t
			cG9zKSksc291cmNlW2krMV0pO2lmKGVuZD49ZnJvbSlzdGF0ZT0xfWVsc2UgaWYoc3RhdGU9PTEp
			aWYoZW5kPnRvKWRlc3QucHVzaChwYXJ0LnNsaWNlKDAsdG8tcG9zKSxzb3VyY2VbaSsxXSk7ZWxz
			ZSBkZXN0LnB1c2gocGFydCwgc291cmNlW2krMV0pO3Bvcz1lbmR9fWZ1bmN0aW9uIExlYWZDaHVu
			ayhsaW5lcyl7dGhpcy5saW5lcz1saW5lczt0aGlzLnBhcmVudD1udWxsO2Zvcih2YXIgaT0wLGU9
			bGluZXMubGVuZ3RoLGhlaWdodD0wO2k8ZTsrK2kpe2xpbmVzW2ldLnBhcmVudD10aGlzO2hlaWdo
			dCs9bGluZXNbaV0uaGVpZ2h0fXRoaXMuaGVpZ2h0PWhlaWdodH1MZWFmQ2h1bmsucHJvdG90eXBl
			PXtjaHVua1NpemU6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5saW5lcy5sZW5ndGh9LHJlbW92ZTpm
			dW5jdGlvbihhdCxuLGNhbGxiYWNrcyl7Zm9yKHZhciBpPWF0LGU9YXQrbjtpPGU7KytpKXt2YXIg
			bGluZT10aGlzLmxpbmVzW2ldO3RoaXMuaGVpZ2h0LT1saW5lLmhlaWdodDtsaW5lLmNsZWFuVXAo
			KTtpZihsaW5lLmhhbmRsZXJzKWZvcih2YXIgaj0wO2o8bGluZS5oYW5kbGVycy5sZW5ndGg7Kytq
			KWNhbGxiYWNrcy5wdXNoKGxpbmUuaGFuZGxlcnNbal0pfXRoaXMubGluZXMuc3BsaWNlKGF0LG4p
			fSxjb2xsYXBzZTpmdW5jdGlvbihsaW5lcyl7bGluZXMuc3BsaWNlLmFwcGx5KGxpbmVzLCBbbGlu
			ZXMubGVuZ3RoLDBdLmNvbmNhdCh0aGlzLmxpbmVzKSl9LGluc2VydEhlaWdodDpmdW5jdGlvbihh
			dCxsaW5lcyxoZWlnaHQpe3RoaXMuaGVpZ2h0Kz1oZWlnaHQ7dGhpcy5saW5lcy5zcGxpY2UuYXBw
			bHkodGhpcy5saW5lcyxbYXQsMF0uY29uY2F0KGxpbmVzKSk7Zm9yKHZhciBpPTAsZT1saW5lcy5s
			ZW5ndGg7aTxlOysraSlsaW5lc1tpXS5wYXJlbnQ9dGhpc30saXRlck46ZnVuY3Rpb24oYXQsbixv
			cCl7Zm9yKHZhciBlPWF0K247YXQ8ZTsrK2F0KWlmKG9wKHRoaXMubGluZXNbYXRdKSlyZXR1cm4g
			dHJ1ZX19O2Z1bmN0aW9uIEJyYW5jaENodW5rKGNoaWxkcmVuKXt0aGlzLmNoaWxkcmVuPWNoaWxk
			cmVuO3ZhciBzaXplPTAsaGVpZ2h0PTA7Zm9yKHZhciBpPTAsZT1jaGlsZHJlbi5sZW5ndGg7aTxl
			OysraSl7dmFyIGNoPWNoaWxkcmVuW2ldO3NpemUrPWNoLmNodW5rU2l6ZSgpO2hlaWdodCs9Y2gu
			aGVpZ2h0O2NoLnBhcmVudD10aGlzfXRoaXMuc2l6ZT1zaXplO3RoaXMuaGVpZ2h0PSBoZWlnaHQ7
			dGhpcy5wYXJlbnQ9bnVsbH1CcmFuY2hDaHVuay5wcm90b3R5cGU9e2NodW5rU2l6ZTpmdW5jdGlv
			bigpe3JldHVybiB0aGlzLnNpemV9LHJlbW92ZTpmdW5jdGlvbihhdCxuLGNhbGxiYWNrcyl7dGhp
			cy5zaXplLT1uO2Zvcih2YXIgaT0wO2k8dGhpcy5jaGlsZHJlbi5sZW5ndGg7KytpKXt2YXIgY2hp
			bGQ9dGhpcy5jaGlsZHJlbltpXSxzej1jaGlsZC5jaHVua1NpemUoKTtpZihhdDxzeil7dmFyIHJt
			PU1hdGgubWluKG4sc3otYXQpLG9sZEhlaWdodD1jaGlsZC5oZWlnaHQ7Y2hpbGQucmVtb3ZlKGF0
			LHJtLGNhbGxiYWNrcyk7dGhpcy5oZWlnaHQtPW9sZEhlaWdodC1jaGlsZC5oZWlnaHQ7aWYoc3o9
			PXJtKXt0aGlzLmNoaWxkcmVuLnNwbGljZShpLS0sMSk7Y2hpbGQucGFyZW50PW51bGx9aWYoKG4t
			PXJtKT09MClicmVhazthdD0wfWVsc2UgYXQtPXN6fWlmKHRoaXMuc2l6ZS1uPDI1KXt2YXIgbGlu
			ZXM9W107dGhpcy5jb2xsYXBzZShsaW5lcyk7dGhpcy5jaGlsZHJlbj0gW25ldyBMZWFmQ2h1bmso
			bGluZXMpXTt0aGlzLmNoaWxkcmVuWzBdLnBhcmVudD10aGlzfX0sY29sbGFwc2U6ZnVuY3Rpb24o
			bGluZXMpe2Zvcih2YXIgaT0wLGU9dGhpcy5jaGlsZHJlbi5sZW5ndGg7aTxlOysraSl0aGlzLmNo
			aWxkcmVuW2ldLmNvbGxhcHNlKGxpbmVzKX0saW5zZXJ0OmZ1bmN0aW9uKGF0LGxpbmVzKXt2YXIg
			aGVpZ2h0PTA7Zm9yKHZhciBpPTAsZT1saW5lcy5sZW5ndGg7aTxlOysraSloZWlnaHQrPWxpbmVz
			W2ldLmhlaWdodDt0aGlzLmluc2VydEhlaWdodChhdCxsaW5lcyxoZWlnaHQpfSxpbnNlcnRIZWln
			aHQ6ZnVuY3Rpb24oYXQsbGluZXMsaGVpZ2h0KXt0aGlzLnNpemUrPWxpbmVzLmxlbmd0aDt0aGlz
			LmhlaWdodCs9aGVpZ2h0O2Zvcih2YXIgaT0wLGU9dGhpcy5jaGlsZHJlbi5sZW5ndGg7aTxlOysr
			aSl7dmFyIGNoaWxkPXRoaXMuY2hpbGRyZW5baV0sc3o9Y2hpbGQuY2h1bmtTaXplKCk7aWYoYXQ8
			PXN6KXtjaGlsZC5pbnNlcnRIZWlnaHQoYXQsbGluZXMsIGhlaWdodCk7aWYoY2hpbGQubGluZXMm
			JmNoaWxkLmxpbmVzLmxlbmd0aD41MCl7d2hpbGUoY2hpbGQubGluZXMubGVuZ3RoPjUwKXt2YXIg
			c3BpbGxlZD1jaGlsZC5saW5lcy5zcGxpY2UoY2hpbGQubGluZXMubGVuZ3RoLTI1LDI1KTt2YXIg
			bmV3bGVhZj1uZXcgTGVhZkNodW5rKHNwaWxsZWQpO2NoaWxkLmhlaWdodC09bmV3bGVhZi5oZWln
			aHQ7dGhpcy5jaGlsZHJlbi5zcGxpY2UoaSsxLDAsbmV3bGVhZik7bmV3bGVhZi5wYXJlbnQ9dGhp
			c310aGlzLm1heWJlU3BpbGwoKX1icmVha31hdC09c3p9fSxtYXliZVNwaWxsOmZ1bmN0aW9uKCl7
			aWYodGhpcy5jaGlsZHJlbi5sZW5ndGg8PTEwKXJldHVybjt2YXIgbWU9dGhpcztkb3t2YXIgc3Bp
			bGxlZD1tZS5jaGlsZHJlbi5zcGxpY2UobWUuY2hpbGRyZW4ubGVuZ3RoLTUsNSk7dmFyIHNpYmxp
			bmc9bmV3IEJyYW5jaENodW5rKHNwaWxsZWQpO2lmKCFtZS5wYXJlbnQpe3ZhciBjb3B5PW5ldyBC
			cmFuY2hDaHVuayhtZS5jaGlsZHJlbik7IGNvcHkucGFyZW50PW1lO21lLmNoaWxkcmVuPVtjb3B5
			LHNpYmxpbmddO21lPWNvcHl9ZWxzZXttZS5zaXplLT1zaWJsaW5nLnNpemU7bWUuaGVpZ2h0LT1z
			aWJsaW5nLmhlaWdodDt2YXIgbXlJbmRleD1pbmRleE9mKG1lLnBhcmVudC5jaGlsZHJlbixtZSk7
			bWUucGFyZW50LmNoaWxkcmVuLnNwbGljZShteUluZGV4KzEsMCxzaWJsaW5nKX1zaWJsaW5nLnBh
			cmVudD1tZS5wYXJlbnR9d2hpbGUobWUuY2hpbGRyZW4ubGVuZ3RoPjEwKTttZS5wYXJlbnQubWF5
			YmVTcGlsbCgpfSxpdGVyOmZ1bmN0aW9uKGZyb20sdG8sb3Ape3RoaXMuaXRlck4oZnJvbSx0by1m
			cm9tLG9wKX0saXRlck46ZnVuY3Rpb24oYXQsbixvcCl7Zm9yKHZhciBpPTAsZT10aGlzLmNoaWxk
			cmVuLmxlbmd0aDtpPGU7KytpKXt2YXIgY2hpbGQ9dGhpcy5jaGlsZHJlbltpXSxzej1jaGlsZC5j
			aHVua1NpemUoKTtpZihhdDxzeil7dmFyIHVzZWQ9TWF0aC5taW4obixzei1hdCk7aWYoY2hpbGQu
			aXRlck4oYXQsdXNlZCwgb3ApKXJldHVybiB0cnVlO2lmKChuLT11c2VkKT09MClicmVhazthdD0w
			fWVsc2UgYXQtPXN6fX19O2Z1bmN0aW9uIGdldExpbmVBdChjaHVuayxuKXt3aGlsZSghY2h1bmsu
			bGluZXMpZm9yKHZhciBpPTA7OysraSl7dmFyIGNoaWxkPWNodW5rLmNoaWxkcmVuW2ldLHN6PWNo
			aWxkLmNodW5rU2l6ZSgpO2lmKG48c3ope2NodW5rPWNoaWxkO2JyZWFrfW4tPXN6fXJldHVybiBj
			aHVuay5saW5lc1tuXX1mdW5jdGlvbiBsaW5lTm8obGluZSl7aWYobGluZS5wYXJlbnQ9PW51bGwp
			cmV0dXJuIG51bGw7dmFyIGN1cj1saW5lLnBhcmVudCxubz1pbmRleE9mKGN1ci5saW5lcyxsaW5l
			KTtmb3IodmFyIGNodW5rPWN1ci5wYXJlbnQ7Y2h1bms7Y3VyPWNodW5rLGNodW5rPWNodW5rLnBh
			cmVudClmb3IodmFyIGk9MCxlPWNodW5rLmNoaWxkcmVuLmxlbmd0aDs7KytpKXtpZihjaHVuay5j
			aGlsZHJlbltpXT09Y3VyKWJyZWFrO25vKz1jaHVuay5jaGlsZHJlbltpXS5jaHVua1NpemUoKX1y
			ZXR1cm4gbm99IGZ1bmN0aW9uIGxpbmVBdEhlaWdodChjaHVuayxoKXt2YXIgbj0wO291dGVyOmRv
			e2Zvcih2YXIgaT0wLGU9Y2h1bmsuY2hpbGRyZW4ubGVuZ3RoO2k8ZTsrK2kpe3ZhciBjaGlsZD1j
			aHVuay5jaGlsZHJlbltpXSxjaD1jaGlsZC5oZWlnaHQ7aWYoaDxjaCl7Y2h1bms9Y2hpbGQ7Y29u
			dGludWUgb3V0ZXJ9aC09Y2g7bis9Y2hpbGQuY2h1bmtTaXplKCl9cmV0dXJuIG59d2hpbGUoIWNo
			dW5rLmxpbmVzKTtmb3IodmFyIGk9MCxlPWNodW5rLmxpbmVzLmxlbmd0aDtpPGU7KytpKXt2YXIg
			bGluZT1jaHVuay5saW5lc1tpXSxsaD1saW5lLmhlaWdodDtpZihoPGxoKWJyZWFrO2gtPWxofXJl
			dHVybiBuK2l9ZnVuY3Rpb24gaGVpZ2h0QXRMaW5lKGNodW5rLG4pe3ZhciBoPTA7b3V0ZXI6ZG97
			Zm9yKHZhciBpPTAsZT1jaHVuay5jaGlsZHJlbi5sZW5ndGg7aTxlOysraSl7dmFyIGNoaWxkPWNo
			dW5rLmNoaWxkcmVuW2ldLHN6PWNoaWxkLmNodW5rU2l6ZSgpO2lmKG48c3ope2NodW5rPWNoaWxk
			OyBjb250aW51ZSBvdXRlcn1uLT1zejtoKz1jaGlsZC5oZWlnaHR9cmV0dXJuIGh9d2hpbGUoIWNo
			dW5rLmxpbmVzKTtmb3IodmFyIGk9MDtpPG47KytpKWgrPWNodW5rLmxpbmVzW2ldLmhlaWdodDty
			ZXR1cm4gaH1mdW5jdGlvbiBIaXN0b3J5KCl7dGhpcy50aW1lPTA7dGhpcy5kb25lPVtdO3RoaXMu
			dW5kb25lPVtdfUhpc3RvcnkucHJvdG90eXBlPXthZGRDaGFuZ2U6ZnVuY3Rpb24oc3RhcnQsYWRk
			ZWQsb2xkKXt0aGlzLnVuZG9uZS5sZW5ndGg9MDt2YXIgdGltZT0rbmV3IERhdGUsY3VyPXRoaXMu
			ZG9uZVt0aGlzLmRvbmUubGVuZ3RoLTFdLGxhc3Q9Y3VyJiZjdXJbY3VyLmxlbmd0aC0xXTt2YXIg
			ZHRpbWU9dGltZS10aGlzLnRpbWU7aWYoZHRpbWU+NDAwfHwhbGFzdCl0aGlzLmRvbmUucHVzaChb
			e3N0YXJ0OnN0YXJ0LGFkZGVkOmFkZGVkLG9sZDpvbGR9XSk7ZWxzZSBpZihsYXN0LnN0YXJ0PnN0
			YXJ0K29sZC5sZW5ndGh8fGxhc3Quc3RhcnQrbGFzdC5hZGRlZDxzdGFydC1sYXN0LmFkZGVkKyBs
			YXN0Lm9sZC5sZW5ndGgpY3VyLnB1c2goe3N0YXJ0OnN0YXJ0LGFkZGVkOmFkZGVkLG9sZDpvbGR9
			KTtlbHNle3ZhciBvbGRvZmY9MDtpZihzdGFydDxsYXN0LnN0YXJ0KXtmb3IodmFyIGk9bGFzdC5z
			dGFydC1zdGFydC0xO2k+PTA7LS1pKWxhc3Qub2xkLnVuc2hpZnQob2xkW2ldKTtsYXN0LmFkZGVk
			Kz1sYXN0LnN0YXJ0LXN0YXJ0O2xhc3Quc3RhcnQ9c3RhcnR9ZWxzZSBpZihsYXN0LnN0YXJ0PHN0
			YXJ0KXtvbGRvZmY9c3RhcnQtbGFzdC5zdGFydDthZGRlZCs9b2xkb2ZmfWZvcih2YXIgaT1sYXN0
			LmFkZGVkLW9sZG9mZixlPW9sZC5sZW5ndGg7aTxlOysraSlsYXN0Lm9sZC5wdXNoKG9sZFtpXSk7
			aWYobGFzdC5hZGRlZDxhZGRlZClsYXN0LmFkZGVkPWFkZGVkfXRoaXMudGltZT10aW1lfX07ZnVu
			Y3Rpb24gc3RvcE1ldGhvZCgpe2Vfc3RvcCh0aGlzKX1mdW5jdGlvbiBhZGRTdG9wKGV2ZW50KXtp
			ZighZXZlbnQuc3RvcClldmVudC5zdG9wPXN0b3BNZXRob2Q7cmV0dXJuIGV2ZW50fSBmdW5jdGlv
			biBlX3ByZXZlbnREZWZhdWx0KGUpe2lmKGUucHJldmVudERlZmF1bHQpZS5wcmV2ZW50RGVmYXVs
			dCgpO2Vsc2UgZS5yZXR1cm5WYWx1ZT1mYWxzZX1mdW5jdGlvbiBlX3N0b3BQcm9wYWdhdGlvbihl
			KXtpZihlLnN0b3BQcm9wYWdhdGlvbillLnN0b3BQcm9wYWdhdGlvbigpO2Vsc2UgZS5jYW5jZWxC
			dWJibGU9dHJ1ZX1mdW5jdGlvbiBlX3N0b3AoZSl7ZV9wcmV2ZW50RGVmYXVsdChlKTtlX3N0b3BQ
			cm9wYWdhdGlvbihlKX1Db2RlTWlycm9yLmVfc3RvcD1lX3N0b3A7Q29kZU1pcnJvci5lX3ByZXZl
			bnREZWZhdWx0PWVfcHJldmVudERlZmF1bHQ7Q29kZU1pcnJvci5lX3N0b3BQcm9wYWdhdGlvbj1l
			X3N0b3BQcm9wYWdhdGlvbjtmdW5jdGlvbiBlX3RhcmdldChlKXtyZXR1cm4gZS50YXJnZXR8fGUu
			c3JjRWxlbWVudH1mdW5jdGlvbiBlX2J1dHRvbihlKXtpZihlLndoaWNoKXJldHVybiBlLndoaWNo
			O2Vsc2UgaWYoZS5idXR0b24mMSlyZXR1cm4gMTtlbHNlIGlmKGUuYnV0dG9uJiAyKXJldHVybiAz
			O2Vsc2UgaWYoZS5idXR0b24mNClyZXR1cm4gMn1mdW5jdGlvbiBlX3Byb3AoZSxwcm9wKXt2YXIg
			b3ZlcnJpZGRlbj1lLm92ZXJyaWRlJiZlLm92ZXJyaWRlLmhhc093blByb3BlcnR5KHByb3ApO3Jl
			dHVybiBvdmVycmlkZGVuP2Uub3ZlcnJpZGVbcHJvcF06ZVtwcm9wXX1mdW5jdGlvbiBjb25uZWN0
			KG5vZGUsdHlwZSxoYW5kbGVyLGRpc2Nvbm5lY3Qpe2lmKHR5cGVvZiBub2RlLmFkZEV2ZW50TGlz
			dGVuZXI9PSJmdW5jdGlvbiIpe25vZGUuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLGhhbmRsZXIsZmFs
			c2UpO2lmKGRpc2Nvbm5lY3QpcmV0dXJuIGZ1bmN0aW9uKCl7bm9kZS5yZW1vdmVFdmVudExpc3Rl
			bmVyKHR5cGUsaGFuZGxlcixmYWxzZSl9fWVsc2V7dmFyIHdyYXBIYW5kbGVyPWZ1bmN0aW9uKGV2
			ZW50KXtoYW5kbGVyKGV2ZW50fHx3aW5kb3cuZXZlbnQpfTtub2RlLmF0dGFjaEV2ZW50KCJvbiIr
			dHlwZSx3cmFwSGFuZGxlcik7aWYoZGlzY29ubmVjdClyZXR1cm4gZnVuY3Rpb24oKXtub2RlLmRl
			dGFjaEV2ZW50KCJvbiIrIHR5cGUsd3JhcEhhbmRsZXIpfX19Q29kZU1pcnJvci5jb25uZWN0PWNv
			bm5lY3Q7ZnVuY3Rpb24gRGVsYXllZCgpe3RoaXMuaWQ9bnVsbH1EZWxheWVkLnByb3RvdHlwZT17
			c2V0OmZ1bmN0aW9uKG1zLGYpe2NsZWFyVGltZW91dCh0aGlzLmlkKTt0aGlzLmlkPXNldFRpbWVv
			dXQoZixtcyl9fTt2YXIgUGFzcz1Db2RlTWlycm9yLlBhc3M9e3RvU3RyaW5nOmZ1bmN0aW9uKCl7
			cmV0dXJuIkNvZGVNaXJyb3IuUGFzcyJ9fTt2YXIgZHJhZ0FuZERyb3A9ZnVuY3Rpb24oKXtpZigv
			TVNJRSBbMS04XVxiLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKXJldHVybiBmYWxzZTt2YXIg
			ZGl2PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpO3JldHVybiJkcmFnZ2FibGUiaW4gZGl2
			fSgpO3ZhciBnZWNrbz0vZ2Vja29cL1xkezd9L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTt2
			YXIgaWU9L01TSUUgXGQvLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7dmFyIGllX2x0OT0vTVNJ
			RSBbMS04XVxiLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpOyB2YXIgd2Via2l0PS9XZWJLaXRc
			Ly8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTt2YXIgbGluZVNlcD0iXG4iOyhmdW5jdGlvbigp
			e3ZhciB0ZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ0ZXh0YXJlYSIpO3RlLnZhbHVlPSJmb29c
			bmJhciI7aWYodGUudmFsdWUuaW5kZXhPZigiXHIiKT4tMSlsaW5lU2VwPSJcclxuIn0pKCk7ZnVu
			Y3Rpb24gY291bnRDb2x1bW4oc3RyaW5nLGVuZCx0YWJTaXplKXtpZihlbmQ9PW51bGwpe2VuZD1z
			dHJpbmcuc2VhcmNoKC9bXlxzXHUwMGEwXS8pO2lmKGVuZD09LTEpZW5kPXN0cmluZy5sZW5ndGh9
			Zm9yKHZhciBpPTAsbj0wO2k8ZW5kOysraSlpZihzdHJpbmcuY2hhckF0KGkpPT0iXHQiKW4rPXRh
			YlNpemUtbiV0YWJTaXplO2Vsc2UrK247cmV0dXJuIG59ZnVuY3Rpb24gY29tcHV0ZWRTdHlsZShl
			bHQpe2lmKGVsdC5jdXJyZW50U3R5bGUpcmV0dXJuIGVsdC5jdXJyZW50U3R5bGU7cmV0dXJuIHdp
			bmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsdCwgbnVsbCl9ZnVuY3Rpb24gZWx0T2Zmc2V0KG5vZGUs
			c2NyZWVuKXt2YXIgYm9kPW5vZGUub3duZXJEb2N1bWVudC5ib2R5O3ZhciB4PTAseT0wLHNraXBC
			b2R5PWZhbHNlO2Zvcih2YXIgbj1ub2RlO247bj1uLm9mZnNldFBhcmVudCl7dmFyIG9sPW4ub2Zm
			c2V0TGVmdCxvdD1uLm9mZnNldFRvcDtpZihuPT1ib2Qpe3grPU1hdGguYWJzKG9sKTt5Kz1NYXRo
			LmFicyhvdCl9ZWxzZSB4Kz1vbCx5Kz1vdDtpZihzY3JlZW4mJmNvbXB1dGVkU3R5bGUobikucG9z
			aXRpb249PSJmaXhlZCIpc2tpcEJvZHk9dHJ1ZX12YXIgZT1zY3JlZW4mJiFza2lwQm9keT9udWxs
			OmJvZDtmb3IodmFyIG49bm9kZS5wYXJlbnROb2RlO24hPWU7bj1uLnBhcmVudE5vZGUpaWYobi5z
			Y3JvbGxMZWZ0IT1udWxsKXt4LT1uLnNjcm9sbExlZnQ7eS09bi5zY3JvbGxUb3B9cmV0dXJue2xl
			ZnQ6eCx0b3A6eX19aWYoZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50
			UmVjdCE9bnVsbCllbHRPZmZzZXQ9IGZ1bmN0aW9uKG5vZGUsc2NyZWVuKXt0cnl7dmFyIGJveD1u
			b2RlLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO2JveD17dG9wOmJveC50b3AsbGVmdDpib3gubGVm
			dH19Y2F0Y2goZSl7Ym94PXt0b3A6MCxsZWZ0OjB9fWlmKCFzY3JlZW4paWYod2luZG93LnBhZ2VZ
			T2Zmc2V0PT1udWxsKXt2YXIgdD1kb2N1bWVudC5kb2N1bWVudEVsZW1lbnR8fGRvY3VtZW50LmJv
			ZHkucGFyZW50Tm9kZTtpZih0LnNjcm9sbFRvcD09bnVsbCl0PWRvY3VtZW50LmJvZHk7Ym94LnRv
			cCs9dC5zY3JvbGxUb3A7Ym94LmxlZnQrPXQuc2Nyb2xsTGVmdH1lbHNle2JveC50b3ArPXdpbmRv
			dy5wYWdlWU9mZnNldDtib3gubGVmdCs9d2luZG93LnBhZ2VYT2Zmc2V0fXJldHVybiBib3h9O2Z1
			bmN0aW9uIGVsdFRleHQobm9kZSl7cmV0dXJuIG5vZGUudGV4dENvbnRlbnR8fG5vZGUuaW5uZXJU
			ZXh0fHxub2RlLm5vZGVWYWx1ZXx8IiJ9ZnVuY3Rpb24gc2VsZWN0SW5wdXQobm9kZSl7aWYoaW9z
			KXtub2RlLnNlbGVjdGlvblN0YXJ0PSAwO25vZGUuc2VsZWN0aW9uRW5kPW5vZGUudmFsdWUubGVu
			Z3RofWVsc2Ugbm9kZS5zZWxlY3QoKX1mdW5jdGlvbiBwb3NFcShhLGIpe3JldHVybiBhLmxpbmU9
			PWIubGluZSYmYS5jaD09Yi5jaH1mdW5jdGlvbiBwb3NMZXNzKGEsYil7cmV0dXJuIGEubGluZTxi
			LmxpbmV8fGEubGluZT09Yi5saW5lJiZhLmNoPGIuY2h9ZnVuY3Rpb24gY29weVBvcyh4KXtyZXR1
			cm57bGluZTp4LmxpbmUsY2g6eC5jaH19dmFyIGVzY2FwZUVsZW1lbnQ9ZG9jdW1lbnQuY3JlYXRl
			RWxlbWVudCgicHJlIik7ZnVuY3Rpb24gaHRtbEVzY2FwZShzdHIpe2VzY2FwZUVsZW1lbnQudGV4
			dENvbnRlbnQ9c3RyO3JldHVybiBlc2NhcGVFbGVtZW50LmlubmVySFRNTH1pZihodG1sRXNjYXBl
			KCJhIik9PSJcbmEiKWh0bWxFc2NhcGU9ZnVuY3Rpb24oc3RyKXtlc2NhcGVFbGVtZW50LnRleHRD
			b250ZW50PXN0cjtyZXR1cm4gZXNjYXBlRWxlbWVudC5pbm5lckhUTUwuc2xpY2UoMSl9O2Vsc2Ug
			aWYoaHRtbEVzY2FwZSgiXHQiKSE9ICJcdCIpaHRtbEVzY2FwZT1mdW5jdGlvbihzdHIpe2VzY2Fw
			ZUVsZW1lbnQuaW5uZXJIVE1MPSIiO2VzY2FwZUVsZW1lbnQuYXBwZW5kQ2hpbGQoZG9jdW1lbnQu
			Y3JlYXRlVGV4dE5vZGUoc3RyKSk7cmV0dXJuIGVzY2FwZUVsZW1lbnQuaW5uZXJIVE1MfTtDb2Rl
			TWlycm9yLmh0bWxFc2NhcGU9aHRtbEVzY2FwZTtmdW5jdGlvbiBlZGl0RW5kKGZyb20sdG8pe2lm
			KCF0bylyZXR1cm4gMDtpZighZnJvbSlyZXR1cm4gdG8ubGVuZ3RoO2Zvcih2YXIgaT1mcm9tLmxl
			bmd0aCxqPXRvLmxlbmd0aDtpPj0wJiZqPj0wOy0taSwtLWopaWYoZnJvbS5jaGFyQXQoaSkhPXRv
			LmNoYXJBdChqKSlicmVhaztyZXR1cm4gaisxfWZ1bmN0aW9uIGluZGV4T2YoY29sbGVjdGlvbixl
			bHQpe2lmKGNvbGxlY3Rpb24uaW5kZXhPZilyZXR1cm4gY29sbGVjdGlvbi5pbmRleE9mKGVsdCk7
			Zm9yKHZhciBpPTAsZT1jb2xsZWN0aW9uLmxlbmd0aDtpPGU7KytpKWlmKGNvbGxlY3Rpb25baV09
			PWVsdClyZXR1cm4gaTsgcmV0dXJuLTF9ZnVuY3Rpb24gaXNXb3JkQ2hhcihjaCl7cmV0dXJuL1x3
			Ly50ZXN0KGNoKXx8Y2gudG9VcHBlckNhc2UoKSE9Y2gudG9Mb3dlckNhc2UoKX12YXIgc3BsaXRM
			aW5lcz0iXG5cbmIiLnNwbGl0KC9cbi8pLmxlbmd0aCE9Mz9mdW5jdGlvbihzdHJpbmcpe3ZhciBw
			b3M9MCxubCxyZXN1bHQ9W107d2hpbGUoKG5sPXN0cmluZy5pbmRleE9mKCJcbiIscG9zKSk+LTEp
			e3Jlc3VsdC5wdXNoKHN0cmluZy5zbGljZShwb3Msc3RyaW5nLmNoYXJBdChubC0xKT09IlxyIj9u
			bC0xOm5sKSk7cG9zPW5sKzF9cmVzdWx0LnB1c2goc3RyaW5nLnNsaWNlKHBvcykpO3JldHVybiBy
			ZXN1bHR9OmZ1bmN0aW9uKHN0cmluZyl7cmV0dXJuIHN0cmluZy5zcGxpdCgvXHI/XG4vKX07Q29k
			ZU1pcnJvci5zcGxpdExpbmVzPXNwbGl0TGluZXM7dmFyIGhhc1NlbGVjdGlvbj13aW5kb3cuZ2V0
			U2VsZWN0aW9uP2Z1bmN0aW9uKHRlKXt0cnl7cmV0dXJuIHRlLnNlbGVjdGlvblN0YXJ0IT10ZS5z
			ZWxlY3Rpb25FbmR9Y2F0Y2goZSl7cmV0dXJuIGZhbHNlfX06IGZ1bmN0aW9uKHRlKXt0cnl7dmFy
			IHJhbmdlPXRlLm93bmVyRG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCl9Y2F0Y2goZSl7
			fWlmKCFyYW5nZXx8cmFuZ2UucGFyZW50RWxlbWVudCgpIT10ZSlyZXR1cm4gZmFsc2U7cmV0dXJu
			IHJhbmdlLmNvbXBhcmVFbmRQb2ludHMoIlN0YXJ0VG9FbmQiLHJhbmdlKSE9MH07Q29kZU1pcnJv
			ci5kZWZpbmVNb2RlKCJudWxsIixmdW5jdGlvbigpe3JldHVybnt0b2tlbjpmdW5jdGlvbihzdHJl
			YW0pe3N0cmVhbS5za2lwVG9FbmQoKX19fSk7Q29kZU1pcnJvci5kZWZpbmVNSU1FKCJ0ZXh0L3Bs
			YWluIiwibnVsbCIpO3ZhciBrZXlOYW1lcz17MzoiRW50ZXIiLDg6IkJhY2tzcGFjZSIsOToiVGFi
			IiwxMzoiRW50ZXIiLDE2OiJTaGlmdCIsMTc6IkN0cmwiLDE4OiJBbHQiLDE5OiJQYXVzZSIsMjA6
			IkNhcHNMb2NrIiwyNzoiRXNjIiwzMjoiU3BhY2UiLDMzOiJQYWdlVXAiLDM0OiJQYWdlRG93biIs
			MzU6IkVuZCIsMzY6IkhvbWUiLDM3OiJMZWZ0IiwgMzg6IlVwIiwzOToiUmlnaHQiLDQwOiJEb3du
			Iiw0NDoiUHJpbnRTY3JuIiw0NToiSW5zZXJ0Iiw0NjoiRGVsZXRlIiw1OToiOyIsOTE6Ik1vZCIs
			OTI6Ik1vZCIsOTM6Ik1vZCIsMTg2OiI7IiwxODc6Ij0iLDE4ODoiLCIsMTg5OiItIiwxOTA6Ii4i
			LDE5MToiLyIsMTkyOiJgIiwyMTk6IlsiLDIyMDoiXFwiLDIyMToiXSIsMjIyOiInIiw2MzI3Njoi
			UGFnZVVwIiw2MzI3NzoiUGFnZURvd24iLDYzMjc1OiJFbmQiLDYzMjczOiJIb21lIiw2MzIzNDoi
			TGVmdCIsNjMyMzI6IlVwIiw2MzIzNToiUmlnaHQiLDYzMjMzOiJEb3duIiw2MzMwMjoiSW5zZXJ0
			Iiw2MzI3MjoiRGVsZXRlIn07Q29kZU1pcnJvci5rZXlOYW1lcz1rZXlOYW1lczsoZnVuY3Rpb24o
			KXtmb3IodmFyIGk9MDtpPDEwO2krKylrZXlOYW1lc1tpKzQ4XT1TdHJpbmcoaSk7Zm9yKHZhciBp
			PTY1O2k8PTkwO2krKylrZXlOYW1lc1tpXT1TdHJpbmcuZnJvbUNoYXJDb2RlKGkpO2Zvcih2YXIg
			aT0xO2k8PTEyO2krKylrZXlOYW1lc1tpKyAxMTFdPWtleU5hbWVzW2krNjMyMzVdPSJGIitpfSko
			KTtyZXR1cm4gQ29kZU1pcnJvcn0oKTsK]]></Resource>
    <Resource ID="a7280e78-723d-4c0e-07b3-fb4b16697f8a" Name="Codeeditor_16x16_.png" Type="png"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
			bWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
			bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
			eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0
			NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
			dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
			dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
			IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
			ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
			cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNl
			SUQ9InhtcC5paWQ6ODhCMTE2RkQ3QkVBMTFFMkFENUZEQjgwQTA5OENCNjciIHhtcE1NOkRvY3Vt
			ZW50SUQ9InhtcC5kaWQ6ODhCMTE2RkU3QkVBMTFFMkFENUZEQjgwQTA5OENCNjciPiA8eG1wTU06
			RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4OEIxMTZGQjdCRUExMUUyQUQ1
			RkRCODBBMDk4Q0I2NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4OEIxMTZGQzdCRUExMUUy
			QUQ1RkRCODBBMDk4Q0I2NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1w
			bWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ptr5jzAAAADRSURBVHjaYpw0aZInAwPDXCCWZCANPAfi
			ZCYyNTNA9cxlgWmePHkySbpzc3PBhjAxUAhYcMr4BDP8V1AGMxkf3GVg2LIWqzLsLrB3ZfjvH8bA
			+O0rGIPYIDHiXCAsyvA/t4yB4cBuBoZ5UyEuIMsLyABqEPFeIAEQZ4CKOthrxBnw9jUDw5WLDAyy
			ChCNQPw/NZ+BwdKO+DBgnNwJDMhyhv95FRCBd28ZGI4fIiEQga5gbCihYhgQiEZQrpKEpm1SwQuQ
			C1JADDI0PwVlZ4AAAwCgjTPF4WOwaQAAAABJRU5ErkJggg==]]></Resource>
    <Resource ID="c43c7089-459d-acc2-f636-fb4b23f22d5b" Name="Codeeditor_16x16_.png" Type="png"><![CDATA[iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJ
			bWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdp
			bj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6
			eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0
			NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJo
			dHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlw
			dGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAv
			IiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RS
			ZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpD
			cmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNl
			SUQ9InhtcC5paWQ6ODhCMTE2RkQ3QkVBMTFFMkFENUZEQjgwQTA5OENCNjciIHhtcE1NOkRvY3Vt
			ZW50SUQ9InhtcC5kaWQ6ODhCMTE2RkU3QkVBMTFFMkFENUZEQjgwQTA5OENCNjciPiA8eG1wTU06
			RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDo4OEIxMTZGQjdCRUExMUUyQUQ1
			RkRCODBBMDk4Q0I2NyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDo4OEIxMTZGQzdCRUExMUUy
			QUQ1RkRCODBBMDk4Q0I2NyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1w
			bWV0YT4gPD94cGFja2V0IGVuZD0iciI/Ptr5jzAAAADRSURBVHjaYpw0aZInAwPDXCCWZCANPAfi
			ZCYyNTNA9cxlgWmePHkySbpzc3PBhjAxUAhYcMr4BDP8V1AGMxkf3GVg2LIWqzLsLrB3ZfjvH8bA
			+O0rGIPYIDHiXCAsyvA/t4yB4cBuBoZ5UyEuIMsLyABqEPFeIAEQZ4CKOthrxBnw9jUDw5WLDAyy
			ChCNQPw/NZ+BwdKO+DBgnNwJDMhyhv95FRCBd28ZGI4fIiEQga5gbCihYhgQiEZQrpKEpm1SwQuQ
			C1JADDI0PwVlZ4AAAwCgjTPF4WOwaQAAAABJRU5ErkJggg==]]></Resource>
    <Resource ID="dd4fb80b-53fc-8629-90b4-3d580864e094" Name="cleditor" Type="css"><![CDATA[LmNsZWRpdG9yTWFpbiB7Ym9yZGVyOjFweCBzb2xpZCAjOTk5OyBwYWRkaW5nOjAgMXB4IDFweDsg
			YmFja2dyb3VuZC1jb2xvcjp3aGl0ZX0NCi5jbGVkaXRvck1haW4gaWZyYW1lIHtib3JkZXI6bm9u
			ZTsgbWFyZ2luOjA7IHBhZGRpbmc6MH0NCi5jbGVkaXRvck1haW4gdGV4dGFyZWEge2JvcmRlcjpu
			b25lOyBtYXJnaW46MDsgcGFkZGluZzowOyBvdmVyZmxvdy15OnNjcm9sbDsgZm9udDoxMHB0IEFy
			aWFsLFZlcmRhbmE7IHJlc2l6ZTpub25lOyBvdXRsaW5lOm5vbmV9DQouY2xlZGl0b3JUb29sYmFy
			IHtiYWNrZ3JvdW5kOiB1cmwoJy85NGVkMWVkMy0xMThmLTljZTEtOGFkMi05OTRhYjVhMDM1MTgu
			cmVzJykgcmVwZWF0fQ0KLmNsZWRpdG9yR3JvdXAge2Zsb2F0OmxlZnQ7IGhlaWdodDoyNnB4fQ0K
			LmNsZWRpdG9yQnV0dG9uIHtmbG9hdDpsZWZ0OyB3aWR0aDoyNHB4OyBoZWlnaHQ6MjRweDsgbWFy
			Z2luOjFweCAwIDFweCAwOyBiYWNrZ3JvdW5kOiB1cmwoJy82MzdlNTRmZC0xNDMxLTBkZWUtMmU4
			Mi1mMjIzZGI5NjA1MDkucmVzJyl9DQouY2xlZGl0b3JEaXNhYmxlZCB7b3BhY2l0eTowLjM7IGZp
			bHRlcjphbHBoYShvcGFjaXR5PTMwKX0NCi5jbGVkaXRvckRpdmlkZXIge2Zsb2F0OmxlZnQ7IHdp
			ZHRoOjFweDsgaGVpZ2h0OjIzcHg7IG1hcmdpbjoxcHggMCAxcHggMDsgYmFja2dyb3VuZDojQ0ND
			fQ0KLmNsZWRpdG9yUG9wdXAge2JvcmRlcjpzb2xpZCAxcHggIzk5OTsgYmFja2dyb3VuZC1jb2xv
			cjp3aGl0ZTsgcG9zaXRpb246YWJzb2x1dGU7IGZvbnQ6MTBwdCBBcmlhbCxWZXJkYW5hOyBjdXJz
			b3I6ZGVmYXVsdDsgei1pbmRleDoxMDAwMH0NCi5jbGVkaXRvckxpc3QgZGl2IHtwYWRkaW5nOjJw
			eCA0cHggMnB4IDRweH0NCi5jbGVkaXRvckxpc3QgcCwNCi5jbGVkaXRvckxpc3QgaDEsDQouY2xl
			ZGl0b3JMaXN0IGgyLA0KLmNsZWRpdG9yTGlzdCBoMywNCi5jbGVkaXRvckxpc3QgaDQsDQouY2xl
			ZGl0b3JMaXN0IGg1LA0KLmNsZWRpdG9yTGlzdCBoNiwNCi5jbGVkaXRvckxpc3QgZm9udCB7cGFk
			ZGluZzowOyBtYXJnaW46MDsgYmFja2dyb3VuZC1jb2xvcjpUcmFuc3BhcmVudH0NCi5jbGVkaXRv
			ckNvbG9yIHt3aWR0aDoxNTBweDsgcGFkZGluZzoxcHggMCAwIDFweH0NCi5jbGVkaXRvckNvbG9y
			IGRpdiB7ZmxvYXQ6bGVmdDsgd2lkdGg6MTRweDsgaGVpZ2h0OjE0cHg7IG1hcmdpbjowIDFweCAx
			cHggMH0NCi5jbGVkaXRvclByb21wdCB7YmFja2dyb3VuZC1jb2xvcjojRjZGN0Y5OyBwYWRkaW5n
			OjRweDsgZm9udC1zaXplOjguNXB0fQ0KLmNsZWRpdG9yUHJvbXB0IGlucHV0LA0KLmNsZWRpdG9y
			UHJvbXB0IHRleHRhcmVhIHtmb250OjguNXB0IEFyaWFsLFZlcmRhbmE7fQ0KLmNsZWRpdG9yTXNn
			IHtiYWNrZ3JvdW5kLWNvbG9yOiNGREZDRUU7IHdpZHRoOjE1MHB4OyBwYWRkaW5nOjRweDsgZm9u
			dC1zaXplOjguNXB0fQ0K]]></Resource>
    <Resource ID="e205cbe1-7179-fe66-4f81-ab6d605b20b2" Name="table" Type="gif"><![CDATA[R0lGODlhGAAYAKIEANbT1v///6WmpUpNpf///wAAAAAAAAAAACH5BAEAAAQALAAAAAAYABgAAANQ
			SLrc/jDKSau9TOjNu4DCII4k+T1hqYqnIwBwLMttIwQBgOv5jtcZX2/IAy5esyTMqLgRhUUQdBpg
			EpDKmdXJ6wq3VG8V5ClrMOi0es1uXxIAOw==]]></Resource>
  </Resources>
  <SourceCode><![CDATA[class VDOM_codeeditor(VDOM_object):

	def render(self, contents=""):
		id = u"o_" + (self.id).replace('-', '_')

		display = u"display:none;" if self.visible == "0" else u"display:block;"

		style = u"""z-index: {zind}; top: {top}px; left: {left}px; overflow: visible; position: absolute;
			width: {width}px; height: {height}px; padding: 2px 5px 2px 5px; {display} font: 14px tahoma
			""".format(zind = self.zindex, top = self.top, left = self.left,
					width = self.width, height = self.height, display = display)

		style_area = u"""width:{width}px; height:{height}px""".format(width = self.width, height = self.height)

		if VDOM_CONFIG_1["DEBUG"] == "1":
			debug_info = u"objtype='codeeditor' objname='%s' ver='%s'" % (self.name, self.type.version)
		else:
			debug_info = u""
			
		is_readonly = "true" if self.is_readonly == "1" else "false"

		result = u"""
<style type="text/css">
#%(id)s .CodeMirror-scroll { height: %(height)spx; }
</style>
<div id="%(id)s" style="%(style)s" %(debug_info)s>
	<textarea name="%(name)s" style='%(style_area)s'>%(value)s</textarea>
</div>
<script type="text/javascript">$q(function(){
	if (typeof window.%(id)s_codeeditor !== 'undefined') {
		window.%(id)s_codeeditor.toTextArea();
		delete(window.%(id)s_codeeditor);
	}
	window.%(id)s_codeeditor = CodeMirror.fromTextArea($q('#%(id)s>textarea').get(0), {
		mode: '%(mode)s',
		lineNumbers: true,
		styleActiveLine: true,
		readOnly: %(is_readonly)s,
		onCursorActivity: function() { window.%(id)s_codeeditor.matchHighlight("CodeMirror-matchhighlight"); }
	});
	$q('#%(id)s').parents('form:first').submit(function(){
		window.%(id)s_codeeditor.save();
	});
	window.%(id)s_codeeditor.refresh();

	var el = $('#%(id)s');

	var intervalId = setInterval(function() {
		if (el.is(':visible')) {
			window.%(id)s_codeeditor.refresh();
			clearInterval(intervalId);
		}
	}, 200);
});</script>
			""" % {
				"mode":       self.syntax,
				"id":         id,
				"name":       self.customname or self.name,
				"style":      style,
				"style_area": style_area,
				"value":      unicode(self.value).replace('&', '&amp;').replace('<', '&lt;').replace('>', '&gt;').replace('"', '&quot;'),
				"width":      self.width,
				"height":     self.height,
				"debug_info": debug_info,
				"is_readonly": is_readonly
			}

		return VDOM_object.render(self, contents=result)

	def get_lines_amount (self, value) : 			
		count = value.count("\n")
		
		return int(count)+1
	
	def get_lines_text (self, value, text_height) :
		
		amount = self.get_lines_amount(value)
		
		lines = \
			u""" <text x="0" y="2" width="28" height="{text_height}" 
					font-family="tahoma" font-size="14" fill="#aaaaaa" align="right"> 
			""".format(text_height=text_height)
		
		i = 1
		while (i <= amount):
			text_y = (i-1)*17
			
			if text_y >= text_height :
				i = i + 1
				break
				
			text_h = 20 if text_y + 20 <= text_height else text_height-text_y
			lines += u""" <tspan y="{y}" height="{height}">{line_number}</tspan> """.format(y=text_y, line_number=i, height=text_h)
			i = i + 1
		
		lines += u" </text> "
		
		return lines
		
	def wysiwyg(self, contents=""):
		
		text_width = int(self.width) - 38
		text_height = int(self.height) - 2

		result = \
			u"""<container name="{name}" id="{id}" visible="{vis}" zindex="{zind}" hierarchy="{hierarchy}" order="{order}"
					top="{top}" left="{left}" width="{width}" height="{height}" 
					backgroundcolor="#ffffff" bordercolor="#cccccc">
					<svg>
						<rect x="1" y="1" width="28" height="{text_height}" fill="#F7F7F7"/>
						<line x1="30" y1="1" x2="30" y2="{line_y_end}" style="stroke:#eeeeee"/>
						<text x="40" y="17" width="{text_width}" height="{text_height}" font-family="Courier New" font-size="14">{value}</text>
						{lines}
					</svg>
				</container>
			""".format(
					id = self.id, vis = self.visible, zind = self.zindex,
					hierarchy = self.hierarchy, order = self.order,
					top = self.top, left = self.left, 
					width = self.width, height = self.height,
					text_width = text_width, text_height = text_height,
					line_y_end = 1+int(self.height)-2,
					value = self.value, name = self.name,
					lines = self.get_lines_text(self.value, text_height))

		return VDOM_object.wysiwyg(self, contents=result)]]></SourceCode>
  <Libraries>
    <Library Target="html"><![CDATA[<script type="text/javascript" src="/064add91-8595-0f40-10ea-09d38022edee.res?"></script>
<script type="text/javascript" src="/5cd10fee-6e10-5253-24ea-3edb0a87f9ec.res?match"></script>
<script type="text/javascript" src="/95be4415-7ccb-b87b-f50f-77c8485f6bd9.res?syntaxes"></script>

<style type="text/css">
./* BASICS */

.CodeMirror {
  /* Set height, width, borders, and global font properties here */
  font-family: monospace;
  height: 300px;
  color: black;
  direction: ltr;
}

/* PADDING */

.CodeMirror-lines {
  padding: 4px 0; /* Vertical padding around content */
}
.CodeMirror pre.CodeMirror-line,
.CodeMirror pre.CodeMirror-line-like {
  padding: 0 4px; /* Horizontal padding of content */
}

.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {
  background-color: white; /* The little square between H and V scrollbars */
}

/* GUTTER */

.CodeMirror-gutters {
  border-right: 1px solid #ddd;
  background-color: #f7f7f7;
  white-space: nowrap;
}
.CodeMirror-linenumbers {}
.CodeMirror-linenumber {
  padding: 0 3px 0 5px;
  min-width: 20px;
  text-align: right;
  color: #999;
  white-space: nowrap;
}

.CodeMirror-guttermarker { color: black; }
.CodeMirror-guttermarker-subtle { color: #999; }

/* CURSOR */

.CodeMirror-cursor {
  border-left: 1px solid black;
  border-right: none;
  width: 0;
}
/* Shown when moving in bi-directional text */
.CodeMirror div.CodeMirror-secondarycursor {
  border-left: 1px solid silver;
}
.cm-fat-cursor .CodeMirror-cursor {
  width: auto;
  border: 0 !important;
  background: #7e7;
}
.cm-fat-cursor div.CodeMirror-cursors {
  z-index: 1;
}
.cm-fat-cursor-mark {
  background-color: rgba(20, 255, 20, 0.5);
  -webkit-animation: blink 1.06s steps(1) infinite;
  -moz-animation: blink 1.06s steps(1) infinite;
  animation: blink 1.06s steps(1) infinite;
}
.cm-animate-fat-cursor {
  width: auto;
  border: 0;
  -webkit-animation: blink 1.06s steps(1) infinite;
  -moz-animation: blink 1.06s steps(1) infinite;
  animation: blink 1.06s steps(1) infinite;
  background-color: #7e7;
}
@-moz-keyframes blink {
  0% {}
  50% { background-color: transparent; }
  100% {}
}
@-webkit-keyframes blink {
  0% {}
  50% { background-color: transparent; }
  100% {}
}
@keyframes blink {
  0% {}
  50% { background-color: transparent; }
  100% {}
}

/* Can style cursor different in overwrite (non-insert) mode */
.CodeMirror-overwrite .CodeMirror-cursor {}

.cm-tab { display: inline-block; text-decoration: inherit; }

.CodeMirror-rulers {
  position: absolute;
  left: 0; right: 0; top: -50px; bottom: 0;
  overflow: hidden;
}
.CodeMirror-ruler {
  border-left: 1px solid #ccc;
  top: 0; bottom: 0;
  position: absolute;
}

/* DEFAULT THEME */

.cm-s-default .cm-header {color: blue;}
.cm-s-default .cm-quote {color: #090;}
.cm-negative {color: #d44;}
.cm-positive {color: #292;}
.cm-header, .cm-strong {font-weight: bold;}
.cm-em {font-style: italic;}
.cm-link {text-decoration: underline;}
.cm-strikethrough {text-decoration: line-through;}

.cm-s-default .cm-keyword {color: #708;}
.cm-s-default .cm-atom {color: #219;}
.cm-s-default .cm-number {color: #164;}
.cm-s-default .cm-def {color: #00f;}
.cm-s-default .cm-variable,
.cm-s-default .cm-punctuation,
.cm-s-default .cm-property,
.cm-s-default .cm-operator {}
.cm-s-default .cm-variable-2 {color: #05a;}
.cm-s-default .cm-variable-3, .cm-s-default .cm-type {color: #085;}
.cm-s-default .cm-comment {color: #a50;}
.cm-s-default .cm-string {color: #a11;}
.cm-s-default .cm-string-2 {color: #f50;}
.cm-s-default .cm-meta {color: #555;}
.cm-s-default .cm-qualifier {color: #555;}
.cm-s-default .cm-builtin {color: #30a;}
.cm-s-default .cm-bracket {color: #997;}
.cm-s-default .cm-tag {color: #170;}
.cm-s-default .cm-attribute {color: #00c;}
.cm-s-default .cm-hr {color: #999;}
.cm-s-default .cm-link {color: #00c;}

.cm-s-default .cm-error {color: #f00;}
.cm-invalidchar {color: #f00;}

.CodeMirror-composing { border-bottom: 2px solid; }

/* Default styles for common addons */

div.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}
div.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}
.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }
.CodeMirror-activeline-background {background: #e8f2ff;}

/* STOP */

/* The rest of this file contains styles related to the mechanics of
   the editor. You probably shouldn't touch them. */

.CodeMirror {
  position: relative;
  overflow: hidden;
  background: white;
}

.CodeMirror-scroll {
  overflow: scroll !important; /* Things will break if this is overridden */
  /* 30px is the magic margin used to hide the element's real scrollbars */
  /* See overflow: hidden in .CodeMirror */
  margin-bottom: -30px; margin-right: -30px;
  padding-bottom: 30px;
  height: 100%;
  outline: none; /* Prevent dragging from highlighting the element */
  position: relative;
}
.CodeMirror-sizer {
  position: relative;
  border-right: 30px solid transparent;
}

/* The fake, visible scrollbars. Used to force redraw during scrolling
   before actual scrolling happens, thus preventing shaking and
   flickering artifacts. */
.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {
  position: absolute;
  z-index: 6;
  display: none;
}
.CodeMirror-vscrollbar {
  right: 0; top: 0;
  overflow-x: hidden;
  overflow-y: scroll;
}
.CodeMirror-hscrollbar {
  bottom: 0; left: 0;
  overflow-y: hidden;
  overflow-x: scroll;
}
.CodeMirror-scrollbar-filler {
  right: 0; bottom: 0;
}
.CodeMirror-gutter-filler {
  left: 0; bottom: 0;
}

.CodeMirror-gutters {
  position: absolute; left: 0; top: 0;
  min-height: 100%;
  z-index: 3;
}
.CodeMirror-gutter {
  white-space: normal;
  height: 100%;
  display: inline-block;
  vertical-align: top;
  margin-bottom: -30px;
}
.CodeMirror-gutter-wrapper {
  position: absolute;
  z-index: 4;
  background: none !important;
  border: none !important;
}
.CodeMirror-gutter-background {
  position: absolute;
  top: 0; bottom: 0;
  z-index: 4;
}
.CodeMirror-gutter-elt {
  position: absolute;
  cursor: default;
  z-index: 4;
}
.CodeMirror-gutter-wrapper ::selection { background-color: transparent }
.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }

.CodeMirror-lines {
  cursor: text;
  min-height: 1px; /* prevents collapsing before first draw */
}
.CodeMirror pre.CodeMirror-line,
.CodeMirror pre.CodeMirror-line-like {
  /* Reset some styles that the rest of the page might have set */
  -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;
  border-width: 0;
  background: transparent;
  font-family: inherit;
  font-size: inherit;
  margin: 0;
  white-space: pre;
  word-wrap: normal;
  line-height: inherit;
  color: inherit;
  z-index: 2;
  position: relative;
  overflow: visible;
  -webkit-tap-highlight-color: transparent;
  -webkit-font-variant-ligatures: contextual;
  font-variant-ligatures: contextual;
}
.CodeMirror-wrap pre.CodeMirror-line,
.CodeMirror-wrap pre.CodeMirror-line-like {
  word-wrap: break-word;
  white-space: pre-wrap;
  word-break: normal;
}

.CodeMirror-linebackground {
  position: absolute;
  left: 0; right: 0; top: 0; bottom: 0;
  z-index: 0;
}

.CodeMirror-linewidget {
  position: relative;
  z-index: 2;
  padding: 0.1px; /* Force widget margins to stay inside of the container */
}

.CodeMirror-widget {}

.CodeMirror-rtl pre { direction: rtl; }

.CodeMirror-code {
  outline: none;
}

/* Force content-box sizing for the elements where we expect it */
.CodeMirror-scroll,
.CodeMirror-sizer,
.CodeMirror-gutter,
.CodeMirror-gutters,
.CodeMirror-linenumber {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
}

.CodeMirror-measure {
  position: absolute;
  width: 100%;
  height: 0;
  overflow: hidden;
  visibility: hidden;
}

.CodeMirror-cursor {
  position: absolute;
  pointer-events: none;
}
.CodeMirror-measure pre { position: static; }

div.CodeMirror-cursors {
  visibility: hidden;
  position: relative;
  z-index: 3;
}
div.CodeMirror-dragcursors {
  visibility: visible;
}

.CodeMirror-focused div.CodeMirror-cursors {
  visibility: visible;
}

.CodeMirror-selected { background: #d9d9d9; }
.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }
.CodeMirror-crosshair { cursor: crosshair; }
.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }
.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }

.cm-searching {
  background-color: #ffa;
  background-color: rgba(255, 255, 0, .4);
}

/* Used to force a border model for a node */
.cm-force-border { padding-right: .1px; }

@media print {
  /* Hide the cursor when printing */
  .CodeMirror div.CodeMirror-cursors {
    visibility: hidden;
  }
}

/* See issue #2901 */
.cm-tab-wrap-hack:after { content: ''; }

/* Help users use markselection to safely style text background */
span.CodeMirror-selectedtext { background: none; }

.CodeMirror-scroll div {
    box-sizing: border-box;
    padding: 0px 7px 0px 1px;
}
.CodeMirror pre.CodeMirror-line, .CodeMirror pre.CodeMirror-line-like {
    padding: 0px 33px;
}



</style>]]></Library>
  </Libraries>
  <E2vdom>
    <Events>
      <Userinterfaceevents>
        <Event Name="click" Help="#Lang(513)">
          <Parameters>
            <Parameter Name="X" Order="0" VbType="" Help="#Lang(901)"/>
            <Parameter Name="Y" Order="0" VbType="" Help="#Lang(902)"/>
          </Parameters>
        </Event>
        <Event Name="getvalue" Help="#Lang(514)">
          <Parameters>
            <Parameter Name="value" Order="0" VbType="" Help="#Lang(903)"/>
          </Parameters>
        </Event>
      </Userinterfaceevents>
    </Events>
    <Actions>
      <Container ID="2330fe83-8cd6-4ed5-907d-11874e7ebcf4">
        <Action Help="#Lang(501)" InterfaceName="#Lang(601)" MethodName="getValue">
          <Parameters/>
          <SourceCode><![CDATA[eval('var x='+this.domCont.id+"_codeeditor.getValue(value);");
execEventBinded(id.substring(2, id.length), "getvalue", {value:x});]]></SourceCode>
        </Action>
        <Action Help="#Lang(502)" InterfaceName="#Lang(602)" MethodName="hide">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(701)" ScriptName="fade" Help="#Lang(801)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[vdom_ui_hide(this.domCont, fade);]]></SourceCode>
        </Action>
        <Action Help="#Lang(503)" InterfaceName="#Lang(603)" MethodName="moveTo">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(702)" ScriptName="newX" Help="#Lang(802)" RegularExpressionValidation=".*"/>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(703)" ScriptName="newY" Help="#Lang(803)" RegularExpressionValidation=".*"/>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(704)" ScriptName="Effect" Help="#Lang(804)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[vdom_ui_moveTo(this.domCont, newX, newY, Effect);]]></SourceCode>
        </Action>
        <Action Help="#Lang(504)" InterfaceName="#Lang(604)" MethodName="refresh">
          <Parameters/>
          <SourceCode><![CDATA[eval(this.domCont.id+"_codeeditor.refresh();");]]></SourceCode>
        </Action>
        <Action Help="#Lang(505)" InterfaceName="#Lang(605)" MethodName="resizeTo">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(705)" ScriptName="width" Help="#Lang(805)" RegularExpressionValidation=".*"/>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(706)" ScriptName="height" Help="#Lang(806)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[var w = parseInt(width,10), h = parseInt(height,10), o = $q(this.domCont);
o.width(w).height(h);
$q('.CodeMirror-scroll', o).width(w).height(h);
eval(this.domCont.id+"_codeeditor.refresh();");]]></SourceCode>
        </Action>
        <Action Help="#Lang(506)" InterfaceName="#Lang(606)" MethodName="setCursor">
          <Parameters>
            <Parameter DefaultValue="1" Interface="" InterfaceName="#Lang(707)" ScriptName="line" Help="#Lang(807)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[eval('window.'+this.domCont.id+'_codeeditor.focus(); window.'+this.domCont.id+'_codeeditor.setCursor('+parseInt(line,10)+');');]]></SourceCode>
        </Action>
        <Action Help="#Lang(507)" InterfaceName="#Lang(607)" MethodName="setFocus">
          <Parameters/>
          <SourceCode><![CDATA[eval('window.'+this.domCont.id+'_codeeditor.focus();');]]></SourceCode>
        </Action>
        <Action Help="#Lang(508)" InterfaceName="#Lang(608)" MethodName="setSyntax">
          <Parameters>
            <Parameter DefaultValue="'xml'" Interface="" InterfaceName="#Lang(708)" ScriptName="syntax" Help="#Lang(808)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[]]></SourceCode>
        </Action>
        <Action Help="#Lang(509)" InterfaceName="#Lang(609)" MethodName="setTheme">
          <Parameters>
            <Parameter DefaultValue="" Interface="" InterfaceName="#Lang(709)" ScriptName="theme" Help="#Lang(809)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[]]></SourceCode>
        </Action>
        <Action Help="#Lang(511)" InterfaceName="#Lang(611)" MethodName="setValue">
          <Parameters>
            <Parameter DefaultValue="" Interface="" InterfaceName="#Lang(711)" ScriptName="value" Help="#Lang(811)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[eval(this.domCont.id+"_codeeditor.setValue(value);");]]></SourceCode>
        </Action>
        <Action Help="#Lang(512)" InterfaceName="#Lang(612)" MethodName="show">
          <Parameters>
            <Parameter DefaultValue="0" Interface="" InterfaceName="#Lang(712)" ScriptName="fade" Help="#Lang(812)" RegularExpressionValidation=".*"/>
          </Parameters>
          <SourceCode><![CDATA[vdom_ui_show(this.domCont, fade);]]></SourceCode>
        </Action>
      </Container>
    </Actions>
  </E2vdom>
</Type>